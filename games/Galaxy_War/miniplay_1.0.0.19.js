(function(global){const myLog=console.log;function inIframe(){try{return global.self!==global.top}catch(e){return true}}const data_mode=global.document.currentScript.getAttribute("data-mode");function isModeIFrameGame(){return data_mode==="game"}function isModeIFrameIndex(){return data_mode==="index"}function isModeStand(){return data_mode==null||isModeIFrameGame()&&!inIframe()}const Tools={isLandscape:function(){return window.innerWidth>window.innerHeight},isFullScreen:function(){return global.document.fullscreenElement||global.document.webkitFullscreenElement||global.document.mozFullScreenElement||global.document.msFullscreenElement||false},exitFullscreen:function(){if(global.document.exitFullscreen){global.document.exitFullscreen()}else if(global.document.webkitExitFullscreen){global.document.webkitExitFullscreen()}else if(global.document.msExitFullscreen){global.document.msExitFullscreen()}else if(global.document.mozCancelFullScreen){global.document.mozCancelFullScreen()}},requestFullScreen:function(){var elem=global.document.documentElement;if(elem.requestFullscreen){return elem.requestFullscreen()}else if(elem.mozRequestFullScreen){return elem.mozRequestFullScreen()}else if(elem.webkitRequestFullscreen){return elem.webkitRequestFullscreen()}else if(elem.msRequestFullscreen){return elem.msRequestFullscreen()}else{return elem.requestFullscreen()}},requestLandscape:function(isLandscape){let runRequestLandscape=()=>{return global.screen.orientation.lock(isLandscape?"landscape-primary":"portrait-primary")};if(Tools.isFullScreen()){return runRequestLandscape()}else{Tools.requestFullScreen().then(()=>{return runRequestLandscape()})}},showDialog:async function(){let dialogDiv=global.window.document.getElementById("miniplay_dialog");if(!dialogDiv){return Promise.resolve()}dialogDiv.style.display="block";return new Promise((resolve,reject)=>{global.miniPlayCancel=function(){dialogDiv.style.display="none";resolve()};global.miniPlayConfirm=function(){dialogDiv.style.display="none";Tools.requestLandscape(true);resolve()}})},prompt:function(msg,duration){if(!global._prompt){global._prompt=global.document.createElement("div");global._prompt.style.cssText="font-family:siyuan;max-width:80%;min-width:320px;padding:10px 10px 10px 10px;min-height:40px;color: rgb(255, 255, 255);line-height: 20px;text-align:center;border-radius: 4px;position: fixed;top: 40%;left: 50%;transform: translate(-50%, -50%);z-index: 999999;background: rgba(0, 0, 0,.7);font-size: 16px;";global.document.body.appendChild(global._prompt)}global._prompt.innerHTML=msg;duration=isNaN(duration)?2e3:duration;global._prompt.style.display="inline";global._prompt.style.opacity="1";setTimeout(function(){var d=.5;global._prompt.style.webkitTransition="-webkit-transform "+d+"s ease-in, opacity "+d+"s ease-in";global._prompt.style.opacity="0";global._prompt.style.display="none"}.bind(global),duration)},configBackButton:function(){getAdPlatform().then(platform=>{myLog("platform.config.backButton: "+platform.config.backButton);if(isModeIFrameIndex()&&platform.config.backButton){let drag=global.document.createElement("div");drag.style="max-width: 50px; max-height: 50px; position: fixed; top: 25%; left: 0%;transition: left 0.3s ease-out; opacity: 0.5";drag.id="backButton";drag.innerHTML=`
                           <svg data-v-435fdedb="" t="1693799562724" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="35118" width="2rem" height="2rem" class="icon"><path data-v-435fdedb="" d="M384 128V16h-128v112" fill="#D73636" p-id="35119"></path><path data-v-435fdedb="" d="M336 128V16h-80v112" fill="#F73B2F" p-id="35120"></path><path data-v-435fdedb="" d="M48 416v528h928V416" fill="#FFE183" p-id="35121"></path><path data-v-435fdedb="" d="M976 416v528h-64V480H48v-64h928z" fill="#D9BF6F" p-id="35122"></path><path data-v-435fdedb="" d="M577.408 352H16v64h488.288" fill="#F73B2F" p-id="35123"></path><path data-v-435fdedb="" d="M833.232 416H1008v-64H768.784" fill="#F73B2F" p-id="35124"></path><path data-v-435fdedb="" d="M368 656a96.048 96.048 0 0 0-28.112-67.888A96 96 0 0 0 176 656v96h192v-96z" fill="#FFFFFF" p-id="35125"></path><path data-v-435fdedb="" d="M320 592h32v160h-32z" fill="#D9D9D9" p-id="35126"></path><path data-v-435fdedb="" d="M256 352v64c0 12.736-5.056 24.944-14.064 33.936a47.936 47.936 0 0 1-67.872 0A47.936 47.936 0 0 1 160 416v-64H32L128 128h18.736a48.032 48.032 0 0 1 90.528 0h201.408A80.048 80.048 0 0 1 512 80a80.048 80.048 0 0 1 72.32 45.792A63.712 63.712 0 0 1 624 112c16.208 0 31.024 6.048 42.32 16h49.824A71.92 71.92 0 0 1 776 96c24.944 0 46.944 12.704 59.856 32H896l96 224H400v56a40 40 0 1 1-80 0V352h-64z" fill="#CBE9EA" p-id="35127"></path><path data-v-435fdedb="" d="M896 128l96 224H416c324.768 19.904 531.216-28.112 480-224z" fill="#ADC6C7" p-id="35128"></path><path data-v-435fdedb="" d="M496 528l176-176 176 176v352H496V528" fill="#FFD140" p-id="35129"></path><path data-v-435fdedb="" d="M464 880h416v64H464z" fill="#5AB947" p-id="35130"></path><path data-v-435fdedb="" d="M768 656a96.048 96.048 0 0 0-28.112-67.888 96.048 96.048 0 0 0-135.776 0A96.048 96.048 0 0 0 576 656v224h192V656z" fill="#D73636" p-id="35131"></path><path data-v-435fdedb="" d="M648 563.44a92.4 92.4 0 0 1 43.888 24.672A96.048 96.048 0 0 1 720 656v224h-144V656c0-25.456 10.112-49.872 28.112-67.888a92.4 92.4 0 0 1 43.888-24.672z" fill="#F73B2F" p-id="35132"></path><path data-v-435fdedb="" d="M496 528v64l176-176 144 144v320h32V512L672 352 496 528z" fill="#D9B236" p-id="35133"></path><path data-v-435fdedb="" d="M640 720m-16 0a16 16 0 1 0 32 0 16 16 0 1 0-32 0Z" fill="#F73B2F" p-id="35134"></path><path data-v-435fdedb="" d="M672.064 261.584v-0.016l242.624 234.688a32 32 0 0 1 0.768 45.232l-0.016 0.016a32 32 0 0 1-45.248 0.784L672.064 350.96 474.496 541.744a31.936 31.936 0 0 1-45.248-0.8l-0.016-0.016a32 32 0 0 1 0.768-45.232l242.064-234.112z" fill="#F73B2F" p-id="35135"></path><path data-v-435fdedb="" d="M40.32 960.784A104.064 104.064 0 0 1 136 816a103.68 103.68 0 0 1 71.6 28.592 79.584 79.584 0 0 0 71.312 20.864A108.944 108.944 0 0 1 296 864c48.576 0 88 39.424 88 88" fill="#CBE9EA" p-id="35136"></path><path data-v-435fdedb="" d="M16 944h992v64H16z" fill="#5AB947" p-id="35137"></path></svg>
                    `;global.window.document.body.appendChild(drag);let isDragging=false;let startX,startY;let wasDragged=false;const startDrag=(clientX,clientY)=>{isDragging=true;startX=clientX;startY=clientY;drag.style.transition="none";drag.style.opacity=1;myLog("startDrag")};const doDrag=(clientX,clientY)=>{myLog("doDrag isDragging: "+isDragging);if(isDragging){const deltaX=clientX-startX;const deltaY=clientY-startY;if(deltaX!==0||deltaY!==0){wasDragged=true}drag.style.left=`${drag.offsetLeft+deltaX}px`;let top=drag.offsetTop+deltaY;if(top<=0){top=0}else if(top>=window.innerHeight-drag.offsetHeight){top=window.innerHeight-drag.offsetHeight}drag.style.top=`${top}px`;startX=clientX;startY=clientY}};const endDrag=()=>{myLog("endDrag isDragging: "+isDragging);if(isDragging){isDragging=false;wasDragged=false;const shouldStickToLeft=drag.offsetLeft+drag.offsetWidth/2<window.innerWidth/2;drag.style.left=shouldStickToLeft?"0px":`${window.innerWidth-drag.offsetWidth}px`;drag.style.transition="left 0.3s ease-out";setTimeout(()=>{drag.style.opacity=.5},3e3)}};drag.addEventListener("mousedown",e=>startDrag(e.clientX,e.clientY));document.addEventListener("mousemove",e=>doDrag(e.clientX,e.clientY));document.addEventListener("mouseup",endDrag);drag.addEventListener("touchstart",e=>startDrag(e.touches[0].clientX,e.touches[0].clientY));document.addEventListener("touchmove",e=>doDrag(e.touches[0].clientX,e.touches[0].clientY));document.addEventListener("touchend",endDrag);drag.addEventListener("click",()=>{if(!wasDragged){if(global.window.history.length>1){global.window.history.back()}else{Tools.prompt("Cant't go back.")}}wasDragged=false})}})}};function timeoutTaskWrapper(task,maxTime=5e3,timeoutReson,timeoutCallback){return Promise.race([new Promise((resolve,reject)=>{setTimeout(()=>{timeoutCallback()},maxTime)}),task])}function isNotNull(obj){return obj!==undefined&&obj!=null}const msg_type="msg_type";const msg_ad_type="msg_ad_type";const msg_ad_name="msg_ad_name";const msg_callback_function="msg_callback_function";const msg_callback_params="msg_callback_params";const MESSAGE_TYPE={gtag:"gtag",ad:"ad",states:"states"};const AD_CALLBACK_METHOD={beforeAd:"beforeAd",afterAd:"afterAd",adBreakDone:"adBreakDone",beforeReward:"beforeReward",adDismissed:"adDismissed",adViewed:"adViewed"};const AD_TYPE={preroll:"preroll",start:"start",pause:"pause",next:"next",browse:"browse",reward:"reward",banner:"banner"};const PLATFORM={gamecenter:"gamecenter",transsion:"transsion",newbyear:"newbyear",xiaomi:"xiaomi"};let IFrameAdCallbackCache=null;function handleParentMsg(paramsFromParent){myLog(`handleParentMsg: ${JSON.stringify(paramsFromParent)}`);let msgType=paramsFromParent.msg_type;if(msgType===MESSAGE_TYPE.states){VirtualAd.isReady=paramsFromParent.msg_callback_params["isReady"]}else if(msgType===MESSAGE_TYPE.ad){if(IFrameAdCallbackCache!=null){let callback_function=paramsFromParent.msg_callback_function;let callback_params=paramsFromParent.msg_callback_params;switch(callback_function){case AD_CALLBACK_METHOD.beforeAd:if(isNotNull(IFrameAdCallbackCache.beforeAd)){IFrameAdCallbackCache.beforeAd()}break;case AD_CALLBACK_METHOD.afterAd:if(isNotNull(IFrameAdCallbackCache.afterAd)){IFrameAdCallbackCache.afterAd()}break;case AD_CALLBACK_METHOD.adBreakDone:if(isNotNull(IFrameAdCallbackCache.adBreakDone)){IFrameAdCallbackCache.adBreakDone(callback_params);IFrameAdCallbackCache=null}break;case AD_CALLBACK_METHOD.adViewed:if(isNotNull(IFrameAdCallbackCache.adViewed)){IFrameAdCallbackCache.adViewed()}break;case AD_CALLBACK_METHOD.adDismissed:if(isNotNull(IFrameAdCallbackCache.adDismissed)){IFrameAdCallbackCache.adDismissed()}break;case AD_CALLBACK_METHOD.beforeReward:if(isNotNull(IFrameAdCallbackCache.beforeReward)){let showAdFnEmpty=function(){myLog("beforeReward call with empty")};IFrameAdCallbackCache.beforeReward(showAdFnEmpty)}break;default:myLog("can't handle this method: "+callback_function);break}}else{myLog("IFrameCallbackCache is null")}}}function handleIframeMsg(paramsFromGame){let msgType=paramsFromGame[msg_type];if(msgType===MESSAGE_TYPE.gtag){let gtagParams=paramsFromGame[msg_callback_params];if(MiniPlay.isReady()){MiniPlay.gtag(...gtagParams)}else{MiniPlay.initAsync().then(()=>{MiniPlay.gtag(...gtagParams)})}}else if(msgType===MESSAGE_TYPE.ad){if(paramsFromGame.msg_ad_type===AD_TYPE.banner){if(MiniPlay.isReady()){MiniPlay.showBanner(gtagParams)}else{MiniPlay.initAsync().then(()=>{MiniPlay.showBanner(gtagParams)})}}else{let callbackHandle={type:paramsFromGame.msg_ad_type,name:paramsFromGame.msg_ad_name,adBreakDone:placementInfo=>{postMessageToIframe({msg_type:MESSAGE_TYPE.ad,msg_ad_type:paramsFromGame.msg_ad_type,msg_ad_name:paramsFromGame.msg_ad_name,msg_callback_function:AD_CALLBACK_METHOD.adBreakDone,msg_callback_params:placementInfo})}};if(paramsFromGame.msg_ad_type===AD_TYPE.preroll){myLog("preroll")}else if(paramsFromGame.msg_ad_type===AD_TYPE.reward){callbackHandle[AD_CALLBACK_METHOD.beforeReward]=function(showAdFn){showAdFn();postMessageToIframe({msg_type:MESSAGE_TYPE.ad,msg_ad_type:paramsFromGame.msg_ad_type,msg_ad_name:paramsFromGame.msg_ad_name,msg_callback_function:AD_CALLBACK_METHOD.beforeReward})};callbackHandle[AD_CALLBACK_METHOD.adDismissed]=function(){postMessageToIframe({msg_type:MESSAGE_TYPE.ad,msg_ad_type:paramsFromGame.msg_ad_type,msg_ad_name:paramsFromGame.msg_ad_name,msg_callback_function:AD_CALLBACK_METHOD.adDismissed})};callbackHandle[AD_CALLBACK_METHOD.adViewed]=function(){postMessageToIframe({msg_type:MESSAGE_TYPE.ad,msg_ad_type:paramsFromGame.msg_ad_type,msg_ad_name:paramsFromGame.msg_ad_name,msg_callback_function:AD_CALLBACK_METHOD.adViewed})}}else{callbackHandle[AD_CALLBACK_METHOD.beforeAd]=()=>{postMessageToIframe({msg_type:MESSAGE_TYPE.ad,msg_ad_type:paramsFromGame.msg_ad_type,msg_ad_name:paramsFromGame.msg_ad_name,msg_callback_function:AD_CALLBACK_METHOD.beforeAd})};callbackHandle[AD_CALLBACK_METHOD.afterAd]=()=>{postMessageToIframe({msg_type:MESSAGE_TYPE.ad,msg_ad_type:paramsFromGame.msg_ad_type,msg_ad_name:paramsFromGame.msg_ad_name,msg_callback_function:AD_CALLBACK_METHOD.afterAd})}}if(MiniPlay.isReady()){MiniPlay.adBreak(callbackHandle)}else{MiniPlay.initAsync().then(()=>{MiniPlay.adBreak(callbackHandle)})}}}}if(!isModeStand()){if(isModeIFrameGame()){function postMessageToParent(params){function isWindow(obj){return obj&&typeof obj==="object"&&"window"in obj&&obj.window===obj}let parent=global.parent;if(!isWindow(parent)){parent=global.top}parent.postMessage(JSON.stringify(params))}global.addEventListener("message",e=>{try{if(e.data.toString().startsWith("{")){const paramsFromParent=JSON.parse(e.data);if(msg_type in paramsFromParent){handleParentMsg(paramsFromParent)}}}catch(e){myLog("game receiver message error: "+e)}})}else if(isModeIFrameIndex()){function configPostMessage(){const gameIframe=global.document.getElementById("miniplay_game_iframe");if(gameIframe){myLog("miniplay_game_iframe loaded");postMessageToIframe=function(params){gameIframe.contentWindow.postMessage(JSON.stringify(params))};global.addEventListener("message",e=>{try{if(e.data.toString().startsWith("{")){const paramsFromIframe=JSON.parse(e.data);if(msg_type in paramsFromIframe){handleIframeMsg(paramsFromIframe)}}}catch(e){myLog("index receiver message error: "+e)}})}}if(global.document.getElementById("miniplay_game_iframe")){myLog("configPostMessage direct");configPostMessage()}else{global.document.addEventListener("DOMContentLoaded",function(){myLog("configPostMessage wait DOMContentLoaded");configPostMessage()})}}}function notifyToIFrameReady(){postMessageToIframe({msg_type:MESSAGE_TYPE.states,msg_callback_params:{isReady:true}})}let ConfigLoadInstance=null;function loadLoadConfig(){if(ConfigLoadInstance==null){ConfigLoadInstance=fetch("miniplay.json").then(response=>{if(!response.ok){throw new Error("Network response was not ok")}myLog("load config success: "+response);return response.json()})}return ConfigLoadInstance}const GA4={gaId:null,_scriptUrl:"https://www.googletagmanager.com/gtag/js",_loadScriptInstance:null,loadScript:function(gaId){if(GA4._loadScriptInstance==null){GA4._loadScriptInstance=new Promise((resolve,reject)=>{const script=document.createElement("script");script.src=this._scriptUrl+"?id="+gaId;script.async=true;script.onload=resolve;script.onerror=reject;global.document.head.appendChild(script);myLog("end load ga sdk")})}return GA4._loadScriptInstance},isInit:()=>{return GA4._dataLayer!=null},_dataLayer:null,gtag:function(...params){if(GA4.isInit()){GA4._dataLayer.push(arguments);myLog(`GA4 push params: ${JSON.stringify(params)}`);myLog(`GA4 push arguments: ${JSON.stringify(arguments)}`)}else{myLog("_dataLayer is null , skip gtag: "+JSON.stringify(params))}},_initInstance:null,_initAsync:async function(){if(GA4._initInstance==null){let _loadScript=function(gaId){return GA4.loadScript(gaId).then(()=>{GA4._dataLayer=global.dataLayer=global.dataLayer||[];myLog("GA4 init success");GA4.gtag("js",new Date);GA4.gtag("config",gaId);return Promise.resolve()})};GA4._initInstance=loadLoadConfig().then(data=>{GA4.gaId=data.channel[data.target].ga.gid;return _loadScript(GA4.gaId)})}return GA4._initInstance},initAsync:async function(){return GA4._initAsync()}};const AdsenseHelp={_showBanner:function(bannerContain,test,bannerConfig,afgConfig){if(test){bannerContain.innerText="Test Banner"}else{const ins=global.document.createElement("ins");ins.style="display:inline-block;width:100%;height:100%";ins.setAttribute("class","adsbygoogle");ins.setAttribute("data-ad-client",afgConfig["data-ad-client"]);ins.setAttribute("data-ad-channel",afgConfig["data-ad-channel"]);ins.setAttribute("data-ad-slot",bannerConfig["data-ad-slot"]);ins.setAttribute("data-ad-format","format");ins.setAttribute("data-full-width-responsive","true");bannerContain.appendChild(ins);const script=global.document.createElement("script");script.text="(adsbygoogle = window.adsbygoogle || []).push({});";bannerContain.appendChild(script)}},configGameBanner:function(test,bannerConfig,afgConfig){if(bannerConfig.enable){const bannerContain=global.document.createElement("div");bannerContain.id="miniplay_game_banner";bannerContain.style="position: fixed;bottom: 0;left: 0;width: 100%;height: 70px;color: red; text-align: center;";global.document.body.appendChild(bannerContain);this._showBanner(bannerContain,test,bannerConfig,afgConfig);myLog("_showBanner success")}else{const gameIframe=global.document.getElementById("miniplay_game_iframe");myLog("_showBanner enable: false");if(gameIframe!==undefined&&gameIframe!=null){gameIframe.style="height:100%;bottom:0px";myLog("_showBanner set game iframe height 100%")}else{myLog("_showBanner skip set game iframe height 100% ")}}},generateAdBreakParams:function(params){let breakParams={type:params.type,name:params.name,adBreakDone:placementInfo=>{if(params.adBreakDone!==undefined&&params.adBreakDone!=null){params.adBreakDone(placementInfo)}}};if(params.type===AD_TYPE.preroll){}else if(params.type===AD_TYPE.reward){breakParams["beforeReward"]=function(showAdFn){showAdFn();if(params.beforeReward!==undefined&&params.beforeReward!=null){params.beforeReward(showAdFn)}};breakParams["adDismissed"]=function(){if(params.adDismissed!==undefined&&params.adDismissed!=null){params.adDismissed()}};breakParams["adViewed"]=function(){if(params.adViewed!==undefined&&params.adViewed!=null){params.adViewed()}}}else{breakParams["beforeAd"]=()=>{if(params.beforeAd!==undefined&&params.beforeAd!=null){params.beforeAd()}};breakParams["afterAd"]=()=>{if(params.afterAd!==undefined&&params.afterAd!=null){params.afterAd()}}}return breakParams},showOpenBanner:function(test,openBannerConfig,afgConfig){const bannerContain=global.document.getElementById("miniplay_index_open_banner");if(bannerContain){AdsenseHelp._showBanner(bannerContain,test,openBannerConfig,afgConfig);myLog("_showOpenBanner success")}else{myLog("can't find id: miniplay_open_banner,  skip _showOpenBanner")}}};const GoogleAd={_scriptUrl:"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",config:null,channelConfig:null,_loadScriptInstance:null,loadScript:function(){if(this._loadScriptInstance==null){this._loadScriptInstance=new Promise((resolve,reject)=>{const script=document.createElement("script");script.src=this._scriptUrl;script.async=true;script.setAttribute("data-ad-frequency-hint",GoogleAd.channelConfig["afg"]["data-ad-frequency-hint"]);let clientId=GoogleAd.config.test?"ca-pub-123456789":GoogleAd.channelConfig["afg"]["data-ad-client"];script.setAttribute("data-ad-client",clientId);let dataAdChannel=GoogleAd.channelConfig["afg"]["data-ad-channel"];if(dataAdChannel!==undefined&&dataAdChannel!=null){script.setAttribute("data-ad-channel",dataAdChannel)}if(GoogleAd.config.test){script.setAttribute("data-adbreak-test","on")}script.onload=resolve;script.onerror=reject;global.document.head.appendChild(script);myLog("end load google sdk")})}else{return this._loadScriptInstance}},_googleAdBreak:null,_googleAdConfig:null,isInit:function(){return this._googleAdBreak!=null&&this._googleAdConfig!=null&&this.config!=null},isReady:false,initAsync:async function(){if(!this.isInit()){try{await this.loadScript();global.adsbygoogle=global.adsbygoogle||[];GoogleAd._googleAdBreak=GoogleAd._googleAdConfig=function(o){myLog("call adsbygoogle.push(): "+JSON.stringify(o));global.adsbygoogle.push(o)};return Promise.resolve()}catch(e){return Promise.reject(new Error("load js error"))}}else{return Promise.resolve()}},startAsync:async function(){return new Promise((resolve,reject)=>{let config={sound:GoogleAd.channelConfig.afgConfig.sound,preloadAdBreaks:GoogleAd.channelConfig.afgConfig.preloadAdBreaks};if(GoogleAd.channelConfig.afgConfig.onReady){config["onReady"]=()=>{GoogleAd.isReady=true;myLog("onReady: true");notifyToIFrameReady();resolve()}}GoogleAd._googleAdConfig(config);GA4.initAsync().catch(e=>{myLog("GA4 init fail: "+e)})})},adBreak:function(params){let breakParams=AdsenseHelp.generateAdBreakParams(params);if(!this.isInit()){this.initAsync().then(()=>{this._googleAdBreak(breakParams)})}else{this._googleAdBreak(breakParams)}},showBanner:function(){if(!this.isInit()){this.initAsync().then(()=>{if(GoogleAd.channelConfig){AdsenseHelp.configGameBanner(GoogleAd.config.test,GoogleAd.channelConfig.banner,GoogleAd.channelConfig.afg)}else{myLog("_showBanner can't find config")}})}else{AdsenseHelp.configGameBanner(GoogleAd.config.test,GoogleAd.channelConfig.banner,GoogleAd.channelConfig.afg)}},gtag:function(...params){GA4.initAsync().then(()=>{GA4.gtag(...params)}).catch(()=>{myLog("gtag error")})}};const TranssionAd={_scriptUrl:"https://www.hippoobox.com/static/sdk/adsdk_1.8.0.0.js",config:null,channelConfig:null,_loadScriptInstance:null,loadScript:function(){if(this._loadScriptInstance==null){this._loadScriptInstance=new Promise((resolve,reject)=>{const script=document.createElement("script");script.src=this._scriptUrl;script.onload=resolve;script.onerror=reject;script.async=true;global.document.head.appendChild(script);myLog("end load transsion sdk")})}return this._loadScriptInstance},_transsionAdBreak:null,_transsionAdConfig:null,_h5sdk:null,isInit:function(){return this._h5sdk!=null&&this.config!=null},initAsync:async function(){if(!this.isInit()){try{await TranssionAd.loadScript();let _float={env:TranssionAd.config.test?"pre":""};let _ga={id:TranssionAd.channelConfig.ga.gid};let _getAdsenceConfig=c=>{let _adsence={client:TranssionAd.channelConfig.afg["data-ad-client"],"data-ad-frequency-hint":TranssionAd.channelConfig.afg["data-ad-frequency-hint"],"data-ad-channel":TranssionAd.channelConfig.afg["data-ad-channel"],callback:c};if(TranssionAd.config.test){_adsence["data-adbreak-test"]="on"}return _adsence};return new Promise((resolve,reject)=>{let appKey=TranssionAd.channelConfig["appKey"];global.h5sdk.init(appKey,"10vw","10vw","","",{float:_float,ga:_ga,adsence:_getAdsenceConfig(()=>{TranssionAd._h5sdk=global.h5sdk=global.h5sdk||[];TranssionAd._transsionAdBreak=TranssionAd._h5sdk.adBreak;TranssionAd._transsionAdConfig=TranssionAd._h5sdk.adConfig;global.adsbygoogle=global.adsbygoogle||[];resolve();global.h5sdk.athenaSend("game_start",TranssionAd.config["gameName"]);try{global.h5sdk.gameLoadingCompleted()}catch(e){print("璋冪敤h5sdk.gameLoadingCompleted澶辫触"+e)}})})})}catch(e){return Promise.reject(new Error("load js error:"+e))}}else{return Promise.resolve()}},isReady:false,startAsync:async function(){return new Promise((resolve,reject)=>{let config={sound:TranssionAd.channelConfig.afgConfig.sound,preloadAdBreaks:TranssionAd.channelConfig.afgConfig.preloadAdBreaks};if(TranssionAd.channelConfig.afgConfig.onReady){config["onReady"]=()=>{TranssionAd.isReady=true;myLog("onReady: true");notifyToIFrameReady();resolve()}}TranssionAd._transsionAdConfig(config)})},adBreak:function(params){let breakParams=AdsenseHelp.generateAdBreakParams(params);if(!this.isInit()){this.initAsync().then(()=>{this._transsionAdBreak(breakParams)})}else{this._transsionAdBreak(breakParams)}},showBanner:function(){if(!this.isInit()){this.initAsync().then(()=>{if(TranssionAd.channelConfig){AdsenseHelp.configGameBanner(TranssionAd.config.test,TranssionAd.channelConfig.banner,TranssionAd.channelConfig.afg)}else{myLog("_showBanner can't find config")}})}else{AdsenseHelp.configGameBanner(TranssionAd.config.test,TranssionAd.channelConfig.banner,TranssionAd.channelConfig.afg)}},gtag:function(...params){TranssionAd._h5sdk.athenaSend(...params)}};const VirtualAd={isReady:false};let adPlatform=null;async function getAdPlatform(){if(adPlatform!=null){return Promise.resolve(adPlatform)}else{return loadLoadConfig().then(data=>{if(data.landscape&&!Tools.isLandscape()){return Tools.showDialog().then(()=>{return Promise.resolve(data)})}else{return Promise.resolve(data)}}).then(data=>{if(data.target===PLATFORM.transsion){adPlatform=TranssionAd}else{adPlatform=GoogleAd}adPlatform.config=data;adPlatform.channelConfig=data.channel[data.target];return Promise.resolve(adPlatform)})}}const MiniPlay={startAsync:async()=>{let platformStart=adPlatform.startAsync();if(adPlatform.channelConfig.afgConfig.preroll){platformStart.then(()=>{MiniPlay.adBreak({type:AD_TYPE.preroll,name:AD_TYPE.preroll,adBreakDone:placementInfo=>{myLog("prerool placementInfo: "+JSON.stringify(placementInfo))}})})}else{myLog("Skip preroll")}adPlatform.showBanner();Tools.configBackButton();return Promise.resolve()},initAsync:async function(){if(isModeStand()||isModeIFrameIndex()){getAdPlatform().then(()=>{if(adPlatform.isInit()){return Promise.resolve()}else{return adPlatform.initAsync().then(()=>{let autoStart=adPlatform.config.autoStart;if(autoStart){MiniPlay.startAsync()}else{AdsenseHelp.showOpenBanner(adPlatform.config.test,adPlatform.channelConfig["openBanner"],adPlatform.channelConfig["afg"])}return Promise.resolve()})}})}else{return Promise.resolve()}},isReady:function(){if(isModeStand()||isModeIFrameIndex()){if(adPlatform!=null){return adPlatform.isReady}else{return false}}else{return VirtualAd.isReady}},adBreak:function(adBreakParams){myLog("adBreak",JSON.stringify(adBreakParams));if(isModeStand()||isModeIFrameIndex()){getAdPlatform().then(()=>{if(adPlatform.isInit()){adPlatform.adBreak(adBreakParams)}else{adPlatform.initAsync().then(()=>{adPlatform.adBreak(adBreakParams)})}}).catch(e=>{e.adBreakDone({breakStatus:"unknown"})})}else if(isModeIFrameGame()){postMessageToParent({msg_type:MESSAGE_TYPE.ad,msg_ad_type:adBreakParams["type"],msg_ad_name:adBreakParams["name"]});IFrameAdCallbackCache=adBreakParams}},showReward:function(success,fail){MiniPlay.adBreak({type:AD_TYPE.reward,name:AD_TYPE.reward,adBreakDone:placementInfo=>{if(placementInfo.breakStatus==="viewed"||placementInfo.breakStatus==="dismissed"){success(placementInfo.breakStatus)}else{fail(placementInfo.breakStatus)}}})},showRewardAsync:async function(){return new Promise((resolve,reject)=>{MiniPlay.showReward(s=>{resolve(s)},s=>{reject(s)})})},showNext:function(success,fail){MiniPlay.adBreak({type:AD_TYPE.next,name:AD_TYPE.next,adBreakDone:placementInfo=>{if(placementInfo.breakStatus==="viewed"){success()}else{fail(placementInfo.breakStatus)}}})},showNextAsync:async function(){return new Promise((resolve,reject)=>{MiniPlay.showNext(()=>{resolve()},s=>{reject(s)})})},gtag:function(...params){if(isModeStand()||isModeIFrameIndex()){getAdPlatform().then(()=>{adPlatform.gtag(...params)})}else if(isModeIFrameGame()){postMessageToParent({msg_type:MESSAGE_TYPE.gtag,msg_callback_params:params})}},prompt:function(msg,duration){Tools.prompt(msg,duration)},showBanner(){if(isModeIFrameIndex()){getAdPlatform().then(()=>{if(adPlatform.isInit()){adPlatform.showBanner()}else{adPlatform.initAsync().then(()=>{adPlatform.showBanner()})}}).catch(e=>{myLog("show banner error")})}else if(isModeIFrameGame()){postMessageToParent({msg_type:MESSAGE_TYPE.ad,msg_ad_type:AD_TYPE.banner})}},setLoadingProgress:function(percent){}};global.miniplay=MiniPlay})(this);