window.Laya=function(A){"use strict";class n{}n.animationInterval=50;n.isAntialias=false;n.isAlpha=false;n.premultipliedAlpha=true;n.isStencil=true;n.preserveDrawingBuffer=false;n.webGL2D_MeshAllocMaxMem=true;n.is2DPixelArtGame=false;n.useWebGL2=true;n.allowGPUInstanceDynamicBatch=true;n.useRetinalCanvas=false;window.Config=n;class O{static regClass(t){O.__classMap[t.name]=t}}O.Laya=null;O.Timer=null;O.WorkerLoader=null;O.Dragging=null;O.GraphicsBounds=null;O.Sprite=null;O.TextRender=null;O.TextAtlas=null;O.timer=null;O.systemTimer=null;O.startTimer=null;O.updateTimer=null;O.lateTimer=null;O.physicsTimer=null;O.stage=null;O.Loader=null;O.loader=null;O.TTFLoader=null;O.SoundManager=null;O.WebAudioSound=null;O.AudioSound=null;O.ShaderCompile=null;O.ClassUtils=null;O.SceneUtils=null;O.Context=null;O.Render=null;O.MouseManager=null;O.Text=null;O.Browser=null;O.WebGL=null;O.Pool=null;O.Utils=null;O.Graphics=null;O.Submit=null;O.Stage=null;O.Resource=null;O.__classMap={};class u{static getPoolBySign(t){return u._poolDic[t]||(u._poolDic[t]=[])}static clearBySign(t){if(u._poolDic[t])u._poolDic[t].length=0}static recover(t,e){if(e[u.POOLSIGN])return;e[u.POOLSIGN]=true;u.getPoolBySign(t).push(e)}static recoverByClass(t){if(t){var e=t["__className"]||t.constructor._$gid;if(e)u.recover(e,t)}}static _getClassSign(t){var e=t["__className"]||t["_$gid"];if(!e){t["_$gid"]=e=u._CLSID+"";u._CLSID++}return e}static createByClass(t){return u.getItemByClass(u._getClassSign(t),t)}static getItemByClass(t,e){if(!u._poolDic[t])return new e;var a=u.getPoolBySign(t);if(a.length){var i=a.pop();i[u.POOLSIGN]=false}else{i=new e}return i}static getItemByCreateFun(t,e,a=null){var i=u.getPoolBySign(t);var r=i.length?i.pop():e.call(a);r[u.POOLSIGN]=false;return r}static getItem(t){var e=u.getPoolBySign(t);var a=e.length?e.pop():null;if(a){a[u.POOLSIGN]=false}return a}}u._CLSID=0;u.POOLSIGN="__InPool";u._poolDic={};class U{static create(t){var e=u.getItemByClass("AlphaCmd",U);e.alpha=t;return e}recover(){u.recover("AlphaCmd",this)}run(t,e,a){t.alpha(this.alpha)}get cmdID(){return U.ID}}U.ID="Alpha";class k{static create(t,e,a,i,r,s,n){var o=u.getItemByClass("DrawCircleCmd",k);o.x=t;o.y=e;o.radius=a;o.fillColor=i;o.lineColor=r;o.lineWidth=s;o.vid=n;return o}recover(){this.fillColor=null;this.lineColor=null;u.recover("DrawCircleCmd",this)}run(t,e,a){t._drawCircle(this.x+e,this.y+a,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return k.ID}}k.ID="DrawCircle";class G{static create(t,e,a,i,r){var s=u.getItemByClass("DrawCurvesCmd",G);s.x=t;s.y=e;s.points=a;s.lineColor=i;s.lineWidth=r;return s}recover(){this.points=null;this.lineColor=null;u.recover("DrawCurvesCmd",this)}run(t,e,a){if(this.points)t.drawCurves(this.x+e,this.y+a,this.points,this.lineColor,this.lineWidth)}get cmdID(){return G.ID}}G.ID="DrawCurves";class H{static create(t,e,a,i,r){var s=u.getItemByClass("DrawImageCmd",H);s.texture=t;t._addReference();s.x=e;s.y=a;s.width=i;s.height=r;return s}recover(){this.texture&&this.texture._removeReference();this.texture=null;u.recover("DrawImageCmd",this)}run(t,e,a){if(this.texture)t.drawTexture(this.texture,this.x+e,this.y+a,this.width,this.height)}get cmdID(){return H.ID}}H.ID="DrawImage";class z{static create(t,e,a,i,r,s,n){var o=u.getItemByClass("DrawLineCmd",z);o.fromX=t;o.fromY=e;o.toX=a;o.toY=i;o.lineColor=r;o.lineWidth=s;o.vid=n;return o}recover(){u.recover("DrawLineCmd",this)}run(t,e,a){t._drawLine(e,a,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return z.ID}}z.ID="DrawLine";class X{static create(t,e,a,i,r,s){var n=u.getItemByClass("DrawLinesCmd",X);n.x=t;n.y=e;n.points=a;n.lineColor=i;n.lineWidth=r;n.vid=s;return n}recover(){this.points=null;this.lineColor=null;u.recover("DrawLinesCmd",this)}run(t,e,a){this.points&&t._drawLines(this.x+e,this.y+a,this.points,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return X.ID}}X.ID="DrawLines";class Y{static create(t,e,a,i,r){var s=u.getItemByClass("DrawPathCmd",Y);s.x=t;s.y=e;s.paths=a;s.brush=i;s.pen=r;return s}recover(){this.paths=null;this.brush=null;this.pen=null;u.recover("DrawPathCmd",this)}run(t,e,a){this.paths&&t._drawPath(this.x+e,this.y+a,this.paths,this.brush,this.pen)}get cmdID(){return Y.ID}}Y.ID="DrawPath";class j{static create(t,e,a,i,r,s,n,o,l){var _=u.getItemByClass("DrawPieCmd",j);_.x=t;_.y=e;_.radius=a;_._startAngle=i;_._endAngle=r;_.fillColor=s;_.lineColor=n;_.lineWidth=o;_.vid=l;return _}recover(){this.fillColor=null;this.lineColor=null;u.recover("DrawPieCmd",this)}run(t,e,a){t._drawPie(this.x+e,this.y+a,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return j.ID}get startAngle(){return this._startAngle*180/Math.PI}set startAngle(t){this._startAngle=t*Math.PI/180}get endAngle(){return this._endAngle*180/Math.PI}set endAngle(t){this._endAngle=t*Math.PI/180}}j.ID="DrawPie";class q{static create(t,e,a,i,r,s,n,o){var l=u.getItemByClass("DrawPolyCmd",q);l.x=t;l.y=e;l.points=a;l.fillColor=i;l.lineColor=r;l.lineWidth=s;l.isConvexPolygon=n;l.vid=o;return l}recover(){this.points=null;this.fillColor=null;this.lineColor=null;u.recover("DrawPolyCmd",this)}run(t,e,a){this.points&&t._drawPoly(this.x+e,this.y+a,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)}get cmdID(){return q.ID}}q.ID="DrawPoly";class Z{static create(t,e,a,i,r,s,n){var o=u.getItemByClass("DrawRectCmd",Z);o.x=t;o.y=e;o.width=a;o.height=i;o.fillColor=r;o.lineColor=s;o.lineWidth=n;return o}recover(){this.fillColor=null;this.lineColor=null;u.recover("DrawRectCmd",this)}run(t,e,a){t.drawRect(this.x+e,this.y+a,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)}get cmdID(){return Z.ID}}Z.ID="DrawRect";class L{constructor(t=1,e=0,a=0,i=1,r=0,s=0,n=0){this._bTransform=false;if(L._createFun!=null){return L._createFun(t,e,a,i,r,s,n)}this.a=t;this.b=e;this.c=a;this.d=i;this.tx=r;this.ty=s;this._checkTransform()}identity(){this.a=this.d=1;this.b=this.tx=this.ty=this.c=0;this._bTransform=false;return this}_checkTransform(){return this._bTransform=this.a!==1||this.b!==0||this.c!==0||this.d!==1}setTranslate(t,e){this.tx=t;this.ty=e;return this}translate(t,e){this.tx+=t;this.ty+=e;return this}scale(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;this._bTransform=true;return this}rotate(t){var e=Math.cos(t);var a=Math.sin(t);var i=this.a;var r=this.c;var s=this.tx;this.a=i*e-this.b*a;this.b=i*a+this.b*e;this.c=r*e-this.d*a;this.d=r*a+this.d*e;this.tx=s*e-this.ty*a;this.ty=s*a+this.ty*e;this._bTransform=true;return this}skew(t,e){var a=Math.tan(t);var i=Math.tan(e);var r=this.a;var s=this.b;this.a+=i*this.c;this.b+=i*this.d;this.c+=a*r;this.d+=a*s;return this}invertTransformPoint(t){var e=this.a;var a=this.b;var i=this.c;var r=this.d;var s=this.tx;var n=e*r-a*i;var o=r/n;var l=-a/n;var _=-i/n;var h=e/n;var x=(i*this.ty-r*s)/n;var c=-(e*this.ty-a*s)/n;return t.setTo(o*t.x+_*t.y+x,l*t.x+h*t.y+c)}transformPoint(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)}transformPointN(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)}getScaleX(){return this.b===0?this.a:Math.sqrt(this.a*this.a+this.b*this.b)}getScaleY(){return this.c===0?this.d:Math.sqrt(this.c*this.c+this.d*this.d)}invert(){var t=this.a;var e=this.b;var a=this.c;var i=this.d;var r=this.tx;var s=t*i-e*a;this.a=i/s;this.b=-e/s;this.c=-a/s;this.d=t/s;this.tx=(a*this.ty-i*r)/s;this.ty=-(t*this.ty-e*r)/s;return this}setTo(t,e,a,i,r,s){this.a=t,this.b=e,this.c=a,this.d=i,this.tx=r,this.ty=s;return this}concat(t){var e=this.a;var a=this.c;var i=this.tx;this.a=e*t.a+this.b*t.c;this.b=e*t.b+this.b*t.d;this.c=a*t.a+this.d*t.c;this.d=a*t.b+this.d*t.d;this.tx=i*t.a+this.ty*t.c+t.tx;this.ty=i*t.b+this.ty*t.d+t.ty;return this}static mul(t,e,a){var i=t.a,r=t.b,s=t.c,n=t.d,o=t.tx,l=t.ty;var _=e.a,h=e.b,x=e.c,c=e.d,d=e.tx,u=e.ty;if(h!==0||x!==0){a.a=i*_+r*x;a.b=i*h+r*c;a.c=s*_+n*x;a.d=s*h+n*c;a.tx=_*o+x*l+d;a.ty=h*o+c*l+u}else{a.a=i*_;a.b=r*c;a.c=s*_;a.d=n*c;a.tx=_*o+d;a.ty=c*l+u}return a}static mul16(t,e,a){var i=t.a,r=t.b,s=t.c,n=t.d,o=t.tx,l=t.ty;var _=e.a,h=e.b,x=e.c,c=e.d,d=e.tx,u=e.ty;if(h!==0||x!==0){a[0]=i*_+r*x;a[1]=i*h+r*c;a[4]=s*_+n*x;a[5]=s*h+n*c;a[12]=_*o+x*l+d;a[13]=h*o+c*l+u}else{a[0]=i*_;a[1]=r*c;a[4]=s*_;a[5]=n*c;a[12]=_*o+d;a[13]=c*l+u}return a}scaleEx(t,e){var a=this.a,i=this.b,r=this.c,s=this.d;if(i!==0||r!==0){this.a=t*a;this.b=t*i;this.c=e*r;this.d=e*s}else{this.a=t*a;this.b=0*s;this.c=0*a;this.d=e*s}this._bTransform=true}rotateEx(t){var e=Math.cos(t);var a=Math.sin(t);var i=this.a,r=this.b,s=this.c,n=this.d;if(r!==0||s!==0){this.a=e*i+a*s;this.b=e*r+a*n;this.c=-a*i+e*s;this.d=-a*r+e*n}else{this.a=e*i;this.b=a*n;this.c=-a*i;this.d=e*n}this._bTransform=true}clone(){var t=L.create();t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;t._bTransform=this._bTransform;return t}copyTo(t){t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;t._bTransform=this._bTransform;return t}toString(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty}destroy(){this.recover()}recover(){u.recover("Matrix",this.identity())}static create(){return u.getItemByClass("Matrix",L)}}L.EMPTY=new L;L.TEMP=new L;L._createFun=null;class K{constructor(t=0,e=0){this.x=t;this.y=e}static create(){return u.getItemByClass("Point",K)}setTo(t,e){this.x=t;this.y=e;return this}reset(){this.x=this.y=0;return this}recover(){u.recover("Point",this.reset())}distance(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))}toString(){return this.x+","+this.y}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e;this.y*=e}}copy(t){return this.setTo(t.x,t.y)}}K.TEMP=new K;K.EMPTY=new K;class R{constructor(t=0,e=0,a=0,i=0){this.x=t;this.y=e;this.width=a;this.height=i}get right(){return this.x+this.width}get bottom(){return this.y+this.height}setTo(t,e,a,i){this.x=t;this.y=e;this.width=a;this.height=i;return this}reset(){this.x=this.y=this.width=this.height=0;return this}recover(){if(this==R.TEMP||this==R.EMPTY){console.log("recover Temp or Empty:",this);return}u.recover("Rectangle",this.reset())}static create(){return u.getItemByClass("Rectangle",R)}copyFrom(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height;return this}contains(t,e){if(this.width<=0||this.height<=0)return false;if(t>=this.x&&t<this.right){if(e>=this.y&&e<this.bottom){return true}}return false}intersects(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}intersection(t,e=null){if(!this.intersects(t))return null;e||(e=new R);e.x=Math.max(this.x,t.x);e.y=Math.max(this.y,t.y);e.width=Math.min(this.right,t.right)-e.x;e.height=Math.min(this.bottom,t.bottom)-e.y;return e}union(t,e=null){e||(e=new R);this.clone(e);if(t.width<=0||t.height<=0)return e;e.addPoint(t.x,t.y);e.addPoint(t.right,t.bottom);return this}clone(t=null){t||(t=new R);t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t}toString(){return this.x+","+this.y+","+this.width+","+this.height}equals(t){if(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)return false;return true}addPoint(t,e){this.x>t&&(this.width+=this.x-t,this.x=t);this.y>e&&(this.height+=this.y-e,this.y=e);if(this.width<t-this.x)this.width=t-this.x;if(this.height<e-this.y)this.height=e-this.y;return this}_getBoundPoints(){var t=R._temB;t.length=0;if(this.width==0||this.height==0)return t;t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height);return t}static _getBoundPointS(t,e,a,i){var r=R._temA;r.length=0;if(a==0||i==0)return r;r.push(t,e,t+a,e,t,e+i,t+a,e+i);return r}static _getWrapRec(t,e=null){if(!t||t.length<1)return e?e.setTo(0,0,0,0):R.TEMP.setTo(0,0,0,0);e=e?e:R.create();var a,i=t.length,r,s,n,o,l=K.TEMP;r=n=99999;s=o=-r;for(a=0;a<i;a+=2){l.x=t[a];l.y=t[a+1];r=r<l.x?r:l.x;n=n<l.y?n:l.y;s=s>l.x?s:l.x;o=o>l.y?o:l.y}return e.setTo(r,n,s-r,o-n)}isEmpty(){if(this.width<=0||this.height<=0)return true;return false}}R.EMPTY=new R;R.TEMP=new R;R._temB=[];R._temA=[];class f{}f.ARRAY_BUFFER_TYPE_DATA=0;f.ARRAY_BUFFER_TYPE_CMD=1;f.ARRAY_BUFFER_REF_REFERENCE=0;f.ARRAY_BUFFER_REF_COPY=1;f.UPLOAD_SHADER_UNIFORM_TYPE_ID=0;f.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1;class p{static __init__(){var t=f.instance;p._depthFunc=t.LESS;p._blendEquation=t.FUNC_ADD;p._blendEquationRGB=t.FUNC_ADD;p._blendEquationAlpha=t.FUNC_ADD;p._sFactor=t.ONE;p._dFactor=t.ZERO;p._sFactorAlpha=t.ONE;p._dFactorAlpha=t.ZERO;p._activedTextureID=t.TEXTURE0;p._glTextureIDs=[t.TEXTURE0,t.TEXTURE1,t.TEXTURE2,t.TEXTURE3,t.TEXTURE4,t.TEXTURE5,t.TEXTURE6,t.TEXTURE7]}static useProgram(t,e){if(p._useProgram===e)return false;t.useProgram(e);p._useProgram=e;return true}static setDepthTest(t,e){e!==p._depthTest&&(p._depthTest=e,e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST))}static setDepthMask(t,e){e!==p._depthMask&&(p._depthMask=e,t.depthMask(e))}static setDepthFunc(t,e){e!==p._depthFunc&&(p._depthFunc=e,t.depthFunc(e))}static setBlend(t,e){e!==p._blend&&(p._blend=e,e?t.enable(t.BLEND):t.disable(t.BLEND))}static setBlendEquation(t,e){if(e!==p._blendEquation){p._blendEquation=e;p._blendEquationRGB=p._blendEquationAlpha=null;t.blendEquation(e)}}static setBlendEquationSeparate(t,e,a){if(e!==p._blendEquationRGB||a!==p._blendEquationAlpha){p._blendEquationRGB=e;p._blendEquationAlpha=a;p._blendEquation=null;t.blendEquationSeparate(e,a)}}static setBlendFunc(t,e,a,i=false){if(i||e!==p._sFactor||a!==p._dFactor){p._sFactor=e;p._dFactor=a;p._sFactorRGB=null;p._dFactorRGB=null;p._sFactorAlpha=null;p._dFactorAlpha=null;t.blendFunc(e,a)}}static setBlendFuncSeperate(t,e,a,i,r){if(e!==p._sFactorRGB||a!==p._dFactorRGB||i!==p._sFactorAlpha||r!==p._dFactorAlpha){p._sFactorRGB=e;p._dFactorRGB=a;p._sFactorAlpha=i;p._dFactorAlpha=r;p._sFactor=null;p._dFactor=null;t.blendFuncSeparate(e,a,i,r)}}static setCullFace(t,e){e!==p._cullFace&&(p._cullFace=e,e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE))}static setFrontFace(t,e){e!==p._frontFace&&(p._frontFace=e,t.frontFace(e))}static activeTexture(t,e){if(p._activedTextureID!==e){t.activeTexture(e);p._activedTextureID=e}}static bindTexture(t,e,a){if(p._activeTextures[p._activedTextureID-t.TEXTURE0]!==a){t.bindTexture(e,a);p._activeTextures[p._activedTextureID-t.TEXTURE0]=a}}static __init_native(){if(!O.Render.supportWebGLPlusRendering)return;var t=p;t.activeTexture=t.activeTextureForNative;t.bindTexture=t.bindTextureForNative}static useProgramForNative(t,e){t.useProgram(e);return true}static setDepthTestForNative(t,e){if(e)t.enable(t.DEPTH_TEST);else t.disable(t.DEPTH_TEST)}static setDepthMaskForNative(t,e){t.depthMask(e)}static setDepthFuncForNative(t,e){t.depthFunc(e)}static setBlendForNative(t,e){if(e)t.enable(t.BLEND);else t.disable(t.BLEND)}static setBlendFuncForNative(t,e,a){t.blendFunc(e,a)}static setCullFaceForNative(t,e){if(e)t.enable(t.CULL_FACE);else t.disable(t.CULL_FACE)}static setFrontFaceForNative(t,e){t.frontFace(e)}static activeTextureForNative(t,e){t.activeTexture(e)}static bindTextureForNative(t,e,a){t.bindTexture(e,a)}static bindVertexArrayForNative(t,e){t.bindVertexArray(e)}}p._activeTextures=new Array(8);p._useProgram=null;p._depthTest=true;p._depthMask=true;p._blend=false;p._cullFace=false;p.mainContext=null;class Q{constructor(t=null,e=null,a=null,i=false){this.once=false;this._id=0;this.setTo(t,e,a,i)}setTo(t,e,a,i=false){this._id=Q._gid++;this.caller=t;this.method=e;this.args=a;this.once=i;return this}run(){if(this.method==null)return null;var t=this._id;var e=this.method.apply(this.caller,this.args);this._id===t&&this.once&&this.recover();return e}runWith(t){if(this.method==null)return null;var e=this._id;if(t==null)var a=this.method.apply(this.caller,this.args);else if(!this.args&&!t.unshift)a=this.method.call(this.caller,t);else if(this.args)a=this.method.apply(this.caller,this.args.concat(t));else a=this.method.apply(this.caller,t);this._id===e&&this.once&&this.recover();return a}clear(){this.caller=null;this.method=null;this.args=null;return this}recover(){if(this._id>0){this._id=0;Q._pool.push(this.clear())}}static create(t,e,a=null,i=true){if(Q._pool.length)return Q._pool.pop().setTo(t,e,a,i);return new Q(t,e,a,i)}}Q._pool=[];Q._gid=1;class e{hasListener(t){var e=this._events&&this._events[t];return!!e}event(t,e=null){if(!this._events||!this._events[t])return false;var a=this._events[t];if(a.run){if(a.once)delete this._events[t];e!=null?a.runWith(e):a.run()}else{for(var i=0,r=a.length;i<r;i++){var s=a[i];if(s){e!=null?s.runWith(e):s.run()}if(!s||s.once){a.splice(i,1);i--;r--}}if(a.length===0&&this._events)delete this._events[t]}return true}on(t,e,a,i=null){return this._createListener(t,e,a,i,false)}once(t,e,a,i=null){return this._createListener(t,e,a,i,true)}_createListener(t,e,a,i,r,s=true){s&&this.off(t,e,a,r);var n=J.create(e||this,a,i,r);this._events||(this._events={});var o=this._events;if(!o[t])o[t]=n;else{if(!o[t].run)o[t].push(n);else o[t]=[o[t],n]}return this}off(t,e,a,i=false){if(!this._events||!this._events[t])return this;var r=this._events[t];if(r!=null){if(r.run){if((!e||r.caller===e)&&(a==null||r.method===a)&&(!i||r.once)){delete this._events[t];r.recover()}}else{var s=0;for(var n=0,o=r.length;n<o;n++){var l=r[n];if(!l){s++;continue}if(l&&(!e||l.caller===e)&&(a==null||l.method===a)&&(!i||l.once)){s++;r[n]=null;l.recover()}}if(s===o)delete this._events[t]}}return this}offAll(t=null){var e=this._events;if(!e)return this;if(t){this._recoverHandlers(e[t]);delete e[t]}else{for(var a in e){this._recoverHandlers(e[a])}this._events=null}return this}offAllCaller(t){if(t&&this._events){for(var e in this._events){this.off(e,t,null)}}return this}_recoverHandlers(t){if(!t)return;if(t.run){t.recover()}else{for(var e=t.length-1;e>-1;e--){if(t[e]){t[e].recover();t[e]=null}}}}isMouseEvent(t){return e.MOUSE_EVENTS[t]||false}}e.MOUSE_EVENTS={rightmousedown:true,rightmouseup:true,rightclick:true,mousedown:true,mouseup:true,mousemove:true,mouseover:true,mouseout:true,click:true,doubleclick:true};class J extends Q{constructor(t,e,a,i){super(t,e,a,i)}recover(){if(this._id>0){this._id=0;J._pool.push(this.clear())}}static create(t,e,a=null,i=true){if(J._pool.length)return J._pool.pop().setTo(t,e,a,i);return new J(t,e,a,i)}}J._pool=[];class I{constructor(t){this._url=I.formatURL(t);this._path=I.getPath(t)}get url(){return this._url}get path(){return this._path}static set basePath(t){I._basePath=O.Laya._getUrlPath();I._basePath=I.formatURL(t)}static get basePath(){return I._basePath}static formatURL(t){if(!t)return"null path";if(t.indexOf(":")>0)return t;if(I.customFormat!=null)t=I.customFormat(t);if(t.indexOf(":")>0)return t;var e=t.charAt(0);if(e==="."){return I._formatRelativePath(I._basePath+t)}else if(e==="~"){return I.rootPath+t.substring(1)}else if(e==="d"){if(t.indexOf("data:image")===0)return t}else if(e==="/"){return t}return I._basePath+t}static _formatRelativePath(t){var e=t.split("/");for(var a=0,i=e.length;a<i;a++){if(e[a]==".."){e.splice(a-1,2);a-=2}}return e.join("/")}static getPath(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""}static getFileName(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t}static getAdptedFilePath(t){if(!I.exportSceneToJson||!t)return t;var e,a;a=I._adpteTypeList.length;var i;for(e=0;e<a;e++){i=I._adpteTypeList[e];t=t.replace(i[0],i[1])}return t}}I.version={};I.exportSceneToJson=false;I._basePath="";I.rootPath="";I.customFormat=function(t){var e=I.version[t];if(!window.conch&&e)t+="?v="+e;return t};I._adpteTypeList=[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]];class $ extends e{constructor(){super();this._id=0;this._url=null;this._cpuMemory=0;this._gpuMemory=0;this._destroyed=false;this._referenceCount=0;this.lock=false;this.name=null;this._id=++$._uniqueIDCounter;this._destroyed=false;this._referenceCount=0;$._idResourcesMap[this.id]=this;this.lock=false}static get cpuMemory(){return $._cpuMemory}static get gpuMemory(){return $._gpuMemory}static _addCPUMemory(t){$._cpuMemory+=t}static _addGPUMemory(t){$._gpuMemory+=t}static _addMemory(t,e){$._cpuMemory+=t;$._gpuMemory+=e}static getResourceByID(t){return $._idResourcesMap[t]}static getResourceByURL(t,e=0){return $._urlResourcesMap[t][e]}static destroyUnusedResources(){for(var t in $._idResourcesMap){var e=$._idResourcesMap[t];if(!e.lock&&e._referenceCount===0)e.destroy()}}get id(){return this._id}get url(){return this._url}get cpuMemory(){return this._cpuMemory}get gpuMemory(){return this._gpuMemory}get destroyed(){return this._destroyed}get referenceCount(){return this._referenceCount}_setCPUMemory(t){var e=t-this._cpuMemory;this._cpuMemory=t;$._addCPUMemory(e)}_setGPUMemory(t){var e=t-this._gpuMemory;this._gpuMemory=t;$._addGPUMemory(e)}_setCreateURL(t){t=I.formatURL(t);if(this._url!==t){var e;if(this._url){e=$._urlResourcesMap[this._url];e.splice(e.indexOf(this),1);e.length===0&&delete $._urlResourcesMap[this._url]}if(t){e=$._urlResourcesMap[t];e||($._urlResourcesMap[t]=e=[]);e.push(this)}this._url=t}}_addReference(t=1){this._referenceCount+=t}_removeReference(t=1){this._referenceCount-=t}_clearReference(){this._referenceCount=0}_recoverResource(){}_disposeResource(){}_activeResource(){}destroy(){if(this._destroyed)return;this._destroyed=true;this.lock=false;this._disposeResource();delete $._idResourcesMap[this.id];var t;if(this._url){t=$._urlResourcesMap[this._url];if(t){t.splice(t.indexOf(this),1);t.length===0&&delete $._urlResourcesMap[this._url]}var e=O.Loader.loadedMap[this._url];e==this&&delete O.Loader.loadedMap[this._url]}}}$._uniqueIDCounter=0;$._idResourcesMap={};$._urlResourcesMap={};$._cpuMemory=0;$._gpuMemory=0;class a extends ${constructor(){super();this._width=-1;this._height=-1}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}_getSource(){throw"Bitmap: must override it."}}(function(t){t[t["Point"]=0]="Point";t[t["Bilinear"]=1]="Bilinear";t[t["Trilinear"]=2]="Trilinear"})(A.FilterMode||(A.FilterMode={}));(function(t){t[t["R8G8B8"]=0]="R8G8B8";t[t["R8G8B8A8"]=1]="R8G8B8A8";t[t["R5G6B5"]=16]="R5G6B5";t[t["Alpha8"]=2]="Alpha8";t[t["DXT1"]=3]="DXT1";t[t["DXT5"]=4]="DXT5";t[t["ETC1RGB"]=5]="ETC1RGB";t[t["PVRTCRGB_2BPPV"]=9]="PVRTCRGB_2BPPV";t[t["PVRTCRGBA_2BPPV"]=10]="PVRTCRGBA_2BPPV";t[t["PVRTCRGB_4BPPV"]=11]="PVRTCRGB_4BPPV";t[t["PVRTCRGBA_4BPPV"]=12]="PVRTCRGBA_4BPPV";t[t["R32G32B32A32"]=15]="R32G32B32A32";t[t["R16G16B16A16"]=17]="R16G16B16A16"})(A.TextureFormat||(A.TextureFormat={}));(function(t){t[t["Repeat"]=0]="Repeat";t[t["Clamp"]=1]="Clamp"})(A.WarpMode||(A.WarpMode={}));class i extends a{constructor(t,e){super();this._wrapModeU=A.WarpMode.Repeat;this._wrapModeV=A.WarpMode.Repeat;this._filterMode=A.FilterMode.Bilinear;this._readyed=false;this._width=-1;this._height=-1;this._format=t;this._mipmap=e;this._anisoLevel=1;this._glTexture=f.instance.createTexture()}get mipmap(){return this._mipmap}get format(){return this._format}get wrapModeU(){return this._wrapModeU}set wrapModeU(t){if(this._wrapModeU!==t){this._wrapModeU=t;this._width!==-1&&this._setWarpMode(f.instance.TEXTURE_WRAP_S,t)}}get wrapModeV(){return this._wrapModeV}set wrapModeV(t){if(this._wrapModeV!==t){this._wrapModeV=t;this._height!==-1&&this._setWarpMode(f.instance.TEXTURE_WRAP_T,t)}}get filterMode(){return this._filterMode}set filterMode(t){if(t!==this._filterMode){this._filterMode=t;this._width!==-1&&this._height!==-1&&this._setFilterMode(t)}}get anisoLevel(){return this._anisoLevel}set anisoLevel(t){if(t!==this._anisoLevel){this._anisoLevel=Math.max(1,Math.min(16,t));this._width!==-1&&this._height!==-1&&this._setAnisotropy(t)}}get mipmapCount(){return this._mipmapCount}get defaulteTexture(){throw"BaseTexture:must override it."}_getFormatByteCount(){switch(this._format){case A.TextureFormat.R8G8B8:return 3;case A.TextureFormat.R8G8B8A8:return 4;case A.TextureFormat.R5G6B5:return 1;case A.TextureFormat.Alpha8:return 1;case A.TextureFormat.R16G16B16A16:return 2;case A.TextureFormat.R32G32B32A32:return 4;default:throw"Texture2D: unknown format."}}_isPot(t){return(t&t-1)===0}_getGLFormat(){var t;var e=f.instance;var a=f.layaGPUInstance;switch(this._format){case A.TextureFormat.R8G8B8:case A.TextureFormat.R5G6B5:t=e.RGB;break;case A.TextureFormat.R8G8B8A8:t=e.RGBA;break;case A.TextureFormat.Alpha8:t=e.ALPHA;break;case A.TextureFormat.R32G32B32A32:case A.TextureFormat.R16G16B16A16:t=e.RGBA;break;case A.TextureFormat.DXT1:if(a._compressedTextureS3tc)t=a._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;else throw"BaseTexture: not support DXT1 format.";break;case A.TextureFormat.DXT5:if(a._compressedTextureS3tc)t=a._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw"BaseTexture: not support DXT5 format.";break;case A.TextureFormat.ETC1RGB:if(a._compressedTextureEtc1)t=a._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;else throw"BaseTexture: not support ETC1RGB format.";break;case A.TextureFormat.PVRTCRGB_2BPPV:if(a._compressedTexturePvrtc)t=a._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGB_2BPPV format.";break;case A.TextureFormat.PVRTCRGBA_2BPPV:if(a._compressedTexturePvrtc)t=a._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";break;case A.TextureFormat.PVRTCRGB_4BPPV:if(a._compressedTexturePvrtc)t=a._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGB_4BPPV format.";break;case A.TextureFormat.PVRTCRGBA_4BPPV:if(a._compressedTexturePvrtc)t=a._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";break;default:throw"BaseTexture: unknown texture format."}return t}_setFilterMode(t){var e=f.instance;p.bindTexture(e,this._glTextureType,this._glTexture);switch(t){case A.FilterMode.Point:if(this._mipmap)e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST);else e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(this._glTextureType,e.TEXTURE_MAG_FILTER,e.NEAREST);break;case A.FilterMode.Bilinear:if(this._mipmap)e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST);else e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(this._glTextureType,e.TEXTURE_MAG_FILTER,e.LINEAR);break;case A.FilterMode.Trilinear:if(this._mipmap)e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);else e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(this._glTextureType,e.TEXTURE_MAG_FILTER,e.LINEAR);break;default:throw new Error("BaseTexture:unknown filterMode value.")}}_setWarpMode(t,e){var a=f.instance;p.bindTexture(a,this._glTextureType,this._glTexture);if(this._isPot(this._width)&&this._isPot(this._height)){switch(e){case A.WarpMode.Repeat:a.texParameteri(this._glTextureType,t,a.REPEAT);break;case A.WarpMode.Clamp:a.texParameteri(this._glTextureType,t,a.CLAMP_TO_EDGE);break}}else{a.texParameteri(this._glTextureType,t,a.CLAMP_TO_EDGE)}}_setAnisotropy(t){var e=f.layaGPUInstance._extTextureFilterAnisotropic;if(e){t=Math.max(t,1);var a=f.instance;p.bindTexture(a,this._glTextureType,this._glTexture);t=Math.min(a.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t);a.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}_disposeResource(){if(this._glTexture){f.instance.deleteTexture(this._glTexture);this._glTexture=null;this._setGPUMemory(0)}}_getSource(){if(this._readyed)return this._glTexture;else return null}generateMipmap(){if(this._isPot(this.width)&&this._isPot(this.height))f.instance.generateMipmap(this._glTextureType)}}i._rgbmRange=5;i.FORMAT_R8G8B8=0;i.FORMAT_R8G8B8A8=1;i.FORMAT_ALPHA8=2;i.FORMAT_DXT1=3;i.FORMAT_DXT5=4;i.FORMAT_ETC1RGB=5;i.FORMAT_PVRTCRGB_2BPPV=9;i.FORMAT_PVRTCRGBA_2BPPV=10;i.FORMAT_PVRTCRGB_4BPPV=11;i.FORMAT_PVRTCRGBA_4BPPV=12;i.RENDERTEXTURE_FORMAT_RGBA_HALF_FLOAT=14;i.FORMAT_R32G32B32A32=15;i.FORMAT_DEPTH_16=0;i.FORMAT_STENCIL_8=1;i.FORMAT_DEPTHSTENCIL_16_8=2;i.FORMAT_DEPTHSTENCIL_NONE=3;i.FILTERMODE_POINT=0;i.FILTERMODE_BILINEAR=1;i.FILTERMODE_TRILINEAR=2;i.WARPMODE_REPEAT=0;i.WARPMODE_CLAMP=1;class tt{constructor(t=null){this._xd_=true;this._allocated_=8;this._pos_=0;this._length=0;if(t){this._u8d_=new Uint8Array(t);this._d_=new DataView(this._u8d_.buffer);this._length=this._d_.byteLength}else{this._resizeBuffer(this._allocated_)}}static getSystemEndian(){if(!tt._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,true);tt._sysEndian=new Int16Array(t)[0]===256?tt.LITTLE_ENDIAN:tt.BIG_ENDIAN}return tt._sysEndian}get buffer(){var t=this._d_.buffer;if(t.byteLength===this._length)return t;return t.slice(0,this._length)}get endian(){return this._xd_?tt.LITTLE_ENDIAN:tt.BIG_ENDIAN}set endian(t){this._xd_=t===tt.LITTLE_ENDIAN}set length(t){if(this._allocated_<t)this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,this._allocated_*2)));else if(this._allocated_>t)this._resizeBuffer(this._allocated_=t);this._length=t}get length(){return this._length}_resizeBuffer(e){try{var t=new Uint8Array(e);if(this._u8d_!=null){if(this._u8d_.length<=e)t.set(this._u8d_);else t.set(this._u8d_.subarray(0,e))}this._u8d_=t;this._d_=new DataView(t.buffer)}catch(t){throw"Invalid typed array length:"+e}}getString(){return this.readString()}readString(){return this._rUTF(this.getUint16())}getFloat32Array(t,e){return this.readFloat32Array(t,e)}readFloat32Array(t,e){var a=t+e;a=a>this._length?this._length:a;var i=new Float32Array(this._d_.buffer.slice(t,a));this._pos_=a;return i}getUint8Array(t,e){return this.readUint8Array(t,e)}readUint8Array(t,e){var a=t+e;a=a>this._length?this._length:a;var i=new Uint8Array(this._d_.buffer.slice(t,a));this._pos_=a;return i}getInt16Array(t,e){return this.readInt16Array(t,e)}readInt16Array(t,e){var a=t+e;a=a>this._length?this._length:a;var i=new Int16Array(this._d_.buffer.slice(t,a));this._pos_=a;return i}getFloat32(){return this.readFloat32()}readFloat32(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);this._pos_+=4;return t}getFloat64(){return this.readFloat64()}readFloat64(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);this._pos_+=8;return t}writeFloat32(t){this._ensureWrite(this._pos_+4);this._d_.setFloat32(this._pos_,t,this._xd_);this._pos_+=4}writeFloat64(t){this._ensureWrite(this._pos_+8);this._d_.setFloat64(this._pos_,t,this._xd_);this._pos_+=8}getInt32(){return this.readInt32()}readInt32(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);this._pos_+=4;return t}getUint32(){return this.readUint32()}readUint32(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);this._pos_+=4;return t}writeInt32(t){this._ensureWrite(this._pos_+4);this._d_.setInt32(this._pos_,t,this._xd_);this._pos_+=4}writeUint32(t){this._ensureWrite(this._pos_+4);this._d_.setUint32(this._pos_,t,this._xd_);this._pos_+=4}getInt16(){return this.readInt16()}readInt16(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);this._pos_+=2;return t}getUint16(){return this.readUint16()}readUint16(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);this._pos_+=2;return t}writeUint16(t){this._ensureWrite(this._pos_+2);this._d_.setUint16(this._pos_,t,this._xd_);this._pos_+=2}writeInt16(t){this._ensureWrite(this._pos_+2);this._d_.setInt16(this._pos_,t,this._xd_);this._pos_+=2}getUint8(){return this.readUint8()}readUint8(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]}writeUint8(t){this._ensureWrite(this._pos_+1);this._d_.setUint8(this._pos_,t);this._pos_++}_getUInt8(t){return this._readUInt8(t)}_readUInt8(t){return this._d_.getUint8(t)}_getUint16(t){return this._readUint16(t)}_readUint16(t){return this._d_.getUint16(t,this._xd_)}_getMatrix(){return this._readMatrix()}_readMatrix(){var t=new L(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());return t}_rUTF(t){var e=this._pos_+t,a,i,r,s=String.fromCharCode;var n=this._u8d_;var o=[];var l=0;o.length=1e3;while(this._pos_<e){a=n[this._pos_++];if(a<128){if(a!=0)o[l++]=s(a)}else if(a<224){o[l++]=s((a&63)<<6|n[this._pos_++]&127)}else if(a<240){i=n[this._pos_++];o[l++]=s((a&31)<<12|(i&127)<<6|n[this._pos_++]&127)}else{i=n[this._pos_++];r=n[this._pos_++];const _=(a&15)<<18|(i&127)<<12|(r&127)<<6|n[this._pos_++]&127;if(_>=65536){const h=_-65536;const x=55296|h>>10;const c=56320|h&1023;o[l++]=s(x);o[l++]=s(c)}else{o[l++]=s(_)}}}o.length=l;return o.join("")}getCustomString(t){return this.readCustomString(t)}readCustomString(t){var e="",a=0,i,r,s=String.fromCharCode;var n=this._u8d_;while(t>0){i=n[this._pos_];if(i<128){e+=s(i);this._pos_++;t--}else{a=i-128;this._pos_++;t-=a;while(a>0){i=n[this._pos_++];r=n[this._pos_++];e+=s(r<<8|i);a--}}}return e}get pos(){return this._pos_}set pos(t){this._pos_=t}get bytesAvailable(){return this._length-this._pos_}clear(){this._pos_=0;this.length=0}__getBuffer(){return this._d_.buffer}writeUTFBytes(t){t=t+"";for(var e=0,a=t.length;e<a;e++){var i=t.charCodeAt(e);if(i<=127){this.writeByte(i)}else if(i<=2047){this._ensureWrite(this._pos_+2);this._u8d_.set([192|i>>6,128|i&63],this._pos_);this._pos_+=2}else if(i>=55296&&i<=56319){e++;const r=t.charCodeAt(e);if(!Number.isNaN(r)&&r>=56320&&r<=57343){const s=(i&1023)+64;const n=r&1023;const o=240|s>>8&63;const l=128|s>>2&63;const _=128|(s&3)<<4|n>>6&15;const h=128|n&63;this._ensureWrite(this._pos_+4);this._u8d_.set([o,l,_,h],this._pos_);this._pos_+=4}}else if(i<=65535){this._ensureWrite(this._pos_+3);this._u8d_.set([224|i>>12,128|i>>6&63,128|i&63],this._pos_);this._pos_+=3}else{this._ensureWrite(this._pos_+4);this._u8d_.set([240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63],this._pos_);this._pos_+=4}}}writeUTFString(t){var e=this.pos;this.writeUint16(1);this.writeUTFBytes(t);var a=this.pos-e-2;this._d_.setUint16(e,a,this._xd_)}readUTFString(){return this.readUTFBytes(this.getUint16())}getUTFString(){return this.readUTFString()}readUTFBytes(t=-1){if(t===0)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";t=t>0?t:e;return this._rUTF(t)}getUTFBytes(t=-1){return this.readUTFBytes(t)}writeByte(t){this._ensureWrite(this._pos_+1);this._d_.setInt8(this._pos_,t);this._pos_+=1}readByte(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)}getByte(){return this.readByte()}_ensureWrite(t){if(this._length<t)this._length=t;if(this._allocated_<t)this.length=t}writeArrayBuffer(t,e=0,a=0){if(e<0||a<0)throw"writeArrayBuffer error - Out of bounds";if(a==0)a=t.byteLength-e;this._ensureWrite(this._pos_+a);var i=new Uint8Array(t);this._u8d_.set(i.subarray(e,e+a),this._pos_);this._pos_+=a}readArrayBuffer(t){var e;e=this._u8d_.buffer.slice(this._pos_,this._pos_+t);this._pos_=this._pos_+t;return e}}tt.BIG_ENDIAN="bigEndian";tt.LITTLE_ENDIAN="littleEndian";tt._sysEndian=null;(function(t){t[t["R8G8B8"]=0]="R8G8B8";t[t["R8G8B8A8"]=1]="R8G8B8A8";t[t["Alpha8"]=2]="Alpha8";t[t["R16G16B16A16"]=14]="R16G16B16A16";t[t["Depth"]=15]="Depth";t[t["ShadowMap"]=16]="ShadowMap"})(A.RenderTextureFormat||(A.RenderTextureFormat={}));(function(t){t[t["DEPTH_16"]=0]="DEPTH_16";t[t["STENCIL_8"]=1]="STENCIL_8";t[t["DEPTHSTENCIL_24_8"]=2]="DEPTHSTENCIL_24_8";t[t["DEPTHSTENCIL_NONE"]=3]="DEPTHSTENCIL_NONE";t[t["DEPTHSTENCIL_16_8"]=2]="DEPTHSTENCIL_16_8"})(A.RenderTextureDepthFormat||(A.RenderTextureDepthFormat={}));class et{static get maxTextureCount(){return this._maxTextureCount}static get maxTextureSize(){return this._maxTextureSize}static get shaderCapailityLevel(){return this._shaderCapailityLevel}static supportTextureFormat(t){switch(t){case A.TextureFormat.R32G32B32A32:return!f.layaGPUInstance._isWebGL2&&!f.layaGPUInstance._oesTextureFloat?false:true;case A.TextureFormat.R16G16B16A16:return!f.layaGPUInstance._isWebGL2&&!f.layaGPUInstance._oesTextureHalfFloat?false:true;default:return true}}static supportRenderTextureFormat(t){switch(t){case A.RenderTextureFormat.R16G16B16A16:return!!f.layaGPUInstance._isWebGL2&&!!f.layaGPUInstance._extColorBufferFloat||f.layaGPUInstance._oesTextureHalfFloat&&f.layaGPUInstance._oesTextureHalfFloatLinear?true:false;case A.RenderTextureFormat.Depth:return f.layaGPUInstance._isWebGL2||f.layaGPUInstance._webgl_depth_texture?true:false;case A.RenderTextureFormat.ShadowMap:return f.layaGPUInstance._isWebGL2?true:false;default:return true}}}class c{static __init__(){for(var t=0;t<256;++t){var e=t-127;if(e<-27){c._baseTable[t|0]=0;c._baseTable[t|256]=32768;c._shiftTable[t|0]=24;c._shiftTable[t|256]=24}else if(e<-14){c._baseTable[t|0]=1024>>-e-14;c._baseTable[t|256]=1024>>-e-14|32768;c._shiftTable[t|0]=-e-1;c._shiftTable[t|256]=-e-1}else if(e<=15){c._baseTable[t|0]=e+15<<10;c._baseTable[t|256]=e+15<<10|32768;c._shiftTable[t|0]=13;c._shiftTable[t|256]=13}else if(e<128){c._baseTable[t|0]=31744;c._baseTable[t|256]=64512;c._shiftTable[t|0]=24;c._shiftTable[t|256]=24}else{c._baseTable[t|0]=31744;c._baseTable[t|256]=64512;c._shiftTable[t|0]=13;c._shiftTable[t|256]=13}}c._mantissaTable[0]=0;for(t=1;t<1024;++t){var a=t<<13;e=0;while((a&8388608)===0){e-=8388608;a<<=1}a&=~8388608;e+=947912704;c._mantissaTable[t]=a|e}for(t=1024;t<2048;++t){c._mantissaTable[t]=939524096+(t-1024<<13)}c._exponentTable[0]=0;for(t=1;t<31;++t){c._exponentTable[t]=t<<23}c._exponentTable[31]=1199570944;c._exponentTable[32]=2147483648;for(t=33;t<63;++t){c._exponentTable[t]=2147483648+(t-32<<23)}c._exponentTable[63]=3347054592;c._offsetTable[0]=0;for(t=1;t<64;++t){if(t===32){c._offsetTable[t]=0}else{c._offsetTable[t]=1024}}}static roundToFloat16Bits(t){c._floatView[0]=t;var e=c._uint32View[0];var a=e>>23&511;return c._baseTable[a]+((e&8388607)>>c._shiftTable[a])}static convertToNumber(t){var e=t>>10;c._uint32View[0]=c._mantissaTable[c._offsetTable[e]+(t&1023)]+c._exponentTable[e];return c._floatView[0]}}c._buffer=new ArrayBuffer(4);c._floatView=new Float32Array(c._buffer);c._uint32View=new Uint32Array(c._buffer);c._baseTable=new Uint32Array(512);c._shiftTable=new Uint32Array(512);c._mantissaTable=new Uint32Array(2048);c._exponentTable=new Uint32Array(64);c._offsetTable=new Uint32Array(64);class at extends i{constructor(t=0,e=0,a=A.TextureFormat.R8G8B8A8,i=true,r=false){super(a,i);var s=f.instance;this._glTextureType=s.TEXTURE_2D;this._width=t;this._height=e;this._canRead=r;this._setWarpMode(s.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(s.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);var n=this._gpuCompressFormat();if(i){var o=Math.max(Math.ceil(Math.log2(t))+1,Math.ceil(Math.log2(e))+1);if(!n){for(var l=0;l<o;l++)this._setPixels(null,l,Math.max(t>>l,1),Math.max(e>>l,1))}this._mipmapCount=o;this._setGPUMemory(t*e*4*(1+1/3))}else{if(!n)this._setPixels(null,0,t,e);this._mipmapCount=1;this._setGPUMemory(t*e*4)}}static __init__(){var t=new Uint8Array(3);t[0]=128;t[1]=128;t[2]=128;at.grayTexture=new at(1,1,A.TextureFormat.R8G8B8,false,false);at.grayTexture.setPixels(t);at.grayTexture.lock=true;t[0]=255;t[1]=255;t[2]=255;at.whiteTexture=new at(1,1,A.TextureFormat.R8G8B8,false,false);at.whiteTexture.setPixels(t);at.whiteTexture.lock=true;t[0]=0;t[1]=0;t[2]=0;at.blackTexture=new at(1,1,A.TextureFormat.R8G8B8,false,false);at.blackTexture.setPixels(t);at.blackTexture.lock=true}static _parse(t,e=null,a=null){var i=a?new at(a[0],a[1],a[2],a[3],a[4]):new at(0,0);if(e){i.wrapModeU=e.wrapModeU;i.wrapModeV=e.wrapModeV;i.filterMode=e.filterMode;i.anisoLevel=e.anisoLevel}switch(i._format){case A.TextureFormat.R8G8B8:case A.TextureFormat.R8G8B8A8:i.loadImageSource(t);break;case A.TextureFormat.DXT1:case A.TextureFormat.DXT5:case A.TextureFormat.ETC1RGB:case A.TextureFormat.PVRTCRGB_2BPPV:case A.TextureFormat.PVRTCRGBA_2BPPV:case A.TextureFormat.PVRTCRGB_4BPPV:case A.TextureFormat.PVRTCRGBA_4BPPV:i.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return i}static _SimpleAnimatorTextureParse(t,e=null,a=null){var i=new tt(t);var r=i.readUTFString();var s;var n;var o;switch(r){case"LAYAANIMATORTEXTURE:0000":var l=i.readInt32();var _=i.readInt32();n=new Float32Array(l*l*4);o=new Float32Array(i.readArrayBuffer(_*4));n.set(o,0);var s=new at(l,l,A.TextureFormat.R32G32B32A32,false,false);s.setPixels(n,0);s.filterMode=A.FilterMode.Point;break;case"LAYACOMPRESSANIMATORTEXTURE:0000":var l=i.readInt32();var _=i.readInt32();n=new Uint16Array(i.readArrayBuffer(_*2));if(!et.supportTextureFormat(A.TextureFormat.R16G16B16A16)){console.log("The platform does not support 16-bit floating-point textures");if(!et.supportTextureFormat(A.TextureFormat.R32G32B32A32))console.error("The platform does not support 32-bit floating-point textures");o=new Float32Array(l*l*4);for(var h=0,x=n.length;h<x;h++){o[h]=c.convertToNumber(n[h])}s=new at(l,l,A.TextureFormat.R32G32B32A32,false,false);s.setPixels(o,0);s.filterMode=A.FilterMode.Point}else{o=new Uint16Array(l*l*4);o.set(n,0);s=new at(l,l,A.TextureFormat.R16G16B16A16,false,false);s.setPixels(o,0);s.filterMode=A.FilterMode.Point}break;default:throw"Laya3D:unknow version."}return s}static load(t,e){O.loader.create(t,e,null,O.Loader.TEXTURE2D)}get defaulteTexture(){return at.grayTexture}_gpuCompressFormat(){return this._format==A.TextureFormat.DXT1||this._format==A.TextureFormat.DXT5||this._format==A.TextureFormat.ETC1RGB||this._format==A.TextureFormat.PVRTCRGB_2BPPV||this._format==A.TextureFormat.PVRTCRGBA_2BPPV||this._format==A.TextureFormat.PVRTCRGB_4BPPV||this._format==A.TextureFormat.PVRTCRGBA_4BPPV}_setPixels(t,e,a,i){var r=f.instance;var s=this._glTextureType;var n=this._getGLFormat();p.bindTexture(r,s,this._glTexture);switch(this.format){case A.TextureFormat.R8G8B8:r.pixelStorei(r.UNPACK_ALIGNMENT,1);r.texImage2D(s,e,n,a,i,0,n,r.UNSIGNED_BYTE,t);r.pixelStorei(r.UNPACK_ALIGNMENT,4);break;case A.TextureFormat.R5G6B5:r.pixelStorei(r.UNPACK_ALIGNMENT,2);r.texImage2D(s,e,n,a,i,0,n,r.UNSIGNED_SHORT_5_6_5,t);r.pixelStorei(r.UNPACK_ALIGNMENT,4);break;case A.TextureFormat.R32G32B32A32:if(f.layaGPUInstance._isWebGL2)r.texImage2D(s,e,r.RGBA32F,a,i,0,n,r.FLOAT,t);else r.texImage2D(s,e,r.RGBA,a,i,0,n,r.FLOAT,t);break;case A.TextureFormat.R16G16B16A16:if(f.layaGPUInstance._isWebGL2)r.texImage2D(s,e,r.RGBA16F,a,i,0,n,r.HALF_FLOAT,t);else r.texImage2D(s,e,r.RGBA,a,i,0,n,f.layaGPUInstance._oesTextureHalfFloat.HALF_FLOAT_OES,t);break;default:r.texImage2D(s,e,n,a,i,0,n,r.UNSIGNED_BYTE,t)}}_calcualatesCompressedDataSize(t,e,a){switch(t){case A.TextureFormat.DXT1:case A.TextureFormat.ETC1RGB:return(e+3>>2)*(a+3>>2)*8;case A.TextureFormat.DXT5:return(e+3>>2)*(a+3>>2)*16;case A.TextureFormat.PVRTCRGB_4BPPV:case A.TextureFormat.PVRTCRGBA_4BPPV:return Math.floor((Math.max(e,8)*Math.max(a,8)*4+7)/8);case A.TextureFormat.PVRTCRGB_2BPPV:case A.TextureFormat.PVRTCRGBA_2BPPV:return Math.floor((Math.max(e,16)*Math.max(a,8)*2+7)/8);default:return 0}}_pharseDDS(t){const e=827611204;const a=894720068;const i=4;const r=131072;const s=542327876;const n=31;const o=0;const l=1;const _=2;const h=3;const x=4;const c=7;const d=20;const u=21;var f=new Int32Array(t,0,n);if(f[o]!=s)throw"Invalid magic number in DDS header";if(!(f[d]&i))throw"Unsupported format, must contain a FourCC code";var p=f[u];switch(this._format){case A.TextureFormat.DXT1:if(p!==e)throw"the FourCC code is not same with texture format.";break;case A.TextureFormat.DXT5:if(p!==a)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var m=1;if(f[_]&r){m=Math.max(1,f[c]);if(!this._mipmap)throw"the mipmap is not same with Texture2D."}else{if(this._mipmap)throw"the mipmap is not same with Texture2D."}var g=f[x];var v=f[h];this._width=g;this._height=v;var y=f[l]+4;this._upLoadCompressedTexImage2D(t,g,v,m,y,0)}_pharseKTX(t){const e=13;const a=4;const i=7;const r=6;const s=11;const n=12;var o=new Uint8Array(t,0,12);if(o[0]!=171||o[1]!=75||o[2]!=84||o[3]!=88||o[4]!=32||o[5]!=49||o[6]!=49||o[7]!=187||o[8]!=13||o[9]!=10||o[10]!=26||o[11]!=10)throw"Invalid fileIdentifier in KTX header";var l=new Int32Array(o.buffer,o.length,e);var _=l[a];switch(_){case f.layaGPUInstance._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=A.TextureFormat.ETC1RGB;break;default:throw"unknown texture format."}var h=l[s];var x=l[r];var c=l[i];this._width=x;this._height=c;var d=64+l[n];this._upLoadCompressedTexImage2D(t,x,c,h,d,4)}_pharsePVR(t){const e=0;const a=1;const i=2;const r=3;const s=55727696;const n=13;const o=0;const l=2;const _=6;const h=7;const x=11;const c=12;var d=new Int32Array(t,0,n);if(d[o]!=s)throw"Invalid magic number in PVR header";var u=d[l];switch(u){case e:this._format=A.TextureFormat.PVRTCRGB_2BPPV;break;case i:this._format=A.TextureFormat.PVRTCRGB_4BPPV;break;case a:this._format=A.TextureFormat.PVRTCRGBA_2BPPV;break;case r:this._format=A.TextureFormat.PVRTCRGBA_4BPPV;break;default:throw"Texture2D:unknown PVR format."}var f=d[x];var p=d[h];var m=d[_];this._width=p;this._height=m;var g=d[c]+52;this._upLoadCompressedTexImage2D(t,p,m,f,g,0)}_upLoadCompressedTexImage2D(t,e,a,i,r,s){var n=f.instance;var o=this._glTextureType;p.bindTexture(n,o,this._glTexture);var l=this._getGLFormat();var _=r;for(var h=0;h<i;h++){_+=s;var x=this._calcualatesCompressedDataSize(this._format,e,a);var c=new Uint8Array(t,_,x);n.compressedTexImage2D(o,h,l,e,a,0,c);e=Math.max(e>>1,1);a=Math.max(a>>1,1);_+=x}var d=_;this._setGPUMemory(d);this._readyed=true;this._activeResource()}loadImageSource(t,e=false){var a=f.instance;var i=t.width;var r=t.height;this._width=i;this._height=r;if(!(this._isPot(i)&&this._isPot(r)))this._mipmap=false;this._setWarpMode(a.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(a.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);p.bindTexture(a,this._glTextureType,this._glTexture);var s=this._getGLFormat();if(O.Render.isConchApp){if(t.setPremultiplyAlpha){t.setPremultiplyAlpha(e)}a.texImage2D(this._glTextureType,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t)}else{e&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);if(this.format==A.TextureFormat.R5G6B5)a.texImage2D(this._glTextureType,0,a.RGB,a.RGB,a.UNSIGNED_SHORT_5_6_5,t);else a.texImage2D(this._glTextureType,0,s,s,a.UNSIGNED_BYTE,t);e&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}if(this._mipmap){a.generateMipmap(this._glTextureType);this._setGPUMemory(i*r*4*(1+1/3))}else{this._setGPUMemory(i*r*4)}if(this._canRead){if(O.Render.isConchApp){this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,r))}else{O.Browser.canvas.size(i,r);O.Browser.canvas.clear();O.Browser.context.drawImage(t,0,0,i,r);this._pixels=new Uint8Array(O.Browser.context.getImageData(0,0,i,r).data.buffer)}}this._readyed=true;this._activeResource()}setPixels(t,e=0){if(this._gpuCompressFormat())throw"Texture2D:the format is GPU compression format.";if(!t)throw"Texture2D:pixels can't be null.";var a=Math.max(this._width>>e,1);var i=Math.max(this._height>>e,1);var r=a*i*this._getFormatByteCount();if(t.length<r)throw"Texture2D:pixels length should at least "+r+".";this._setPixels(t,e,a,i);if(this._canRead)this._pixels=t;this._readyed=true;this._activeResource()}setSubPixels(t,e,a,i,r,s=0){if(this._gpuCompressFormat())throw"Texture2D:the format is GPU compression format.";if(!r)throw"Texture2D:pixels can't be null.";var n=f.instance;var o=this._glTextureType;p.bindTexture(n,o,this._glTexture);var l=this._getGLFormat();switch(this.format){case A.TextureFormat.R8G8B8:n.pixelStorei(n.UNPACK_ALIGNMENT,1);n.texSubImage2D(o,s,t,e,a,i,l,n.UNSIGNED_BYTE,r);n.pixelStorei(n.UNPACK_ALIGNMENT,4);break;case A.TextureFormat.R5G6B5:n.pixelStorei(n.UNPACK_ALIGNMENT,2);n.texSubImage2D(o,s,t,e,a,i,l,n.UNSIGNED_SHORT_5_6_5,r);n.pixelStorei(n.UNPACK_ALIGNMENT,4);break;case A.TextureFormat.R32G32B32A32:n.texSubImage2D(o,s,t,e,a,i,l,n.FLOAT,r);break;default:n.texSubImage2D(o,s,t,e,a,i,l,n.UNSIGNED_BYTE,r)}this._readyed=true;this._activeResource()}setCompressData(t){switch(this._format){case A.TextureFormat.DXT1:case A.TextureFormat.DXT5:this._pharseDDS(t);break;case A.TextureFormat.ETC1RGB:this._pharseKTX(t);break;case A.TextureFormat.PVRTCRGB_2BPPV:case A.TextureFormat.PVRTCRGBA_2BPPV:case A.TextureFormat.PVRTCRGB_4BPPV:case A.TextureFormat.PVRTCRGBA_4BPPV:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}}getPixels(){if(this._canRead)return this._pixels;else throw new Error("Texture2D: must set texture canRead is true.")}}at.TEXTURE2D="TEXTURE2D";at.grayTexture=null;at.whiteTexture=null;at.blackTexture=null;class it extends ${constructor(){super()}}class _{static mat2MatArray(t,e){var a=t;var i=e;i[0]=a.a;i[1]=a.b;i[2]=_.EMPTYMAT4_ARRAY[2];i[3]=_.EMPTYMAT4_ARRAY[3];i[4]=a.c;i[5]=a.d;i[6]=_.EMPTYMAT4_ARRAY[6];i[7]=_.EMPTYMAT4_ARRAY[7];i[8]=_.EMPTYMAT4_ARRAY[8];i[9]=_.EMPTYMAT4_ARRAY[9];i[10]=_.EMPTYMAT4_ARRAY[10];i[11]=_.EMPTYMAT4_ARRAY[11];i[12]=a.tx;i[13]=a.ty;i[14]=_.EMPTYMAT4_ARRAY[14];i[15]=_.EMPTYMAT4_ARRAY[15];return e}static restoreTempArray(){_.TEMPMAT4_ARRAY[0]=1;_.TEMPMAT4_ARRAY[1]=0;_.TEMPMAT4_ARRAY[4]=0;_.TEMPMAT4_ARRAY[5]=1;_.TEMPMAT4_ARRAY[12]=0;_.TEMPMAT4_ARRAY[13]=0}static clear(){_.worldScissorTest=false;_.worldAlpha=1}}_._MAXSIZE=99999999;_.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];_.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];_.worldMatrix4=_.TEMPMAT4_ARRAY;_.worldMatrix=new L;_.matWVP=null;_.worldAlpha=1;_.worldScissorTest=false;_.width=0;_.height=0;class rt extends i{constructor(t,e,a=A.RenderTextureFormat.R8G8B8,i=A.RenderTextureDepthFormat.DEPTH_16){super(a,false);this._mgrKey=0;this._glTextureType=f.instance.TEXTURE_2D;this._width=t;this._height=e;this._depthStencilFormat=i;this._create(t,e);this.lock=true}static get currentActive(){return rt._currentActive}get depthStencilFormat(){return this._depthStencilFormat}get defaulteTexture(){return at.grayTexture}getIsReady(){return true}get sourceWidth(){return this._width}get sourceHeight(){return this._height}get offsetX(){return 0}get offsetY(){return 0}_create(t,e){var a=f.instance;this._frameBuffer=a.createFramebuffer();p.bindTexture(a,this._glTextureType,this._glTexture);var i=this._getGLFormat();a.texImage2D(this._glTextureType,0,i,t,e,0,i,a.UNSIGNED_BYTE,null);this._setGPUMemory(t*e*4);a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._glTexture,0);if(this._depthStencilFormat!==A.RenderTextureDepthFormat.DEPTHSTENCIL_NONE){this._depthStencilBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this._depthStencilBuffer);switch(this._depthStencilFormat){case A.RenderTextureDepthFormat.DEPTH_16:a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,e);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this._depthStencilBuffer);break;case A.RenderTextureDepthFormat.STENCIL_8:a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,t,e);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthStencilBuffer);break;case A.RenderTextureDepthFormat.DEPTHSTENCIL_24_8:a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,t,e);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthStencilBuffer);break;default:}}a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);this._setWarpMode(a.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(a.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);this._readyed=true;this._activeResource()}generateMipmap(){if(this._isPot(this.width)&&this._isPot(this.height)){this._mipmap=true;f.instance.generateMipmap(this._glTextureType);this._setFilterMode(this._filterMode);this._setGPUMemory(this.width*this.height*4*(1+1/3))}else{this._mipmap=false;this._setGPUMemory(this.width*this.height*4)}}static pushRT(){rt.rtStack.push({rt:rt._currentActive,w:_.width,h:_.height})}static popRT(){var t=f.instance;var e=rt.rtStack.pop();if(e){if(rt._currentActive!=e.rt){f.instance.bindFramebuffer(t.FRAMEBUFFER,e.rt?e.rt._frameBuffer:null);rt._currentActive=e.rt}t.viewport(0,0,e.w,e.h);_.width=e.w;_.height=e.h}}start(){var t=f.instance;f.instance.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);this._lastRT=rt._currentActive;rt._currentActive=this;this._readyed=true;t.viewport(0,0,this._width,this._height);this._lastWidth=_.width;this._lastHeight=_.height;_.width=this._width;_.height=this._height;it.activeShader=null}end(){var t=f.instance;t.bindFramebuffer(t.FRAMEBUFFER,null);rt._currentActive=null;this._readyed=true}restore(){var t=f.instance;if(this._lastRT!=rt._currentActive){f.instance.bindFramebuffer(t.FRAMEBUFFER,this._lastRT?this._lastRT._frameBuffer:null);rt._currentActive=this._lastRT}this._readyed=true;t.viewport(0,0,this._lastWidth,this._lastHeight);_.width=this._lastWidth;_.height=this._lastHeight;it.activeShader=null}clear(t=0,e=0,a=0,i=1){var r=f.instance;r.clearColor(t,e,a,i);var s=r.COLOR_BUFFER_BIT;switch(this._depthStencilFormat){case r.DEPTH_COMPONENT16:s|=r.DEPTH_BUFFER_BIT;break;case r.STENCIL_INDEX8:s|=r.STENCIL_BUFFER_BIT;break;case r.DEPTH_STENCIL:s|=r.DEPTH_BUFFER_BIT;s|=r.STENCIL_BUFFER_BIT;break}r.clear(s)}getData(t,e,a,i){if(O.Render.isConchApp&&window.conchConfig.threadMode==2){throw"native 2 thread mode use getDataAsync"}var r=f.instance;r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;if(!s){r.bindFramebuffer(r.FRAMEBUFFER,null);return null}var n=new Uint8Array(this._width*this._height*4);var o=this._getGLFormat();r.readPixels(t,e,a,i,o,r.UNSIGNED_BYTE,n);r.bindFramebuffer(r.FRAMEBUFFER,null);return n}getDataAsync(t,e,a,i,r){var s=f.instance;s.bindFramebuffer(s.FRAMEBUFFER,this._frameBuffer);s.readPixelsAsync(t,e,a,i,s.RGBA,s.UNSIGNED_BYTE,function(t){r(new Uint8Array(t))});s.bindFramebuffer(s.FRAMEBUFFER,null)}recycle(){}_disposeResource(){if(this._frameBuffer){var t=f.instance;t.deleteTexture(this._glTexture);t.deleteFramebuffer(this._frameBuffer);t.deleteRenderbuffer(this._depthStencilBuffer);this._glTexture=null;this._frameBuffer=null;this._depthStencilBuffer=null;this._setGPUMemory(0)}}}rt.rtStack=[];rt.defuv=[0,0,1,0,1,1,0,1];rt.flipyuv=[0,1,1,1,1,0,0,0];class st{static getRT(t,e){t=t|0;e=e|0;if(t>=1e4){console.error("getRT error! w too big")}var a;a=new rt(t,e,A.RenderTextureFormat.R8G8B8A8,-1);return a}static releaseRT(t){t.destroy();return}}st.dict={};class M{static _init_(t){M.fns=[M.BlendNormal,M.BlendAdd,M.BlendMultiply,M.BlendScreen,M.BlendOverlay,M.BlendLight,M.BlendMask,M.BlendDestinationOut,M.BlendAddOld];M.targetFns=[M.BlendNormalTarget,M.BlendAddTarget,M.BlendMultiplyTarget,M.BlendScreenTarget,M.BlendOverlayTarget,M.BlendLightTarget,M.BlendMask,M.BlendDestinationOut,M.BlendAddTargetOld]}static BlendNormal(t){p.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_ALPHA,true)}static BlendAddOld(t){p.setBlendFunc(t,t.ONE,t.DST_ALPHA,true)}static BlendAdd(t){p.setBlendFunc(t,t.ONE,t.ONE,true)}static BlendMultiply(t){p.setBlendFunc(t,t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,true)}static BlendScreen(t){p.setBlendFunc(t,t.ONE,t.ONE,true)}static BlendOverlay(t){p.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_COLOR,true)}static BlendLight(t){p.setBlendFunc(t,t.ONE,t.ONE,true)}static BlendNormalTarget(t){p.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_ALPHA,true)}static BlendAddTargetOld(t){p.setBlendFunc(t,t.ONE,t.DST_ALPHA,true)}static BlendAddTarget(t){p.setBlendFunc(t,t.ONE,t.ONE,true)}static BlendMultiplyTarget(t){p.setBlendFunc(t,t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,true)}static BlendScreenTarget(t){p.setBlendFunc(t,t.ONE,t.ONE,true)}static BlendOverlayTarget(t){p.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_COLOR,true)}static BlendLightTarget(t){p.setBlendFunc(t,t.ONE,t.ONE,true)}static BlendMask(t){p.setBlendFunc(t,t.ZERO,t.SRC_ALPHA,true)}static BlendDestinationOut(t){p.setBlendFunc(t,t.ZERO,t.ZERO,true)}}M.activeBlendFunction=null;M.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out","add_old"];M.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1,lighter_old:8,add_old:8};M.NORMAL="normal";M.MASK="mask";M.LIGHTER="lighter";class nt{constructor(t,e,a){this._value=0;this._name2int=t;this._int2name=e;this._int2nameMap=a}add(t){if(typeof t=="string"){this._value|=this._name2int[t]}else{this._value|=t}return this._value}addInt(t){this._value|=t;return this._value}remove(t){if(typeof t=="string"){this._value&=~this._name2int[t]}else{this._value&=~t}return this._value}isDefine(t){return(this._value&t)===t}getValue(){return this._value}setValue(t){this._value=t}toNameDic(){var t=this._int2nameMap[this._value];return t?t:nt._toText(this._value,this._int2name,this._int2nameMap)}static _reg(t,e,a,i){a[t]=e;i[e]=t}static _toText(t,e,a){var i=a[t];if(i)return i;var r={};var s=1;for(var n=0;n<32;n++){s=1<<n;if(s>t)break;if(t&s){var o=e[s];o&&(r[o]="")}}a[t]=r;return r}static _toInt(t,e){var a=t.split(".");var i=0;for(var r=0,s=a.length;r<s;r++){var n=e[a[r]];if(!n)throw new Error("Defines to int err:"+t+"/"+a[r]);i|=n}return i}}class D extends nt{constructor(){super(D.__name2int,D.__int2name,D.__int2nameMap)}static __init__(){D.reg("TEXTURE2D",D.TEXTURE2D);D.reg("PRIMITIVE",D.PRIMITIVE);D.reg("GLOW_FILTER",D.FILTERGLOW);D.reg("BLUR_FILTER",D.FILTERBLUR);D.reg("COLOR_FILTER",D.FILTERCOLOR);D.reg("COLOR_ADD",D.COLORADD);D.reg("WORLDMAT",D.WORLDMAT);D.reg("FILLTEXTURE",D.FILLTEXTURE);D.reg("MVP3D",D.MVP3D)}static reg(t,e){this._reg(t,e,D.__name2int,D.__int2name)}static toText(t,e,a){return this._toText(t,e,a)}static toInt(t){return this._toInt(t,D.__name2int)}}D.TEXTURE2D=1;D.PRIMITIVE=4;D.FILTERGLOW=8;D.FILTERBLUR=16;D.FILTERCOLOR=32;D.COLORADD=64;D.WORLDMAT=128;D.FILLTEXTURE=256;D.SKINMESH=512;D.MVP3D=2048;D.NOOPTMASK=D.FILTERGLOW|D.FILTERBLUR|D.FILTERCOLOR|D.FILLTEXTURE;D.__name2int={};D.__int2name=[];D.__int2nameMap=[];class g{static show(t=0,e=0){g._StatRender.show(t,e)}static enable(){g._StatRender.enable()}static hide(){g._StatRender.hide()}static clear(){g.trianglesFaces=g.renderBatches=g.savedRenderBatches=g.shaderCall=g.spriteRenderUseCacheCount=g.frustumCulling=g.octreeNodeCulling=g.canvasNormal=g.canvasBitmap=g.canvasReCache=0}static set onclick(t){g._StatRender.set_onclick(t)}}g.FPS=0;g.loopCount=0;g.shaderCall=0;g.renderBatches=0;g.savedRenderBatches=0;g.trianglesFaces=0;g.spriteCount=0;g.spriteRenderUseCacheCount=0;g.frustumCulling=0;g.octreeNodeCulling=0;g.canvasNormal=0;g.canvasBitmap=0;g.canvasReCache=0;g.renderSlow=false;g._fpsData=[];g._timer=0;g._count=0;g._StatRender=null;class ot{constructor(){this._strsToID={};this._idToStrs=[];this._length=0}add(t){var e=this._strsToID[t];if(e!=null)return e;this._idToStrs[this._length]=t;return this._strsToID[t]=this._length++}getID(t){var e=this._strsToID[t];return e==null?-1:e}getName(t){var e=this._idToStrs[t];return e==null?undefined:e}}class lt extends it{constructor(t,e,a=null,i=null,r=null){super();this._attribInfo=null;this.customCompile=false;this._curActTexIndex=0;this.tag={};this._program=null;this._params=null;this._paramsMap={};if(!t||!e)throw"Shader Error";this._attribInfo=r;this._id=++lt._count;this._vs=t;this._ps=e;this._nameMap=i?i:{};a!=null&&(lt.sharders[a]=this);this.recreateResource();this.lock=true}static getShader(t){return lt.sharders[t]}static create(t,e,a=null,i=null,r=null){return new lt(t,e,a,i,r)}static withCompile(t,e,a,i){if(a&&lt.sharders[a])return lt.sharders[a];var r=lt._preCompileShader[lt.SHADERNAME2ID*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,a,i,null)}static withCompile2D(t,e,a,i,r,s=null){if(i&&lt.sharders[i])return lt.sharders[i];var n=lt._preCompileShader[lt.SHADERNAME2ID*t+e];if(!n)throw new Error("withCompile shader err!"+t+" "+e);return n.createShader(a,i,r,s)}static addInclude(t,e){O.ShaderCompile.addInclude(t,e)}static preCompile(t,e,a,i){var r=lt.SHADERNAME2ID*t;lt._preCompileShader[r]=new O.ShaderCompile(e,a,i)}static preCompile2D(t,e,a,i,r){var s=lt.SHADERNAME2ID*t+e;lt._preCompileShader[s]=new O.ShaderCompile(a,i,r)}recreateResource(){this._compile();this._setGPUMemory(0)}_disposeResource(){p.mainContext.deleteShader(this._vshader);p.mainContext.deleteShader(this._pshader);p.mainContext.deleteProgram(this._program);this._vshader=this._pshader=this._program=null;this._params=null;this._paramsMap={};this._setGPUMemory(0);this._curActTexIndex=0}_compile(){if(!this._vs||!this._ps||this._params)return;this._reCompile=true;this._params=[];var t;if(this.customCompile)t=O.ShaderCompile.preGetParams(this._vs,this._ps);var e=p.mainContext;this._program=e.createProgram();this._vshader=lt._createShader(e,this._vs,e.VERTEX_SHADER);this._pshader=lt._createShader(e,this._ps,e.FRAGMENT_SHADER);e.attachShader(this._program,this._vshader);e.attachShader(this._program,this._pshader);var a,i,r,s;var n=this._attribInfo?this._attribInfo.length:0;for(i=0;i<n;i+=2){e.bindAttribLocation(this._program,this._attribInfo[i+1],this._attribInfo[i])}e.linkProgram(this._program);if(!this.customCompile&&!e.getProgramParameter(this._program,e.LINK_STATUS)){throw e.getProgramInfoLog(this._program)}var o=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,e.ACTIVE_UNIFORMS);for(i=0;i<o;i++){var l=this.customCompile?t.uniforms[i]:e.getActiveUniform(this._program,i);s=e.getUniformLocation(this._program,l.name);a={vartype:"uniform",glfun:null,ivartype:1,location:s,name:l.name,type:l.type,isArray:false,isSame:false,preValue:null,indexOfParams:0};if(a.name.indexOf("[0]")>0){a.name=a.name.substr(0,a.name.length-3);a.isArray=true;a.location=e.getUniformLocation(this._program,a.name)}this._params.push(a)}for(i=0,r=this._params.length;i<r;i++){a=this._params[i];a.indexOfParams=i;a.index=1;a.value=[a.location,null];a.codename=a.name;a.name=this._nameMap[a.codename]?this._nameMap[a.codename]:a.codename;this._paramsMap[a.name]=a;a._this=this;a.uploadedValue=[];switch(a.type){case e.INT:a.fun=a.isArray?this._uniform1iv:this._uniform1i;break;case e.FLOAT:a.fun=a.isArray?this._uniform1fv:this._uniform1f;break;case e.FLOAT_VEC2:a.fun=a.isArray?this._uniform_vec2v:this._uniform_vec2;break;case e.FLOAT_VEC3:a.fun=a.isArray?this._uniform_vec3v:this._uniform_vec3;break;case e.FLOAT_VEC4:a.fun=a.isArray?this._uniform_vec4v:this._uniform_vec4;break;case e.SAMPLER_2D:a.fun=this._uniform_sampler2D;break;case e.SAMPLER_CUBE:a.fun=this._uniform_samplerCube;break;case e.FLOAT_MAT4:a.glfun=e.uniformMatrix4fv;a.fun=this._uniformMatrix4fv;break;case e.BOOL:a.fun=this._uniform1i;break;case e.FLOAT_MAT2:case e.FLOAT_MAT3:throw new Error("compile shader err!");default:throw new Error("compile shader err!")}}}static _createShader(t,e,a){var i=t.createShader(a);t.shaderSource(i,e);t.compileShader(i);if(t.getShaderParameter(i,t.COMPILE_STATUS)){return i}else{console.log(t.getShaderInfoLog(i));return null}}getUniform(t){return this._paramsMap[t]}_uniform1f(t,e){var a=t.uploadedValue;if(a[0]!==e){p.mainContext.uniform1f(t.location,a[0]=e);return 1}return 0}_uniform1fv(t,e){if(e.length<4){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){p.mainContext.uniform1fv(t.location,e);a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[3];return 1}return 0}else{p.mainContext.uniform1fv(t.location,e);return 1}}_uniform_vec2(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]){p.mainContext.uniform2f(t.location,a[0]=e[0],a[1]=e[1]);return 1}return 0}_uniform_vec2v(t,e){if(e.length<2){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){p.mainContext.uniform2fv(t.location,e);a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[3];return 1}return 0}else{p.mainContext.uniform2fv(t.location,e);return 1}}_uniform_vec3(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]){p.mainContext.uniform3f(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2]);return 1}return 0}_uniform_vec3v(t,e){p.mainContext.uniform3fv(t.location,e);return 1}_uniform_vec4(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){p.mainContext.uniform4f(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3]);return 1}return 0}_uniform_vec4v(t,e){p.mainContext.uniform4fv(t.location,e);return 1}_uniformMatrix2fv(t,e){p.mainContext.uniformMatrix2fv(t.location,false,e);return 1}_uniformMatrix3fv(t,e){p.mainContext.uniformMatrix3fv(t.location,false,e);return 1}_uniformMatrix4fv(t,e){p.mainContext.uniformMatrix4fv(t.location,false,e);return 1}_uniform1i(t,e){var a=t.uploadedValue;if(a[0]!==e){p.mainContext.uniform1i(t.location,a[0]=e);return 1}return 0}_uniform1iv(t,e){p.mainContext.uniform1iv(t.location,e);return 1}_uniform_ivec2(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]){p.mainContext.uniform2i(t.location,a[0]=e[0],a[1]=e[1]);return 1}return 0}_uniform_ivec2v(t,e){p.mainContext.uniform2iv(t.location,e);return 1}_uniform_vec3i(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]){p.mainContext.uniform3i(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2]);return 1}return 0}_uniform_vec3vi(t,e){p.mainContext.uniform3iv(t.location,e);return 1}_uniform_vec4i(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){p.mainContext.uniform4i(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3]);return 1}return 0}_uniform_vec4vi(t,e){p.mainContext.uniform4iv(t.location,e);return 1}_uniform_sampler2D(t,e){var a=p.mainContext;var i=t.uploadedValue;if(i[0]==null){i[0]=this._curActTexIndex;a.uniform1i(t.location,this._curActTexIndex);p.activeTexture(a,a.TEXTURE0+this._curActTexIndex);p.bindTexture(a,a.TEXTURE_2D,e);this._curActTexIndex++;return 1}else{p.activeTexture(a,a.TEXTURE0+i[0]);p.bindTexture(a,a.TEXTURE_2D,e);return 0}}_uniform_samplerCube(t,e){var a=p.mainContext;var i=t.uploadedValue;if(i[0]==null){i[0]=this._curActTexIndex;a.uniform1i(t.location,this._curActTexIndex);p.activeTexture(a,a.TEXTURE0+this._curActTexIndex);p.bindTexture(a,a.TEXTURE_CUBE_MAP,e);this._curActTexIndex++;return 1}else{p.activeTexture(a,a.TEXTURE0+i[0]);p.bindTexture(a,a.TEXTURE_CUBE_MAP,e);return 0}}_noSetValue(t){console.log("no....:"+t.name)}uploadOne(t,e){p.useProgram(p.mainContext,this._program);var a=this._paramsMap[t];a.fun.call(this,a,e)}uploadTexture2D(t){var e=p;if(e._activeTextures[0]!==t){e.bindTexture(p.mainContext,f.instance.TEXTURE_2D,t);e._activeTextures[0]=t}}upload(t,e=null){it.activeShader=it.bindShader=this;var a=p.mainContext;p.useProgram(a,this._program);if(this._reCompile){e=this._params;this._reCompile=false}else{e=e||this._params}var i,r,s=e.length,n=0;for(var o=0;o<s;o++){i=e[o];if((r=t[i.name])!==null)n+=i.fun.call(this,i,r)}g.shaderCall+=n}uploadArray(t,e,a){it.activeShader=this;it.bindShader=this;p.useProgram(p.mainContext,this._program);var i=this._params,r;var s,n=0;for(var o=e-2;o>=0;o-=2){s=this._paramsMap[t[o]];if(!s)continue;r=t[o+1];if(r!=null){a&&a[s.name]&&a[s.name].bind();n+=s.fun.call(this,s,r)}}g.shaderCall+=n}getParams(){return this._params}setAttributesLocation(t){this._attribInfo=t}}lt._count=0;lt._preCompileShader={};lt.SHADERNAME2ID=2e-4;lt.nameKey=new ot;lt.sharders=new Array(32);class _t extends lt{constructor(t,e,a=null,i=null,r=null){super(t,e,a,i,r);this._params2dQuick2=null;this._shaderValueWidth=0;this._shaderValueHeight=0}_disposeResource(){super._disposeResource();this._params2dQuick2=null}upload2dQuick2(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())}_make2dQuick2(){if(!this._params2dQuick2){this._params2dQuick2=[];var t=this._params,e;for(var a=0,i=t.length;a<i;a++){e=t[a];if(e.name!=="size")this._params2dQuick2.push(e)}}return this._params2dQuick2}static create(t,e,a=null,i=null,r=null){return new _t(t,e,a,i,r)}}class ht{constructor(t,e){this.defines=new D;this.size=[0,0];this.alpha=1;this.ALPHA=1;this.subID=0;this.ref=1;this._cacheID=0;this.clipMatDir=[O.Context._MAXSIZE,0,0,O.Context._MAXSIZE];this.clipMatPos=[0,0];this.clipOff=[0,0];this.mainID=t;this.subID=e;this.textureHost=null;this.texture=null;this.color=null;this.colorAdd=null;this.u_mmat2=null;this._cacheID=t|e;this._inClassCache=ht._cache[this._cacheID];if(t>0&&!this._inClassCache){this._inClassCache=ht._cache[this._cacheID]=[];this._inClassCache._length=0}this.clear()}static _initone(t,e){ht._typeClass[t]=e;ht._cache[t]=[];ht._cache[t]._length=0}static __init__(){}setValue(t){}_ShaderWithCompile(){var t=lt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,_t.create,this._attribLocation);return t}upload(){var t=_;_.worldMatrix4===_.TEMPMAT4_ARRAY||this.defines.addInt(D.WORLDMAT);this.mmat=t.worldMatrix4;if(_.matWVP){this.defines.addInt(D.MVP3D);this.u_MvpMatrix=_.matWVP.elements}var e=lt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();if(e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height){this.size[0]=t.width;this.size[1]=t.height;e._shaderValueWidth=t.width;e._shaderValueHeight=t.height;e.upload(this,null)}else{e.upload(this,e._params2dQuick2||e._make2dQuick2())}}setFilters(t){this.filters=t;if(!t)return;var e=t.length,a;for(var i=0;i<e;i++){a=t[i];if(a){this.defines.add(a.type);a.action.setValue(this)}}}clear(){this.defines._value=this.subID;this.clipOff[0]=0}release(){if(--this.ref<1){this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this);this.clear();this.filters=null;this.ref=1;this.clipOff[0]=0}}static create(t,e){var a=ht._cache[t|e];if(a._length)return a[--a._length];else return new ht._typeClass[t|e](e)}}ht._cache=[];ht._typeClass=[];ht.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class xt{constructor(){this.clear()}clear(){this.submitType=-1;this.blendShader=this.other=0}copyFrom(t){this.other=t.other;this.blendShader=t.blendShader;this.submitType=t.submitType}copyFrom2(t,e,a){this.other=a;this.submitType=e}equal3_2(t,e,a){return this.submitType===e&&this.other===a&&this.blendShader===t.blendShader}equal4_2(t,e,a){return this.submitType===e&&this.other===a&&this.blendShader===t.blendShader}equal_3(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader}equal(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader}}class ct{constructor(){this._ref=1;this._key=new xt}renderSubmit(){this.fun.apply(this._this,this.args);return 1}getRenderType(){return 0}releaseRender(){if(--this._ref<1){var t=ct.POOL;t[t._length++]=this}}static create(t,e,a){var i=ct.POOL._length?ct.POOL[--ct.POOL._length]:new ct;i.fun=e;i.args=t;i._this=a;i._ref=1;i._key.clear();return i}}ct.POOL=[];{ct.POOL._length=0}class dt{constructor(){}get type(){return-1}}dt.BLUR=16;dt.COLOR=32;dt.GLOW=8;dt._filter=function(t,e,a,i){var r=e;var s=this._next;if(s){var n=t.filters,o=n.length;if(o==1&&n[0].type==dt.COLOR){e.save();e.setColorFilter(n[0]);s._fun.call(s,t,e,a,i);e.restore();return}var l=ht.create(D.TEXTURE2D,0);var _;var h=K.TEMP;var x=r._curMat;var c=L.create();x.copyTo(c);var d=0;var u=0;var f=false;var p=null;var m=t._cacheStyle.filterCache||null;if(!m||t.getRepaint()!=0){f=t._isHaveGlowFilter();if(f){d=50;u=25}_=new R;_.copyFrom(t.getSelfBounds());_.x+=t.x;_.y+=t.y;_.x-=t.pivotX+4;_.y-=t.pivotY+4;var g=_.x;var v=_.y;_.width+=d+8;_.height+=d+8;h.x=_.x*c.a+_.y*c.c;h.y=_.y*c.d+_.x*c.b;_.x=h.x;_.y=h.y;h.x=_.width*c.a+_.height*c.c;h.y=_.height*c.d+_.width*c.b;_.width=h.x;_.height=h.y;if(_.width<=0||_.height<=0){return}m&&st.releaseRT(m);p=st.getRT(_.width,_.height);var y=m=st.getRT(_.width,_.height);t._getCacheStyle().filterCache=m;r.pushRT();r.useRT(p);var T=t.x-g+u;var E=t.y-v+u;s._fun.call(s,t,e,T,E);r.useRT(y);for(var b=0;b<o;b++){if(b!=0){r.useRT(p);r.drawTarget(y,0,0,_.width,_.height,L.TEMP.identity(),l,null,M.TOINT.overlay);r.useRT(y)}var S=n[b];switch(S.type){case dt.BLUR:S._glRender&&S._glRender.render(p,e,_.width,_.height,S);break;case dt.GLOW:S._glRender&&S._glRender.render(p,e,_.width,_.height,S);break;case dt.COLOR:r.setColorFilter(S);r.drawTarget(p,0,0,_.width,_.height,L.EMPTY.identity(),ht.create(D.TEXTURE2D,0));r.setColorFilter(null);break}}r.popRT()}else{f=t._cacheStyle.hasGlowFilter||false;if(f){d=50;u=25}_=t.getBounds();if(_.width<=0||_.height<=0){return}_.width+=d;_.height+=d;h.x=_.x*c.a+_.y*c.c;h.y=_.y*c.d+_.x*c.b;_.x=h.x;_.y=h.y;h.x=_.width*c.a+_.height*c.c;h.y=_.height*c.d+_.width*c.b;_.width=h.x;_.height=h.y}a=a-u-t.x;i=i-u-t.y;h.setTo(a,i);c.transformPoint(h);a=h.x+_.x;i=h.y+_.y;r._drawRenderTexture(m,a,i,_.width,_.height,L.TEMP.identity(),1,rt.defuv);if(p){var C=ct.create([p],function(t){t.destroy()},this);p=null;e.addRenderObject(C)}c.destroy()}};class w{static toRadian(t){return t*w._pi2}static toAngle(t){return t*w._pi}static toHexColor(t){if(t<0||isNaN(t))return null;var e=t.toString(16);while(e.length<6)e="0"+e;return"#"+e}static getGID(){return w._gid++}static concatArray(t,e){if(!e)return t;if(!t)return e;var a,i=e.length;for(a=0;a<i;a++){t.push(e[a])}return t}static clearArray(t){if(!t)return t;t.length=0;return t}static copyArray(t,e){t||(t=[]);if(!e)return t;t.length=e.length;var a,i=e.length;for(a=0;a<i;a++){t[a]=e[a]}return t}static getGlobalRecByPoints(t,e,a,i,r){var s;s=K.create().setTo(e,a);s=t.localToGlobal(s);var n;n=K.create().setTo(i,r);n=t.localToGlobal(n);var o=R._getWrapRec([s.x,s.y,n.x,n.y]);s.recover();n.recover();return o}static getGlobalPosAndScale(t){return w.getGlobalRecByPoints(t,0,0,1,1)}static bind(t,e){var a=t;a=t.bind(e);return a}static updateOrder(t){if(!t||t.length<2)return false;var e=1,a,i=t.length,r,s;while(e<i){a=e;s=t[a];r=t[a]._zOrder;while(--a>-1){if(t[a]._zOrder>r)t[a+1]=t[a];else break}t[a+1]=s;e++}return true}static transPointList(t,e,a){var i,r=t.length;for(i=0;i<r;i+=2){t[i]+=e;t[i+1]+=a}}static parseInt(t,e=0){var a=parseInt(t,e);if(isNaN(a))return 0;return a}static getFileExtension(t){w._extReg.lastIndex=t.lastIndexOf(".");var e=w._extReg.exec(t);if(e&&e.length>1){return e[1].toLowerCase()}return null}static getFilecompatibleExtension(t){var e=t.split(".");var a=e.length;if(e.length>2)return e[a-2]+"."+e[a-1];else return null}static getTransformRelativeToWindow(t,e,a){var i=w.gStage;var r=w.getGlobalPosAndScale(t);var s=i._canvasTransform.clone();var n=s.tx;var o=s.ty;s.rotate(-Math.PI/180*i.canvasDegree);s.scale(i.clientScaleX,i.clientScaleY);var l=i.canvasDegree%180!=0;var _,h;if(l){_=a+r.y;h=e+r.x;_*=s.d;h*=s.a;if(i.canvasDegree==90){_=n-_;h+=o}else{_+=n;h=o-h}}else{_=e+r.x;h=a+r.y;_*=s.a;h*=s.d;_+=n;h+=o}h+=i["_safariOffsetY"];var x,c;if(l){x=s.d*r.height;c=s.a*r.width}else{x=s.a*r.width;c=s.d*r.height}return{x:_,y:h,scaleX:x,scaleY:c}}static fitDOMElementInArea(t,e,a,i,r,s){if(!t._fitLayaAirInitialized){t._fitLayaAirInitialized=true;t.style.transformOrigin=t.style.webKittransformOrigin="left top";t.style.position="absolute"}var n=w.getTransformRelativeToWindow(e,a,i);t.style.transform=t.style.webkitTransform="scale("+n.scaleX+","+n.scaleY+") rotate("+w.gStage.canvasDegree+"deg)";t.style.width=r+"px";t.style.height=s+"px";t.style.left=n.x+"px";t.style.top=n.y+"px"}static isOkTextureList(t){if(!t)return false;var e,a=t.length;var i;for(e=0;e<a;e++){i=t[e];if(!i||!i._getSource())return false}return true}static isOKCmdList(t){if(!t)return false;var e,a=t.length;var i;for(e=0;e<a;e++){i=t[e]}return true}static getQueryString(t){if(O.Browser.onMiniGame)return null;if(!window.location||!window.location.search)return null;var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)");var a=window.location.search.substr(1).match(e);if(a!=null)return unescape(a[2]);return null}}w.gStage=null;w._gid=1;w._pi=180/Math.PI;w._pi2=Math.PI/180;w._extReg=/\.(\w+)\??/g;w.parseXMLFromString=function(t){var e;t=t.replace(/>\s+</g,"><");e=(new DOMParser).parseFromString(t,"text/xml");if(e.firstChild.textContent.indexOf("This page contains the following errors")>-1){throw new Error(e.firstChild.firstChild.textContent)}return e};class ut{constructor(t){this.arrColor=[];if(t==null||t=="none"){this.strColor="#00000000";this.numColor=0;this.arrColor=[0,0,0,0];return}var e,a;var i;if(typeof t=="string"){if(t.indexOf("rgba(")>=0||t.indexOf("rgb(")>=0){var r=t;var s,n;s=r.indexOf("(");n=r.indexOf(")");r=r.substring(s+1,n);this.arrColor=r.split(",");a=this.arrColor.length;for(e=0;e<a;e++){this.arrColor[e]=parseFloat(this.arrColor[e]);if(e<3){this.arrColor[e]=Math.round(this.arrColor[e])}}if(this.arrColor.length==4){i=((this.arrColor[0]*256+this.arrColor[1])*256+this.arrColor[2])*256+Math.round(this.arrColor[3]*255)}else{i=(this.arrColor[0]*256+this.arrColor[1])*256+this.arrColor[2]}this.strColor=t}else{this.strColor=t;t.charAt(0)==="#"&&(t=t.substr(1));a=t.length;if(a===3||a===4){var o="";for(e=0;e<a;e++){o+=t[e]+t[e]}t=o}i=parseInt(t,16)}}else{i=t;this.strColor=w.toHexColor(i)}if(this.strColor.indexOf("rgba")>=0||this.strColor.length===9){this.arrColor=[((4278190080&i)>>>24)/255,((16711680&i)>>16)/255,((65280&i)>>8)/255,(255&i)/255];this.numColor=(4278190080&i)>>>24|(i&16711680)>>8|(i&65280)<<8|(i&255)<<24}else{this.arrColor=[((16711680&i)>>16)/255,((65280&i)>>8)/255,(255&i)/255,1];this.numColor=4278190080|(i&16711680)>>16|i&65280|(i&255)<<16}this.arrColor.__id=++ut._COLODID}static _initDefault(){ut._DEFAULT={};for(var t in ut._COLOR_MAP)ut._SAVE[t]=ut._DEFAULT[t]=new ut(ut._COLOR_MAP[t]);return ut._DEFAULT}static _initSaveMap(){ut._SAVE_SIZE=0;ut._SAVE={};for(var t in ut._DEFAULT)ut._SAVE[t]=ut._DEFAULT[t]}static create(t){var e=t+"";var a=ut._SAVE[e];if(a!=null)return a;if(ut._SAVE_SIZE<1e3)ut._initSaveMap();return ut._SAVE[e]=new ut(t)}}ut._SAVE={};ut._SAVE_SIZE=0;ut._COLOR_MAP={purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"};ut._DEFAULT=ut._initDefault();ut._COLODID=1;class ft extends dt{constructor(t=null){super();if(!t)t=this._copyMatrix(ft.IDENTITY_MATRIX);this._mat=new Float32Array(16);this._alpha=new Float32Array(4);this.setByMatrix(t)}gray(){return this.setByMatrix(ft.GRAY_MATRIX)}color(t=0,e=0,a=0,i=1){return this.setByMatrix([1,0,0,0,t,0,1,0,0,e,0,0,1,0,a,0,0,0,1,i])}setColor(t){var e=ut.create(t).arrColor;var a=[0,0,0,0,256*e[0],0,0,0,0,256*e[1],0,0,0,0,256*e[2],0,0,0,1,0];return this.setByMatrix(a)}setByMatrix(t){if(this._matrix!=t)this._copyMatrix(t);var e=0;var a=0;for(var i=0;i<20;i++){if(i%5!=4){this._mat[e++]=t[i]}else{this._alpha[a++]=t[i]}}return this}get type(){return dt.COLOR}adjustColor(t,e,a,i){this.adjustHue(i);this.adjustContrast(e);this.adjustBrightness(t);this.adjustSaturation(a);return this}adjustBrightness(t){t=this._clampValue(t,100);if(t==0||isNaN(t))return this;return this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])}adjustContrast(t){t=this._clampValue(t,100);if(t==0||isNaN(t))return this;var e;if(t<0){e=127+t/100*127}else{e=t%1;if(e==0){e=ft.DELTA_INDEX[t]}else{e=ft.DELTA_INDEX[t<<0]*(1-e)+ft.DELTA_INDEX[(t<<0)+1]*e}e=e*127+127}var a=e/127;var i=(127-e)*.5;return this._multiplyMatrix([a,0,0,0,i,0,a,0,0,i,0,0,a,0,i,0,0,0,1,0,0,0,0,0,1])}adjustSaturation(t){t=this._clampValue(t,100);if(t==0||isNaN(t))return this;var e=1+(t>0?3*t/100:t/100);var a=1-e;var i=.3086*a;var r=.6094*a;var s=.082*a;return this._multiplyMatrix([i+e,r,s,0,0,i,r+e,s,0,0,i,r,s+e,0,0,0,0,0,1,0,0,0,0,0,1])}adjustHue(t){t=this._clampValue(t,180)/180*Math.PI;if(t==0||isNaN(t))return this;var e=Math.cos(t);var a=Math.sin(t);var i=.213;var r=.715;var s=.072;return this._multiplyMatrix([i+e*(1-i)+a*-i,r+e*-r+a*-r,s+e*-s+a*(1-s),0,0,i+e*-i+a*.143,r+e*(1-r)+a*.14,s+e*-s+a*-.283,0,0,i+e*-i+a*-(1-i),r+e*-r+a*r,s+e*(1-s)+a*s,0,0,0,0,0,1,0,0,0,0,0,1])}reset(){return this.setByMatrix(this._copyMatrix(ft.IDENTITY_MATRIX))}_multiplyMatrix(t){var e=[];this._matrix=this._fixMatrix(this._matrix);for(var a=0;a<5;a++){for(var i=0;i<5;i++){e[i]=this._matrix[i+a*5]}for(i=0;i<5;i++){var r=0;for(var s=0;s<5;s++){r+=t[i+s*5]*e[s]}this._matrix[i+a*5]=r}}return this.setByMatrix(this._matrix)}_clampValue(t,e){return Math.min(e,Math.max(-e,t))}_fixMatrix(t=null){if(t==null)return ft.IDENTITY_MATRIX;if(t.length<ft.LENGTH)t=t.slice(0,t.length).concat(ft.IDENTITY_MATRIX.slice(t.length,ft.LENGTH));else if(t.length>ft.LENGTH)t=t.slice(0,ft.LENGTH);return t}_copyMatrix(t){var e=ft.LENGTH;if(!this._matrix)this._matrix=[];for(var a=0;a<e;a++){this._matrix[a]=t[a]}return this._matrix}}ft.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];ft.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0];ft.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];ft.LENGTH=25;class pt{constructor(){this.colorFlt=null;this.uv=null}static create(t,e,a,i,r,s,n,o,l,_){var h=u.getItemByClass("DrawTextureCmd",pt);h.texture=t;t._addReference();h.x=e;h.y=a;h.width=i;h.height=r;h.matrix=s;h.alpha=n;h.color=o;h.blendMode=l;h.uv=_==undefined?null:_;if(o){h.colorFlt=new ft;h.colorFlt.setColor(o)}return h}recover(){this.texture&&this.texture._removeReference();this.texture=null;this.matrix=null;u.recover("DrawTextureCmd",this)}run(t,e,a){this.texture&&t.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,e,a,this.alpha,this.blendMode,this.colorFlt,this.uv)}get cmdID(){return pt.ID}}pt.ID="DrawTexture";class mt{static create(t,e,a,i,r,s,n,o){var l=u.getItemByClass("FillTextureCmd",mt);l.texture=t;l.x=e;l.y=a;l.width=i;l.height=r;l.type=s;l.offset=n;l.other=o;return l}recover(){this.texture=null;this.offset=null;this.other=null;u.recover("FillTextureCmd",this)}run(t,e,a){t.fillTexture(this.texture,this.x+e,this.y+a,this.width,this.height,this.type,this.offset,this.other)}get cmdID(){return mt.ID}}mt.ID="FillTexture";class gt{static create(){var t=u.getItemByClass("RestoreCmd",gt);return t}recover(){u.recover("RestoreCmd",this)}run(t,e,a){t.restore()}get cmdID(){return gt.ID}}gt.ID="Restore";class vt{static create(t,e,a){var i=u.getItemByClass("RotateCmd",vt);i.angle=t;i.pivotX=e;i.pivotY=a;return i}recover(){u.recover("RotateCmd",this)}run(t,e,a){t._rotate(this.angle,this.pivotX+e,this.pivotY+a)}get cmdID(){return vt.ID}}vt.ID="Rotate";class yt{static create(t,e,a,i){var r=u.getItemByClass("ScaleCmd",yt);r.scaleX=t;r.scaleY=e;r.pivotX=a;r.pivotY=i;return r}recover(){u.recover("ScaleCmd",this)}run(t,e,a){t._scale(this.scaleX,this.scaleY,this.pivotX+e,this.pivotY+a)}get cmdID(){return yt.ID}}yt.ID="Scale";class Tt{static create(t,e,a){var i=u.getItemByClass("TransformCmd",Tt);i.matrix=t;i.pivotX=e;i.pivotY=a;return i}recover(){this.matrix=null;u.recover("TransformCmd",this)}run(t,e,a){t._transform(this.matrix,this.pivotX+e,this.pivotY+a)}get cmdID(){return Tt.ID}}Tt.ID="Transform";class Et{static create(t,e){var a=u.getItemByClass("TranslateCmd",Et);a.tx=t;a.ty=e;return a}recover(){u.recover("TranslateCmd",this)}run(t,e,a){t.translate(this.tx,this.ty)}get cmdID(){return Et.ID}}Et.ID="Translate";class bt{constructor(){this._controlPoints=[new K,new K,new K];this._calFun=this.getPoint2}_switchPoint(t,e){var a=this._controlPoints.shift();a.setTo(t,e);this._controlPoints.push(a)}getPoint2(t,e){var a=this._controlPoints[0];var i=this._controlPoints[1];var r=this._controlPoints[2];var s=Math.pow(1-t,2)*a.x+2*t*(1-t)*i.x+Math.pow(t,2)*r.x;var n=Math.pow(1-t,2)*a.y+2*t*(1-t)*i.y+Math.pow(t,2)*r.y;e.push(s,n)}getPoint3(t,e){var a=this._controlPoints[0];var i=this._controlPoints[1];var r=this._controlPoints[2];var s=this._controlPoints[3];var n=Math.pow(1-t,3)*a.x+3*i.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+s.x*Math.pow(t,3);var o=Math.pow(1-t,3)*a.y+3*i.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+s.y*Math.pow(t,3);e.push(n,o)}insertPoints(t,e){var a;t=t>0?t:5;var i;i=1/t;for(a=0;a<=1;a+=i){this._calFun(a,e)}}getBezierPoints(t,e=5,a=2){var i,r;r=t.length;if(r<(a+1)*2)return[];var s=[];switch(a){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}while(this._controlPoints.length<=a){this._controlPoints.push(K.create())}for(i=0;i<a*2;i+=2){this._switchPoint(t[i],t[i+1])}for(i=a*2;i<r;i+=2){this._switchPoint(t[i],t[i+1]);if(i/2%a==0)this.insertPoints(e,s)}return s}}bt.I=new bt;class St{static multiply(t,e,a){return(t.x-a.x)*(e.y-a.y)-(e.x-a.x)*(t.y-a.y)}static dis(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}static _getPoints(t,e=false,a=null){if(!St._mPointList)St._mPointList=[];while(St._mPointList.length<t)St._mPointList.push(new K);if(!a)a=[];a.length=0;if(e){St.getFrom(a,St._mPointList,t)}else{St.getFromR(a,St._mPointList,t)}return a}static getFrom(t,e,a){var i;for(i=0;i<a;i++){t.push(e[i])}return t}static getFromR(t,e,a){var i;for(i=0;i<a;i++){t.push(e.pop())}return t}static pListToPointList(t,e=false){var a,i=t.length/2,r=St._getPoints(i,e,St._tempPointList);for(a=0;a<i;a++){r[a].setTo(t[a+a],t[a+a+1])}return r}static pointListToPlist(t){var e,a=t.length,i=St._temPList,r;i.length=0;for(e=0;e<a;e++){r=t[e];i.push(r.x,r.y)}return i}static scanPList(t){return w.copyArray(t,St.pointListToPlist(St.scan(St.pListToPointList(t,true))))}static scan(t){var e,a,i=0,r,s=t.length,n;var o={};var l;n=St._temArr;n.length=0;s=t.length;for(e=s-1;e>=0;e--){r=t[e];l=r.x+"_"+r.y;if(!(l in o)){o[l]=true;n.push(r)}}s=n.length;w.copyArray(t,n);for(e=1;e<s;e++)if(t[e].y<t[i].y||t[e].y==t[i].y&&t[e].x<t[i].x)i=e;r=t[0];t[0]=t[i];t[i]=r;for(e=1;e<s-1;e++){i=e;for(a=e+1;a<s;a++)if(St.multiply(t[a],t[i],t[0])>0||St.multiply(t[a],t[i],t[0])==0&&St.dis(t[0],t[a])<St.dis(t[0],t[i]))i=a;r=t[e];t[e]=t[i];t[i]=r}n=St._temArr;n.length=0;if(t.length<3){return w.copyArray(n,t)}n.push(t[0],t[1],t[2]);for(e=3;e<s;e++){while(n.length>=2&&St.multiply(t[e],n[n.length-1],n[n.length-2])>=0)n.pop();t[e]&&n.push(t[e])}return n}}St._tempPointList=[];St._temPList=[];St._temArr=[];class Ct{constructor(t){this.setValue(t)}static create(t){if(t){var e=t instanceof ut?t:ut.create(t);return e._drawStyle||(e._drawStyle=new Ct(t))}return Ct.DEFAULT}setValue(t){if(t){this._color=t instanceof ut?t:ut.create(t)}else this._color=ut.create("#000000")}reset(){this._color=ut.create("#000000")}toInt(){return this._color.numColor}equal(t){if(typeof t=="string")return this._color.strColor===t;if(t instanceof ut)return this._color.numColor===t.numColor;return false}toColorStr(){return this._color.strColor}}Ct.DEFAULT=new Ct("#000000");class Rt{constructor(){this._lastOriX=0;this._lastOriY=0;this.paths=[];this._curPath=null}beginPath(t){this.paths.length=1;this._curPath=this.paths[0]=new At;this._curPath.convex=t}closePath(){this._curPath.loop=true}newPath(){this._curPath=new At;this.paths.push(this._curPath)}addPoint(t,e){this._curPath.path.push(t,e)}push(t,e){if(!this._curPath){this._curPath=new At;this.paths.push(this._curPath)}else if(this._curPath.path.length>0){this._curPath=new At;this.paths.push(this._curPath)}var a=this._curPath;a.path=t.slice();a.convex=e}reset(){this.paths.length=0}}class At{constructor(){this.path=[];this.loop=false;this.convex=false}}class C{constructor(t=C.TYPE_2D){this.clipInfoID=-1;this._mesh=null;this._blendFn=null;this._id=0;this._renderType=0;this._parent=null;this._key=new xt;this._startIdx=0;this._numEle=0;this._ref=1;this.shaderValue=null;this._renderType=t;this._id=++C.ID}static __init__(){var t=C.RENDERBASE=new C(-1);t.shaderValue=new ht(0,0);t.shaderValue.ALPHA=1;t._ref=4294967295}getID(){return this._id}getRenderType(){return this._renderType}toString(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key}renderSubmit(){return 1}releaseRender(){}}C.TYPE_2D=1e4;C.TYPE_CANVAS=10003;C.TYPE_CMDSETRT=10004;C.TYPE_CUSTOM=10005;C.TYPE_BLURRT=10006;C.TYPE_CMDDESTORYPRERT=10007;C.TYPE_DISABLESTENCIL=10008;C.TYPE_OTHERIBVB=10009;C.TYPE_PRIMITIVE=10010;C.TYPE_RT=10011;C.TYPE_BLUR_RT=10012;C.TYPE_TARGET=10013;C.TYPE_CHANGE_VALUE=10014;C.TYPE_SHAPE=10015;C.TYPE_TEXTURE=10016;C.TYPE_FILLTEXTURE=10017;C.KEY_ONCE=-1;C.KEY_FILLRECT=1;C.KEY_DRAWTEXTURE=2;C.KEY_VG=3;C.KEY_TRIANGLES=4;C.ID=1;C.preRender=null;class o{constructor(){}static _createArray(){var t=[];t._length=0;return t}static _init(){var t=o._namemap={};t[o.TYPE_ALPHA]="ALPHA";t[o.TYPE_FILESTYLE]="fillStyle";t[o.TYPE_FONT]="font";t[o.TYPE_LINEWIDTH]="lineWidth";t[o.TYPE_STROKESTYLE]="strokeStyle";t[o.TYPE_ENABLEMERGE]="_mergeID";t[o.TYPE_MARK]=t[o.TYPE_TRANSFORM]=t[o.TYPE_TRANSLATE]=[];t[o.TYPE_TEXTBASELINE]="textBaseline";t[o.TYPE_TEXTALIGN]="textAlign";t[o.TYPE_GLOBALCOMPOSITEOPERATION]="_nBlendType";t[o.TYPE_SHADER]="shader";t[o.TYPE_FILTERS]="filters";t[o.TYPE_COLORFILTER]="_colorFiler";return t}isSaveMark(){return false}restore(t){this._dataObj[this._valueName]=this._value;o.POOL[o.POOL._length++]=this;this._newSubmit&&(t._curSubmit=C.RENDERBASE)}static save(t,e,a,i){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=o.POOL;var s=r._length>0?r[--r._length]:new o;s._value=a[s._valueName=o._namemap[e]];s._dataObj=a;s._newSubmit=i;var n=t._save;n[n._length++]=s}}}o.TYPE_ALPHA=1;o.TYPE_FILESTYLE=2;o.TYPE_FONT=8;o.TYPE_LINEWIDTH=256;o.TYPE_STROKESTYLE=512;o.TYPE_MARK=1024;o.TYPE_TRANSFORM=2048;o.TYPE_TRANSLATE=4096;o.TYPE_ENABLEMERGE=8192;o.TYPE_TEXTBASELINE=16384;o.TYPE_TEXTALIGN=32768;o.TYPE_GLOBALCOMPOSITEOPERATION=65536;o.TYPE_CLIPRECT=131072;o.TYPE_CLIPRECT_STENCIL=262144;o.TYPE_IBVB=524288;o.TYPE_SHADER=1048576;o.TYPE_FILTERS=2097152;o.TYPE_FILTERS_TYPE=4194304;o.TYPE_COLORFILTER=8388608;o.POOL=o._createArray();o._namemap=o._init();class Lt{constructor(){this._globalClipMatrix=new L;this._clipInfoID=-1;this._clipRect=new R;this.incache=false}isSaveMark(){return false}restore(t){this._globalClipMatrix.copyTo(t._globalClipMatrix);this._clipRect.clone(t._clipRect);t._clipInfoID=this._clipInfoID;Lt.POOL[Lt.POOL._length++]=this;t._clipInCache=this.incache}static save(t){if((t._saveMark._saveuse&o.TYPE_CLIPRECT)==o.TYPE_CLIPRECT)return;t._saveMark._saveuse|=o.TYPE_CLIPRECT;var e=Lt.POOL;var a=e._length>0?e[--e._length]:new Lt;t._globalClipMatrix.copyTo(a._globalClipMatrix);t._clipRect.clone(a._clipRect);a._clipInfoID=t._clipInfoID;a.incache=t._clipInCache;var i=t._save;i[i._length++]=a}}Lt.POOL=o._createArray();class It{constructor(){this._saveuse=0}isSaveMark(){return true}restore(t){t._saveMark=this._preSaveMark;It.POOL[It.POOL._length++]=this}static Create(t){var e=It.POOL;var a=e._length>0?e[--e._length]:new It;a._saveuse=0;a._preSaveMark=t._saveMark;t._saveMark=a;return a}}It.POOL=o._createArray();class Mt{constructor(){this._matrix=new L}isSaveMark(){return false}restore(t){t._curMat=this._savematrix;Mt.POOL[Mt.POOL._length++]=this}static save(t){var e=t._saveMark;if((e._saveuse&o.TYPE_TRANSFORM)===o.TYPE_TRANSFORM)return;e._saveuse|=o.TYPE_TRANSFORM;var a=Mt.POOL;var i=a._length>0?a[--a._length]:new Mt;i._savematrix=t._curMat;t._curMat=t._curMat.copyTo(i._matrix);var r=t._save;r[r._length++]=i}}Mt.POOL=o._createArray();class Dt{constructor(){this._mat=new L}isSaveMark(){return false}restore(t){this._mat.copyTo(t._curMat);Dt.POOL[Dt.POOL._length++]=this}static save(t){var e=Dt.POOL;var a=e._length>0?e[--e._length]:new Dt;t._curMat.copyTo(a._mat);var i=t._save;i[i._length++]=a}}Dt.POOL=o._createArray();class wt{constructor(){this._nativeVertexArrayObject=f.layaGPUInstance.createVertexArray()}bind(){if(wt._curBindedBufferState!==this){f.layaGPUInstance.bindVertexArray(this._nativeVertexArrayObject);wt._curBindedBufferState=this}}unBind(){if(wt._curBindedBufferState===this){f.layaGPUInstance.bindVertexArray(null);wt._curBindedBufferState=null}else{throw"BufferState: must call bind() function first."}}destroy(){f.layaGPUInstance.deleteVertexArray(this._nativeVertexArrayObject)}bindForNative(){f.instance.bindVertexArray(this._nativeVertexArrayObject);wt._curBindedBufferState=this}unBindForNative(){f.instance.bindVertexArray(null);wt._curBindedBufferState=null}}class Pt extends wt{constructor(){super()}}class Ot{constructor(){this._byteLength=0;this._glBuffer=f.instance.createBuffer()}get bufferUsage(){return this._bufferUsage}_bindForVAO(){}bind(){return false}destroy(){if(this._glBuffer){f.instance.deleteBuffer(this._glBuffer);this._glBuffer=null}}}class Nt{}Nt.loopStTm=0;Nt.loopCount=0;class Bt extends Ot{constructor(){super();this._maxsize=0;this._upload=true;this._uploadSize=0;this._bufferSize=0;this._u8Array=null}static __int__(t){}get bufferLength(){return this._buffer.byteLength}set byteLength(t){this.setByteLength(t)}setByteLength(t){if(this._byteLength!==t){t<=this._bufferSize||this._resizeBuffer(t*2+256,true);this._byteLength=t}}needSize(t){var e=this._byteLength;if(t){var a=this._byteLength+t;a<=this._bufferSize||this._resizeBuffer(a<<1,true);this._byteLength=a}return e}_bufferData(){this._maxsize=Math.max(this._maxsize,this._byteLength);if(Nt.loopCount%30==0){if(this._buffer.byteLength>this._maxsize+64){this._buffer=this._buffer.slice(0,this._maxsize+64);this._bufferSize=this._buffer.byteLength;this._checkArrayUse()}this._maxsize=this._byteLength}if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;f.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)}f.instance.bufferSubData(this._bufferType,0,new Uint8Array(this._buffer,0,this._byteLength))}_bufferSubData(t=0,e=0,a=0){this._maxsize=Math.max(this._maxsize,this._byteLength);if(Nt.loopCount%30==0){if(this._buffer.byteLength>this._maxsize+64){this._buffer=this._buffer.slice(0,this._maxsize+64);this._bufferSize=this._buffer.byteLength;this._checkArrayUse()}this._maxsize=this._byteLength}if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;f.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)}if(e||a){var i=this._buffer.slice(e,a);f.instance.bufferSubData(this._bufferType,t,i)}else{f.instance.bufferSubData(this._bufferType,t,this._buffer)}}_checkArrayUse(){}_bind_uploadForVAO(){if(!this._upload)return false;this._upload=false;this._bindForVAO();this._bufferData();return true}_bind_upload(){if(!this._upload)return false;this._upload=false;this.bind();this._bufferData();return true}_bind_subUpload(t=0,e=0,a=0){if(!this._upload)return false;this._upload=false;this.bind();this._bufferSubData(t,e,a);return true}_resizeBuffer(t,e){var a=this._buffer;if(t<=a.byteLength)return this;var i=this._u8Array;if(e&&a&&a.byteLength>0){var r=new ArrayBuffer(t);var s=i&&i.buffer==a?i:new Uint8Array(a);i=this._u8Array=new Uint8Array(r);i.set(s,0);a=this._buffer=r}else{a=this._buffer=new ArrayBuffer(t);this._u8Array=null}this._checkArrayUse();this._upload=true;this._bufferSize=a.byteLength;return this}append(t){this._upload=true;var e,a;e=t.byteLength;if(t instanceof Uint8Array){this._resizeBuffer(this._byteLength+e,true);a=new Uint8Array(this._buffer,this._byteLength)}else if(t instanceof Uint16Array){this._resizeBuffer(this._byteLength+e,true);a=new Uint16Array(this._buffer,this._byteLength)}else if(t instanceof Float32Array){this._resizeBuffer(this._byteLength+e,true);a=new Float32Array(this._buffer,this._byteLength)}a.set(t,0);this._byteLength+=e;this._checkArrayUse()}appendU16Array(t,e){this._resizeBuffer(this._byteLength+e*2,true);var a=new Uint16Array(this._buffer,this._byteLength,e);if(e==6){a[0]=t[0];a[1]=t[1];a[2]=t[2];a[3]=t[3];a[4]=t[4];a[5]=t[5]}else if(e>=100){a.set(new Uint16Array(t.buffer,0,e))}else{for(var i=0;i<e;i++){a[i]=t[i]}}this._byteLength+=e*2;this._checkArrayUse()}appendEx(t,e){this._upload=true;var a,i;a=t.byteLength;this._resizeBuffer(this._byteLength+a,true);i=new e(this._buffer,this._byteLength);i.set(t,0);this._byteLength+=a;this._checkArrayUse()}appendEx2(t,e,a,i=1){this._upload=true;var r,s;r=a*i;this._resizeBuffer(this._byteLength+r,true);s=new e(this._buffer,this._byteLength);var n;for(n=0;n<a;n++){s[n]=t[n]}this._byteLength+=r;this._checkArrayUse()}getBuffer(){return this._buffer}setNeedUpload(){this._upload=true}getNeedUpload(){return this._upload}upload(){var t=f.instance;var e=this._bind_upload();t.bindBuffer(this._bufferType,null);if(this._bufferType==t.ARRAY_BUFFER)Ot._bindedVertexBuffer=null;if(this._bufferType==t.ELEMENT_ARRAY_BUFFER)Ot._bindedIndexBuffer=null;it.activeShader=null;return e}subUpload(t=0,e=0,a=0){var i=f.instance;var r=this._bind_subUpload();i.bindBuffer(this._bufferType,null);if(this._bufferType==i.ARRAY_BUFFER)Ot._bindedVertexBuffer=null;if(this._bufferType==i.ELEMENT_ARRAY_BUFFER)Ot._bindedIndexBuffer=null;it.activeShader=null;return r}_disposeResource(){this._upload=true;this._uploadSize=0}clear(){this._byteLength=0;this._upload=true}}Bt.FLOAT32=4;Bt.SHORT=2;class Ft extends Bt{constructor(t=35044){super();this._bufferUsage=t;this._bufferType=f.instance.ELEMENT_ARRAY_BUFFER;this._buffer=new ArrayBuffer(8)}_checkArrayUse(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))}getUint16Array(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))}_bindForVAO(){var t=f.instance;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer)}bind(){if(Ot._bindedIndexBuffer!==this._glBuffer){var t=f.instance;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer);Ot._bindedIndexBuffer=this._glBuffer;return true}return false}destory(){this._uint16Array=null;this._buffer=null}disposeResource(){this._disposeResource()}}Ft.create=function(t=35044){return new Ft(t)};class Vt extends Bt{constructor(t,e){super();this._vertexStride=t;this._bufferUsage=e;this._bufferType=f.instance.ARRAY_BUFFER;this._buffer=new ArrayBuffer(8);this._floatArray32=new Float32Array(this._buffer);this._uint32Array=new Uint32Array(this._buffer)}get vertexStride(){return this._vertexStride}getFloat32Array(){return this._floatArray32}appendArray(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+t.length*4);var a=this.getFloat32Array();a.set(t,e);this._upload=true}_checkArrayUse(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer));this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))}deleteBuffer(){super._disposeResource()}_bindForVAO(){var t=f.instance;t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer)}bind(){if(Ot._bindedVertexBuffer!==this._glBuffer){var t=f.instance;t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer);Ot._bindedVertexBuffer=this._glBuffer;return true}return false}destroy(){super.destroy();this._byteLength=0;this._upload=true;this._buffer=null;this._floatArray32=null}}Vt.create=function(t,e=35048){return new Vt(t,e)};class Ut{constructor(t,e,a){this._stride=0;this.vertNum=0;this.indexNum=0;this._applied=false;this._quadNum=0;this.canReuse=false;this._stride=t;this._vb=new Vt(t,f.instance.DYNAMIC_DRAW);if(e){this._vb._resizeBuffer(e,false)}else{n.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(64*1024*t,false)}this._ib=new Ft;if(a){this._ib._resizeBuffer(a,false)}}cloneWithNewVB(){var t=new Ut(this._stride,0,0);t._ib=this._ib;t._quadNum=this._quadNum;t._attribInfo=this._attribInfo;return t}cloneWithNewVBIB(){var t=new Ut(this._stride,0,0);t._attribInfo=this._attribInfo;return t}getVBW(){this._vb.setNeedUpload();return this._vb}getVBR(){return this._vb}getIBR(){return this._ib}getIBW(){this._ib.setNeedUpload();return this._ib}createQuadIB(t){this._quadNum=t;this._ib._resizeBuffer(t*6*2,false);this._ib.byteLength=this._ib.bufferLength;var e=this._ib.getUint16Array();var a=0;var i=0;for(var r=0;r<t;r++){e[a++]=i;e[a++]=i+2;e[a++]=i+1;e[a++]=i;e[a++]=i+3;e[a++]=i+2;i+=4}this._ib.setNeedUpload()}setAttributes(t){this._attribInfo=t;if(this._attribInfo.length%3!=0){throw"Mesh2D setAttributes error!"}}configVAO(t){if(this._applied)return;this._applied=true;if(!this._vao){this._vao=new Pt}this._vao.bind();this._vb._bindForVAO();this._ib.setNeedUpload();this._ib._bind_uploadForVAO();var e=this._attribInfo.length/3;var a=0;for(var i=0;i<e;i++){var r=this._attribInfo[a+1];var s=this._attribInfo[a];var n=this._attribInfo[a+2];t.enableVertexAttribArray(i);t.vertexAttribPointer(i,r,s,false,this._stride,n);a+=3}this._vao.unBind()}useMesh(t){this._applied||this.configVAO(t);this._vao.bind();this._vb.bind();this._ib._bind_upload()||this._ib.bind();this._vb._bind_upload()||this._vb.bind()}getEleNum(){return this._ib.getBuffer().byteLength/2}releaseMesh(){}destroy(){}clearVB(){this._vb.clear()}}Ut._gvaoid=0;class kt extends Ut{constructor(){super(kt.const_stride,4,4);this.canReuse=true;this.setAttributes(kt._fixattriInfo);if(!kt._fixib){this.createQuadIB(kt._maxIB);kt._fixib=this._ib}else{this._ib=kt._fixib;this._quadNum=kt._maxIB}}static __int__(){kt._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}static getAMesh(t){var e=null;if(kt._POOL.length){e=kt._POOL.pop()}else e=new kt;t&&e._vb._resizeBuffer(64*1024*kt.const_stride,false);return e}releaseMesh(){this._vb.setByteLength(0);this.vertNum=0;this.indexNum=0;kt._POOL.push(this)}destroy(){this._vb.destroy();this._vb.deleteBuffer()}addQuad(t,e,a,i){var r=this._vb;var s=r._byteLength>>2;r.setByteLength(s+kt.const_stride<<2);var n=r._floatArray32||r.getFloat32Array();var o=r._uint32Array;var l=s;var _=i?255:0;n[l++]=t[0];n[l++]=t[1];n[l++]=e[0];n[l++]=e[1];o[l++]=a;o[l++]=_;n[l++]=t[2];n[l++]=t[3];n[l++]=e[2];n[l++]=e[3];o[l++]=a;o[l++]=_;n[l++]=t[4];n[l++]=t[5];n[l++]=e[4];n[l++]=e[5];o[l++]=a;o[l++]=_;n[l++]=t[6];n[l++]=t[7];n[l++]=e[6];n[l++]=e[7];o[l++]=a;o[l++]=_;r._upload=true}}kt.const_stride=24;kt._maxIB=16*1024;kt._POOL=[];class Gt extends Ut{constructor(){super(Gt.const_stride,4,4);this.canReuse=true;this.setAttributes(Gt._fixattriInfo)}static __init__(){Gt._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}static getAMesh(t){var e;if(Gt._POOL.length){e=Gt._POOL.pop()}else e=new Gt;t&&e._vb._resizeBuffer(64*1024*Gt.const_stride,false);return e}addData(t,e,a,i,r){var s=this._vb;var n=this._ib;var o=t.length>>1;var l=s.needSize(o*Gt.const_stride);var _=l>>2;var h=s._floatArray32||s.getFloat32Array();var x=s._uint32Array;var c=0;var d=i.a;var u=i.b;var f=i.c;var p=i.d;var m=i.tx;var g=i.ty;var v=0;for(v=0;v<o;v++){var y=t[c],T=t[c+1];h[_]=y*d+T*f+m;h[_+1]=y*u+T*p+g;h[_+2]=e[c];h[_+3]=e[c+1];x[_+4]=r;x[_+5]=255;_+=6;c+=2}s.setNeedUpload();var E=this.vertNum;var b=a.length;var S=n.needSize(a.byteLength);var C=n.getUint16Array();var R=S>>1;if(E>0){var A=R+b;var L=0;for(v=R;v<A;v++,L++){C[v]=a[L]+E}}else{C.set(a,R)}n.setNeedUpload();this.vertNum+=o;this.indexNum+=a.length}releaseMesh(){this._vb.setByteLength(0);this._ib.setByteLength(0);this.vertNum=0;this.indexNum=0;Gt._POOL.push(this)}destroy(){this._ib.destroy();this._vb.destroy();this._ib.disposeResource();this._vb.deleteBuffer()}}Gt.const_stride=24;Gt._POOL=[];class Ht extends Ut{constructor(){super(Ht.const_stride,4,4);this.canReuse=true;this.setAttributes(Ht._fixattriInfo)}static __init__(){Ht._fixattriInfo=[5126,2,0,5121,4,8]}static getAMesh(t){var e;if(Ht._POOL.length){e=Ht._POOL.pop()}else e=new Ht;t&&e._vb._resizeBuffer(64*1024*Ht.const_stride,false);return e}addVertAndIBToMesh(t,e,a,i){var r=this._vb.needSize(e.length/2*Ht.const_stride);var s=r>>2;var n=this._vb._floatArray32||this._vb.getFloat32Array();var o=this._vb._uint32Array;var l=0;var _=e.length/2;for(var h=0;h<_;h++){n[s++]=e[l];n[s++]=e[l+1];l+=2;o[s++]=a}this._vb.setNeedUpload();this._ib.append(new Uint16Array(i));this._ib.setNeedUpload();this.vertNum+=_;this.indexNum+=i.length}releaseMesh(){this._vb.setByteLength(0);this._ib.setByteLength(0);this.vertNum=0;this.indexNum=0;Ht._POOL.push(this)}destroy(){this._ib.destroy();this._vb.destroy();this._ib.disposeResource();this._vb.deleteBuffer()}}Ht.const_stride=12;Ht._POOL=[];class zt{constructor(t,e){this.submitStartPos=0;this.submitEndPos=0;this.touches=[];this.submits=[];this.sprite=null;this.meshlist=[];this.cachedClipInfo=new L;this.oldTx=0;this.oldTy=0;this.invMat=new L;this.context=t;this.sprite=e;t._globalClipMatrix.copyTo(this.cachedClipInfo)}startRec(){let t=this.context;if(t._charSubmitCache&&t._charSubmitCache._enable){t._charSubmitCache.enable(false,t);t._charSubmitCache.enable(true,t)}t._incache=true;this.touches.length=0;t.touches=this.touches;t._globalClipMatrix.copyTo(this.cachedClipInfo);this.submits.length=0;this.submitStartPos=t._submits._length;for(var e=0,a=this.meshlist.length;e<a;e++){var i=this.meshlist[e];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0;this._mesh=kt.getAMesh(false);this._pathMesh=Ht.getAMesh(false);this._triangleMesh=Gt.getAMesh(false);this.meshlist.push(this._mesh);this.meshlist.push(this._pathMesh);this.meshlist.push(this._triangleMesh);t._curSubmit=C.RENDERBASE;this._oldMesh=t._mesh;this._oldPathMesh=t._pathMesh;this._oldTriMesh=t._triangleMesh;this._oldMeshList=t.meshlist;t._mesh=this._mesh;t._pathMesh=this._pathMesh;t._triangleMesh=this._triangleMesh;t.meshlist=this.meshlist;this.oldTx=t._curMat.tx;this.oldTy=t._curMat.ty;t._curMat.tx=0;t._curMat.ty=0;t._curMat.copyTo(this.invMat);this.invMat.invert()}endRec(){let t=this.context;if(t._charSubmitCache&&t._charSubmitCache._enable){t._charSubmitCache.enable(false,t);t._charSubmitCache.enable(true,t)}var e=t._submits;this.submitEndPos=e._length;var a=this.submitEndPos-this.submitStartPos;for(var i=0;i<a;i++){this.submits.push(e[this.submitStartPos+i])}e._length-=a;t._mesh=this._oldMesh;t._pathMesh=this._oldPathMesh;t._triangleMesh=this._oldTriMesh;t.meshlist=this._oldMeshList;t._curSubmit=C.RENDERBASE;t._curMat.tx=this.oldTx;t._curMat.ty=this.oldTy;t.touches=null;t._incache=false}isCacheValid(){var t=this.context._globalClipMatrix;if(t.a!=this.cachedClipInfo.a||t.b!=this.cachedClipInfo.b||t.c!=this.cachedClipInfo.c||t.d!=this.cachedClipInfo.d||t.tx!=this.cachedClipInfo.tx||t.ty!=this.cachedClipInfo.ty)return false;return true}flushsubmit(){var e=C.RENDERBASE;this.submits.forEach(function(t){if(t==C.RENDERBASE)return;C.preRender=e;e=t;t.renderSubmit()})}releaseMem(){}}zt.matI=new L;var Wt="/*\r\n\ttexture和fillrect使用的。\r\n*/\r\nattribute vec4 posuv;\r\nattribute vec4 attribColor;\r\nattribute vec4 attribFlags;\r\n//attribute vec4 clipDir;\r\n//attribute vec2 clipRect;\r\nuniform vec4 clipMatDir;\r\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\r\nvarying vec2 cliped;\r\nuniform vec2 size;\r\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\r\n#ifdef WORLDMAT\r\n\tuniform mat4 mmat;\r\n#endif\r\n#ifdef MVP3D\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\nvarying vec4 v_texcoordAlpha;\r\nvarying vec4 v_color;\r\nvarying float v_useTex;\r\n\r\nvoid main() {\r\n\r\n\tvec4 pos = vec4(posuv.xy,0.,1.);\r\n#ifdef WORLDMAT\r\n\tpos=mmat*pos;\r\n#endif\r\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\r\n#ifdef MVP3D\r\n\tgl_Position=u_MvpMatrix*pos1;\r\n#else\r\n\tgl_Position=pos1;\r\n#endif\r\n\tv_texcoordAlpha.xy = posuv.zw;\r\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\r\n\tv_color = attribColor/255.0;\r\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\r\n\t\r\n\tv_useTex = attribFlags.r/255.0;\r\n\tfloat clipw = length(clipMatDir.xy);\r\n\tfloat cliph = length(clipMatDir.zw);\r\n\t\r\n\tvec2 clpos = clipMatPos.xy;\r\n\t#ifdef WORLDMAT\r\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\r\n\t\tif(clipOff[0]>0.0){\r\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\r\n\t\t\tclpos.y+=mmat[3].y;\t//ty\r\n\t\t}\r\n\t#endif\r\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\r\n\tif(clipw>20000. && cliph>20000.)\r\n\t\tcliped = vec2(0.5,0.5);\r\n\telse {\r\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\r\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\r\n\t}\r\n\r\n}";var Xt="/*\r\n\ttexture和fillrect使用的。\r\n*/\r\n#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\nvarying vec4 v_texcoordAlpha;\r\nvarying vec4 v_color;\r\nvarying float v_useTex;\r\nuniform sampler2D texture;\r\nvarying vec2 cliped;\r\n\r\n#ifdef BLUR_FILTER\r\nuniform vec4 strength_sig2_2sig2_gauss1;\r\nuniform vec2 blurInfo;\r\n\r\n#define PI 3.141593\r\n\r\nfloat getGaussian(float x, float y){\r\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\r\n}\r\n\r\nvec4 blur(){\r\n    const float blurw = 9.0;\r\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\r\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \r\n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\r\n    vec2 ctexcoord = startpos;\r\n    vec2 step = 1.0/blurInfo;  //每个像素      \r\n    \r\n    for(float y = 0.0;y<=blurw; ++y){\r\n        ctexcoord.x=startpos.x;\r\n        for(float x = 0.0;x<=blurw; ++x){\r\n            //TODO 纹理坐标的固定偏移应该在vs中处理\r\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\r\n            ctexcoord.x+=step.x;\r\n        }\r\n        ctexcoord.y+=step.y;\r\n    }\r\n    return vec4Color;\r\n}\r\n#endif\r\n\r\n#ifdef COLOR_FILTER\r\nuniform vec4 colorAlpha;\r\nuniform mat4 colorMat;\r\n#endif\r\n\r\n#ifdef GLOW_FILTER\r\nuniform vec4 u_color;\r\nuniform vec4 u_blurInfo1;\r\nuniform vec4 u_blurInfo2;\r\n#endif\r\n\r\n#ifdef COLOR_ADD\r\nuniform vec4 colorAdd;\r\n#endif\r\n\r\n#ifdef FILLTEXTURE\t\r\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\r\n#endif\r\nvoid main() {\r\n\tif(cliped.x<0.) discard;\r\n\tif(cliped.x>1.) discard;\r\n\tif(cliped.y<0.) discard;\r\n\tif(cliped.y>1.) discard;\r\n\t\r\n#ifdef FILLTEXTURE\t\r\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\r\n#else\r\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\r\n#endif\r\n\r\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\r\n   color.a*=v_color.w;\r\n   //color.rgb*=v_color.w;\r\n   color.rgb*=v_color.rgb;\r\n   gl_FragColor=color;\r\n   \r\n   #ifdef COLOR_ADD\r\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\r\n\tgl_FragColor.xyz *= colorAdd.a;\r\n   #endif\r\n   \r\n   #ifdef BLUR_FILTER\r\n\tgl_FragColor =   blur();\r\n\tgl_FragColor.w*=v_color.w;   \r\n   #endif\r\n   \r\n   #ifdef COLOR_FILTER\r\n\tmat4 alphaMat =colorMat;\r\n\r\n\talphaMat[0][3] *= gl_FragColor.a;\r\n\talphaMat[1][3] *= gl_FragColor.a;\r\n\talphaMat[2][3] *= gl_FragColor.a;\r\n\r\n\tgl_FragColor = gl_FragColor * alphaMat;\r\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\r\n   #endif\r\n   \r\n   #ifdef GLOW_FILTER\r\n\tconst float c_IterationTime = 10.0;\r\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\r\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\r\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\r\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\r\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\r\n\tvec2 vec2Off = vec2(0.0,0.0);\r\n\tfloat floatOff = c_IterationTime/2.0;\r\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\r\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\r\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\r\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\r\n\t\t}\r\n\t}\r\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\r\n\tgl_FragColor.rgb *= gl_FragColor.a;   \r\n   #endif\r\n   \r\n}";var Yt="attribute vec4 position;\r\nattribute vec4 attribColor;\r\n//attribute vec4 clipDir;\r\n//attribute vec2 clipRect;\r\nuniform vec4 clipMatDir;\r\nuniform vec2 clipMatPos;\r\n#ifdef WORLDMAT\r\n\tuniform mat4 mmat;\r\n#endif\r\nuniform mat4 u_mmat2;\r\n//uniform vec2 u_pos;\r\nuniform vec2 size;\r\nvarying vec4 color;\r\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\r\n//vec4 clip=vec4(100.,30.,300.,600.);\r\nvarying vec2 cliped;\r\nvoid main(){\r\n\t\r\n#ifdef WORLDMAT\r\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\r\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\r\n#else\r\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\r\n#endif\t\r\n\tfloat clipw = length(clipMatDir.xy);\r\n\tfloat cliph = length(clipMatDir.zw);\r\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\r\n\tif(clipw>20000. && cliph>20000.)\r\n\t\tcliped = vec2(0.5,0.5);\r\n\telse {\r\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\r\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\r\n\t}\r\n  //pos2d.x = dot(clippos,dirx);\r\n  color=attribColor/255.;\r\n}";var jt="precision mediump float;\r\n//precision mediump float;\r\nvarying vec4 color;\r\n//uniform float alpha;\r\nvarying vec2 cliped;\r\nvoid main(){\r\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\r\n\t//a.a*=alpha;\r\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\r\n\tgl_FragColor.rgb*=color.a;\r\n\tif(cliped.x<0.) discard;\r\n\tif(cliped.x>1.) discard;\r\n\tif(cliped.y<0.) discard;\r\n\tif(cliped.y>1.) discard;\r\n}";var qt="attribute vec2 position;\r\nattribute vec2 texcoord;\r\nattribute vec4 color;\r\nuniform vec2 size;\r\nuniform float offsetX;\r\nuniform float offsetY;\r\nuniform mat4 mmat;\r\nuniform mat4 u_mmat2;\r\nvarying vec2 v_texcoord;\r\nvarying vec4 v_color;\r\nvoid main() {\r\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\r\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\r\n  v_color = color;\r\n  v_color.rgb *= v_color.a;\r\n  v_texcoord = texcoord;  \r\n}";var Zt="precision mediump float;\r\nvarying vec2 v_texcoord;\r\nvarying vec4 v_color;\r\nuniform sampler2D texture;\r\nuniform float alpha;\r\nvoid main() {\r\n\tvec4 t_color = texture2D(texture, v_texcoord);\r\n\tgl_FragColor = t_color.rgba * v_color;\r\n\tgl_FragColor *= alpha;\r\n}";class Kt{constructor(){this.ALPHA=1;this.defines=new D;this.shaderType=0;this.fillStyle=Ct.DEFAULT;this.strokeStyle=Ct.DEFAULT}destroy(){this.defines=null;this.filters=null}static __init__(){lt.preCompile2D(0,D.TEXTURE2D,Wt,Xt,null);lt.preCompile2D(0,D.PRIMITIVE,Yt,jt,null);lt.preCompile2D(0,D.SKINMESH,qt,Zt,null)}}class Qt{constructor(){var t=f.instance;this.ib=Ft.create(t.DYNAMIC_DRAW);this.vb=Vt.create(8)}static getInstance(){return Qt.instance=Qt.instance||new Qt}addSkinMesh(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)}reset(){this.vb.clear();this.ib.clear()}}class Jt{static createLine2(t,e,a,i,r,s){if(t.length<4)return null;var n=Jt.tempData.length>t.length+2?Jt.tempData:new Array(t.length+2);n[0]=t[0];n[1]=t[1];var o=2;var l=0;var _=t.length;for(l=2;l<_;l+=2){if(Math.abs(t[l]-t[l-2])+Math.abs(t[l+1]-t[l-1])>.01){n[o++]=t[l];n[o++]=t[l+1]}}if(s&&Math.abs(t[0]-n[o-2])+Math.abs(t[1]-n[o-1])>.01){n[o++]=t[0];n[o++]=t[1]}var h=r;_=o/2;var x=a/2;var c,d,u,f,p,m,g,v;var y,T,E,b;var S,C,R,A,L,I;var M,D;u=n[0];f=n[1];p=n[2];m=n[3];y=-(f-m);T=u-p;D=Math.sqrt(y*y+T*T);y=y/D*x;T=T/D*x;h.push(u-y,f-T,u+y,f+T);for(l=1;l<_-1;l++){u=n[(l-1)*2];f=n[(l-1)*2+1];p=n[l*2];m=n[l*2+1];g=n[(l+1)*2];v=n[(l+1)*2+1];y=-(f-m);T=u-p;D=Math.sqrt(y*y+T*T);y=y/D*x;T=T/D*x;E=-(m-v);b=p-g;D=Math.sqrt(E*E+b*b);E=E/D*x;b=b/D*x;S=-T+f-(-T+m);C=-y+p-(-y+u);R=(-y+u)*(-T+m)-(-y+p)*(-T+f);A=-b+v-(-b+m);L=-E+p-(-E+g);I=(-E+g)*(-b+m)-(-E+p)*(-b+v);M=S*L-A*C;if(Math.abs(M)<.1){M+=10.1;h.push(p-y,m-T,p+y,m+T);continue}c=(C*I-L*R)/M;d=(A*R-S*I)/M;h.push(c,d,p-(c-p),m-(d-m))}u=n[o-4];f=n[o-3];p=n[o-2];m=n[o-1];y=-(f-m);T=u-p;D=Math.sqrt(y*y+T*T);y=y/D*x;T=T/D*x;h.push(p-y,m-T,p+y,m+T);for(l=1;l<_;l++){e.push(i+(l-1)*2,i+(l-1)*2+1,i+l*2+1,i+l*2+1,i+l*2,i+(l-1)*2)}return h}static createLineTriangle(t,e,a,i,r,s,n){var o=t.slice();var l=o.length;var _=o[0],h=o[1];var x=o[2],c=o[2];var d=0;var u=0;var f=0,p=0;var m=l/2;if(m<=1)return;if(m==2){return}var g=new Array(m*4);var v=0;var y=0;for(var T=0;T<m-1;T++){_=o[y++],h=o[y++];x=o[y++],c=o[y++];f=x-_,p=c-h;if(f!=0&&p!=0){d=Math.sqrt(f*f+p*p);if(d>.001){u=v*4;g[u]=_;g[u+1]=h;g[u+2]=f/d;g[u+3]=p/d;v++}}}if(i){_=o[l-2],h=o[l-1];x=o[0],c=o[1];f=x-_,p=c-h;if(f!=0&&p!=0){d=Math.sqrt(f*f+p*p);if(d>.001){u=v*4;g[u]=_;g[u+1]=h;g[u+2]=f/d;g[u+3]=p/d;v++}}}else{u=v*4;g[u]=_;g[u+1]=h;g[u+2]=f/d;g[u+3]=p/d;v++}y=0;for(T=0;T<m;T++){_=o[y],h=o[y+1];x=o[y+2],c=o[y+3]}}}Jt.tempData=new Array(256);class $t{constructor(t,e,a){this.i=t;this.x=e;this.y=a;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}}class E{static earcut(t,e,a){a=a||2;var i=e&&e.length,r=i?e[0]*a:t.length,s=E.linkedList(t,0,r,a,true),n=[];if(!s)return n;var o,l,_,h,x,c,d;if(i)s=E.eliminateHoles(t,e,s,a);if(t.length>80*a){o=_=t[0];l=h=t[1];for(var u=a;u<r;u+=a){x=t[u];c=t[u+1];if(x<o)o=x;if(c<l)l=c;if(x>_)_=x;if(c>h)h=c}d=Math.max(_-o,h-l);d=d!==0?1/d:0}E.earcutLinked(s,n,a,o,l,d);return n}static linkedList(t,e,a,i,r){var s,n;if(r===E.signedArea(t,e,a,i)>0){for(s=e;s<a;s+=i)n=E.insertNode(s,t[s],t[s+1],n)}else{for(s=a-i;s>=e;s-=i)n=E.insertNode(s,t[s],t[s+1],n)}if(n&&E.equals(n,n.next)){E.removeNode(n);n=n.next}return n}static filterPoints(t,e){if(!t)return t;if(!e)e=t;var a=t,i;do{i=false;if(!a.steiner&&(E.equals(a,a.next)||E.area(a.prev,a,a.next)===0)){E.removeNode(a);a=e=a.prev;if(a===a.next)break;i=true}else{a=a.next}}while(i||a!==e);return e}static earcutLinked(t,e,a,i,r,s,n=null){if(!t)return;if(!n&&s)E.indexCurve(t,i,r,s);var o=t,l,_;while(t.prev!==t.next){l=t.prev;_=t.next;if(s?E.isEarHashed(t,i,r,s):E.isEar(t)){e.push(l.i/a);e.push(t.i/a);e.push(_.i/a);E.removeNode(t);t=_.next;o=_.next;continue}t=_;if(t===o){if(!n){E.earcutLinked(E.filterPoints(t,null),e,a,i,r,s,1)}else if(n===1){t=E.cureLocalIntersections(t,e,a);E.earcutLinked(t,e,a,i,r,s,2)}else if(n===2){E.splitEarcut(t,e,a,i,r,s)}break}}}static isEar(t){var e=t.prev,a=t,i=t.next;if(E.area(e,a,i)>=0)return false;var r=t.next.next;while(r!==t.prev){if(E.pointInTriangle(e.x,e.y,a.x,a.y,i.x,i.y,r.x,r.y)&&E.area(r.prev,r,r.next)>=0)return false;r=r.next}return true}static isEarHashed(t,e,a,i){var r=t.prev,s=t,n=t.next;if(E.area(r,s,n)>=0)return false;var o=r.x<s.x?r.x<n.x?r.x:n.x:s.x<n.x?s.x:n.x,l=r.y<s.y?r.y<n.y?r.y:n.y:s.y<n.y?s.y:n.y,_=r.x>s.x?r.x>n.x?r.x:n.x:s.x>n.x?s.x:n.x,h=r.y>s.y?r.y>n.y?r.y:n.y:s.y>n.y?s.y:n.y;var x=E.zOrder(o,l,e,a,i),c=E.zOrder(_,h,e,a,i);var d=t.nextZ;while(d&&d.z<=c){if(d!==t.prev&&d!==t.next&&E.pointInTriangle(r.x,r.y,s.x,s.y,n.x,n.y,d.x,d.y)&&E.area(d.prev,d,d.next)>=0)return false;d=d.nextZ}d=t.prevZ;while(d&&d.z>=x){if(d!==t.prev&&d!==t.next&&E.pointInTriangle(r.x,r.y,s.x,s.y,n.x,n.y,d.x,d.y)&&E.area(d.prev,d,d.next)>=0)return false;d=d.prevZ}return true}static cureLocalIntersections(t,e,a){var i=t;do{var r=i.prev,s=i.next.next;if(!E.equals(r,s)&&E.intersects(r,i,i.next,s)&&E.locallyInside(r,s)&&E.locallyInside(s,r)){e.push(r.i/a);e.push(i.i/a);e.push(s.i/a);E.removeNode(i);E.removeNode(i.next);i=t=s}i=i.next}while(i!==t);return i}static splitEarcut(t,e,a,i,r,s){var n=t;do{var o=n.next.next;while(o!==n.prev){if(n.i!==o.i&&E.isValidDiagonal(n,o)){var l=E.splitPolygon(n,o);n=E.filterPoints(n,n.next);l=E.filterPoints(l,l.next);E.earcutLinked(n,e,a,i,r,s);E.earcutLinked(l,e,a,i,r,s);return}o=o.next}n=n.next}while(n!==t)}static eliminateHoles(t,e,a,i){var r=[],s,n,o,l,_;for(s=0,n=e.length;s<n;s++){o=e[s]*i;l=s<n-1?e[s+1]*i:t.length;_=E.linkedList(t,o,l,i,false);if(_===_.next)_.steiner=true;r.push(E.getLeftmost(_))}r.sort(E.compareX);for(s=0;s<r.length;s++){E.eliminateHole(r[s],a);a=E.filterPoints(a,a.next)}return a}static compareX(t,e){return t.x-e.x}static eliminateHole(t,e){e=E.findHoleBridge(t,e);if(e){var a=E.splitPolygon(e,t);E.filterPoints(a,a.next)}}static findHoleBridge(t,e){var a=e,i=t.x,r=t.y,s=-Infinity,n;do{if(r<=a.y&&r>=a.next.y&&a.next.y!==a.y){var o=a.x+(r-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(o<=i&&o>s){s=o;if(o===i){if(r===a.y)return a;if(r===a.next.y)return a.next}n=a.x<a.next.x?a:a.next}}a=a.next}while(a!==e);if(!n)return null;if(i===s)return n.prev;var l=n,_=n.x,h=n.y,x=Infinity,c;a=n.next;while(a!==l){if(i>=a.x&&a.x>=_&&i!==a.x&&E.pointInTriangle(r<h?i:s,r,_,h,r<h?s:i,r,a.x,a.y)){c=Math.abs(r-a.y)/(i-a.x);if((c<x||c===x&&a.x>n.x)&&E.locallyInside(a,t)){n=a;x=c}}a=a.next}return n}static indexCurve(t,e,a,i){var r=t;do{if(r.z===null)r.z=E.zOrder(r.x,r.y,e,a,i);r.prevZ=r.prev;r.nextZ=r.next;r=r.next}while(r!==t);r.prevZ.nextZ=null;r.prevZ=null;E.sortLinked(r)}static sortLinked(t){var e,a,i,r,s,n,o,l,_=1;do{a=t;t=null;s=null;n=0;while(a){n++;i=a;o=0;for(e=0;e<_;e++){o++;i=i.nextZ;if(!i)break}l=_;while(o>0||l>0&&i){if(o!==0&&(l===0||!i||a.z<=i.z)){r=a;a=a.nextZ;o--}else{r=i;i=i.nextZ;l--}if(s)s.nextZ=r;else t=r;r.prevZ=s;s=r}a=i}s.nextZ=null;_*=2}while(n>1);return t}static zOrder(t,e,a,i,r){t=32767*(t-a)*r;e=32767*(e-i)*r;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;return t|e<<1}static getLeftmost(t){var e=t,a=t;do{if(e.x<a.x)a=e;e=e.next}while(e!==t);return a}static pointInTriangle(t,e,a,i,r,s,n,o){return(r-n)*(e-o)-(t-n)*(s-o)>=0&&(t-n)*(i-o)-(a-n)*(e-o)>=0&&(a-n)*(s-o)-(r-n)*(i-o)>=0}static isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!E.intersectsPolygon(t,e)&&E.locallyInside(t,e)&&E.locallyInside(e,t)&&E.middleInside(t,e)}static area(t,e,a){return(e.y-t.y)*(a.x-e.x)-(e.x-t.x)*(a.y-e.y)}static equals(t,e){return t.x===e.x&&t.y===e.y}static intersects(t,e,a,i){if(E.equals(t,e)&&E.equals(a,i)||E.equals(t,i)&&E.equals(a,e))return true;return E.area(t,e,a)>0!==E.area(t,e,i)>0&&E.area(a,i,t)>0!==E.area(a,i,e)>0}static intersectsPolygon(t,e){var a=t;do{if(a.i!==t.i&&a.next.i!==t.i&&a.i!==e.i&&a.next.i!==e.i&&E.intersects(a,a.next,t,e))return true;a=a.next}while(a!==t);return false}static locallyInside(t,e){return E.area(t.prev,t,t.next)<0?E.area(t,e,t.next)>=0&&E.area(t,t.prev,e)>=0:E.area(t,e,t.prev)<0||E.area(t,t.next,e)<0}static middleInside(t,e){var a=t,i=false,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{if(a.y>s!==a.next.y>s&&a.next.y!==a.y&&r<(a.next.x-a.x)*(s-a.y)/(a.next.y-a.y)+a.x)i=!i;a=a.next}while(a!==t);return i}static splitPolygon(t,e){var a=new $t(t.i,t.x,t.y),i=new $t(e.i,e.x,e.y),r=t.next,s=e.prev;t.next=e;e.prev=t;a.next=r;r.prev=a;i.next=a;a.prev=i;s.next=i;i.prev=s;return i}static insertNode(t,e,a,i){var r=new $t(t,e,a);if(!i){r.prev=r;r.next=r}else{r.next=i.next;r.prev=i;i.next.prev=r;i.next=r}return r}static removeNode(t){t.next.prev=t.prev;t.prev.next=t.next;if(t.prevZ)t.prevZ.nextZ=t.nextZ;if(t.nextZ)t.nextZ.prevZ=t.prevZ}static signedArea(t,e,a,i){var r=0;for(var s=e,n=a-i;s<a;s+=i){r+=(t[n]-t[s])*(t[s+1]+t[n+1]);n=s}return r}}class te{}te.BYTES_PE=4;te.BYTES_PIDX=2;te.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];te.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1];te.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0];te._TMPARRAY=[];te._OFFSETX=0;te._OFFSETY=0;class ee extends C{constructor(t=C.TYPE_2D){super(t)}renderSubmit(){if(this._numEle===0||!this._mesh||this._numEle==0)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var a=p.mainContext;this._mesh.useMesh(a);this.shaderValue.upload();if(M.activeBlendFunction!==this._blendFn){p.setBlend(a,true);this._blendFn(a);M.activeBlendFunction=this._blendFn}a.drawElements(a.TRIANGLES,this._numEle,a.UNSIGNED_SHORT,this._startIdx);g.renderBatches++;g.trianglesFaces+=this._numEle/3;return 1}releaseRender(){if(C.RENDERBASE==this)return;if(--this._ref<1){ee.POOL[ee._poolSize++]=this;this.shaderValue.release();this.shaderValue=null;this._mesh=null;this._parent&&(this._parent.releaseRender(),this._parent=null)}}static create(t,e,a){var i=ee._poolSize?ee.POOL[--ee._poolSize]:new ee;i._ref=1;i._mesh=e;i._key.clear();i._startIdx=e.indexNum*te.BYTES_PIDX;i._numEle=0;var r=t._nBlendType;i._blendFn=t._targets?M.targetFns[r]:M.fns[r];i.shaderValue=a;i.shaderValue.setValue(t._shader2D);var s=t._shader2D.filters;s&&i.shaderValue.setFilters(s);return i}static createShape(t,e,a,i){var r=ee._poolSize?ee.POOL[--ee._poolSize]:new ee;r._mesh=e;r._numEle=a;r._startIdx=e.indexNum*2;r._ref=1;r.shaderValue=i;r.shaderValue.setValue(t._shader2D);var s=t._nBlendType;r._key.blendShader=s;r._blendFn=t._targets?M.targetFns[s]:M.fns[s];return r}}ee._poolSize=0;ee.POOL=[];class ae extends C{constructor(){super(C.TYPE_2D);this._matrix=new L;this._matrix4=te.defaultMatrix4.concat();this.shaderValue=new ht(0,0)}static create(t,e,a){var i=!ae.POOL._length?new ae:ae.POOL[--ae.POOL._length];i.canv=t;i._ref=1;i._numEle=0;var r=i.shaderValue;r.alpha=e;r.defines.setValue(0);a&&a.length&&r.setFilters(a);return i}renderSubmit(){var t=_.worldAlpha;var e=_.worldMatrix4;var a=_.worldMatrix;var i=_.worldFilters;var r=_.worldShaderDefines;var s=this.shaderValue;var n=this._matrix;var o=this._matrix4;var l=L.TEMP;L.mul(n,a,l);o[0]=l.a;o[1]=l.b;o[4]=l.c;o[5]=l.d;o[12]=l.tx;o[13]=l.ty;_.worldMatrix=l.clone();_.worldMatrix4=o;_.worldAlpha=_.worldAlpha*s.alpha;if(s.filters&&s.filters.length){_.worldFilters=s.filters;_.worldShaderDefines=s.defines}this.canv["flushsubmit"]();_.worldAlpha=t;_.worldMatrix4=e;_.worldMatrix.destroy();_.worldMatrix=a;_.worldFilters=i;_.worldShaderDefines=r;return 1}releaseRender(){if(--this._ref<1){var t=ae.POOL;this._mesh=null;t[t._length++]=this}}getRenderType(){return C.TYPE_CANVAS}}ae.POOL=[];{ae.POOL._length=0}class ie{constructor(){this.blendType=0;this._ref=1;this._key=new xt}renderSubmit(){var t=p.mainContext;this._mesh.useMesh(t);var e=this.srcRT;if(e){this.shaderValue.texture=e._getSource();this.shaderValue.upload();this.blend();g.renderBatches++;g.trianglesFaces+=this._numEle/3;t.drawElements(t.TRIANGLES,this._numEle,t.UNSIGNED_SHORT,this._startIdx)}return 1}blend(){if(M.activeBlendFunction!==M.fns[this.blendType]){var t=p.mainContext;t.enable(t.BLEND);M.fns[this.blendType](t);M.activeBlendFunction=M.fns[this.blendType]}}getRenderType(){return 0}releaseRender(){if(--this._ref<1){var t=ie.POOL;t[t._length++]=this}}static create(t,e,a,i){var r=ie.POOL._length?ie.POOL[--ie.POOL._length]:new ie;r._mesh=e;r.srcRT=i;r._startIdx=e.indexNum*te.BYTES_PIDX;r._ref=1;r._key.clear();r._numEle=0;r.blendType=t._nBlendType;r._key.blendShader=r.blendType;r.shaderValue=a;r.shaderValue.setValue(t._shader2D);if(t._colorFiler){var s=t._colorFiler;a.defines.add(s.type);a.colorMat=s._mat;a.colorAlpha=s._alpha}return r}}ie.POOL=[];{ie.POOL._length=0}class re extends C{constructor(t=C.TYPE_2D){super(t)}releaseRender(){if(--this._ref<1){re.POOL[re._poolSize++]=this;this.shaderValue.release();this._mesh=null;this._parent&&(this._parent.releaseRender(),this._parent=null)}}renderSubmit(){if(this._numEle===0)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var a=p.mainContext;this._mesh.useMesh(a);var i=C.preRender;var r=C.preRender._key;if(this._key.blendShader===0&&(this._key.submitType===r.submitType&&this._key.blendShader===r.blendShader)&&it.activeShader&&C.preRender.clipInfoID==this.clipInfoID&&i.shaderValue.defines._value===this.shaderValue.defines._value&&(this.shaderValue.defines._value&D.NOOPTMASK)==0){it.activeShader.uploadTexture2D(e)}else{if(M.activeBlendFunction!==this._blendFn){p.setBlend(a,true);this._blendFn(a);M.activeBlendFunction=this._blendFn}this.shaderValue.texture=e;this.shaderValue.upload()}a.drawElements(a.TRIANGLES,this._numEle,a.UNSIGNED_SHORT,this._startIdx);g.renderBatches++;g.trianglesFaces+=this._numEle/3;return 1}static create(t,e,a){var i=re._poolSize?re.POOL[--re._poolSize]:new re(C.TYPE_TEXTURE);i._mesh=e;i._key.clear();i._key.submitType=C.KEY_DRAWTEXTURE;i._ref=1;i._startIdx=e.indexNum*te.BYTES_PIDX;i._numEle=0;var r=t._nBlendType;i._key.blendShader=r;i._blendFn=t._targets?M.targetFns[r]:M.fns[r];i.shaderValue=a;if(t._colorFiler){var s=t._colorFiler;a.defines.add(s.type);a.colorMat=s._mat;a.colorAlpha=s._alpha}return i}}re._poolSize=0;re.POOL=[];class se{constructor(){this._data=[];this._ndata=0;this._clipid=-1;this._clipMatrix=new L;this._enable=false}clear(){this._tex=null;this._imgId=-1;this._ndata=0;this._enable=false;this._colorFiler=null}destroy(){this.clear();this._data.length=0;this._data=null}add(t,e,a,i,r,s){if(this._ndata>0&&(this._tex!=e||this._imgId!=a||this._clipid>=0&&this._clipid!=t._clipInfoID)){this.submit(t)}this._clipid=t._clipInfoID;t._globalClipMatrix.copyTo(this._clipMatrix);this._tex=e;this._imgId=a;this._colorFiler=t._colorFiler;this._data[this._ndata]=i;this._data[this._ndata+1]=r;this._data[this._ndata+2]=s;this._ndata+=3}getPos(){if(se.__nPosPool==0)return new Array(8);return se.__posPool[--se.__nPosPool]}enable(t,e){if(t===this._enable)return;this._enable=t;this._enable||this.submit(e)}submit(t){var e=this._ndata;if(!e)return;var a=t._mesh;var i=t._colorFiler;t._colorFiler=this._colorFiler;var r=re.create(t,a,ht.create(D.TEXTURE2D,0));t._submits[t._submits._length++]=t._curSubmit=r;r.shaderValue.textureHost=this._tex;r._key.other=this._imgId;t._colorFiler=i;t._copyClipInfo(r,this._clipMatrix);r.clipInfoID=this._clipid;for(var s=0;s<e;s+=3){a.addQuad(this._data[s],this._data[s+1],this._data[s+2],true);se.__posPool[se.__nPosPool++]=this._data[s]}e/=3;r._numEle+=e*6;a.indexNum+=e*6;a.vertNum+=e*4;t._drawCount+=e;this._ndata=0;if(Nt.loopCount%100==0)this._data.length=0}}se.__posPool=[];se.__nPosPool=0;class ne{constructor(t=0,e=0,a=0){this.atlasID=0;this._width=0;this._height=0;this._texCount=0;this._rowInfo=null;this._cells=null;this._used=0;this._cells=null;this._rowInfo=null;this.atlasID=a;this._init(t,e)}addRect(t,e,a,i){if(!this._get(e,a,i))return false;this._fill(i.x,i.y,e,a,t);this._texCount++;return true}_release(){this._cells=null;this._rowInfo=null}_init(t,e){this._width=t;this._height=e;this._release();if(this._width==0)return false;this._cells=new Uint8Array(this._width*this._height*3);this._rowInfo=new Uint8Array(this._height);this._used=0;this._clear();return true}_get(t,e,a){if(t>this._width||e>this._height){return false}var i=-1;var r=-1;var s=this._width;var n=this._height;var o=this._cells;for(var l=0;l<n;l++){if(this._rowInfo[l]<t)continue;for(var _=0;_<s;){var h=(l*s+_)*3;if(o[h]!=0||o[h+1]<t||o[h+2]<e){_+=o[h+1];continue}i=_;r=l;for(var x=0;x<t;x++){if(o[3*x+h+2]<e){i=-1;break}}if(i<0){_+=o[h+1];continue}a.x=i;a.y=r;return true}}return false}_fill(t,e,a,i,r){var s=this._width;var n=this._height;this._check(t+a<=s&&e+i<=n);for(var o=e;o<i+e;++o){this._check(this._rowInfo[o]>=a);this._rowInfo[o]-=a;for(var l=0;l<a;l++){var _=(t+o*s+l)*3;this._check(this._cells[_]==0);this._cells[_]=r;this._cells[_+1]=a;this._cells[_+2]=i}}if(t>0){for(o=0;o<i;++o){var h=0;for(l=t-1;l>=0;--l,++h){if(this._cells[((e+o)*s+l)*3]!=0)break}for(l=h;l>0;--l){this._cells[((e+o)*s+t-l)*3+1]=l;this._check(l>0)}}}if(e>0){for(l=t;l<t+a;++l){h=0;for(o=e-1;o>=0;--o,h++){if(this._cells[(l+o*s)*3]!=0)break}for(o=h;o>0;--o){this._cells[(l+(e-o)*s)*3+2]=o;this._check(o>0)}}}this._used+=a*i/(this._width*this._height)}_check(t){if(t==false){console.log("xtexMerger 错误啦")}}_clear(){this._texCount=0;for(var t=0;t<this._height;t++){this._rowInfo[t]=this._width}for(var e=0;e<this._height;e++){for(var a=0;a<this._width;a++){var i=(e*this._width+a)*3;this._cells[i]=0;this._cells[i+1]=this._width-a;this._cells[i+2]=this._width-e}}}}class y extends ${constructor(t,e){super();this._texW=0;this._texH=0;this.__destroyed=false;this._discardTm=0;this.genID=0;this.bitmap={id:0,_glTexture:null};this.curUsedCovRate=0;this.curUsedCovRateAtlas=0;this.lastTouchTm=0;this.ri=null;this._texW=t||y.gTextRender.atlasWidth;this._texH=e||y.gTextRender.atlasWidth;this.bitmap.id=this.id;this.lock=true}recreateResource(){if(this._source)return;var t=f.instance;var e=this._source=t.createTexture();this.bitmap._glTexture=e;p.bindTexture(t,t.TEXTURE_2D,e);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._texW,this._texH,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);if(y.gTextRender.debugUV){this.fillWhite()}}addChar(t,e,a,i=null){if(y.gTextRender.isWan1Wan){return this.addCharCanvas(t,e,a,i)}!this._source&&this.recreateResource();var r=f.instance;p.bindTexture(r,r.TEXTURE_2D,this._source);!O.Render.isConchApp&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);var s=t.data;if(t.data instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);r.texSubImage2D(r.TEXTURE_2D,0,e,a,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,s);!O.Render.isConchApp&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);var n;var o;var l;var _;n=e/this._texW;o=a/this._texH;l=(e+t.width)/this._texW;_=(a+t.height)/this._texH;i=i||new Array(8);i[0]=n,i[1]=o;i[2]=l,i[3]=o;i[4]=l,i[5]=_;i[6]=n,i[7]=_;return i}addCharCanvas(t,e,a,i=null){!this._source&&this.recreateResource();var r=f.instance;p.bindTexture(r,r.TEXTURE_2D,this._source);!O.Render.isConchApp&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);r.texSubImage2D(r.TEXTURE_2D,0,e,a,r.RGBA,r.UNSIGNED_BYTE,t);!O.Render.isConchApp&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);var s;var n;var o;var l;if(O.Render.isConchApp){s=e/this._texW;n=a/this._texH;o=(e+t.width)/this._texW;l=(a+t.height)/this._texH}else{s=(e+1)/this._texW;n=(a+1)/this._texH;o=(e+t.width-1)/this._texW;l=(a+t.height-1)/this._texH}i=i||new Array(8);i[0]=s,i[1]=n;i[2]=o,i[3]=n;i[4]=o,i[5]=l;i[6]=s,i[7]=l;return i}fillWhite(){!this._source&&this.recreateResource();var t=f.instance;var e=new Uint8Array(this._texW*this._texH*4);e.fill(255);t.texSubImage2D(t.TEXTURE_2D,0,0,0,this._texW,this._texH,t.RGBA,t.UNSIGNED_BYTE,e)}discard(){O.stage.setGlobalRepaint();this.destroy();return;if(this._texW!=y.gTextRender.atlasWidth||this._texH!=y.gTextRender.atlasWidth){this.destroy();return}this.genID++;if(y.poolLen>=y.pool.length){y.pool=y.pool.concat(new Array(10))}this._discardTm=Nt.loopStTm;y.pool[y.poolLen++]=this}static getTextTexture(t,e){return new y(t,e);if(t!=y.gTextRender.atlasWidth||t!=y.gTextRender.atlasWidth)return new y(t,e);if(y.poolLen>0){var a=y.pool[--y.poolLen];if(y.poolLen>0)y.clean();return a}return new y(t,e)}destroy(){this.__destroyed=true;var t=f.instance;this._source&&t.deleteTexture(this._source);this._source=null}static clean(){var t=Nt.loopStTm;if(y.cleanTm===0)y.cleanTm=t;if(t-y.cleanTm>=y.gTextRender.checkCleanTextureDt){for(var e=0;e<y.poolLen;e++){var a=y.pool[e];if(t-a._discardTm>=y.gTextRender.destroyUnusedTextureDt){a.destroy();y.pool[e]=y.pool[y.poolLen-1];y.poolLen--;e--}}y.cleanTm=t}}touchRect(t,e){if(this.lastTouchTm!=e){this.curUsedCovRate=0;this.curUsedCovRateAtlas=0;this.lastTouchTm=e}var a=y.gTextRender.atlasWidth*y.gTextRender.atlasWidth;var i=O.TextAtlas.atlasGridW*O.TextAtlas.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/a;this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/O.TextAtlas.atlasGridW)*Math.ceil(t.bmpHeight/O.TextAtlas.atlasGridW)/(a/i)}get texture(){return this}_getSource(){return this._source}drawOnScreen(t,e){}}y.gTextRender=null;y.pool=new Array(10);y.poolLen=0;y.cleanTm=0;class oe{constructor(){this.texWidth=1024;this.texHeight=1024;this.texture=null;this.charMaps={};this.texHeight=this.texWidth=O.TextRender.atlasWidth;this.texture=y.getTextTexture(this.texWidth,this.texHeight);if(this.texWidth/oe.atlasGridW>256){oe.atlasGridW=Math.ceil(this.texWidth/256)}this.atlasgrid=new ne(this.texWidth/oe.atlasGridW,this.texHeight/oe.atlasGridW,this.texture.id)}setProtecteDist(t){}getAEmpty(t,e,a){var i=this.atlasgrid.addRect(1,Math.ceil(t/oe.atlasGridW),Math.ceil(e/oe.atlasGridW),a);if(i){a.x*=oe.atlasGridW;a.y*=oe.atlasGridW}return i}get usedRate(){return this.atlasgrid._used}destroy(){for(var t in this.charMaps){var e=this.charMaps[t];e.deleted=true}this.texture.discard()}printDebugInfo(){}}oe.atlasGridW=16;class P{setTo(t,e,a){this.type=t;this.currentTarget=e;this.target=a;return this}stopPropagation(){this._stoped=true}get touches(){if(!this.nativeEvent)return null;var t=this.nativeEvent.touches;if(t){var e=O.stage;for(var a=0,i=t.length;a<i;a++){var r=t[a];var s=K.TEMP;s.setTo(r.clientX,r.clientY);e._canvasTransform.invertTransformPoint(s);e.transform.invertTransformPoint(s);r.stageX=s.x;r.stageY=s.y}}return t}get altKey(){return this.nativeEvent.altKey}get ctrlKey(){return this.nativeEvent.ctrlKey}get shiftKey(){return this.nativeEvent.shiftKey}get charCode(){return this.nativeEvent.charCode}get keyLocation(){return this.nativeEvent.location||this.nativeEvent.keyLocation}get stageX(){return O.stage.mouseX}get stageY(){return O.stage.mouseY}}P.EMPTY=new P;P.MOUSE_DOWN="mousedown";P.MOUSE_UP="mouseup";P.CLICK="click";P.RIGHT_MOUSE_DOWN="rightmousedown";P.RIGHT_MOUSE_UP="rightmouseup";P.RIGHT_CLICK="rightclick";P.MOUSE_MOVE="mousemove";P.MOUSE_OVER="mouseover";P.MOUSE_OUT="mouseout";P.MOUSE_WHEEL="mousewheel";P.ROLL_OVER="mouseover";P.ROLL_OUT="mouseout";P.DOUBLE_CLICK="doubleclick";P.CHANGE="change";P.CHANGED="changed";P.RESIZE="resize";P.ADDED="added";P.REMOVED="removed";P.DISPLAY="display";P.UNDISPLAY="undisplay";P.ERROR="error";P.COMPLETE="complete";P.LOADED="loaded";P.READY="ready";P.PROGRESS="progress";P.INPUT="input";P.RENDER="render";P.OPEN="open";P.MESSAGE="message";P.CLOSE="close";P.KEY_DOWN="keydown";P.KEY_PRESS="keypress";P.KEY_UP="keyup";P.FRAME="enterframe";P.DRAG_START="dragstart";P.DRAG_MOVE="dragmove";P.DRAG_END="dragend";P.ENTER="enter";P.SELECT="select";P.BLUR="blur";P.FOCUS="focus";P.VISIBILITY_CHANGE="visibilitychange";P.FOCUS_CHANGE="focuschange";P.PLAYED="played";P.PAUSED="paused";P.STOPPED="stopped";P.START="start";P.END="end";P.COMPONENT_ADDED="componentadded";P.COMPONENT_REMOVED="componentremoved";P.RELEASED="released";P.LINK="link";P.LABEL="label";P.FULL_SCREEN_CHANGE="fullscreenchange";P.DEVICE_LOST="devicelost";P.TRANSFORM_CHANGED="transformchanged";P.ANIMATION_CHANGED="animationchanged";P.TRAIL_FILTER_CHANGE="trailfilterchange";P.TRIGGER_ENTER="triggerenter";P.TRIGGER_STAY="triggerstay";P.TRIGGER_EXIT="triggerexit";class le extends e{constructor(t=null,e=null,a=0,i=0){super();this.uvrect=[0,0,1,1];this._destroyed=false;this._referenceCount=0;this.$_GID=0;this.offsetX=0;this.offsetY=0;this._w=0;this._h=0;this.sourceWidth=0;this.sourceHeight=0;this.url=null;this.scaleRate=1;this.setTo(t,e,a,i)}static moveUV(t,e,a){for(var i=0;i<8;i+=2){a[i]+=t;a[i+1]+=e}return a}static create(t,e,a,i,r,s=0,n=0,o=0,l=0){return le._create(t,e,a,i,r,s,n,o,l)}static _create(t,e,a,i,r,s=0,n=0,o=0,l=0,_=null){var h=t instanceof le;var x=h?t.uv:le.DEF_UV;var c=h?t.bitmap:t;if(c.width&&e+i>c.width)i=c.width-e;if(c.height&&a+r>c.height)r=c.height-a;var d;if(_){d=_;d.setTo(c,null,o||i,l||r)}else{d=new le(c,null,o||i,l||r)}d.width=i;d.height=r;d.offsetX=s;d.offsetY=n;var u=1/c.width;var f=1/c.height;e*=u;a*=f;i*=u;r*=f;var p=d.uv[0],m=d.uv[1],g=d.uv[4],v=d.uv[5];var y=g-p,T=v-m;var E=le.moveUV(x[0],x[1],[e,a,e+i,a,e+i,a+r,e,a+r]);d.uv=new Float32Array([p+E[0]*y,m+E[1]*T,g-(1-E[2])*y,m+E[3]*T,g-(1-E[4])*y,v-(1-E[5])*T,p+E[6]*y,v-(1-E[7])*T]);var b=c.scaleRate;if(b&&b!=1){d.sourceWidth/=b;d.sourceHeight/=b;d.width/=b;d.height/=b;d.scaleRate=b}else{d.scaleRate=1}return d}static createFromTexture(t,e,a,i,r){var s=t.scaleRate;if(s!=1){e*=s;a*=s;i*=s;r*=s}var n=R.TEMP.setTo(e-t.offsetX,a-t.offsetY,i,r);var o=n.intersection(le._rect1.setTo(0,0,t.width,t.height),le._rect2);if(o)var l=le.create(t,o.x,o.y,o.width,o.height,o.x-n.x,o.y-n.y,i,r);else return null;return l}get uv(){return this._uv}set uv(t){this.uvrect[0]=Math.min(t[0],t[2],t[4],t[6]);this.uvrect[1]=Math.min(t[1],t[3],t[5],t[7]);this.uvrect[2]=Math.max(t[0],t[2],t[4],t[6])-this.uvrect[0];this.uvrect[3]=Math.max(t[1],t[3],t[5],t[7])-this.uvrect[1];this._uv=t}get width(){if(this._w)return this._w;if(!this.bitmap)return 0;return this.uv&&this.uv!==le.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width}set width(t){this._w=t;this.sourceWidth||(this.sourceWidth=t)}get height(){if(this._h)return this._h;if(!this.bitmap)return 0;return this.uv&&this.uv!==le.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height}set height(t){this._h=t;this.sourceHeight||(this.sourceHeight=t)}get bitmap(){return this._bitmap}set bitmap(t){this._bitmap&&this._bitmap._removeReference(this._referenceCount);this._bitmap=t;t&&t._addReference(this._referenceCount)}get destroyed(){return this._destroyed}_addReference(){this._bitmap&&this._bitmap._addReference();this._referenceCount++}_removeReference(){this._bitmap&&this._bitmap._removeReference();this._referenceCount--}_getSource(t=null){if(this._destroyed||!this._bitmap)return null;this.recoverBitmap(t);return this._bitmap.destroyed?null:this.bitmap._getSource()}_onLoaded(t,e){if(!e);else if(e==this);else if(e instanceof le){var a=e;le._create(e,0,0,a.width,a.height,0,0,a.sourceWidth,a.sourceHeight,this)}else{this.bitmap=e;this.sourceWidth=this._w=e.width;this.sourceHeight=this._h=e.height}t&&t.run();this.event(P.READY,this)}getIsReady(){return this._destroyed?false:this._bitmap?true:false}setTo(t=null,e=null,a=0,i=0){this.bitmap=t;this.sourceWidth=a;this.sourceHeight=i;if(t){this._w=t.width;this._h=t.height;this.sourceWidth=this.sourceWidth||t.width;this.sourceHeight=this.sourceHeight||t.height}this.uv=e||le.DEF_UV}load(t,e=null){if(!this._destroyed)O.loader.load(t,Q.create(this,this._onLoaded,[e]),null,"htmlimage",1,true)}getTexturePixels(i,r,s,n){var o,l,_;var t=this.bitmap;var e=this._w;var a=this._h;var h=this.sourceWidth;var x=this.sourceHeight;var c=t.width;var d=t.height;var u=this.offsetX;var f=this.offsetY;let p=s;let m=n;if(i+s>e+u)p-=i+s-e-u;if(i+s>h)s-=i+s-h;if(r+n>a+f)m-=r+n-a-f;if(r+n>x)n-=r+n-x;if(s<=0||n<=0)return null;let g=u>i?u-i:0;let v=f>r?f-r:0;let y=i>u?i-u:0;let T=r>f?r-f:0;p-=g;m-=v;var E=s*4;var b=null;try{b=t.getPixels()}catch(t){}if(b){if(i==0&&r==0&&s==c&&n==d)return b;let t=this._uv.slice();let e=Math.round(t[0]*c);let a=Math.round(t[1]*d);var S=new Uint8Array(s*n*4);E=c*4;l=(a+T)*E;o=e*4+y*4+l;for(_=0;_<m;_++){S.set(b.slice(o,o+p*4),s*4*(_+v)+g*4);o+=E}return S}var C=new O.Context;C.size(s,n);C.asBitmap=true;var R=null;if(i!=0||r!=0||s!=c||n!=d){R=this._uv.slice();var A=R[0];var L=R[1];var I=R[2]-A;var M=R[7]-L;var D=I/e;var w=M/a;R=[A+y*D,L+T*w,A+(y+p)*D,L+T*w,A+(y+p)*D,L+(T+m)*w,A+y*D,L+(T+m)*w]}C._drawTextureM(this,g,v,p,m,null,1,R);C._targets.start();C.flush();C._targets.end();C._targets.restore();var P=C._targets.getData(0,0,s,n);C.destroy();S=new Uint8Array(s*n*4);o=0;l=(n-1)*E;for(_=n-1;_>=0;_--){S.set(P.slice(l,l+E),o);o+=E;l-=E}return S}getPixels(t,e,a,i){if(window.conch){return this._nativeObj.getImageData(t,e,a,i)}else{return this.getTexturePixels(t,e,a,i)}}recoverBitmap(e=null){var a=this._bitmap.url;if(!this._destroyed&&(!this._bitmap||this._bitmap.destroyed)&&a){let t=O.Loader.loadedMap[a];if(t){this.bitmap=t;e&&e()}else{O.loader.load(a,Q.create(this,function(t){this.bitmap=t;e&&e()}),null,"htmlimage",1,true)}}}disposeBitmap(){if(!this._destroyed&&this._bitmap){this._bitmap.destroy()}}destroy(t=false){if(!this._destroyed){this._destroyed=true;var e=this._bitmap;if(e){e._removeReference(this._referenceCount);if(e.referenceCount===0||t)e.destroy();e=null}if(this.url&&this===O.loader.getRes(this.url))O.Loader.clearRes(this.url)}}}le.DEF_UV=new Float32Array([0,0,1,0,1,1,0,1]);le.NO_UV=new Float32Array([0,0,0,0,0,0,0,0]);le.INV_UV=new Float32Array([0,1,1,1,1,0,0,0]);le._rect1=new R;le._rect2=new R;class _e{constructor(t){this._font="14px Arial";this._family="Arial";this._size=14;this._italic=false;this._bold=false;this._id=_e._gfontID++;this.setFont(t||this._font)}static Parse(t){if(t===_e._lastFont){return _e._lastFontInfo}var e=_e._cache[t];if(!e){e=_e._cache[t]=new _e(t)}_e._lastFont=t;_e._lastFontInfo=e;return e}setFont(t){this._font=t;var e=t.split(" ");var a=e.length;if(a<2){if(a==1){if(e[0].indexOf("px")>0){this._size=parseInt(e[0])}}return}var i=-1;for(var r=0;r<a;r++){if(e[r].indexOf("px")>0||e[r].indexOf("pt")>0){i=r;this._size=parseInt(e[r]);if(this._size<=0){console.error("font parse error:"+t);this._size=14}break}}var s=i+1;var n=e[s];s++;for(;s<a;s++){n+=" "+e[s]}this._family=n.split(",")[0];this._italic=e.indexOf("italic")>=0;this._bold=e.indexOf("bold")>=0}}_e.EMPTY=new _e(null);_e._cache={};_e._gfontID=0;_e._lastFont="";class he{constructor(){this.save=[];this.toUpperCase=null;this.width=-1;this.pageChars=[];this.startID=0;this.startIDStroke=0;this.lastGCCnt=0;this.splitRender=false;this.scalex=1;this.scaley=1}setText(t){this.changed=true;this._text=t;this.width=-1;this.cleanCache()}toString(){return this._text}get length(){return this._text?this._text.length:0}charCodeAt(t){return this._text?this._text.charCodeAt(t):NaN}charAt(t){return this._text?this._text.charAt(t):null}cleanCache(){let e=this.pageChars;for(var a in e){let t=e[a];var i=t.tex;var r=t.words;if(r.length==1&&i&&i.ri){i.destroy()}}this.pageChars=[];this.startID=0;this.scalex=1;this.scaley=1}}class xe{constructor(){this.char="";this.deleted=false;this.uv=new Array(8);this.pos=0;this.orix=0;this.oriy=0;this.touchTick=0;this.isSpace=false}touch(){var t=Nt.loopCount;if(this.touchTick!=t){this.tex.touchRect(this,t)}this.touchTick=t}}class ce{constructor(){this.fontsz=16}getWidth(t,e){return 0}scale(t,e){}get canvasWidth(){return 0}set canvasWidth(t){}getCharBmp(t,e,a,i,r,s,n,o,l,_,h=null){return null}}class N{static __init__(){var t=window.Laya||O.Laya;if(N._window)return N._window;var e=N._window=window;var a=N._document=e.document;var i=N.userAgent=e.navigator.userAgent;var r=e.navigator.maxTouchPoints||0;var s=e.navigator.platform;if("my"in N.window){if("tb"in N.window.my){window.tbMiniGame(t,t);if(!t["TBMiniAdapter"]){console.error("请先添加淘宝适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-6-0")}else{t["TBMiniAdapter"].enable()}}else if(i.indexOf("AlipayMiniGame")>-1){window.aliPayMiniGame(t,t);if(!t["ALIMiniAdapter"]){console.error("请先添加阿里小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-6-0")}else{t["ALIMiniAdapter"].enable()}}}if(i.indexOf("OPPO")==-1&&i.indexOf("MiniGame")>-1&&"wx"in N.window){if("tt"in N.window){window.ttMiniGame(t,t);if(!t["TTMiniAdapter"]){console.error("请引入字节跳动小游戏的适配库")}else{t["TTMiniAdapter"].enable()}}else if("bl"in N.window){window.biliMiniGame(t,t);if(!t["BLMiniAdapter"]){console.error("请引入bilibili小游戏的适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-7-0")}else{t["BLMiniAdapter"].enable()}}else if("qq"in N.window){window.qqMiniGame(t,t);if(!t["QQMiniAdapter"]){console.error("请引入手机QQ小游戏的适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-0-0")}else{t["QQMiniAdapter"].enable()}}else{window.wxMiniGame(t,t);if(!t["MiniAdpter"]){console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")}else{t["MiniAdpter"].enable()}}}if("hbs"in N.window){window.hwMiniGame(t,t);if(!t["HWMiniAdapter"]){console.error("请先添加小游戏适配库!")}else{t["HWMiniAdapter"].enable()}}if(i.indexOf("SwanGame")>-1){window.bdMiniGame(t,t);if(!t["BMiniAdapter"]){console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-1-0")}else{t["BMiniAdapter"].enable()}}if(i.indexOf("QuickGame")>-1){window.miMiniGame(t,t);if(!t["KGMiniAdapter"]){console.error("请先添加小米小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-2-0")}else{t["KGMiniAdapter"].enable()}}if(i.indexOf("OPPO")>-1&&i.indexOf("MiniGame")>-1){window.qgMiniGame(t,t);if(!t["QGMiniAdapter"]){console.error("请先添加OPPO小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-3-0")}else{t["QGMiniAdapter"].enable()}}if(i.indexOf("VVGame")>-1){window.vvMiniGame(t,t);if(!t["VVMiniAdapter"]){console.error("请先添加VIVO小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-4-0")}else{t["VVMiniAdapter"].enable()}}e.trace=console.log;e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)};var n=a.body.style;n.margin=0;n.overflow="hidden";n["-webkit-user-select"]="none";n["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";var o=a.getElementsByTagName("meta");var l=0,_=false,h="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";while(l<o.length){var x=o[l];if(x.name=="viewport"){x.content=h;_=true;break}l++}if(!_){x=a.createElement("meta");x.name="viewport",x.content=h;a.getElementsByTagName("head")[0].appendChild(x)}N.onMobile=window.isConchApp?true:i.indexOf("Mobile")>-1;N.onIOS=!!i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);N.onIPhone=i.indexOf("iPhone")>-1;N.onMac=i.indexOf("Mac OS X")>-1;N.onIPad=i.indexOf("iPad")>-1||s==="MacIntel"&&r>1;N.onAndroid=i.indexOf("Android")>-1||i.indexOf("Adr")>-1;N.onWP=i.indexOf("Windows Phone")>-1;N.onQQBrowser=i.indexOf("QQBrowser")>-1;N.onMQQBrowser=i.indexOf("MQQBrowser")>-1||i.indexOf("Mobile")>-1&&i.indexOf("QQ")>-1;N.onIE=!!e.ActiveXObject||"ActiveXObject"in e;N.onWeiXin=i.indexOf("MicroMessenger")>-1;N.onSafari=i.indexOf("Safari")>-1;N.onPC=!N.onMobile;N.onMiniGame=i.indexOf("MiniGame")>-1;N.onBDMiniGame=i.indexOf("SwanGame")>-1;N.onLayaRuntime=!!N.window.conch;if(i.indexOf("OPPO")>-1&&i.indexOf("MiniGame")>-1){N.onQGMiniGame=true;N.onMiniGame=false}else if("qq"in N.window&&i.indexOf("MiniGame")>-1){N.onQQMiniGame=true;N.onMiniGame=false}else if("bl"in N.window&&i.indexOf("MiniGame")>-1){N.onBLMiniGame=true;N.onMiniGame=false}else if("tt"in N.window&&i.indexOf("MiniGame")>-1){N.onTTMiniGame=true;N.onMiniGame=false}N.onHWMiniGame="hbs"in N.window;N.onVVMiniGame=i.indexOf("VVGame")>-1;N.onKGMiniGame=i.indexOf("QuickGame")>-1;if(i.indexOf("AlipayMiniGame")>-1){N.onAlipayMiniGame=true;N.onMiniGame=false}if(i.indexOf("TB/")>-1||i.indexOf("Taobao/")>-1||i.indexOf("TM/")>-1){N.onTBMiniGame=true}return e}static createElement(t){N.__init__();return N._document.createElement(t)}static getElementById(t){N.__init__();return N._document.getElementById(t)}static removeElement(t){if(t&&t.parentNode)t.parentNode.removeChild(t)}static now(){return Date.now()}static get clientWidth(){N.__init__();return N._window.innerWidth||N._document.body.clientWidth}static get clientHeight(){N.__init__();return N._window.innerHeight||N._document.body.clientHeight||N._document.documentElement.clientHeight}static get width(){N.__init__();return(O.stage&&O.stage.canvasRotation?N.clientHeight:N.clientWidth)*N.pixelRatio}static get height(){N.__init__();return(O.stage&&O.stage.canvasRotation?N.clientWidth:N.clientHeight)*N.pixelRatio}static get pixelRatio(){if(N._pixelRatio<0){N.__init__();if(N.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1)N._pixelRatio=2;else{N._pixelRatio=N._window.devicePixelRatio||1;if(N._pixelRatio<1)N._pixelRatio=1}}return N._pixelRatio}static get container(){if(!N._container){N.__init__();N._container=N.createElement("div");N._container.id="layaContainer";N._document.body.appendChild(N._container)}return N._container}static set container(t){N._container=t}static get window(){return N._window||N.__init__()}static get document(){N.__init__();return N._document}}N._pixelRatio=-1;N.mainCanvas=null;N.hanzi=new RegExp("^[一-龥]$");N.fontMap=[];N.measureText=function(t,e){var a=N.hanzi.test(t);if(a&&N.fontMap[e]){return N.fontMap[e]}var i=N.context;i.font=e;var r=i.measureText(t);if(a)N.fontMap[e]=r;return r};class de extends ce{constructor(t,e,a=true,i=true,r=false){super();this.ctx=null;this.lastScaleX=1;this.lastScaleY=1;this.maxTexW=0;this.maxTexH=0;this.scaleFontSize=true;this.showDbgInfo=false;this.supportImageData=true;this.maxTexW=t;this.maxTexH=e;this.scaleFontSize=a;this.supportImageData=i;this.showDbgInfo=r;if(!de.canvas){de.canvas=N.createElement("canvas");de.canvas.width=1024;de.canvas.height=512;de.canvas.style.left="-10000px";de.canvas.style.position="absolute";document.body.appendChild(de.canvas);this.ctx=de.canvas.getContext("2d")}}get canvasWidth(){return de.canvas.width}set canvasWidth(t){if(de.canvas.width==t)return;de.canvas.width=t;if(t>2048){console.warn("画文字设置的宽度太大，超过2048了")}this.ctx.setTransform(1,0,0,1,0,0);this.ctx.scale(this.lastScaleX,this.lastScaleY)}getWidth(t,e){if(!this.ctx)return 0;if(this.ctx._lastFont!=t){this.ctx.font=t;this.ctx._lastFont=t}return this.ctx.measureText(e).width}scale(t,e){if(!this.supportImageData){this.lastScaleX=t;this.lastScaleY=e;return}if(this.lastScaleX!=t||this.lastScaleY!=e){this.ctx.setTransform(t,0,0,e,0,0);this.lastScaleX=t;this.lastScaleY=e}}getCharBmp(t,e,a,i,r,s,n,o,l,_,h=null){if(!this.supportImageData)return this.getCharCanvas(t,e,a,i,r,s,n,o,l,_);var x=this.ctx;var c=this.fontsz;if(x.font!=e){x.font=e;x._lastFont=e}s.width=x.measureText(t).width;var d=s.width*this.lastScaleX;var u=s.height*this.lastScaleY;d+=(n+l)*this.lastScaleX;u+=(o+_)*this.lastScaleY;d=Math.ceil(d);u=Math.ceil(u);d=Math.min(d,de.canvas.width);u=Math.min(u,de.canvas.height);var f=d+a*2+1;var p=u+a*2+1;if(h){f=Math.max(f,h[0]+h[2]+1);p=Math.max(p,h[1]+h[3]+1)}x.clearRect(0,0,f/this.lastScaleX+1,p/this.lastScaleY+1);x.save();x.textBaseline="middle";if(a>0){x.strokeStyle=r;x.lineWidth=a;x.strokeText(t,n,o+c/2)}if(i){x.fillStyle=i;x.fillText(t,n,o+c/2)}if(this.showDbgInfo){x.strokeStyle="#ff0000";x.strokeRect(1,1,d-2,u-2);x.strokeStyle="#00ff00";x.strokeRect(n,o,s.width,s.height)}if(h){if(h[2]==-1)h[2]=Math.ceil((s.width+a*2)*this.lastScaleX);if(h[2]<=0)h[2]=1}var m=h?x.getImageData(h[0],h[1],h[2],h[3]+1):x.getImageData(0,0,d,u+1);x.restore();s.bmpWidth=m.width;s.bmpHeight=m.height;return m}getCharCanvas(t,e,a,i,r,s,n,o,l,_){var h=this.ctx;if(h.font!=e){h.font=e;h._lastFont=e}s.width=h.measureText(t).width;var x=s.width*this.lastScaleX;var c=s.height*this.lastScaleY;x+=(n+l)*this.lastScaleX;c+=(o+_)*this.lastScaleY+1;x=Math.min(x,this.maxTexW);c=Math.min(c,this.maxTexH);de.canvas.width=Math.min(x+1,this.maxTexW);de.canvas.height=Math.min(c+1,this.maxTexH);h.font=e;h.clearRect(0,0,x+1+a,c+1+a);h.setTransform(1,0,0,1,0,0);h.save();if(this.scaleFontSize){h.scale(this.lastScaleX,this.lastScaleY)}h.translate(n,o);h.textAlign="left";var d=this.fontsz;h.textBaseline="middle";if(a>0){h.strokeStyle=r;h.fillStyle=i;h.lineWidth=a;if(h.fillAndStrokeText){h.fillAndStrokeText(t,0,d/2)}else{h.strokeText(t,0,d/2);h.fillText(t,0,d/2)}}else if(i){h.fillStyle=i;h.fillText(t,0,d/2)}if(this.showDbgInfo){h.strokeStyle="#ff0000";h.strokeRect(0,0,x,c);h.strokeStyle="#00ff00";h.strokeRect(0,0,s.width,s.height)}h.restore();s.bmpWidth=de.canvas.width;s.bmpHeight=de.canvas.height;return de.canvas}}de.canvas=null;class ue extends ce{constructor(){super();this.lastFont="";this.lastScaleX=1;this.lastScaleY=1}getWidth(t,e){if(!window.conchTextCanvas)return 0;window.conchTextCanvas.font=t;this.lastFont=t;return window.conchTextCanvas.measureText(e).width}scale(t,e){this.lastScaleX=t;this.lastScaleY=e}getCharBmp(t,e,a,i,r,s,n,o,l,_,h=null){if(!window.conchTextCanvas)return null;window.conchTextCanvas.font=e;this.lastFont=e;var x=s.width=window.conchTextCanvas.measureText(t).width;var c=s.height;x+=n+l;c+=o+_;window.conchTextCanvas.scale&&window.conchTextCanvas.scale(this.lastScaleX,this.lastScaleY);var d=ut.create(r);var u=d.numColor;var f=ut.create(i);var p=f.numColor;var m=window.conchTextCanvas.getTextBitmapData(t,p,a>2?2:a,u);s.bmpWidth=m.width;s.bmpHeight=m.height;return m}}class B{constructor(){this.fontSizeInfo={};this.mapFont={};this.fontID=0;this.mapColor=[];this.colorID=0;this.fontScaleX=1;this.fontScaleY=1;this._curStrPos=0;this.textAtlases=[];this.isoTextures=[];this.lastFont=null;this.fontSizeW=0;this.fontSizeH=0;this.fontSizeOffX=0;this.fontSizeOffY=0;this.renderPerChar=true;this.tmpAtlasPos=new K;this.textureMem=0;O.TextAtlas=oe;var t=false;var e=O.Laya["MiniAdpter"];if(e&&e.systemInfo&&e.systemInfo.system){t=e.systemInfo.system.toLowerCase()==="ios 10.1.1"}if((O.Browser.onMiniGame||O.Browser.onTTMiniGame||O.Browser.onBLMiniGame||O.Browser.onAlipayMiniGame||O.Browser.onTBMiniGame)&&!t)B.isWan1Wan=true;this.charRender=O.Render.isConchApp?new ue:new de(2048,2048,B.scaleFontWithCtx,!B.isWan1Wan,false);B.textRenderInst=this;O.Laya["textRender"]=this;B.atlasWidth2=B.atlasWidth*B.atlasWidth}setFont(t){if(this.lastFont==t)return;this.lastFont=t;var e=this.getFontSizeInfo(t._family);var a=e>>24;var i=e>>16&255;var r=e>>8&255;var s=e&255;var n=t._size/B.standardFontSize;this.fontSizeOffX=Math.ceil(a*n);this.fontSizeOffY=Math.ceil(i*n);this.fontSizeW=Math.ceil(r*n);this.fontSizeH=Math.ceil(s*n);if(t._font.indexOf("italic")>=0){this.fontStr=t._font.replace("italic","")}else{this.fontStr=t._font}}getNextChar(t){var e=t.length;var a=this._curStrPos;if(!t.substring)return null;if(a>=e)return null;var i=a;var r=0;for(;i<e;i++){var s=t.charCodeAt(i);if(s>>>11==27){if(r==1)break;r=1;i++}else if(s===65038||s===65039);else if(s==8205){r=2}else{if(r==0)r=1;else if(r==1)break}}this._curStrPos=i;return t.substring(a,i)}filltext(t,e,a,i,r,s,n,o,l,_=0){if(e.length<=0)return;var h=_e.Parse(r);var x=0;switch(l){case"center":x=O.Context.ENUM_TEXTALIGN_CENTER;break;case"right":x=O.Context.ENUM_TEXTALIGN_RIGHT;break}this._fast_filltext(t,e,null,a,i,h,s,n,o,x,_)}fillWords(t,e,a,i,r,s,n,o){if(!e)return;if(e.length<=0)return;var l=typeof r==="string"?_e.Parse(r):r;this._fast_filltext(t,null,e,a,i,l,s,n,o,0,0)}_fast_filltext(t,e,a,i,r,s,n,o,l,_,h=0){if(e&&!(e.length>=1))return;if(a&&a.length<1)return;if(l<0)l=0;this.setFont(s);this.fontScaleX=this.fontScaleY=1;if(B.scaleFontWithCtx){var x=1;var c=1;if(!O.Render.isConchApp||window.conchTextCanvas.scale){x=t.getMatScaleX();c=t.getMatScaleY()}if(x<1e-4||c<.1)return;if(x>1)this.fontScaleX=x;if(c>1)this.fontScaleY=c}s._italic&&(t._italicDeg=13);var d=e;var u=!a&&e instanceof he;var f=e&&e.toString();var p=!!a;var m=u?d.pageChars:[];var g=0;if(u){f=d._text;g=d.width;if(g<0){g=d.width=this.charRender.getWidth(this.fontStr,f)}}else{g=f?this.charRender.getWidth(this.fontStr,f):0}switch(_){case O.Context.ENUM_TEXTALIGN_CENTER:i-=g/2;break;case O.Context.ENUM_TEXTALIGN_RIGHT:i-=g;break}if(d&&m){if(this.hasFreedText(m)){m=d.pageChars=[]}}var v=null;var y=this.renderPerChar=!u||B.forceSplitRender||p||u&&d.splitRender;if(!m||m.length<1){if(u){d.scalex=this.fontScaleX;d.scaley=this.fontScaleY}if(y){var T=0;var E=0;this._curStrPos=0;var b;while(true){if(a){var S=a[this._curStrPos++];if(S){b=S.char;T=S.x;E=S.y}else{b=null}}else{b=this.getNextChar(f)}if(!b)break;v=this.getCharRenderInfo(b,s,n,o,l,false);if(!v){break}if(v.isSpace);else{var C=m[v.tex.id];if(!C){var R={texgen:v.tex.genID,tex:v.tex,words:[]};m[v.tex.id]=R;C=R.words}else{C=C.words}C.push({ri:v,x:T,y:E,w:v.bmpWidth/this.fontScaleX,h:v.bmpHeight/this.fontScaleY});T+=v.width}}}else{var A=O.Render.isConchApp?0:s._size/3|0;var L=B.noAtlas||(g+A+A)*this.fontScaleX>B.atlasWidth;v=this.getCharRenderInfo(f,s,n,o,l,L);m[0]={texgen:v.tex.genID,tex:v.tex,words:[{ri:v,x:0,y:0,w:v.bmpWidth/this.fontScaleX,h:v.bmpHeight/this.fontScaleY}]}}}this._drawResortedWords(t,i,r,m);t._italicDeg=0}_drawResortedWords(e,a,i,t){var r=e._charSubmitCache?e._charSubmitCache._enable:false;var s=e._curMat;var n=t.length;for(var o in t){var l=t[o];if(!l)continue;var _=l.words;var h=_.length;if(h<=0)continue;var x=t[o].tex;for(var c=0;c<h;c++){var d=_[c];var u=d.ri;if(u.isSpace)continue;u.touch();e.drawTexAlign=true;if(O.Render.isConchApp){e._drawTextureM(x.texture,a+d.x-u.orix,i+d.y-u.oriy,d.w,d.h,null,1,u.uv)}else{let t=x;e._inner_drawTexture(t.texture,t.id,a+d.x-u.orix,i+d.y-u.oriy,d.w,d.h,s,u.uv,1,r)}if(e.touches){e.touches.push(u)}}}}hasFreedText(e){for(let t in e){var a=e[t];if(!a)continue;var i=a.tex;if(i.__destroyed||i.genID!=a.texgen){return true}}return false}getCharRenderInfo(t,e,a,i,r,s=false){var n=this.mapFont[e._family];if(n==undefined){this.mapFont[e._family]=n=this.fontID++}var o=t+"_"+n+"_"+e._size+"_"+a;if(r>0)o+="_"+i+r;if(e._bold)o+="P";if(this.fontScaleX!=1||this.fontScaleY!=1){o+=(this.fontScaleX*20|0)+"_"+(this.fontScaleY*20|0)}var l=0;var _=this.textAtlases.length;var h;var x;if(!s){for(l=0;l<_;l++){x=this.textAtlases[l];h=x.charMaps[o];if(h){h.touch();return h}}}h=new xe;this.charRender.scale(this.fontScaleX,this.fontScaleY);h.char=t;h.height=e._size;var c=O.Render.isConchApp?0:e._size/3|0;var d=null;if(!r){r=0}var u=Math.ceil((this.charRender.getWidth(this.fontStr,t)+2*r)*this.fontScaleX);if(u>this.charRender.canvasWidth){this.charRender.canvasWidth=Math.min(2048,u+c*2)}if(s){this.charRender.fontsz=e._size;d=this.charRender.getCharBmp(t,this.fontStr,r,a,i,h,c,c,c,c,null);if(d){var f=y.getTextTexture(d.width,d.height);f.addChar(d,0,0,h.uv);h.tex=f;h.orix=c;h.oriy=c;f.ri=h;this.isoTextures.push(f)}}else{var p=t.length;var m=r*1;var g=Math.ceil((this.fontSizeW+m*2)*this.fontScaleX);var v=Math.ceil((this.fontSizeH+m*2)*this.fontScaleY);B.imgdtRect[0]=(c-this.fontSizeOffX-m)*this.fontScaleX|0;B.imgdtRect[1]=(c-this.fontSizeOffY-m)*this.fontScaleY|0;if(this.renderPerChar||p==1){B.imgdtRect[2]=Math.max(u,g);B.imgdtRect[3]=Math.max(u,v)}else{B.imgdtRect[2]=-1;B.imgdtRect[3]=v}this.charRender.fontsz=e._size;d=this.charRender.getCharBmp(t,this.fontStr,r,a,i,h,c,c,c,c,B.imgdtRect);if(d){x=this.addBmpData(d,h);if(B.isWan1Wan){h.orix=c;h.oriy=c}else{h.orix=this.fontSizeOffX+m;h.oriy=this.fontSizeOffY+m}x.charMaps[o]=h}}return h}addBmpData(t,e){var a=t.width;var i=t.height;var r=this.textAtlases.length;var s;var n=false;for(var o=0;o<r;o++){s=this.textAtlases[o];n=s.getAEmpty(a,i,this.tmpAtlasPos);if(n){break}}if(!n){s=new oe;this.textAtlases.push(s);n=s.getAEmpty(a,i,this.tmpAtlasPos);if(!n){throw"err1"}this.cleanAtlases()}if(n){s.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv);e.tex=s.texture}return s}GC(){var t=0;var e=this.textAtlases.length;var a=0;var i=B.destroyAtlasDt;var r=0;var s=0;var n=Nt.loopCount;var o=-1;var l=0;var _=null;var h=null;for(;t<e;t++){h=this.textAtlases[t];_=h.texture;if(_){r+=_.curUsedCovRate;s+=_.curUsedCovRateAtlas;var x=h.usedRate-_.curUsedCovRateAtlas;if(l<x){l=x;o=t}}a=n-h.texture.lastTouchTm;if(a>i){B.showLog&&console.log("TextRender GC delete atlas "+_?h.texture.id:"unk");h.destroy();this.textAtlases[t]=this.textAtlases[e-1];e--;t--;o=-1}}this.textAtlases.length=e;e=this.isoTextures.length;for(t=0;t<e;t++){_=this.isoTextures[t];a=n-_.lastTouchTm;if(a>B.destroyUnusedTextureDt){_.ri.deleted=true;_.ri.tex=null;_.destroy();this.isoTextures[t]=this.isoTextures[e-1];e--;t--}}this.isoTextures.length=e;var c=this.textAtlases.length>1&&this.textAtlases.length-s>=2;if(B.atlasWidth*B.atlasWidth*4*this.textAtlases.length>B.cleanMem||c||B.simClean){B.simClean=false;B.showLog&&console.log("清理使用率低的贴图。总使用率:",s,":",this.textAtlases.length,"最差贴图:"+o);if(o>=0){h=this.textAtlases[o];h.destroy();this.textAtlases[o]=this.textAtlases[this.textAtlases.length-1];this.textAtlases.length=this.textAtlases.length-1}}y.clean()}cleanAtlases(){}getCharBmp(t){}checkBmpLine(t,e,a,i){if(this.bmpData32.buffer!=t.data.buffer){this.bmpData32=new Uint32Array(t.data.buffer)}var r=t.width*e+a;for(var s=a;s<i;s++){if(this.bmpData32[r++]!=0)return true}return false}updateBbx(t,e,a=false){var i=t.width;var r=t.height;var s=0;var n=e[1];var o=0;var l=n;if(this.checkBmpLine(t,n,0,i)){while(true){l=(n+o)/2|0;if(l+1>=n){e[1]=l;break}if(this.checkBmpLine(t,l,0,i)){n=l}else{o=l}}}if(e[3]>r)e[3]=r;else{l=n=e[3];o=r;if(this.checkBmpLine(t,n,0,i)){while(true){l=(n+o)/2|0;if(l-1<=n){e[3]=l;break}if(this.checkBmpLine(t,l,0,i)){n=l}else{o=l}}}}if(a)return;var _=e[0];var h=i*e[1];for(l=e[1];l<e[3];l++){for(s=0;s<_;s++){if(this.bmpData32[h+s]!=0){_=s;break}}h+=i}e[0]=_;var x=e[2];h=i*e[1];for(l=e[1];l<e[3];l++){for(s=x;s<i;s++){if(this.bmpData32[h+s]!=0){x=s;break}}h+=i}e[2]=x}getFontSizeInfo(t){var e=this.fontSizeInfo[t];if(e!=undefined)return e;var a="bold "+B.standardFontSize+"px "+t;if(B.isWan1Wan){this.fontSizeW=this.charRender.getWidth(a,"有")*1.5;this.fontSizeH=B.standardFontSize*1.5;var i=this.fontSizeW<<8|this.fontSizeH;this.fontSizeInfo[t]=i;return i}B.pixelBBX[0]=B.standardFontSize/2;B.pixelBBX[1]=B.standardFontSize/2;B.pixelBBX[2]=B.standardFontSize;B.pixelBBX[3]=B.standardFontSize;var r=16;var s=16;var n=16;var o=16;this.charRender.scale(1,1);B.tmpRI.height=B.standardFontSize;this.charRender.fontsz=B.standardFontSize;var l=this.charRender.getCharBmp("g",a,0,"red",null,B.tmpRI,r,s,n,o);if(O.Render.isConchApp){l.data=new Uint8ClampedArray(l.data)}this.bmpData32=new Uint32Array(l.data.buffer);this.updateBbx(l,B.pixelBBX,false);l=this.charRender.getCharBmp("有",a,0,"red",null,B.tmpRI,s,s,n,o);if(O.Render.isConchApp){l.data=new Uint8ClampedArray(l.data)}this.bmpData32=new Uint32Array(l.data.buffer);if(B.pixelBBX[2]<r+B.tmpRI.width)B.pixelBBX[2]=r+B.tmpRI.width;this.updateBbx(l,B.pixelBBX,false);if(O.Render.isConchApp){r=0;s=0}var _=Math.max(r-B.pixelBBX[0],0);var h=Math.max(s-B.pixelBBX[1],0);var x=B.pixelBBX[2]-B.pixelBBX[0];var c=B.pixelBBX[3]-B.pixelBBX[1];var d=_<<24|h<<16|x<<8|c;this.fontSizeInfo[t]=d;return d}printDbgInfo(){console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+B.atlasWidth+"x"+B.atlasWidth," 用canvas:",B.isWan1Wan);console.log("图集占用空间:"+B.atlasWidth*B.atlasWidth*4/1024/1024*this.textAtlases.length+"M");console.log("缓存用到的字体:");for(var t in this.mapFont){var e=this.getFontSizeInfo(t);var a=e>>24;var i=e>>16&255;var r=e>>8&255;var s=e&255;console.log("    "+t," off:",a,i," size:",r,s)}var n=0;console.log("缓存数据:");var o=0;var l=0;this.textAtlases.forEach(function(t){var e=t.texture.id;var a=Nt.loopCount-t.texture.lastTouchTm;var i=a>0?""+a+"帧以前":"当前帧";o+=t.texture.curUsedCovRate;l+=t.texture.curUsedCovRateAtlas;console.log("--图集(id:"+e+",当前使用率:"+(t.texture.curUsedCovRate*1e3|0)+"‰","当前图集使用率:",(t.texture.curUsedCovRateAtlas*100|0)+"%","图集使用率:",t.usedRate*100|0,"%, 使用于:"+i+")--:");for(var r in t.charMaps){var s=t.charMaps[r];console.log("     off:",s.orix,s.oriy," bmp宽高:",s.bmpWidth,s.bmpHeight,"无效:",s.deleted,"touchdt:",Nt.loopCount-s.touchTick,"位置:",s.uv[0]*B.atlasWidth|0,s.uv[1]*B.atlasWidth|0,"字符:",s.char,"key:",r);n++}});console.log("独立贴图文字("+this.isoTextures.length+"个):");this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",Nt.loopCount-t.lastTouchTm,"char:",t.ri.char)});console.log("总缓存:",n,"总使用率:",o,"总当前图集使用率:",l)}showAtlas(t,a,e,i,r,s){if(!this.textAtlases[t]){console.log("没有这个图集");return null}var n=new O.Sprite;var o=this.textAtlases[t].texture;var l={width:B.atlasWidth,height:B.atlasWidth,sourceWidth:B.atlasWidth,sourceHeight:B.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return true},_addReference:function(){},_removeReference:function(){},_getSource:function(){return o._getSource()},bitmap:{id:o.id},_uv:le.DEF_UV};n.size=function(t,e){this.width=t;this.height=e;n.graphics.clear();n.graphics.drawRect(0,0,n.width,n.height,a);n.graphics.drawTexture(l,0,0,n.width,n.height);return this};n.graphics.drawRect(0,0,r,s,a);n.graphics.drawTexture(l,0,0,r,s);n.pos(e,i);O.stage.addChild(n);return n}filltext_native(t,e,a,i,r,s,n,o,l,_,h=0){if(e&&e.length<=0)return;if(a&&a.length<1)return;var x=_e.Parse(s);var c=0;switch(_){case"center":c=O.Context.ENUM_TEXTALIGN_CENTER;break;case"right":c=O.Context.ENUM_TEXTALIGN_RIGHT;break}return this._fast_filltext(t,e,a,i,r,x,n,o,l,c,h)}}B.useOldCharBook=false;B.atlasWidth=1024;B.noAtlas=false;B.forceSplitRender=false;B.forceWholeRender=false;B.scaleFontWithCtx=true;B.standardFontSize=32;B.destroyAtlasDt=10;B.checkCleanTextureDt=2e3;B.destroyUnusedTextureDt=3e3;B.cleanMem=100*1024*1024;B.isWan1Wan=false;B.showLog=false;B.debugUV=false;B.tmpRI=new xe;B.pixelBBX=[0,0,0,0];B.imgdtRect=[0,0,0,0];B.simClean=false;y.gTextRender=B;class W{constructor(){this._tmpMatrix=new L;this._drawTexToDrawTri_Vert=new Float32Array(8);this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]);this._tempUV=new Float32Array(8);this._drawTriUseAbsMatrix=false;this._id=++W._COUNT;this._other=null;this._renderNextSubmitIndex=0;this._path=null;this._drawCount=1;this._width=W._MAXSIZE;this._height=W._MAXSIZE;this._renderCount=0;this._submits=null;this._curSubmit=null;this._submitKey=new xt;this._mesh=null;this._pathMesh=null;this._triangleMesh=null;this.meshlist=[];this._transedPoints=new Array(8);this._temp4Points=new Array(8);this._clipRect=W.MAXCLIPRECT;this._globalClipMatrix=new L(W._MAXSIZE,0,0,W._MAXSIZE,0,0);this._clipInCache=false;this._clipInfoID=0;this._clipID_Gen=0;this._lastMatScaleX=1;this._lastMatScaleY=1;this._lastMat_a=1;this._lastMat_b=0;this._lastMat_c=0;this._lastMat_d=1;this._nBlendType=0;this._save=null;this._targets=null;this._charSubmitCache=null;this._saveMark=null;this._shader2D=new Kt;this.sprite=null;this._italicDeg=0;this._lastTex=null;this._fillColor=0;this._flushCnt=0;this.defTexture=null;this._colorFiler=null;this.drawTexAlign=false;this._incache=false;this.isMain=false;W._contextcount++;W._textRender=W._textRender||new B;if(!this.defTexture){var t=new at(2,2);t.setPixels(new Uint8Array(16));t.lock=true;this.defTexture=new le(t)}this._lastTex=this.defTexture;this.clear()}static __init__(){W.MAXCLIPRECT=new R(0,0,W._MAXSIZE,W._MAXSIZE);fe.DEFAULT=new fe}drawImage(...t){}getImageData(...t){}measureText(t){return null}setTransform(...t){}$transform(t,e,a,i,r,s){}get lineJoin(){return""}set lineJoin(t){}get lineCap(){return""}set lineCap(t){}get miterLimit(){return""}set miterLimit(t){}clearRect(t,e,a,i){}_drawRect(t,e,a,i,r){g.renderBatches++;r&&(this.fillStyle=r);this.fillRect(t,e,a,i,null)}drawTexture2(t,e,a,i,r,s){}transformByMatrix(t,e,a){this.transform(t.a,t.b,t.c,t.d,t.tx+e,t.ty+a)}saveTransform(t){this.save()}restoreTransform(t){this.restore()}drawRect(t,e,a,i,r,s,n){var o=this;if(r!=null){o.fillStyle=r;o.fillRect(t,e,a,i)}if(s!=null){o.strokeStyle=s;o.lineWidth=n;o.strokeRect(t,e,a,i)}}alpha(t){this.globalAlpha*=t}_transform(t,e,a){this.translate(e,a);this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty);this.translate(-e,-a)}_rotate(t,e,a){this.translate(e,a);this.rotate(t);this.translate(-e,-a)}_scale(t,e,a,i){this.translate(a,i);this.scale(t,e);this.translate(-a,-i)}_drawLine(t,e,a,i,r,s,n,o,l){this.beginPath();this.strokeStyle=n;this.lineWidth=o;this.moveTo(t+a,e+i);this.lineTo(t+r,e+s);this.stroke()}_drawLines(t,e,a,i,r,s){this.beginPath();this.strokeStyle=i;this.lineWidth=r;this.addPath(a.slice(),false,false,t,e);this.stroke()}drawCurves(t,e,a,i,r){this.beginPath();this.strokeStyle=i;this.lineWidth=r;this.moveTo(t+a[0],e+a[1]);var s=2,n=a.length;while(s<n){this.quadraticCurveTo(t+a[s++],e+a[s++],t+a[s++],e+a[s++])}this.stroke()}_fillAndStroke(t,e,a,i=false){if(t!=null){this.fillStyle=t;this.fill()}if(e!=null&&a>0){this.strokeStyle=e;this.lineWidth=a;this.stroke()}}_drawCircle(t,e,a,i,r,s,n){g.renderBatches++;this.beginPath(true);this.arc(t,e,a,0,W.PI2);this.closePath();this._fillAndStroke(i,r,s)}_drawPie(t,e,a,i,r,s,n,o,l){this.beginPath();this.moveTo(t,e);this.arc(t,e,a,i,r);this.closePath();this._fillAndStroke(s,n,o)}_drawPoly(t,e,a,i,r,s,n,o){this.beginPath();this.addPath(a.slice(),true,n,t,e);this.closePath();this._fillAndStroke(i,r,s,n)}_drawPath(t,e,a,i,r){this.beginPath();for(var s=0,n=a.length;s<n;s++){var o=a[s];switch(o[0]){case"moveTo":this.moveTo(t+o[1],e+o[2]);break;case"lineTo":this.lineTo(t+o[1],e+o[2]);break;case"arcTo":this.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":this.closePath();break}}if(i!=null){this.fillStyle=i.fillStyle;this.fill()}if(r!=null){this.strokeStyle=r.strokeStyle;this.lineWidth=r.lineWidth||1;this.lineJoin=r.lineJoin;this.lineCap=r.lineCap;this.miterLimit=r.miterLimit;this.stroke()}}static set2DRenderConfig(){var t=f.instance;p.setBlend(t,true);p.setBlendEquation(t,t.FUNC_ADD);M.activeBlendFunction=null;p.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_ALPHA);p.setDepthTest(t,false);p.setCullFace(t,false);p.setDepthMask(t,true);p.setFrontFace(t,t.CCW);t.viewport(0,0,_.width,_.height)}clearBG(t,e,a,i){var r=p.mainContext;r.clearColor(t,e,a,i);r.clear(r.COLOR_BUFFER_BIT)}_getSubmits(){return this._submits}_releaseMem(t=false){if(!this._submits)return;this._curMat&&this._curMat.destroy();this._curMat=null;this._shader2D.destroy();this._shader2D=null;this._charSubmitCache.clear();for(var e=0,a=this._submits._length;e<a;e++){this._submits[e].releaseRender()}this._submits.length=0;this._submits._length=0;this._submits=null;this._curSubmit=null;this._path=null;this._save=null;var i;for(e=0,i=this.meshlist.length;e<i;e++){var r=this.meshlist[e];r.destroy()}this.meshlist.length=0;this.sprite=null;if(!t){this._targets&&this._targets.destroy();this._targets=null}}destroy(t=false){--W._contextcount;this.sprite=null;this._releaseMem(t);this._charSubmitCache.destroy();this._mesh.destroy();if(!t){this._targets&&this._targets.destroy();this._targets=null}}clear(){if(!this._submits){this._other=fe.DEFAULT;this._curMat=L.create();this._charSubmitCache=new se;this._mesh=kt.getAMesh(this.isMain);this.meshlist.push(this._mesh);this._pathMesh=Ht.getAMesh(this.isMain);this.meshlist.push(this._pathMesh);this._triangleMesh=Gt.getAMesh(this.isMain);this.meshlist.push(this._triangleMesh);this._submits=[];this._save=[It.Create(this)];this._save.length=10;this._shader2D=new Kt}this._submitKey.clear();this._mesh.clearVB();this._drawCount=1;this._other=fe.DEFAULT;this._other.lineWidth=this._shader2D.ALPHA=1;this._nBlendType=0;this._clipRect=W.MAXCLIPRECT;this._curSubmit=C.RENDERBASE;C.RENDERBASE._ref=16777215;C.RENDERBASE._numEle=0;this._shader2D.fillStyle=this._shader2D.strokeStyle=Ct.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0;this._curMat.identity();this._other.clear();this._saveMark=this._save[0];this._save._length=1}size(t,e){if(this._width!=t||this._height!=e){this._width=t;this._height=e;if(this._targets){this._targets.destroy();this._targets=new rt(t,e,A.RenderTextureFormat.R8G8B8A8,-1)}if(this.isMain){p.mainContext.viewport(0,0,t,e);_.width=t;_.height=e}}if(t===0&&e===0)this._releaseMem()}set asBitmap(t){if(t){let t=this._targets;if(!this._width||!this._height)throw Error("asBitmap no size!");if(!t||t.width!=this._width||t.height!=this._height){if(t){t.destroy()}this._targets=new rt(this._width,this._height,A.RenderTextureFormat.R8G8B8A8,-1)}}else{this._targets&&this._targets.destroy();this._targets=null}}getMatScaleX(){if(this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b)return this._lastMatScaleX;this._lastMatScaleX=this._curMat.getScaleX();this._lastMat_a=this._curMat.a;this._lastMat_b=this._curMat.b;return this._lastMatScaleX}getMatScaleY(){if(this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d)return this._lastMatScaleY;this._lastMatScaleY=this._curMat.getScaleY();this._lastMat_c=this._curMat.c;this._lastMat_d=this._curMat.d;return this._lastMatScaleY}setFillColor(t){this._fillColor=t}getFillColor(){return this._fillColor}set fillStyle(t){if(!this._shader2D.fillStyle.equal(t)){o.save(this,o.TYPE_FILESTYLE,this._shader2D,false);this._shader2D.fillStyle=Ct.create(t);this._submitKey.other=-this._shader2D.fillStyle.toInt()}}get fillStyle(){return this._shader2D.fillStyle}set globalAlpha(t){t=Math.floor(t*1e3)/1e3;if(t!=this._shader2D.ALPHA){o.save(this,o.TYPE_ALPHA,this._shader2D,false);this._shader2D.ALPHA=t}}get globalAlpha(){return this._shader2D.ALPHA}set textAlign(t){this._other.textAlign===t||(this._other=this._other.make(),o.save(this,o.TYPE_TEXTALIGN,this._other,false),this._other.textAlign=t)}get textAlign(){return this._other.textAlign}set textBaseline(t){this._other.textBaseline===t||(this._other=this._other.make(),o.save(this,o.TYPE_TEXTBASELINE,this._other,false),this._other.textBaseline=t)}get textBaseline(){return this._other.textBaseline}set globalCompositeOperation(t){var e=M.TOINT[t];e==null||this._nBlendType===e||(o.save(this,o.TYPE_GLOBALCOMPOSITEOPERATION,this,true),this._curSubmit=C.RENDERBASE,this._nBlendType=e)}get globalCompositeOperation(){return M.NAMES[this._nBlendType]}set strokeStyle(t){this._shader2D.strokeStyle.equal(t)||(o.save(this,o.TYPE_STROKESTYLE,this._shader2D,false),this._shader2D.strokeStyle=Ct.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}get strokeStyle(){return this._shader2D.strokeStyle}translate(t,e){if(t!==0||e!==0){Dt.save(this);if(this._curMat._bTransform){Mt.save(this);this._curMat.tx+=t*this._curMat.a+e*this._curMat.c;this._curMat.ty+=t*this._curMat.b+e*this._curMat.d}else{this._curMat.tx=t;this._curMat.ty=e}}}set lineWidth(t){this._other.lineWidth===t||(this._other=this._other.make(),o.save(this,o.TYPE_LINEWIDTH,this._other,false),this._other.lineWidth=t)}get lineWidth(){return this._other.lineWidth}save(){this._save[this._save._length++]=It.Create(this)}restore(){var t=this._save._length;var e=this._nBlendType;if(t<1)return;for(var a=t-1;a>=0;a--){var i=this._save[a];i.restore(this);if(i.isSaveMark()){this._save._length=a;return}}if(e!=this._nBlendType){this._curSubmit=C.RENDERBASE}}set font(t){this._other=this._other.make();o.save(this,o.TYPE_FONT,this._other,false)}fillText(t,e,a,i,r,s,n=0,o=""){W._textRender.filltext(this,t,e,a,i,r,o,n,s)}drawText(t,e,a,i,r,s){W._textRender.filltext(this,t,e,a,i,r,null,0,s)}fillWords(t,e,a,i,r){W._textRender.fillWords(this,t,e,a,i,r,null,0)}strokeWord(t,e,a,i,r,s,n){W._textRender.filltext(this,t,e,a,i,null,r,s,n)}fillBorderText(t,e,a,i,r,s,n,o){W._textRender.filltext(this,t,e,a,i,r,s,n,o)}fillBorderWords(t,e,a,i,r,s,n){W._textRender.fillWords(this,t,e,a,i,r,s,n)}_fast_filltext(t,e,a,i,r,s,n,o,l=0){W._textRender._fast_filltext(this,t,null,e,a,i,r,s,n,o,l)}_fillRect(t,e,a,i,r){var s=this._curSubmit;var n=s&&(s._key.submitType===C.KEY_DRAWTEXTURE&&s._key.blendShader===this._nBlendType);if(this._mesh.vertNum+4>W._MAXVERTNUM){this._mesh=kt.getAMesh(this.isMain);this.meshlist.push(this._mesh);n=false}n&&(n=n&&this.isSameClipInfo(s));this.transformQuad(t,e,a,i,0,this._curMat,this._transedPoints);if(!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,le.NO_UV,r,false);if(!n){s=this._curSubmit=re.create(this,this._mesh,ht.create(D.TEXTURE2D,0));this._submits[this._submits._length++]=s;this._copyClipInfo(s,this._globalClipMatrix);s.shaderValue.textureHost=this._lastTex;s._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1;s._renderType=C.TYPE_TEXTURE}this._curSubmit._numEle+=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4}}fillRect(t,e,a,i,r){var s=r?Ct.create(r):this._shader2D.fillStyle;var n=this.mixRGBandAlpha(s.toInt());this._fillRect(t,e,a,i,n)}fillTexture(t,e,a,i,r,s,n,o){if(!t._getSource()){this.sprite&&O.systemTimer.callLater(this,this._repaintSprite);return}this._fillTexture(t,t.width,t.height,t.uvrect,e,a,i,r,s,n.x,n.y)}_fillTexture(t,e,a,i,r,s,n,o,l,_,h){var x=this._curSubmit;if(this._mesh.vertNum+4>W._MAXVERTNUM){this._mesh=kt.getAMesh(this.isMain);this.meshlist.push(this._mesh)}var c=true;var d=true;switch(l){case"repeat":break;case"repeat-x":d=false;break;case"repeat-y":c=false;break;case"no-repeat":c=d=false;break;default:break}var u=this._temp4Points;var f=0;var p=0;var m=0,g=0,v=0,y=0;if(_<0){m=r;f=-_%e/e}else{m=r+_}if(h<0){g=s;p=-h%a/a}else{g=s+h}v=r+n;y=s+o;!c&&(v=Math.min(v,r+_+e));!d&&(y=Math.min(y,s+h+a));if(v<r||y<s)return;if(m>v||g>y)return;var T=(v-r-_)/e;var E=(y-s-h)/a;this.transformQuad(m,g,v-m,y-g,0,this._curMat,this._transedPoints);u[0]=f;u[1]=p;u[2]=T;u[3]=p;u[4]=T;u[5]=E;u[6]=f;u[7]=E;if(!this.clipedOff(this._transedPoints)){var b=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,u,b,true);var S=ht.create(D.TEXTURE2D,0);S.defines.add(D.FILLTEXTURE);S.u_TexRange=i.concat();x=this._curSubmit=re.create(this,this._mesh,S);this._submits[this._submits._length++]=x;this._copyClipInfo(x,this._globalClipMatrix);x.shaderValue.textureHost=t;x._renderType=C.TYPE_TEXTURE;this._curSubmit._numEle+=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4}this.breakNextMerge()}setColorFilter(t){o.save(this,o.TYPE_COLORFILTER,this,true);this._colorFiler=t;this._curSubmit=C.RENDERBASE}drawTexture(t,e,a,i,r){this._drawTextureM(t,e,a,i,r,null,1,null)}drawTextures(t,e,a,i){if(!t._getSource()){this.sprite&&O.systemTimer.callLater(this,this._repaintSprite);return}var r=e.length/2;var s=0;var n=t.bitmap.id;for(var o=0;o<r;o++){this._inner_drawTexture(t,n,e[s++]+a,e[s++]+i,0,0,null,null,1,false)}}_drawTextureAddSubmit(t,e){var a=null;a=re.create(this,this._mesh,ht.create(D.TEXTURE2D,0));this._submits[this._submits._length++]=a;a.shaderValue.textureHost=e;a._key.other=t;a._renderType=C.TYPE_TEXTURE;this._curSubmit=a}_drawTextureM(t,e,a,i,r,s,n,o){var l=this.sprite;if(!t._getSource(function(){if(l){l.repaint()}})){return false}return this._inner_drawTexture(t,t.bitmap.id,e,a,i,r,s,o,n,false)}_drawRenderTexture(t,e,a,i,r,s,n,o){return this._inner_drawTexture(t,-1,e,a,i,r,s,o,1,false)}submitDebugger(){this._submits[this._submits._length++]=ct.create([],function(){debugger},this)}_copyClipInfo(t,e){var a=t.shaderValue.clipMatDir;a[0]=e.a;a[1]=e.b;a[2]=e.c;a[3]=e.d;var i=t.shaderValue.clipMatPos;i[0]=e.tx;i[1]=e.ty;t.clipInfoID=this._clipInfoID;if(this._clipInCache){t.shaderValue.clipOff[0]=1}}isSameClipInfo(t){return t.clipInfoID===this._clipInfoID}_useNewTex2DSubmit(t,e){if(this._mesh.vertNum+e>W._MAXVERTNUM){this._mesh=kt.getAMesh(this.isMain);this.meshlist.push(this._mesh)}var a=re.create(this,this._mesh,ht.create(D.TEXTURE2D,0));this._submits[this._submits._length++]=this._curSubmit=a;a.shaderValue.textureHost=t;this._copyClipInfo(a,this._globalClipMatrix)}_drawTexRect(t,e,a,i,r){this.transformQuad(t,e,a,i,this._italicDeg,this._curMat,this._transedPoints);var s=this._transedPoints;s[0]=s[0]+.5|0;s[1]=s[1]+.5|0;s[2]=s[2]+.5|0;s[3]=s[3]+.5|0;s[4]=s[4]+.5|0;s[5]=s[5]+.5|0;s[6]=s[6]+.5|0;s[7]=s[7]+.5|0;if(!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,r,this._fillColor,true);this._curSubmit._numEle+=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4}}drawCallOptimize(t){this._charSubmitCache.enable(t,this);return t}_inner_drawTexture(t,e,a,i,r,s,n,o,l,_){if(r<=0||s<=0){return}var h=this._curSubmit._key;o=o||t._uv;if(h.submitType===C.KEY_TRIANGLES&&h.other===e){var x=this._drawTexToDrawTri_Vert;x[0]=a;x[1]=i;x[2]=a+r,x[3]=i,x[4]=a+r,x[5]=i+s,x[6]=a,x[7]=i+s;this._drawTriUseAbsMatrix=true;var c=this._tempUV;c[0]=o[0];c[1]=o[1];c[2]=o[2];c[3]=o[3];c[4]=o[4];c[5]=o[5];c[6]=o[6];c[7]=o[7];this.drawTriangles(t,0,0,x,c,this._drawTexToDrawTri_Index,n,l,null,null);this._drawTriUseAbsMatrix=false;return true}var d=this._mesh;var u=this._curSubmit;var f=_?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(a,i,r||t.width,s||t.height,this._italicDeg,n||this._curMat,f);if(this.drawTexAlign){var p=Math.round;f[0]=p(f[0]);f[1]=p(f[1]);f[2]=p(f[2]);f[3]=p(f[3]);f[4]=p(f[4]);f[5]=p(f[5]);f[6]=p(f[6]);f[7]=p(f[7]);this.drawTexAlign=false}var m=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*l);if(_){this._charSubmitCache.add(this,t,e,f,o,m);return true}this._drawCount++;var g=e>=0&&h.submitType===C.KEY_DRAWTEXTURE&&h.other===e;g&&(g=g&&this.isSameClipInfo(u));this._lastTex=t;if(d.vertNum+4>W._MAXVERTNUM){d=this._mesh=kt.getAMesh(this.isMain);this.meshlist.push(d);g=false}{d.addQuad(f,o,m,true);if(!g){this._submits[this._submits._length++]=this._curSubmit=u=re.create(this,d,ht.create(D.TEXTURE2D,0));u.shaderValue.textureHost=t;u._key.other=e;this._copyClipInfo(u,this._globalClipMatrix)}u._numEle+=6;d.indexNum+=6;d.vertNum+=4;return true}return false}transform4Points(t,e,a){var i=e.tx;var r=e.ty;var s=e.a;var n=e.b;var o=e.c;var l=e.d;var _=t[0];var h=t[1];var x=t[2];var c=t[3];var d=t[4];var u=t[5];var f=t[6];var p=t[7];if(e._bTransform){a[0]=_*s+h*o+i;a[1]=_*n+h*l+r;a[2]=x*s+c*o+i;a[3]=x*n+c*l+r;a[4]=d*s+u*o+i;a[5]=d*n+u*l+r;a[6]=f*s+p*o+i;a[7]=f*n+p*l+r}else{a[0]=_+i;a[1]=h+r;a[2]=x+i;a[3]=c+r;a[4]=d+i;a[5]=u+r;a[6]=f+i;a[7]=p+r}}clipedOff(t){if(this._clipRect.width<=0||this._clipRect.height<=0)return true;return false}transformQuad(t,e,a,i,r,s,n){var o=0;if(r!=0){o=Math.tan(r*Math.PI/180)*i}var l=t+a;var _=e+i;var h=s.tx;var x=s.ty;var c=s.a;var d=s.b;var u=s.c;var f=s.d;var p=t+o;var m=e;var g=l+o;var v=e;var y=l;var T=_;var E=t;var b=_;if(s._bTransform){n[0]=p*c+m*u+h;n[1]=p*d+m*f+x;n[2]=g*c+v*u+h;n[3]=g*d+v*f+x;n[4]=y*c+T*u+h;n[5]=y*d+T*f+x;n[6]=E*c+b*u+h;n[7]=E*d+b*f+x}else{n[0]=p+h;n[1]=m+x;n[2]=g+h;n[3]=v+x;n[4]=y+h;n[5]=T+x;n[6]=E+h;n[7]=b+x}}pushRT(){this.addRenderObject(ct.create(null,rt.pushRT,this))}popRT(){this.addRenderObject(ct.create(null,rt.popRT,this));this.breakNextMerge()}useRT(t){function e(t){if(!t){throw"error useRT"}else{t.start();t.clear(0,0,0,0)}}this.addRenderObject(ct.create([t],e,this));this.breakNextMerge()}RTRestore(t){function e(t){t.restore()}this.addRenderObject(ct.create([t],e,this));this.breakNextMerge()}breakNextMerge(){this._curSubmit=C.RENDERBASE}_repaintSprite(){this.sprite&&this.sprite.repaint()}drawTextureWithTransform(t,e,a,i,r,s,n,o,l,_,h=null,x){var c;var d=this._curMat;if(_){c=this.globalCompositeOperation;this.globalCompositeOperation=_}var u=this._colorFiler;if(h){this.setColorFilter(h)}if(!s){this._drawTextureM(t,e+n,a+o,i,r,d,l,x);if(_){this.globalCompositeOperation=c}if(h){this.setColorFilter(u)}return}var f=this._tmpMatrix;f.a=s.a;f.b=s.b;f.c=s.c;f.d=s.d;f.tx=s.tx+n;f.ty=s.ty+o;f._bTransform=s._bTransform;if(s&&d._bTransform){L.mul(f,d,f);s=f;s._bTransform=true}else{f.tx+=d.tx;f.ty+=d.ty;s=f}this._drawTextureM(t,e,a,i,r,s,l,x);if(_){this.globalCompositeOperation=c}if(h){this.setColorFilter(u)}}_flushToTarget(t,e){_.worldScissorTest=false;var a=f.instance;a.disable(a.SCISSOR_TEST);var i=_.worldAlpha;var r=_.worldMatrix4;var s=_.worldMatrix;_.worldMatrix=L.EMPTY;_.restoreTempArray();_.worldMatrix4=_.TEMPMAT4_ARRAY;_.worldAlpha=1;it.activeShader=null;e.start();if(t._submits._length>0)e.clear(0,0,0,0);t._curSubmit=C.RENDERBASE;t.flush();t.clear();e.restore();t._curSubmit=C.RENDERBASE;it.activeShader=null;_.worldAlpha=i;_.worldMatrix4=r;_.worldMatrix=s}drawCanvas(t,e,a,i,r){if(!t)return;var s=t.context;var n;if(s._targets){if(s._submits._length>0){n=ct.create([s,s._targets],this._flushToTarget,this);this._submits[this._submits._length++]=n}this._drawRenderTexture(s._targets,e,a,i,r,null,1,rt.flipyuv);this._curSubmit=C.RENDERBASE}else{var o=t;if(o.touches){o.touches.forEach(function(t){t.touch()})}n=ae.create(t,this._shader2D.ALPHA,this._shader2D.filters);this._submits[this._submits._length++]=n;n._key.clear();var l=n._matrix;this._curMat.copyTo(l);var _=l.tx,h=l.ty;l.tx=l.ty=0;l.transformPoint(K.TEMP.setTo(e,a));l.translate(K.TEMP.x+_,K.TEMP.y+h);L.mul(o.invMat,l,l);this._curSubmit=C.RENDERBASE}}drawTarget(t,e,a,i,r,s,n,o=null,l=-1){this._drawCount++;if(this._mesh.vertNum+4>W._MAXVERTNUM){this._mesh=kt.getAMesh(this.isMain);this.meshlist.push(this._mesh)}this.transformQuad(e,a,i,r,0,s||this._curMat,this._transedPoints);if(!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,o||le.DEF_UV,4294967295,true);var _=this._curSubmit=ie.create(this,this._mesh,n,t);_.blendType=l==-1?this._nBlendType:l;this._copyClipInfo(_,this._globalClipMatrix);_._numEle=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4;this._submits[this._submits._length++]=_;this._curSubmit=C.RENDERBASE;return true}this._curSubmit=C.RENDERBASE;return false}drawTriangles(t,e,a,i,r,s,n,o,l,_,h=4294967295){if(!t._getSource()){if(this.sprite){O.systemTimer.callLater(this,this._repaintSprite)}return}var x=null;if(_){x=this.globalCompositeOperation;this.globalCompositeOperation=_}this._drawCount++;var c=this._tmpMatrix;var d=this._triangleMesh;var u=null;var f=false;if(l){u=this._colorFiler;this._colorFiler=l;this._curSubmit=C.RENDERBASE;f=u!=l}var p=t.bitmap;var m=this._curSubmit._key;var g=m.submitType===C.KEY_TRIANGLES&&m.other===p.id&&m.blendShader==this._nBlendType;if(d.vertNum+i.length/2>W._MAXVERTNUM){d=this._triangleMesh=Gt.getAMesh(this.isMain);this.meshlist.push(d);g=false}if(!g){var v=this._curSubmit=re.create(this,d,ht.create(D.TEXTURE2D,0));v.shaderValue.textureHost=t;v._renderType=C.TYPE_TEXTURE;v._key.submitType=C.KEY_TRIANGLES;v._key.other=p.id;this._copyClipInfo(v,this._globalClipMatrix);this._submits[this._submits._length++]=v}var y=this._mixRGBandAlpha(h,this._shader2D.ALPHA*o);if(!this._drawTriUseAbsMatrix){if(!n){c.a=1;c.b=0;c.c=0;c.d=1;c.tx=e;c.ty=a}else{c.a=n.a;c.b=n.b;c.c=n.c;c.d=n.d;c.tx=n.tx+e;c.ty=n.ty+a}L.mul(c,this._curMat,c);d.addData(i,r,s,c||this._curMat,y)}else{d.addData(i,r,s,n,y)}this._curSubmit._numEle+=s.length;if(f){this._colorFiler=u;this._curSubmit=C.RENDERBASE}if(_){this.globalCompositeOperation=x}}transform(t,e,a,i,r,s){Mt.save(this);L.mul(L.TEMP.setTo(t,e,a,i,r,s),this._curMat,this._curMat);this._curMat._checkTransform()}_transformByMatrix(t,e,a){t.setTranslate(e,a);L.mul(t,this._curMat,this._curMat);t.setTranslate(0,0);this._curMat._bTransform=true}setTransformByMatrix(t){t.copyTo(this._curMat)}rotate(t){Mt.save(this);this._curMat.rotateEx(t)}scale(t,e){Mt.save(this);this._curMat.scaleEx(t,e)}clipRect(t,e,a,i){Lt.save(this);if(this._clipRect==W.MAXCLIPRECT){this._clipRect=new R(t,e,a,i)}else{this._clipRect.width=a;this._clipRect.height=i;this._clipRect.x=t;this._clipRect.y=e}this._clipID_Gen++;this._clipID_Gen%=1e4;this._clipInfoID=this._clipID_Gen;var r=this._globalClipMatrix;var s=r.tx;var n=r.ty;var o=s+r.a;var l=n+r.d;if(this._clipRect.width>=W._MAXSIZE){r.a=r.d=W._MAXSIZE;r.b=r.c=r.tx=r.ty=0}else{if(this._curMat._bTransform){r.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx;r.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty;r.a=this._clipRect.width*this._curMat.a;r.b=this._clipRect.width*this._curMat.b;r.c=this._clipRect.height*this._curMat.c;r.d=this._clipRect.height*this._curMat.d}else{r.tx=this._clipRect.x+this._curMat.tx;r.ty=this._clipRect.y+this._curMat.ty;r.a=this._clipRect.width;r.b=r.c=0;r.d=this._clipRect.height}if(this._incache){this._clipInCache=true}}if(r.a>0&&r.d>0){var _=r.tx+r.a;var h=r.ty+r.d;if(_<=s||h<=n||r.tx>=o||r.ty>=l){r.a=-.1;r.d=-.1}else{if(r.tx<s){r.a-=s-r.tx;r.tx=s}if(_>o){r.a-=_-o}if(r.ty<n){r.d-=n-r.ty;r.ty=n}if(h>l){r.d-=h-l}if(r.a<=0)r.a=-.1;if(r.d<=0)r.d=-.1}}}drawMesh(t,e,a,i,r,s,n,o,l=0){}addRenderObject(t){this._submits[this._submits._length++]=t}submitElement(t,e){var a=this.isMain;var i=this._submits;var r=i._length;e<0&&(e=i._length);var s=C.RENDERBASE;while(t<e){this._renderNextSubmitIndex=t+1;if(i[t]===C.RENDERBASE){t++;continue}C.preRender=s;s=i[t];t+=s.renderSubmit()}return r}flush(){this._clipID_Gen=0;var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset();Qt.instance&&Qt.getInstance().reset();this._curSubmit=C.RENDERBASE;for(var e=0,a=this.meshlist.length;e<a;e++){var i=this.meshlist[e];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0;this._mesh=kt.getAMesh(this.isMain);this._pathMesh=Ht.getAMesh(this.isMain);this._triangleMesh=Gt.getAMesh(this.isMain);this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh);this._flushCnt++;if(this._flushCnt%60==0&&this.isMain){if(B.textRenderInst){B.textRenderInst.GC()}}return t}beginPath(t=false){var e=this._getPath();e.beginPath(t)}closePath(){this._path.closePath()}addPath(t,e,a,i,r){var s=0;for(var n=0,o=t.length/2;n<o;n++){var l=t[s]+i,_=t[s+1]+r;t[s]=l;t[s+1]=_;s+=2}this._getPath().push(t,a)}fill(){var t=this._curMat;var e=this._getPath();var a=this._curSubmit;var i=a._key.submitType===C.KEY_VG&&a._key.blendShader===this._nBlendType;i&&(i=i&&this.isSameClipInfo(a));if(!i){this._curSubmit=this.addVGSubmit(this._pathMesh)}var r=this.mixRGBandAlpha(this.fillStyle.toInt());var s=0;var n;for(var o=0,l=e.paths.length;o<l;o++){var _=e.paths[o];var h=_.path.length/2;if(h<3||h==3&&!_.convex)continue;var x=_.path.concat();var c=0;var d,u;var f,p;if(t._bTransform){for(c=0;c<h;c++){d=c<<1;u=d+1;f=x[d];p=x[u];x[d]=t.a*f+t.c*p+t.tx;x[u]=t.b*f+t.d*p+t.ty}}else{for(c=0;c<h;c++){d=c<<1;u=d+1;f=x[d];p=x[u];x[d]=f+t.tx;x[u]=p+t.ty}}if(this._pathMesh.vertNum+h>W._MAXVERTNUM){this._curSubmit._numEle+=s;s=0;this._pathMesh=Ht.getAMesh(this.isMain);this._curSubmit=this.addVGSubmit(this._pathMesh)}var m=this._pathMesh.vertNum;if(_.convex){var g=h-2;n=new Array(g*3);var v=0;for(var y=0;y<g;y++){n[v++]=m;n[v++]=y+1+m;n[v++]=y+2+m}}else{n=E.earcut(x,null,2);if(m>0){for(var T=0;T<n.length;T++){n[T]+=m}}}this._pathMesh.addVertAndIBToMesh(this,x,r,n);s+=n.length}this._curSubmit._numEle+=s}addVGSubmit(t){var e=ee.createShape(this,t,0,ht.create(D.PRIMITIVE,0));e._key.submitType=C.KEY_VG;this._submits[this._submits._length++]=e;this._copyClipInfo(e,this._globalClipMatrix);return e}stroke(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor);var e=this._getPath();var a=this._curSubmit;var i=a._key.submitType===C.KEY_VG&&a._key.blendShader===this._nBlendType;i&&(i=i&&this.isSameClipInfo(a));if(!i){this._curSubmit=this.addVGSubmit(this._pathMesh)}var r=0;for(var s=0,n=e.paths.length;s<n;s++){var o=e.paths[s];if(o.path.length<=0)continue;var l=[];var _=[];var h=o.path.length*2;if(h<2)continue;if(this._pathMesh.vertNum+h>W._MAXVERTNUM){this._curSubmit._numEle+=r;r=0;this._pathMesh=Ht.getAMesh(this.isMain);this.meshlist.push(this._pathMesh);this._curSubmit=this.addVGSubmit(this._pathMesh)}Jt.createLine2(o.path,l,this.lineWidth,this._pathMesh.vertNum,_,o.loop);var x=_.length/2;var c=this._curMat;var d=0;var u,f;var p,m;if(c._bTransform){for(d=0;d<x;d++){u=d<<1;f=u+1;p=_[u];m=_[f];_[u]=c.a*p+c.c*m+c.tx;_[f]=c.b*p+c.d*m+c.ty}}else{for(d=0;d<x;d++){u=d<<1;f=u+1;p=_[u];m=_[f];_[u]=p+c.tx;_[f]=m+c.ty}}this._pathMesh.addVertAndIBToMesh(this,_,t,l);r+=l.length}this._curSubmit._numEle+=r}}moveTo(t,e){var a=this._getPath();a.newPath();a._lastOriX=t;a._lastOriY=e;a.addPoint(t,e)}lineTo(t,e){var a=this._getPath();if(Math.abs(t-a._lastOriX)<.001&&Math.abs(e-a._lastOriY)<.001)return;a._lastOriX=t;a._lastOriY=e;a.addPoint(t,e)}arcTo(t,e,B,F,a){var i=0;var r=0,s=0;var n=this._path._lastOriX-t;var o=this._path._lastOriY-e;var l=Math.sqrt(n*n+o*o);if(l<=1e-6){return}var _=n/l;var h=o/l;var x=B-t;var c=F-e;var V=x*x+c*c;var d=Math.sqrt(V);if(d<=1e-6){return}var u=x/d;var f=c/d;var p=_+u;var m=h+f;var g=Math.sqrt(p*p+m*m);if(g<=1e-6){return}var v=p/g;var y=m/g;var U=Math.acos(v*_+y*h);var T=Math.PI/2-U;l=a/Math.tan(T);var E=l*_+t;var b=l*h+e;var S=Math.sqrt(l*l+a*a);var C=t+v*S;var k=e+y*S;var G=_*f-h*u;var R=0;var A=0;var L=0;if(G>=0){R=T*2;var I=R/W.SEGNUM;A=Math.sin(I);L=Math.cos(I)}else{R=-T*2;I=R/W.SEGNUM;A=Math.sin(I);L=Math.cos(I)}var M=this._path._lastOriX,D=this._path._lastOriY;var w=E,P=b;if(Math.abs(w-this._path._lastOriX)>.1||Math.abs(P-this._path._lastOriY)>.1){r=w;s=P;M=w;D=P;this._path._lastOriX=r;this._path._lastOriY=s;this._path.addPoint(r,s)}var O=E-C;var N=b-k;for(i=0;i<W.SEGNUM;i++){var H=O*L+N*A;var z=-O*A+N*L;r=H+C;s=z+k;if(Math.abs(M-r)>.1||Math.abs(D-s)>.1){this._path._lastOriX=r;this._path._lastOriY=s;this._path.addPoint(r,s);M=r;D=s}O=H;N=z}}arc(t,e,a,i,r,s=false,n=true){var o=0,l=0;var _=0,h=0,x=0,c=0;var d,u;l=r-i;if(!s){if(Math.abs(l)>=Math.PI*2){l=Math.PI*2}else{while(l<0){l+=Math.PI*2}}}else{if(Math.abs(l)>=Math.PI*2){l=-Math.PI*2}else{while(l>0){l-=Math.PI*2}}}var f=this.getMatScaleX();var p=this.getMatScaleY();var m=a*(f>p?f:p);var g=2*Math.PI*m;u=Math.max(g/10,10)|0;var v=this._getPath();for(d=0;d<=u;d++){o=i+l*(d/u);_=Math.cos(o);h=Math.sin(o);x=t+_*a;c=e+h*a;if(x!=this._path._lastOriX||c!=this._path._lastOriY){v.addPoint(x,c)}}_=Math.cos(r);h=Math.sin(r);x=t+_*a;c=e+h*a;if(x!=this._path._lastOriX||c!=this._path._lastOriY){v.addPoint(x,c)}}quadraticCurveTo(t,e,a,i){var r=bt.I;var s=r.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,a,i],30,2);for(var n=0,o=s.length/2;n<o;n++){this.lineTo(s[n*2],s[n*2+1])}this.lineTo(a,i)}mixRGBandAlpha(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)}_mixRGBandAlpha(t,e){if(e>=1){return t}var a=(t&4278190080)>>>24;if(a!=0){a*=e}else{a=e*255}return t&16777215|a<<24}strokeRect(t,e,a,i,r){if(this.lineWidth>0){var s=this.mixRGBandAlpha(this.strokeStyle._color.numColor);var n=this.lineWidth/2;this._fillRect(t-n,e-n,a+this.lineWidth,this.lineWidth,s);this._fillRect(t-n,e-n+i,a+this.lineWidth,this.lineWidth,s);this._fillRect(t-n,e+n,this.lineWidth,i-this.lineWidth,s);this._fillRect(t-n+a,e+n,this.lineWidth,i-this.lineWidth,s)}}clip(){}drawParticle(t,e,a){a.x=t;a.y=e;this._submits[this._submits._length++]=a}_getPath(){return this._path||(this._path=new Rt)}get canvas(){return this._canvas}_fillTexture_h(t,e,a,i,r,s,n,o){if(i<=0)console.error("_fillTexture_h error: oriw must>0");var l=s;var _=Math.floor(o/i);var h=o%i;for(var x=0;x<_;x++){this._inner_drawTexture(t,e,l,n,i,r,this._curMat,a,1,false);l+=i}if(h>0){var c=a[2]-a[0];var d=a[0]+c*(h/i);var u=W.tmpuv1;u[0]=a[0];u[1]=a[1];u[2]=d;u[3]=a[3];u[4]=d;u[5]=a[5];u[6]=a[6];u[7]=a[7];this._inner_drawTexture(t,e,l,n,h,r,this._curMat,u,1,false)}}_fillTexture_v(t,e,a,i,r,s,n,o){if(r<=0)console.error("_fillTexture_v error: orih must>0");var l=n;var _=Math.floor(o/r);var h=o%r;for(var x=0;x<_;x++){this._inner_drawTexture(t,e,s,l,i,r,this._curMat,a,1,false);l+=r}if(h>0){var c=a[7]-a[1];var d=a[1]+c*(h/r);var u=W.tmpuv1;u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=a[3];u[4]=a[4];u[5]=d;u[6]=a[6];u[7]=d;this._inner_drawTexture(t,e,s,l,i,h,this._curMat,u,1,false)}}drawTextureWithSizeGrid(t,e,a,i,r,s,n,o){if(!t._getSource())return;e+=n;a+=o;var l=t.uv,_=t.bitmap.width,h=t.bitmap.height;var x=s[0];var c=s[3];var d=s[1];var u=s[2];var f=s[4];var p=false;if(i==_){c=d=0}if(r==h){x=u=0}var m=x/h;var g=c/_;var v=d/_;var y=u/h;if(c+d>i){var T=i;p=true;i=c+d;this.save();this.clipRect(0+e,0+a,T,r)}var E=t.bitmap.id;var b=this._curMat;var S=this._tempUV;var C=l[0];var R=l[1];var A=l[4];var L=l[5];var I=C;var M=R;var D=A;var w=L;if(c&&x){D=C+g;w=R+m;S[0]=C,S[1]=R,S[2]=D,S[3]=R,S[4]=D,S[5]=w,S[6]=C,S[7]=w;this._inner_drawTexture(t,E,e,a,c,x,b,S,1,false)}if(d&&x){I=A-v;M=R;D=A;w=R+m;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;this._inner_drawTexture(t,E,i-d+e,0+a,d,x,b,S,1,false)}if(c&&u){I=C;M=L-y;D=C+g;w=L;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;this._inner_drawTexture(t,E,0+e,r-u+a,c,u,b,S,1,false)}if(d&&u){I=A-v;M=L-y;D=A;w=L;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;this._inner_drawTexture(t,E,i-d+e,r-u+a,d,u,b,S,1,false)}if(x){I=C+g;M=R;D=A-v;w=R+m;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;if(f){this._fillTexture_h(t,E,S,t.width-c-d,x,c+e,a,i-c-d)}else{this._inner_drawTexture(t,E,c+e,a,i-c-d,x,b,S,1,false)}}if(u){I=C+g;M=L-y;D=A-v;w=L;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;if(f){this._fillTexture_h(t,E,S,t.width-c-d,u,c+e,r-u+a,i-c-d)}else{this._inner_drawTexture(t,E,c+e,r-u+a,i-c-d,u,b,S,1,false)}}if(c){I=C;M=R+m;D=C+g;w=L-y;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;if(f){this._fillTexture_v(t,E,S,c,t.height-x-u,e,x+a,r-x-u)}else{this._inner_drawTexture(t,E,e,x+a,c,r-x-u,b,S,1,false)}}if(d){I=A-v;M=R+m;D=A;w=L-y;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;if(f){this._fillTexture_v(t,E,S,d,t.height-x-u,i-d+e,x+a,r-x-u)}else{this._inner_drawTexture(t,E,i-d+e,x+a,d,r-x-u,b,S,1,false)}}I=C+g;M=R+m;D=A-v;w=L-y;S[0]=I,S[1]=M,S[2]=D,S[3]=M,S[4]=D,S[5]=w,S[6]=I,S[7]=w;if(f){var P=W.tmpUVRect;P[0]=I;P[1]=M;P[2]=D-I;P[3]=w-M;this._fillTexture(t,t.width-c-d,t.height-x-u,P,c+e,x+a,i-c-d,r-x-u,"repeat",0,0)}else{this._inner_drawTexture(t,E,c+e,x+a,i-c-d,r-x-u,b,S,1,false)}if(p)this.restore()}}W.ENUM_TEXTALIGN_DEFAULT=0;W.ENUM_TEXTALIGN_CENTER=1;W.ENUM_TEXTALIGN_RIGHT=2;W._SUBMITVBSIZE=32e3;W._MAXSIZE=99999999;W._MAXVERTNUM=65535;W.MAXCLIPRECT=null;W._COUNT=0;W.SEGNUM=32;W._contextcount=0;W.PI2=2*Math.PI;W._textRender=null;W.tmpuv1=[0,0,0,0,0,0,0,0];W.tmpUV=[0,0,0,0,0,0,0,0];W.tmpUVRect=[0,0,0,0];class fe{constructor(){this.lineWidth=1}clear(){this.lineWidth=1;this.textAlign=this.textBaseline=null}make(){return this===fe.DEFAULT?new fe:this}}class pe{static _uint8ArraySlice(){var t=this;var e=t.length;var a=new Uint8Array(t.length);for(var i=0;i<e;i++)a[i]=t[i];return a}static _float32ArraySlice(){var t=this;var e=t.length;var a=new Float32Array(t.length);for(var i=0;i<e;i++)a[i]=t[i];return a}static _uint16ArraySlice(...t){var e=this;var a;var i;var r;if(t.length===0){a=e.length;i=new Uint16Array(a);for(r=0;r<a;r++)i[r]=e[r]}else if(t.length===2){var s=t[0];var n=t[1];if(n>s){a=n-s;i=new Uint16Array(a);for(r=s;r<n;r++)i[r-s]=e[r]}else{i=new Uint16Array(0)}}return i}static _nativeRender_enable(){}static enable(){return true}static inner_enable(){Float32Array.prototype.slice||(Float32Array.prototype.slice=pe._float32ArraySlice);Uint16Array.prototype.slice||(Uint16Array.prototype.slice=pe._uint16ArraySlice);Uint8Array.prototype.slice||(Uint8Array.prototype.slice=pe._uint8ArraySlice);return true}static onStageResize(t,e){if(p.mainContext==null)return;p.mainContext.viewport(0,0,t,e);_.width=t;_.height=e}}pe._isWebGL2=false;pe.isNativeRender_enable=false;class me{constructor(){}}(function(){var r={};function a(t){if(window.console&&window.console.error){window.console.error(t)}}function e(t){if(window.console&&window.console.log){window.console.log(t)}}function c(t,e){r[t]=true;if(e!==undefined){a(e)}}function i(a){var i=a.getError;a.getError=function(){var t;do{t=i.apply(a);if(t!=a.NO_ERROR){r[t]=true}}while(t!=a.NO_ERROR);for(var e in r){if(r[e]){delete r[e];return parseInt(e)}}return a.NO_ERROR}}var s=function t(e){var a=e.gl;this.ext=e;this.isAlive=true;this.hasBeenBound=false;this.elementArrayBuffer=null;this.attribs=new Array(e.maxVertexAttribs);for(var i=0;i<this.attribs.length;i++){var r=new t.VertexAttrib(a);this.attribs[i]=r}this.maxAttrib=0};s.VertexAttrib=function t(e){this.enabled=false;this.buffer=null;this.size=4;this.type=e.FLOAT;this.normalized=false;this.stride=16;this.offset=0;this.cached="";this.recache()};s.VertexAttrib.prototype.recache=function t(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var n=function t(s){var _=this;this.gl=s;i(s);var h=this.original={getParameter:s.getParameter,enableVertexAttribArray:s.enableVertexAttribArray,disableVertexAttribArray:s.disableVertexAttribArray,bindBuffer:s.bindBuffer,getVertexAttrib:s.getVertexAttrib,vertexAttribPointer:s.vertexAttribPointer};s.getParameter=function t(e){if(e==_.VERTEX_ARRAY_BINDING_OES){if(_.currentVertexArrayObject==_.defaultVertexArrayObject){return null}else{return _.currentVertexArrayObject}}return h.getParameter.apply(this,arguments)};s.enableVertexAttribArray=function t(e){var a=_.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,e);var i=a.attribs[e];i.enabled=true;return h.enableVertexAttribArray.apply(this,arguments)};s.disableVertexAttribArray=function t(e){var a=_.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,e);var i=a.attribs[e];i.enabled=false;return h.disableVertexAttribArray.apply(this,arguments)};s.bindBuffer=function t(e,a){switch(e){case s.ARRAY_BUFFER:_.currentArrayBuffer=a;break;case s.ELEMENT_ARRAY_BUFFER:_.currentVertexArrayObject.elementArrayBuffer=a;break}return h.bindBuffer.apply(this,arguments)};s.getVertexAttrib=function t(e,a){var i=_.currentVertexArrayObject;var r=i.attribs[e];switch(a){case s.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return r.buffer;case s.VERTEX_ATTRIB_ARRAY_ENABLED:return r.enabled;case s.VERTEX_ATTRIB_ARRAY_SIZE:return r.size;case s.VERTEX_ATTRIB_ARRAY_STRIDE:return r.stride;case s.VERTEX_ATTRIB_ARRAY_TYPE:return r.type;case s.VERTEX_ATTRIB_ARRAY_NORMALIZED:return r.normalized;default:return h.getVertexAttrib.apply(this,arguments)}};s.vertexAttribPointer=function t(e,a,i,r,s,n){var o=_.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,e);var l=o.attribs[e];l.buffer=_.currentArrayBuffer;l.size=a;l.type=i;l.normalized=r;l.stride=s;l.offset=n;l.recache();return h.vertexAttribPointer.apply(this,arguments)};if(s.instrumentExtension){s.instrumentExtension(this,"OES_vertex_array_object")}s.canvas.addEventListener("webglcontextrestored",function(){e("OESVertexArrayObject emulation library context restored");_.reset_()},true);this.reset_()};n.prototype.VERTEX_ARRAY_BINDING_OES=34229;n.prototype.reset_=function t(){var e=this.vertexArrayObjects!==undefined;if(e){for(var a=0;a<this.vertexArrayObjects.length;++a){this.vertexArrayObjects.isAlive=false}}var i=this.gl;this.maxVertexAttribs=i.getParameter(i.MAX_VERTEX_ATTRIBS);this.defaultVertexArrayObject=new s(this);this.currentVertexArrayObject=null;this.currentArrayBuffer=null;this.vertexArrayObjects=[this.defaultVertexArrayObject];this.bindVertexArrayOES(null)};n.prototype.createVertexArrayOES=function t(){var e=new s(this);this.vertexArrayObjects.push(e);return e};n.prototype.deleteVertexArrayOES=function t(e){e.isAlive=false;this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1);if(this.currentVertexArrayObject==e){this.bindVertexArrayOES(null)}};n.prototype.isVertexArrayOES=function t(e){if(e&&e instanceof s){if(e.hasBeenBound&&e.ext==this){return true}}return false};n.prototype.bindVertexArrayOES=function t(e){var a=this.gl;if(e&&!e.isAlive){c(a.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}var i=this.original;var r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject;this.currentVertexArrayObject.hasBeenBound=true;var s=this.currentVertexArrayObject;if(r==s){return}if(!r||s.elementArrayBuffer!=r.elementArrayBuffer){i.bindBuffer.call(a,a.ELEMENT_ARRAY_BUFFER,s.elementArrayBuffer)}var n=this.currentArrayBuffer;var o=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(var l=0;l<=o;l++){var _=s.attribs[l];var h=r?r.attribs[l]:null;if(!r||_.enabled!=h.enabled){if(_.enabled){i.enableVertexAttribArray.call(a,l)}else{i.disableVertexAttribArray.call(a,l)}}if(_.enabled){var x=false;if(!r||_.buffer!=h.buffer){if(n!=_.buffer){i.bindBuffer.call(a,a.ARRAY_BUFFER,_.buffer);n=_.buffer}x=true}if(x||_.cached!=h.cached){i.vertexAttribPointer.call(a,l,_.size,_.type,_.normalized,_.stride,_.offset)}}}if(this.currentArrayBuffer!=n){i.bindBuffer.call(a,a.ARRAY_BUFFER,this.currentArrayBuffer)}};window._setupVertexArrayObject=function(t){var a=t.getSupportedExtensions;t.getSupportedExtensions=function t(){var e=a.call(this)||[];if(e.indexOf("OES_vertex_array_object")<0){e.push("OES_vertex_array_object")}return e};var i=t.getExtension;t.getExtension=function t(e){var a=i.call(this,e);if(a){return a}if(e!=="OES_vertex_array_object"){return null}if(!this.__OESVertexArrayObject){console.log("Setup OES_vertex_array_object polyfill");this.__OESVertexArrayObject=new n(this)}return this.__OESVertexArrayObject}}})();class ge{constructor(t,e){this._gl=null;this._vaoExt=null;this._angleInstancedArrays=null;this._isWebGL2=false;this._oesTextureHalfFloat=null;this._oes_element_index_uint=null;this._oesTextureHalfFloatLinear=null;this._oesTextureFloat=null;this._extShaderTextureLod=null;this._extTextureFilterAnisotropic=null;this._compressedTextureS3tc=null;this._compressedTexturePvrtc=null;this._compressedTextureEtc1=null;this._webgl_depth_texture=null;this._extColorBufferFloat=null;this._gl=t;this._isWebGL2=e;var a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);var i=t.getParameter(t.MAX_TEXTURE_SIZE);if(!e){if(!O.Render.isConchApp){if(window._setupVertexArrayObject)window._setupVertexArrayObject(t)}this._vaoExt=this._getExtension("OES_vertex_array_object");this._angleInstancedArrays=this._getExtension("ANGLE_instanced_arrays");this._oesTextureHalfFloat=this._getExtension("OES_texture_half_float");this._oesTextureHalfFloatLinear=this._getExtension("OES_texture_half_float_linear");this._oesTextureFloat=this._getExtension("OES_texture_float");this._oes_element_index_uint=this._getExtension("OES_element_index_uint");this._extShaderTextureLod=this._getExtension("EXT_shader_texture_lod");this._webgl_depth_texture=this._getExtension("WEBGL_depth_texture");et._shaderCapailityLevel=30}else{this._extColorBufferFloat=this._getExtension("EXT_color_buffer_float");et._shaderCapailityLevel=35}this._extTextureFilterAnisotropic=this._getExtension("EXT_texture_filter_anisotropic");this._compressedTextureS3tc=this._getExtension("WEBGL_compressed_texture_s3tc");this._compressedTexturePvrtc=this._getExtension("WEBGL_compressed_texture_pvrtc");this._compressedTextureEtc1=this._getExtension("WEBGL_compressed_texture_etc1");et._maxTextureCount=a;et._maxTextureSize=i}_getExtension(t){var e=ge._extentionVendorPrefixes;for(var a in e){var i=this._gl.getExtension(e[a]+t);if(i)return i}return null}createVertexArray(){if(this._isWebGL2)return this._gl.createVertexArray();else return this._vaoExt.createVertexArrayOES()}bindVertexArray(t){if(this._isWebGL2)this._gl.bindVertexArray(t);else this._vaoExt.bindVertexArrayOES(t)}deleteVertexArray(t){if(this._isWebGL2)this._gl.deleteVertexArray(t);else this._vaoExt.deleteVertexArrayOES(t)}isVertexArray(t){if(this._isWebGL2)this._gl.isVertexArray(t);else this._vaoExt.isVertexArrayOES(t)}drawElementsInstanced(t,e,a,i,r){if(this._isWebGL2)this._gl.drawElementsInstanced(t,e,a,i,r);else this._angleInstancedArrays.drawElementsInstancedANGLE(t,e,a,i,r)}drawArraysInstanced(t,e,a,i){if(this._isWebGL2)this._gl.drawArraysInstanced(t,e,a,i);else this._angleInstancedArrays.drawArraysInstancedANGLE(t,e,a,i)}vertexAttribDivisor(t,e){if(this._isWebGL2)this._gl.vertexAttribDivisor(t,e);else this._angleInstancedArrays.vertexAttribDivisorANGLE(t,e)}supportInstance(){if((this._isWebGL2||this._angleInstancedArrays)&&n.allowGPUInstanceDynamicBatch)return true;else return false}supportElementIndexUint32(){return this._isWebGL2||this._oes_element_index_uint?true:false}}ge._extentionVendorPrefixes=["","WEBKIT_","MOZ_"];class m{constructor(t,e,a){this._timeId=0;m._mainCanvas=a;let i=m._mainCanvas.source;i.id="layaCanvas";i.width=t;i.height=e;if(m.isConchApp){document.body.appendChild(i)}this.initRender(m._mainCanvas,t,e);window.requestAnimationFrame(r);function r(t){O.stage._loop();window.requestAnimationFrame(r)}O.stage.on("visibilitychange",this,this._onVisibilitychange)}_onVisibilitychange(){if(!O.stage.isVisibility){this._timeId=window.setInterval(this._enterFrame,1e3)}else if(this._timeId!=0){window.clearInterval(this._timeId)}}initRender(t,e,a){function i(t){var e;var a=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];if(!n.useWebGL2||N.onBDMiniGame){a.shift()}for(var i=0;i<a.length;i++){try{e=t.getContext(a[i],{stencil:n.isStencil,alpha:n.isAlpha,antialias:n.isAntialias,premultipliedAlpha:n.premultipliedAlpha,preserveDrawingBuffer:n.preserveDrawingBuffer})}catch(t){}if(e){a[i]==="webgl2"&&(pe._isWebGL2=true);return e}}return null}var r=f.instance=p.mainContext=i(m._mainCanvas.source);if(!r)return false;f.instance=r;f.layaGPUInstance=new ge(r,pe._isWebGL2);t.size(e,a);W.__init__();C.__init__();var s=new W;s.isMain=true;m._context=s;t._setContext(s);D.__init__();ht.__init__();Kt.__init__();Bt.__int__(r);M._init_(r);return true}_enterFrame(t=null){O.stage._loop()}static get context(){return m._context}static get canvas(){return m._mainCanvas.source}}m.supportWebGLPlusAnimation=false;m.supportWebGLPlusRendering=false;m.isConchApp=false;{m.isConchApp=window.conch!=null;if(m.isConchApp){m.supportWebGLPlusRendering=false}else if(window.qq!=null&&window.qq.webglPlus!=null){m.supportWebGLPlusRendering=false}}class ve{static create(t,e,a,i,r,s,n,o,l,_,h){var x=u.getItemByClass("DrawTrianglesCmd",ve);x.texture=t;x.x=e;x.y=a;x.vertices=i;x.uvs=r;x.indices=s;x.matrix=n;x.alpha=o;if(l){x.color=new ft;var c=ut.create(l).arrColor;x.color.color(c[0]*255,c[1]*255,c[2]*255,c[3]*255)}x.blendMode=_;x.colorNum=h;return x}recover(){this.texture=null;this.vertices=null;this.uvs=null;this.indices=null;this.matrix=null;u.recover("DrawTrianglesCmd",this)}run(t,e,a){t.drawTriangles(this.texture,this.x+e,this.y+a,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode,this.colorNum)}get cmdID(){return ve.ID}}ve.ID="DrawTriangles";class ye{constructor(){}static create(t,e,a,i,r,s){var n=u.getItemByClass("Draw9GridTexture",ye);n.texture=t;t._addReference();n.x=e;n.y=a;n.width=i;n.height=r;n.sizeGrid=s;return n}recover(){this.texture._removeReference();u.recover("Draw9GridTexture",this)}run(t,e,a){t.drawTextureWithSizeGrid(this.texture,this.x,this.y,this.width,this.height,this.sizeGrid,e,a)}get cmdID(){return ye.ID}}ye.ID="Draw9GridTexture";class Te{static create(){var t=u.getItemByClass("SaveCmd",Te);return t}recover(){u.recover("SaveCmd",this)}run(t,e,a){t.save()}get cmdID(){return Te.ID}}Te.ID="Save";class v{constructor(){this._cacheBoundsType=false}destroy(){this._graphics=null;this._cacheBoundsType=false;if(this._temp)this._temp.length=0;if(this._rstBoundPoints)this._rstBoundPoints.length=0;if(this._bounds)this._bounds.recover();this._bounds=null;u.recover("GraphicsBounds",this)}static create(){return u.getItemByClass("GraphicsBounds",v)}reset(){this._temp&&(this._temp.length=0)}getBounds(t=false){if(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType){this._bounds=R._getWrapRec(this.getBoundPoints(t),this._bounds)}this._cacheBoundsType=t;return this._bounds}getBoundPoints(t=false){if(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)this._temp=this._getCmdPoints(t);this._cacheBoundsType=t;return this._rstBoundPoints=w.copyArray(this._rstBoundPoints,this._temp)}_getCmdPoints(t=false){var e=this._graphics.cmds;var a;a=this._temp||(this._temp=[]);a.length=0;if(!e&&this._graphics._one!=null){v._tempCmds.length=0;v._tempCmds.push(this._graphics._one);e=v._tempCmds}if(!e)return a;var i=v._tempMatrixArrays;i.length=0;var r=v._initMatrix;r.identity();var s=v._tempMatrix;var n;var o;for(var l=0,_=e.length;l<_;l++){n=e[l];switch(n.cmdID){case U.ID:case Te.ID:i.push(r);r=r.clone();break;case gt.ID:r=i.pop();break;case yt.ID:s.identity();s.translate(-n.pivotX,-n.pivotY);s.scale(n.scaleX,n.scaleY);s.translate(n.pivotX,n.pivotY);this._switchMatrix(r,s);break;case vt.ID:s.identity();s.translate(-n.pivotX,-n.pivotY);s.rotate(n.angle);s.translate(n.pivotX,n.pivotY);this._switchMatrix(r,s);break;case Et.ID:s.identity();s.translate(n.tx,n.ty);this._switchMatrix(r,s);break;case Tt.ID:s.identity();s.translate(-n.pivotX,-n.pivotY);s.concat(n.matrix);s.translate(n.pivotX,n.pivotY);this._switchMatrix(r,s);break;case H.ID:case mt.ID:v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,n.width,n.height),r);break;case pt.ID:r.copyTo(s);if(n.matrix)s.concat(n.matrix);v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,n.width,n.height),s);break;case H.ID:o=n.texture;if(t){if(n.width&&n.height){v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,n.width,n.height),r)}else{v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,o.width,o.height),r)}}else{var h=(n.width||o.sourceWidth)/o.width;var x=(n.height||o.sourceHeight)/o.height;var c=h*o.sourceWidth;var d=x*o.sourceHeight;var u=o.offsetX>0?o.offsetX:0;var f=o.offsetY>0?o.offsetY:0;u*=h;f*=x;v._addPointArrToRst(a,R._getBoundPointS(n.x-u,n.y-f,c,d),r)}break;case mt.ID:if(n.width&&n.height){v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,n.width,n.height),r)}else{o=n.texture;v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,o.width,o.height),r)}break;case pt.ID:var p;if(n.matrix){r.copyTo(s);s.concat(n.matrix);p=s}else{p=r}if(t){if(n.width&&n.height){v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,n.width,n.height),p)}else{o=n.texture;v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,o.width,o.height),p)}}else{o=n.texture;h=(n.width||o.sourceWidth)/o.width;x=(n.height||o.sourceHeight)/o.height;c=h*o.sourceWidth;d=x*o.sourceHeight;u=o.offsetX>0?o.offsetX:0;f=o.offsetY>0?o.offsetY:0;u*=h;f*=x;v._addPointArrToRst(a,R._getBoundPointS(n.x-u,n.y-f,c,d),p)}break;case Z.ID:v._addPointArrToRst(a,R._getBoundPointS(n.x,n.y,n.width,n.height),r);break;case k.ID:v._addPointArrToRst(a,R._getBoundPointS(n.x-n.radius,n.y-n.radius,n.radius+n.radius,n.radius+n.radius),r);break;case z.ID:v._tempPoints.length=0;var m;m=n.lineWidth*.5;if(n.fromX==n.toX){v._tempPoints.push(n.fromX+m,n.fromY,n.toX+m,n.toY,n.fromX-m,n.fromY,n.toX-m,n.toY)}else if(n.fromY==n.toY){v._tempPoints.push(n.fromX,n.fromY+m,n.toX,n.toY+m,n.fromX,n.fromY-m,n.toX,n.toY-m)}else{v._tempPoints.push(n.fromX,n.fromY,n.toX,n.toY)}v._addPointArrToRst(a,v._tempPoints,r);break;case G.ID:v._addPointArrToRst(a,bt.I.getBezierPoints(n.points),r,n.x,n.y);break;case X.ID:case q.ID:v._addPointArrToRst(a,n.points,r,n.x,n.y);break;case Y.ID:v._addPointArrToRst(a,this._getPathPoints(n.paths),r,n.x,n.y);break;case j.ID:v._addPointArrToRst(a,this._getPiePoints(n.x,n.y,n.radius,n.startAngle,n.endAngle),r);break;case ve.ID:v._addPointArrToRst(a,this._getTriAngBBXPoints(n.vertices),r);break;case ye.ID:v._addPointArrToRst(a,this._getDraw9GridBBXPoints(n),r);break}}if(a.length>200){a=w.copyArray(a,R._getWrapRec(a)._getBoundPoints())}else if(a.length>8)a=St.scanPList(a);return a}_switchMatrix(t,e){e.concat(t);e.copyTo(t)}static _addPointArrToRst(t,e,a,i=0,r=0){var s,n;n=e.length;for(s=0;s<n;s+=2){v._addPointToRst(t,e[s]+i,e[s+1]+r,a)}}static _addPointToRst(t,e,a,i){var r=K.TEMP;r.setTo(e?e:0,a?a:0);i.transformPoint(r);t.push(r.x,r.y)}_getPiePoints(t,e,a,i,r){var s=v._tempPoints;v._tempPoints.length=0;var n=Math.PI/180;var o=r-i;if(o>=360||o<=-360){s.push(t-a,e-a);s.push(t+a,e-a);s.push(t+a,e+a);s.push(t-a,e+a);return s}s.push(t,e);var l=o%360;if(l<0)l+=360;var _=i+l;var h=i*n;var x=_*n;s.push(t+a*Math.cos(h),e+a*Math.sin(h));s.push(t+a*Math.cos(x),e+a*Math.sin(x));var c=Math.ceil(i/90)*90;var d=Math.floor(_/90)*90;for(var u=c;u<=d;u+=90){var f=u*n;s.push(t+a*Math.cos(f),e+a*Math.sin(f))}return s}_getTriAngBBXPoints(t){var e=t.length;if(e<2)return[];var a=t[0];var i=t[1];var r=a;var s=i;for(var n=2;n<e;){var o=t[n++];var l=t[n++];if(a>o)a=o;if(i>l)i=l;if(r<o)r=o;if(s<l)s=l}return[a,i,r,i,r,s,a,s]}_getDraw9GridBBXPoints(t){var e=0;var a=0;var i=t.width;var r=t.height;return[e,a,i,a,i,r,e,r]}_getPathPoints(t){var e,a;var i=v._tempPoints;i.length=0;a=t.length;var r;for(e=0;e<a;e++){r=t[e];if(r.length>1){i.push(r[1],r[2]);if(r.length>3){i.push(r[3],r[4])}}}return i}}v._tempMatrix=new L;v._initMatrix=new L;v._tempPoints=[];v._tempMatrixArrays=[];v._tempCmds=[];class T{}T.ALPHA=1;T.TRANSFORM=2;T.BLEND=4;T.CANVAS=8;T.FILTERS=16;T.MASK=32;T.CLIP=64;T.STYLE=128;T.TEXTURE=256;T.GRAPHICS=512;T.LAYAGL3D=1024;T.CUSTOM=2048;T.ONECHILD=4096;T.CHILDS=8192;T.REPAINT_NONE=0;T.REPAINT_NODE=1;T.REPAINT_CACHE=2;T.REPAINT_ALL=3;class Ee{static create(t,e,a,i){var r=u.getItemByClass("ClipRectCmd",Ee);r.x=t;r.y=e;r.width=a;r.height=i;return r}recover(){u.recover("ClipRectCmd",this)}run(t,e,a){t.clipRect(this.x+e,this.y+a,this.width,this.height)}get cmdID(){return Ee.ID}}Ee.ID="ClipRect";class be{static create(t,e){var a=u.getItemByClass("DrawTexturesCmd",be);a.texture=t;t._addReference();a.pos=e;return a}recover(){this.texture._removeReference();this.texture=null;this.pos=null;u.recover("DrawTexturesCmd",this)}run(t,e,a){t.drawTextures(this.texture,this.pos,e,a)}get cmdID(){return be.ID}}be.ID="DrawTextures";class Se{constructor(){this._textIsWorldText=false;this._fontColor=4294967295;this._strokeColor=0;this._fontObj=Se._defFontObj;this._nTexAlign=0}static create(t,e,a,i,r,s,n,o,l){var _=u.getItemByClass("FillTextCmd",Se);_.text=t;_._textIsWorldText=t instanceof he;_._words=e;_.x=a;_.y=i;_.font=r;_.color=s;_.textAlign=n;_._lineWidth=o;_._borderColor=l;return _}recover(){u.recover("FillTextCmd",this)}run(t,e,a){if(O.stage.isGlobalRepaint()){this._textIsWorldText&&this._text.cleanCache()}if(this._words){W._textRender.fillWords(t,this._words,this.x+e,this.y+a,this._fontObj,this._color,this._borderColor,this._lineWidth)}else{if(this._textIsWorldText){t._fast_filltext(this._text,this.x+e,this.y+a,this._fontObj,this._color,this._borderColor,this._lineWidth,this._nTexAlign,0)}else{W._textRender.filltext(t,this._text,this.x+e,this.y+a,this.font,this.color,this._borderColor,this._lineWidth,this._textAlign)}}}get cmdID(){return Se.ID}get text(){return this._text}set text(t){this._text=t;this._textIsWorldText=t instanceof he;this._textIsWorldText&&this._text.cleanCache()}get font(){return this._font}set font(t){this._font=t;this._fontObj=_e.Parse(t);this._textIsWorldText&&this._text.cleanCache()}get color(){return this._color}set color(t){this._color=t;this._fontColor=ut.create(t).numColor;this._textIsWorldText&&this._text.cleanCache()}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t;switch(t){case"center":this._nTexAlign=O.Context.ENUM_TEXTALIGN_CENTER;break;case"right":this._nTexAlign=O.Context.ENUM_TEXTALIGN_RIGHT;break;default:this._nTexAlign=O.Context.ENUM_TEXTALIGN_DEFAULT}this._textIsWorldText&&this._text.cleanCache()}}Se.ID="FillText";Se._defFontObj=new _e(null);class Ce{constructor(){}static regCacheByFunction(t,e){Ce.unRegCacheByFunction(t,e);var a;a={tryDispose:t,getCacheList:e};Ce._cacheList.push(a)}static unRegCacheByFunction(t,e){var a,i;i=Ce._cacheList.length;for(a=0;a<i;a++){if(Ce._cacheList[a].tryDispose==t&&Ce._cacheList[a].getCacheList==e){Ce._cacheList.splice(a,1);return}}}static forceDispose(){var t,e=Ce._cacheList.length;for(t=0;t<e;t++){Ce._cacheList[t].tryDispose(true)}}static beginCheck(t=15e3){O.systemTimer.loop(t,null,Ce._checkLoop)}static stopCheck(){O.systemTimer.clear(null,Ce._checkLoop)}static _checkLoop(){var t=Ce._cacheList;if(t.length<1)return;var e=O.Browser.now();var a;var i;i=a=t.length;while(a>0){Ce._index++;Ce._index=Ce._index%i;t[Ce._index].tryDispose(false);if(O.Browser.now()-e>Ce.loopTimeLimit)break;a--}}}Ce.loopTimeLimit=2;Ce._cacheList=[];Ce._index=0;class Re{constructor(){this.useDic={};this.shapeDic={};this.shapeLineDic={};this._id=0;this._checkKey=false;this._freeIdArray=[];Ce.regCacheByFunction(this.startDispose.bind(this),this.getCacheList.bind(this))}static getInstance(){return Re.instance=Re.instance||new Re}getId(){return this._id++}addShape(t,e){this.shapeDic[t]=e;if(!this.useDic[t]){this.useDic[t]=true}}addLine(t,e){this.shapeLineDic[t]=e;if(!this.shapeLineDic[t]){this.shapeLineDic[t]=true}}getShape(t){if(this._checkKey){if(this.useDic[t]!=null){this.useDic[t]=true}}}deleteShape(t){if(this.shapeDic[t]){this.shapeDic[t]=null;delete this.shapeDic[t]}if(this.shapeLineDic[t]){this.shapeLineDic[t]=null;delete this.shapeLineDic[t]}if(this.useDic[t]!=null){delete this.useDic[t]}}getCacheList(){var t;var e=[];for(t in this.shapeDic){e.push(this.shapeDic[t])}for(t in this.shapeLineDic){e.push(this.shapeLineDic[t])}return e}startDispose(t){var e;for(e in this.useDic){this.useDic[e]=false}this._checkKey=true}endDispose(){if(this._checkKey){var t;for(t in this.useDic){if(!this.useDic[t]){this.deleteShape(t)}}this._checkKey=false}}}class Ae{constructor(){this._sp=null;this._one=null;this._render=this._renderEmpty;this._cmds=null;this._vectorgraphArray=null;this._graphicBounds=null;this.autoDestroy=false;this._createData()}_createData(){}_clearData(){}_destroyData(){}destroy(){this.clear(true);if(this._graphicBounds)this._graphicBounds.destroy();this._graphicBounds=null;this._vectorgraphArray=null;if(this._sp){this._sp._renderType=0;this._sp._setRenderType(0);this._sp=null}this._destroyData()}clear(t=true){if(t){var e=this._one;if(this._cmds){var a,i=this._cmds.length;for(a=0;a<i;a++){e=this._cmds[a];e.recover()}this._cmds.length=0}else if(e){e.recover()}}else{this._cmds=null}this._one=null;this._render=this._renderEmpty;this._clearData();if(this._sp){this._sp._renderType&=~T.GRAPHICS;this._sp._setRenderType(this._sp._renderType)}this._repaint();if(this._vectorgraphArray){for(a=0,i=this._vectorgraphArray.length;a<i;a++){Re.getInstance().deleteShape(this._vectorgraphArray[a])}this._vectorgraphArray.length=0}}_clearBoundsCache(){if(this._graphicBounds)this._graphicBounds.reset()}_initGraphicBounds(){if(!this._graphicBounds){this._graphicBounds=v.create();this._graphicBounds._graphics=this}}_repaint(){this._clearBoundsCache();this._sp&&this._sp.repaint()}_isOnlyOne(){return!this._cmds||this._cmds.length===0}get cmds(){return this._cmds}set cmds(t){if(this._sp){this._sp._renderType|=T.GRAPHICS;this._sp._setRenderType(this._sp._renderType)}this._cmds=t;this._render=this._renderAll;this._repaint()}getBounds(t=false){this._initGraphicBounds();return this._graphicBounds.getBounds(t)}getBoundPoints(t=false){this._initGraphicBounds();return this._graphicBounds.getBoundPoints(t)}drawImage(t,e=0,a=0,i=0,r=0){if(!t)return null;if(!i)i=t.sourceWidth;if(!r)r=t.sourceHeight;if(t.getIsReady()){var s=i/t.sourceWidth;var n=r/t.sourceHeight;i=t.width*s;r=t.height*n;if(i<=0||r<=0)return null;e+=t.offsetX*s;a+=t.offsetY*n}if(this._sp){this._sp._renderType|=T.GRAPHICS;this._sp._setRenderType(this._sp._renderType)}var o=H.create.call(this,t,e,a,i,r);if(this._one==null){this._one=o;this._render=this._renderOneImg}else{this._saveToCmd(null,o)}this._repaint();return o}drawTexture(t,e=0,a=0,i=0,r=0,s=null,n=1,o=null,l=null,_){if(!t||n<.01)return null;if(!t.getIsReady())return null;if(!i)i=t.sourceWidth;if(!r)r=t.sourceHeight;if(t.getIsReady()){var h=i/t.sourceWidth;var x=r/t.sourceHeight;i=t.width*h;r=t.height*x;if(i<=0||r<=0)return null;e+=t.offsetX*h;a+=t.offsetY*x}if(this._sp){this._sp._renderType|=T.GRAPHICS;this._sp._setRenderType(this._sp._renderType)}var c=pt.create.call(this,t,e,a,i,r,s,n,o,l,_);this._repaint();return this._saveToCmd(null,c)}drawTextures(t,e){if(!t)return null;return this._saveToCmd(m._context.drawTextures,be.create.call(this,t,e))}drawTriangles(t,e,a,i,r,s,n=null,o=1,l=null,_=null,h=undefined){return this._saveToCmd(m._context.drawTriangles,ve.create.call(this,t,e,a,i,r,s,n,o,l,_,h))}fillTexture(t,e,a,i=0,r=0,s="repeat",n=null){if(t&&t.getIsReady())return this._saveToCmd(m._context._fillTexture,mt.create.call(this,t,e,a,i,r,s,n||K.EMPTY,{}));else return null}_saveToCmd(t,e){if(this._sp){this._sp._renderType|=T.GRAPHICS;this._sp._setRenderType(this._sp._renderType)}if(this._one==null){this._one=e;this._render=this._renderOne}else{this._render=this._renderAll;(this._cmds||(this._cmds=[])).length===0&&this._cmds.push(this._one);this._cmds.push(e)}this._repaint();return e}clipRect(t,e,a,i){return this._saveToCmd(m._context.clipRect,Ee.create.call(this,t,e,a,i))}fillText(t,e,a,i,r,s){return this._saveToCmd(m._context.fillText,Se.create.call(this,t,null,e,a,i||O.Text.defaultFontStr(),r,s,0,""))}fillBorderText(t,e,a,i,r,s,n,o){return this._saveToCmd(m._context.fillText,Se.create.call(this,t,null,e,a,i||O.Text.defaultFontStr(),r,s,n,o))}fillWords(t,e,a,i,r){return this._saveToCmd(m._context.fillText,Se.create.call(this,null,t,e,a,i||O.Text.defaultFontStr(),r))}fillBorderWords(t,e,a,i,r,s,n){return this._saveToCmd(m._context.fillText,Se.create.call(this,null,t,e,a,i||O.Text.defaultFontStr(),r,"",n,s))}strokeText(t,e,a,i,r,s,n){return this._saveToCmd(m._context.fillText,Se.create.call(this,t,null,e,a,i||O.Text.defaultFontStr(),null,n,s,r))}alpha(t){return this._saveToCmd(m._context.alpha,U.create.call(this,t))}transform(t,e=0,a=0){return this._saveToCmd(m._context._transform,Tt.create.call(this,t,e,a))}rotate(t,e=0,a=0){return this._saveToCmd(m._context._rotate,vt.create.call(this,t,e,a))}scale(t,e,a=0,i=0){return this._saveToCmd(m._context._scale,yt.create.call(this,t,e,a,i))}translate(t,e){return this._saveToCmd(m._context.translate,Et.create.call(this,t,e))}save(){return this._saveToCmd(m._context._save,Te.create.call(this))}restore(){return this._saveToCmd(m._context.restore,gt.create.call(this))}replaceText(t){this._repaint();var e=this._cmds;if(!e){if(this._one&&this._isTextCmd(this._one)){this._one.text=t;return true}}else{for(var a=e.length-1;a>-1;a--){if(this._isTextCmd(e[a])){e[a].text=t;return true}}}return false}_isTextCmd(t){var e=t.cmdID;return e==Se.ID}replaceTextColor(t){this._repaint();var e=this._cmds;if(!e){if(this._one&&this._isTextCmd(this._one)){this._setTextCmdColor(this._one,t)}}else{for(var a=e.length-1;a>-1;a--){if(this._isTextCmd(e[a])){this._setTextCmdColor(e[a],t)}}}}_setTextCmdColor(t,e){var a=t.cmdID;switch(a){case Se.ID:t.color=e;break}}loadImage(t,e=0,a=0,i=0,r=0,s=null){var n=O.Loader.getRes(t);if(!n){n=new le;n.load(t);O.Loader.cacheTexture(t,n);n.once(P.READY,this,this.drawImage,[n,e,a,i,r])}else{if(!n.getIsReady()){n.once(P.READY,this,this.drawImage,[n,e,a,i,r])}else this.drawImage(n,e,a,i,r)}if(s!=null){n.getIsReady()?s.call(this._sp):n.on(P.READY,this._sp,s)}}_renderEmpty(t,e,a,i){}_renderAll(t,e,a,i){var r=this._cmds;for(var s=0,n=r.length;s<n;s++){r[s].run(e,a,i)}}_renderOne(t,e,a,i){e.sprite=t;this._one.run(e,a,i)}_renderOneImg(t,e,a,i){e.sprite=t;this._one.run(e,a,i)}drawLine(t,e,a,i,r,s=1){var n=s<1||s%2===0?0:.5;return this._saveToCmd(m._context._drawLine,z.create.call(this,t+n,e+n,a+n,i+n,r,s,0))}drawLines(t,e,a,i,r=1){if(!a||a.length<4)return null;var s=r<1||r%2===0?0:.5;return this._saveToCmd(m._context._drawLines,X.create.call(this,t+s,e+s,a,i,r,0))}drawCurves(t,e,a,i,r=1){return this._saveToCmd(m._context.drawCurves,G.create.call(this,t,e,a,i,r))}drawRect(t,e,a,i,r,s=null,n=1){var o=n>=1&&s?n/2:0;var l=s?n:0;return this._saveToCmd(m._context.drawRect,Z.create.call(this,t+o,e+o,a-l,i-l,r,s,n))}drawCircle(t,e,a,i,r=null,s=1){var n=s>=1&&r?s/2:0;return this._saveToCmd(m._context._drawCircle,k.create.call(this,t,e,a-n,i,r,s,0))}drawPie(t,e,a,i,r,s,n=null,o=1){var l=o>=1&&n?o/2:0;var _=n?o:0;return this._saveToCmd(m._context._drawPie,j.create.call(this,t+l,e+l,a-_,w.toRadian(i),w.toRadian(r),s,n,o,0))}drawPoly(t,e,a,i,r=null,s=1){var n=false;if(a.length>6){n=false}else{n=true}var o=s>=1&&r?s%2===0?0:.5:0;return this._saveToCmd(m._context._drawPoly,q.create.call(this,t+o,e+o,a,i,r,s,n,0))}drawPath(t,e,a,i=null,r=null){return this._saveToCmd(m._context._drawPath,Y.create.call(this,t,e,a,i,r))}draw9Grid(t,e=0,a=0,i=0,r=0,s=null){this._saveToCmd(null,ye.create(t,e,a,i,r,s))}}class b{}b.NOT_ACTIVE=1;b.ACTIVE_INHIERARCHY=2;b.AWAKED=4;b.NOT_READY=8;b.DISPLAY=16;b.HAS_ZORDER=32;b.HAS_MOUSE=64;b.DISPLAYED_INSTAGE=128;b.DRAWCALL_OPTIMIZE=256;class Le{static __init__(){Le.map[T.ALPHA|T.TRANSFORM|T.GRAPHICS]=Le.alpha_transform_drawLayaGL;Le.map[T.ALPHA|T.GRAPHICS]=Le.alpha_drawLayaGL;Le.map[T.TRANSFORM|T.GRAPHICS]=Le.transform_drawLayaGL;Le.map[T.TRANSFORM|T.CHILDS]=Le.transform_drawNodes;Le.map[T.ALPHA|T.TRANSFORM|T.TEXTURE]=Le.alpha_transform_drawTexture;Le.map[T.ALPHA|T.TEXTURE]=Le.alpha_drawTexture;Le.map[T.TRANSFORM|T.TEXTURE]=Le.transform_drawTexture;Le.map[T.GRAPHICS|T.CHILDS]=Le.drawLayaGL_drawNodes}static transform_drawTexture(t,e,a,i){var r=t._style;var s=t.texture;e.saveTransform(Le.curMat);e.transformByMatrix(t.transform,a,i);var n=t._width||s.sourceWidth;var o=t._height||s.sourceHeight;var l=n/s.sourceWidth;var _=o/s.sourceHeight;n=s.width*l;o=s.height*_;if(n<=0||o<=0)return null;var h=-t.pivotX+s.offsetX*l;var x=-t.pivotY+s.offsetY*_;e.drawTexture(s,h,x,n,o);e.restoreTransform(Le.curMat)}static alpha_drawTexture(t,e,a,i){var r=t._style;var s;var n=t.texture;if((s=r.alpha)>.01||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=s;e.drawTexture(n,a-r.pivotX+n.offsetX,i-r.pivotY+n.offsetY,t._width||n.width,t._height||n.height);e.globalAlpha=o}}static alpha_transform_drawTexture(t,e,a,i){var r=t._style;var s;var n=t.texture;if((s=r.alpha)>.01||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=s;e.saveTransform(Le.curMat);e.transformByMatrix(t.transform,a,i);e.drawTexture(n,-r.pivotX+n.offsetX,-r.pivotY+n.offsetY,t._width||n.width,t._height||n.height);e.restoreTransform(Le.curMat);e.globalAlpha=o}}static alpha_transform_drawLayaGL(t,e,a,i){var r=t._style;var s;if((s=r.alpha)>.01||t._needRepaint()){var n=e.globalAlpha;e.globalAlpha*=s;e.saveTransform(Le.curMat);e.transformByMatrix(t.transform,a,i);t._graphics&&t._graphics._render(t,e,-r.pivotX,-r.pivotY);e.restoreTransform(Le.curMat);e.globalAlpha=n}}static alpha_drawLayaGL(t,e,a,i){var r=t._style;var s;if((s=r.alpha)>.01||t._needRepaint()){var n=e.globalAlpha;e.globalAlpha*=s;t._graphics&&t._graphics._render(t,e,a-r.pivotX,i-r.pivotY);e.globalAlpha=n}}static transform_drawLayaGL(t,e,a,i){var r=t._style;e.saveTransform(Le.curMat);e.transformByMatrix(t.transform,a,i);t._graphics&&t._graphics._render(t,e,-r.pivotX,-r.pivotY);e.restoreTransform(Le.curMat)}static transform_drawNodes(t,e,a,i){var r=t._getBit(b.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(true);var s=t._style;e.saveTransform(Le.curMat);e.transformByMatrix(t.transform,a,i);a=-s.pivotX;i=-s.pivotY;var n=t._children,o=n.length,l;if(s.viewport){var _=s.viewport;var h=_.x;var x=_.y;var c=_.right;var d=_.bottom;var u,f;for(p=0;p<o;++p){if((l=n[p])._visible&&((u=l._x)<c&&u+l.width>h&&(f=l._y)<d&&f+l.height>x)){l.render(e,a,i)}}}else{for(var p=0;p<o;++p)(l=n[p])._visible&&l.render(e,a,i)}e.restoreTransform(Le.curMat);r&&e.drawCallOptimize(false)}static drawLayaGL_drawNodes(t,e,a,i){var r=t._getBit(b.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(true);var s=t._style;a=a-s.pivotX;i=i-s.pivotY;t._graphics&&t._graphics._render(t,e,a,i);var n=t._children,o=n.length,l;if(s.viewport){var _=s.viewport;var h=_.x;var x=_.y;var c=_.right;var d=_.bottom;var u,f;for(p=0;p<o;++p){if((l=n[p])._visible&&((u=l._x)<c&&u+l.width>h&&(f=l._y)<d&&f+l.height>x)){l.render(e,a,i)}}}else{for(var p=0;p<o;++p)(l=n[p])._visible&&l.render(e,a,i)}r&&e.drawCallOptimize(false)}}Le.map=[];Le.curMat=new L;class Ie{constructor(t,e){if(Le.map[t]){this._fun=Le.map[t];this._next=Ie.NORENDER;return}this._next=e||Ie.NORENDER;switch(t){case 0:this._fun=this._no;return;case T.ALPHA:this._fun=this._alpha;return;case T.TRANSFORM:this._fun=this._transform;return;case T.BLEND:this._fun=this._blend;return;case T.CANVAS:this._fun=this._canvas;return;case T.MASK:this._fun=this._mask;return;case T.CLIP:this._fun=this._clip;return;case T.STYLE:this._fun=this._style;return;case T.GRAPHICS:this._fun=this._graphics;return;case T.CHILDS:this._fun=this._children;return;case T.CUSTOM:this._fun=this._custom;return;case T.TEXTURE:this._fun=this._texture;return;case T.FILTERS:this._fun=dt._filter;return;case Ie.INIT:this._fun=Ie._initRenderFun;return}this.onCreate(t)}static __init__(){Le.__init__();var t,e;var a;a=new Ie(Ie.INIT,null);e=Ie.renders.length=T.CHILDS*2;for(t=0;t<e;t++)Ie.renders[t]=a;Ie.renders[0]=new Ie(0,null)}static _initRenderFun(t,e,a,i){var r=t._renderType;var s=Ie.renders[r]=Ie._getTypeRender(r);s._fun(t,e,a,i)}static _getTypeRender(t){if(Le.map[t])return new Ie(t,null);var e=null;var a=T.CHILDS;while(a>0){if(a&t)e=new Ie(a,e);a=a>>1}return e}onCreate(t){}_style(t,e,a,i){var r=t._style;if(r.render!=null)r.render(t,e,a,i);var s=this._next;s._fun.call(s,t,e,a,i)}_no(t,e,a,i){}_custom(t,e,a,i){t.customRender(e,a,i);this._next._fun.call(this._next,t,e,0,0)}_clip(t,e,a,i){var r=this._next;if(r==Ie.NORENDER)return;var s=t._style.scrollRect;var n=s.width;var o=s.height;if(n===0||o===0){return}e.save();e.clipRect(a,i,n,o);r._fun.call(r,t,e,a-s.x,i-s.y);e.restore()}_texture(t,e,a,i){var r=t.texture;if(r._getSource()){var s=t._width||r.sourceWidth;var n=t._height||r.sourceHeight;var o=s/r.sourceWidth;var l=n/r.sourceHeight;s=r.width*o;n=r.height*l;if(s<=0||n<=0)return;var _=a-t.pivotX+r.offsetX*o;var h=i-t.pivotY+r.offsetY*l;e.drawTexture(r,_,h,s,n)}var x=this._next;if(x!=Ie.NORENDER)x._fun.call(x,t,e,a,i)}_graphics(t,e,a,i){var r=t._style;var s=t._graphics;s&&s._render(t,e,a-r.pivotX,i-r.pivotY);var n=this._next;if(n!=Ie.NORENDER)n._fun.call(n,t,e,a,i)}_image(t,e,a,i){var r=t._style;e.drawTexture2(a,i,r.pivotX,r.pivotY,t.transform,t._graphics._one)}_image2(t,e,a,i){var r=t._style;e.drawTexture2(a,i,r.pivotX,r.pivotY,t.transform,t._graphics._one)}_alpha(t,e,a,i){var r=t._style;var s;if((s=r.alpha)>.01||t._needRepaint()){var n=e.globalAlpha;e.globalAlpha*=s;var o=this._next;o._fun.call(o,t,e,a,i);e.globalAlpha=n}}_transform(t,e,a,i){var r=t.transform,s=this._next;var n=t._style;if(r&&s!=Ie.NORENDER){e.save();e.transform(r.a,r.b,r.c,r.d,r.tx+a,r.ty+i);s._fun.call(s,t,e,0,0);e.restore()}else{if(s!=Ie.NORENDER)s._fun.call(s,t,e,a,i)}}_children(t,e,a,i){var r=t._style;var s=t._children,n=s.length,o;a=a-t.pivotX;i=i-t.pivotY;var l=t._getBit(b.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(true);if(r.viewport){var _=r.viewport;var h=_.x;var x=_.y;var c=_.right;var d=_.bottom;var u,f;for(p=0;p<n;++p){if((o=s[p])._visible&&((u=o._x)<c&&u+o.width>h&&(f=o._y)<d&&f+o.height>x)){o.render(e,a,i)}}}else{for(var p=0;p<n;++p)(o=s[p])._visible&&o.render(e,a,i)}l&&e.drawCallOptimize(false)}_canvas(t,e,a,i){var r=t._cacheStyle;var s=this._next;if(!r.enableCanvasRender){s._fun.call(s,t,e,a,i);return}r.cacheAs==="bitmap"?g.canvasBitmap++:g.canvasNormal++;var n=false;var o=false;if(r.canvas){var l=r.canvas;var _=l.context;var h=l.touches;if(h){for(var x=0;x<h.length;x++){if(h[x].deleted){o=true;break}}}n=l.isCacheValid&&!l.isCacheValid()}if(t._needRepaint()||!r.canvas||o||n||O.stage.isGlobalRepaint()){if(r.cacheAs==="normal"){if(e._targets){s._fun.call(s,t,e,a,i);return}else{this._canvas_webgl_normal_repaint(t,e)}}else{this._canvas_repaint(t,e,a,i)}}var c=r.cacheRect;e.drawCanvas(r.canvas,a+c.x,i+c.y,c.width,c.height)}_canvas_repaint(t,e,a,i){var r=t._cacheStyle;var s=this._next;var n;var o=r.canvas;var l;var _;var h;var x=r.cacheAs;var c,d;var u,f;var p;p=r._calculateCacheRect(t,x,a,i);u=p.x;f=p.y;h=r.cacheRect;c=h.width*u;d=h.height*f;l=h.x;_=h.y;if(x==="bitmap"&&(c>2048||d>2048)){console.warn("cache bitmap size larger than 2048,cache ignored");r.releaseContext();s._fun.call(s,t,e,a,i);return}if(!o){r.createContext();o=r.canvas}n=o.context;n.sprite=t;(o.width!=c||o.height!=d)&&o.size(c,d);if(x==="bitmap")n.asBitmap=true;else if(x==="normal")n.asBitmap=false;n.clear();if(u!=1||f!=1){var m=n;m.save();m.scale(u,f);s._fun.call(s,t,n,-l,-_);m.restore();t._applyFilters()}else{m=n;s._fun.call(s,t,n,-l,-_);t._applyFilters()}if(r.staticCache)r.reCache=false;g.canvasReCache++}_canvas_webgl_normal_repaint(t,e){var a=t._cacheStyle;var i=this._next;var r=a.canvas;var s=a.cacheAs;a._calculateCacheRect(t,s,0,0);if(!r){r=new zt(e,t);a.canvas=r}var n=r.context;r.startRec();i._fun.call(i,t,n,t.pivotX,t.pivotY);t._applyFilters();g.canvasReCache++;r.endRec()}_blend(t,e,a,i){var r=t._style;var s=this._next;if(r.blendMode){e.save();e.globalCompositeOperation=r.blendMode;s._fun.call(s,t,e,a,i);e.restore()}else{s._fun.call(s,t,e,a,i)}}_mask(e,t,a,i){var r=this._next;var s=e.mask;var n=t;if(s){n.save();var o=n.globalCompositeOperation;var l=new R;l.copyFrom(s.getBounds());l.width=Math.round(l.width);l.height=Math.round(l.height);l.x=Math.round(l.x);l.y=Math.round(l.y);if(l.width>0&&l.height>0){var _=l.width;var h=l.height;var x=st.getRT(_,h);n.breakNextMerge();n.pushRT();n.addRenderObject(ct.create([n,x,_,h],Ie.tmpTarget,this));s.render(n,-l.x,-l.y);n.breakNextMerge();n.popRT();n.save();let t=.1;n.clipRect(a+l.x-e.getStyle().pivotX+t,i+l.y-e.getStyle().pivotY+t,_-t*2,h-t*2);r._fun.call(r,e,n,a,i);n.restore();o=n.globalCompositeOperation;n.addRenderObject(ct.create(["mask"],Ie.setBlendMode,this));var c=ht.create(D.TEXTURE2D,0);var d=le.INV_UV;n.drawTarget(x,a+l.x-e.getStyle().pivotX,i+l.y-e.getStyle().pivotY,_,h,L.TEMP.identity(),c,d,6);n.addRenderObject(ct.create([x],Ie.recycleTarget,this));n.addRenderObject(ct.create([o],Ie.setBlendMode,this))}n.restore()}else{r._fun.call(r,e,t,a,i)}}static tmpTarget(t,e,a,i){e.start();e.clear(0,0,0,0)}static recycleTarget(t){st.releaseRT(t)}static setBlendMode(t){var e=p.mainContext;M.targetFns[M.TOINT[t]](e)}}Ie.INIT=69905;Ie.renders=[];Ie.NORENDER=new Ie(0,null);Ie.tempUV=new Array(8);class Me extends a{constructor(t=false){super();if(t)this._source=N.createElement("canvas");else{this._source=this}this.lock=true}get source(){return this._source}_getSource(){return this._source}clear(){if(this._ctx){if(this._ctx.clear){this._ctx.clear()}else{this._ctx.clearRect(0,0,this._width,this._height)}}if(this._texture){this._texture.destroy();this._texture=null}}destroy(){super.destroy();this._setCPUMemory(0);this._ctx&&this._ctx.destroy&&this._ctx.destroy();this._ctx=null}release(){}get context(){if(this._ctx)return this._ctx;if(this._source==this){this._ctx=new O.Context}else{this._ctx=this._source.getContext(O.Render.isConchApp?"layagl":"2d")}this._ctx._canvas=this;return this._ctx}_setContext(t){this._ctx=t}getContext(t,e=null){return this.context}getMemSize(){return 0}size(t,e){if(this._width!=t||this._height!=e||this._source&&(this._source.width!=t||this._source.height!=e)){this._width=t;this._height=e;this._setCPUMemory(t*e*4);this._ctx&&this._ctx.size&&this._ctx.size(t,e);if(this._source){this._source.height=e;this._source.width=t}if(this._texture){this._texture.destroy();this._texture=null}}}getTexture(){if(!this._texture){var t=new at;t.loadImageSource(this.source);this._texture=new le(t)}return this._texture}toBase64(t,e){if(this._source){if(O.Render.isConchApp){var a=window;if(a.conchConfig.threadMode==2){throw"native 2 thread mode use toBase64Async"}var i=this._ctx._targets.sourceWidth;var r=this._ctx._targets.sourceHeight;var s=this._ctx._targets.getData(0,0,i,r);return a.conchToBase64FlipY?a.conchToBase64FlipY(t,e,s.buffer,i,r):a.conchToBase64(t,e,s.buffer,i,r)}else{return this._source.toDataURL(t,e)}}return null}toBase64Async(i,r,s){var n=this._ctx._targets.sourceWidth;var o=this._ctx._targets.sourceHeight;this._ctx._targets.getDataAsync(0,0,n,o,function(t){let e=window;var a=e.conchToBase64FlipY?e.conchToBase64FlipY(i,r,t.buffer,n,o):e.conchToBase64(i,r,t.buffer,n,o);s(a)})}}class De{contains(t,e){if(!De._isHitGraphic(t,e,this.hit))return false;return!De._isHitGraphic(t,e,this.unHit)}static _isHitGraphic(t,e,a){if(!a)return false;var i=a.cmds;if(!i&&a._one){i=De._cmds;i.length=1;i[0]=a._one}if(!i)return false;var r,s;s=i.length;var n;for(r=0;r<s;r++){n=i[r];if(!n)continue;switch(n.cmdID){case"Translate":t-=n.tx;e-=n.ty}if(De._isHitCmd(t,e,n))return true}return false}static _isHitCmd(t,e,a){if(!a)return false;var i=false;switch(a.cmdID){case"DrawRect":De._rect.setTo(a.x,a.y,a.width,a.height);i=De._rect.contains(t,e);break;case"DrawCircle":var r;t-=a.x;e-=a.y;r=t*t+e*e;i=r<a.radius*a.radius;break;case"DrawPoly":t-=a.x;e-=a.y;i=De._ptInPolygon(t,e,a.points);break}return i}static _ptInPolygon(t,e,a){var i=De._ptPoint;i.setTo(t,e);var r=0;var s,n,o,l;var _;_=a.length;for(var h=0;h<_;h+=2){s=a[h];n=a[h+1];o=a[(h+2)%_];l=a[(h+3)%_];if(n==l)continue;if(i.y<Math.min(n,l))continue;if(i.y>=Math.max(n,l))continue;var x=(i.y-n)*(o-s)/(l-n)+s;if(x>i.x)r++}return r%2==1}get hit(){if(!this._hit)this._hit=new O.Graphics;return this._hit}set hit(t){this._hit=t}get unHit(){if(!this._unHit)this._unHit=new O.Graphics;return this._unHit}set unHit(t){this._unHit=t}}De._cmds=[];De._rect=new R;De._ptPoint=new K;class d{static regClass(t,e){d._classMap[t]=e}static regShortClassName(t){for(var e=0;e<t.length;e++){var a=t[e];var i=a.name;d._classMap[i]=a}}static getRegClass(t){return d._classMap[t]}static getClass(t){var e=d._classMap[t]||d._classMap["Laya."+t]||t;var a=O.Laya;if(typeof e=="string")return O.__classMap[e]||a[t];return e}static getInstance(t){var e=d.getClass(t);if(e)return new e;else console.warn("[error] Undefined class:",t);return null}static createByJson(t,e=null,a=null,i=null,r=null){if(typeof t=="string")t=JSON.parse(t);var s=t.props;if(!e){e=r?r.runWith(t):d.getInstance(s.runtime||t.type);if(!e)return null}var n=t.child;if(n){for(var o=0,l=n.length;o<l;o++){var _=n[o];if((_.props.name==="render"||_.props.renderType==="render")&&e["_$set_itemRender"])e.itemRender=_;else{if(_.type=="Graphic"){d._addGraphicsToSprite(_,e)}else if(d._isDrawType(_.type)){d._addGraphicToSprite(_,e,true)}else{var h=d.createByJson(_,null,a,i,r);if(_.type==="Script"){if("owner"in h){h["owner"]=e}else if("target"in h){h["target"]=e}}else if(_.props.renderType=="mask"){e.mask=h}else{e.addChild(h)}}}}}if(s){for(var x in s){var c=s[x];if(x==="var"&&a){a[c]=e}else if(c instanceof Array&&e[x]instanceof Function){e[x].apply(e,c)}else{e[x]=c}}}if(i&&t.customProps){i.runWith([e,t])}if(e["created"])e.created();return e}static _addGraphicsToSprite(t,e){var a=t.child;if(!a||a.length<1)return;var i=d._getGraphicsFromSprite(t,e);var r=0;var s=0;if(t.props){r=d._getObjVar(t.props,"x",0);s=d._getObjVar(t.props,"y",0)}if(r!=0&&s!=0){i.translate(r,s)}var n,o;o=a.length;for(n=0;n<o;n++){d._addGraphicToGraphics(a[n],i)}if(r!=0&&s!=0){i.translate(-r,-s)}}static _addGraphicToSprite(t,e,a=false){var i=a?d._getGraphicsFromSprite(t,e):e.graphics;d._addGraphicToGraphics(t,i)}static _getGraphicsFromSprite(t,e){if(!t||!t.props)return e.graphics;var a=t.props.renderType;if(a==="hit"||a==="unHit"){var i=e._style.hitArea||(e.hitArea=new De);if(!i[a]){i[a]=new Ae}var r=i[a]}if(!r)r=e.graphics;return r}static _getTransformData(t){var e;if("pivotX"in t||"pivotY"in t){e=e||new L;e.translate(-d._getObjVar(t,"pivotX",0),-d._getObjVar(t,"pivotY",0))}var a=d._getObjVar(t,"scaleX",1),i=d._getObjVar(t,"scaleY",1);var r=d._getObjVar(t,"rotation",0);var s=d._getObjVar(t,"skewX",0);var n=d._getObjVar(t,"skewY",0);if(a!=1||i!=1||r!=0){e=e||new L;e.scale(a,i);e.rotate(r*.0174532922222222)}return e}static _addGraphicToGraphics(t,e){var a;a=t.props;if(!a)return;var i;i=d.DrawTypeDic[t.type];if(!i)return;var r=e;var s=d._getParams(a,i[1],i[2],i[3]);var n=d._tM;if(n||d._alpha!=1){r.save();if(n)r.transform(n);if(d._alpha!=1)r.alpha(d._alpha)}r[i[0]].apply(r,s);if(n||d._alpha!=1){r.restore()}}static _adptLineData(t){t[2]=parseFloat(t[0])+parseFloat(t[2]);t[3]=parseFloat(t[1])+parseFloat(t[3]);return t}static _adptTextureData(t){t[0]=O.Loader.getRes(t[0]);return t}static _adptLinesData(t){t[2]=d._getPointListByStr(t[2]);return t}static _isDrawType(t){if(t==="Image")return false;return t in d.DrawTypeDic}static _getParams(t,e,a=0,i=null){var r=d._temParam;r.length=e.length;var s,n;n=e.length;for(s=0;s<n;s++){r[s]=d._getObjVar(t,e[s][0],e[s][1])}d._alpha=d._getObjVar(t,"alpha",1);var o;o=d._getTransformData(t);if(o){if(!a)a=0;o.translate(r[a],r[a+1]);r[a]=r[a+1]=0;d._tM=o}else{d._tM=null}if(i&&d[i]){r=d[i](r)}return r}static _getPointListByStr(t){var e=t.split(",");var a,i;i=e.length;for(a=0;a<i;a++){e[a]=parseFloat(e[a])}return e}static _getObjVar(t,e,a){if(e in t){return t[e]}return a}}d.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]};d._temParam=[];d._classMap={};class we{reset(){if(this.bounds)this.bounds.recover();if(this.userBounds)this.userBounds.recover();this.bounds=null;this.userBounds=null;this.temBM=null;return this}recover(){u.recover("BoundsStyle",this.reset())}static create(){return u.getItemByClass("BoundsStyle",we)}}class Pe{constructor(){this.reset()}needBitmapCache(){return this.cacheForFilters||!!this.mask}needEnableCanvasRender(){return this.userSetCache!="none"||this.cacheForFilters||!!this.mask}releaseContext(){if(this.canvas&&this.canvas.size){u.recover("CacheCanvas",this.canvas);this.canvas.size(0,0);try{this.canvas.width=0;this.canvas.height=0}catch(t){}}this.canvas=null}createContext(){if(!this.canvas){this.canvas=u.getItem("CacheCanvas")||new Me(false);var t=this.canvas.context;if(!t){t=this.canvas.getContext("2d")}}}releaseFilterCache(){var t=this.filterCache;if(t){t.destroy();t.recycle();this.filterCache=null}}recover(){if(this===Pe.EMPTY)return;u.recover("SpriteCache",this.reset())}reset(){this.releaseContext();this.releaseFilterCache();this.cacheAs="none";this.enableCanvasRender=false;this.userSetCache="none";this.cacheForFilters=false;this.staticCache=false;this.reCache=true;this.mask=null;this.maskParent=null;this.filterCache=null;this.filters=null;this.hasGlowFilter=false;if(this.cacheRect)this.cacheRect.recover();this.cacheRect=null;return this}static create(){return u.getItemByClass("SpriteCache",Pe)}_calculateCacheRect(t,e,a,i){var r=t._cacheStyle;if(!r.cacheRect)r.cacheRect=R.create();var s;if(e==="bitmap"){s=t.getSelfBounds();s.width=s.width+Pe.CANVAS_EXTEND_EDGE*2;s.height=s.height+Pe.CANVAS_EXTEND_EDGE*2;s.x=s.x-t.pivotX;s.y=s.y-t.pivotY;s.x=s.x-Pe.CANVAS_EXTEND_EDGE;s.y=s.y-Pe.CANVAS_EXTEND_EDGE;s.x=Math.floor(s.x+a)-a;s.y=Math.floor(s.y+i)-i;s.width=Math.floor(s.width);s.height=Math.floor(s.height);r.cacheRect.copyFrom(s)}else{r.cacheRect.setTo(-t._style.pivotX,-t._style.pivotY,1,1)}s=r.cacheRect;if(t._style.scrollRect){var n=t._style.scrollRect;s.x-=n.x;s.y-=n.y}Pe._scaleInfo.setTo(1,1);return Pe._scaleInfo}}Pe.EMPTY=new Pe;Pe._scaleInfo=new K;Pe.CANVAS_EXTEND_EDGE=16;class Oe{constructor(){this.reset()}reset(){this.scaleX=this.scaleY=1;this.skewX=this.skewY=0;this.pivotX=this.pivotY=this.rotation=0;this.alpha=1;if(this.scrollRect)this.scrollRect.recover();this.scrollRect=null;if(this.viewport)this.viewport.recover();this.viewport=null;this.hitArea=null;this.dragging=null;this.blendMode=null;return this}recover(){if(this===Oe.EMPTY)return;u.recover("SpriteStyle",this.reset())}static create(){return u.getItemByClass("SpriteStyle",Oe)}}Oe.EMPTY=new Oe;class Ne extends e{constructor(){super();this._bits=0;this._children=Ne.ARRAY_EMPTY;this._extUIChild=Ne.ARRAY_EMPTY;this._parent=null;this.name="";this.destroyed=false;this.createGLBuffer()}createGLBuffer(){}_setBit(t,e){if(t===b.DISPLAY){var a=this._getBit(t);if(a!=e)this._updateDisplayedInstage()}if(e)this._bits|=t;else this._bits&=~t}_getBit(t){return(this._bits&t)!=0}_setUpNoticeChain(){if(this._getBit(b.DISPLAY))this._setBitUp(b.DISPLAY)}_setBitUp(t){var e=this;e._setBit(t,true);e=e._parent;while(e){if(e._getBit(t))return;e._setBit(t,true);e=e._parent}}on(t,e,a,i=null){if(t===P.DISPLAY||t===P.UNDISPLAY){if(!this._getBit(b.DISPLAY))this._setBitUp(b.DISPLAY)}return this._createListener(t,e,a,i,false)}once(t,e,a,i=null){if(t===P.DISPLAY||t===P.UNDISPLAY){if(!this._getBit(b.DISPLAY))this._setBitUp(b.DISPLAY)}return this._createListener(t,e,a,i,true)}destroy(t=true){this.destroyed=true;this._destroyAllComponent();this._parent&&this._parent.removeChild(this);if(this._children){if(t)this.destroyChildren();else this.removeChildren()}this.onDestroy();this._children=null;this.offAll()}onDestroy(){}destroyChildren(){if(this._children){for(var t=0,e=this._children.length;t<e;t++){this._children[0].destroy(true)}}}addChild(t){if(!t||this.destroyed||t===this)return t;if(t._zOrder)this._setBit(b.HAS_ZORDER,true);if(t._parent===this){var e=this.getChildIndex(t);if(e!==this._children.length-1){this._children.splice(e,1);this._children.push(t);this._childChanged()}}else{t._parent&&t._parent.removeChild(t);this._children===Ne.ARRAY_EMPTY&&(this._children=[]);this._children.push(t);t._setParent(this);this._childChanged()}return t}addInputChild(t){if(this._extUIChild==Ne.ARRAY_EMPTY){this._extUIChild=[t]}else{if(this._extUIChild.indexOf(t)>=0){return null}this._extUIChild.push(t)}return null}removeInputChild(t){var e=this._extUIChild.indexOf(t);if(e>=0){this._extUIChild.splice(e,1)}}addChildren(...t){var e=0,a=t.length;while(e<a){this.addChild(t[e++])}}addChildAt(t,e){if(!t||this.destroyed||t===this)return t;if(t._zOrder)this._setBit(b.HAS_ZORDER,true);if(e>=0&&e<=this._children.length){if(t._parent===this){var a=this.getChildIndex(t);this._children.splice(a,1);this._children.splice(e,0,t);this._childChanged()}else{t._parent&&t._parent.removeChild(t);this._children===Ne.ARRAY_EMPTY&&(this._children=[]);this._children.splice(e,0,t);t._setParent(this)}return t}else{throw new Error("appendChildAt:The index is out of bounds")}}getChildIndex(t){return this._children.indexOf(t)}getChildByName(t){var e=this._children;if(e){for(var a=0,i=e.length;a<i;a++){var r=e[a];if(r.name===t)return r}}return null}getChildAt(t){return this._children[t]||null}setChildIndex(t,e){var a=this._children;if(e<0||e>=a.length){throw new Error("setChildIndex:The index is out of bounds.")}var i=this.getChildIndex(t);if(i<0)throw new Error("setChildIndex:node is must child of this object.");a.splice(i,1);a.splice(e,0,t);this._childChanged();return t}_childChanged(t=null){}removeChild(t){if(!this._children)return t;var e=this._children.indexOf(t);return this.removeChildAt(e)}removeSelf(){this._parent&&this._parent.removeChild(this);return this}removeChildByName(t){var e=this.getChildByName(t);e&&this.removeChild(e);return e}removeChildAt(t){var e=this.getChildAt(t);if(e){this._children.splice(t,1);e._setParent(null)}return e}removeChildren(t=0,e=2147483647){if(this._children&&this._children.length>0){var a=this._children;if(t===0&&e>=a.length-1){var i=a;this._children=Ne.ARRAY_EMPTY}else{i=a.splice(t,e-t)}for(var r=0,s=i.length;r<s;r++){i[r]._setParent(null)}}return this}replaceChild(t,e){var a=this._children.indexOf(e);if(a>-1){this._children.splice(a,1,t);e._setParent(null);t._setParent(this);return t}return null}get numChildren(){return this._children.length}get parent(){return this._parent}_setParent(t){if(this._parent!==t){if(t){this._parent=t;this._onAdded();this.event(P.ADDED);if(this._getBit(b.DISPLAY)){this._setUpNoticeChain();t.displayedInStage&&this._displayChild(this,true)}t._childChanged(this)}else{this._onRemoved();this.event(P.REMOVED);this._parent._childChanged();if(this._getBit(b.DISPLAY))this._displayChild(this,false);this._parent=t}}}get displayedInStage(){if(this._getBit(b.DISPLAY))return this._getBit(b.DISPLAYED_INSTAGE);this._setBitUp(b.DISPLAY);return this._getBit(b.DISPLAYED_INSTAGE)}_updateDisplayedInstage(){var t;t=this;var e=O.stage;var a=false;while(t){if(t._getBit(b.DISPLAY)){a=t._getBit(b.DISPLAYED_INSTAGE);break}if(t===e||t._getBit(b.DISPLAYED_INSTAGE)){a=true;break}t=t._parent}this._setBit(b.DISPLAYED_INSTAGE,a)}_setDisplay(t){if(this._getBit(b.DISPLAYED_INSTAGE)!==t){this._setBit(b.DISPLAYED_INSTAGE,t);if(t)this.event(P.DISPLAY);else this.event(P.UNDISPLAY)}}_displayChild(t,e){var a=t._children;if(a){for(var i=0,r=a.length;i<r;i++){var s=a[i];if(!s._getBit(b.DISPLAY))continue;if(s._children.length>0){this._displayChild(s,e)}else{s._setDisplay(e)}}}t._setDisplay(e)}contains(t){if(t===this)return true;while(t){if(t._parent===this)return true;t=t._parent}return false}timerLoop(t,e,a,i=null,r=true,s=false){var n=this.scene?this.scene.timer:O.timer;n.loop(t,e,a,i,r,s)}timerOnce(t,e,a,i=null,r=true){var s=this.scene?this.scene.timer:O.timer;s._create(false,false,t,e,a,i,r)}frameLoop(t,e,a,i=null,r=true){var s=this.scene?this.scene.timer:O.timer;s._create(true,true,t,e,a,i,r)}frameOnce(t,e,a,i=null,r=true){var s=this.scene?this.scene.timer:O.timer;s._create(true,false,t,e,a,i,r)}clearTimer(t,e){var a=this.scene?this.scene.timer:O.timer;a.clear(t,e)}callLater(t,e=null){var a=this.scene?this.scene.timer:O.timer;a.callLater(this,t,e)}runCallLater(t){var e=this.scene?this.scene.timer:O.timer;e.runCallLater(this,t)}get scene(){return this._scene}get active(){return!this._getBit(b.NOT_READY)&&!this._getBit(b.NOT_ACTIVE)}set active(t){t=!!t;if(!this._getBit(b.NOT_ACTIVE)!==t){if(this._activeChangeScripts&&this._activeChangeScripts.length!==0){if(t)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";else throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event."}else{this._setBit(b.NOT_ACTIVE,!t);if(this._parent){if(this._parent.activeInHierarchy){if(t)this._processActive();else this._processInActive()}}}}}get activeInHierarchy(){return this._getBit(b.ACTIVE_INHIERARCHY)}_onActive(){g.spriteCount++}_onInActive(){g.spriteCount--}_onActiveInScene(){}_onInActiveInScene(){}_parse(t,e){}_setBelongScene(t){if(!this._scene){this._scene=t;this._onActiveInScene();for(var e=0,a=this._children.length;e<a;e++)this._children[e]._setBelongScene(t)}}_setUnBelongScene(){if(this._scene!==this){this._onInActiveInScene();this._scene=null;for(var t=0,e=this._children.length;t<e;t++)this._children[t]._setUnBelongScene()}}onAwake(){}onEnable(){}_processActive(){this._activeChangeScripts||(this._activeChangeScripts=[]);this._activeHierarchy(this._activeChangeScripts);this._activeScripts()}_activeHierarchy(t){this._setBit(b.ACTIVE_INHIERARCHY,true);if(this._components){for(var e=0,a=this._components.length;e<a;e++){var i=this._components[e];if(i._isScript())i._enabled&&t.push(i);else i._setActive(true)}}this._onActive();for(e=0,a=this._children.length;e<a;e++){var r=this._children[e];!r._getBit(b.NOT_ACTIVE)&&!r._getBit(b.NOT_READY)&&r._activeHierarchy(t)}if(!this._getBit(b.AWAKED)){this._setBit(b.AWAKED,true);this.onAwake()}this.onEnable()}_activeScripts(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++){var a=this._activeChangeScripts[t];if(!a._awaked){a._awaked=true;a._onAwake()}a._onEnable()}this._activeChangeScripts.length=0}_processInActive(){this._activeChangeScripts||(this._activeChangeScripts=[]);this._inActiveHierarchy(this._activeChangeScripts);this._inActiveScripts()}_inActiveHierarchy(t){this._onInActive();if(this._components){for(var e=0,a=this._components.length;e<a;e++){var i=this._components[e];i._setActive(false);i._isScript()&&i._enabled&&t.push(i)}}this._setBit(b.ACTIVE_INHIERARCHY,false);for(e=0,a=this._children.length;e<a;e++){var r=this._children[e];r&&!r._getBit(b.NOT_ACTIVE)&&r._inActiveHierarchy(t)}this.onDisable()}_inActiveScripts(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++)this._activeChangeScripts[t].onDisable();this._activeChangeScripts.length=0}onDisable(){}_onAdded(){if(this._activeChangeScripts&&this._activeChangeScripts.length!==0){throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event."}else{var t=this._parent.scene;t&&this._setBelongScene(t);this._parent.activeInHierarchy&&this.active&&this._processActive()}}_onRemoved(){if(this._activeChangeScripts&&this._activeChangeScripts.length!==0){throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event."}else{this._parent.activeInHierarchy&&this.active&&this._processInActive();this._parent.scene&&this._setUnBelongScene()}}_addComponentInstance(t){this._components=this._components||[];this._components.push(t);t.owner=this;t._onAdded();if(this.activeInHierarchy)t._setActive(true)}_destroyComponent(t){if(this._components){for(var e=0,a=this._components.length;e<a;e++){var i=this._components[e];if(i===t){i._destroy();this._components.splice(e,1);break}}}}_destroyAllComponent(){if(this._components){for(var t=0,e=this._components.length;t<e;t++){var a=this._components[t];a&&a._destroy()}this._components.length=0}}_cloneTo(t,e,a){var i=t;if(this._components){for(var r=0,s=this._components.length;r<s;r++){var n=i.addComponent(this._components[r].constructor);this._components[r]._cloneTo(n)}}}addComponentIntance(t){if(t.owner)throw"Node:the component has belong to other node.";if(t.isSingleton&&this.getComponent(t.constructor))throw"Node:the component is singleton,can't add the second one.";this._addComponentInstance(t);return t}addComponent(t){var e=u.createByClass(t);e._destroyed=false;if(e.isSingleton&&this.getComponent(t))throw"无法实例"+t+"组件"+"，"+t+"组件已存在！";this._addComponentInstance(e);return e}getComponent(t){if(this._components){for(var e=0,a=this._components.length;e<a;e++){var i=this._components[e];if(i instanceof t)return i}}return null}getComponents(t){var e;if(this._components){for(var a=0,i=this._components.length;a<i;a++){var r=this._components[a];if(r instanceof t){e=e||[];e.push(r)}}}return e}get timer(){return this.scene?this.scene.timer:O.timer}}Ne.ARRAY_EMPTY=[];d.regClass("laya.display.Node",Ne);d.regClass("Laya.Node",Ne);class Be extends Ne{constructor(){super();this._x=0;this._y=0;this._width=0;this._height=0;this._visible=true;this._mouseState=0;this._zOrder=0;this._renderType=0;this._transform=null;this._tfChanged=false;this._repaint=T.REPAINT_NONE;this._texture=null;this._style=Oe.EMPTY;this._cacheStyle=Pe.EMPTY;this._boundStyle=null;this._graphics=null;this.mouseThrough=false;this.autoSize=false;this.hitTestPrior=false}destroy(t=true){super.destroy(t);this._style&&this._style.recover();this._cacheStyle&&this._cacheStyle.recover();this._boundStyle&&this._boundStyle.recover();this._style=null;this._cacheStyle=null;this._boundStyle=null;this._transform=null;if(this._graphics&&this._graphics.autoDestroy){this._graphics.destroy()}this._graphics=null;this.texture=null}updateZOrder(){w.updateOrder(this._children)&&this.repaint()}_getBoundsStyle(){if(!this._boundStyle)this._boundStyle=we.create();return this._boundStyle}_setCustomRender(){}set customRenderEnable(t){if(t){this._renderType|=T.CUSTOM;this._setRenderType(this._renderType);this._setCustomRender()}}get cacheAs(){return this._cacheStyle.cacheAs}_setCacheAs(t){}set cacheAs(t){if(t===this._cacheStyle.userSetCache)return;if(this.mask&&t==="normal")return;this._setCacheAs(t);this._getCacheStyle().userSetCache=t;this._checkCanvasEnable();this.repaint()}_checkCanvasEnable(){var t=this._cacheStyle.needEnableCanvasRender();this._getCacheStyle().enableCanvasRender=t;if(t){if(this._cacheStyle.needBitmapCache()){this._cacheStyle.cacheAs="bitmap"}else{this._cacheStyle.cacheAs=this._cacheStyle.userSetCache}this._cacheStyle.reCache=true;this._renderType|=T.CANVAS}else{this._cacheStyle.cacheAs="none";this._cacheStyle.releaseContext();this._renderType&=~T.CANVAS}this._setCacheAs(this._cacheStyle.cacheAs);this._setRenderType(this._renderType)}get staticCache(){return this._cacheStyle.staticCache}set staticCache(t){this._getCacheStyle().staticCache=t;if(!t)this.reCache()}reCache(){this._cacheStyle.reCache=true;this._repaint|=T.REPAINT_CACHE}getRepaint(){return this._repaint}_setX(t){this._x=t}_setY(t){this._y=t}_setWidth(t,e){}_setHeight(t,e){}get x(){return this._x}set x(t){if(this.destroyed)return;if(this._x!==t){this._setX(t);this.parentRepaint(T.REPAINT_CACHE);var e=this._cacheStyle.maskParent;if(e){e.repaint(T.REPAINT_CACHE)}}}get y(){return this._y}set y(t){if(this.destroyed)return;if(this._y!==t){this._setY(t);this.parentRepaint(T.REPAINT_CACHE);var e=this._cacheStyle.maskParent;if(e){e.repaint(T.REPAINT_CACHE)}}}get width(){return this.get_width()}set width(t){this.set_width(t)}set_width(t){if(this._width!==t){this._width=t;this._setWidth(this.texture,t);this._setTranformChange()}}get_width(){if(!this.autoSize)return this._width||(this.texture?this.texture.width:0);if(this.texture)return this.texture.width;if(!this._graphics&&this._children.length===0)return 0;return this.getSelfBounds().width}get height(){return this.get_height()}set height(t){this.set_height(t)}set_height(t){if(this._height!==t){this._height=t;this._setHeight(this.texture,t);this._setTranformChange()}}get_height(){if(!this.autoSize)return this._height||(this.texture?this.texture.height:0);if(this.texture)return this.texture.height;if(!this._graphics&&this._children.length===0)return 0;return this.getSelfBounds().height}get displayWidth(){return this.width*this.scaleX}get displayHeight(){return this.height*this.scaleY}setSelfBounds(t){this._getBoundsStyle().userBounds=t}getBounds(){return this._getBoundsStyle().bounds=R._getWrapRec(this._boundPointsToParent())}getSelfBounds(){if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds;if(!this._graphics&&this._children.length===0&&!this._texture)return R.TEMP.setTo(0,0,this.width,this.height);return this._getBoundsStyle().bounds=R._getWrapRec(this._getBoundPointsM(false))}_boundPointsToParent(t=false){var e=0,a=0;if(this._style){e=this.pivotX;a=this.pivotY;t=t||this._style.rotation!==0;if(this._style.scrollRect){e+=this._style.scrollRect.x;a+=this._style.scrollRect.y}}var i=this._getBoundPointsM(t);if(!i||i.length<1)return i;if(i.length!=8){i=t?St.scanPList(i):R._getWrapRec(i,R.TEMP)._getBoundPoints()}if(!this.transform){w.transPointList(i,this._x-e,this._y-a);return i}var r=K.TEMP;var s,n=i.length;for(s=0;s<n;s+=2){r.x=i[s];r.y=i[s+1];this.toParentPoint(r);i[s]=r.x;i[s+1]=r.y}return i}getGraphicBounds(t=false){if(!this._graphics)return R.TEMP.setTo(0,0,0,0);return this._graphics.getBounds(t)}_getBoundPointsM(t=false){if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(!this._boundStyle)this._getBoundsStyle();if(!this._boundStyle.temBM)this._boundStyle.temBM=[];if(this._style.scrollRect){var e=w.clearArray(this._boundStyle.temBM);var a=R.TEMP;a.copyFrom(this._style.scrollRect);w.concatArray(e,a._getBoundPoints());return e}var i;if(this._graphics){i=this._graphics.getBoundPoints()}else{i=w.clearArray(this._boundStyle.temBM);if(this._texture){a=R.TEMP;a.setTo(0,0,this.width||this._texture.width,this.height||this._texture.height);w.concatArray(i,a._getBoundPoints())}}var r;var s;var n;n=this._children;for(var o=0,l=n.length;o<l;o++){r=n[o];if(r instanceof Be&&r._visible===true){s=r._boundPointsToParent(t);if(s)i=i?w.concatArray(i,s):s}}return i}_getCacheStyle(){this._cacheStyle===Pe.EMPTY&&(this._cacheStyle=Pe.create());return this._cacheStyle}getStyle(){this._style===Oe.EMPTY&&(this._style=Oe.create());return this._style}setStyle(t){this._style=t}get scaleX(){return this._style.scaleX}set scaleX(t){this.set_scaleX(t)}_setScaleX(t){this._style.scaleX=t}get scaleY(){return this._style.scaleY}set scaleY(t){this.set_scaleY(t)}_setScaleY(t){this._style.scaleY=t}set_scaleX(t){var e=this.getStyle();if(e.scaleX!==t){this._setScaleX(t);this._setTranformChange()}}get_scaleX(){return this._style.scaleX}set_scaleY(t){var e=this.getStyle();if(e.scaleY!==t){this._setScaleY(t);this._setTranformChange()}}get_scaleY(){return this._style.scaleY}get rotation(){return this._style.rotation}set rotation(t){var e=this.getStyle();if(e.rotation!==t){this._setRotation(t);this._setTranformChange()}}_setRotation(t){this._style.rotation=t}get skewX(){return this._style.skewX}set skewX(t){var e=this.getStyle();if(e.skewX!==t){this._setSkewX(t);this._setTranformChange()}}_setSkewX(t){this._style.skewX=t}get skewY(){return this._style.skewY}set skewY(t){var e=this.getStyle();if(e.skewY!==t){this._setSkewY(t);this._setTranformChange()}}_setSkewY(t){this._style.skewY=t}_createTransform(){return L.create()}_adjustTransform(){this._tfChanged=false;var t=this._style;var e=t.scaleX,a=t.scaleY;var i=t.skewX;var r=t.skewY;var s=t.rotation;var n=this._transform||(this._transform=this._createTransform());if(s||e!==1||a!==1||i!==0||r!==0){n._bTransform=true;var o=(s-i)*.0174532922222222;var l=(s+r)*.0174532922222222;var _=Math.cos(l);var h=Math.sin(l);var x=Math.sin(o);var c=Math.cos(o);n.a=e*_;n.b=e*h;n.c=-a*x;n.d=a*c;n.tx=n.ty=0}else{n.identity();this._renderType&=~T.TRANSFORM;this._setRenderType(this._renderType)}return n}_setTransform(t){}get transform(){return this._tfChanged?this._adjustTransform():this._transform}set transform(t){this.set_transform(t)}get_transform(){return this._tfChanged?this._adjustTransform():this._transform}set_transform(t){this._tfChanged=false;var e=this._transform||(this._transform=this._createTransform());t.copyTo(e);this._setTransform(e);if(t){this._x=e.tx;this._y=e.ty;e.tx=e.ty=0}if(t)this._renderType|=T.TRANSFORM;else{this._renderType&=~T.TRANSFORM}this._setRenderType(this._renderType);this.parentRepaint()}_setPivotX(t){var e=this.getStyle();e.pivotX=t}_getPivotX(){return this._style.pivotX}_setPivotY(t){var e=this.getStyle();e.pivotY=t}_getPivotY(){return this._style.pivotY}get pivotX(){return this._getPivotX()}set pivotX(t){this._setPivotX(t);this.repaint()}get pivotY(){return this._getPivotY()}set pivotY(t){this._setPivotY(t);this.repaint()}_setAlpha(t){if(this._style.alpha!==t){var e=this.getStyle();e.alpha=t;if(t!==1)this._renderType|=T.ALPHA;else this._renderType&=~T.ALPHA;this._setRenderType(this._renderType);this.parentRepaint()}}_getAlpha(){return this._style.alpha}get alpha(){return this._getAlpha()}set alpha(t){t=t<0?0:t>1?1:t;this._setAlpha(t)}get visible(){return this.get_visible()}set visible(t){this.set_visible(t)}get_visible(){return this._visible}set_visible(t){if(this._visible!==t){this._visible=t;this.parentRepaint(T.REPAINT_ALL)}}_setBlendMode(t){}get blendMode(){return this._style.blendMode}set blendMode(t){this._setBlendMode(t);this.getStyle().blendMode=t;if(t&&t!="source-over")this._renderType|=T.BLEND;else this._renderType&=~T.BLEND;this._setRenderType(this._renderType);this.parentRepaint()}get graphics(){if(!this._graphics){this.graphics=new Ae;this._graphics.autoDestroy=true}return this._graphics}_setGraphics(t){}_setGraphicsCallBack(){}set graphics(t){if(this._graphics)this._graphics._sp=null;this._graphics=t;if(t){this._setGraphics(t);this._renderType|=T.GRAPHICS;t._sp=this}else{this._renderType&=~T.GRAPHICS}this._setRenderType(this._renderType);this.repaint()}get scrollRect(){return this._style.scrollRect}_setScrollRect(t){}set scrollRect(t){this.getStyle().scrollRect=t;this._setScrollRect(t);this.repaint();if(t){this._renderType|=T.CLIP}else{this._renderType&=~T.CLIP}this._setRenderType(this._renderType)}pos(t,e,a=false){if(this._x!==t||this._y!==e){if(this.destroyed)return this;if(a){this._setX(t);this._setY(e);this.parentRepaint(T.REPAINT_CACHE);var i=this._cacheStyle.maskParent;if(i){i.repaint(T.REPAINT_CACHE)}}else{this.x=t;this.y=e}}return this}pivot(t,e){this.pivotX=t;this.pivotY=e;return this}size(t,e){this.width=t;this.height=e;return this}scale(t,e,a=false){var i=this.getStyle();if(i.scaleX!=t||i.scaleY!=e){if(this.destroyed)return this;if(a){this._setScaleX(t);this._setScaleY(e);this._setTranformChange()}else{this.scaleX=t;this.scaleY=e}}return this}skew(t,e){this.skewX=t;this.skewY=e;return this}render(t,e,a){Ie.renders[this._renderType]._fun(this,t,e+this._x,a+this._y);this._repaint=0}drawToCanvas(t,e,a,i){return Be.drawToCanvas(this,this._renderType,t,e,a,i)}drawToTexture(t,e,a,i,r=null){return Be.drawToTexture(this,this._renderType,t,e,a,i,r)}drawToTexture3D(t,e,a){throw"not implement"}static drawToCanvas(t,e,a,i,r,s){r-=t.x;s-=t.y;r|=0;s|=0;a|=0;i|=0;var n=new W;n.size(a,i);n.asBitmap=true;n._targets.start();n._targets.clear(0,0,0,0);Ie.renders[e]._fun(t,n,r,s);n.flush();n._targets.end();n._targets.restore();var o=n._targets.getData(0,0,a,i);n.destroy();var l=new ImageData(a,i);var _=a*4;var h=l.data;var x=i-1;var c=x*_;var d=0;for(;x>=0;x--){h.set(o.subarray(d,d+_),c);c-=_;d+=_}var u=new Me(true);u.size(a,i);var f=u.getContext("2d");f.putImageData(l,0,0);return u}static drawToTexture(t,e,a,i,r,s,n=null){if(!Be.drawtocanvCtx){Be.drawtocanvCtx=new W}r-=t.x;s-=t.y;r|=0;s|=0;a|=0;i|=0;var o=n?Be.drawtocanvCtx:new W;o.clear();o.size(a,i);if(n){o._targets=n}else{o.asBitmap=true}if(o._targets){o._targets.start();o._targets.clear(0,0,0,0);Ie.renders[e]._fun(t,o,r,s);o.flush();o._targets.end();o._targets.restore()}if(!n){var l=new le(o._targets,le.INV_UV);o.destroy(true);return l}t._repaint=0;return n}customRender(t,e,a){this._repaint=T.REPAINT_ALL}_applyFilters(){}get filters(){return this._cacheStyle.filters}_setColorFilter(t){}set filters(t){t&&t.length===0&&(t=null);if(this._cacheStyle.filters==t)return;this._getCacheStyle().filters=t?t.slice():null;if(t&&t.length){this._setColorFilter(t[0]);this._renderType|=T.FILTERS}else{this._setColorFilter(null);this._renderType&=~T.FILTERS}this._setRenderType(this._renderType);if(t&&t.length>0){if(!this._getBit(b.DISPLAY))this._setBitUp(b.DISPLAY);if(!(t.length==1&&t[0]instanceof ft)){this._getCacheStyle().cacheForFilters=true;this._checkCanvasEnable()}}else{if(this._cacheStyle.cacheForFilters){this._cacheStyle.cacheForFilters=false;this._checkCanvasEnable()}}this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter();this.repaint()}_isHaveGlowFilter(){var t,e;if(this.filters){for(t=0;t<this.filters.length;t++){if(this.filters[t].type==dt.GLOW){return true}}}for(t=0,e=this._children.length;t<e;t++){if(this._children[t]._isHaveGlowFilter()){return true}}return false}localToGlobal(t,e=false,a=null){if(e===true){t=new K(t.x,t.y)}var i=this;a=a||O.stage;while(i&&!i.destroyed){if(i==a)break;t=i.toParentPoint(t);i=i.parent}return t}globalToLocal(t,e=false,a=null){if(e){t=new K(t.x,t.y)}var i=this;var r=[];a=a||O.stage;while(i&&!i.destroyed){if(i==a)break;r.push(i);i=i.parent}var s=r.length-1;while(s>=0){i=r[s];t=i.fromParentPoint(t);s--}return t}toParentPoint(t){if(!t)return t;t.x-=this.pivotX;t.y-=this.pivotY;if(this.transform){this._transform.transformPoint(t)}t.x+=this._x;t.y+=this._y;var e=this._style.scrollRect;if(e){t.x-=e.x;t.y-=e.y}return t}fromParentPoint(t){if(!t)return t;t.x-=this._x;t.y-=this._y;var e=this._style.scrollRect;if(e){t.x+=e.x;t.y+=e.y}if(this.transform){this._transform.invertTransformPoint(t)}t.x+=this.pivotX;t.y+=this.pivotY;return t}fromStagePoint(t){return t}on(t,e,a,i=null){if(this._mouseState!==1&&this.isMouseEvent(t)){this.mouseEnabled=true;this._setBit(b.HAS_MOUSE,true);if(this._parent){this._onDisplay()}return this._createListener(t,e,a,i,false)}return super.on(t,e,a,i)}once(t,e,a,i=null){if(this._mouseState!==1&&this.isMouseEvent(t)){this.mouseEnabled=true;this._setBit(b.HAS_MOUSE,true);if(this._parent){this._onDisplay()}return this._createListener(t,e,a,i,true)}return super.once(t,e,a,i)}_onDisplay(t){if(this._mouseState!==1){var e=this;e=e.parent;while(e&&e._mouseState!==1){if(e._getBit(b.HAS_MOUSE))break;e.mouseEnabled=true;e._setBit(b.HAS_MOUSE,true);e=e.parent}}}_setParent(t){super._setParent(t);if(t&&this._getBit(b.HAS_MOUSE)){this._onDisplay()}}loadImage(t,e=null){if(!t){this.texture=null;i.call(this)}else{var a=O.Loader.textureMap[I.formatURL(t)];if(!a){a=new le;a.load(t);O.Loader.cacheTexture(t,a)}this.texture=a;if(!a.getIsReady())a.once(P.READY,this,i);else i.call(this)}function i(){this.repaint(T.REPAINT_ALL);e&&e.run()}return this}static fromImage(t){return(new Be).loadImage(t)}repaint(t=T.REPAINT_CACHE){if(!(this._repaint&t)){this._repaint|=t;this.parentRepaint(t)}if(this._cacheStyle&&this._cacheStyle.maskParent){this._cacheStyle.maskParent.repaint(t)}}_needRepaint(){return this._repaint&T.REPAINT_CACHE&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache}_childChanged(t=null){if(this._children.length)this._renderType|=T.CHILDS;else this._renderType&=~T.CHILDS;this._setRenderType(this._renderType);if(t&&this._getBit(b.HAS_ZORDER))O.systemTimer.callLater(this,this.updateZOrder);this.repaint(T.REPAINT_ALL)}parentRepaint(t=T.REPAINT_CACHE){var e=this._parent;if(e&&!(e._repaint&t)){e._repaint|=t;e.parentRepaint(t)}}get stage(){return O.stage}get hitArea(){return this._style.hitArea}set hitArea(t){this.getStyle().hitArea=t}_setMask(t){}get mask(){return this._cacheStyle.mask}set mask(t){if(t&&this.mask&&this.mask._cacheStyle.maskParent)return;this._getCacheStyle().mask=t;this._setMask(t);this._checkCanvasEnable();if(t){t._getCacheStyle().maskParent=this}else{if(this.mask){this.mask._getCacheStyle().maskParent=null}}this._renderType|=T.MASK;this._setRenderType(this._renderType);this.parentRepaint(T.REPAINT_ALL)}get mouseEnabled(){return this._mouseState>1}set mouseEnabled(t){this._mouseState=t?2:1}startDrag(t=null,e=false,a=0,i=300,r=null,s=false,n=.92){this._style.dragging||(this.getStyle().dragging=new O.Dragging);this._style.dragging.start(this,t,e,a,i,r,s,n)}stopDrag(){this._style.dragging&&this._style.dragging.stop()}_setDisplay(t){if(!t){if(this._cacheStyle){this._cacheStyle.releaseContext();this._cacheStyle.releaseFilterCache();if(this._cacheStyle.hasGlowFilter){this._cacheStyle.hasGlowFilter=false}}}super._setDisplay(t)}hitTestPoint(t,e){var a=this.globalToLocal(K.TEMP.setTo(t,e));t=a.x;e=a.y;var i=this._style.hitArea?this._style.hitArea:this._width>0&&this._height>0?R.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds();return i.contains(t,e)}getMousePoint(){return this.globalToLocal(K.TEMP.setTo(O.stage.mouseX,O.stage.mouseY))}get globalScaleX(){var t=1;var e=this;while(e){if(e===O.stage)break;t*=e.scaleX;e=e.parent}return t}get globalRotation(){var t=0;var e=this;while(e){if(e===O.stage)break;t+=e.rotation;e=e.parent}return t}get globalScaleY(){var t=1;var e=this;while(e){if(e===O.stage)break;t*=e.scaleY;e=e.parent}return t}get mouseX(){return this.getMousePoint().x}get mouseY(){return this.getMousePoint().y}get zOrder(){return this._zOrder}set zOrder(t){if(this._zOrder!=t){this._zOrder=t;if(this._parent){t&&this._parent._setBit(b.HAS_ZORDER,true);O.systemTimer.callLater(this._parent,this.updateZOrder)}}}get texture(){return this._texture}_setTexture(t){}set texture(t){if(typeof t=="string"){this.loadImage(t)}else if(this._texture!=t){this._texture&&this._texture._removeReference();this._texture=t;t&&t._addReference();this._setTexture(t);this._setWidth(this._texture,this.width);this._setHeight(this._texture,this.height);if(t)this._renderType|=T.TEXTURE;else this._renderType&=~T.TEXTURE;this._setRenderType(this._renderType);this.repaint()}}get viewport(){return this._style.viewport}set viewport(t){if(typeof t=="string"){var e;e=t.split(",");if(e.length>3){t=new R(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}}this.getStyle().viewport=t}_setRenderType(t){}_setTranformChange(){this._tfChanged=true;this._renderType|=T.TRANSFORM;this.parentRepaint(T.REPAINT_CACHE)}_setBgStyleColor(t,e,a,i,r){}_setBorderStyleColor(t,e,a,i,r,s){}captureMouseEvent(t){O.MouseManager.instance.setCapture(this,t)}releaseMouseEvent(){O.MouseManager.instance.releaseCapture()}set drawCallOptimize(t){this._setBit(b.DRAWCALL_OPTIMIZE,t)}get drawCallOptimize(){return this._getBit(b.DRAWCALL_OPTIMIZE)}}d.regClass("laya.display.Sprite",Be);d.regClass("Laya.Sprite",Be);class Fe extends Oe{constructor(){super(...arguments);this.italic=false}reset(){super.reset();this.italic=false;this.align="left";this.wordWrap=false;this.leading=0;this.padding=[0,0,0,0];this.bgColor=null;this.borderColor=null;this.asPassword=false;this.stroke=0;this.strokeColor="#000000";this.bold=false;this.underline=false;this.underlineColor=null;this.currBitmapFont=null;return this}recover(){if(this===Fe.EMPTY)return;u.recover("TextStyle",this.reset())}static create(){return u.getItemByClass("TextStyle",Fe)}render(t,e,a,i){(this.bgColor||this.borderColor)&&e.drawRect(a,i,t.width,t.height,this.bgColor,this.borderColor,1)}}Fe.EMPTY=new Fe;class F extends Be{constructor(){super();this._textWidth=0;this._textHeight=0;this._lines=[];this._lineWidths=[];this._startX=0;this._startY=0;this._charSize={};this._valign="top";this._fontSize=F.defaultFontSize;this._font=F.defaultFont;this._color="#000000";this._singleCharRender=false;this.overflow=F.VISIBLE;this._style=Fe.EMPTY}static defaultFontStr(){return F.defaultFontSize+"px "+F.defaultFont}getStyle(){this._style===Fe.EMPTY&&(this._style=Fe.create());return this._style}_getTextStyle(){if(this._style===Fe.EMPTY){this._style=Fe.create()}return this._style}static registerBitmapFont(t,e){F._bitmapFonts||(F._bitmapFonts={});F._bitmapFonts[t]=e}static unregisterBitmapFont(t,e=true){if(F._bitmapFonts&&F._bitmapFonts[t]){var a=F._bitmapFonts[t];if(e)a.destroy();delete F._bitmapFonts[t]}}destroy(t=true){super.destroy(t);this._clipPoint=null;this._lines=null;this._lineWidths=null;this._words&&this._words.forEach(function(t){t.cleanCache()});this._words=null;this._charSize=null}_getBoundPointsM(t=false){var e=R.TEMP;e.setTo(0,0,this.width,this.height);return e._getBoundPoints()}getGraphicBounds(t=false){var e=R.TEMP;e.setTo(0,0,this.width,this.height);return e}get width(){if(this._width)return this._width;return this.textWidth+this.padding[1]+this.padding[3]}set width(t){if(t!=this._width){super.set_width(t);this.isChanged=true;if(this.borderColor){this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1)}}}_getCSSStyle(){return this._style}get height(){if(this._height)return this._height;return this.textHeight}set height(t){if(t!=this._height){super.set_height(t);this.isChanged=true;if(this.borderColor){this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1)}}}get textWidth(){this._isChanged&&O.systemTimer.runCallLater(this,this.typeset);return this._textWidth}get textHeight(){this._isChanged&&O.systemTimer.runCallLater(this,this.typeset);return this._textHeight}get text(){return this._text||""}get_text(){return this._text||""}set_text(t){if(this._text!==t){this.lang(t+"");this.isChanged=true;this.event(P.CHANGE);if(this.borderColor){this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1)}}}set text(t){this.set_text(t)}lang(t,e=null,a=null,i=null,r=null,s=null,n=null,o=null,l=null,_=null,h=null){t=F.langPacks&&F.langPacks[t]?F.langPacks[t]:t;if(arguments.length<2){this._text=t}else{for(var x=0,c=arguments.length;x<c;x++){t=t.replace("{"+x+"}",arguments[x+1])}this._text=t}}get font(){return this._font}set font(t){if(this._style.currBitmapFont){this._getTextStyle().currBitmapFont=null;this.scale(1,1)}if(F._bitmapFonts&&F._bitmapFonts[t]){this._getTextStyle().currBitmapFont=F._bitmapFonts[t]}this._font=t;this.isChanged=true}get fontSize(){return this._fontSize}set fontSize(t){if(this._fontSize!=t){this._fontSize=t;this.isChanged=true}}get bold(){return this._style.bold}set bold(t){this._getTextStyle().bold=t;this.isChanged=true}get color(){return this._color}set color(t){this.set_color(t)}get_color(){return this._color}set_color(t){if(this._color!=t){this._color=t;if(!this._isChanged&&this._graphics){this._graphics.replaceTextColor(this.color)}else{this.isChanged=true}}}get italic(){return this._style.italic}set italic(t){this._getTextStyle().italic=t;this.isChanged=true}get align(){return this._style.align}set align(t){this._getTextStyle().align=t;this.isChanged=true}get valign(){return this._valign}set valign(t){this._valign=t;this.isChanged=true}get wordWrap(){return this._style.wordWrap}set wordWrap(t){this._getTextStyle().wordWrap=t;this.isChanged=true}get leading(){return this._style.leading}set leading(t){this._getTextStyle().leading=t;this.isChanged=true}get padding(){return this._style.padding}set padding(t){if(typeof t=="string"){var e;e=t.split(",");var a,i;i=e.length;while(e.length<4){e.push(0)}for(a=0;a<i;a++){e[a]=parseFloat(e[a])||0}t=e}this._getTextStyle().padding=t;this.isChanged=true}get bgColor(){return this._style.bgColor}set bgColor(t){this.set_bgColor(t)}set_bgColor(t){this._getTextStyle().bgColor=t;this._renderType|=T.STYLE;this._setBgStyleColor(0,0,this.width,this.height,t);this._setRenderType(this._renderType);this.isChanged=true}get_bgColor(){return this._style.bgColor}get borderColor(){return this._style.borderColor}set borderColor(t){this._getTextStyle().borderColor=t;this._renderType|=T.STYLE;this._setBorderStyleColor(0,0,this.width,this.height,t,1);this._setRenderType(this._renderType);this.isChanged=true}get stroke(){return this._style.stroke}set stroke(t){this._getTextStyle().stroke=t;this.isChanged=true}get strokeColor(){return this._style.strokeColor}set strokeColor(t){this._getTextStyle().strokeColor=t;this.isChanged=true}set isChanged(t){if(this._isChanged!==t){this._isChanged=t;t&&O.systemTimer.callLater(this,this.typeset)}}_getContextFont(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(O.Browser.onIPhone?F.fontFamilyMap[this.font]||this.font:this.font)}_isPassWordMode(){var t=this._style;var e=t.asPassword;if("prompt"in this&&this["prompt"]==this._text)e=false;return e}_getPassWordTxt(t){var e=t.length;var a;a="";for(var i=e;i>0;i--){a+="●"}return a}_renderText(){var t=this.padding;var e=this._lines.length;if(this.overflow!=F.VISIBLE){e=Math.min(e,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1)}var a=this.scrollY/(this._charSize.height+this.leading)|0;var i=this.graphics;i.clear(true);var r=this._getContextFont();O.Browser.context.font=r;var s=t[3];var n="left";var o=this._lines;var l=this.leading+this._charSize.height;var _=this._style.currBitmapFont;if(_){l=this.leading+_.getMaxHeight()}var h=t[0];if(!_&&this._width>0&&this._textWidth<=this._width){if(this.align=="right"){n="right";s=this._width-t[1]}else if(this.align=="center"){n="center";s=this._width*.5+t[3]-t[1]}}if(this._height>0){var x=this._textHeight>this._height?"top":this.valign;if(x==="middle")h=(this._height-e*l)*.5+t[0]-t[2];else if(x==="bottom")h=this._height-e*l-t[2]}var c=this._style;if(_&&_.autoScaleSize){var d=_.fontSize/this.fontSize}if(this._clipPoint){i.save();if(_&&_.autoScaleSize){var u;var f;this._width?u=this._width-t[3]-t[1]:u=this._textWidth;this._height?f=this._height-t[0]-t[2]:f=this._textHeight;u*=d;f*=d;i.clipRect(t[3],t[0],u,f)}else{i.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight)}this.repaint()}var p=c.asPassword;if("prompt"in this&&this["prompt"]==this._text)p=false;var m=0,g=0;var v=Math.min(this._lines.length,e+a)||1;for(var y=a;y<v;y++){var T=o[y];var E;if(p){var b=T.length;T="";for(var S=b;S>0;S--){T+="●"}}if(T==null)T="";m=s-(this._clipPoint?this._clipPoint.x:0);g=h+l*y-(this._clipPoint?this._clipPoint.y:0);this.underline&&this._drawUnderline(n,m,g,y);if(_){var C=this.width;if(_.autoScaleSize){C=this.width*d}_._drawText(T,this,m,g,this.align,C)}else{this._words||(this._words=[]);if(this._words.length>y-a){E=this._words[y-a]}else{E=new he;this._words.push(E)}E.setText(T);E.splitRender=this._singleCharRender;c.stroke?i.fillBorderText(E,m,g,r,this.color,n,c.stroke,c.strokeColor):i.fillText(E,m,g,r,this.color,n)}}if(_&&_.autoScaleSize){var R=1/d;this.scale(R,R)}if(this._clipPoint)i.restore();this._startX=s;this._startY=h}_drawUnderline(t,e,a,i){var r=this._lineWidths[i];switch(t){case"center":e-=r/2;break;case"right":e-=r;break;case"left":default:break}a+=this._charSize.height;this._graphics.drawLine(e,a,e+r,a,this.underlineColor||this.color,1)}typeset(){this._isChanged=false;if(!this._text){this._clipPoint=null;this._textWidth=this._textHeight=0;this.graphics.clear(true);return}if(O.Render.isConchApp){window.conchTextCanvas.font=this._getContextFont()}else{O.Browser.context.font=this._getContextFont()}this._lines.length=0;this._lineWidths.length=0;if(this._isPassWordMode()){this._parseLines(this._getPassWordTxt(this._text))}else this._parseLines(this._text);this._evalTextSize();if(this._checkEnabledViewportOrNot())this._clipPoint||(this._clipPoint=new K(0,0));else this._clipPoint=null;this._renderText()}_evalTextSize(){var t,e;t=Math.max.apply(this,this._lineWidths);if(this._style.currBitmapFont)e=this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2];else{e=this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2];if(this._lines.length){e-=this.leading}}if(t!=this._textWidth||e!=this._textHeight){this._textWidth=t;this._textHeight=e}}_checkEnabledViewportOrNot(){return this.overflow==F.SCROLL&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)}changeText(t){if(this._text!==t){this.lang(t+"");if(this._graphics&&this._graphics.replaceText(this._text));else{this.typeset()}}}_parseLines(t){var e=this.wordWrap||this.overflow==F.HIDDEN;if(e){var a=this._getWordWrapWidth()}var i=this._style.currBitmapFont;if(i){this._charSize.width=i.getMaxWidth();this._charSize.height=i.getMaxHeight()}else{var r=null;if(O.Render.isConchApp){r=window.conchTextCanvas.measureText(F._testWord)}else{r=O.Browser.context.measureText(F._testWord)}if(!r)r={width:100};this._charSize.width=r.width;this._charSize.height=r.height||this.fontSize}var s=t.replace(/\r\n/g,"\n").split("\n");for(var n=0,o=s.length;n<o;n++){var l=s[n];if(e)this._parseLine(l,a);else{this._lineWidths.push(this._getTextWidth(l));this._lines.push(l)}}}_parseLine(t,e){var a=this._lines;var i=0;var r=0;var s=0;var n=0;r=this._getTextWidth(t);if(r<=e){a.push(t);this._lineWidths.push(r);return}r=this._charSize.width;i=Math.floor(e/r);i==0&&(i=1);r=this._getTextWidth(t.substring(0,i));s=r;for(var o=i,l=t.length;o<l;o++){r=this._getTextWidth(t.charAt(o));s+=r;if(s>e){if(this.wordWrap){var _=t.substring(n,o);if(_.charCodeAt(_.length-1)<255){var h=/(?:\w|-)+$/.exec(_);if(h){o=h.index+n;if(h.index==0)o+=_.length;else _=t.substring(n,o)}}a.push(_);this._lineWidths.push(s-r);n=o;if(o+i<l){o+=i;r=this._getTextWidth(t.substring(n,o));s=r;o--}else{a.push(t.substring(n,l));this._lineWidths.push(this._getTextWidth(a[a.length-1]));n=-1;break}}else if(this.overflow==F.HIDDEN){a.push(t.substring(0,o));this._lineWidths.push(this._getTextWidth(a[a.length-1]));return}}}if(this.wordWrap&&n!=-1){a.push(t.substring(n,l));this._lineWidths.push(this._getTextWidth(a[a.length-1]))}}_getTextWidth(e){var t=this._style.currBitmapFont;if(t)return t.getTextWidth(e);else{if(O.Render.isConchApp){return window.conchTextCanvas.measureText(e).width}else{let t=O.Browser.context.measureText(e)||{width:100};return t.width}}}_getWordWrapWidth(){var t=this.padding;var e;var a=this._style.currBitmapFont;if(a&&a.autoScaleSize)e=this._width*(a.fontSize/this.fontSize);else e=this._width;if(e<=0){e=this.wordWrap?100:O.Browser.width}e<=0&&(e=100);return e-t[3]-t[1]}getCharPoint(t,e=null){this._isChanged&&O.systemTimer.runCallLater(this,this.typeset);var a=0,i=this._lines,r=0;for(var s=0,n=i.length;s<n;s++){a+=i[s].length;if(t<a){var o=s;break}r=a}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;O.Browser.context.font=l;var _=this._getTextWidth(this._text.substring(r,t));var h=e||new K;return h.setTo(this._startX+_-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))}set scrollX(t){if(this.overflow!=F.SCROLL||(this.textWidth<this._width||!this._clipPoint))return;t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=t>e?e:t;this._clipPoint.x=t;this._renderText()}get scrollX(){if(!this._clipPoint)return 0;return this._clipPoint.x}set scrollY(t){if(this.overflow!=F.SCROLL||(this.textHeight<this._height||!this._clipPoint))return;t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height;t=t>e?e:t;this._clipPoint.y=t;this._renderText()}get scrollY(){if(!this._clipPoint)return 0;return this._clipPoint.y}get maxScrollX(){return this.textWidth<this._width?0:this._textWidth-this._width}get maxScrollY(){return this.textHeight<this._height?0:this._textHeight-this._height}get lines(){if(this._isChanged)this.typeset();return this._lines}get underlineColor(){return this._style.underlineColor}set underlineColor(t){this._getTextStyle().underlineColor=t;if(!this._isChanged)this._renderText()}get underline(){return this._style.underline}set underline(t){this._getTextStyle().underline=t}set singleCharRender(t){this._singleCharRender=t}get singleCharRender(){return this._singleCharRender}}F.VISIBLE="visible";F.SCROLL="scroll";F.HIDDEN="hidden";F.defaultFontSize=12;F.defaultFont="Arial";F.isComplexText=false;F.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"};F._testWord="游";F.CharacterCache=true;F.RightToLeft=false;O.regClass(F);d.regClass("laya.display.Text",F);d.regClass("Laya.Text",F);class l extends F{constructor(){super();this._multiline=false;this._editable=true;this._maxChars=1e5;this._type="text";this._prompt="";this._promptColor="#A9A9A9";this._originColor="#000000";this._content="";l.IOS_IFRAME=O.Browser.onIOS&&O.Browser.window.top!=O.Browser.window.self;this._width=100;this._height=20;this.multiline=false;this.overflow=F.SCROLL;this.on(P.MOUSE_DOWN,this,this._onMouseDown);this.on(P.UNDISPLAY,this,this._onUnDisplay)}static __init__(){l._createInputElement();if(O.Browser.onMobile){var t=false;if(O.Browser.onMiniGame||O.Browser.onBDMiniGame||O.Browser.onQGMiniGame||O.Browser.onKGMiniGame||O.Browser.onVVMiniGame||O.Browser.onAlipayMiniGame||O.Browser.onQQMiniGame||O.Browser.onBLMiniGame||O.Browser.onTTMiniGame||O.Browser.onHWMiniGame||O.Browser.onTBMiniGame){t=true}O.Render.canvas.addEventListener(l.IOS_IFRAME?t?"touchend":"click":"touchend",l._popupInputMethod)}}static _popupInputMethod(t){if(!l.isInputting)return;var e=l.inputElement;e.focus()}static _createInputElement(){l._initInput(l.area=O.Browser.createElement("textarea"));l._initInput(l.input=O.Browser.createElement("input"));l.inputContainer=O.Browser.createElement("div");l.inputContainer.style.position="absolute";l.inputContainer.style.zIndex=1e5;O.Browser.container.appendChild(l.inputContainer);l.inputContainer.setPos=function(t,e){l.inputContainer.style.left=t+"px";l.inputContainer.style.top=e+"px"}}static _initInput(e){var t=e.style;t.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;";t.resize="none";t.backgroundColor="transparent";t.border="none";t.outline="none";t.zIndex=1;e.addEventListener("input",l._processInputting);e.addEventListener("mousemove",l._stopEvent);e.addEventListener("mousedown",l._stopEvent);e.addEventListener("touchmove",l._stopEvent);e.setFontFace=function(t){e.style.fontFamily=t};if(!O.Render.isConchApp){e.setColor=function(t){e.style.color=t};e.setFontSize=function(t){e.style.fontSize=t+"px"}}}static _processInputting(t){var e=l.inputElement.target;if(!e)return;var a=l.inputElement.value;if(e._restrictPattern){a=a.replace(/\u2006|\x27/g,"");if(e._restrictPattern.test(a)){a=a.replace(e._restrictPattern,"");l.inputElement.value=a}}e._text=a;e.event(P.INPUT)}static _stopEvent(t){if(t.type=="touchmove")t.preventDefault();t.stopPropagation&&t.stopPropagation()}setSelection(t,e){this.focus=true;l.inputElement.selectionStart=t;l.inputElement.selectionEnd=e}get multiline(){return this._multiline}set multiline(t){this._multiline=t;this.valign=t?"top":"middle"}get nativeInput(){return this._multiline?l.area:l.input}_onUnDisplay(t=null){this.focus=false}_onMouseDown(t){this.focus=true}_syncInputTransform(){var t=this.nativeInput;var e=w.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]);var a=this._width-this.padding[1]-this.padding[3];var i=this._height-this.padding[0]-this.padding[2];if(O.Render.isConchApp){t.setScale(e.scaleX,e.scaleY);t.setSize(a,i);t.setPos(e.x,e.y)}else{l.inputContainer.style.transform=l.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+O.stage.canvasDegree+"deg)";t.style.width=a+"px";t.style.height=i+"px";l.inputContainer.style.left=e.x+"px";l.inputContainer.style.top=e.y+"px"}}select(){this.nativeInput.select()}get focus(){return this._focus}set focus(t){var e=this.nativeInput;if(this._focus!==t){if(t){if(e.target){e.target._focusOut()}else{this._setInputMethod()}e.target=this;this._focusIn()}else{e.target=null;this._focusOut();O.Browser.document.body.scrollTop=0;e.blur();if(O.Render.isConchApp)e.setPos(-1e4,-1e4);else if(l.inputContainer.contains(e))l.inputContainer.removeChild(e)}}}_setInputMethod(){l.input.parentElement&&l.inputContainer.removeChild(l.input);l.area.parentElement&&l.inputContainer.removeChild(l.area);l.inputElement=this._multiline?l.area:l.input;l.inputContainer.appendChild(l.inputElement);if(F.RightToLeft){l.inputElement.style.direction="rtl"}}_focusIn(){l.isInputting=true;var t=this.nativeInput;l.input&&(l.input.type=this._type);this._focus=true;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap";this._setPromptColor();t.readOnly=!this._editable;if(O.Render.isConchApp){t.setType(this._type);t.setForbidEdit(!this._editable)}t.maxLength=this._maxChars;var a=this.padding;t.value=this._content;t.placeholder=this._prompt;O.stage.off(P.KEY_DOWN,this,this._onKeyDown);O.stage.on(P.KEY_DOWN,this,this._onKeyDown);O.stage.focus=this;this.event(P.FOCUS);if(O.Browser.onPC)t.focus();if(!O.Browser.onMiniGame&&!O.Browser.onBDMiniGame&&!O.Browser.onQGMiniGame&&!O.Browser.onKGMiniGame&&!O.Browser.onVVMiniGame&&!O.Browser.onAlipayMiniGame&&!O.Browser.onQQMiniGame&&!O.Browser.onBLMiniGame&&!O.Browser.onTTMiniGame&&!O.Browser.onHWMiniGame&&!O.Browser.onTBMiniGame){var i=this._text;this._text=null}this.typeset();t.setColor(this._originColor);t.setFontSize(this.fontSize);t.setFontFace(O.Browser.onIPhone?F.fontFamilyMap[this.font]||this.font:this.font);if(O.Render.isConchApp){t.setMultiAble&&t.setMultiAble(this._multiline)}e.lineHeight=this.leading+this.fontSize+"px";e.fontStyle=this.italic?"italic":"normal";e.fontWeight=this.bold?"bold":"normal";e.textAlign=this.align;e.padding="0 0";this._syncInputTransform();if(!O.Render.isConchApp&&O.Browser.onPC)O.systemTimer.frameLoop(1,this,this._syncInputTransform)}_setPromptColor(){l.promptStyleDOM=O.Browser.getElementById("promptStyle");if(!l.promptStyleDOM){l.promptStyleDOM=O.Browser.createElement("style");l.promptStyleDOM.setAttribute("id","promptStyle");O.Browser.document.head.appendChild(l.promptStyleDOM)}l.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {"+"color:"+this._promptColor+"}"+"input:-moz-placeholder, textarea:-moz-placeholder {"+"color:"+this._promptColor+"}"+"input::-moz-placeholder, textarea::-moz-placeholder {"+"color:"+this._promptColor+"}"+"input:-ms-input-placeholder, textarea:-ms-input-placeholder {"+"color:"+this._promptColor+"}"}_focusOut(){if(!l.isInputting)return;l.isInputting=false;this._focus=false;this._text=null;this._content=this.nativeInput.value;if(!this._content){super.set_text(this._prompt);super.set_color(this._promptColor)}else{super.set_text(this._content);super.set_color(this._originColor)}O.stage.off(P.KEY_DOWN,this,this._onKeyDown);O.stage.focus=null;this.event(P.BLUR);this.event(P.CHANGE);if(O.Render.isConchApp)this.nativeInput.blur();O.Browser.onPC&&O.systemTimer.clear(this,this._syncInputTransform)}_onKeyDown(t){if(t.keyCode===13){if(O.Browser.onMobile&&!this._multiline)this.focus=false;this.event(P.ENTER)}}set text(t){super.set_color(this._originColor);t+="";if(this._focus){this.nativeInput.value=t||"";this.event(P.CHANGE)}else{if(!this._multiline)t=t.replace(/\r?\n/g,"");this._content=t;if(t)super.set_text(t);else{super.set_text(this._prompt);super.set_color(this.promptColor)}}}get text(){if(this._focus)return this.nativeInput.value;else return this._content||""}changeText(t){this._content=t;if(this._focus){this.nativeInput.value=t||"";this.event(P.CHANGE)}else super.changeText(t)}set color(t){if(this._focus)this.nativeInput.setColor(t);super.set_color(this._content?t:this._promptColor);this._originColor=t}get color(){return super.color}set bgColor(t){super.set_bgColor(t);if(O.Render.isConchApp)this.nativeInput.setBgColor(t)}get bgColor(){return super.bgColor}get restrict(){if(this._restrictPattern){return this._restrictPattern.source}return""}set restrict(t){if(t){t="[^"+t+"]";if(t.indexOf("^^")>-1)t=t.replace("^^","");this._restrictPattern=new RegExp(t,"g")}else this._restrictPattern=null}set editable(t){this._editable=t;if(O.Render.isConchApp){l.input.setForbidEdit(!t)}}get editable(){return this._editable}get maxChars(){return this._maxChars}set maxChars(t){if(t<=0)t=1e5;this._maxChars=t}get prompt(){return this._prompt}set prompt(t){if(!this._text&&t)super.set_color(this._promptColor);this.promptColor=this._promptColor;if(this._text)super.set_text(this._text==this._prompt?t:this._text);else super.set_text(t);this._prompt=F.langPacks&&F.langPacks[t]?F.langPacks[t]:t}get promptColor(){return this._promptColor}set promptColor(t){this._promptColor=t;if(!this._content)super.set_color(t)}get type(){return this._type}set type(t){if(t==="password")this._getTextStyle().asPassword=true;else this._getTextStyle().asPassword=false;this._type=t}}l.TYPE_TEXT="text";l.TYPE_PASSWORD="password";l.TYPE_EMAIL="email";l.TYPE_URL="url";l.TYPE_NUMBER="number";l.TYPE_RANGE="range";l.TYPE_DATE="date";l.TYPE_MONTH="month";l.TYPE_WEEK="week";l.TYPE_TIME="time";l.TYPE_DATE_TIME="datetime";l.TYPE_DATE_TIME_LOCAL="datetime-local";l.TYPE_SEARCH="search";l.IOS_IFRAME=false;l.inputHeight=45;l.isInputting=false;d.regClass("laya.display.Input",l);d.regClass("Laya.Input",l);class Ve{constructor(){this.preOvers=[];this.preDowns=[];this.preRightDowns=[];this.enable=true;this._event=new P;this._lastClickTime=0}_clearTempArrs(){Ve._oldArr.length=0;Ve._newArr.length=0;Ve._tEleArr.length=0}getTouchFromArr(t,e){var a,i;i=e.length;var r;for(a=0;a<i;a++){r=e[a];if(r.id==t){return r}}return null}removeTouchFromArr(t,e){var a;for(a=e.length-1;a>=0;a--){if(e[a].id==t){e.splice(a,1)}}}createTouchO(t,e){var a;a=u.getItem("TouchData")||{};a.id=e;a.tar=t;return a}onMouseDown(t,e,a=false){if(!this.enable)return;var i;var r;var s;i=this.getTouchFromArr(e,this.preOvers);s=this.getEles(t,null,Ve._tEleArr);if(!i){r=this.createTouchO(t,e);this.preOvers.push(r)}else{i.tar=t}if(N.onMobile)this.sendEvents(s,P.MOUSE_OVER);var n;n=a?this.preDowns:this.preRightDowns;i=this.getTouchFromArr(e,n);if(!i){r=this.createTouchO(t,e);n.push(r)}else{i.tar=t}this.sendEvents(s,a?P.MOUSE_DOWN:P.RIGHT_MOUSE_DOWN);this._clearTempArrs()}sendEvents(t,e){var a,i;i=t.length;this._event._stoped=false;var r;r=t[0];for(a=0;a<i;a++){var s=t[a];if(s.destroyed)return;s.event(e,this._event.setTo(e,s,r));if(this._event._stoped)break}}getEles(t,e=null,a=null){if(!a){a=[]}else{a.length=0}while(t&&t!=e){a.push(t);t=t.parent}return a}checkMouseOutAndOverOfMove(t,e,a=0){if(e==t)return;var i;var r;var s,n;if(e.contains(t)){r=this.getEles(t,e,Ve._tEleArr);this.sendEvents(r,P.MOUSE_OVER)}else if(t.contains(e)){r=this.getEles(e,t,Ve._tEleArr);this.sendEvents(r,P.MOUSE_OUT)}else{r=Ve._tEleArr;r.length=0;var o;o=this.getEles(e,null,Ve._oldArr);var l;l=this.getEles(t,null,Ve._newArr);n=o.length;var _;for(s=0;s<n;s++){i=o[s];_=l.indexOf(i);if(_>=0){l.splice(_,l.length-_);break}else{r.push(i)}}if(r.length>0){this.sendEvents(r,P.MOUSE_OUT)}if(l.length>0){this.sendEvents(l,P.MOUSE_OVER)}}}onMouseMove(t,e){if(!this.enable)return;var a;a=this.getTouchFromArr(e,this.preOvers);var i;if(!a){i=this.getEles(t,null,Ve._tEleArr);this.sendEvents(i,P.MOUSE_OVER);this.preOvers.push(this.createTouchO(t,e))}else{this.checkMouseOutAndOverOfMove(t,a.tar);a.tar=t;i=this.getEles(t,null,Ve._tEleArr)}this.sendEvents(i,P.MOUSE_MOVE);this._clearTempArrs()}getLastOvers(){Ve._tEleArr.length=0;if(this.preOvers.length>0&&this.preOvers[0].tar){return this.getEles(this.preOvers[0].tar,null,Ve._tEleArr)}Ve._tEleArr.push(O.stage);return Ve._tEleArr}stageMouseOut(){var t;t=this.getLastOvers();this.preOvers.length=0;this.sendEvents(t,P.MOUSE_OUT)}onMouseUp(t,e,a=false){if(!this.enable)return;var i;var r;var s;var n,o;var l;var _;var h=N.onMobile;r=this.getEles(t,null,Ve._tEleArr);this.sendEvents(r,a?P.MOUSE_UP:P.RIGHT_MOUSE_UP);var x;x=a?this.preDowns:this.preRightDowns;i=this.getTouchFromArr(e,x);if(!i);else{var c;var d=N.now();c=d-this._lastClickTime<300;this._lastClickTime=d;if(t==i.tar){_=r}else{s=this.getEles(i.tar,null,Ve._oldArr);_=Ve._newArr;_.length=0;o=s.length;for(n=0;n<o;n++){l=s[n];if(r.indexOf(l)>=0){_.push(l)}}}if(_.length>0){this.sendEvents(_,a?P.CLICK:P.RIGHT_CLICK)}if(a&&c){this.sendEvents(_,P.DOUBLE_CLICK)}this.removeTouchFromArr(e,x);i.tar=null;u.recover("TouchData",i)}i=this.getTouchFromArr(e,this.preOvers);if(!i);else{if(h){_=this.getEles(i.tar,null,_);if(_&&_.length>0){this.sendEvents(_,P.MOUSE_OUT)}this.removeTouchFromArr(e,this.preOvers);i.tar=null;u.recover("TouchData",i)}}this._clearTempArrs()}}Ve.I=new Ve;Ve._oldArr=[];Ve._newArr=[];Ve._tEleArr=[];class Ue{constructor(){this.mouseX=0;this.mouseY=0;this.disableMouseEvent=false;this.mouseDownTime=0;this.mouseMoveAccuracy=2;this._event=new P;this._captureSp=null;this._captureChain=[];this._captureExlusiveMode=false;this._hitCaputreSp=false;this._point=new K;this._rect=new R;this._lastMoveTimer=0;this._prePoint=new K;this._touchIDs={};this._curTouchID=NaN;this._id=1}__init__(t,e){this._stage=t;var a=this;e.oncontextmenu=function(t){if(Ue.enabled)return false};e.addEventListener("mousedown",function(t){if(Ue.enabled){if(!N.onIE)t.cancelable&&t.preventDefault();a.mouseDownTime=N.now();a.runEvent(t)}});e.addEventListener("mouseup",function(t){if(Ue.enabled){t.cancelable&&t.preventDefault();a.mouseDownTime=-N.now();a.runEvent(t)}},true);e.addEventListener("mousemove",function(t){if(Ue.enabled){t.cancelable&&t.preventDefault();var e=N.now();if(e-a._lastMoveTimer<10)return;a._lastMoveTimer=e;a.runEvent(t)}},true);e.addEventListener("mouseout",function(t){if(Ue.enabled)a.runEvent(t)});e.addEventListener("mouseover",function(t){if(Ue.enabled)a.runEvent(t)});e.addEventListener("touchstart",function(t){if(Ue.enabled){if(!Ue._isFirstTouch&&!l.isInputting)t.cancelable&&t.preventDefault();a.mouseDownTime=N.now();a.runEvent(t)}});e.addEventListener("touchend",function(t){if(Ue.enabled){if(!Ue._isFirstTouch&&!l.isInputting)t.cancelable&&t.preventDefault();Ue._isFirstTouch=false;a.mouseDownTime=-N.now();a.runEvent(t)}else{a._curTouchID=NaN}},true);e.addEventListener("touchmove",function(t){if(Ue.enabled){t.cancelable&&t.preventDefault();a.runEvent(t)}},true);e.addEventListener("touchcancel",function(t){if(Ue.enabled){t.cancelable&&t.preventDefault();a.runEvent(t)}else{a._curTouchID=NaN}},true);e.addEventListener("mousewheel",function(t){if(Ue.enabled)a.runEvent(t)});e.addEventListener("DOMMouseScroll",function(t){if(Ue.enabled)a.runEvent(t)})}initEvent(t,e=null){var a=this;a._event._stoped=false;a._event.nativeEvent=e||t;a._target=null;this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY);if(this._stage._canvasTransform){this._stage._canvasTransform.invertTransformPoint(this._point);a.mouseX=this._point.x;a.mouseY=this._point.y}a._event.touchId=t.identifier||0;this._tTouchID=a._event.touchId;var i;i=Ve.I._event;i._stoped=false;i.nativeEvent=a._event.nativeEvent;i.touchId=a._event.touchId}checkMouseWheel(t){this._event.delta=t.wheelDelta?t.wheelDelta*.025:-t.detail;var e=Ve.I.getLastOvers();for(var a=0,i=e.length;a<i;a++){var r=e[a];r.event(P.MOUSE_WHEEL,this._event.setTo(P.MOUSE_WHEEL,r,this._target))}}onMouseMove(t){Ve.I.onMouseMove(t,this._tTouchID)}onMouseDown(t){if(l.isInputting&&O.stage.focus&&O.stage.focus["focus"]&&!O.stage.focus.contains(this._target)){var e=O.stage.focus["_tf"]||O.stage.focus;var a=t["_tf"]||t;if(a instanceof l&&a.multiline==e.multiline)e["_focusOut"]();else e.focus=false}Ve.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)}onMouseUp(t){Ve.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)}check(t,e,a,i){this._point.setTo(e,a);t.fromParentPoint(this._point);e=this._point.x;a=this._point.y;var r=t._style.scrollRect;if(r){this._rect.setTo(r.x,r.y,r.width,r.height);if(!this._rect.contains(e,a))return false}if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,a)){return false}for(var s=t._children.length-1;s>-1;s--){var n=t._children[s];if(!n.destroyed&&n._mouseState>1&&n._visible){if(this.check(n,e,a,i))return true}}for(s=t._extUIChild.length-1;s>=0;s--){var o=t._extUIChild[s];if(!o.destroyed&&o._mouseState>1&&o._visible){if(this.check(o,e,a,i))return true}}}var l=t.hitTestPrior&&!t.mouseThrough&&!this.disableMouseEvent?true:this.hitTest(t,e,a);if(l){this._target=t;i.call(this,t);if(this._target==this._hitCaputreSp){this._hitCaputreSp=true}}else if(i===this.onMouseUp&&t===this._stage){this._target=this._stage;i.call(this,this._target)}return l}hitTest(t,e,a){var i=false;if(t.scrollRect){e-=t._style.scrollRect.x;a-=t._style.scrollRect.y}var r=t._style.hitArea;if(r&&r._hit){return r.contains(e,a)}if(t.width>0&&t.height>0||t.mouseThrough||r){if(!t.mouseThrough){i=(r?r:this._rect.setTo(0,0,t.width,t.height)).contains(e,a)}else{i=t.getGraphicBounds().contains(e,a)}}return i}_checkAllBaseUI(t,e,a){var i=this.handleExclusiveCapture(this.mouseX,this.mouseY,a);if(i)return true;i=this.check(this._stage,this.mouseX,this.mouseY,a);return this.handleCapture(this.mouseX,this.mouseY,a)||i}check3DUI(t,e,a){var i=this._stage._3dUI;var r=0;var s=false;for(;r<i.length;r++){var n=i[r];this._stage._curUIBase=n;if(!n.destroyed&&n._mouseState>1&&n._visible){s=s||this.check(n,this.mouseX,this.mouseY,a)}}this._stage._curUIBase=this._stage;return s}handleExclusiveCapture(t,e,a){if(this._captureExlusiveMode&&this._captureSp&&this._captureChain.length>0){var i;this._point.setTo(t,e);for(var r=0;r<this._captureChain.length;r++){i=this._captureChain[r];i.fromParentPoint(this._point)}this._target=i;a.call(this,i);return true}return false}handleCapture(t,e,a){if(!this._hitCaputreSp&&this._captureSp&&this._captureChain.length>0){var i;this._point.setTo(t,e);for(var r=0;r<this._captureChain.length;r++){i=this._captureChain[r];i.fromParentPoint(this._point)}this._target=i;a.call(this,i);return true}return false}runEvent(t){var e,a,i;if(t.type!=="mousemove")this._prePoint.x=this._prePoint.y=-1e6;switch(t.type){case"mousedown":this._touchIDs[0]=this._id++;if(!Ue._isTouchRespond){this._isLeftMouse=t.button===0;this.initEvent(t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown)}else Ue._isTouchRespond=false;break;case"mouseup":this._isLeftMouse=t.button===0;this.initEvent(t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":if(Math.abs(this._prePoint.x-t.clientX)+Math.abs(this._prePoint.y-t.clientY)>=this.mouseMoveAccuracy){this._prePoint.x=t.clientX;this._prePoint.y=t.clientY;this.initEvent(t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove)}break;case"touchstart":Ue._isTouchRespond=true;this._isLeftMouse=true;var r=t.changedTouches;for(e=0,a=r.length;e<a;e++){i=r[e];if(Ue.multiTouchEnabled||isNaN(this._curTouchID)){this._curTouchID=i.identifier;if(this._id%200===0)this._touchIDs={};this._touchIDs[i.identifier]=this._id++;this.initEvent(i,t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown)}}break;case"touchend":case"touchcancel":Ue._isTouchRespond=true;this._isLeftMouse=true;var s=t.changedTouches;for(e=0,a=s.length;e<a;e++){i=s[e];if(Ue.multiTouchEnabled||i.identifier==this._curTouchID){this._curTouchID=NaN;this.initEvent(i,t);var n;n=this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);if(!n){this.onMouseUp(null)}}}break;case"touchmove":var o=t.changedTouches;for(e=0,a=o.length;e<a;e++){i=o[e];if(Ue.multiTouchEnabled||i.identifier==this._curTouchID){this.initEvent(i,t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove)}}break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(t);break;case"mouseout":Ve.I.stageMouseOut();break;case"mouseover":this._stage.event(P.MOUSE_OVER,this._event.setTo(P.MOUSE_OVER,this._stage,this._stage));break}}setCapture(t,e=false){this._captureSp=t;this._captureExlusiveMode=e;this._captureChain.length=0;this._captureChain.push(t);var a=t;while(true){if(a==O.stage)break;if(a==O.stage._curUIBase)break;a=a.parent;if(!a)break;this._captureChain.splice(0,0,a)}}releaseCapture(){console.log("release capture");this._captureSp=null}}Ue.instance=new Ue;Ue.enabled=true;Ue.multiTouchEnabled=true;Ue._isFirstTouch=true;class ke{constructor(){this._pool=[];this._map={};this._laters=[]}_update(){let i=this._laters;let t=i.length;if(t>0){for(let e=0,a=t-1;e<=a;e++){let t=i[e];this._map[t.key]=null;if(t.method!==null){t.run();t.clear()}this._pool.push(t);e===a&&(a=i.length-1)}i.length=0}}_getHandler(t,e){var a=t?t.$_GID||(t.$_GID=O.Utils.getGID()):0;var i=e.$_TID||(e.$_TID=O.Timer._mid++);return this._map[a+"."+i]}callLater(e,a,i=null){if(this._getHandler(e,a)==null){let t;if(this._pool.length)t=this._pool.pop();else t=new Ge;t.caller=e;t.method=a;t.args=i;var r=e?e.$_GID:0;var s=a["$_TID"];t.key=r+"."+s;this._map[t.key]=t;this._laters.push(t)}}runCallLater(t,e){var a=this._getHandler(t,e);if(a&&a.method!=null){this._map[a.key]=null;a.run();a.clear()}}}ke.I=new ke;class Ge{clear(){this.caller=null;this.method=null;this.args=null}run(){var t=this.caller;if(t&&t.destroyed)return this.clear();var e=this.method;var a=this.args;if(e==null)return;a?e.apply(t,a):e.call(t)}}class He{}He.createShaderCondition=function(t){var e="(function() {return "+t+";})";return window.Laya._runScript(e)};He.changeWebGLSize=function(t,e){pe.onStageResize(t,e)};class S extends Be{constructor(){super();this.offset=new K;this._frameRate="fast";this.designWidth=0;this.designHeight=0;this.canvasRotation=false;this.canvasDegree=0;this.renderingEnabled=true;this.screenAdaptationEnabled=true;this._canvasTransform=new L;this._screenMode="none";this._scaleMode="noscale";this._alignV="top";this._alignH="left";this._bgColor="black";this._mouseMoveTime=0;this._renderCount=0;this._safariOffsetY=0;this._frameStartTime=0;this._previousOrientation=N.window.orientation;this._wgColor=[0,0,0,1];this._scene3Ds=[];this._globalRepaintSet=false;this._globalRepaintGet=false;this._3dUI=[];this._curUIBase=null;this.useRetinalCanvas=false;super.set_transform(this._createTransform());this.mouseEnabled=true;this.hitTestPrior=true;this.autoSize=false;this._setBit(b.DISPLAYED_INSTAGE,true);this._setBit(b.ACTIVE_INHIERARCHY,true);this._isFocused=true;this._isVisibility=true;this.useRetinalCanvas=n.useRetinalCanvas;var t=N.window;t.addEventListener("focus",()=>{this._isFocused=true;this.event(P.FOCUS);this.event(P.FOCUS_CHANGE)});t.addEventListener("blur",()=>{this._isFocused=false;this.event(P.BLUR);this.event(P.FOCUS_CHANGE);if(this._isInputting())l["inputElement"].target.focus=false});var e="visibilityState",a="visibilitychange";var i=t.document;if(typeof i.hidden!=="undefined"){a="visibilitychange";e="visibilityState"}else if(typeof i.mozHidden!=="undefined"){a="mozvisibilitychange";e="mozVisibilityState"}else if(typeof i.msHidden!=="undefined"){a="msvisibilitychange";e="msVisibilityState"}else if(typeof i.webkitHidden!=="undefined"){a="webkitvisibilitychange";e="webkitVisibilityState"}t.document.addEventListener(a,()=>{if(N.document[e]=="hidden"){this._isVisibility=false;if(this._isInputting())l["inputElement"].target.focus=false}else{this._isVisibility=true}this.renderingEnabled=this._isVisibility;this.event(P.VISIBILITY_CHANGE)});t.addEventListener("resize",()=>{var t=N.window.orientation;if(t!=null&&t!=this._previousOrientation&&this._isInputting()){l["inputElement"].target.focus=false}this._previousOrientation=t;if(this._isInputting())return;if(N.onSafari)this._safariOffsetY=(N.window.__innerHeight||N.document.body.clientHeight||N.document.documentElement.clientHeight)-N.window.innerHeight;this._resetCanvas()});t.addEventListener("orientationchange",t=>{this._resetCanvas()});this.on(P.MOUSE_MOVE,this,this._onmouseMove);if(N.onMobile)this.on(P.MOUSE_DOWN,this,this._onmouseMove)}_isInputting(){return N.onMobile&&l.isInputting}set width(t){this.designWidth=t;super.set_width(t);O.systemTimer.callLater(this,this._changeCanvasSize)}get width(){return super.get_width()}set height(t){this.designHeight=t;super.set_height(t);O.systemTimer.callLater(this,this._changeCanvasSize)}get height(){return super.get_height()}set transform(t){super.set_transform(t)}get transform(){if(this._tfChanged)this._adjustTransform();return this._transform=this._transform||this._createTransform()}get isFocused(){return this._isFocused}get isVisibility(){return this._isVisibility}_changeCanvasSize(){this.setScreenSize(N.clientWidth*N.pixelRatio,N.clientHeight*N.pixelRatio)}_resetCanvas(){if(!this.screenAdaptationEnabled)return;this._changeCanvasSize()}setScreenSize(t,e){var a=false;if(this._screenMode!==S.SCREEN_NONE){var i=t/e<1?S.SCREEN_VERTICAL:S.SCREEN_HORIZONTAL;a=i!==this._screenMode;if(a){var r=e;e=t;t=r}}this.canvasRotation=a;var s=m._mainCanvas;var n=s.source.style;var o=this._canvasTransform.identity();var l=this._scaleMode;var _=t/this.designWidth;var h=e/this.designHeight;var x=this.useRetinalCanvas?t:this.designWidth;var c=this.useRetinalCanvas?e:this.designHeight;var d=t;var u=e;var f=N.pixelRatio;this._width=this.designWidth;this._height=this.designHeight;switch(l){case S.SCALE_NOSCALE:_=h=1;d=this.designWidth;u=this.designHeight;break;case S.SCALE_SHOWALL:_=h=Math.min(_,h);x=d=Math.round(this.designWidth*_);c=u=Math.round(this.designHeight*h);break;case S.SCALE_NOBORDER:_=h=Math.max(_,h);d=Math.round(this.designWidth*_);u=Math.round(this.designHeight*h);break;case S.SCALE_FULL:_=h=1;this._width=x=t;this._height=c=e;break;case S.SCALE_FIXED_WIDTH:h=_;this._height=c=Math.round(e/_);break;case S.SCALE_FIXED_HEIGHT:_=h;this._width=x=Math.round(t/h);break;case S.SCALE_FIXED_AUTO:if(t/e<this.designWidth/this.designHeight){h=_;this._height=c=Math.round(e/_)}else{_=h;this._width=x=Math.round(t/h)}break}if(this.useRetinalCanvas){d=x=t;u=c=e}_*=this.scaleX;h*=this.scaleY;if(_===1&&h===1){this.transform.identity()}else{this.transform.a=this._formatData(_/(d/x));this.transform.d=this._formatData(h/(u/c))}s.size(x,c);He.changeWebGLSize(x,c);o.scale(d/x/f,u/c/f);if(this._alignH===S.ALIGN_LEFT)this.offset.x=0;else if(this._alignH===S.ALIGN_RIGHT)this.offset.x=t-d;else this.offset.x=(t-d)*.5/f;if(this._alignV===S.ALIGN_TOP)this.offset.y=0;else if(this._alignV===S.ALIGN_BOTTOM)this.offset.y=e-u;else this.offset.y=(e-u)*.5/f;this.offset.x=Math.round(this.offset.x);this.offset.y=Math.round(this.offset.y);o.translate(this.offset.x,this.offset.y);if(this._safariOffsetY)o.translate(0,this._safariOffsetY);this.canvasDegree=0;if(a){if(this._screenMode===S.SCREEN_HORIZONTAL){o.rotate(Math.PI/2);o.translate(e/f,0);this.canvasDegree=90}else{o.rotate(-Math.PI/2);o.translate(0,t/f);this.canvasDegree=-90}}o.a=this._formatData(o.a);o.d=this._formatData(o.d);o.tx=this._formatData(o.tx);o.ty=this._formatData(o.ty);super.set_transform(this.transform);n.transformOrigin=n.webkitTransformOrigin=n.msTransformOrigin=n.mozTransformOrigin=n.oTransformOrigin="0px 0px 0px";n.transform=n.webkitTransform=n.msTransform=n.mozTransform=n.oTransform="matrix("+o.toString()+")";n.width=x;n.height=c;if(this._safariOffsetY)o.translate(0,-this._safariOffsetY);o.translate(parseInt(n.left)||0,parseInt(n.top)||0);this.visible=true;this._repaint|=T.REPAINT_CACHE;this.event(P.RESIZE)}_formatData(t){if(Math.abs(t)<1e-6)return 0;if(Math.abs(1-t)<.001)return t>0?1:-1;return t}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode=t;O.systemTimer.callLater(this,this._changeCanvasSize)}get alignH(){return this._alignH}set alignH(t){this._alignH=t;O.systemTimer.callLater(this,this._changeCanvasSize)}get alignV(){return this._alignV}set alignV(t){this._alignV=t;O.systemTimer.callLater(this,this._changeCanvasSize)}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t;if(t)this._wgColor=ut.create(t).arrColor;else this._wgColor=null;if(t){m.canvas.style.background=t}else{m.canvas.style.background="none"}}get mouseX(){return Math.round(Ue.instance.mouseX/this.clientScaleX)}get mouseY(){return Math.round(Ue.instance.mouseY/this.clientScaleY)}getMousePoint(){return K.TEMP.setTo(this.mouseX,this.mouseY)}get clientScaleX(){return this._transform?this._transform.getScaleX():1}get clientScaleY(){return this._transform?this._transform.getScaleY():1}get screenMode(){return this._screenMode}set screenMode(t){this._screenMode=t}repaint(t=T.REPAINT_CACHE){this._repaint|=t}parentRepaint(t=T.REPAINT_CACHE){}_loop(){this._globalRepaintGet=this._globalRepaintSet;this._globalRepaintSet=false;this.render(m._context,0,0);return true}getFrameTm(){return this._frameStartTime}_onmouseMove(t){this._mouseMoveTime=N.now()}getTimeFromFrameStart(){return N.now()-this._frameStartTime}set visible(t){if(this.visible!==t){super.set_visible(t);var e=m._mainCanvas.source.style;e.visibility=t?"visible":"hidden"}}get visible(){return super.visible}render(t,e,a){if(window.conch){this.renderToNative(t,e,a);return}if(this._frameRate===S.FRAME_SLEEP){var i=N.now();if(i-this._frameStartTime>=1e3)this._frameStartTime=i;else return}else{if(!this._visible){this._renderCount++;if(this._renderCount%5===0){ke.I._update();g.loopCount++;Nt.loopCount=g.loopCount;this._updateTimers()}return}this._frameStartTime=N.now();Nt.loopStTm=this._frameStartTime}this._renderCount++;var r=this._frameRate===S.FRAME_MOUSE?this._frameStartTime-this._mouseMoveTime<2e3?S.FRAME_FAST:S.FRAME_SLOW:this._frameRate;var s=r!==S.FRAME_SLOW;var n=this._renderCount%2===0;g.renderSlow=!s;if(!s&&!n)return;ke.I._update();g.loopCount++;Nt.loopCount=g.loopCount;if(this.renderingEnabled){for(var o=0,l=this._scene3Ds.length;o<l;o++)this._scene3Ds[o]._update();t.clear();super.render(t,e,a);g._StatRender.renderNotCanvas(t,e,a)}if(this.renderingEnabled){S.clear(this._bgColor);t.flush();Re.instance&&Re.getInstance().endDispose()}this._updateTimers()}renderToNative(t,e,a){this._renderCount++;if(!this._visible){if(this._renderCount%5===0){ke.I._update();g.loopCount++;Nt.loopCount=g.loopCount;this._updateTimers()}return}ke.I._update();g.loopCount++;Nt.loopCount=g.loopCount;if(this.renderingEnabled){for(var i=0,r=this._scene3Ds.length;i<r;i++)this._scene3Ds[i]._update();t.clear();super.render(t,e,a);g._StatRender.renderNotCanvas(t,e,a)}if(this.renderingEnabled){S.clear(this._bgColor);t.flush();Re.instance&&Re.getInstance().endDispose()}this._updateTimers()}_updateTimers(){O.systemTimer._update();O.startTimer._update();O.physicsTimer._update();O.updateTimer._update();O.lateTimer._update();O.timer._update()}set fullScreenEnabled(t){var e=N.document;var a=m.canvas;if(t){a.addEventListener("mousedown",this._requestFullscreen);a.addEventListener("touchstart",this._requestFullscreen);e.addEventListener("fullscreenchange",this._fullScreenChanged);e.addEventListener("mozfullscreenchange",this._fullScreenChanged);e.addEventListener("webkitfullscreenchange",this._fullScreenChanged);e.addEventListener("msfullscreenchange",this._fullScreenChanged)}else{a.removeEventListener("mousedown",this._requestFullscreen);a.removeEventListener("touchstart",this._requestFullscreen);e.removeEventListener("fullscreenchange",this._fullScreenChanged);e.removeEventListener("mozfullscreenchange",this._fullScreenChanged);e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged);e.removeEventListener("msfullscreenchange",this._fullScreenChanged)}}get frameRate(){if(!O.Render.isConchApp){return this._frameRate}else{return this._frameRateNative}}set frameRate(t){if(!O.Render.isConchApp){this._frameRate=t}else{var e=window.conch;switch(t){case S.FRAME_FAST:e.config.setLimitFPS(60);break;case S.FRAME_MOUSE:e.config.setMouseFrame(2e3);break;case S.FRAME_SLOW:e.config.setSlowFrame(true);break;case S.FRAME_SLEEP:e.config.setLimitFPS(1);break}this._frameRateNative=t}}_requestFullscreen(){var t=N.document.documentElement;if(t.requestFullscreen){t.requestFullscreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.webkitRequestFullscreen){t.webkitRequestFullscreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}}_fullScreenChanged(){O.stage.event(P.FULL_SCREEN_CHANGE)}exitFullscreen(){var t=N.document;if(t.exitFullscreen){t.exitFullscreen()}else if(t.mozCancelFullScreen){t.mozCancelFullScreen()}else if(t.webkitExitFullscreen){t.webkitExitFullscreen()}}isGlobalRepaint(){return this._globalRepaintGet}setGlobalRepaint(){this._globalRepaintSet=true}add3DUI(t){var e=t.rootView;if(this._3dUI.indexOf(e)>=0)return;this._3dUI.push(e)}remove3DUI(t){var e=t.rootView;var a=this._3dUI.indexOf(e);if(a>=0){this._3dUI.splice(a,1);return true}return false}}S.SCALE_NOSCALE="noscale";S.SCALE_EXACTFIT="exactfit";S.SCALE_SHOWALL="showall";S.SCALE_NOBORDER="noborder";S.SCALE_FULL="full";S.SCALE_FIXED_WIDTH="fixedwidth";S.SCALE_FIXED_HEIGHT="fixedheight";S.SCALE_FIXED_AUTO="fixedauto";S.ALIGN_LEFT="left";S.ALIGN_RIGHT="right";S.ALIGN_CENTER="center";S.ALIGN_TOP="top";S.ALIGN_MIDDLE="middle";S.ALIGN_BOTTOM="bottom";S.SCREEN_NONE="none";S.SCREEN_HORIZONTAL="horizontal";S.SCREEN_VERTICAL="vertical";S.FRAME_FAST="fast";S.FRAME_SLOW="slow";S.FRAME_MOUSE="mouse";S.FRAME_SLEEP="sleep";S.clear=function(t){W.set2DRenderConfig();var e=f.instance;_.worldScissorTest&&e.disable(e.SCISSOR_TEST);var a=m.context;var i=a._submits._length==0||n.preserveDrawingBuffer?ut.create(t).arrColor:O.stage._wgColor;if(i)a.clearBG(i[0],i[1],i[2],i[3]);else a.clearBG(0,0,0,0);_.clear()};d.regClass("laya.display.Stage",S);d.regClass("Laya.Stage",S);class ze{static __init__(){ze._addEvent("keydown");ze._addEvent("keypress");ze._addEvent("keyup")}static _addEvent(e){O.Browser.document.addEventListener(e,function(t){ze._dispatch(t,e)},true)}static _dispatch(t,e){if(!ze.enabled)return;ze._event._stoped=false;ze._event.nativeEvent=t;ze._event.keyCode=t.keyCode||t.which||t.charCode;if(e==="keydown")ze._pressKeys[ze._event.keyCode]=true;else if(e==="keyup")ze._pressKeys[ze._event.keyCode]=null;var a=O.stage.focus&&O.stage.focus.event!=null&&O.stage.focus.displayedInStage?O.stage.focus:O.stage;var i=a;while(i){i.event(e,ze._event.setTo(e,i,a));i=i.parent}}static hasKeyDown(t){return ze._pressKeys[t]}}ze._pressKeys={};ze.enabled=true;ze._event=new P;class We extends e{constructor(){super(...arguments);this.isStopped=false}set volume(t){}get volume(){return 1}get position(){return 0}get duration(){return 0}play(){}stop(){if(this.completeHandler)this.completeHandler.runWith(false)}pause(){}resume(){}__runComplete(t){if(t){t.runWith(true)}}}class Xe extends We{constructor(t){super();this._audio=null;this._onEnd=this.__onEnd.bind(this);this._resumePlay=this.__resumePlay.bind(this);t.addEventListener("ended",this._onEnd);this._audio=t}__onEnd(t){if(this.loops==1){if(this.completeHandler){O.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null}this.stop();this.event(P.COMPLETE);return}if(this.loops>0){this.loops--}this.startTime=0;this.play()}__resumePlay(){if(this._audio)this._audio.removeEventListener("canplay",this._resumePlay);if(this.isStopped)return;try{this._audio.currentTime=this.startTime;N.container.appendChild(this._audio);this._audio.play()}catch(t){this.event(P.ERROR)}}play(){this.isStopped=false;try{this._audio.playbackRate=O.SoundManager.playbackRate;this._audio.currentTime=this.startTime}catch(t){this._audio.addEventListener("canplay",this._resumePlay);return}O.SoundManager.addChannel(this);N.container.appendChild(this._audio);if("play"in this._audio)this._audio.play()}get position(){if(!this._audio)return 0;return this._audio.currentTime}get duration(){if(!this._audio)return 0;return this._audio.duration}stop(){super.stop();this.isStopped=true;O.SoundManager.removeChannel(this);this.completeHandler=null;if(!this._audio)return;if("pause"in this._audio)if(O.Render.isConchApp){this._audio.stop()}this._audio.pause();this._audio.removeEventListener("ended",this._onEnd);this._audio.removeEventListener("canplay",this._resumePlay);if(!O.Browser.onIE){if(this._audio!=O.AudioSound._musicAudio){O.Pool.recover("audio:"+this.url,this._audio)}}N.removeElement(this._audio);this._audio=null;if(O.SoundManager.autoReleaseSound)O.SoundManager.disposeSoundLater(this.url)}pause(){this.isStopped=true;O.SoundManager.removeChannel(this);if("pause"in this._audio)this._audio.pause();if(O.SoundManager.autoReleaseSound)O.SoundManager.disposeSoundLater(this.url)}resume(){var t=this._audio;if(!t)return;this.isStopped=false;if(t.readyState==0){t.src=this.url;t.addEventListener("canplay",this._resumePlay);t.load()}O.SoundManager.addChannel(this);if("play"in t){t.play()}}set volume(t){if(!this._audio)return;this._audio.volume=t}get volume(){if(!this._audio)return 1;return this._audio.volume}}class Ye extends e{constructor(){super(...arguments);this.loaded=false}dispose(){var t=Ye._audioCache[this.url];u.clearBySign("audio:"+this.url);if(t){if(!m.isConchApp){t.src=""}delete Ye._audioCache[this.url]}}static _initMusicAudio(){if(Ye._musicAudio)return;if(!Ye._musicAudio)Ye._musicAudio=N.createElement("audio");if(!m.isConchApp){N.document.addEventListener("mousedown",Ye._makeMusicOK)}}static _makeMusicOK(){N.document.removeEventListener("mousedown",Ye._makeMusicOK);if(!Ye._musicAudio.src){Ye._musicAudio.src="";Ye._musicAudio.load()}else{Ye._musicAudio.play()}}load(t){t=I.formatURL(t);let e=t.replace(I._basePath,"");if(window.fileObj[e]){t=window.fileObj[e]}this.url=t;var a;if(t==O.SoundManager._bgMusic){Ye._initMusicAudio();a=Ye._musicAudio;if(a.src!=t){Ye._audioCache[a.src]=null;a=null}}else{a=Ye._audioCache[t]}if(a&&a.readyState>=2){this.event(P.COMPLETE);return}if(!a){if(t==O.SoundManager._bgMusic){Ye._initMusicAudio();a=Ye._musicAudio}else{a=N.createElement("audio")}Ye._audioCache[t]=a;a.src=t}a.addEventListener("canplaythrough",r);a.addEventListener("error",s);var i=this;function r(){n();i.loaded=true;i.event(P.COMPLETE)}function s(){a.load=null;n();i.event(P.ERROR)}function n(){a.removeEventListener("canplaythrough",r);a.removeEventListener("error",s)}this.audio=a;if(a.load){a.load()}else{s()}}play(t=0,e=0){if(!this.url)return null;var a;if(this.url==O.SoundManager._bgMusic){a=Ye._musicAudio}else{a=Ye._audioCache[this.url]}if(!a)return null;var i;i=u.getItem("audio:"+this.url);if(m.isConchApp){if(!i){i=N.createElement("audio");i.src=this.url}}else{if(this.url==O.SoundManager._bgMusic){Ye._initMusicAudio();i=Ye._musicAudio;i.src=this.url}else{i=i?i:a.cloneNode(true)}}var r=new Xe(i);r.url=this.url;r.loops=e;r.startTime=t;r.play();O.SoundManager.addChannel(r);return r}get duration(){var t;t=Ye._audioCache[this.url];if(!t)return 0;return t.duration}}Ye._audioCache={};class je extends We{constructor(){super();this.bufferSource=null;this._currentTime=0;this._volume=1;this._startTime=0;this._pauseTime=0;this.context=O.WebAudioSound.ctx;this._onPlayEnd=w.bind(this.__onPlayEnd,this);if(this.context["createGain"]){this.gain=this.context["createGain"]()}else{this.gain=this.context["createGainNode"]()}}play(){O.SoundManager.addChannel(this);this.isStopped=false;this._clearBufferSource();if(!this.audioBuffer)return;if(this.startTime>=this.duration)return stop();var t=this.context;var e=this.gain;var a=t.createBufferSource();this.bufferSource=a;a.buffer=this.audioBuffer;a.connect(e);if(e)e.disconnect();e.connect(t.destination);a.onended=this._onPlayEnd;this._startTime=N.now();if(this.gain.gain.setTargetAtTime){this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,je.SetTargetDelay)}else this.gain.gain.value=this._volume;if(this.loops==0){a.loop=true}if(a.playbackRate.setTargetAtTime){a.playbackRate.setTargetAtTime(O.SoundManager.playbackRate,this.context.currentTime,je.SetTargetDelay)}else a.playbackRate.value=O.SoundManager.playbackRate;a.start(0,this.startTime);this._currentTime=0}__onPlayEnd(){if(this.loops==1){if(this.completeHandler){O.timer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null}this.stop();this.event(P.COMPLETE);return}if(this.loops>0){this.loops--}this.startTime=0;this.play()}get position(){if(this.bufferSource){return(N.now()-this._startTime)/1e3+this.startTime}return 0}get duration(){if(this.audioBuffer){return this.audioBuffer.duration}return 0}_clearBufferSource(){if(this.bufferSource){var t=this.bufferSource;if(t.stop){t.stop(0)}else{t.noteOff(0)}t.disconnect(0);t.onended=null;if(!je._tryCleanFailed)this._tryClearBuffer(t);this.bufferSource=null}}_tryClearBuffer(t){try{t.buffer=null}catch(t){je._tryCleanFailed=true}}stop(){super.stop();this._clearBufferSource();this.audioBuffer=null;if(this.gain)this.gain.disconnect();this.isStopped=true;O.SoundManager.removeChannel(this);this.completeHandler=null;if(O.SoundManager.autoReleaseSound)O.SoundManager.disposeSoundLater(this.url)}pause(){if(!this.isStopped){this._pauseTime=this.position}this._clearBufferSource();if(this.gain)this.gain.disconnect();this.isStopped=true;O.SoundManager.removeChannel(this);if(O.SoundManager.autoReleaseSound)O.SoundManager.disposeSoundLater(this.url)}resume(){this.startTime=this._pauseTime;this.play()}set volume(t){this._volume=t;if(this.isStopped){return}if(this.gain.gain.setTargetAtTime){this.gain.gain.setTargetAtTime(t,this.context.currentTime,je.SetTargetDelay)}else this.gain.gain.value=t}get volume(){return this._volume}}je._tryCleanFailed=false;je.SetTargetDelay=.001;class r extends e{constructor(){super(...arguments);this.loaded=false;this._disposed=false}static decode(){if(r.buffs.length<=0||r.isDecoding){return}r.isDecoding=true;r.tInfo=r.buffs.shift();r.ctx.decodeAudioData(r.tInfo["buffer"],r._done,r._fail)}static _done(t){r.e.event("loaded:"+r.tInfo.url,t);r.isDecoding=false;r.decode()}static _fail(){r.e.event("err:"+r.tInfo.url,null);r.isDecoding=false;r.decode()}static _playEmptySound(){if(r.ctx==null){return}var t=r.ctx.createBufferSource();t.buffer=r._miniBuffer;t.connect(r.ctx.destination);t.start(0,0,0)}static _unlock(){if(r._unlocked){return}r._playEmptySound();if(r.ctx.state=="running"){window.document.removeEventListener("mousedown",r._unlock,true);window.document.removeEventListener("touchend",r._unlock,true);window.document.removeEventListener("touchstart",r._unlock,true);r._unlocked=true}}static initWebAudio(){if(r.ctx.state!="running"){r._unlock();window.document.addEventListener("mousedown",r._unlock,true);window.document.addEventListener("touchend",r._unlock,true);window.document.addEventListener("touchstart",r._unlock,true)}}load(t){var e=this;t=I.formatURL(t);let a=t.replace(I._basePath,"");if(window.fileObj[a]){t=window.fileObj[a]}this.url=t;this.audioBuffer=r._dataCache[t];if(this.audioBuffer){this._loaded(this.audioBuffer);return}r.e.on("loaded:"+t,this,this._loaded);r.e.on("err:"+t,this,this._err);if(r.__loadingSound[t]){return}r.__loadingSound[t]=true;var i=new XMLHttpRequest;i.open("GET",t,true);i.responseType="arraybuffer";i.onload=function(){if(e._disposed){e._removeLoadEvents();return}e.data=i.response;r.buffs.push({buffer:e.data,url:e.url});r.decode()};i.onerror=function(t){e._err()};i.send()}_err(){this._removeLoadEvents();r.__loadingSound[this.url]=false;this.event(P.ERROR)}_loaded(t){this._removeLoadEvents();if(this._disposed){return}this.audioBuffer=t;r._dataCache[this.url]=this.audioBuffer;this.loaded=true;this.event(P.COMPLETE)}_removeLoadEvents(){r.e.off("loaded:"+this.url,this,this._loaded);r.e.off("err:"+this.url,this,this._err)}__playAfterLoaded(){if(!this.__toPlays)return;var t,e;var a;a=this.__toPlays;e=a.length;var i;for(t=0;t<e;t++){i=a[t];if(i[2]&&!i[2].isStopped){this.play(i[0],i[1],i[2])}}this.__toPlays.length=0}play(t=0,e=0,a=null){a=a?a:new je;if(!this.audioBuffer){if(this.url){if(!this.__toPlays)this.__toPlays=[];this.__toPlays.push([t,e,a]);this.once(P.COMPLETE,this,this.__playAfterLoaded);this.load(this.url)}}a.url=this.url;a.loops=e;a.audioBuffer=this.audioBuffer;a.startTime=t;a.play();O.SoundManager.addChannel(a);return a}get duration(){if(this.audioBuffer){return this.audioBuffer.duration}return 0}dispose(){this._disposed=true;delete r._dataCache[this.url];delete r.__loadingSound[this.url];this.audioBuffer=null;this.data=null;this.__toPlays=[]}}r._dataCache={};r.webAudioEnabled=window["AudioContext"]||window["webkitAudioContext"]||window["mozAudioContext"];r.ctx=r.webAudioEnabled?new(window["AudioContext"]||window["webkitAudioContext"]||window["mozAudioContext"]):undefined;r.buffs=[];r.isDecoding=false;r._miniBuffer=r.ctx?r.ctx.createBuffer(1,1,22050):undefined;r.e=new e;r._unlocked=false;r.__loadingSound={};class h{static __init__(){var t=O.Browser.window;var e=t["AudioContext"]||t["webkitAudioContext"]||t["mozAudioContext"]?true:false;if(e)r.initWebAudio();h._soundClass=e?r:Ye;Ye._initMusicAudio();h._musicClass=Ye;return e}static addChannel(t){if(h._channels.indexOf(t)>=0)return;h._channels.push(t)}static removeChannel(t){var e;for(e=h._channels.length-1;e>=0;e--){if(h._channels[e]==t){h._channels.splice(e,1)}}}static disposeSoundLater(t){h._lastSoundUsedTimeDic[t]=O.Browser.now();if(!h._isCheckingDispose){h._isCheckingDispose=true;O.timer.loop(5e3,null,h._checkDisposeSound)}}static _checkDisposeSound(){var t;var e=O.Browser.now();var a=false;for(t in h._lastSoundUsedTimeDic){if(e-h._lastSoundUsedTimeDic[t]>3e4){delete h._lastSoundUsedTimeDic[t];h.disposeSoundIfNotUsed(t)}else{a=true}}if(!a){h._isCheckingDispose=false;O.timer.clear(null,h._checkDisposeSound)}}static disposeSoundIfNotUsed(t){var e;for(e=h._channels.length-1;e>=0;e--){if(h._channels[e].url==t){return}}h.destroySound(t)}static set autoStopMusic(t){O.stage.off(P.BLUR,null,h._stageOnBlur);O.stage.off(P.FOCUS,null,h._stageOnFocus);O.stage.off(P.VISIBILITY_CHANGE,null,h._visibilityChange);h._autoStopMusic=t;if(t){O.stage.on(P.BLUR,null,h._stageOnBlur);O.stage.on(P.FOCUS,null,h._stageOnFocus);O.stage.on(P.VISIBILITY_CHANGE,null,h._visibilityChange)}}static get autoStopMusic(){return h._autoStopMusic}static _visibilityChange(){if(O.stage.isVisibility){h._stageOnFocus()}else{h._stageOnBlur()}}static _stageOnBlur(){h._isActive=false;if(h._musicChannel){if(!h._musicChannel.isStopped){h._blurPaused=true;h._musicChannel.pause()}}h.stopAllSound();O.stage.once(P.MOUSE_DOWN,null,h._stageOnFocus)}static _recoverWebAudio(){if(r.ctx&&r.ctx.state!="running"&&r.ctx.resume)r.ctx.resume()}static _stageOnFocus(){h._isActive=true;h._recoverWebAudio();O.stage.off(P.MOUSE_DOWN,null,h._stageOnFocus);if(h._blurPaused){if(h._musicChannel&&h._musicChannel.isStopped){h._blurPaused=false;h._musicChannel.resume()}}}static set muted(t){if(t==h._muted)return;if(t){h.stopAllSound()}h.musicMuted=t;h._muted=t}static get muted(){return h._muted}static set soundMuted(t){h._soundMuted=t}static get soundMuted(){return h._soundMuted}static set musicMuted(t){if(t==h._musicMuted)return;if(t){if(h._bgMusic){if(h._musicChannel&&!h._musicChannel.isStopped){if(O.Render.isConchApp){if(h._musicChannel._audio)h._musicChannel._audio.muted=true}else{h._musicChannel.pause()}}else{h._musicChannel=null}}else{h._musicChannel=null}h._musicMuted=t}else{h._musicMuted=t;if(h._bgMusic){if(h._musicChannel){if(O.Render.isConchApp){if(h._musicChannel._audio)h._musicChannel._audio.muted=false}else{h._musicChannel.resume()}}}}}static get musicMuted(){return h._musicMuted}static get useAudioMusic(){return h._useAudioMusic}static set useAudioMusic(t){h._useAudioMusic=t;if(t){h._musicClass=Ye}else{h._musicClass=null}}static playSound(t,e=1,a=null,i=null,r=0){if(!h._isActive||!t)return null;if(h._muted)return null;h._recoverWebAudio();t=I.formatURL(t);if(t==h._bgMusic){if(h._musicMuted)return null}else{if(O.Render.isConchApp){var s=w.getFileExtension(t);if(s!="wav"&&s!="ogg"){alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document.");return null}}if(h._soundMuted)return null}var n;if(!O.Browser.onBDMiniGame&&!O.Browser.onMiniGame&&!O.Browser.onKGMiniGame&&!O.Browser.onQGMiniGame&&!O.Browser.onVVMiniGame&&!O.Browser.onAlipayMiniGame&&!O.Browser.onQQMiniGame&&!O.Browser.onBLMiniGame&&!O.Browser.onTTMiniGame&&!O.Browser.onHWMiniGame&&!O.Browser.onTBMiniGame){n=O.loader.getRes(t)}if(!i)i=h._soundClass;if(!n){n=new i;n.load(t);if(!O.Browser.onBDMiniGame&&!O.Browser.onMiniGame&&!O.Browser.onKGMiniGame&&!O.Browser.onQGMiniGame&&!O.Browser.onVVMiniGame&&!O.Browser.onAlipayMiniGame&&!O.Browser.onQQMiniGame&&!O.Browser.onBLMiniGame&&!O.Browser.onTTMiniGame&&!O.Browser.onHWMiniGame&&!O.Browser.onTBMiniGame){O.Loader.cacheRes(t,n)}}var o;o=n.play(r,e);if(!o)return null;o.url=t;o.volume=t==h._bgMusic?h.musicVolume:h.soundVolume;o.completeHandler=a;return o}static destroySound(t){var e=O.loader.getRes(t);if(e){O.Loader.clearRes(t);e.dispose()}}static playMusic(t,e=0,a=null,i=0){t=I.formatURL(t);h._bgMusic=t;if(h._musicChannel)h._musicChannel.stop();return h._musicChannel=h.playSound(t,e,a,h._musicClass,i)}static stopSound(t){t=I.formatURL(t);var e;var a;for(e=h._channels.length-1;e>=0;e--){a=h._channels[e];if(a.url==t){a.stop()}}}static stopAll(){h._bgMusic=null;var t;var e;for(t=h._channels.length-1;t>=0;t--){e=h._channels[t];e.stop()}}static stopAllSound(){var t;var e;for(t=h._channels.length-1;t>=0;t--){e=h._channels[t];if(e.url!=h._bgMusic){e.stop()}}}static stopMusic(){if(h._musicChannel)h._musicChannel.stop();h._bgMusic=null}static setSoundVolume(t,e=null){if(e){e=I.formatURL(e);h._setVolume(e,t)}else{h.soundVolume=t;var a;var i;for(a=h._channels.length-1;a>=0;a--){i=h._channels[a];if(i.url!=h._bgMusic){i.volume=t}}}}static setMusicVolume(t){h.musicVolume=t;h._setVolume(h._bgMusic,t)}static _setVolume(t,e){t=I.formatURL(t);var a;var i;for(a=h._channels.length-1;a>=0;a--){i=h._channels[a];if(i.url==t){i.volume=e}}}}h.musicVolume=1;h.soundVolume=1;h.playbackRate=1;h._useAudioMusic=true;h._muted=false;h._soundMuted=false;h._musicMuted=false;h._bgMusic=null;h._musicChannel=null;h._channels=[];h._blurPaused=false;h._isActive=true;h._lastSoundUsedTimeDic={};h._isCheckingDispose=false;h.autoReleaseSound=true;class qe{create(){if(this.json)return O.SceneUtils.createByData(null,this.json);return null}}class Ze{constructor(){this._fontCharDic={};this._fontWidthMap={};this._maxWidth=0;this._spaceWidth=10;this.fontSize=12;this.autoScaleSize=false;this.letterSpacing=0}loadFont(t,e){this._path=t;this._complete=e;if(!t||t.indexOf(".fnt")===-1){console.error('Bitmap font configuration information must be a ".fnt" file');return}O.loader.load([{url:t,type:O.Loader.XML},{url:t.replace(".fnt",".png"),type:O.Loader.IMAGE}],Q.create(this,this._onLoaded))}_onLoaded(){this.parseFont(O.Loader.getRes(this._path),O.Loader.getRes(this._path.replace(".fnt",".png")));this._complete&&this._complete.run()}parseFont(t,e){if(t==null||e==null)return;this._texture=e;var a=1;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode){return this.parseFont2(t,e)}this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var r=i[0].getAttributeNode("padding").nodeValue;var s=r.split(",");this._padding=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];var n=t.getElementsByTagName("char");var o=0;for(o=0;o<n.length;o++){var l=n[o];var _=parseInt(l.getAttributeNode("id").nodeValue);var h=parseInt(l.getAttributeNode("xoffset").nodeValue)/a;var x=parseInt(l.getAttributeNode("yoffset").nodeValue)/a;var c=parseInt(l.getAttributeNode("xadvance").nodeValue)/a;var d=new R;d.x=parseInt(l.getAttributeNode("x").nodeValue);d.y=parseInt(l.getAttributeNode("y").nodeValue);d.width=parseInt(l.getAttributeNode("width").nodeValue);d.height=parseInt(l.getAttributeNode("height").nodeValue);var u=le.create(e,d.x,d.y,d.width,d.height,h,x);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing);this._fontCharDic[_]=u;this._fontWidthMap[_]=c}}parseFont2(t,e){if(t==null||e==null)return;this._texture=e;var a=1;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes["size"].nodeValue);var r=i[0].attributes["padding"].nodeValue;var s=r.split(",");this._padding=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];var n=t.getElementsByTagName("char");var o=0;for(o=0;o<n.length;o++){var l=n[o].attributes;var _=parseInt(l["id"].nodeValue);var h=parseInt(l["xoffset"].nodeValue)/a;var x=parseInt(l["yoffset"].nodeValue)/a;var c=parseInt(l["xadvance"].nodeValue)/a;var d=new R;d.x=parseInt(l["x"].nodeValue);d.y=parseInt(l["y"].nodeValue);d.width=parseInt(l["width"].nodeValue);d.height=parseInt(l["height"].nodeValue);var u=le.create(e,d.x,d.y,d.width,d.height,h,x);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing);this._fontCharDic[_]=u;this._fontWidthMap[_]=c}}getCharTexture(t){return this._fontCharDic[t.charCodeAt(0)]}destroy(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];if(e)e.destroy()}this._texture.destroy();this._fontCharDic=null;this._fontWidthMap=null;this._texture=null;this._complete=null;this._padding=null}}setSpaceWidth(t){this._spaceWidth=t}getCharWidth(t){var e=t.charCodeAt(0);if(this._fontWidthMap[e])return this._fontWidthMap[e]+this.letterSpacing;if(t===" ")return this._spaceWidth+this.letterSpacing;return 0}getTextWidth(t){var e=0;for(var a=0,i=t.length;a<i;a++){e+=this.getCharWidth(t.charAt(a))}return e}getMaxWidth(){return this._maxWidth}getMaxHeight(){return this.fontSize}_drawText(t,e,a,i,r,s){var n=this.getTextWidth(t);var o;var l=0;r==="center"&&(l=(s-n)/2);r==="right"&&(l=s-n);var _=0;for(var h=0,x=t.length;h<x;h++){o=this.getCharTexture(t.charAt(h));if(o){e.graphics.drawImage(o,a+_+l,i);_+=this.getCharWidth(t.charAt(h))}}}}d.regClass("laya.display.BitmapFont",Ze);d.regClass("Laya.BitmapFont",Ze);class Ke extends e{constructor(){super(...arguments);this._http=new XMLHttpRequest}send(t,e=null,a="get",i="text",r=null){this._responseType=i;this._data=null;if(N.onVVMiniGame||N.onQGMiniGame||N.onQQMiniGame||N.onAlipayMiniGame||N.onBLMiniGame||N.onHWMiniGame||N.onTTMiniGame||N.onTBMiniGame){t=Ke._urlEncode(t)}let s=t.replace(I._basePath,"");if(window.fileObj[s]){let t=window.fileObj[s];try{if(this._responseType==="json"){this._data=JSON.parse(t)}else if(this._responseType==="xml"){this._data=w.parseXMLFromString(t)}else{this._data=t}}catch(t){}this.event(P.COMPLETE,this._data instanceof Array?[this._data]:this._data);return}this._url=t;var n=this;var o=this._http;t=I.getAdptedFilePath(t);o.open(a,t,true);let l=false;if(r){for(var _=0;_<r.length;_++){o.setRequestHeader(r[_++],r[_])}}else if(!window.conch){if(!e||typeof e=="string")o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");else{o.setRequestHeader("Content-Type","application/json");l=true}}let h=i!=="arraybuffer"?"text":"arraybuffer";o.responseType=h;if(o.dataType){o.dataType=h}o.onerror=function(t){n._onError(t)};o.onabort=function(t){n._onAbort(t)};o.onprogress=function(t){n._onProgress(t)};o.onload=function(t){n._onLoad(t)};if(N.onBLMiniGame&&N.onAndroid&&!e)e={};o.send(l?JSON.stringify(e):e)}_onProgress(t){if(t&&t.lengthComputable)this.event(P.PROGRESS,t.loaded/t.total)}_onAbort(t){this.error("Request was aborted by user")}_onError(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)}_onLoad(t){var e=this._http;var a=e.status!==undefined?e.status:200;if(a===200||a===204||a===0){this.complete()}else{this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)}}error(t){this.clear();console.warn(this.url,t);this.event(P.ERROR,t)}complete(){this.clear();var e=true;try{if(this._responseType==="json"){this._data=JSON.parse(this._http.responseText)}else if(this._responseType==="xml"){this._data=w.parseXMLFromString(this._http.responseText)}else{this._data=this._http.response||this._http.responseText}}catch(t){e=false;this.error(t.message)}e&&this.event(P.COMPLETE,this._data instanceof Array?[this._data]:this._data)}clear(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null}get url(){return this._url}get data(){return this._data}get http(){return this._http}}Ke._urlEncode=encodeURI;class V extends e{constructor(){super(...arguments);this._customParse=false}static getTypeFromUrl(t){var e=w.getFileExtension(t);if(e)return V.typeMap[e];console.warn("Not recognize the resources suffix",t);return"text"}load(t,e=null,a=true,i=null,r=false,s=O.WorkerLoader.enable){if(!t){this.onLoaded(null);return}V.setGroup(t,"666");this._url=t;if(t.indexOf("data:image")===0)e=V.IMAGE;else t=I.formatURL(t);this._type=e||(e=V.getTypeFromUrl(this._url));this._cache=a;this._useWorkerLoader=s;this._data=null;if(s)O.WorkerLoader.enableWorkerLoader();var n;n=V.loadedMap[t];if(!r&&n){this._data=n;this.event(P.PROGRESS,1);this.event(P.COMPLETE,this._data);return}if(i)V.setGroup(t,i);if(V.parserMap[e]!=null){this._customParse=true;if(V.parserMap[e]instanceof Q)V.parserMap[e].runWith(this);else V.parserMap[e].call(null,this);return}this._loadResourceFilter(e,t)}_loadResourceFilter(t,e){this._loadResource(t,e)}_loadResource(t,e){let a=e.replace(I._basePath,"");if(window.fileObj[a]){if(t==V.IMAGE||t=="htmlimage"||t=="nativeimage"||t==V.SOUND||t==V.TTF){e=window.fileObj[a]}}switch(t){case V.IMAGE:case"htmlimage":case"nativeimage":this._loadImage(e);break;case V.SOUND:this._loadSound(e);break;case V.TTF:this._loadTTF(e);break;case V.ATLAS:case V.PREFAB:case V.PLF:this._loadHttpRequestWhat(e,V.JSON);break;case V.FONT:this._loadHttpRequestWhat(e,V.XML);break;case V.PLFB:this._loadHttpRequestWhat(e,V.BUFFER);break;default:this._loadHttpRequestWhat(e,t)}}_loadHttpRequest(t,e,a,i,r,s,n,o){if(N.onVVMiniGame||N.onHWMiniGame){this._http=new Ke}else{if(!this._http)this._http=new Ke}s&&this._http.on(P.PROGRESS,r,s);i&&this._http.on(P.COMPLETE,a,i);this._http.on(P.ERROR,n,o);this._http.send(t,null,"get",e)}_loadHtmlImage(e,t,a,i,r){var s;function n(){var t=s;t.onload=null;t.onerror=null;delete V._imgCache[e]}var o=function(){n();r.call(i)};var l=function(){n();a.call(t,s)};s=new N.window.Image;s.crossOrigin="";s.onload=l;s.onerror=o;s.src=e;V._imgCache[e]=s}_loadHttpRequestWhat(t,e){if(V.preLoadedMap[t])this.onLoaded(V.preLoadedMap[t]);else this._loadHttpRequest(t,e,this,this.onLoaded,this,this.onProgress,this,this.onError)}_loadTTF(t){t=I.formatURL(t);var e=new O.TTFLoader;e.complete=Q.create(this,this.onLoaded);e.load(t)}_loadImage(t,e=true){var a=this;if(e)t=I.formatURL(t);var i=function(){a.event(P.ERROR,"Load image failed")};if(this._type==="nativeimage"){this._loadHtmlImage(t,this,this.onLoaded,this,i)}else{var r=w.getFileExtension(t);if(r==="ktx"||r==="pvr")this._loadHttpRequest(t,V.BUFFER,this,this.onLoaded,this,this.onProgress,this,this.onError);else this._loadHtmlImage(t,this,this.onLoaded,this,i)}}_loadSound(t){var e=new h._soundClass;var a=this;e.on(P.COMPLETE,this,i);e.on(P.ERROR,this,r);e.load(t);function i(){s();a.onLoaded(e)}function r(){s();e.dispose();a.event(P.ERROR,"Load sound failed")}function s(){e.offAll()}}onProgress(t){if(this._type===V.ATLAS)this.event(P.PROGRESS,t*.3);else if(this._originType==V.HIERARCHY)this.event(P.PROGRESS,t/3);else this.event(P.PROGRESS,t)}onError(t){this.event(P.ERROR,t)}onLoaded(i=null){var t=this._type;if(t==V.PLFB){this.parsePLFBData(i);this.complete(i)}else if(t==V.PLF){this.parsePLFData(i);this.complete(i)}else if(t===V.IMAGE){let e;if(i instanceof ArrayBuffer){var r=w.getFileExtension(this._url);let t;switch(r){case"ktx":t=A.TextureFormat.ETC1RGB;break;case"pvr":t=A.TextureFormat.PVRTCRGBA_4BPPV;break;default:{console.error("unknown format",r);return}}e=new at(0,0,t,false,false);e.wrapModeU=A.WarpMode.Clamp;e.wrapModeV=A.WarpMode.Clamp;e.setCompressData(i);e._setCreateURL(this.url)}else if(!(i instanceof at)){e=new at(i.width,i.height,1,false,false);e.wrapModeU=A.WarpMode.Clamp;e.wrapModeV=A.WarpMode.Clamp;e.loadImageSource(i,true);e._setCreateURL(i.src)}else{e=i}var a=new le(e);a.url=this._url;this.complete(a)}else if(t===V.SOUND||t==="nativeimage"){this.complete(i)}else if(t==="htmlimage"){let t=new at(i.width,i.height,1,false,false);t.wrapModeU=A.WarpMode.Clamp;t.wrapModeV=A.WarpMode.Clamp;t.loadImageSource(i,true);t._setCreateURL(i.src);this.complete(t)}else if(t===V.ATLAS){if(i.frames){var e=[];if(!this._data){this._data=i;if(i.meta&&i.meta.image){e=i.meta.image.split(",");var s=this._url.indexOf("/")>=0?"/":"\\";var n=this._url.lastIndexOf(s);var o=n>=0?this._url.substr(0,n+1):"";var l=null;if(N.onAndroid&&i.meta.compressTextureAndroid){l=".ktx"}if(N.onIOS&&i.meta.compressTextureIOS){l=".pvr"}for(var _=0,h=e.length;_<h;_++){if(l){e[_]=o+e[_].replace(".png",l)}else{e[_]=o+e[_]}}}else{e=[this._url.replace(".json",".png")]}e.reverse();i.toLoads=e;i.pics=[]}this.event(P.PROGRESS,.3+1/e.length*.6);var x=I.formatURL(e.pop());var r=w.getFileExtension(x);var t=V.IMAGE;if(r=="pvr"||r=="ktx"){t=V.BUFFER}return this._loadResourceFilter(t,x)}else{if(!(i instanceof at)){if(i instanceof ArrayBuffer){let t=this._http.url;var r=w.getFileExtension(t);let e;switch(r){case"ktx":e=A.TextureFormat.ETC1RGB;break;case"pvr":e=A.TextureFormat.PVRTCRGBA_4BPPV;break;default:{console.error("unknown format",r);return}}let a=new at(0,0,e,false,false);a.wrapModeU=A.WarpMode.Clamp;a.wrapModeV=A.WarpMode.Clamp;a.setCompressData(i);a._setCreateURL(t);i=a}else{let t=new at(i.width,i.height,1,false,false);t.wrapModeU=A.WarpMode.Clamp;t.wrapModeV=A.WarpMode.Clamp;t.loadImageSource(i,true);t._setCreateURL(i.src);i=t}}this._data.pics.push(i);if(this._data.toLoads.length>0){this.event(P.PROGRESS,.3+1/this._data.toLoads.length*.6);var x=I.formatURL(this._data.toLoads.pop());var r=w.getFileExtension(x);var t=V.IMAGE;if(r=="pvr"||r=="ktx"){t=V.BUFFER}return this._loadResourceFilter(t,x)}var c=this._data.frames;var d=this._url.split("?")[0];var u=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:d.substring(0,d.lastIndexOf("."))+"/";var f=this._data.pics;var p=I.formatURL(this._url);var m=V.atlasMap[p]||(V.atlasMap[p]=[]);m.dir=u;var g=1;if(this._data.meta&&this._data.meta.scale&&this._data.meta.scale!=1){g=parseFloat(this._data.meta.scale);for(var v in c){var y=c[v];var T=f[y.frame.idx?y.frame.idx:0];var x=I.formatURL(u+v);T.scaleRate=g;var E;E=le._create(T,y.frame.x,y.frame.y,y.frame.w,y.frame.h,y.spriteSourceSize.x,y.spriteSourceSize.y,y.sourceSize.w,y.sourceSize.h,V.getRes(x));V.cacheTexture(x,E);E.url=x;m.push(x)}}else{for(v in c){y=c[v];T=f[y.frame.idx?y.frame.idx:0];x=I.formatURL(u+v);E=le._create(T,y.frame.x,y.frame.y,y.frame.w,y.frame.h,y.spriteSourceSize.x,y.spriteSourceSize.y,y.sourceSize.w,y.sourceSize.h,V.getRes(x));V.cacheTexture(x,E);E.url=x;m.push(x)}}delete this._data.pics;this.complete(this._data)}}else if(t===V.FONT){if(!i._source){this._data=i;this.event(P.PROGRESS,.5);return this._loadResourceFilter(V.IMAGE,this._url.replace(".fnt",".png"))}else{var b=new Ze;b.parseFont(this._data,new le(i));var S=this._url.split(".fnt")[0].split("/");var C=S[S.length-1];F.registerBitmapFont(C,b);this._data=b;this.complete(this._data)}}else if(t===V.PREFAB){var R=new qe;R.json=i;this.complete(R)}else{this.complete(i)}}parsePLFData(t){var e;var a;var i;for(e in t){i=t[e];switch(e){case"json":case"text":for(a in i){V.preLoadedMap[I.formatURL(a)]=i[a]}break;default:for(a in i){V.preLoadedMap[I.formatURL(a)]=i[a]}}}}parsePLFBData(t){var e;e=new tt(t);var a,i;i=e.getInt32();for(a=0;a<i;a++){this.parseOnePLFBFile(e)}}parseOnePLFBFile(t){var e;var a;var i;a=t.getUTFString();e=t.getInt32();i=t.readArrayBuffer(e);V.preLoadedMap[I.formatURL(a)]=i}complete(t){this._data=t;if(this._customParse){this.event(P.LOADED,t instanceof Array?[t]:t)}else{V._loaders.push(this);if(!V._isWorking)V.checkNext()}}static checkNext(){V._isWorking=true;var t=N.now();while(V._startIndex<V._loaders.length){V._loaders[V._startIndex].endLoad();V._startIndex++;if(N.now()-t>V.maxTimeOut){console.warn("loader callback cost a long time:"+(N.now()-t)+" url="+V._loaders[V._startIndex-1].url);O.systemTimer.frameOnce(1,null,V.checkNext);return}}V._loaders.length=0;V._startIndex=0;V._isWorking=false}endLoad(t=null){t&&(this._data=t);if(this._cache)V.cacheRes(this._url,this._data);this.event(P.PROGRESS,1);this.event(P.COMPLETE,this.data instanceof Array?[this.data]:this.data)}get url(){return this._url}get type(){return this._type}get cache(){return this._cache}get data(){return this._data}static clearRes(t){t=I.formatURL(t);var e=V.getAtlas(t);if(e){for(var a=0,i=e.length;a<i;a++){var r=e[a];var s=V.getRes(r);delete V.textureMap[r];if(s)s.destroy()}e.length=0;delete V.atlasMap[t]}var n=V.textureMap[t];if(n){n.destroy();delete V.textureMap[t]}var o=V.loadedMap[t];o&&delete V.loadedMap[t]}static clearTextureRes(t){t=I.formatURL(t);var e=V.getAtlas(t);if(e&&e.length>0){e.forEach(function(t){var e=V.getRes(t);if(e instanceof le){e.disposeBitmap()}})}else{var a=V.getRes(t);if(a instanceof le){a.disposeBitmap()}}}static getRes(t){var e=V.textureMap[I.formatURL(t)];if(e)return e;else return V.loadedMap[I.formatURL(t)]}static getAtlas(t){return V.atlasMap[I.formatURL(t)]}static cacheRes(t,e){t=I.formatURL(t);if(V.loadedMap[t]!=null){console.warn("Resources already exist,is repeated loading:",t)}else{if(e instanceof le){V.loadedMap[t]=e.bitmap;V.textureMap[t]=e}else{V.loadedMap[t]=e}}}static cacheTexture(t,e){t=I.formatURL(t);if(V.textureMap[t]!=null){console.warn("Resources already exist,is repeated loading:",t)}else{V.textureMap[t]=e}}static setGroup(t,e){if(!V.groupMap[e])V.groupMap[e]=[];V.groupMap[e].push(t)}static clearResByGroup(t){if(!V.groupMap[t])return;var e=V.groupMap[t],a,i=e.length;for(a=0;a<i;a++){V.clearRes(e[a])}e.length=0}}V.TEXT="text";V.JSON="json";V.PREFAB="prefab";V.XML="xml";V.BUFFER="arraybuffer";V.IMAGE="image";V.SOUND="sound";V.ATLAS="atlas";V.FONT="font";V.TTF="ttf";V.PLF="plf";V.PLFB="plfb";V.HIERARCHY="HIERARCHY";V.MESH="MESH";V.MATERIAL="MATERIAL";V.TEXTURE2D="TEXTURE2D";V.TEXTURECUBE="TEXTURECUBE";V.ANIMATIONCLIP="ANIMATIONCLIP";V.AVATAR="AVATAR";V.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA";V.TERRAINRES="TERRAIN";V.typeMap={ttf:"ttf",png:"image",jpg:"image",jpeg:"image",ktx:"image",pvr:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",plf:"plf",plfb:"plfb",scene:"json",ani:"json",sk:"arraybuffer"};V.parserMap={};V.maxTimeOut=100;V.groupMap={};V.loadedMap={};V.atlasMap={};V.textureMap={};V.preLoadedMap={};V._imgCache={};V._loaders=[];V._isWorking=false;V._startIndex=0;class Qe{static enable(t,e=null){O.loader.load(t,Q.create(null,Qe._onInfoLoaded,[e]),null,V.JSON)}static _onInfoLoaded(t,e){var a;var i;var r;var s,n;for(a in e){r=e[a];i=r[0];r=r[1];n=r.length;for(s=0;s<n;s++){Qe._fileLoadDic[i+r[s]]=a}}t&&t.run()}static getFileLoadPath(t){return Qe._fileLoadDic[t]||t}}Qe._fileLoadDic={};class Je extends e{constructor(){super();this.retryNum=1;this.retryDelay=0;this.maxLoader=5;this._loaders=[];this._loaderCount=0;this._resInfos=[];this._infoPool=[];this._maxPriority=5;this._failRes={};this._statInfo={count:1,loaded:1};for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}getProgress(){return this._statInfo.loaded/this._statInfo.count}resetProgress(){this._statInfo.count=this._statInfo.loaded=1}create(t,e=null,a=null,i=null,r=null,s=null,n=1,o=true){this._create(t,true,e,a,i,r,s,n,o)}_create(t,e,a=null,i=null,r=null,s=null,n=null,o=1,l=true){if(t instanceof Array){var _=true;var h=t;var x=h.length;var c=0;if(i){var d=Q.create(i.caller,i?i.method:null,i.args,false)}for(var u=0;u<x;u++){var f=h[u];if(typeof f=="string")f=h[u]={url:f};f.progress=0}for(u=0;u<x;u++){f=h[u];var p=i?Q.create(null,function(t,e){t.progress=e;var a=0;for(var i=0;i<x;i++){var r=h[i];a+=r.progress}var s=a/x;d.runWith(s)},[f],false):null;var m=i||a?Q.create(null,function(t,e=null){c++;t.progress=1;e||(_=false);if(c===x&&a){a.runWith(_)}},[f]):null;this._createOne(f.url,e,m,p,f.type||r,f.constructParams||s,f.propertyParams||n,f.priority||o,l)}}else{this._createOne(t,e,a,i,r,s,n,o,l)}}_createOne(e,a,i=null,t=null,r=null,s=null,n=null,o=1,l=true){var _=this.getRes(e);if(!_){var h=Je.createMap[w.getFilecompatibleExtension(e)]?w.getFilecompatibleExtension(e):w.getFileExtension(e);r||(r=Je.createMap[h]?Je.createMap[h][0]:null);if(!r){this.load(e,i,t,r,o,l);return}var x=V.parserMap;if(!x[r]){this.load(e,i,t,r,o,l);return}this._createLoad(e,Q.create(null,function(t){if(t){if(!a&&t instanceof $)t._addReference();t._setCreateURL(e)}i&&i.runWith(t);O.loader.event(e)}),t,r,s,n,o,l,true)}else{if(!a&&_ instanceof $)_._addReference();t&&t.runWith(1);i&&i.runWith(_)}}load(t,e=null,a=null,i=null,r=1,s=true,n=null,o=false,l=O.WorkerLoader.enable){if(t instanceof Array){return this._loadAssets(t,e,a,i,r,s,n)}var _;if(i===V.IMAGE)_=V.textureMap[I.formatURL(t)];else _=V.loadedMap[I.formatURL(t)];if(!o&&_!=null){O.systemTimer.callLater(this,function(){a&&a.runWith(1);e&&e.runWith(_ instanceof Array?[_]:_);this._loaderCount||this.event(P.COMPLETE)})}else{var h;h=t;t=Qe.getFileLoadPath(t);if(t!=h&&i!=="nativeimage"){i=V.ATLAS}else{h=null}var x=Je._resMap[t];if(!x){x=this._infoPool.length?this._infoPool.pop():new $e;x.url=t;x.type=i;x.cache=s;x.group=n;x.ignoreCache=o;x.useWorkerLoader=l;x.originalUrl=h;e&&x.on(P.COMPLETE,e.caller,e.method,e.args);a&&x.on(P.PROGRESS,a.caller,a.method,a.args);Je._resMap[t]=x;r=r<this._maxPriority?r:this._maxPriority-1;this._resInfos[r].push(x);this._statInfo.count++;this.event(P.PROGRESS,this.getProgress());this._next()}else{if(e){if(h){e&&x._createListener(P.COMPLETE,this,this._resInfoLoaded,[h,e],false,false)}else{e&&x._createListener(P.COMPLETE,e.caller,e.method,e.args,false,false)}}a&&x._createListener(P.PROGRESS,a.caller,a.method,a.args,false,false)}}return this}_resInfoLoaded(t,e){e.runWith(V.getRes(t))}_createLoad(t,e=null,a=null,i=null,r=null,s=null,n=1,o=true,l=false){if(t instanceof Array)return this._loadAssets(t,e,a,i,n,o);var _=V.getRes(t);if(_!=null){O.systemTimer.frameOnce(1,this,function(){a&&a.runWith(1);e&&e.runWith(_);this._loaderCount||this.event(P.COMPLETE)})}else{var h=Je._resMap[t];if(!h){h=this._infoPool.length?this._infoPool.pop():new $e;h.url=t;h.type=i;h.cache=false;h.ignoreCache=l;h.originalUrl=null;h.group=null;h.createCache=o;h.createConstructParams=r;h.createPropertyParams=s;e&&h.on(P.COMPLETE,e.caller,e.method,e.args);a&&h.on(P.PROGRESS,a.caller,a.method,a.args);Je._resMap[t]=h;n=n<this._maxPriority?n:this._maxPriority-1;this._resInfos[n].push(h);this._statInfo.count++;this.event(P.PROGRESS,this.getProgress());this._next()}else{e&&h._createListener(P.COMPLETE,e.caller,e.method,e.args,false,false);a&&h._createListener(P.PROGRESS,a.caller,a.method,a.args,false,false)}}return this}_next(){if(this._loaderCount>=this.maxLoader)return;for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];while(e.length>0){var a=e.shift();if(a)return this._doLoad(a)}}this._loaderCount||this.event(P.COMPLETE)}_doLoad(e){this._loaderCount++;var a=this._loaders.length?this._loaders.pop():new V;a.on(P.COMPLETE,null,r);a.on(P.PROGRESS,null,function(t){e.event(P.PROGRESS,t)});a.on(P.ERROR,null,function(t){r(null)});var i=this;function r(t=null){a.offAll();a._data=null;a._customParse=false;i._loaders.push(a);i._endLoad(e,t instanceof Array?[t]:t);i._loaderCount--;i._next()}a._constructParams=e.createConstructParams;a._propertyParams=e.createPropertyParams;a._createCache=e.createCache;a.load(e.url,e.type,e.cache,e.group,e.ignoreCache,e.useWorkerLoader)}_endLoad(t,e){var a=t.url;if(e==null){var i=this._failRes[a]||0;if(i<this.retryNum){console.warn("[warn]Retry to load:",a);this._failRes[a]=i+1;O.systemTimer.once(this.retryDelay,this,this._addReTry,[t],false);return}else{V.clearRes(a);console.warn("[error]Failed to load:",a);this.event(P.ERROR,a)}}if(this._failRes[a])this._failRes[a]=0;delete Je._resMap[a];if(t.originalUrl){e=V.getRes(t.originalUrl)}t.event(P.COMPLETE,e);t.offAll();this._infoPool.push(t);this._statInfo.loaded++;this.event(P.PROGRESS,this.getProgress())}_addReTry(t){this._resInfos[this._maxPriority-1].push(t);this._next()}clearRes(t){V.clearRes(t)}clearTextureRes(t){V.clearTextureRes(t)}getRes(t){return V.getRes(t)}cacheRes(t,e){V.cacheRes(t,e)}setGroup(t,e){V.setGroup(t,e)}clearResByGroup(t){V.clearResByGroup(t)}static cacheRes(t,e){V.cacheRes(t,e)}clearUnLoaded(){for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];for(var a=e.length-1;a>-1;a--){var i=e[a];if(i){i.offAll();this._infoPool.push(i)}}e.length=0}this._loaderCount=0;Je._resMap={}}cancelLoadByUrls(t){if(!t)return;for(var e=0,a=t.length;e<a;e++){this.cancelLoadByUrl(t[e])}}cancelLoadByUrl(t){for(var e=0;e<this._maxPriority;e++){var a=this._resInfos[e];for(var i=a.length-1;i>-1;i--){var r=a[i];if(r&&r.url===t){a[i]=null;r.offAll();this._infoPool.push(r)}}}if(Je._resMap[t])delete Je._resMap[t]}_loadAssets(a,i=null,n=null,r=null,s=1,o=true,l=null){var _=a.length;var h=0;var x=0;var c=[];var d=true;for(var u=0;u<_;u++){let t=a[u];let e;if(typeof t=="string")e={url:t,type:r,size:1,priority:s};else e=t;if(!e.size)e.size=1;e.progress=0;x+=e.size;c.push(e);var f=n?Q.create(null,g,[e],false):null;var p=i||n?Q.create(null,m,[e]):null;this.load(e.url,p,f,e.type,e.priority||1,o,e.group||l,false,e.useWorkerLoader)}function m(t,e=null){h++;t.progress=1;if(!e)d=false;if(h===_&&i){i.runWith(d)}}function g(t,e){if(n!=null){t.progress=e;var a=0;for(var i=0;i<c.length;i++){var r=c[i];if(r){let t=r.progress==undefined?0:r.progress;a+=r.size==undefined?0:r.size*t}}var s=a/x;n.runWith(s)}}return this}decodeBitmaps(t){var e,a=t.length;var i;i=O.Render._context;for(e=0;e<a;e++){var r;r=V.getAtlas(t[e]);if(r){this._decodeTexture(r[0],i)}else{var s;s=this.getRes(t[e]);if(s&&s instanceof le){this._decodeTexture(s,i)}}}}_decodeTexture(t,e){var a=t.bitmap;if(!t||!a)return;var i=a.source||a.image;if(!i)return;if(i instanceof HTMLImageElement){e.drawImage(i,0,0,1,1);var r=e.getImageData(0,0,1,1)}}}Je._resMap={};Je.createMap={atlas:[null,V.ATLAS]};class $e extends e{}class ta{static __init__(){if(!ta._baseClass){ta._baseClass=ea;ea.init()}ta.items=ta._baseClass.items;ta.support=ta._baseClass.support;return ta.support}static setItem(t,e){ta._baseClass.setItem(t,e)}static getItem(t){return ta._baseClass.getItem(t)}static setJSON(t,e){ta._baseClass.setJSON(t,e)}static getJSON(t){return ta._baseClass.getJSON(t)}static removeItem(t){ta._baseClass.removeItem(t)}static clear(){ta._baseClass.clear()}}ta.support=false;class ea{static init(){try{ea.support=true;ea.items=window.localStorage;ea.setItem("laya","1");ea.removeItem("laya")}catch(t){ea.support=false}if(!ea.support)console.log("LocalStorage is not supprot or browser is private mode.")}static setItem(t,e){try{ea.support&&ea.items.setItem(t,e)}catch(t){console.warn("set localStorage failed",t)}}static getItem(t){return ea.support?ea.items.getItem(t):null}static setJSON(t,e){try{ea.support&&ea.items.setItem(t,JSON.stringify(e))}catch(t){console.warn("set localStorage failed",t)}}static getJSON(e){try{let t=JSON.parse(ea.support?ea.items.getItem(e):null);return t}catch(t){return ea.items.getItem(e)}}static removeItem(t){ea.support&&ea.items.removeItem(t)}static clear(){ea.support&&ea.items.clear()}}ea.support=false;class aa{load(t){this._url=t;var e=t.toLowerCase().split(".ttf")[0].split("/");this.fontName=e[e.length-1];if(O.Render.isConchApp){this._loadConch()}else if(window.FontFace){this._loadWithFontFace()}else{this._loadWithCSS()}}_loadConch(){this._http=new Ke;this._http.on(P.ERROR,this,this._onErr);this._http.on(P.COMPLETE,this,this._onHttpLoaded);this._http.send(this._url,null,"get",V.BUFFER)}_onHttpLoaded(t=null){window["conchTextCanvas"].setFontFaceFromBuffer(this.fontName,t);this._clearHttp();this._complete()}_clearHttp(){if(this._http){this._http.off(P.ERROR,this,this._onErr);this._http.off(P.COMPLETE,this,this._onHttpLoaded);this._http=null}}_onErr(){this._clearHttp();if(this.err){this.err.runWith("fail:"+this._url);this.err=null}}_complete(){O.systemTimer.clear(this,this._complete);O.systemTimer.clear(this,this._checkComplete);if(this._div&&this._div.parentNode){this._div.parentNode.removeChild(this._div);this._div=null}if(this.complete){this.complete.runWith(this);this.complete=null}}_checkComplete(){if(O.Browser.measureText(aa._testString,this._fontTxt).width!=this._txtWidth){this._complete()}}_loadWithFontFace(){var t=new window.FontFace(this.fontName,"url('"+this._url+"')");document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()});t.load()}_createDiv(){this._div=N.createElement("div");this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName;t.position="absolute";t.left="-100px";t.top="-100px";document.body.appendChild(this._div)}_loadWithCSS(){var t=N.createElement("style");t.type="text/css";document.body.appendChild(t);t.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}";this._fontTxt="40px "+this.fontName;this._txtWidth=N.measureText(aa._testString,this._fontTxt).width;var e=this;t.onload=function(){O.systemTimer.once(1e4,e,e._complete)};O.systemTimer.loop(20,this,this._checkComplete);this._createDiv()}}aa._testString="LayaTTFFont";class ia{static linearNone(t,e,a,i){return a*t/i+e}static linearIn(t,e,a,i){return a*t/i+e}static linearInOut(t,e,a,i){return a*t/i+e}static linearOut(t,e,a,i){return a*t/i+e}static bounceIn(t,e,a,i){return a-ia.bounceOut(i-t,0,a,i)+e}static bounceInOut(t,e,a,i){if(t<i*.5)return ia.bounceIn(t*2,0,a,i)*.5+e;else return ia.bounceOut(t*2-i,0,a,i)*.5+a*.5+e}static bounceOut(t,e,a,i){if((t/=i)<1/2.75)return a*(7.5625*t*t)+e;else if(t<2/2.75)return a*(7.5625*(t-=1.5/2.75)*t+.75)+e;else if(t<2.5/2.75)return a*(7.5625*(t-=2.25/2.75)*t+.9375)+e;else return a*(7.5625*(t-=2.625/2.75)*t+.984375)+e}static backIn(t,e,a,i,r=1.70158){return a*(t/=i)*t*((r+1)*t-r)+e}static backInOut(t,e,a,i,r=1.70158){if((t/=i*.5)<1)return a*.5*(t*t*(((r*=1.525)+1)*t-r))+e;return a/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e}static backOut(t,e,a,i,r=1.70158){return a*((t=t/i-1)*t*((r+1)*t+r)+1)+e}static elasticIn(t,e,a,i,r=0,s=0){var n;if(t==0)return e;if((t/=i)==1)return e+a;if(!s)s=i*.3;if(!r||a>0&&r<a||a<0&&r<-a){r=a;n=s/4}else n=s/ia.PI2*Math.asin(a/r);return-(r*Math.pow(2,10*(t-=1))*Math.sin((t*i-n)*ia.PI2/s))+e}static elasticInOut(t,e,a,i,r=0,s=0){var n;if(t==0)return e;if((t/=i*.5)==2)return e+a;if(!s)s=i*(.3*1.5);if(!r||a>0&&r<a||a<0&&r<-a){r=a;n=s/4}else n=s/ia.PI2*Math.asin(a/r);if(t<1)return-.5*(r*Math.pow(2,10*(t-=1))*Math.sin((t*i-n)*ia.PI2/s))+e;return r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-n)*ia.PI2/s)*.5+a+e}static elasticOut(t,e,a,i,r=0,s=0){var n;if(t==0)return e;if((t/=i)==1)return e+a;if(!s)s=i*.3;if(!r||a>0&&r<a||a<0&&r<-a){r=a;n=s/4}else n=s/ia.PI2*Math.asin(a/r);return r*Math.pow(2,-10*t)*Math.sin((t*i-n)*ia.PI2/s)+a+e}static strongIn(t,e,a,i){return a*(t/=i)*t*t*t*t+e}static strongInOut(t,e,a,i){if((t/=i*.5)<1)return a*.5*t*t*t*t*t+e;return a*.5*((t-=2)*t*t*t*t+2)+e}static strongOut(t,e,a,i){return a*((t=t/i-1)*t*t*t*t+1)+e}static sineInOut(t,e,a,i){return-a*.5*(Math.cos(Math.PI*t/i)-1)+e}static sineIn(t,e,a,i){return-a*Math.cos(t/i*ia.HALF_PI)+a+e}static sineOut(t,e,a,i){return a*Math.sin(t/i*ia.HALF_PI)+e}static quintIn(t,e,a,i){return a*(t/=i)*t*t*t*t+e}static quintInOut(t,e,a,i){if((t/=i*.5)<1)return a*.5*t*t*t*t*t+e;return a*.5*((t-=2)*t*t*t*t+2)+e}static quintOut(t,e,a,i){return a*((t=t/i-1)*t*t*t*t+1)+e}static quartIn(t,e,a,i){return a*(t/=i)*t*t*t+e}static quartInOut(t,e,a,i){if((t/=i*.5)<1)return a*.5*t*t*t*t+e;return-a*.5*((t-=2)*t*t*t-2)+e}static quartOut(t,e,a,i){return-a*((t=t/i-1)*t*t*t-1)+e}static cubicIn(t,e,a,i){return a*(t/=i)*t*t+e}static cubicInOut(t,e,a,i){if((t/=i*.5)<1)return a*.5*t*t*t+e;return a*.5*((t-=2)*t*t+2)+e}static cubicOut(t,e,a,i){return a*((t=t/i-1)*t*t+1)+e}static quadIn(t,e,a,i){return a*(t/=i)*t+e}static quadInOut(t,e,a,i){if((t/=i*.5)<1)return a*.5*t*t+e;return-a*.5*(--t*(t-2)-1)+e}static quadOut(t,e,a,i){return-a*(t/=i)*(t-2)+e}static expoIn(t,e,a,i){return t==0?e:a*Math.pow(2,10*(t/i-1))+e-a*.001}static expoInOut(t,e,a,i){if(t==0)return e;if(t==i)return e+a;if((t/=i*.5)<1)return a*.5*Math.pow(2,10*(t-1))+e;return a*.5*(-Math.pow(2,-10*--t)+2)+e}static expoOut(t,e,a,i){return t==i?e+a:a*(-Math.pow(2,-10*t/i)+1)+e}static circIn(t,e,a,i){return-a*(Math.sqrt(1-(t/=i)*t)-1)+e}static circInOut(t,e,a,i){if((t/=i*.5)<1)return-a*.5*(Math.sqrt(1-t*t)-1)+e;return a*.5*(Math.sqrt(1-(t-=2)*t)+1)+e}static circOut(t,e,a,i){return a*Math.sqrt(1-(t=t/i-1)*t)+e}}ia.HALF_PI=Math.PI*.5;ia.PI2=Math.PI*2;class ra{constructor(){this.gid=0;this.repeat=1;this._count=0}static to(t,e,a,i=null,r=null,s=0,n=false,o=true){return u.getItemByClass("tween",ra)._create(t,e,a,i,r,s,n,true,o,true)}static from(t,e,a,i=null,r=null,s=0,n=false,o=true){return u.getItemByClass("tween",ra)._create(t,e,a,i,r,s,n,false,o,true)}to(t,e,a,i=null,r=null,s=0,n=false){return this._create(t,e,a,i,r,s,n,true,false,true)}from(t,e,a,i=null,r=null,s=0,n=false){return this._create(t,e,a,i,r,s,n,false,false,true)}_create(t,e,a,i,r,s,n,o,l,_){if(!t)throw new Error("Tween:target is null");this._target=t;this._duration=a;this._ease=i||e.ease||ra.easeNone;this._complete=r||e.complete;this._delay=s;this._props=[];this._usedTimer=0;this._startTimer=N.now();this._usedPool=l;this._delayParam=null;this.update=e.update;var h=t.$_GID||(t.$_GID=w.getGID());if(!ra.tweenMap[h]){ra.tweenMap[h]=[this]}else{if(n)ra.clearTween(t);ra.tweenMap[h].push(this)}if(_){if(s<=0)this.firstStart(t,e,o);else{this._delayParam=[t,e,o];O.timer.once(s,this,this.firstStart,this._delayParam)}}else{this._initProps(t,e,o)}return this}firstStart(t,e,a){this._delayParam=null;if(t.destroyed){this.clear();return}this._initProps(t,e,a);this._beginLoop()}_initProps(t,e,a){for(var i in e){if(typeof t[i]=="number"){var r=a?t[i]:e[i];var s=a?e[i]:t[i];this._props.push([i,r,s-r]);if(!a)t[i]=r}}}_beginLoop(){O.timer.frameLoop(1,this,this._doEase)}_doEase(){this._updateEase(N.now())}_updateEase(t){var e=this._target;if(!e)return;if(e.destroyed)return ra.clearTween(e);var a=this._usedTimer=t-this._startTimer-this._delay;if(a<0)return;if(a>=this._duration)return this.complete();var i=a>0?this._ease(a,0,1,this._duration):0;var r=this._props;for(var s=0,n=r.length;s<n;s++){var o=r[s];e[o[0]]=o[1]+i*o[2]}if(this.update)this.update.run()}set progress(t){var e=t*this._duration;this._startTimer=N.now()-this._delay-e}complete(){if(!this._target)return;O.timer.runTimer(this,this.firstStart);var t=this._target;var e=this._props;var a=this._complete;for(var i=0,r=e.length;i<r;i++){var s=e[i];t[s[0]]=s[1]+s[2]}if(this.update)this.update.run();this._count++;if(this.repeat!=0&&this._count>=this.repeat){this.clear();a&&a.run()}else{this.restart()}}pause(){O.timer.clear(this,this._beginLoop);O.timer.clear(this,this._doEase);O.timer.clear(this,this.firstStart);var t=N.now();var e;e=t-this._startTimer-this._delay;if(e<0){this._usedTimer=e}}setStartTime(t){this._startTimer=t}static clearAll(t){if(!t||!t.$_GID)return;var e=ra.tweenMap[t.$_GID];if(e){for(var a=0,i=e.length;a<i;a++){e[a]._clear()}e.length=0}}static clear(t){t.clear()}static clearTween(t){ra.clearAll(t)}clear(){if(this._target){this._remove();this._clear()}}_clear(){this.pause();O.timer.clear(this,this.firstStart);this._complete=null;this._target=null;this._ease=null;this._props=null;this._delayParam=null;this.repeat=1;if(this._usedPool){this.update=null;u.recover("tween",this)}}recover(){this._usedPool=true;this._clear()}_remove(){var t=ra.tweenMap[this._target.$_GID];if(t){for(var e=0,a=t.length;e<a;e++){if(t[e]===this){t.splice(e,1);break}}}}restart(){this.pause();this._usedTimer=0;this._startTimer=N.now();if(this._delayParam){O.timer.once(this._delay,this,this.firstStart,this._delayParam);return}var t=this._props;for(var e=0,a=t.length;e<a;e++){var i=t[e];this._target[i[0]]=i[1]}O.timer.once(this._delay,this,this._beginLoop)}resume(){if(this._usedTimer>=this._duration)return;this._startTimer=N.now()-this._usedTimer-this._delay;if(this._delayParam){if(this._usedTimer<0){O.timer.once(-this._usedTimer,this,this.firstStart,this._delayParam)}else{this.firstStart.apply(this,this._delayParam)}}else{this._beginLoop()}}static easeNone(t,e,a,i){return a*t/i+e}}ra.tweenMap=[];class sa{constructor(){this.ratio=.92;this.maxOffset=60;this._dragging=false;this._clickOnly=true}start(t,e,a,i,r,s,n,o=.92){this.clearTimer();this.target=t;this.area=e;this.hasInertia=a;this.elasticDistance=e?i:0;this.elasticBackTime=r;this.data=s;this._disableMouseEvent=n;this.ratio=o;this._parent=t.parent;this._clickOnly=true;this._dragging=true;this._elasticRateX=this._elasticRateY=1;this._lastX=this._parent.mouseX;this._lastY=this._parent.mouseY;O.stage.on(P.MOUSE_UP,this,this.onStageMouseUp);O.stage.on(P.MOUSE_OUT,this,this.onStageMouseUp);O.systemTimer.frameLoop(1,this,this.loop)}clearTimer(){O.systemTimer.clear(this,this.loop);O.systemTimer.clear(this,this.tweenMove);if(this._tween){this._tween.recover();this._tween=null}}stop(){if(this._dragging){Ue.instance.disableMouseEvent=false;O.stage.off(P.MOUSE_UP,this,this.onStageMouseUp);O.stage.off(P.MOUSE_OUT,this,this.onStageMouseUp);this._dragging=false;this.target&&this.area&&this.backToArea();this.clear()}}loop(){var t=this._parent.getMousePoint();var e=t.x;var a=t.y;var i=e-this._lastX;var r=a-this._lastY;if(this._clickOnly){if(Math.abs(i*O.stage._canvasTransform.getScaleX())>1||Math.abs(r*O.stage._canvasTransform.getScaleY())>1){this._clickOnly=false;this._offsets||(this._offsets=[]);this._offsets.length=0;this.target.event(P.DRAG_START,this.data);Ue.instance.disableMouseEvent=this._disableMouseEvent}else return}else{this._offsets.push(i,r)}if(i===0&&r===0)return;this._lastX=e;this._lastY=a;this.target.x+=i*this._elasticRateX;this.target.y+=r*this._elasticRateY;this.area&&this.checkArea();this.target.event(P.DRAG_MOVE,this.data)}checkArea(){if(this.elasticDistance<=0){this.backToArea()}else{if(this.target._x<this.area.x){var t=this.area.x-this.target._x}else if(this.target._x>this.area.x+this.area.width){t=this.target._x-this.area.x-this.area.width}else{t=0}this._elasticRateX=Math.max(0,1-t/this.elasticDistance);if(this.target._y<this.area.y){var e=this.area.y-this.target.y}else if(this.target._y>this.area.y+this.area.height){e=this.target._y-this.area.y-this.area.height}else{e=0}this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}}backToArea(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width);this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)}onStageMouseUp(t){Ue.instance.disableMouseEvent=false;O.stage.off(P.MOUSE_UP,this,this.onStageMouseUp);O.stage.off(P.MOUSE_OUT,this,this.onStageMouseUp);O.systemTimer.clear(this,this.loop);if(this._clickOnly||!this.target)return;if(this.hasInertia){if(this._offsets.length<1){this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY)}this._offsetX=this._offsetY=0;var e=this._offsets.length;var a=Math.min(e,6);var i=this._offsets.length-a;for(var r=e-1;r>i;r--){this._offsetY+=this._offsets[r--];this._offsetX+=this._offsets[r]}this._offsetX=this._offsetX/a*2;this._offsetY=this._offsetY/a*2;if(Math.abs(this._offsetX)>this.maxOffset)this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset;if(Math.abs(this._offsetY)>this.maxOffset)this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset;O.systemTimer.frameLoop(1,this,this.tweenMove)}else if(this.elasticDistance>0){this.checkElastic()}else{this.clear()}}checkElastic(){var t=NaN;var e=NaN;if(this.target.x<this.area.x)t=this.area.x;else if(this.target._x>this.area.x+this.area.width)t=this.area.x+this.area.width;if(this.target.y<this.area.y)e=this.area.y;else if(this.target._y>this.area.y+this.area.height)e=this.area.y+this.area.height;if(!isNaN(t)||!isNaN(e)){var a={};if(!isNaN(t))a.x=t;if(!isNaN(e))a.y=e;this._tween=ra.to(this.target,a,this.elasticBackTime,ia.sineOut,Q.create(this,this.clear),0,false,false)}else{this.clear()}}tweenMove(){this._offsetX*=this.ratio*this._elasticRateX;this._offsetY*=this.ratio*this._elasticRateY;this.target.x+=this._offsetX;this.target.y+=this._offsetY;this.area&&this.checkArea();this.target.event(P.DRAG_MOVE,this.data);if(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5){O.systemTimer.clear(this,this.tweenMove);if(this.elasticDistance>0)this.checkElastic();else this.clear()}}clear(){if(this.target){this.clearTimer();var t=this.target;this.target=null;this._parent=null;t.event(P.DRAG_END,this.data)}}}class na{constructor(){this._id=w.getGID();this._resetComp()}get id(){return this._id}get enabled(){return this._enabled}set enabled(t){if(this._enabled!=t){this._enabled=t;if(this.owner){if(t)this.owner.activeInHierarchy&&this._onEnable();else this.owner.activeInHierarchy&&this._onDisable()}}}get isSingleton(){return true}get destroyed(){return this._destroyed}_isScript(){return false}_resetComp(){this._indexInList=-1;this._enabled=true;this._awaked=false;this.owner=null}_getIndexInList(){return this._indexInList}_setIndexInList(t){this._indexInList=t}_onAdded(){}_onAwake(){}_onEnable(){}_onDisable(){}_onDestroy(){}onReset(){}_parse(t,e=null){}_parseInteractive(t=null,e=null){}_cloneTo(t){}_setActive(t){if(t){if(!this._awaked){this._awaked=true;this._onAwake()}this._enabled&&this._onEnable()}else{this._enabled&&this._onDisable()}}destroy(){if(this.owner)this.owner._destroyComponent(this)}_destroy(){if(this.owner.activeInHierarchy&&this._enabled)this._setActive(false);this._onDestroy();this._destroyed=true;if(this.onReset!==na.prototype.onReset){this.onReset();this._resetComp();u.recoverByClass(this)}else{this._resetComp()}}}class oa extends Be{constructor(){super();this.wrapMode=0;this._interval=n.animationInterval;this._isReverse=false;this._frameRateChanged=false;this._setBitUp(b.DISPLAY)}play(t=0,e=true,a=""){this._isPlaying=true;this._actionName=a;this.index=typeof t=="string"?this._getFrameByLabel(t):t;this.loop=e;this._isReverse=this.wrapMode===oa.WRAP_REVERSE;if(this.index==0&&this._isReverse){this.index=this.count-1}if(this.interval>0)this.timerLoop(this.interval,this,this._frameLoop,null,true,true)}get interval(){return this._interval}set interval(t){if(this._interval!=t){this._frameRateChanged=true;this._interval=t;if(this._isPlaying&&t>0){this.timerLoop(t,this,this._frameLoop,null,true,true)}}}_getFrameByLabel(t){for(var e=0;e<this._count;e++){var a=this._labels[e];if(a&&a.indexOf(t)>-1)return e}return 0}_frameLoop(){if(this._isReverse){this._index--;if(this._index<0){if(this.loop){if(this.wrapMode==oa.WRAP_PINGPONG){this._index=this._count>0?1:0;this._isReverse=false}else{this._index=this._count-1}this.event(P.COMPLETE)}else{this._index=0;this.stop();this.event(P.COMPLETE);return}}}else{this._index++;if(this._index>=this._count){if(this.loop){if(this.wrapMode==oa.WRAP_PINGPONG){this._index=this._count-2>=0?this._count-2:0;this._isReverse=true}else{this._index=0}this.event(P.COMPLETE)}else{this._index--;this.stop();this.event(P.COMPLETE);return}}}this.index=this._index}_setControlNode(t){if(this._controlNode){this._controlNode.off(P.DISPLAY,this,this._resumePlay);this._controlNode.off(P.UNDISPLAY,this,this._resumePlay)}this._controlNode=t;if(t&&t!=this){t.on(P.DISPLAY,this,this._resumePlay);t.on(P.UNDISPLAY,this,this._resumePlay)}}_setDisplay(t){super._setDisplay(t);this._resumePlay()}_resumePlay(){if(this._isPlaying){if(this._controlNode.displayedInStage)this.play(this._index,this.loop,this._actionName);else this.clearTimer(this,this._frameLoop)}}stop(){this._isPlaying=false;this.clearTimer(this,this._frameLoop)}get isPlaying(){return this._isPlaying}addLabel(t,e){if(!this._labels)this._labels={};if(!this._labels[e])this._labels[e]=[];this._labels[e].push(t)}removeLabel(t){if(!t)this._labels=null;else if(this._labels){for(var e in this._labels){this._removeLabelFromList(this._labels[e],t)}}}_removeLabelFromList(t,e){if(!t)return;for(var a=t.length-1;a>=0;a--){if(t[a]==e){t.splice(a,1)}}}gotoAndStop(t){this.index=typeof t=="string"?this._getFrameByLabel(t):t;this.stop()}get index(){return this._index}set index(t){this._index=t;this._displayToIndex(t);if(this._labels&&this._labels[t]){var e=this._labels[t];for(var a=0,i=e.length;a<i;a++){this.event(P.LABEL,e[a])}}}_displayToIndex(t){}get count(){return this._count}clear(){this.stop();this._labels=null;return this}}oa.WRAP_POSITIVE=0;oa.WRAP_REVERSE=1;oa.WRAP_PINGPONG=2;d.regClass("laya.display.AnimationBase",oa);d.regClass("Laya.AnimationBase",oa);class la{static subtractVector3(t,e,a){a[0]=t[0]-e[0];a[1]=t[1]-e[1];a[2]=t[2]-e[2]}static lerp(t,e,a){return t*(1-a)+e*a}static scaleVector3(t,e,a){a[0]=t[0]*e;a[1]=t[1]*e;a[2]=t[2]*e}static lerpVector3(t,e,a,i){var r=t[0],s=t[1],n=t[2];i[0]=r+a*(e[0]-r);i[1]=s+a*(e[1]-s);i[2]=n+a*(e[2]-n)}static lerpVector4(t,e,a,i){var r=t[0],s=t[1],n=t[2],o=t[3];i[0]=r+a*(e[0]-r);i[1]=s+a*(e[1]-s);i[2]=n+a*(e[2]-n);i[3]=o+a*(e[3]-o)}static slerpQuaternionArray(t,e,a,i,r,s,n){var o=t[e+0],l=t[e+1],_=t[e+2],h=t[e+3],x=a[i+0],c=a[i+1],d=a[i+2],u=a[i+3];var f,p,m,g,v;p=o*x+l*c+_*d+h*u;if(p<0){p=-p;x=-x;c=-c;d=-d;u=-u}if(1-p>1e-6){f=Math.acos(p);m=Math.sin(f);g=Math.sin((1-r)*f)/m;v=Math.sin(r*f)/m}else{g=1-r;v=r}s[n+0]=g*o+v*x;s[n+1]=g*l+v*c;s[n+2]=g*_+v*d;s[n+3]=g*h+v*u;return s}static getRotation(t,e,a,i){return Math.atan2(i-e,a-t)/Math.PI*180}static sortBigFirst(t,e){if(t==e)return 0;return e>t?1:-1}static sortSmallFirst(t,e){if(t==e)return 0;return e>t?-1:1}static sortNumBigFirst(t,e){return parseFloat(e)-parseFloat(t)}static sortNumSmallFirst(t,e){return parseFloat(t)-parseFloat(e)}static sortByKey(a,t=false,e=true){var i;if(t){i=e?la.sortNumBigFirst:la.sortBigFirst}else{i=e?la.sortNumSmallFirst:la.sortSmallFirst}return function(t,e){return i(t[a],e[a])}}}class _a extends oa{constructor(){super();if(_a._sortIndexFun===undefined){_a._sortIndexFun=la.sortByKey("index",false,true)}}static _sortIndexFun(t,e){return t.index-e.index}_setUp(t,e){this._targetDic=t;this._animationData=e;this.interval=1e3/e.frameRate;if(e.parsed){this._count=e.count;this._labels=e.labels;this._usedFrames=e.animationNewFrames}else{this._usedFrames=[];this._calculateDatas();e.parsed=true;e.labels=this._labels;e.count=this._count;e.animationNewFrames=this._usedFrames}}clear(){super.clear();this._targetDic=null;this._animationData=null;return this}_displayToIndex(t){if(!this._animationData)return;if(t<0)t=0;if(t>this._count)t=this._count;var e=this._animationData.nodes,a,i=e.length;for(a=0;a<i;a++){this._displayNodeToFrame(e[a],t)}}_displayNodeToFrame(t,e,a=null){if(!a)a=this._targetDic;var i=a[t.target];if(!i){return}var r=t.frames,s,n,o;var l=t.keys,_,h=l.length;for(_=0;_<h;_++){s=l[_];n=r[s];if(n.length>e){o=n[e]}else{o=n[n.length-1]}i[s]=o}var x=t.funkeys;h=x.length;var c;if(h==0)return;for(_=0;_<h;_++){s=x[_];c=r[s];if(c[e]!==undefined){i[s]&&i[s].apply(i,c[e])}}}_calculateDatas(){if(!this._animationData)return;var t=this._animationData.nodes,e,a=t.length,i;this._count=0;for(e=0;e<a;e++){i=t[e];this._calculateKeyFrames(i)}this._count+=1}_calculateKeyFrames(t){var e=t.keyframes,a,i,r=t.target;if(!t.frames)t.frames={};if(!t.keys)t.keys=[];else t.keys.length=0;if(!t.funkeys)t.funkeys=[];else t.funkeys.length=0;if(!t.initValues)t.initValues={};for(a in e){var s=a.indexOf("()")!=-1;i=e[a];if(s)a=a.substr(0,a.length-2);if(!t.frames[a]){t.frames[a]=[]}if(!s){if(this._targetDic&&this._targetDic[r]){t.initValues[a]=this._targetDic[r][a]}i.sort(_a._sortIndexFun);t.keys.push(a);this._calculateNodePropFrames(i,t.frames[a],a,r)}else{t.funkeys.push(a);var n=t.frames[a];for(var o=0;o<i.length;o++){var l=i[o];n[l.index]=l.value;if(l.index>this._count)this._count=l.index}}}}resetNodes(){if(!this._targetDic)return;if(!this._animationData)return;var t=this._animationData.nodes,e,a=t.length;var i;var r;for(e=0;e<a;e++){i=t[e];r=i.initValues;if(!r)continue;var s=this._targetDic[i.target];if(!s)continue;var n;for(n in r){s[n]=r[n]}}}_calculateNodePropFrames(t,e,a,i){var r,s=t.length-1;e.length=t[s].index+1;for(r=0;r<s;r++){this._dealKeyFrame(t[r]);this._calculateFrameValues(t[r],t[r+1],e)}if(s==0){e[0]=t[0].value;if(this._usedFrames)this._usedFrames[t[0].index]=true}this._dealKeyFrame(t[r])}_dealKeyFrame(t){if(t.label&&t.label!="")this.addLabel(t.label,t.index)}_calculateFrameValues(t,e,a){var i,r;var s=t.index,n=e.index;var o=t.value;var l=e.value-t.value;var _=n-s;var h=this._usedFrames;if(n>this._count)this._count=n;if(t.tween){r=ia[t.tweenMethod];if(r==null)r=ia.linearNone;for(i=s;i<n;i++){a[i]=r(i-s,o,l,_);if(h)h[i]=true}}else{for(i=s;i<n;i++){a[i]=o}}if(h){h[t.index]=true;h[e.index]=true}a[e.index]=e.value}}d.regClass("laya.display.FrameAnimation",_a);d.regClass("Laya.FrameAnimation",_a);class ha{constructor(){this._obj={};ha._maps.push(this)}static __init__(){ha.I=new ha;if(!ha.supportWeakMap)O.systemTimer.loop(ha.delInterval,null,ha.clearCache)}static clearCache(){for(var t=0,e=ha._maps.length;t<e;t++){var a=ha._maps[t];a._obj={}}}set(t,e){if(t==null)return;if(ha.supportWeakMap);else{if(typeof t=="string"||typeof t=="number"){this._obj[t]=e}else{t.$_GID||(t.$_GID=w.getGID());this._obj[t.$_GID]=e}}}get(t){if(t==null)return null;if(ha.supportWeakMap);else{if(typeof t=="string"||typeof t=="number")return this._obj[t];return this._obj[t.$_GID]}}del(t){if(t==null)return;if(ha.supportWeakMap);else{if(typeof t=="string"||typeof t=="number")delete this._obj[t];else delete this._obj[this._obj.$_GID]}}has(t){if(t==null)return false;if(ha.supportWeakMap);else{if(typeof t=="string"||typeof t=="number")return this._obj[t]!=null;return this._obj[this._obj.$_GID]!=null}}}ha.supportWeakMap=false;ha.delInterval=10*60*1e3;ha._maps=[];class xa{static __init(){xa._funMap=new ha}static getBindFun(t){var e=xa._funMap.get(t);if(e==null){var a='"'+t+'"';a=a.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"');var i="(function(data){if(data==null)return;with(data){try{\nreturn "+a+"\n}catch(e){}}})";e=window.Laya._runScript(i);xa._funMap.set(t,e)}return e}static createByData(t,e){var a=da.create();t=xa.createComp(e,t,t,null,a);t._setBit(b.NOT_READY,true);if("_idMap"in t){t["_idMap"]=a._idMap}if(e.animations){var i=[];var r=e.animations;var s,n=r.length;var o;var l;for(s=0;s<n;s++){o=new _a;l=r[s];o._setUp(a._idMap,l);t[l.name]=o;o._setControlNode(t);switch(l.action){case 1:o.play(0,false);break;case 2:o.play(0,true);break}i.push(o)}t._aniList=i}if(t._$componentType==="Scene"&&t._width>0&&e.props.hitTestPrior==null&&!t.mouseThrough)t.hitTestPrior=true;a.beginLoad(t);return t}static createInitTool(){return da.create()}static createComp(t,e=null,a=null,i=null,r=null){if(t.type=="Scene3D"||t.type=="Sprite3D"){var s=[];var n=O.Laya["Utils3D"]._createSceneByJsonForMaker(t,s,r);if(t.type=="Sprite3D")O.Laya["StaticBatchManager"].combine(n,s);else O.Laya["StaticBatchManager"].combine(null,s);return n}e=e||xa.getCompInstance(t);if(!e){if(t.props&&t.props.runtime)console.warn("runtime not found:"+t.props.runtime);else console.warn("can not create:"+t.type);return null}var o=t.child;if(o){var l=e["_$componentType"]=="List";for(var _=0,h=o.length;_<h;_++){var x=o[_];if("itemRender"in e&&(x.props.name=="render"||x.props.renderType==="render")){e["itemRender"]=x}else if(x.type=="Graphic"){O.ClassUtils._addGraphicsToSprite(x,e)}else if(O.ClassUtils._isDrawType(x.type)){O.ClassUtils._addGraphicToSprite(x,e,true)}else{if(l){var c=[];var d=xa.createComp(x,null,a,c,r);if(c.length)d["_$bindData"]=c}else{d=xa.createComp(x,null,a,i,r)}if(x.type=="Script"){if(d instanceof na){e._addComponentInstance(d)}else{if("owner"in d){d["owner"]=e}else if("target"in d){d["target"]=e}}}else if(x.props.renderType=="mask"||x.props.name=="mask"){e.mask=d}else{d instanceof Ne&&e.addChild(d)}}}}var u=t.props;for(var f in u){var p=u[f];if(typeof p=="string"&&(p.indexOf("@node:")>=0||p.indexOf("@Prefab:")>=0)){if(r){r.addNodeRef(e,f,p)}}else xa.setCompValue(e,f,p,a,i)}if(e._afterInited){e._afterInited()}if(t.compId&&r&&r._idMap){r._idMap[t.compId]=e}return e}static setCompValue(t,e,a,i=null,r=null){if(typeof a=="string"&&a.indexOf("${")>-1){xa._sheet||(xa._sheet=O.ClassUtils.getClass("laya.data.Table"));if(!xa._sheet){console.warn("Can not find class Sheet");return}if(r){r.push(t,e,a)}else if(i){if(a.indexOf("].")==-1){a=a.replace(".","[0].")}var s=new ca(t,e,a);s.exe(i);var n,o;var l=a.replace(/\[.*?\]\./g,".");while((n=xa._parseWatchData.exec(l))!=null){var _=n[1];while((o=xa._parseKeyWord.exec(_))!=null){var h=o[0];var x=i._watchMap[h]||(i._watchMap[h]=[]);x.push(s);xa._sheet.I.notifer.on(h,i,i.changeData,[h])}x=i._watchMap[_]||(i._watchMap[_]=[]);x.push(s);xa._sheet.I.notifer.on(_,i,i.changeData,[_])}}return}if(e==="var"&&i){i[a]=t}else{t[e]=a==="true"?true:a==="false"?false:a}}static getCompInstance(t){if(t.type=="UIView"){if(t.props&&t.props.pageData){return xa.createByData(null,t.props.pageData)}}var e=t.props&&t.props.runtime||t.type;var a=O.ClassUtils.getClass(e);if(!a)throw"Can not find class "+e;if(t.type==="Script"&&a.prototype._doAwake){var i=u.createByClass(a);i._destroyed=false;return i}if(t.props&&"renderType"in t.props&&t.props["renderType"]=="instance"){if(!a["instance"])a["instance"]=new a;return a["instance"]}return new a}}xa._parseWatchData=/\${(.*?)}/g;xa._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g;class ca{constructor(t,e,a){this.comp=t;this.prop=e;this.value=a}exe(t){var e=xa.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)}}class da{reset(){this._nodeRefList=null;this._initList=null;this._idMap=null;this._loadList=null;this._scene=null}recover(){this.reset();u.recover("InitTool",this)}static create(){var t=u.getItemByClass("InitTool",da);t._idMap=[];return t}addLoadRes(t,e=null){if(!this._loadList)this._loadList=[];if(O.loader.getRes(t)){return}if(!e){this._loadList.push(t)}else{this._loadList.push({url:t,type:e})}}addNodeRef(t,e,a){if(!this._nodeRefList)this._nodeRefList=[];this._nodeRefList.push([t,e,a]);if(a.indexOf("@Prefab:")>=0){this.addLoadRes(a.replace("@Prefab:",""),V.PREFAB)}}setNodeRef(){if(!this._nodeRefList)return;if(!this._idMap){this._nodeRefList=null;return}var t,e;e=this._nodeRefList.length;var a;for(t=0;t<e;t++){a=this._nodeRefList[t];a[0][a[1]]=this.getReferData(a[2])}this._nodeRefList=null}getReferData(t){if(t.indexOf("@Prefab:")>=0){var e;e=V.getRes(t.replace("@Prefab:",""));return e}else if(t.indexOf("@arr:")>=0){t=t.replace("@arr:","");var a;a=t.split(",");var i,r;var s;r=a.length;for(i=0;i<r;i++){s=a[i];if(s){a[i]=this._idMap[s.replace("@node:","")]}else{a[i]=null}}return a}else{return this._idMap[t.replace("@node:","")]}}addInitItem(t){if(!this._initList)this._initList=[];this._initList.push(t)}doInits(){if(!this._initList)return;this._initList=null}finish(){this.setNodeRef();this.doInits();this._scene._setBit(b.NOT_READY,false);if(this._scene.parent&&this._scene.parent.activeInHierarchy&&this._scene.active)this._scene._processActive();this._scene.event("onViewCreated");this.recover()}beginLoad(t){this._scene=t;if(!this._loadList||this._loadList.length<1){this.finish()}else{O.loader.load(this._loadList,Q.create(this,this.finish))}}}class ua{show(t=0,e=0){}enable(){}hide(){}set_onclick(t){}isCanvasRender(){return true}renderNotCanvas(t,e,a){}}class fa extends ua{constructor(){super(...arguments);this._show=false;this._useCanvas=false;this._height=100;this._view=[]}show(t=0,e=0){if(!N.onMiniGame&&!O.Render.isConchApp&&!N.onBDMiniGame&&!N.onKGMiniGame&&!N.onQGMiniGame&&!N.onQQMiniGame&&!N.onAlipayMiniGame&&!N.onBLMiniGame&&!N.onTTMiniGame&&!N.onHWMiniGame&&!N.onTBMiniGame)this._useCanvas=true;this._show=true;g._fpsData.length=60;this._view[0]={title:"FPS(WebGL)",value:"_fpsStr",color:"yellow",units:"int"};this._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"};this._view[2]={title:"RenderBatches",value:"renderBatches",color:"white",units:"int"};this._view[3]={title:"SavedRenderBatches",value:"savedRenderBatches",color:"white",units:"int"};this._view[4]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"};this._view[5]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"};this._view[6]={title:"Shader",value:"shaderCall",color:"white",units:"int"};this._view[7]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};if(m.is3DMode){this._view[0].title="FPS(3D)";this._view[8]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"};this._view[9]={title:"FrustumCulling",value:"frustumCulling",color:"white",units:"int"};this._view[10]={title:"OctreeNodeCulling",value:"octreeNodeCulling",color:"white",units:"int"}}if(this._useCanvas){this.createUIPre(t,e)}else this.createUI(t,e);this.enable()}createUIPre(t,e){var a=N.pixelRatio;this._width=a*180;this._vx=a*120;this._height=a*(this._view.length*12+3*a)+4;fa._fontSize=12*a;for(var i=0;i<this._view.length;i++){this._view[i].x=4;this._view[i].y=i*fa._fontSize+2*a}if(!this._canvas){this._canvas=new Me(true);this._canvas.size(this._width,this._height);this._ctx=this._canvas.getContext("2d");this._ctx.textBaseline="top";this._ctx.font=fa._fontSize+"px Arial";this._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+e+"px;width:"+this._width/a+"px;height:"+this._height/a+"px;"}if(!N.onKGMiniGame){N.container.appendChild(this._canvas.source)}this._first=true;this.loop();this._first=false}createUI(t,e){var a=this._sp;var i=N.pixelRatio;if(!a){a=new Be;this._leftText=new F;this._leftText.pos(5,5);this._leftText.color="#ffffff";a.addChild(this._leftText);this._txt=new F;this._txt.pos(130*i,5);this._txt.color="#ffffff";a.addChild(this._txt);this._sp=a}a.pos(t,e);var r="";for(var s=0;s<this._view.length;s++){var n=this._view[s];r+=n.title+"\n"}this._leftText.text=r;var o=i*138;var l=i*(this._view.length*12+3*i)+4;this._txt.fontSize=fa._fontSize*i;this._leftText.fontSize=fa._fontSize*i;a.size(o,l);a.graphics.clear();a.graphics.alpha(.5);a.graphics.drawRect(0,0,o+110,l+30,"#999999");a.graphics.alpha(2);this.loop()}enable(){O.systemTimer.frameLoop(1,this,this.loop)}hide(){this._show=false;O.systemTimer.clear(this,this.loop);if(this._canvas){N.removeElement(this._canvas.source)}}set_onclick(t){if(this._sp){this._sp.on("click",this._sp,t)}if(this._canvas){this._canvas.source.onclick=t;this._canvas.source.style.pointerEvents=""}}loop(){g._count++;var t=N.now();if(t-g._timer<1e3)return;var e=g._count;g.FPS=Math.round(e*1e3/(t-g._timer));if(this._show){g.trianglesFaces=Math.round(g.trianglesFaces/e);if(!this._useCanvas){g.renderBatches=Math.round(g.renderBatches/e)-1}else{g.renderBatches=Math.round(g.renderBatches/e)}g.savedRenderBatches=Math.round(g.savedRenderBatches/e);g.shaderCall=Math.round(g.shaderCall/e);g.spriteRenderUseCacheCount=Math.round(g.spriteRenderUseCacheCount/e);g.canvasNormal=Math.round(g.canvasNormal/e);g.canvasBitmap=Math.round(g.canvasBitmap/e);g.canvasReCache=Math.ceil(g.canvasReCache/e);g.frustumCulling=Math.round(g.frustumCulling/e);g.octreeNodeCulling=Math.round(g.octreeNodeCulling/e);var a=g.FPS>0?Math.floor(1e3/g.FPS).toString():" ";g._fpsStr=g.FPS+(g.renderSlow?" slow":"")+" "+a;g._spriteStr=g.spriteCount+(g.spriteRenderUseCacheCount?"/"+g.spriteRenderUseCacheCount:"");g._canvasStr=g.canvasReCache+"/"+g.canvasNormal+"/"+g.canvasBitmap;g.cpuMemory=$.cpuMemory;g.gpuMemory=$.gpuMemory;if(this._useCanvas){this.renderInfoPre()}else this.renderInfo();g.clear()}g._count=0;g._timer=t}renderInfoPre(){var t=0;var e;var a;if(this._canvas){var i=this._ctx;i.clearRect(this._first?0:this._vx,0,this._width,this._height);for(t=0;t<this._view.length;t++){e=this._view[t];if(this._first){i.fillStyle="white";i.fillText(e.title,e.x,e.y)}i.fillStyle=e.color;a=g[e.value];e.units=="M"&&(a=Math.floor(a/(1024*1024)*100)/100+" M");i.fillText(a+"",e.x+this._vx,e.y)}}}renderInfo(){var t="";for(var e=0;e<this._view.length;e++){var a=this._view[e];var i=g[a.value];a.units=="M"&&(i=Math.floor(i/(1024*1024)*100)/100+" M");a.units=="K"&&(i=Math.floor(i/1024*100)/100+" K");t+=i+"\n"}this._txt.text=t}isCanvasRender(){return this._useCanvas}renderNotCanvas(t,e,a){this._show&&this._sp&&this._sp.render(t,0,0)}}fa._fontSize=12;class pa{constructor(t=true){this.scale=1;this.currTimer=Date.now();this.currFrame=0;this._delta=0;this._lastTimer=Date.now();this._map=[];this._handlers=[];this._temp=[];this._count=0;t&&pa.gSysTimer&&pa.gSysTimer.frameLoop(1,this,this._update)}get delta(){return this._delta}_update(){if(this.scale<=0){this._lastTimer=Date.now();this._delta=0;return}var t=this.currFrame=this.currFrame+this.scale;var e=Date.now();var a=e-this._lastTimer>3e4;this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var r=this._handlers;this._count=0;for(var s=0,n=r.length;s<n;s++){var o=r[s];if(o.method!==null){var l=o.userFrame?t:i;if(l>=o.exeTime){if(o.repeat){if(!o.jumpFrame||a){o.exeTime+=o.delay;o.run(false);if(l>o.exeTime){o.exeTime+=Math.ceil((l-o.exeTime)/o.delay)*o.delay}}else{while(l>=o.exeTime){o.exeTime+=o.delay;o.run(false)}}}else{o.run(true)}}}else{this._count++}}if(this._count>30||t%200===0)this._clearHandlers()}_clearHandlers(){var t=this._handlers;for(var e=0,a=t.length;e<a;e++){var i=t[e];if(i.method!==null)this._temp.push(i);else this._recoverHandler(i)}this._handlers=this._temp;t.length=0;this._temp=t}_recoverHandler(t){if(this._map[t.key]==t)this._map[t.key]=null;t.clear();pa._pool.push(t)}_create(t,e,a,i,r,s,n){if(!a){r.apply(i,s);return null}if(n){var o=this._getHandler(i,r);if(o){o.repeat=e;o.userFrame=t;o.delay=a;o.caller=i;o.method=r;o.args=s;o.exeTime=a+(t?this.currFrame:this.currTimer+Date.now()-this._lastTimer);return o}}o=pa._pool.length>0?pa._pool.pop():new ma;o.repeat=e;o.userFrame=t;o.delay=a;o.caller=i;o.method=r;o.args=s;o.exeTime=a+(t?this.currFrame:this.currTimer+Date.now()-this._lastTimer);this._indexHandler(o);this._handlers.push(o);return o}_indexHandler(t){var e=t.caller;var a=t.method;var i=e?e.$_GID||(e.$_GID=O.Utils.getGID()):0;var r=a.$_TID||(a.$_TID=pa._mid++*1e5);t.key=i+r;this._map[t.key]=t}once(t,e,a,i=null,r=true){this._create(false,false,t,e,a,i,r)}loop(t,e,a,i=null,r=true,s=false){var n=this._create(false,true,t,e,a,i,r);if(n)n.jumpFrame=s}frameOnce(t,e,a,i=null,r=true){this._create(true,false,t,e,a,i,r)}frameLoop(t,e,a,i=null,r=true){this._create(true,true,t,e,a,i,r)}toString(){return" handlers:"+this._handlers.length+" pool:"+pa._pool.length}clear(t,e){var a=this._getHandler(t,e);if(a){this._map[a.key]=null;a.key=0;a.clear()}}clearAll(t){if(!t)return;for(var e=0,a=this._handlers.length;e<a;e++){var i=this._handlers[e];if(i.caller===t){this._map[i.key]=null;i.key=0;i.clear()}}}_getHandler(t,e){var a=t?t.$_GID||(t.$_GID=O.Utils.getGID()):0;var i=e.$_TID||(e.$_TID=pa._mid++*1e5);return this._map[a+i]}callLater(t,e,a=null){ke.I.callLater(t,e,a)}runCallLater(t,e){ke.I.runCallLater(t,e)}runTimer(t,e){var a=this._getHandler(t,e);if(a&&a.method!=null){this._map[a.key]=null;a.run(true)}}pause(){this.scale=0}resume(){this.scale=1}}pa.gSysTimer=null;pa._pool=[];pa._mid=1;class ma{clear(){this.caller=null;this.method=null;this.args=null}run(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var a=this.method;var i=this.args;t&&this.clear();if(a==null)return;i?a.apply(e,i):a.call(e)}}class ga extends ht{constructor(t){super(D.SKINMESH,0);this.offsetX=300;this.offsetY=0;var e=p.mainContext;var a=8*te.BYTES_PE;this.position=[2,e.FLOAT,false,a,0];this.texcoord=[2,e.FLOAT,false,a,2*te.BYTES_PE];this.color=[4,e.FLOAT,false,a,4*te.BYTES_PE]}}class va extends ht{constructor(t){super(D.PRIMITIVE,0);this._attribLocation=["position",0,"attribColor",1]}}class ya extends ht{constructor(t=0){super(D.TEXTURE2D,t);this.strength=0;this.blurInfo=null;this.colorMat=null;this.colorAlpha=null;this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}clear(){this.texture=null;this.shader=null;this.defines._value=this.subID}}class Ta{constructor(t){this.codes={};this.funs={};this.curUseID=-1;this.funnames="";this.script=t;var e=0,a,i;while(true){e=t.indexOf("#begin",e);if(e<0)break;i=e+5;while(true){i=t.indexOf("#end",i);if(i<0)break;if(t.charAt(i+4)==="i")i+=5;else break}if(i<0){throw"add include err,no #end:"+t}a=t.indexOf("\n",e);var r=O.ShaderCompile.splitToWords(t.substr(e,a-e),null);if(r[1]=="code"){this.codes[r[2]]=t.substr(a+1,i-a-1)}else if(r[1]=="function"){a=t.indexOf("function",e);a+="function".length;this.funs[r[3]]=t.substr(a+1,i-a-1);this.funnames+=r[3]+";"}e=i+1}}getWith(t=null){var e=t?this.codes[t]:this.script;if(!e){throw"get with error:"+t}return e}getFunsScript(t){var e="";for(var a in this.funs){if(t.indexOf(a+";")>=0){e+=this.funs[a]}}return e}}class Ea{constructor(t){this.childs=[];this.text="";this.useFuns="";this.z=0;this.includefiles=t}setParent(t){t.childs.push(this);this.z=t.z+1;this.parent=t}setCondition(t,e){if(t){this.conditionType=e;t=t.replace(/(\s*$)/g,"");this.condition=function(){return this[t]};this.condition.__condition=t}}toscript(t,e){return this._toscript(t,e,++Ea.__id)}_toscript(i,r,s){if(this.childs.length<1&&!this.text)return r;var t=r.length;if(this.condition){var e=!!this.condition.call(i);this.conditionType===O.ShaderCompile.IFDEF_ELSE&&(e=!e);if(!e)return r}if(this.noCompile)this.text&&r.push(this.text);this.childs.length>0&&this.childs.forEach(function(t,e,a){t._toscript(i,r,s)});if(this.includefiles.length>0&&this.useFuns.length>0){var a;for(var n=0,o=this.includefiles.length;n<o;n++){if(this.includefiles[n].curUseID==s){continue}a=this.includefiles[n].file.getFunsScript(this.useFuns);if(a.length>0){this.includefiles[n].curUseID=s;r[0]=a+r[0]}}}return r}}Ea.__id=1;class ba{constructor(t,e,a){this.defs={};let i=this;function r(t){t=t.replace(ba._clearCR,"");var e=[];var a=new Ea(e);i._compileToTree(a,t.split("\n"),0,e,i.defs);return a}var s=Date.now();this._VS=r(t);this._PS=r(e);this._nameMap=a;if(Date.now()-s>2)console.log("ShaderCompile use time:"+(Date.now()-s)+"  size:"+t.length+"/"+e.length)}static __init__(){var t=f.instance;ba.shaderParamsMap={float:t.FLOAT,int:t.INT,bool:t.BOOL,vec2:t.FLOAT_VEC2,vec3:t.FLOAT_VEC3,vec4:t.FLOAT_VEC4,ivec2:t.INT_VEC2,ivec3:t.INT_VEC3,ivec4:t.INT_VEC4,bvec2:t.BOOL_VEC2,bvec3:t.BOOL_VEC3,bvec4:t.BOOL_VEC4,mat2:t.FLOAT_MAT2,mat3:t.FLOAT_MAT3,mat4:t.FLOAT_MAT4,sampler2D:t.SAMPLER_2D,samplerCube:t.SAMPLER_CUBE}}static _parseOne(t,e,a,i,r,s){var n={type:ba.shaderParamsMap[a[i+1]],name:a[i+2],size:isNaN(parseInt(a[i+3]))?1:parseInt(a[i+3])};if(s){if(r=="attribute"){t.push(n)}else{e.push(n)}}if(a[i+3]==":"){n.type=a[i+4];i+=2}i+=2;return i}static addInclude(t,e){if(!e||e.length===0)throw new Error("add shader include file err:"+t);if(ba.includes[t])throw new Error("add shader include file err, has add:"+t);ba.includes[t]=new Ta(e)}static preGetParams(t,e){var a=[t,e];var i={};var r=[];var s=[];var n={};var o=[];i.attributes=r;i.uniforms=s;i.defines=n;var l,_;for(var h=0;h<2;h++){a[h]=a[h].replace(ba._removeAnnotation,"");var x=a[h].match(ba._reg);var c;for(l=0,_=x.length;l<_;l++){var d=x[l];if(d!="attribute"&&d!="uniform"){if(d=="#define"){d=x[++l];o[d]=1;continue}else if(d=="#ifdef"){c=x[++l];var u=n[c]=n[c]||[];for(l++;l<_;l++){d=x[l];if(d!="attribute"&&d!="uniform"){if(d=="#else"){for(l++;l<_;l++){d=x[l];if(d!="attribute"&&d!="uniform"){if(d=="#endif"){break}continue}l=ba._parseOne(r,s,x,l,d,!o[c])}}continue}l=ba._parseOne(r,s,x,l,d,o[c])}}continue}l=ba._parseOne(r,s,x,l,d,true)}}return i}static splitToWords(t,e){var a=[];var i;var r=-1;var s;for(var n=0,o=t.length;n<o;n++){i=t.charAt(n);if(" \t=+-*/&%!<>()'\",;".indexOf(i)>=0){if(r>=0&&n-r>1){s=t.substr(r,n-r);a.push(s)}if(i=='"'||i=="'"){var l=t.indexOf(i,n+1);if(l<0){throw"Sharder err:"+t}a.push(t.substr(n+1,l-n-1));n=l;r=-1;continue}if(i=="("&&e&&a.length>0){s=a[a.length-1]+";";if("vec4;main;".indexOf(s)<0)e.useFuns+=s}r=-1;continue}if(r<0)r=n}if(r<o&&o-r>1){s=t.substr(r,o-r);a.push(s)}return a}_compileToTree(t,e,a,i,r){var s,n;var o,l,_;var h,x,c;var d,u,f;for(d=a;d<e.length;d++){o=e[d];if(o.length<1)continue;h=o.indexOf("//");if(h===0)continue;if(h>=0)o=o.substr(0,h);s=c||new Ea(i);c=null;s.text=o;s.noCompile=true;if((h=o.indexOf("#"))>=0){l="#";for(f=h+1,u=o.length;f<u;f++){var p=o.charAt(f);if(p===" "||p==="\t"||p==="?")break;l+=p}s.name=l;switch(l){case"#ifdef":case"#ifndef":s.src=o;s.noCompile=o.match(/[!&|()=<>]/)!=null;if(!s.noCompile){x=o.replace(/^\s*/,"").split(/\s+/);s.setCondition(x[1],l==="#ifdef"?ba.IFDEF_YES:ba.IFDEF_ELSE);s.text="//"+s.text}else{console.log("function():Boolean{return "+o.substr(h+s.name.length)+"}")}s.setParent(t);t=s;if(r){x=o.substr(f).split(ba._splitToWordExps3);for(f=0;f<x.length;f++){o=x[f];o.length&&(r[o]=true)}}continue;case"#if":s.src=o;s.noCompile=true;s.setParent(t);t=s;if(r){x=o.substr(f).split(ba._splitToWordExps3);for(f=0;f<x.length;f++){o=x[f];o.length&&o!="defined"&&(r[o]=true)}}continue;case"#else":s.src=o;t=t.parent;n=t.childs[t.childs.length-1];s.noCompile=n.noCompile;if(!s.noCompile){s.condition=n.condition;s.conditionType=n.conditionType==ba.IFDEF_YES?ba.IFDEF_ELSE:ba.IFDEF_YES;s.text="//"+s.text+" "+n.text+" "+s.conditionType}s.setParent(t);t=s;continue;case"#endif":t=t.parent;n=t.childs[t.childs.length-1];s.noCompile=n.noCompile;if(!s.noCompile){s.text="//"+s.text}s.setParent(t);continue;case"#include":x=ba.splitToWords(o,null);var m=ba.includes[x[1]];if(!m){throw"ShaderCompile error no this include file:"+x[1]}if((h=x[0].indexOf("?"))<0){s.setParent(t);o=m.getWith(x[2]=="with"?x[3]:null);this._compileToTree(s,o.split("\n"),0,i,r);s.text="";continue}s.setCondition(x[0].substr(h+1),ba.IFDEF_YES);s.text=m.getWith(x[2]=="with"?x[3]:null);break;case"#import":x=ba.splitToWords(o,null);_=x[1];i.push({node:s,file:ba.includes[_],ofs:s.text.length});continue}}else{n=t.childs[t.childs.length-1];if(n&&!n.name){i.length>0&&ba.splitToWords(o,n);c=s;n.text+="\n"+o;continue}i.length>0&&ba.splitToWords(o,s)}s.setParent(t)}}createShader(t,e,a,i){var r={};var s="";if(t){for(var n in t){s+="#define "+n+"\n";r[n]=true}}var o=this._VS.toscript(r,[]);var l=this._PS.toscript(r,[]);return(a||lt.create)(s+o.join("\n"),s+l.join("\n"),e,this._nameMap,i)}}ba.IFDEF_NO=0;ba.IFDEF_YES=1;ba.IFDEF_ELSE=2;ba.IFDEF_PARENT=3;ba._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g");ba._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g");ba._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g");ba.includes={};ba._clearCR=new RegExp("\r","g");ba._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g");class Sa extends e{constructor(){super();this.worker=new Worker(Sa.workerPath);let e=this;this.worker.onmessage=function(t){e.workerMessage(t.data)}}static __init__(){if(Sa._preLoadFun!=null)return false;if(!Worker)return false;Sa._preLoadFun=V["prototype"]["_loadImage"];V["prototype"]["_loadImage"]=Sa["prototype"]["_loadImage"];if(!Sa.I)Sa.I=new Sa;return true}static workerSupported(){return Worker?true:false}static enableWorkerLoader(){if(!Sa._tryEnabled){Sa.enable=true;Sa._tryEnabled=true}}static set enable(t){if(Sa._enable!=t){Sa._enable=t;if(t&&Sa._preLoadFun==null)Sa._enable=Sa.__init__()}}static get enable(){return Sa._enable}workerMessage(t){if(t){switch(t.type){case"Image":this.imageLoaded(t);break;case"Disable":Sa.enable=false;break}}}imageLoaded(t){if(!t.dataType||t.dataType!="imageBitmap"){this.event(t.url,null);return}var e=t.imageBitmap;console.log("load:",t.url);this.event(t.url,e)}loadImage(t){this.worker.postMessage(t)}_loadImage(a){var i=this;let r=i.type;if(!this._useWorkerLoader||!Sa._enable){Sa._preLoadFun.call(i,a);return}a=I.formatURL(a);function s(){Sa.I.off(a,i,t)}var t=function(t){s();if(t){var e=t;if(r!=="nativeimage"){e=new at;e.loadImageSource(t)}i["onLoaded"](e)}else{Sa._preLoadFun.call(i,a)}};Sa.I.on(a,i,t);Sa.I.loadImage(a)}}Sa.workerPath="libs/workerloader.js";Sa._enable=false;Sa._tryEnabled=false;class Ca{static set cursor(t){Ca._style.cursor=t}static get cursor(){return Ca._style.cursor}static __init__(){Ca._style=N.document.body.style}static hide(){if(Ca.cursor!="none"){Ca._preCursor=Ca.cursor;Ca.cursor="none"}}static show(){if(Ca.cursor=="none"){if(Ca._preCursor){Ca.cursor=Ca._preCursor}else{Ca.cursor="auto"}}}}class Ra extends Ut{constructor(t){super(Ra.const_stride,t*4*Ra.const_stride,4);this.canReuse=true;this.setAttributes(Ra._fixattriInfo);this.createQuadIB(t);this._quadNum=t}static __init__(){var t=f.instance;Ra._fixattriInfo=[t.FLOAT,4,0,t.FLOAT,3,16,t.FLOAT,3,28,t.FLOAT,4,40,t.FLOAT,4,56,t.FLOAT,3,72,t.FLOAT,2,84,t.FLOAT,4,92,t.FLOAT,1,108,t.FLOAT,1,112]}setMaxParticleNum(t){this._vb._resizeBuffer(t*4*Ra.const_stride,false);this.createQuadIB(t)}static getAMesh(t){if(Ra._POOL.length){var e=Ra._POOL.pop();e.setMaxParticleNum(t);return e}return new Ra(t)}releaseMesh(){this._vb.setByteLength(0);this.vertNum=0;this.indexNum=0;Ra._POOL.push(this)}destroy(){this._ib.destroy();this._vb.destroy();this._vb.deleteBuffer()}}Ra.const_stride=116;Ra._POOL=[];class Aa extends a{}Aa.create=function(t,e,a){var i=new at(t,e,a,false,false);i.wrapModeU=A.WarpMode.Clamp;i.wrapModeV=A.WarpMode.Clamp;return i};class x{static __init(t){t.forEach(function(t){t.__init$&&t.__init$()})}static init(t,e,...a){if(x._isinit)return;x._isinit=true;ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=x._arrayBufferSlice);N.__init__();var i=N.mainCanvas=new Me(true);var r=i.source.style;r.position="absolute";r.top=r.left="0px";r.background="#000000";if(!N.onKGMiniGame&&!N.onAlipayMiniGame){N.container.appendChild(i.source)}N.canvas=new Me(true);N.context=N.canvas.getContext("2d");N.supportWebAudio=h.__init__();N.supportLocalStorage=ta.__init__();x.systemTimer=new pa(false);A.systemTimer=pa.gSysTimer=x.systemTimer;x.startTimer=new pa(false);x.physicsTimer=new pa(false);x.updateTimer=new pa(false);x.lateTimer=new pa(false);x.timer=new pa(false);A.startTimer=O.startTimer=x.startTimer;A.lateTimer=O.lateTimer=x.lateTimer;A.updateTimer=O.updateTimer=x.updateTimer;O.systemTimer=x.systemTimer;A.timer=O.timer=x.timer;A.physicsTimer=O.physicsTimer=x.physicsTimer;x.loader=new Je;O.Laya=x;A.loader=O.loader=x.loader;ha.__init__();xa.__init();Ca.__init__();pe.inner_enable();if(a){for(var s=0,n=a.length;s<n;s++){if(a[s]&&a[s].enable){a[s].enable()}}}if(O.Render.isConchApp){x.enableNative()}x.enableWebGLPlus();Ce.beginCheck();A.stage=x.stage=new S;O.stage=x.stage;w.gStage=x.stage;I.rootPath=I._basePath=x._getUrlPath();kt.__int__();Ht.__init__();Gt.__init__();x.render=new m(0,0,N.mainCanvas);A.render=x.render;x.stage.size(t,e);window.stage=x.stage;p.__init__();Ra.__init__();ba.__init__();Ie.__init__();ze.__init__();Ue.instance.__init__(x.stage,m.canvas);l.__init__();h.autoStopMusic=true;g._StatRender=new fa;ht._initone(D.TEXTURE2D,ya);ht._initone(D.TEXTURE2D|D.FILTERGLOW,ya);ht._initone(D.PRIMITIVE,va);ht._initone(D.SKINMESH,ga);return m.canvas}static _getUrlPath(){return I.getPath(location.protocol+"//"+location.host+location.pathname)}static _arrayBufferSlice(t,e){var a=this;var i=new Uint8Array(a,t,e-t);var r=new Uint8Array(i.length);r.set(i);return r.buffer}static alertGlobalError(t){var s=0;if(t){N.window.onerror=function(t,e,a,i,r){if(s++<5&&r)this.alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+r.stack)}}else{N.window.onerror=null}}static _runScript(t){return N.window[x._evcode](t)}static enableDebugPanel(t="libs/laya.debugtool.js"){if(!window["Laya"]["DebugPanel"]){var e=N.createElement("script");e.onload=function(){window["Laya"]["DebugPanel"].enable()};e.src=t;N.document.body.appendChild(e)}else{window["Laya"]["DebugPanel"].enable()}}static enableWebGLPlus(){p.__init_native()}static enableNative(){if(x.isNativeRender_enable)return;x.isNativeRender_enable=true;if(m.supportWebGLPlusRendering){lt.prototype.uploadTexture2D=function(t){var e=f.instance;e.bindTexture(e.TEXTURE_2D,t)}}_.width=N.window.innerWidth;_.height=N.window.innerHeight;N.measureText=function(t,e){window["conchTextCanvas"].font=e;return window["conchTextCanvas"].measureText(t)};S.clear=function(t){W.set2DRenderConfig();var e=ut.create(t).arrColor;var a=f.instance;if(e)a.clearColor(e[0],e[1],e[2],e[3]);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);_.clear()};Be.drawToCanvas=Be.drawToTexture=function(t,e,a,i,r,s){r-=t.x;s-=t.y;r|=0;s|=0;a|=0;i|=0;var n=new Me(false);var o=n.getContext("2d");n.size(a,i);o.asBitmap=true;o._targets.start();Ie.renders[e]._fun(t,o,r,s);o.flush();o._targets.end();o._targets.restore();return n};Object["defineProperty"](rt.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}});Me.prototype.getTexture=function(){if(!this._texture){this._texture=this.context._targets;this._texture.uv=rt.flipyuv;this._texture.bitmap=this._texture}return this._texture}}}x.stage=null;x.systemTimer=null;x.startTimer=null;x.physicsTimer=null;x.updateTimer=null;x.lateTimer=null;x.timer=null;x.loader=null;x.version="2.9.0";x._isinit=false;x.isWXOpenDataContext=false;x.isWXPosMsg=false;x.__classmap=null;x.Config=n;x.TextRender=B;x.EventDispatcher=e;x.SoundChannel=We;x.Stage=S;x.Render=m;x.Browser=N;x.Sprite=Be;x.Node=Ne;x.Context=W;x.WebGL=pe;x.Handler=Q;x.RunDriver=He;x.Utils=w;x.Input=l;x.Loader=V;x.LocalStorage=ta;x.SoundManager=h;x.URL=I;x.Event=P;x.Matrix=L;x.HTMLImage=Aa;x.Laya=x;x._evcode="eva"+"l";x.isNativeRender_enable=false;x.__classmap=O.__classMap;O.Timer=pa;O.Dragging=sa;O.GraphicsBounds=v;O.Sprite=Be;O.TextRender=B;O.Loader=V;O.TTFLoader=aa;O.WebAudioSound=r;O.SoundManager=h;O.ShaderCompile=ba;O.ClassUtils=d;O.SceneUtils=xa;O.Context=W;O.Render=m;O.MouseManager=Ue;O.Text=F;O.Browser=N;O.WebGL=pe;O.AudioSound=Ye;O.Pool=u;O.Utils=w;O.Graphics=Ae;O.Submit=ee;O.Stage=S;O.Resource=$;O.WorkerLoader=Sa;var La=window._layalibs;if(La){La.sort(function(t,e){return t.i-e.i});for(var Ia=0;Ia<La.length;Ia++){La[Ia].f(window,window.document,x)}}let Ma=window;if(Ma.Laya){Ma.Laya.Laya=x;Object.assign(Ma.Laya,x)}else Ma.Laya=x;var Da=x.__init;var wa=x.init;var Pa=x.version;var Oa;var Na;var Ba=x.alertGlobalError;var Fa=x.enableDebugPanel;function Va(a,i){for(var r=0,t=i.length;r<t;r+=2){if(i[r]=="length")a.length=i[r+1].call(a);else{function e(){var e=i[r];var t=i[r+1];Object.defineProperty(a,e,{get:function(){delete this[e];return this[e]=t.call(this)},set:function(t){delete this[e];this[e]=t},enumerable:true,configurable:true})}e()}}}class Ua extends na{get isSingleton(){return false}constructor(){super()}onAwake(){}onEnable(){}onStart(){}onUpdate(){}onLateUpdate(){}onDisable(){}onDestroy(){}}class ka extends na{get isSingleton(){return false}_onAwake(){this.onAwake();if(this.onStart!==ka.prototype.onStart){O.startTimer.callLater(this,this.onStart)}}_onEnable(){var t=ka.prototype;if(this.onTriggerEnter!==t.onTriggerEnter){this.owner.on(P.TRIGGER_ENTER,this,this.onTriggerEnter)}if(this.onTriggerStay!==t.onTriggerStay){this.owner.on(P.TRIGGER_STAY,this,this.onTriggerStay)}if(this.onTriggerExit!==t.onTriggerExit){this.owner.on(P.TRIGGER_EXIT,this,this.onTriggerExit)}if(this.onMouseDown!==t.onMouseDown){this.owner.on(P.MOUSE_DOWN,this,this.onMouseDown)}if(this.onMouseUp!==t.onMouseUp){this.owner.on(P.MOUSE_UP,this,this.onMouseUp)}if(this.onClick!==t.onClick){this.owner.on(P.CLICK,this,this.onClick)}if(this.onStageMouseDown!==t.onStageMouseDown){O.stage.on(P.MOUSE_DOWN,this,this.onStageMouseDown)}if(this.onStageMouseUp!==t.onStageMouseUp){O.stage.on(P.MOUSE_UP,this,this.onStageMouseUp)}if(this.onStageClick!==t.onStageClick){O.stage.on(P.CLICK,this,this.onStageClick)}if(this.onStageMouseMove!==t.onStageMouseMove){O.stage.on(P.MOUSE_MOVE,this,this.onStageMouseMove)}if(this.onDoubleClick!==t.onDoubleClick){this.owner.on(P.DOUBLE_CLICK,this,this.onDoubleClick)}if(this.onRightClick!==t.onRightClick){this.owner.on(P.RIGHT_CLICK,this,this.onRightClick)}if(this.onMouseMove!==t.onMouseMove){this.owner.on(P.MOUSE_MOVE,this,this.onMouseMove)}if(this.onMouseOver!==t.onMouseOver){this.owner.on(P.MOUSE_OVER,this,this.onMouseOver)}if(this.onMouseOut!==t.onMouseOut){this.owner.on(P.MOUSE_OUT,this,this.onMouseOut)}if(this.onKeyDown!==t.onKeyDown){O.stage.on(P.KEY_DOWN,this,this.onKeyDown)}if(this.onKeyPress!==t.onKeyPress){O.stage.on(P.KEY_PRESS,this,this.onKeyPress)}if(this.onKeyUp!==t.onKeyUp){O.stage.on(P.KEY_UP,this,this.onKeyUp)}if(this.onUpdate!==t.onUpdate){O.updateTimer.frameLoop(1,this,this.onUpdate)}if(this.onLateUpdate!==t.onLateUpdate){O.lateTimer.frameLoop(1,this,this.onLateUpdate)}if(this.onPreRender!==t.onPreRender){O.lateTimer.frameLoop(1,this,this.onPreRender)}this.onEnable()}_onDisable(){this.owner.offAllCaller(this);O.stage.offAllCaller(this);O.startTimer.clearAll(this);O.updateTimer.clearAll(this);O.lateTimer.clearAll(this)}_isScript(){return true}_onDestroy(){this.onDestroy()}onAwake(){}onEnable(){}onStart(){}onTriggerEnter(t,e,a){}onTriggerStay(t,e,a){}onTriggerExit(t,e,a){}onMouseDown(t){}onMouseUp(t){}onClick(t){}onStageMouseDown(t){}onStageMouseUp(t){}onStageClick(t){}onStageMouseMove(t){}onDoubleClick(t){}onRightClick(t){}onMouseMove(t){}onMouseOver(t){}onMouseOut(t){}onKeyDown(t){}onKeyPress(t){}onKeyUp(t){}onUpdate(){}onLateUpdate(){}onPreRender(){}onPostRender(){}onDisable(){}onDestroy(){}}class Ga extends _a{constructor(){super(...arguments);this._nodeIDAniDic={}}_parseNodeList(t){if(!this._nodeList)this._nodeList=[];this._nodeDefaultProps[t.compId]=t.props;if(t.compId)this._nodeList.push(t.compId);var e=t.child;if(e){var a,i=e.length;for(a=0;a<i;a++){this._parseNodeList(e[a])}}}_calGraphicData(t){this._setUp(null,t);this._createGraphicData();if(this._nodeIDAniDic){var e;for(e in this._nodeIDAniDic){this._nodeIDAniDic[e]=null}}}_createGraphicData(){var t=[];var e,a=this.count;var i=this._usedFrames;if(!i)i=[];var r;for(e=0;e<a;e++){if(i[e]||!r){r=this._createFrameGraphic(e)}t.push(r)}this._gList=t}_createFrameGraphic(t){var e=new Ae;if(!Ga._rootMatrix)Ga._rootMatrix=new L;this._updateNodeGraphic(this._rootNode,t,Ga._rootMatrix,e);return e}_updateNodeGraphic(t,e,a,i,r=1){var s;s=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]);if(!s.resultTransform)s.resultTransform=new L;var n;n=s.resultTransform;L.mul(s.transform,a,n);var o;var l=s.alpha*r;if(l<.01)return;if(s.skin){o=this._getTextureByUrl(s.skin);if(o){if(n._checkTransform()){i.drawTexture(o,0,0,s.width,s.height,n,l);s.resultTransform=null}else{i.drawTexture(o,n.tx,n.ty,s.width,s.height,null,l)}}}var _=t.child;if(!_)return;var h,x;x=_.length;for(h=0;h<x;h++){this._updateNodeGraphic(_[h],e,n,i,l)}}_updateNoChilds(t,e){if(!t.skin)return;var a=this._getTextureByUrl(t.skin);if(!a)return;var i=t.transform;i._checkTransform();var r;r=!i._bTransform;if(!r){e.drawTexture(a,0,0,t.width,t.height,i.clone(),t.alpha)}else{e.drawTexture(a,i.tx,i.ty,t.width,t.height,null,t.alpha)}}_updateNodeGraphic2(t,e,a){var i;i=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]);if(!t.child){this._updateNoChilds(i,a);return}var r=i.transform;r._checkTransform();var s;s=!r._bTransform;var n;n=s&&(r.tx!=0||r.ty!=0);var o;o=r._bTransform||i.alpha!=1;if(o)a.save();if(i.alpha!=1)a.alpha(i.alpha);if(!s)a.transform(r.clone());else if(n)a.translate(r.tx,r.ty);var l=t.child;var _;if(i.skin){_=this._getTextureByUrl(i.skin);if(_){a.drawImage(_,0,0,i.width,i.height)}}if(l){var h,x;x=l.length;for(h=0;h<x;h++){this._updateNodeGraphic2(l[h],e,a)}}if(o){a.restore()}else{if(!s){a.transform(r.clone().invert())}else if(n){a.translate(-r.tx,-r.ty)}}}_calculateKeyFrames(t){super._calculateKeyFrames(t);this._nodeIDAniDic[t.target]=t}getNodeDataByID(t){return this._nodeIDAniDic[t]}_getParams(t,e,a,i){var r=Ga._temParam;r.length=e.length;var s,n=e.length;for(s=0;s<n;s++){r[s]=this._getObjVar(t,e[s][0],a,e[s][1],i)}return r}_getObjVar(t,e,a,i,r){if(e in t){var s=t[e];if(a>=s.length)a=s.length-1;return t[e][a]}if(e in r){return r[e]}return i}_getNodeGraphicData(t,e,a){if(!a)a=new Ha;if(!a.transform){a.transform=new L}else{a.transform.identity()}var i=this.getNodeDataByID(t);if(!i)return a;var r=i.frames;var s=this._getParams(r,Ga._drawTextureCmd,e,this._nodeDefaultProps[t]);var n=s[0];var o,l;var _=s[5],h=s[6];var x=s[13],c=s[14];var d=s[7],u=s[8];var f=s[9];var p=s[11],m=s[12];o=s[3];l=s[4];if(o==0||l==0)n=null;if(o==-1)o=0;if(l==-1)l=0;var g;a.skin=n;a.width=o;a.height=l;if(n){g=this._getTextureByUrl(n);if(g){if(!o)o=g.sourceWidth;if(!l)l=g.sourceHeight}else{console.warn("lost skin:",n,",you may load pics first")}}a.alpha=s[10];var v=a.transform;if(x!=0){_=x*o}if(c!=0){h=c*l}if(_!=0||h!=0){v.translate(-_,-h)}var y=null;if(f||d!==1||u!==1||p||m){y=Ga._tempMt;y.identity();y._bTransform=true;var T=(f-p)*.0174532922222222;var E=(f+m)*.0174532922222222;var b=Math.cos(E);var S=Math.sin(E);var C=Math.sin(T);var R=Math.cos(T);y.a=d*b;y.b=d*S;y.c=-u*C;y.d=u*R;y.tx=y.ty=0}if(y){v=L.mul(v,y,v)}v.translate(s[1],s[2]);return a}_getTextureByUrl(t){return V.getRes(t)}setAniData(t,e=null){if(t.animations){this._nodeDefaultProps={};this._nodeGDic={};if(this._nodeList)this._nodeList.length=0;this._rootNode=t;this._parseNodeList(t);var a={};var i=[];var r=t.animations;var s,n=r.length;var o;for(s=0;s<n;s++){o=r[s];this._labels=null;if(e&&e!=o.name){continue}if(!o)continue;try{this._calGraphicData(o)}catch(t){console.warn("parse animation fail:"+o.name+",empty animation created");this._gList=[]}var l={};l.interval=1e3/o["frameRate"];l.frames=this._gList;l.labels=this._labels;l.name=o.name;i.push(l);a[o.name]=l}this.animationList=i;this.animationDic=a}Ga._temParam.length=0}parseByData(t){var e,a;e=t.nodeRoot;a=t.aniO;delete t.nodeRoot;delete t.aniO;this._nodeDefaultProps={};this._nodeGDic={};if(this._nodeList)this._nodeList.length=0;this._rootNode=e;this._parseNodeList(e);this._labels=null;try{this._calGraphicData(a)}catch(t){console.warn("parse animation fail:"+a.name+",empty animation created");this._gList=[]}var i=t;i.interval=1e3/a["frameRate"];i.frames=this._gList;i.labels=this._labels;i.name=a.name;return i}setUpAniData(t){if(t.animations){var e={};var a=[];var i=t.animations;var r,s=i.length;var n;for(r=0;r<s;r++){n=i[r];if(!n)continue;var o={};o.name=n.name;o.aniO=n;o.nodeRoot=t;a.push(o);e[n.name]=o}this.animationList=a;this.animationDic=e}}_clear(){this.animationList=null;this.animationDic=null;this._gList=null;this._nodeGDic=null}static parseAnimationByData(t){if(!Ga._I)Ga._I=new Ga;var e;e=Ga._I.parseByData(t);Ga._I._clear();return e}static parseAnimationData(t){if(!Ga._I)Ga._I=new Ga;Ga._I.setUpAniData(t);var e;e={};e.animationList=Ga._I.animationList;e.animationDic=Ga._I.animationDic;Ga._I._clear();return e}}Ga._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]];Ga._temParam=[];Ga._tempMt=new L;class Ha{constructor(){this.alpha=1}}class za extends oa{constructor(){super();this._setControlNode(this)}destroy(t=true){this.stop();super.destroy(t);this._frames=null;this._labels=null}play(t=0,e=true,a=""){if(a)this._setFramesFromCache(a,true);super.play(t,e,a)}_setFramesFromCache(t,e=false){if(this._url)t=this._url+"#"+t;if(t&&za.framesMap[t]){var a=za.framesMap[t];if(a instanceof Array){this._frames=za.framesMap[t];this._count=this._frames.length}else{if(a.nodeRoot){za.framesMap[t]=Ga.parseAnimationByData(a);a=za.framesMap[t]}this._frames=a.frames;this._count=this._frames.length;if(!this._frameRateChanged)this._interval=a.interval;this._labels=this._copyLabels(a.labels)}return true}else{if(e)console.log("ani not found:",t)}return false}_copyLabels(t){if(!t)return null;var e;e={};var a;for(a in t){e[a]=w.copyArray([],t[a])}return e}_frameLoop(){if(this._visible&&this._style.alpha>.01&&this._frames){super._frameLoop()}}_displayToIndex(t){if(this._frames)this.graphics=this._frames[t]}get frames(){return this._frames}set frames(t){this._frames=t;if(t){this._count=t.length;if(this._actionName)this._setFramesFromCache(this._actionName,true);this.index=this._index}}set source(t){if(t.indexOf(".ani")>-1)this.loadAnimation(t);else if(t.indexOf(".json")>-1||t.indexOf("als")>-1||t.indexOf("atlas")>-1)this.loadAtlas(t);else this.loadImages(t.split(","))}set autoAnimation(t){this.play(0,true,t)}set autoPlay(t){if(t)this.play();else this.stop()}clear(){super.clear();this.stop();this.graphics=null;this._frames=null;this._labels=null;return this}loadImages(t,e=""){this._url="";if(!this._setFramesFromCache(e)){this.frames=za.framesMap[e]?za.framesMap[e]:za.createFrames(t,e)}return this}loadAtlas(e,a=null,i=""){this._url="";var r=this;if(!r._setFramesFromCache(i)){function t(t){if(e===t){r.frames=za.framesMap[i]?za.framesMap[i]:za.createFrames(e,i);if(a)a.run()}}if(V.getAtlas(e))t(e);else O.loader.load(e,Q.create(null,t,[e]),null,V.ATLAS)}return this}loadAnimation(t,e=null,a=null){this._url=t;var i=this;if(!this._actionName)this._actionName="";if(!i._setFramesFromCache(this._actionName)){if(!a||V.getAtlas(a)){this._loadAnimationData(t,e,a)}else{O.loader.load(a,Q.create(this,this._loadAnimationData,[t,e,a]),null,V.ATLAS)}}else{i._setFramesFromCache(this._actionName,true);this.index=0;if(e)e.run()}return this}_loadAnimationData(o,l=null,t=null){if(t&&!V.getAtlas(t)){console.warn("atlas load fail:"+t);return}var _=this;function e(t){if(!V.getRes(t)){if(za.framesMap[o+"#"]){_._setFramesFromCache(_._actionName,true);_.index=0;_._resumePlay();if(l)l.run()}return}if(o===t){var e;if(!za.framesMap[o+"#"]){var a=Ga.parseAnimationData(V.getRes(o));if(!a)return;var i=a.animationList;var r,s=i.length;var n;for(r=0;r<s;r++){e=i[r];za.framesMap[o+"#"+e.name]=e;if(!n)n=e}if(n){za.framesMap[o+"#"]=n;_._setFramesFromCache(_._actionName,true);_.index=0}_._resumePlay()}else{_._setFramesFromCache(_._actionName,true);_.index=0;_._resumePlay()}if(l)l.run()}V.clearRes(o)}if(V.getRes(o))e(o);else O.loader.load(o,Q.create(null,e,[o]),null,V.JSON)}static createFrames(t,e){var a;if(typeof t=="string"){var i=V.getAtlas(t);if(i&&i.length){a=[];for(var r=0,s=i.length;r<s;r++){var n=new Ae;n.drawImage(V.getRes(i[r]),0,0);a.push(n)}}}else if(t instanceof Array){a=[];for(r=0,s=t.length;r<s;r++){n=new Ae;n.loadImage(t[r],0,0);a.push(n)}}if(e)za.framesMap[e]=a;return a}static clearCache(t){var e=za.framesMap;var a;var i=t+"#";for(a in e){if(a===t||a.indexOf(i)===0){delete za.framesMap[a]}}}}za.framesMap={};O.regClass(za);d.regClass("laya.display.Animation",za);d.regClass("Laya.Animation",za);class Wa extends _a{constructor(){super(...arguments);this._initData={}}set target(t){if(this._target)this._target.off(Wa.EFFECT_BEGIN,this,this._onOtherBegin);this._target=t;if(this._target)this._target.on(Wa.EFFECT_BEGIN,this,this._onOtherBegin);this._addEvent()}get target(){return this._target}_onOtherBegin(t){if(t===this)return;this.stop()}set playEvent(t){this._playEvent=t;if(!t)return;this._addEvent()}_addEvent(){if(!this._target||!this._playEvent)return;this._setControlNode(this._target);this._target.on(this._playEvent,this,this._onPlayAction)}_onPlayAction(){this.play(0,false)}play(t=0,e=true,a=""){if(!this._target)return;this._target.event(Wa.EFFECT_BEGIN,[this]);this._recordInitData();super.play(t,e,a)}_recordInitData(){if(!this._aniKeys)return;var t,e;e=this._aniKeys.length;var a;for(t=0;t<e;t++){a=this._aniKeys[t];this._initData[a]=this._target[a]}}set effectClass(t){this._effectClass=d.getClass(t);if(this._effectClass){var e=this._effectClass["uiView"];if(e){var a=e["animations"];if(a&&a[0]){var i=a[0];this._setUp({},i);if(i.nodes&&i.nodes[0]){this._aniKeys=i.nodes[0].keys}}}}}set effectData(t){if(t){var e=t["animations"];if(e&&e[0]){var a=e[0];this._setUp({},a);if(a.nodes&&a.nodes[0]){this._aniKeys=a.nodes[0].keys}}}}_displayToIndex(t){if(!this._animationData)return;if(t<0)t=0;if(t>this._count)t=this._count;var e=this._animationData.nodes,a,i=e.length;i=i>1?1:i;for(a=0;a<i;a++){this._displayNodeToFrame(e[a],t)}}_displayNodeToFrame(t,e,a=null){if(!this._target)return;var i=this._target;var r=t.frames,s,n,o;var l=t.keys,_,h=l.length;var x=t.secondFrames;var c;var d;var u;var f;var p;for(_=0;_<h;_++){s=l[_];n=r[s];c=x[s];if(c==-1){o=this._initData[s]}else{if(e<c){u=t.keyframes[s];f=u[0];if(f.tween){d=ia[f.tweenMethod];if(d==null)d=ia.linearNone;p=u[1];o=d(e,this._initData[s],p.value-this._initData[s],p.index)}else{o=this._initData[s]}}else{if(n.length>e)o=n[e];else o=n[n.length-1]}}i[s]=o}}_calculateKeyFrames(t){super._calculateKeyFrames(t);var e=t.keyframes,a,i,r=t.target;var s={};t.secondFrames=s;for(a in e){i=e[a];if(i.length<=1)s[a]=-1;else s[a]=i[1].index}}}Wa.EFFECT_BEGIN="effectbegin";d.regClass("laya.display.EffectAnimation",Wa);d.regClass("Laya.EffectAnimation",Wa);class Xa extends e{constructor(){super();this._completeHandler=new Q(this,this.onOneLoadComplete);this.reset()}reset(){this._toLoadList=[];this._isLoading=false;this.totalCount=0}get leftCount(){if(this._isLoading)return this._toLoadList.length+1;return this._toLoadList.length}get loadedCount(){return this.totalCount-this.leftCount}load(t,e=false,a=true){if(t instanceof Array){var i,r;r=t.length;for(i=0;i<r;i++){this._addToLoadList(t[i],e)}}else{this._addToLoadList(t,e)}if(a)this._checkNext()}_addToLoadList(t,e=false){if(this._toLoadList.indexOf(t)>=0)return;if(V.getRes(t))return;if(e){this._toLoadList.push({url:t})}else this._toLoadList.push(t);this.totalCount++}_checkNext(){if(!this._isLoading){if(this._toLoadList.length==0){this.event(P.COMPLETE);return}var t;t=this._toLoadList.pop();if(typeof t=="string"){this.loadOne(t)}else{this.loadOne(t.url,true)}}}loadOne(t,e=false){this._curUrl=t;var a=w.getFileExtension(this._curUrl);if(e){O.loader.create(t,this._completeHandler)}else if(Xa.LoadableExtensions[a]){O.loader.load(t,this._completeHandler,null,Xa.LoadableExtensions[a])}else if(t!=Qe.getFileLoadPath(t)||Xa.No3dLoadTypes[a]||!Je.createMap[a]){O.loader.load(t,this._completeHandler)}else{O.loader.create(t,this._completeHandler)}}onOneLoadComplete(){this._isLoading=false;if(!V.getRes(this._curUrl)){console.log("Fail to load:",this._curUrl)}var t=w.getFileExtension(this._curUrl);if(Xa.LoadableExtensions[t]){var e;e=V.getRes(this._curUrl);if(e&&e instanceof qe){e=e.json}if(e){if(e.loadList){this.load(e.loadList,false,false)}if(e.loadList3D){this.load(e.loadList3D,true,false)}}}if(t=="sk"){this.load(this._curUrl.replace(".sk",".png"),false,false)}this.event(P.PROGRESS,this.getProgress());this._checkNext()}getProgress(){return this.loadedCount/this.totalCount}}Xa.LoadableExtensions={scene:V.JSON,scene3d:V.JSON,ani:V.JSON,ui:V.JSON,prefab:V.PREFAB};Xa.No3dLoadTypes={png:true,jpg:true,txt:true};class Ya extends Be{constructor(t=true){super();this.autoDestroyAtClosed=false;this.url=null;this._viewCreated=false;this._$componentType="Scene";Ya.unDestroyedScenes.push(this);this._scene=this;if(t)this.createChildren()}createChildren(){}static setUIMap(t){let e=O.loader.getRes(t);if(e){for(let t in e){O.Loader.loadedMap[I.formatURL(t+".scene")]=e[t]}}else{throw"请提前加载uimap的json，再使用该接口设置！"}}loadScene(t){var e=t.indexOf(".")>-1?t:t+".scene";var a=O.loader.getRes(e);if(a){this.createView(a)}else{this._setBit(b.NOT_READY,true);O.loader.resetProgress();var i=new Xa;i.on(P.COMPLETE,this,this._onSceneLoaded,[e]);i.load(e)}}_onSceneLoaded(t){this.createView(O.Loader.getRes(t))}createView(t){if(t&&!this._viewCreated){this._viewCreated=true;xa.createByData(this,t)}}getNodeByID(t){if(this._idMap)return this._idMap[t];return null}open(t=true,e=null){if(t)Ya.closeAll();Ya.root.addChild(this);this.onOpened(e)}onOpened(t){}close(t=null){this.onClosed(t);if(this.autoDestroyAtClosed)this.destroy();else this.removeSelf()}onClosed(t=null){}destroy(t=true){this._idMap=null;super.destroy(t);var e=Ya.unDestroyedScenes;for(var a=e.length-1;a>-1;a--){if(e[a]===this){e.splice(a,1);return}}}set scaleX(t){if(super.get_scaleX()==t)return;super.set_scaleX(t);this.event(P.RESIZE)}get scaleX(){return super.scaleX}set scaleY(t){if(super.get_scaleY()==t)return;super.set_scaleY(t);this.event(P.RESIZE)}get scaleY(){return super.scaleY}get width(){if(this._width)return this._width;var t=0;for(var e=this.numChildren-1;e>-1;e--){var a=this.getChildAt(e);if(a._visible){t=Math.max(a._x+a.width*a.scaleX,t)}}return t}set width(t){if(super.get_width()==t)return;super.set_width(t);this.callLater(this._sizeChanged)}get height(){if(this._height)return this._height;var t=0;for(var e=this.numChildren-1;e>-1;e--){var a=this.getChildAt(e);if(a._visible){t=Math.max(a._y+a.height*a.scaleY,t)}}return t}set height(t){if(super.get_height()==t)return;super.set_height(t);this.callLater(this._sizeChanged)}_sizeChanged(){this.event(P.RESIZE)}static get root(){if(!Ya._root){Ya._root=O.stage.addChild(new Be);Ya._root.name="root";O.stage.on("resize",null,()=>{Ya._root.size(O.stage.width,O.stage.height);Ya._root.event(P.RESIZE)});Ya._root.size(O.stage.width,O.stage.height);Ya._root.event(P.RESIZE)}return Ya._root}get timer(){return this._timer||O.timer}set timer(t){this._timer=t}static load(r,s=null,e=null){O.loader.resetProgress();var n=new Xa;n.on(P.PROGRESS,null,o);n.once(P.COMPLETE,null,t);n.load(r);function o(t){if(Ya._loadPage)Ya._loadPage.event("progress",t);e&&e.runWith(t)}function t(){n.off(P.PROGRESS,null,o);var t=O.Loader.getRes(r);if(!t)throw"Can not find scene:"+r;if(!t.props)throw"Scene data is error:"+r;var e=t.props.runtime?t.props.runtime:t.type;var a=O.ClassUtils.getClass(e);if(t.props.renderType=="instance"){var i=a.instance||(a.instance=new a)}else{i=new a}if(i&&i instanceof Ne){i.url=r;if(i._viewCreated){s&&s.runWith(i)}else{i.on("onViewCreated",null,function(){s&&s.runWith(i)});i.createView(t)}Ya.hideLoadingPage()}else{throw"Can not find scene:"+e}}}static open(t,e=true,a=null,i=null,r=null){if(a instanceof Q){var s=i;i=a;a=s}Ya.showLoadingPage();Ya.load(t,Q.create(null,this._onSceneLoaded,[e,i,a]),r)}static _onSceneLoaded(t,e,a,i){i.open(t,a);if(e)e.runWith(i)}static close(t,e=""){var a=false;var i=Ya.unDestroyedScenes;for(var r=0,s=i.length;r<s;r++){var n=i[r];if(n&&n.parent&&n.url===t&&n.name==e){n.close();a=true}}return a}static closeAll(){var t=Ya.root;for(var e=0,a=t.numChildren;e<a;e++){var i=t.getChildAt(0);if(i instanceof Ya)i.close();else i.removeSelf()}}static destroy(t,e=""){var a=false;var i=[].concat(Ya.unDestroyedScenes);for(var r=0,s=i.length;r<s;r++){var n=i[r];if(n.url===t&&n.name==e&&!n.destroyed){n.destroy();a=true}}return a}static gc(){$.destroyUnusedResources()}static setLoadingPage(t){if(Ya._loadPage!=t){Ya._loadPage=t}}static showLoadingPage(t=null,e=500){if(Ya._loadPage){O.systemTimer.clear(null,Ya._showLoading);O.systemTimer.clear(null,Ya._hideLoading);O.systemTimer.once(e,null,Ya._showLoading,[t],false)}}static _showLoading(t){O.stage.addChild(Ya._loadPage);Ya._loadPage.onOpened(t)}static _hideLoading(){Ya._loadPage.close()}static hideLoadingPage(t=500){if(Ya._loadPage){O.systemTimer.clear(null,Ya._showLoading);O.systemTimer.clear(null,Ya._hideLoading);O.systemTimer.once(t,null,Ya._hideLoading)}}}Ya.unDestroyedScenes=[];O.regClass(Ya);d.regClass("laya.display.Scene",Ya);d.regClass("Laya.Scene",Ya);class ja{static create(t){var e=u.getItemByClass("DrawParticleCmd",ja);e._templ=t;return e}recover(){this._templ=null;u.recover("DrawParticleCmd",this)}run(t,e,a){t.drawParticle(e,a,this._templ)}get cmdID(){return ja.ID}}ja.ID="DrawParticleCmd";class qa{constructor(){}paramChanged(){x.systemTimer.callLater(this,this.buildFilter)}buildFilter(){if(this._target){this.addFilter(this._target)}}addFilter(t){if(!t)return;if(!t.filters){t.filters=[this._filter]}else{var e;e=t.filters;if(e.indexOf(this._filter)<0){e.push(this._filter);t.filters=w.copyArray([],e)}}}removeFilter(t){if(!t)return;t.filters=null}set target(t){if(this._target!=t){this._target=t;this.paramChanged()}}}class Za{render(t,e,a,i,r){var s=ht.create(D.TEXTURE2D,0);this.setShaderInfo(s,r,t.width,t.height);e.drawTarget(t,0,0,a,i,L.EMPTY.identity(),s)}setShaderInfo(t,e,a,i){t.defines.add(dt.BLUR);var r=t;Za.blurinfo[0]=a;Za.blurinfo[1]=i;r.blurInfo=Za.blurinfo;var s=e.strength/3;var n=s*s;e.strength_sig2_2sig2_gauss1[0]=e.strength;e.strength_sig2_2sig2_gauss1[1]=n;e.strength_sig2_2sig2_gauss1[2]=2*n;e.strength_sig2_2sig2_gauss1[3]=1/(2*Math.PI*n);r.strength_sig2_2sig2_gauss1=e.strength_sig2_2sig2_gauss1}}Za.blurinfo=new Array(2);class Ka extends dt{constructor(t=4){super();this.strength_sig2_2sig2_gauss1=[];this.strength=t;this._glRender=new Za}get type(){return dt.BLUR}getStrenth_sig2_2sig2_native(){if(!this.strength_sig2_native){this.strength_sig2_native=new Float32Array(4)}var t=this.strength/3;var e=t*t;this.strength_sig2_native[0]=this.strength;this.strength_sig2_native[1]=e;this.strength_sig2_native[2]=2*e;this.strength_sig2_native[3]=1/(2*Math.PI*e);return this.strength_sig2_native}}class Qa extends qa{constructor(){super();this._strength=4;this._filter=new Ka(this.strength)}buildFilter(){this._filter=new Ka(this.strength);super.buildFilter()}get strength(){return this._strength}set strength(t){this._strength=t}}class Ja{constructor(){this._curState=0;this.effectScale=1.5;this.tweenTime=300}set target(t){this._tar=t;t.on(P.MOUSE_DOWN,this,this.toChangedState);t.on(P.MOUSE_UP,this,this.toInitState);t.on(P.MOUSE_OUT,this,this.toInitState)}toChangedState(){this._curState=1;if(this._curTween)ra.clear(this._curTween);this._curTween=ra.to(this._tar,{scaleX:this.effectScale,scaleY:this.effectScale},this.tweenTime,ia[this.effectEase],Q.create(this,this.tweenComplete))}toInitState(){if(this._curState==2)return;if(this._curTween)ra.clear(this._curTween);this._curState=2;this._curTween=ra.to(this._tar,{scaleX:1,scaleY:1},this.tweenTime,ia[this.backEase],Q.create(this,this.tweenComplete))}tweenComplete(){this._curState=0;this._curTween=null}}class $a extends qa{constructor(){super();this._brightness=0;this._contrast=0;this._saturation=0;this._hue=0;this._red=0;this._green=0;this._blue=0;this._alpha=0;this._filter=new ft}buildFilter(){this._filter.reset();this._filter.color(this.red,this.green,this.blue,this.alpha);this._filter.adjustHue(this.hue);this._filter.adjustContrast(this.contrast);this._filter.adjustBrightness(this.brightness);this._filter.adjustSaturation(this.saturation);super.buildFilter()}get brightness(){return this._brightness}set brightness(t){this._brightness=t;this.paramChanged()}get contrast(){return this._contrast}set contrast(t){this._contrast=t;this.paramChanged()}get saturation(){return this._saturation}set saturation(t){this._saturation=t;this.paramChanged()}get hue(){return this._hue}set hue(t){this._hue=t;this.paramChanged()}get red(){return this._red}set red(t){this._red=t;this.paramChanged()}get green(){return this._green}set green(t){this._green=t;this.paramChanged()}get blue(){return this._blue}set blue(t){this._blue=t;this.paramChanged()}get color(){return this._color}set color(t){this._color=t;var e;e=ut.create(t);this._red=e.arrColor[0]*255;this._green=e.arrColor[1]*255;this._blue=e.arrColor[2]*255;this.paramChanged()}get alpha(){return this._alpha}set alpha(t){this._alpha=t;this.paramChanged()}}class ti extends na{constructor(){super(...arguments);this.duration=1e3;this.delay=0;this.repeat=0;this.autoDestroyAtComplete=true}_onAwake(){this.target=this.target||this.owner;if(this.autoDestroyAtComplete)this._comlete=Q.create(this.target,this.target.destroy,null,false);if(this.eventName)this.owner.on(this.eventName,this,this._exeTween);else this._exeTween()}_exeTween(){this._tween=this._doTween();this._tween.repeat=this.repeat}_doTween(){return null}onReset(){this.duration=1e3;this.delay=0;this.repeat=0;this.ease=null;this.target=null;if(this.eventName){this.owner.off(this.eventName,this,this._exeTween);this.eventName=null}if(this._comlete){this._comlete.recover();this._comlete=null}if(this._tween){this._tween.clear();this._tween=null}}}class ei extends ti{_doTween(){this.target.alpha=0;return ra.to(this.target,{alpha:1},this.duration,ia[this.ease],this._comlete,this.delay)}}class ai extends ti{_doTween(){this.target.alpha=1;return ra.to(this.target,{alpha:0},this.duration,ia[this.ease],this._comlete,this.delay)}}class ii{setShaderInfo(t,e,a,i){t.defines.add(i.type);var r=t;r.u_blurInfo1=i._sv_blurInfo1;var s=i._sv_blurInfo2;s[0]=e;s[1]=a;r.u_blurInfo2=s;r.u_color=i.getColor()}render(t,e,a,i,r){var s=a,n=i;var o=ht.create(D.TEXTURE2D,0);this.setShaderInfo(o,s,n,r);var l=ht.create(D.TEXTURE2D,0);var _=L.TEMP.identity();e.drawTarget(t,0,0,s,n,_,o);e.drawTarget(t,0,0,s,n,_,l)}}class ri extends dt{constructor(t,e=4,a=6,i=6){super();this._elements=new Float32Array(9);this._sv_blurInfo1=new Array(4);this._sv_blurInfo2=[0,0,1,0];this._color=new ut(t);this.blur=Math.min(e,20);this.offX=a;this.offY=i;this._sv_blurInfo1[0]=this._sv_blurInfo1[1]=this.blur;this._sv_blurInfo1[2]=a;this._sv_blurInfo1[3]=-i;this._glRender=new ii}get type(){return Ka.GLOW}get offY(){return this._elements[6]}set offY(t){this._elements[6]=t;this._sv_blurInfo1[3]=-t}get offX(){return this._elements[5]}set offX(t){this._elements[5]=t;this._sv_blurInfo1[2]=t}getColor(){return this._color.arrColor}get blur(){return this._elements[4]}set blur(t){this._elements[4]=t;this._sv_blurInfo1[0]=this._sv_blurInfo1[1]=t}getColorNative(){if(!this._color_native){this._color_native=new Float32Array(4)}var t=this.getColor();this._color_native[0]=t[0];this._color_native[1]=t[1];this._color_native[2]=t[2];this._color_native[3]=t[3];return this._color_native}getBlurInfo1Native(){if(!this._blurInof1_native){this._blurInof1_native=new Float32Array(4)}this._blurInof1_native[0]=this._blurInof1_native[1]=this.blur;this._blurInof1_native[2]=this.offX;this._blurInof1_native[3]=this.offY;return this._blurInof1_native}getBlurInfo2Native(){if(!this._blurInof2_native){this._blurInof2_native=new Float32Array(4)}this._blurInof2_native[2]=1;return this._blurInof2_native}}class si extends qa{constructor(){super();this._color="#ff0000";this._blur=4;this._offX=6;this._offY=6;this._filter=new ri(this._color)}buildFilter(){this._filter=new ri(this.color,this.blur,this.offX,this.offY);super.buildFilter()}get color(){return this._color}set color(t){this._color=t;this.paramChanged()}get blur(){return this._blur}set blur(t){this._blur=t;this.paramChanged()}get offX(){return this._offX}set offX(t){this._offX=t;this.paramChanged()}get offY(){return this._offY}set offY(t){this._offY=t;this.paramChanged()}}class ni{}ni.STANDARD=0;ni.LEFT=1;ni.RIGHT=2;ni.NUM_PAD=3;class t{}t.NUMBER_0=48;t.NUMBER_1=49;t.NUMBER_2=50;t.NUMBER_3=51;t.NUMBER_4=52;t.NUMBER_5=53;t.NUMBER_6=54;t.NUMBER_7=55;t.NUMBER_8=56;t.NUMBER_9=57;t.A=65;t.B=66;t.C=67;t.D=68;t.E=69;t.F=70;t.G=71;t.H=72;t.I=73;t.J=74;t.K=75;t.L=76;t.M=77;t.N=78;t.O=79;t.P=80;t.Q=81;t.R=82;t.S=83;t.T=84;t.U=85;t.V=86;t.W=87;t.X=88;t.Y=89;t.Z=90;t.F1=112;t.F2=113;t.F3=114;t.F4=115;t.F5=116;t.F6=117;t.F7=118;t.F8=119;t.F9=120;t.F10=121;t.F11=122;t.F12=123;t.F13=124;t.F14=125;t.F15=126;t.NUMPAD=21;t.NUMPAD_0=96;t.NUMPAD_1=97;t.NUMPAD_2=98;t.NUMPAD_3=99;t.NUMPAD_4=100;t.NUMPAD_5=101;t.NUMPAD_6=102;t.NUMPAD_7=103;t.NUMPAD_8=104;t.NUMPAD_9=105;t.NUMPAD_ADD=107;t.NUMPAD_DECIMAL=110;t.NUMPAD_DIVIDE=111;t.NUMPAD_ENTER=108;t.NUMPAD_MULTIPLY=106;t.NUMPAD_SUBTRACT=109;t.SEMICOLON=186;t.EQUAL=187;t.COMMA=188;t.MINUS=189;t.PERIOD=190;t.SLASH=191;t.BACKQUOTE=192;t.LEFTBRACKET=219;t.BACKSLASH=220;t.RIGHTBRACKET=221;t.QUOTE=222;t.ALTERNATE=18;t.BACKSPACE=8;t.CAPS_LOCK=20;t.COMMAND=15;t.CONTROL=17;t.DELETE=46;t.ENTER=13;t.ESCAPE=27;t.PAGE_UP=33;t.PAGE_DOWN=34;t.END=35;t.HOME=36;t.LEFT=37;t.UP=38;t.RIGHT=39;t.DOWN=40;t.SHIFT=16;t.SPACE=32;t.TAB=9;t.INSERT=45;class oi{constructor(t,e,a,i){this._idata=[]}getArrayData(){return this._idata}getPtrID(){return 0}beginEncoding(){}endEncoding(){}clearEncoding(){this._idata.length=0}getCount(){return this._idata.length}add_ShaderValue(t){this._idata.push(t)}addShaderUniform(t){this.add_ShaderValue(t)}}class li{static uploadShaderUniforms(t,e,a,i){var r=a._data;var s=e.getArrayData();var n=0;for(var o=0,l=s.length;o<l;o++){var _=s[o];if(i||_.textureID!==-1){var h=r[_.dataOffset];if(h!=null)n+=_.fun.call(_.caller,_,h)}}return n}static uploadCustomUniform(t,e,a,i){var r=0;var s=e[a];if(s&&i!=null)r+=s.fun.call(s.caller,s,i);return r}static uploadShaderUniformsForNative(t,e,a){var i=f.UPLOAD_SHADER_UNIFORM_TYPE_ID;if(a._runtimeCopyValues.length>0){i=f.UPLOAD_SHADER_UNIFORM_TYPE_DATA}var r=a._data;return f.instance.uploadShaderUniforms(e,r,i)}}class s{constructor(){}static getMCDName(t){return s._typeToNameDic[t]}static showRenderTypeInfo(t,e=false){if(!e&&s.showedDic[t])return;s.showedDic[t]=true;if(!s._rendertypeToStrDic[t]){var a=[];var i;i=1;while(i<=t){if(i&t){a.push(s.getMCDName(i&t))}i=i<<1}s._rendertypeToStrDic[t]=a.join(",")}console.log("cmd:",s._rendertypeToStrDic[t])}static __init__(){s._typeToNameDic[T.ALPHA]="ALPHA";s._typeToNameDic[T.TRANSFORM]="TRANSFORM";s._typeToNameDic[T.TEXTURE]="TEXTURE";s._typeToNameDic[T.GRAPHICS]="GRAPHICS";s._typeToNameDic[T.ONECHILD]="ONECHILD";s._typeToNameDic[T.CHILDS]="CHILDS";s._typeToNameDic[T.TRANSFORM|T.ALPHA]="TRANSFORM|ALPHA";s._typeToNameDic[T.CANVAS]="CANVAS";s._typeToNameDic[T.BLEND]="BLEND";s._typeToNameDic[T.FILTERS]="FILTERS";s._typeToNameDic[T.MASK]="MASK";s._typeToNameDic[T.CLIP]="CLIP";s._typeToNameDic[T.LAYAGL3D]="LAYAGL3D"}render(t,e,a){s._addType(this._renderType);s.showRenderTypeInfo(this._renderType);Ie.renders[this._renderType]._fun(this,t,e+this._x,a+this._y);this._repaint=0}_stageRender(t,e,a){s._countStart();s._PreStageRender.call(O.stage,t,e,a);s._countEnd()}static _countStart(){var t;for(t in s._countDic){s._countDic[t]=0}}static _countEnd(){s._i++;if(s._i>60){s.showCountInfo();s._i=0}}static _addType(t){if(!s._countDic[t]){s._countDic[t]=1}else{s._countDic[t]+=1}}static showCountInfo(){console.log("===================");var t;for(t in s._countDic){console.log("count:"+s._countDic[t]);s.showRenderTypeInfo(t,true)}}static enableQuickTest(){s.__init__();Be["prototype"]["render"]=s["prototype"]["render"];s._PreStageRender=S["prototype"]["render"];S["prototype"]["render"]=s["prototype"]["_stageRender"]}}s.showedDic={};s._rendertypeToStrDic={};s._typeToNameDic={};s._countDic={};s._i=0;class _i extends e{load(t){}play(t=0,e=0){return null}get duration(){return 0}dispose(){}}class hi extends Be{constructor(){super();this.visible=false;this.on(P.ADDED,this,this._onParentChange);this.on(P.REMOVED,this,this._onParentChange)}_onParentChange(){this.target=this.parent}play(t=1,e=null){if(isNaN(t)){t=1}if(!this.url)return;this.stop();this._channel=h.playSound(this.url,t,e)}stop(){if(this._channel&&!this._channel.isStopped){this._channel.stop()}this._channel=null}_setPlayAction(t,e,a,i=true){if(!this[a])return;if(!t)return;if(i){t.on(e,this,this[a])}else{t.off(e,this,this[a])}}_setPlayActions(t,e,a,i=true){if(!t)return;if(!e)return;var r=e.split(",");var s,n;n=r.length;for(s=0;s<n;s++){this._setPlayAction(t,r[s],a,i)}}set playEvent(t){this._playEvents=t;if(!t)return;if(this._tar){this._setPlayActions(this._tar,t,"play")}}set target(t){if(this._tar){this._setPlayActions(this._tar,this._playEvents,"play",false);this._setPlayActions(this._tar,this._stopEvents,"stop",false)}this._tar=t;if(this._tar){this._setPlayActions(this._tar,this._playEvents,"play",true);this._setPlayActions(this._tar,this._stopEvents,"stop",true)}}set stopEvent(t){this._stopEvents=t;if(!t)return;if(this._tar){this._setPlayActions(this._tar,t,"stop")}}}d.regClass("laya.media.SoundNode",hi);d.regClass("Laya.SoundNode",hi);class xi{static enable(t,e,a=2){xi.type=a;O.loader.load(t,Q.create(null,xi.onManifestLoaded,[e]),null,V.JSON)}static onManifestLoaded(t,e){xi.manifest=e;I.customFormat=xi.addVersionPrefix;t.run();if(!e){console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")}}static addVersionPrefix(t){t=I.getAdptedFilePath(t);if(xi.manifest&&xi.manifest[t]){if(xi.type==xi.FILENAME_VERSION)return xi.manifest[t];return xi.manifest[t]+"/"+t}return t}}xi.FOLDER_VERSION=1;xi.FILENAME_VERSION=2;xi.type=xi.FOLDER_VERSION;class ci extends e{constructor(t=null,e=0,a=null,i=null){super();this.disableInput=false;this.protocols=[];this._byteClass=a?a:tt;this.protocols=i;this.endian=ci.BIG_ENDIAN;if(t&&e>0&&e<65535)this.connect(t,e)}get input(){return this._input}get output(){return this._output}get connected(){return this._connected}get endian(){return this._endian}set endian(t){this._endian=t;if(this._input!=null)this._input.endian=t;if(this._output!=null)this._output.endian=t}connect(t,e){var a="ws://"+t+":"+e;this.connectByUrl(a)}connectByUrl(t){if(this._socket!=null)this.close();this._socket&&this.cleanSocket();if(!this.protocols||this.protocols.length==0){this._socket=new N.window.WebSocket(t)}else{this._socket=new N.window.WebSocket(t,this.protocols)}this._socket.binaryType="arraybuffer";this._output=new this._byteClass;this._output.endian=this.endian;this._input=new this._byteClass;this._input.endian=this.endian;this._addInputPosition=0;this._socket.onopen=t=>{this._onOpen(t)};this._socket.onmessage=t=>{this._onMessage(t)};this._socket.onclose=t=>{this._onClose(t)};this._socket.onerror=t=>{this._onError(t)}}cleanSocket(){this.close();this._connected=false;this._socket.onopen=null;this._socket.onmessage=null;this._socket.onclose=null;this._socket.onerror=null;this._socket=null}close(){if(this._socket!=null){try{this._socket.close()}catch(t){}}}_onOpen(t){this._connected=true;this.event(P.OPEN,t)}_onMessage(t){if(!t||!t.data)return;var e=t.data;if(this.disableInput&&e){this.event(P.MESSAGE,e);return}if(this._input.length>0&&this._input.bytesAvailable<1){this._input.clear();this._addInputPosition=0}var a=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0);this._input.pos=this._addInputPosition;if(e){if(typeof e=="string"){this._input.writeUTFBytes(e)}else{this._input.writeArrayBuffer(e)}this._addInputPosition=this._input.pos;this._input.pos=a}this.event(P.MESSAGE,e)}_onClose(t){this._connected=false;this.event(P.CLOSE,t)}_onError(t){this.event(P.ERROR,t)}send(t){this._socket.send(t)}flush(){if(this._output&&this._output.length>0){var e;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(t){e=t}this._output.endian=this.endian;this._output.clear();if(e)this.event(P.ERROR,e)}}}ci.LITTLE_ENDIAN="littleEndian";ci.BIG_ENDIAN="bigEndian";(function(t){t[t["Normal"]=0]="Normal";t[t["RGBM"]=1]="RGBM"})(A.TextureDecodeFormat||(A.TextureDecodeFormat={}));class di extends i{constructor(){var t=f.instance;super(t.RGB,false);this._glTextureType=t.TEXTURE_2D;this._width=1;this._height=1;this._wrapModeU=this._wrapModeV=A.WarpMode.Clamp;this._filterMode=A.FilterMode.Bilinear;this._setWarpMode(t.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(t.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._needUpdate=false;this._readyed=true;di._videoTexturePool.push(this)}static _update(){var t=di._videoTexturePool;for(var e=0,a=t.length;e<a;e++){var i=t[e];i&&i._updateVideoData()}}get video(){return this._video}set video(t){if(!t||!(t instanceof HTMLVideoElement))return;this._video=t;if(x.Browser.onMobile){this._video["x5-playsInline"]=true;this._video["x5-playsinline"]=true;this._video.x5PlaysInline=true;this._video.playsInline=true;this._video["webkit-playsInline"]=true;this._video["webkit-playsinline"]=true;this._video.webkitPlaysInline=true;this._video.playsinline=true;this._video.style.playsInline=true;this._video.crossOrigin="anonymous";this._video.setAttribute("crossorigin","anonymous");this._video.setAttribute("playsinline","true");this._video.setAttribute("x5-playsinline","true");this._video.setAttribute("webkit-playsinline","true");this._video.autoplay=true}}_updateVideoData(){if(!this._video||!this._needUpdate)return;var t=f.instance;p.bindTexture(t,this._glTextureType,this._glTexture);t.texImage2D(this._glTextureType,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,this._video)}videoPlay(){this._video.play();this._needUpdate=true}videoPause(){this._video.pause();this._needUpdate=false}destroy(){super.destroy();this._video=null}}di._videoTexturePool=new Array;class ui{static changeDefinition(t,e){window.Laya[t]=e;var a=t+"=classObj";window["eval"](a)}}class fi{constructor(){this.reset()}setData(t,e,a,i){this.char=t;this.charNum=t.charCodeAt(0);this.x=this.y=0;this.width=e;this.height=a;this.style=i;this.isWord=!fi._isWordRegExp.test(t);return this}reset(){this.x=this.y=this.width=this.height=0;this.isWord=false;this.char=null;this.charNum=0;this.style=null;return this}recover(){u.recover("HTMLChar",this.reset())}static create(){return u.getItemByClass("HTMLChar",fi)}_isChar(){return true}_getCSSStyle(){return this.style}}fi._isWordRegExp=new RegExp("[\\w.]","");class pi{static enable(){if(!pi._logdiv){pi._logdiv=N.createElement("div");pi._logdiv.style.cssText="border:white;padding:4px;overflow-y:auto;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;";N.document.body.appendChild(pi._logdiv);pi._btn=N.createElement("button");pi._btn.innerText="Hide";pi._btn.style.cssText="z-index:1000001;position: absolute;left:10px;top:10px;";pi._btn.onclick=pi.toggle;N.document.body.appendChild(pi._btn)}}static toggle(){var t=pi._logdiv.style;if(t.display===""){pi._btn.innerText="Show";t.display="none"}else{pi._btn.innerText="Hide";t.display=""}}static print(t){if(pi._logdiv){if(pi._count>=pi.maxCount)pi.clear();pi._count++;pi._logdiv.innerText+=t+"\n";if(pi.autoScrollToBottom){if(pi._logdiv.scrollHeight-pi._logdiv.scrollTop-pi._logdiv.clientHeight<50){pi._logdiv.scrollTop=pi._logdiv.scrollHeight}}}}static clear(){pi._logdiv.innerText="";pi._count=0}}pi._count=0;pi.maxCount=50;pi.autoScrollToBottom=true;let mi=300;class gi{constructor(t,e,a,i){this.scale=1;this.datas=new Array(mi);this.datapos=0;this.id=t;this.color=e;this.name=a;this.scale=i}addData(t){this.datas[this.datapos]=t;this.datapos++;this.datapos%=mi}}class vi extends Be{constructor(){super();this.datas=[];this.xdata=new Array(vi.DATANUM);this.ydata=new Array(vi.DATANUM);this.hud_width=800;this.hud_height=200;this.gMinV=0;this.gMaxV=100;this.textSpace=40;this.sttm=0;vi.inst=this;this._renderType|=T.CUSTOM;this._setRenderType(this._renderType);this._setCustomRender();this.addDataDef(0,16777215,"frame",1);this.addDataDef(1,65280,"update",1);this.addDataDef(2,16711680,"flush",1);vi._now=performance?performance.now.bind(performance):Date.now}now(){return vi._now()}start(){this.sttm=vi._now()}end(t){var e=vi._now()-this.sttm;this.updateValue(t,e)}config(t,e){this.hud_width=t;this.hud_height=e}addDataDef(t,e,a,i){this.datas[t]=new gi(t,e,a,i)}updateValue(t,e){this.datas[t].addData(e)}v2y(t){var e=this._y+this.hud_height*(1-(t-this.gMinV)/this.gMaxV);return this._y+this.hud_height*(1-(t-this.gMinV)/this.gMaxV)}drawHLine(t,e,a,i){var r=this._x;var s=this._x+this.hud_width;var n=this.v2y(e);t.fillText(i,r,n-6,null,"green",null);r+=this.textSpace;t.fillStyle=a;t.fillRect(r,n,this._x+this.hud_width,1,null)}customRender(t,e,a){var i=performance.now();if(vi._lastTm<=0)vi._lastTm=i;this.updateValue(0,i-vi._lastTm);vi._lastTm=i;t.save();t.fillRect(this._x,this._y,this.hud_width,this.hud_height+4,"#000000cc");t.globalAlpha=.9;this.drawHLine(t,0,"green","    0");this.drawHLine(t,10,"green","  10");this.drawHLine(t,16.667,"red"," ");this.drawHLine(t,20,"green","50|20");this.drawHLine(t,16.667*2,"yellow","");this.drawHLine(t,16.667*3,"yellow","");this.drawHLine(t,16.667*4,"yellow","");this.drawHLine(t,50,"green","20|50");this.drawHLine(t,100,"green","10|100");for(var r=0,s=this.datas.length;r<s;r++){var n=this.datas[r];if(!n)continue;var o=n.datas.length;var l=(this.hud_width-this.textSpace)/o;var _=n.datapos;var h=this._x+this.textSpace;t.fillStyle=n.color;for(var x=o;_<x;_++){var c=this.v2y(n.datas[_]*n.scale);t.fillRect(h,c,l,this.hud_height+this._y-c,null);h+=l}for(_=0;_<n.datapos;_++){c=this.v2y(n.datas[_]*n.scale);t.fillRect(h,c,l,this.hud_height+this._y-c,null);h+=l}}t.restore()}}vi._lastTm=0;vi._now=null;vi.DATANUM=300;vi.drawTexTm=0;class yi{constructor(){this.maxCount=1e3}getCacheList(){return u.getPoolBySign(this.sign)}tryDispose(t){var e;e=u.getPoolBySign(this.sign);if(e.length>this.maxCount){e.splice(this.maxCount,e.length-this.maxCount)}}static addPoolCacheManager(t,e=100){var a;a=new yi;a.sign=t;a.maxCount=e;Ce.regCacheByFunction(w.bind(a.tryDispose,a),w.bind(a.getCacheList,a))}}class Ti extends e{constructor(){super(...arguments);this._tweenDic={};this._tweenDataList=[];this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this._firstTweenDic={};this._startTimeSort=false;this._endTimeSort=false;this._loopKey=false;this.scale=1;this._frameRate=60;this._frameIndex=0;this._total=0}static to(t,e,a,i=null,r=0){return(new Ti).to(t,e,a,i,r)}static from(t,e,a,i=null,r=0){return(new Ti).from(t,e,a,i,r)}to(t,e,a,i=null,r=0){return this._create(t,e,a,i,r,true)}from(t,e,a,i=null,r=0){return this._create(t,e,a,i,r,false)}_create(t,e,a,i,r,s){var n=u.getItemByClass("tweenData",Ei);n.isTo=s;n.type=0;n.target=t;n.duration=a;n.data=e;n.startTime=this._startTime+r;n.endTime=n.startTime+n.duration;n.ease=i;this._startTime=Math.max(n.endTime,this._startTime);this._tweenDataList.push(n);this._startTimeSort=true;this._endTimeSort=true;return this}addLabel(t,e){var a=u.getItemByClass("tweenData",Ei);a.type=1;a.data=t;a.endTime=a.startTime=this._startTime+e;this._labelDic||(this._labelDic={});this._labelDic[t]=a;this._tweenDataList.push(a);return this}removeLabel(t){if(this._labelDic&&this._labelDic[t]){var e=this._labelDic[t];if(e){var a=this._tweenDataList.indexOf(e);if(a>-1){this._tweenDataList.splice(a,1)}}delete this._labelDic[t]}}gotoTime(t){if(this._tweenDataList==null||this._tweenDataList.length==0)return;var e;var a;for(var i in this._firstTweenDic){a=this._firstTweenDic[i];if(a){for(var r in a){if(r in a.diyTarget){a.diyTarget[r]=a[r]}}}}for(i in this._tweenDic){e=this._tweenDic[i];e.clear();delete this._tweenDic[i]}this._index=0;this._gidIndex=0;this._currTime=t;this._lastTime=N.now();var s;if(this._endTweenDataList==null||this._endTimeSort){this._endTimeSort=false;this._endTweenDataList=s=this._tweenDataList.concat();function n(t,e){if(t.endTime>e.endTime){return 1}else if(t.endTime<e.endTime){return-1}else{return 0}}s.sort(n)}else{s=this._endTweenDataList}var o;for(var l=0,_=s.length;l<_;l++){o=s[l];if(o.type==0){if(t>=o.endTime){this._index=Math.max(this._index,l+1);var h=o.data;if(o.isTo){for(var x in h){o.target[x]=h[x]}}}else{break}}}for(l=0,_=this._tweenDataList.length;l<_;l++){o=this._tweenDataList[l];if(o.type==0){if(t>=o.startTime&&t<o.endTime){this._index=Math.max(this._index,l+1);this._gidIndex++;e=u.getItemByClass("tween",ra);e._create(o.target,o.data,o.duration,o.ease,Q.create(this,this._animComplete,[this._gidIndex]),0,false,o.isTo,true,false);e.setStartTime(this._currTime-(t-o.startTime));e._updateEase(this._currTime);e.gid=this._gidIndex;this._tweenDic[this._gidIndex]=e}}}}gotoLabel(t){if(this._labelDic==null)return;var e=this._labelDic[t];if(e)this.gotoTime(e.startTime)}pause(){O.timer.clear(this,this._update)}resume(){this.play(this._currTime,this._loopKey)}play(t=0,e=false){if(!this._tweenDataList)return;if(this._startTimeSort){this._startTimeSort=false;function a(t,e){if(t.startTime>e.startTime){return 1}else if(t.startTime<e.startTime){return-1}else{return 0}}this._tweenDataList.sort(a);for(var i=0,r=this._tweenDataList.length;i<r;i++){var s=this._tweenDataList[i];if(s!=null&&s.type==0){var n=s.target;var o=n.$_GID||(n.$_GID=w.getGID());var l=null;if(this._firstTweenDic[o]==null){l={};l.diyTarget=n;this._firstTweenDic[o]=l}else{l=this._firstTweenDic[o]}for(var _ in s.data){if(l[_]==null){l[_]=n[_]}}}}}if(typeof t=="string"){this.gotoLabel(t)}else{this.gotoTime(t)}this._loopKey=e;this._lastTime=N.now();O.timer.frameLoop(1,this,this._update)}_update(){if(this._currTime>=this._startTime){if(this._loopKey){this._complete();if(!this._tweenDataList)return;this.gotoTime(0)}else{for(var t in this._tweenDic){r=this._tweenDic[t];r.complete()}this.pause();this._complete();return}}var e=N.now();var a=e-this._lastTime;var i=this._currTime+=a*this.scale;this._lastTime=e;for(t in this._tweenDic){r=this._tweenDic[t];r._updateEase(i)}var r;if(this._tweenDataList.length!=0&&this._index<this._tweenDataList.length){var s=this._tweenDataList[this._index];if(i>=s.startTime){this._index++;if(s.type==0){this._gidIndex++;r=u.getItemByClass("tween",ra);r._create(s.target,s.data,s.duration,s.ease,Q.create(this,this._animComplete,[this._gidIndex]),0,false,s.isTo,true,false);r.setStartTime(i);r.gid=this._gidIndex;this._tweenDic[this._gidIndex]=r;r._updateEase(i)}else{this.event(P.LABEL,s.data)}}}}_animComplete(t){var e=this._tweenDic[t];if(e)delete this._tweenDic[t]}_complete(){this.event(P.COMPLETE)}get index(){return this._frameIndex}set index(t){this._frameIndex=t;this.gotoTime(this._frameIndex/this._frameRate*1e3)}get total(){this._total=Math.floor(this._startTime/1e3*this._frameRate);return this._total}reset(){var t;if(this._labelDic){for(t in this._labelDic){delete this._labelDic[t]}}var e;for(t in this._tweenDic){e=this._tweenDic[t];e.clear();delete this._tweenDic[t]}for(t in this._firstTweenDic){delete this._firstTweenDic[t]}this._endTweenDataList=null;if(this._tweenDataList&&this._tweenDataList.length){var a,i;i=this._tweenDataList.length;for(a=0;a<i;a++){if(this._tweenDataList[a])this._tweenDataList[a].destroy()}}this._tweenDataList.length=0;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this.scale=1;O.timer.clear(this,this._update)}destroy(){this.reset();this._labelDic=null;this._tweenDic=null;this._tweenDataList=null;this._firstTweenDic=null}}class Ei{constructor(){this.type=0;this.isTo=true}destroy(){this.target=null;this.ease=null;this.data=null;this.isTo=true;this.type=0;u.recover("tweenData",this)}}class bi{constructor(){}}class Si{characterMapContains(t){for(var e=0;e<Si.charsMap.length;++e){if(Si.charsMap[e][0]===t){return true}}return false}getCharRep(t){for(var e=0;e<Si.charsMap.length;++e){if(Si.charsMap[e][0]===t){return Si.charsMap[e]}}return false}getCombCharRep(t,e){for(var a=0;a<Si.combCharsMap.length;++a){if(Si.combCharsMap[a][0][0]===t&&Si.combCharsMap[a][0][1]===e){return Si.combCharsMap[a]}}return false}isTransparent(t){for(var e=0;e<Si.transChars.length;++e){if(Si.transChars[e]===t){return true}}return false}getOriginalCharsFromCode(t){var e;for(e=0;e<Si.charsMap.length;++e){if(Si.charsMap[e].indexOf(t)>-1){return String.fromCharCode(Si.charsMap[e][0])}}for(e=0;e<Si.combCharsMap.length;++e){if(Si.combCharsMap[e].indexOf(t)>-1){return String.fromCharCode(Si.combCharsMap[e][0][0])+String.fromCharCode(Si.combCharsMap[e][0][1])}}return String.fromCharCode(t)}convertArabic(t){var e,a,i="";for(var r=0;r<t.length;++r){var s=t.charCodeAt(r);if(this.characterMapContains(s)){var n=null,o=null,l=r-1,_=r+1;for(;l>=0;--l){if(!this.isTransparent(t.charCodeAt(l))){break}}n=l>=0?t.charCodeAt(l):null;e=n?this.getCharRep(n):false;if(!e||e[2]==null&&e[3]==null){n=null}for(;_<t.length;++_){if(!this.isTransparent(t.charCodeAt(_))){break}}o=_<t.length?t.charCodeAt(_):null;e=o?this.getCharRep(o):false;if(!e||e[3]==null&&e[4]==null){o=null}if(s===1604&&o!=null&&(o===1570||o===1571||o===1573||o===1575)){a=this.getCombCharRep(s,o);if(n!=null){i+=String.fromCharCode(a[4])}else{i+=String.fromCharCode(a[1])}++r;continue}e=this.getCharRep(s);if(n!=null&&o!=null&&e[3]!=null){i+=String.fromCharCode(e[3]);continue}else if(n!=null&&e[4]!=null){i+=String.fromCharCode(e[4]);continue}else if(o!=null&&e[2]!=null){i+=String.fromCharCode(e[2]);continue}else{i+=String.fromCharCode(e[1])}}else{i+=String.fromCharCode(s)}}return i}convertArabicBack(t){var e="",a;var i;for(i=0;i<t.length;++i){a=t.charCodeAt(i);e+=this.getOriginalCharsFromCode(a)}return e}}Si.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]];Si.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]];Si.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773];class Ci{static ArrayMul(t,e,a){if(!t){Ci.copyArray(e,a);return}if(!e){Ci.copyArray(t,a);return}var i,r,s,n;for(var o=0;o<4;o++){i=t[o];r=t[o+4];s=t[o+8];n=t[o+12];a[o]=i*e[0]+r*e[1]+s*e[2]+n*e[3];a[o+4]=i*e[4]+r*e[5]+s*e[6]+n*e[7];a[o+8]=i*e[8]+r*e[9]+s*e[10]+n*e[11];a[o+12]=i*e[12]+r*e[13]+s*e[14]+n*e[15]}}static copyArray(t,e){if(!t)return;if(!e)return;for(var a=0;a<t.length;a++){e[a]=t[a]}}}A.AlphaCmd=U;A.Animation=za;A.AnimationBase=oa;A.ArabicReshaper=Si;A.AtlasGrid=ne;A.AtlasInfoManager=Qe;A.AudioSound=Ye;A.AudioSoundChannel=Xe;A.BasePoly=Jt;A.BaseShader=it;A.BaseTexture=i;A.Bezier=bt;A.Bitmap=a;A.BitmapFont=Ze;A.BlendMode=M;A.BlurFilter=Ka;A.BlurFilterGLRender=Za;A.BlurFilterSetter=Qa;A.BoundsStyle=we;A.Browser=N;A.Buffer=Ot;A.Buffer2D=Bt;A.BufferState2D=Pt;A.BufferStateBase=wt;A.ButtonEffect=Ja;A.Byte=tt;A.CONST3D2D=te;A.CacheManger=Ce;A.CacheStyle=Pe;A.CallLater=ke;A.CharRenderInfo=xe;A.CharRender_Canvas=de;A.CharRender_Native=ue;A.CharSubmitCache=se;A.ClassUtils=d;A.ClipRectCmd=Ee;A.ColorFilter=ft;A.ColorFilterSetter=$a;A.ColorUtils=ut;A.CommandEncoder=oi;A.CommonScript=Ua;A.Component=na;A.Config=n;A.Const=b;A.Context=W;A.Dragging=sa;A.Draw9GridTexture=ye;A.DrawCircleCmd=k;A.DrawCurvesCmd=G;A.DrawImageCmd=H;A.DrawLineCmd=z;A.DrawLinesCmd=X;A.DrawParticleCmd=ja;A.DrawPathCmd=Y;A.DrawPieCmd=j;A.DrawPolyCmd=q;A.DrawRectCmd=Z;A.DrawStyle=Ct;A.DrawTextureCmd=pt;A.DrawTexturesCmd=be;A.DrawTrianglesCmd=ve;A.Earcut=E;A.EarcutNode=$t;A.Ease=ia;A.EffectAnimation=Wa;A.EffectBase=ti;A.Event=P;A.EventDispatcher=e;A.FadeIn=ei;A.FadeOut=ai;A.FillTextCmd=Se;A.FillTextureCmd=mt;A.Filter=dt;A.FilterSetterBase=qa;A.FontInfo=_e;A.FrameAnimation=_a;A.GlowFilter=ri;A.GlowFilterGLRender=ii;A.GlowFilterSetter=si;A.GrahamScan=St;A.GraphicAnimation=Ga;A.Graphics=Ae;A.GraphicsBounds=v;A.HTMLCanvas=Me;A.HTMLChar=fi;A.HTMLImage=Aa;A.HalfFloatUtils=c;A.Handler=Q;A.HitArea=De;A.HttpRequest=Ke;A.ICharRender=ce;A.ILaya=O;A.IStatRender=ua;A.IndexBuffer2D=Ft;A.InlcudeFile=Ta;A.Input=l;A.KeyBoardManager=ze;A.KeyLocation=ni;A.Keyboard=t;A.Laya=x;A.LayaGL=f;A.LayaGLQuickRunner=Le;A.LayaGLRunner=li;A.LayaGPU=ge;A.Loader=V;A.LoaderManager=Je;A.LocalStorage=ta;A.Log=pi;A.MathUtil=la;A.MatirxArray=Ci;A.Matrix=L;A.Mesh2D=Ut;A.MeshParticle2D=Ra;A.MeshQuadTexture=kt;A.MeshTexture=Gt;A.MeshVG=Ht;A.Mouse=Ca;A.MouseManager=Ue;A.Node=Ne;A.Path=Rt;A.PerfData=gi;A.PerfHUD=vi;A.Point=K;A.Pool=u;A.PoolCache=yi;A.Prefab=qe;A.PrimitiveSV=va;A.QuickTestTool=s;A.Rectangle=R;A.Render=m;A.RenderInfo=Nt;A.RenderSprite=Ie;A.RenderState2D=_;A.RenderTexture2D=rt;A.Resource=$;A.ResourceVersion=xi;A.RestoreCmd=gt;A.RotateCmd=vt;A.RunDriver=He;A.SaveBase=o;A.SaveClipRect=Lt;A.SaveCmd=Te;A.SaveMark=It;A.SaveTransform=Mt;A.SaveTranslate=Dt;A.ScaleCmd=yt;A.Scene=Ya;A.SceneLoader=Xa;A.SceneUtils=xa;A.Script=ka;A.Shader=lt;A.Shader2D=Kt;A.Shader2X=_t;A.ShaderCompile=ba;A.ShaderDefines2D=D;A.ShaderDefinesBase=nt;A.ShaderNode=Ea;A.ShaderValue=bi;A.SkinMeshBuffer=Qt;A.SkinSV=ga;A.Socket=ci;A.Sound=_i;A.SoundChannel=We;A.SoundManager=h;A.SoundNode=hi;A.Sprite=Be;A.SpriteConst=T;A.SpriteStyle=Oe;A.Stage=S;A.Stat=g;A.StatUI=fa;A.StringKey=ot;A.Submit=ee;A.SubmitBase=C;A.SubmitCMD=ct;A.SubmitCanvas=ae;A.SubmitKey=xt;A.SubmitTarget=ie;A.SubmitTexture=re;A.System=ui;A.SystemUtils=et;A.TTFLoader=aa;A.Text=F;A.TextAtlas=oe;A.TextRender=B;A.TextStyle=Fe;A.TextTexture=y;A.Texture=le;A.Texture2D=at;A.TextureSV=ya;A.TimeLine=Ti;A.Timer=pa;A.TouchManager=Ve;A.TransformCmd=Tt;A.TranslateCmd=Et;A.Tween=ra;A.URL=I;A.Utils=w;A.Value2D=ht;A.VectorGraphManager=Re;A.VertexArrayObject=me;A.VertexBuffer2D=Vt;A.VideoTexture=di;A.WeakObject=ha;A.WebAudioSound=r;A.WebAudioSoundChannel=je;A.WebGL=pe;A.WebGLCacheAsNormalCanvas=zt;A.WebGLContext=p;A.WebGLRTMgr=st;A.WordText=he;A.WorkerLoader=Sa;A.__init=Da;A._static=Va;A.alertGlobalError=Ba;A.enableDebugPanel=Fa;A.init=wa;A.isWXOpenDataContext=Oa;A.isWXPosMsg=Na;A.version=Pa;A.static=Va;return A}({});(function(t,Pt){"use strict";class M{}M.Skeleton=null;M.AnimationTemplet=null;M.Templet=null;class D{}class w{}class P{}class i{static parse(t,e){var a=e.__getBuffer();var i,r,s,n,o,l,_;var h=e.readUTFString();t._aniClassName=h;var x=e.readUTFString().split("\n");var c=e.getUint8();var d=e.getUint32();var u=e.getUint32();var f;if(d>0)f=a.slice(d,u);var p=new Pt.Byte(f);if(u>0)t._publicExtData=a.slice(u,a.byteLength);t._useParent=!!e.getUint8();t._anis.length=c;for(i=0;i<c;i++){var m=t._anis[i]=new D;m.nodes=[];var g=m.name=x[e.getUint16()];t._aniMap[g]=i;m.bone3DMap={};m.playTime=e.getFloat32();var v=m.nodes.length=e.getUint8();m.totalKeyframeDatasLength=0;for(r=0;r<v;r++){var y=m.nodes[r]=new w;y.childs=[];var T=e.getInt16();if(T>=0){y.name=x[T];m.bone3DMap[y.name]=r}y.keyFrame=[];y.parentIndex=e.getInt16();y.parentIndex==-1?y.parent=null:y.parent=m.nodes[y.parentIndex];y.lerpType=e.getUint8();var E=e.getUint32();p.pos=E;var b=y.keyframeWidth=p.getUint16();m.totalKeyframeDatasLength+=b;if(y.lerpType===0||y.lerpType===1){y.interpolationMethod=[];y.interpolationMethod.length=b;for(s=0;s<b;s++)y.interpolationMethod[s]=M.AnimationTemplet.interpolation[p.getUint8()]}if(y.parent!=null)y.parent.childs.push(y);var S=e.getUint16();if(S>0){y.extenData=a.slice(e.pos,e.pos+S);e.pos+=S}var C=e.getUint16();y.keyFrame.length=C;var R=0;var A;for(s=0,n=C;s<n;s++){A=y.keyFrame[s]=new P;A.duration=e.getFloat32();A.startTime=R;if(y.lerpType===2){A.interpolationData=[];var L=e.getUint8();var I;I=e.getFloat32();switch(I){case 254:A.interpolationData.length=b;for(_=0;_<b;_++)A.interpolationData[_]=0;break;case 255:A.interpolationData.length=b;for(_=0;_<b;_++)A.interpolationData[_]=5;break;default:A.interpolationData.push(I);for(l=1;l<L;l++){A.interpolationData.push(e.getFloat32())}}}A.data=new Float32Array(b);A.dData=new Float32Array(b);A.nextData=new Float32Array(b);for(o=0;o<b;o++){A.data[o]=e.getFloat32();if(A.data[o]>-1e-8&&A.data[o]<1e-8)A.data[o]=0}R+=A.duration}A.startTime=m.playTime;y.playTime=m.playTime;t._calculateKeyFrame(y,C,b)}}}}class T{static READ_DATA(){T._DATA.offset=T._reader.getUint32();T._DATA.size=T._reader.getUint32()}static READ_BLOCK(){var t=T._BLOCK.count=T._reader.getUint16();var e=T._BLOCK.blockStarts=[];var a=T._BLOCK.blockLengths=[];for(var i=0;i<t;i++){e.push(T._reader.getUint32());a.push(T._reader.getUint32())}}static READ_STRINGS(){var t=T._reader.getUint32();var e=T._reader.getUint16();var a=T._reader.pos;T._reader.pos=t+T._DATA.offset;for(var i=0;i<e;i++)T._strings[i]=T._reader.readUTFString();T._reader.pos=a}static parse(t,e){T._templet=t;T._reader=e;var a=e.__getBuffer();T.READ_DATA();T.READ_BLOCK();T.READ_STRINGS();for(var i=0,r=T._BLOCK.count;i<r;i++){var s=e.getUint16();var n=T._strings[s];var o=T["READ_"+n];if(o==null)throw new Error("model file err,no this function:"+s+" "+n);else o.call(null)}}static READ_ANIMATIONS(){var t=T._reader;var e=t.__getBuffer();var a,i,r,s;var n=t.getUint16();var o=[];o.length=n;for(a=0;a<n;a++)o[a]=M.AnimationTemplet.interpolation[t.getByte()];var l=t.getUint8();T._templet._anis.length=l;for(a=0;a<l;a++){var _=T._templet._anis[a]=new D;_.nodes=[];var h=_.name=T._strings[t.getUint16()];T._templet._aniMap[h]=a;_.bone3DMap={};_.playTime=t.getFloat32();var x=_.nodes.length=t.getInt16();_.totalKeyframeDatasLength=0;for(i=0;i<x;i++){var c=_.nodes[i]=new w;c.keyframeWidth=n;c.childs=[];var d=t.getUint16();if(d>=0){c.name=T._strings[d];_.bone3DMap[c.name]=i}c.keyFrame=[];c.parentIndex=t.getInt16();c.parentIndex==-1?c.parent=null:c.parent=_.nodes[c.parentIndex];_.totalKeyframeDatasLength+=n;c.interpolationMethod=o;if(c.parent!=null)c.parent.childs.push(c);var u=t.getUint16();c.keyFrame.length=u;var f=null,p=null;for(r=0,s=u;r<s;r++){f=c.keyFrame[r]=new P;f.startTime=t.getFloat32();p&&(p.duration=f.startTime-p.startTime);f.dData=new Float32Array(n);f.nextData=new Float32Array(n);var m=T._DATA.offset;var g=t.getUint32();var v=n*4;var y=e.slice(m+g,m+g+v);f.data=new Float32Array(y);p=f}f.duration=0;c.playTime=_.playTime;T._templet._calculateKeyFrame(c,u,n)}}}}T._strings=[];T._BLOCK={count:0};T._DATA={offset:0,size:0};class e{constructor(){}}e.stopped=0;e.paused=1;e.playing=2;class l extends Pt.EventDispatcher{constructor(){super();this.isCache=true;this.playbackRate=1;this._destroyed=false;this._currentAnimationClipIndex=-1;this._currentKeyframeIndex=-1;this._currentTime=0;this._overallDuration=Number.MAX_VALUE;this._stopWhenCircleFinish=false;this._elapsedPlaybackTime=0;this._startUpdateLoopCount=-1;this._cachePlayRate=1;this.cacheFrameRate=60;this.returnToZeroStopped=false}get templet(){return this._templet}set templet(t){if(!(this.state===e.stopped))this.stop(true);if(this._templet!==t){this._templet=t;this._computeFullKeyframeIndices()}}get playStart(){return this._playStart}get playEnd(){return this._playEnd}get playDuration(){return this._playDuration}get overallDuration(){return this._overallDuration}get currentAnimationClipIndex(){return this._currentAnimationClipIndex}get currentKeyframeIndex(){return this._currentKeyframeIndex}get currentPlayTime(){return this._currentTime+this._playStart}get currentFrameTime(){return this._currentFrameTime}get cachePlayRate(){return this._cachePlayRate}set cachePlayRate(t){if(this._cachePlayRate!==t){this._cachePlayRate=t;if(this._templet)this._computeFullKeyframeIndices()}}get cacheFrameRate(){return this._cacheFrameRate}set cacheFrameRate(t){if(this._cacheFrameRate!==t){this._cacheFrameRate=t;this._cacheFrameRateInterval=1e3/this._cacheFrameRate;if(this._templet)this._computeFullKeyframeIndices()}}set currentTime(t){if(this._currentAnimationClipIndex===-1||!this._templet)return;if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=Pt.Stat.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t;this._currentKeyframeIndex=Math.floor(this.currentPlayTime/e);this._currentFrameTime=this._currentKeyframeIndex*e}get paused(){return this._paused}set paused(t){this._paused=t;t&&this.event(Pt.Event.PAUSED)}get cacheFrameRateInterval(){return this._cacheFrameRateInterval}get state(){if(this._currentAnimationClipIndex===-1)return e.stopped;if(this._paused)return e.paused;return e.playing}get destroyed(){return this._destroyed}_onTempletLoadedComputeFullKeyframeIndices(t,e,a){if(this._templet===a&&this._cachePlayRate===t&&this._cacheFrameRate===e)this._computeFullKeyframeIndices()}_computeFullKeyframeIndices(){return;var t=this._templet;if(t._fullFrames)return;var e=this._templet._fullFrames=[];var a=this._cacheFrameRateInterval*this._cachePlayRate;for(var i=0,r=t.getAnimationCount();i<r;i++){var s=[];if(!t.getAnimation(i).nodes){e.push(s);continue}for(var n=0,o=t.getAnimation(i).nodes.length;n<o;n++){var l=t.getAnimation(i).nodes[n];var _=Math.round(l.playTime/a);var h=new Uint16Array(_+1);var x=-1;var c=l.keyFrame;for(var d=0,u=c.length;d<u;d++){var f=c[d];var p=Math.round(f.startTime/a);if(x<0&&p>0){x=p}if(p<=_){h[p]=d}}var m=0;for(d=x;d<_;d++){if(h[d]==0){h[d]=m}else{m=h[d]}}s.push(h)}e.push(s)}}_onAnimationTempletLoaded(){this.destroyed||this._calculatePlayDuration()}_calculatePlayDuration(){if(this.state!==e.stopped){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);this._playEnd===0&&(this._playEnd=t);if(this._playEnd>t)this._playEnd=t;this._playDuration=this._playEnd-this._playStart}}_setPlayParams(t,e){this._currentTime=t;this._currentKeyframeIndex=Math.floor(this.currentPlayTime/e+.01);this._currentFrameTime=this._currentKeyframeIndex*e}_setPlayParamsWhenStop(t,e,a=-1){this._currentTime=t;var i=a>0?a:t;this._currentKeyframeIndex=Math.floor(i/e+.01);this._currentKeyframeIndex=Math.floor(t/e+.01);this._currentFrameTime=this._currentKeyframeIndex*e;this._currentAnimationClipIndex=-1}_update(t){if(this._currentAnimationClipIndex===-1||this._paused||!this._templet)return;var e=this._cacheFrameRateInterval*this._cachePlayRate;var a=0;this._startUpdateLoopCount!==Pt.Stat.loopCount&&(a=t*this.playbackRate,this._elapsedPlaybackTime+=a);var i=this.playDuration;a+=this._currentTime;if(this._overallDuration!==0&&this._elapsedPlaybackTime>=this._overallDuration||(this._overallDuration===0&&this._elapsedPlaybackTime>=i||this._overallDuration===0&&a>=this.playEnd)){this._setPlayParamsWhenStop(i,e,this.playEnd);this.event(Pt.Event.STOPPED);return}if(i>0){if(a>=i){if(this._stopWhenCircleFinish){this._setPlayParamsWhenStop(i,e);this._stopWhenCircleFinish=false;this.event(Pt.Event.STOPPED);return}else{a=a%i;this._setPlayParams(a,e);this.event(Pt.Event.COMPLETE);return}}else{this._setPlayParams(a,e)}}else{if(this._stopWhenCircleFinish){this._setPlayParamsWhenStop(i,e);this._stopWhenCircleFinish=false;this.event(Pt.Event.STOPPED);return}this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0;this.event(Pt.Event.COMPLETE)}}_destroy(){this.offAll();this._templet=null;this._destroyed=true}play(t=0,e=1,a=2147483647,i=0,r=0){if(!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(a<0||i<0||r<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(r!==0&&i>r)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0;this._currentFrameTime=0;this._elapsedPlaybackTime=0;this.playbackRate=e;this._overallDuration=a;this._playStart=i;this._playEnd=r;this._paused=false;this._currentAnimationClipIndex=t;this._currentKeyframeIndex=0;this._startUpdateLoopCount=Pt.Stat.loopCount;this.event(Pt.Event.PLAYED);this._calculatePlayDuration();this._update(0)}playByFrame(t=0,e=1,a=2147483647,i=0,r=0,s=30){var n=1e3/s;this.play(t,e,a,i*n,r*n)}stop(t=true){if(t){this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0;this._currentAnimationClipIndex=-1;this.event(Pt.Event.STOPPED)}else{this._stopWhenCircleFinish=true}}destroy(){}}class x{constructor(){}static getBezierRate(t,e,a,i,r){var s=x._getBezierParamKey(e,a,i,r);var n=s*100+t;if(x._bezierResultCache[n])return x._bezierResultCache[n];var o=x._getBezierPoints(e,a,i,r,s);var l,_;_=o.length;for(l=0;l<_;l+=2){if(t<=o[l]){x._bezierResultCache[n]=o[l+1];return o[l+1]}}x._bezierResultCache[n]=1;return 1}static _getBezierParamKey(t,e,a,i){return(((t*100+e)*100+a)*100+i)*100}static _getBezierPoints(t,e,a,i,r){if(x._bezierPointsCache[r])return x._bezierPointsCache[r];var s;s=[0,0,t,e,a,i,1,1];var n;n=new Pt.Bezier;var o;o=n.getBezierPoints(s,100,3);x._bezierPointsCache[r]=o;return o}}x._bezierResultCache={};x._bezierPointsCache={};class E extends Pt.Resource{constructor(){super();this._anis=[];this._aniMap={};this.unfixedLastAniIndex=-1;this._fullFrames=null;this._boneCurKeyFrm=[]}static _LinearInterpolation_0(t,e,a,i,r,s,n,o,l,_=null){a[i]=r[e]+s*n[e];return 1}static _QuaternionInterpolation_1(t,e,a,i,r,s,n,o,l,_=null){var h=o===0?0:s/o;Pt.MathUtil.slerpQuaternionArray(r,e,l,e,h,a,i);return 4}static _AngleInterpolation_2(t,e,a,i,r,s,n,o,l,_=null){return 0}static _RadiansInterpolation_3(t,e,a,i,r,s,n,o,l,_=null){return 0}static _Matrix4x4Interpolation_4(t,e,a,i,r,s,n,o,l,_=null){for(var h=0;h<16;h++,e++)a[i+h]=r[e]+s*n[e];return 16}static _NoInterpolation_5(t,e,a,i,r,s,n,o,l,_=null){a[i]=r[e];return 1}static _BezierInterpolation_6(t,e,a,i,r,s,n,o,l,_=null,h=0){a[i]=r[e]+(l[e]-r[e])*x.getBezierRate(s/o,_[h],_[h+1],_[h+2],_[h+3]);return 5}static _BezierInterpolation_7(t,e,a,i,r,s,n,o,l,_=null,h=0){a[i]=_[h+4]+_[h+5]*x.getBezierRate((s*.001+_[h+6])/_[h+7],_[h],_[h+1],_[h+2],_[h+3]);return 9}parse(t){var e=new Pt.Byte(t);this._aniVersion=e.readUTFString();i.parse(this,e)}_calculateKeyFrame(t,e,a){var i=t.keyFrame;i[e]=i[0];for(var r=0;r<e;r++){var s=i[r];for(var n=0;n<a;n++){s.dData[n]=s.duration===0?0:(i[r+1].data[n]-s.data[n])/s.duration;s.nextData[n]=i[r+1].data[n]}}i.length--}_onAsynLoaded(t,e=null){var a=new Pt.Byte(t);this._aniVersion=a.readUTFString();switch(this._aniVersion){case"LAYAANIMATION:02":T.parse(this,a);break;default:i.parse(this,a)}}getAnimationCount(){return this._anis.length}getAnimation(t){return this._anis[t]}getAniDuration(t){return this._anis[t].playTime}getNodes(t){return this._anis[t].nodes}getNodeIndexWithName(t,e){return this._anis[t].bone3DMap[e]}getNodeCount(t){return this._anis[t].nodes.length}getTotalkeyframesLength(t){return this._anis[t].totalKeyframeDatasLength}getPublicExtData(){return this._publicExtData}getAnimationDataWithCache(t,e,a,i){var r=e[a];if(!r){return null}else{var s=r[t];if(!s)return null;else{return s[i]}}}setAnimationDataWithCache(t,e,a,i,r){var s=e[a]||(e[a]={});var n=s[t]||(s[t]=[]);n[i]=r}getNodeKeyFrame(t,e,a){var i=this._boneCurKeyFrm[e];var r=t.length;if(i==void 0||i>=r){i=this._boneCurKeyFrm[e]=0}var s=t[i];var n=s.startTime;var o=a-n;if(o==0||o>0&&s.duration>o){return i}var l=0;if(o>0){a=a+.01;for(l=i+1;l<r;l++){s=t[l];if(s.startTime<=a&&s.startTime+s.duration>a){this._boneCurKeyFrm[e]=l;return l}}return r-1}else{for(l=0;l<i;l++){s=t[l];if(s.startTime<=a&&s.startTime+s.duration>a){this._boneCurKeyFrm[e]=l;return l}}return i}return 0}getOriginalData(t,e,a,i,r){var s=this._anis[t];var n=s.nodes;var o=this._boneCurKeyFrm;if(o.length<n.length){o.length=n.length}var l=0;for(var _=0,h=n.length,x=0;_<h;_++){var c=n[_];var d;var u=c.keyFrame;d=u[this.getNodeKeyFrame(u,_,r)];c.dataOffset=x;var f=r-d.startTime;var p=c.lerpType;if(p){switch(p){case 0:case 1:for(l=0;l<c.keyframeWidth;)l+=c.interpolationMethod[l](c,l,e,x+l,d.data,f,d.dData,d.duration,d.nextData);break;case 2:var m=d.interpolationData;var g=m.length;var v=0;for(l=0;l<g;){var y=m[l];switch(y){case 6:l+=E.interpolation[y](c,v,e,x+v,d.data,f,d.dData,d.duration,d.nextData,m,l+1);break;case 7:l+=E.interpolation[y](c,v,e,x+v,d.data,f,d.dData,d.duration,d.nextData,m,l+1);break;default:l+=E.interpolation[y](c,v,e,x+v,d.data,f,d.dData,d.duration,d.nextData)}v++}break}}else{for(l=0;l<c.keyframeWidth;)l+=c.interpolationMethod[l](c,l,e,x+l,d.data,f,d.dData,d.duration,d.nextData)}x+=c.keyframeWidth}}getNodesCurrentFrameIndex(t,e){var a=this._anis[t];var i=a.nodes;if(t!==this.unfixedLastAniIndex){this.unfixedCurrentFrameIndexes=new Uint32Array(i.length);this.unfixedCurrentTimes=new Float32Array(i.length);this.unfixedLastAniIndex=t}for(var r=0,s=i.length;r<s;r++){var n=i[r];if(e<this.unfixedCurrentTimes[r])this.unfixedCurrentFrameIndexes[r]=0;this.unfixedCurrentTimes[r]=e;while(this.unfixedCurrentFrameIndexes[r]<n.keyFrame.length){if(n.keyFrame[this.unfixedCurrentFrameIndexes[r]].startTime>this.unfixedCurrentTimes[r])break;this.unfixedCurrentFrameIndexes[r]++}this.unfixedCurrentFrameIndexes[r]--}return this.unfixedCurrentFrameIndexes}getOriginalDataUnfixedRate(t,e,a){var i=this._anis[t];var r=i.nodes;if(t!==this.unfixedLastAniIndex){this.unfixedCurrentFrameIndexes=new Uint32Array(r.length);this.unfixedCurrentTimes=new Float32Array(r.length);this.unfixedKeyframes=[];this.unfixedLastAniIndex=t}var s=0;for(var n=0,o=r.length,l=0;n<o;n++){var _=r[n];if(a<this.unfixedCurrentTimes[n])this.unfixedCurrentFrameIndexes[n]=0;this.unfixedCurrentTimes[n]=a;while(this.unfixedCurrentFrameIndexes[n]<_.keyFrame.length){if(_.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n])break;this.unfixedKeyframes[n]=_.keyFrame[this.unfixedCurrentFrameIndexes[n]];this.unfixedCurrentFrameIndexes[n]++}var h=this.unfixedKeyframes[n];_.dataOffset=l;var x=a-h.startTime;var c=_.lerpType;if(c){switch(_.lerpType){case 0:case 1:for(s=0;s<_.keyframeWidth;)s+=_.interpolationMethod[s](_,s,e,l+s,h.data,x,h.dData,h.duration,h.nextData);break;case 2:var d=h.interpolationData;var u=d.length;var f=0;for(s=0;s<u;){var p=d[s];switch(p){case 6:s+=E.interpolation[p](_,f,e,l+f,h.data,x,h.dData,h.duration,h.nextData,d,s+1);break;case 7:s+=E.interpolation[p](_,f,e,l+f,h.data,x,h.dData,h.duration,h.nextData,d,s+1);break;default:s+=E.interpolation[p](_,f,e,l+f,h.data,x,h.dData,h.duration,h.nextData)}f++}break}}else{for(s=0;s<_.keyframeWidth;)s+=_.interpolationMethod[s](_,s,e,l+s,h.data,x,h.dData,h.duration,h.nextData)}l+=_.keyframeWidth}}}E.interpolation=[E._LinearInterpolation_0,E._QuaternionInterpolation_1,E._AngleInterpolation_2,E._RadiansInterpolation_3,E._Matrix4x4Interpolation_4,E._NoInterpolation_5,E._BezierInterpolation_6,E._BezierInterpolation_7];M.AnimationTemplet=E;class U extends Pt.Graphics{drawSkin(t,e){this.drawTriangles(t.texture,0,0,t.vertices,t.uvs,t.indexes,t.transform||Pt.Matrix.EMPTY,e)}static create(){var t=U._caches.pop();return t||new U}static recycle(t){t.clear();U._caches.push(t)}}U._caches=[];class Ot{constructor(){this.skX=0;this.skY=0;this.scX=1;this.scY=1;this.x=0;this.y=0;this.skewX=0;this.skewY=0}initData(t){if(t.x!=undefined){this.x=t.x}if(t.y!=undefined){this.y=t.y}if(t.skX!=undefined){this.skX=t.skX}if(t.skY!=undefined){this.skY=t.skY}if(t.scX!=undefined){this.scX=t.scX}if(t.scY!=undefined){this.scY=t.scY}}getMatrix(){var t;if(this.mMatrix){t=this.mMatrix}else{t=this.mMatrix=new Pt.Matrix}t.identity();t.scale(this.scX,this.scY);if(this.skewX||this.skewY){this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180)}t.rotate(this.skX*Math.PI/180);t.translate(this.x,this.y);return t}skew(t,e,a){var i=Math.sin(a);var r=Math.cos(a);var s=Math.sin(e);var n=Math.cos(e);t.setTo(t.a*n-t.b*i,t.a*s+t.b*r,t.c*n-t.d*i,t.c*s+t.d*r,t.tx*n-t.ty*i,t.tx*s+t.ty*r);return t}}class Nt{constructor(){this.length=10;this.resultTransform=new Ot;this.resultMatrix=new Pt.Matrix;this.inheritScale=true;this.inheritRotation=true;this.d=-1;this._children=[]}setTempMatrix(t){this._tempMatrix=t;var e=0,a=0;var i;for(e=0,a=this._children.length;e<a;e++){i=this._children[e];i.setTempMatrix(this._tempMatrix)}}update(t=null){this.rotation=this.transform.skX;var e;if(t){e=this.resultTransform.getMatrix();Pt.Matrix.mul(e,t,this.resultMatrix);this.resultRotation=this.rotation}else{this.resultRotation=this.rotation+this.parentBone.resultRotation;if(this.parentBone){if(this.inheritRotation&&this.inheritScale){e=this.resultTransform.getMatrix();Pt.Matrix.mul(e,this.parentBone.resultMatrix,this.resultMatrix)}else{var a=this.parentBone;var i;var r;var s;var n=this.parentBone.resultMatrix;e=this.resultTransform.getMatrix();var o=n.a*e.tx+n.c*e.ty+n.tx;var l=n.b*e.tx+n.d*e.ty+n.ty;var _=new Pt.Matrix;if(this.inheritRotation){i=Math.atan2(a.resultMatrix.b,a.resultMatrix.a);r=Math.cos(i),s=Math.sin(i);_.setTo(r,s,-s,r,0,0);Pt.Matrix.mul(this._tempMatrix,_,Pt.Matrix.TEMP);Pt.Matrix.TEMP.copyTo(_);e=this.resultTransform.getMatrix();Pt.Matrix.mul(e,_,this.resultMatrix);if(this.resultTransform.scX*this.resultTransform.scY<0){this.resultMatrix.rotate(Math.PI*.5)}this.resultMatrix.tx=o;this.resultMatrix.ty=l}else if(this.inheritScale){e=this.resultTransform.getMatrix();Pt.Matrix.TEMP.identity();Pt.Matrix.TEMP.d=this.d;Pt.Matrix.mul(e,Pt.Matrix.TEMP,this.resultMatrix);this.resultMatrix.tx=o;this.resultMatrix.ty=l}else{e=this.resultTransform.getMatrix();Pt.Matrix.TEMP.identity();Pt.Matrix.TEMP.d=this.d;Pt.Matrix.mul(e,Pt.Matrix.TEMP,this.resultMatrix);this.resultMatrix.tx=o;this.resultMatrix.ty=l}}}else{e=this.resultTransform.getMatrix();e.copyTo(this.resultMatrix)}}var h=0,x=0;var c;for(h=0,x=this._children.length;h<x;h++){c=this._children[h];c.update()}}updateChild(){var t=0,e=0;var a;for(t=0,e=this._children.length;t<e;t++){a=this._children[t];a.update()}}setRotation(t){if(this._sprite){this._sprite.rotation=t*180/Math.PI}}updateDraw(t,e){if(!Nt.ShowBones||Nt.ShowBones[this.name]){if(this._sprite){this._sprite.x=t+this.resultMatrix.tx;this._sprite.y=e+this.resultMatrix.ty}else{this._sprite=new Pt.Sprite;this._sprite.graphics.drawCircle(0,0,5,"#ff0000");this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00");this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center");Pt.ILaya.stage.addChild(this._sprite);this._sprite.x=t+this.resultMatrix.tx;this._sprite.y=e+this.resultMatrix.ty}}var a=0,i=0;var r;for(a=0,i=this._children.length;a<i;a++){r=this._children[a];r.updateDraw(t,e)}}addChild(t){this._children.push(t);t.parentBone=this}findBone(t){if(this.name==t){return this}else{var e,a;var i;var r;for(e=0,a=this._children.length;e<a;e++){i=this._children[e];r=i.findBone(t);if(r){return r}}}return null}localToWorld(t){var e=t[0];var a=t[1];t[0]=e*this.resultMatrix.a+a*this.resultMatrix.c+this.resultMatrix.tx;t[1]=e*this.resultMatrix.b+a*this.resultMatrix.d+this.resultMatrix.ty}}Nt.ShowBones={};class y{constructor(){}static getRelativeUV(t,e,a=null){var i=t[0];var r=t[2]-t[0];var s=t[1];var n=t[5]-t[1];if(!a)a=[];a.length=e.length;var o,l;l=a.length;var _=1/r;var h=1/n;for(o=0;o<l;o+=2){a[o]=(e[o]-i)*_;a[o+1]=(e[o+1]-s)*h}return a}static getAbsoluteUV(t,e,a=null){if(t[0]==0&&t[1]==0&&t[4]==1&&t[5]==1){if(a){Pt.Utils.copyArray(a,e);return a}else{return e}}var i=t[0];var r=t[2]-t[0];var s=t[1];var n=t[5]-t[1];if(!a)a=[];a.length=e.length;var o,l;l=a.length;for(o=0;o<l;o+=2){a[o]=e[o]*r+i;a[o+1]=e[o+1]*n+s}return a}}class a{constructor(){this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.vertices=new Float32Array([0,0,100,0,100,100,0,100]);this.indexes=new Uint16Array([0,1,3,3,1,2]);this.useUvTransform=false;this.canvasPadding=1}getBounds(){return Pt.Rectangle._getWrapRec(this.vertices)}}class r extends a{constructor(){super()}init2(t,e,a,i){if(this.transform){this.transform=null}var r=e||[0,1,3,3,1,2];this.texture=t;this.indexes=new Uint16Array(r);this.vertices=new Float32Array(a);this.uvs=new Float32Array(i)}}class Bt{constructor(){this.srcDisplayIndex=-1;this.type="src";this.displayIndex=-1;this.originalIndex=-1;this._replaceDic={}}showSlotData(t,e=true){this.currSlotData=t;if(e)this.displayIndex=this.srcDisplayIndex;this.currDisplayData=null;this.currTexture=null}showDisplayByName(t){if(this.currSlotData){this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))}}replaceDisplayByName(t,e){if(!this.currSlotData)return;var a;a=this.currSlotData.getDisplayByName(t);var i;i=this.currSlotData.getDisplayByName(e);this.replaceDisplayByIndex(a,i)}replaceDisplayByIndex(t,e){if(!this.currSlotData)return;this._replaceDic[t]=e;if(this.originalIndex==t){this.showDisplayByIndex(t)}}showDisplayByIndex(t){this.originalIndex=t;if(this._replaceDic[t]!=null)t=this._replaceDic[t];if(this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length){this.displayIndex=t;this.currDisplayData=this.currSlotData.displayArr[t];if(this.currDisplayData){var e=this.currDisplayData.name;this.currTexture=this.templet.getTexture(e);if(this.currTexture&&this.currDisplayData.type==0&&this.currDisplayData.uvs){this.currTexture=this.currDisplayData.createTexture(this.currTexture)}}}else{this.displayIndex=-1;this.currDisplayData=null;this.currTexture=null}}replaceSkin(t){this._diyTexture=t;if(this._curDiyUV)this._curDiyUV.length=0;if(this.currDisplayData&&this._diyTexture==this.currDisplayData.texture){this._diyTexture=null}}setParentMatrix(t){this._parentMatrix=t}static createSkinMesh(){return new r}static isSameArr(t,e){if(t.length!=e.length)return false;var a,i;i=t.length;for(a=0;a<i;a++){if(t[a]!=e[a])return false}return true}getSaveVerticle(t){if(Bt.useSameMatrixAndVerticle&&this._preGraphicVerticle&&Bt.isSameArr(t,this._preGraphicVerticle)){t=this._preGraphicVerticle}else{t=Pt.ILaya.Utils.copyArray([],t);this._preGraphicVerticle=t}return t}static isSameMatrix(t,e){return t.a==e.a&&t.b==e.b&&t.c==e.c&&t.d==e.d&&Math.abs(t.tx-e.tx)<1e-5&&Math.abs(t.ty-e.ty)<1e-5}getSaveMatrix(t){if(Bt.useSameMatrixAndVerticle&&this._preGraphicMatrix&&Bt.isSameMatrix(t,this._preGraphicMatrix)){t=this._preGraphicMatrix}else{var e=t.clone();t=e;this._preGraphicMatrix=t}return t}draw(t,e,a=false,i=1){if(this._diyTexture==null&&this.currTexture==null||this.currDisplayData==null){if(!(this.currDisplayData&&this.currDisplayData.type==3)){return}}var r=this.currTexture;if(this._diyTexture)r=this._diyTexture;var s;switch(this.currDisplayData.type){case 0:if(t){var n=this.getDisplayMatrix();if(this._parentMatrix){var o=false;if(n){Pt.Matrix.mul(n,this._parentMatrix,Pt.Matrix.TEMP);var l;if(a){if(this._resultMatrix==null)this._resultMatrix=new Pt.Matrix;l=this._resultMatrix}else{l=Bt._tempResultMatrix}if(this._diyTexture&&this.currDisplayData.uvs){var _=Bt._tempMatrix;_.identity();if(this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]){_.d=-1}if(this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]){o=true;_.rotate(-Math.PI/2)}Pt.Matrix.mul(_,Pt.Matrix.TEMP,l)}else{Pt.Matrix.TEMP.copyTo(l)}if(!a){l=this.getSaveMatrix(l)}l._checkTransform();if(o){t.drawTexture(r,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,l,i)}else{t.drawTexture(r,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,l,i)}}}}break;case 1:if(a){if(this._skinSprite==null){this._skinSprite=Bt.createSkinMesh()}s=this._skinSprite}else{s=Bt.createSkinMesh()}if(s==null){return}var h;if(this.currDisplayData.bones==null){var x=this.currDisplayData.weights;if(this.deformData){x=this.deformData}var c;if(this._diyTexture){if(!this._curDiyUV){this._curDiyUV=[]}if(this._curDiyUV.length==0){this._curDiyUV=y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV);this._curDiyUV=y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)}c=this._curDiyUV}else{c=this.currDisplayData.uvs}this._mVerticleArr=x;var d=this.currDisplayData.triangles.length/3;h=this.currDisplayData.triangles;if(this.deformData){if(!a){this._mVerticleArr=this.getSaveVerticle(this._mVerticleArr)}}s.init2(r,h,this._mVerticleArr,c);var u=this.getDisplayMatrix();if(this._parentMatrix){if(u){Pt.Matrix.mul(u,this._parentMatrix,Pt.Matrix.TEMP);var f;if(a){if(this._resultMatrix==null)this._resultMatrix=new Pt.Matrix;f=this._resultMatrix}else{f=Bt._tempResultMatrix}Pt.Matrix.TEMP.copyTo(f);if(!a){f=this.getSaveMatrix(f)}s.transform=f}}}else{this.skinMesh(e,s)}t.drawSkin(s,i);break;case 2:if(a){if(this._skinSprite==null){this._skinSprite=Bt.createSkinMesh()}s=this._skinSprite}else{s=Bt.createSkinMesh()}if(s==null){return}this.skinMesh(e,s);t.drawSkin(s,i);break;case 3:break}}skinMesh(t,e){var a=this.currTexture;var i=this.currDisplayData.bones;var r;if(this._diyTexture){a=this._diyTexture;if(!this._curDiyUV){this._curDiyUV=[]}if(this._curDiyUV.length==0){this._curDiyUV=y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV);this._curDiyUV=y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)}r=this._curDiyUV}else{r=this.currDisplayData.uvs}var s=this.currDisplayData.weights;var n=this.currDisplayData.triangles;var o;var l=0;var _=0;var h=0;var x;var c;var d;var u=0;var f=0;var p;var m=0,g=0;Bt._tempVerticleArr.length=0;p=Bt._tempVerticleArr;if(this.deformData&&this.deformData.length>0){var v=0;for(m=0,g=i.length;m<g;){h=i[m++]+m;l=0,_=0;for(;m<h;m++){x=t[i[m]];c=s[u]+this.deformData[v++];d=s[u+1]+this.deformData[v++];f=s[u+2];l+=(c*x.a+d*x.c+x.tx)*f;_+=(c*x.b+d*x.d+x.ty)*f;u+=3}p.push(l,_)}}else{for(m=0,g=i.length;m<g;){h=i[m++]+m;l=0,_=0;for(;m<h;m++){x=t[i[m]];c=s[u];d=s[u+1];f=s[u+2];l+=(c*x.a+d*x.c+x.tx)*f;_+=(c*x.b+d*x.d+x.ty)*f;u+=3}p.push(l,_)}}this._mVerticleArr=p;o=n;this._mVerticleArr=this.getSaveVerticle(this._mVerticleArr);e.init2(a,o,this._mVerticleArr,r)}drawBonePoint(t){if(t&&this._parentMatrix){t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")}}getDisplayMatrix(){if(this.currDisplayData){return this.currDisplayData.transform.getMatrix()}return null}getMatrix(){return this._resultMatrix}copy(){var t=new Bt;t.type="copy";t.name=this.name;t.attachmentName=this.attachmentName;t.srcDisplayIndex=this.srcDisplayIndex;t.parent=this.parent;t.displayIndex=this.displayIndex;t.templet=this.templet;t.currSlotData=this.currSlotData;t.currTexture=this.currTexture;t.currDisplayData=this.currDisplayData;return t}}Bt._tempMatrix=new Pt.Matrix;Bt._tempResultMatrix=new Pt.Matrix;Bt.useSameMatrixAndVerticle=true;Bt._tempVerticleArr=[];class Ft{constructor(){this.deformSlotDataList=[]}}class Vt{constructor(){this.deformSlotDisplayList=[]}}class Ut{constructor(){this.slotIndex=-1;this.timeList=[];this.vectices=[];this.tweenKeyList=[];this.frameIndex=0}binarySearch1(t,e){var a=0;var i=t.length-2;if(i==0)return 1;var r=i>>>1;while(true){if(t[Math.floor(r+1)]<=e)a=r+1;else i=r;if(a==i)return a+1;r=a+i>>>1}return 0}apply(t,e,a=1){t+=.05;if(this.timeList.length<=0){return}var i=0;var r=this.timeList[0];if(t<r){return}var s=this.vectices[0].length;var n=[];var o=this.binarySearch1(this.timeList,t);this.frameIndex=o;if(t>=this.timeList[this.timeList.length-1]){var l=this.vectices[this.vectices.length-1];if(a<1){for(i=0;i<s;i++){n[i]+=(l[i]-n[i])*a}}else{for(i=0;i<s;i++){n[i]=l[i]}}this.deformData=n;return}var _=this.vectices[this.frameIndex-1];var h=this.vectices[this.frameIndex];var x=this.timeList[this.frameIndex-1];var c=this.timeList[this.frameIndex];if(this.tweenKeyList[o-1]){a=(t-x)/(c-x)}else{a=0}var d;for(i=0;i<s;i++){d=_[i];n[i]=d+(h[i]-d)*a}this.deformData=n}}class kt{constructor(){this.drawOrder=[]}}class Gt{constructor(){}}class it{constructor(t,e){this.isSpine=true;this.isDebug=false;this._targetBone=e[t.targetBoneIndex];this.isSpine=t.isSpine;if(this._bones==null)this._bones=[];this._bones.length=0;for(var a=0,i=t.boneIndexs.length;a<i;a++){this._bones.push(e[t.boneIndexs[a]])}this.name=t.name;this.mix=t.mix;this.bendDirection=t.bendDirection}apply(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:if(this.isSpine){this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}else{this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}break}}_applyIk1(t,e,a,i){var r=t.parentBone;var s=1/(r.resultMatrix.a*r.resultMatrix.d-r.resultMatrix.b*r.resultMatrix.c);var n=e-r.resultMatrix.tx;var o=a-r.resultMatrix.ty;var l=(n*r.resultMatrix.d-o*r.resultMatrix.c)*s-t.transform.x;var _=(o*r.resultMatrix.a-n*r.resultMatrix.b)*s-t.transform.y;var h=Math.atan2(_,l)*it.radDeg-0-t.transform.skX;if(t.transform.scX<0)h+=180;if(h>180)h-=360;else if(h<-180)h+=360;t.transform.skX=t.transform.skY=t.transform.skX+h*i;t.update()}updatePos(t,e){if(this._sp){this._sp.pos(t,e)}}_applyIk2(t,e,B,F,a,V){if(V==0){return}var U=t.resultTransform.x,k=t.resultTransform.y;var i=t.transform.scX,r=t.transform.scY;var s=e.transform.scX;var G,H,n;if(i<0){i=-i;G=180;n=-1}else{G=0;n=1}if(r<0){r=-r;n=-n}if(s<0){s=-s;H=180}else{H=0}var o=e.resultTransform.x,l,_,h;var x=t.resultMatrix.a,c=t.resultMatrix.c;var d=t.resultMatrix.b,u=t.resultMatrix.d;var z=Math.abs(i-r)<=1e-4;if(!z){l=0;_=x*o+t.resultMatrix.tx;h=d*o+t.resultMatrix.ty}else{l=e.resultTransform.y;_=x*o+c*l+t.resultMatrix.tx;h=d*o+u*l+t.resultMatrix.ty}if(this.isDebug){if(!this._sp){this._sp=new Pt.Sprite;Pt.ILaya.stage.addChild(this._sp)}this._sp.graphics.clear();this._sp.graphics.drawCircle(B,F,15,"#ffff00");this._sp.graphics.drawCircle(_,h,15,"#ff00ff")}t.setRotation(Math.atan2(h-t.resultMatrix.ty,_-t.resultMatrix.tx));var f=t.parentBone;x=f.resultMatrix.a;c=f.resultMatrix.c;d=f.resultMatrix.b;u=f.resultMatrix.d;var p=1/(x*u-c*d);var m=B-f.resultMatrix.tx,g=F-f.resultMatrix.ty;var v=(m*u-g*c)*p-U;var y=(g*x-m*d)*p-k;m=_-f.resultMatrix.tx;g=h-f.resultMatrix.ty;var W=(m*u-g*c)*p-U;var X=(g*x-m*d)*p-k;var T=Math.sqrt(W*W+X*X);var E=e.length*s;var b,S;if(z){E*=i;var C=(v*v+y*y-T*T-E*E)/(2*T*E);if(C<-1)C=-1;else if(C>1)C=1;S=Math.acos(C)*a;x=T+E*C;c=E*Math.sin(S);b=Math.atan2(y*x-v*c,v*x+y*c)}else{x=i*E;c=r*E;var R=x*x,A=c*c,L=v*v+y*y,Y=Math.atan2(y,v);d=A*T*T+R*L-R*A;var I=-2*A*T,j=A-R;u=I*I-4*j*d;if(u>0){var M=Math.sqrt(u);if(I<0)M=-M;M=-(I+M)/2;var q=M/j,Z=d/M;var D=Math.abs(q)<Math.abs(Z)?q:Z;if(D*D<=L){g=Math.sqrt(L-D*D)*a;b=Y-Math.atan2(g,D);S=Math.atan2(g/r,(D-T)/i)}}var K=0,w=Number.MAX_VALUE,Q=0,J=0;var $=0,P=0,tt=0,et=0;m=T+x;u=m*m;if(u>P){$=0;P=u;tt=m}m=T-x;u=m*m;if(u<w){K=Math.PI;w=u;Q=m}var O=Math.acos(-x*T/(R-A));m=x*Math.cos(O)+T;g=c*Math.sin(O);u=m*m+g*g;if(u<w){K=O;w=u;Q=m;J=g}if(u>P){$=O;P=u;tt=m;et=g}if(L<=(w+P)/2){b=Y-Math.atan2(J*a,Q);S=K*a}else{b=Y-Math.atan2(et*a,tt);S=$*a}}var at=Math.atan2(l,o)*n;var N=t.resultTransform.skX;b=(b-at)*it.radDeg+G-N;if(b>180)b-=360;else if(b<-180)b+=360;t.resultTransform.x=U;t.resultTransform.y=k;t.resultTransform.skX=t.resultTransform.skY=N+b*V;N=e.resultTransform.skX;N=N%360;S=((S+at)*it.radDeg-0)*n+H-N;if(S>180)S-=360;else if(S<-180)S+=360;e.resultTransform.x=o;e.resultTransform.y=l;e.resultTransform.skX=e.resultTransform.skY=e.resultTransform.skY+S*V;t.update()}_applyIk3(t,e,a,i,r,s){if(s==0){return}var n,o;const l=e.resultMatrix.a*e.length;const _=e.resultMatrix.b*e.length;const h=l*l+_*_;const x=Math.sqrt(h);var c=t.resultMatrix.tx;var d=t.resultMatrix.ty;var u=e.resultMatrix.tx;var f=e.resultMatrix.ty;var p=u-c;var m=f-d;const g=p*p+m*m;const v=Math.sqrt(g);p=a-t.resultMatrix.tx;m=i-t.resultMatrix.ty;const y=p*p+m*m;const T=Math.sqrt(y);if(x+v<=T||T+x<=v||T+v<=x){var E;if(x+v<=T){E=1}else{E=-1}u=c+E*(a-c)*v/T;f=d+E*(i-d)*v/T}else{const A=(g-h+y)/(2*y);const L=Math.sqrt(g-A*A*y)/T;const I=c+p*A;const M=d+m*A;const D=-m*L;const w=p*L;if(r>0){u=I-D;f=M-w}else{u=I+D;f=M+w}}n=u;o=f;if(this.isDebug){if(!this._sp){this._sp=new Pt.Sprite;Pt.ILaya.stage.addChild(this._sp)}this._sp.graphics.clear();this._sp.graphics.drawCircle(c,d,15,"#ff00ff");this._sp.graphics.drawCircle(a,i,15,"#ffff00");this._sp.graphics.drawCircle(n,o,15,"#ff00ff")}var b;b=Math.atan2(o-t.resultMatrix.ty,n-t.resultMatrix.tx);t.setRotation(b);var S;S=it._tempMatrix;S.identity();S.rotate(b);S.scale(t.resultMatrix.getScaleX(),t.resultMatrix.getScaleY());S.translate(t.resultMatrix.tx,t.resultMatrix.ty);S.copyTo(t.resultMatrix);t.updateChild();var C;C=Math.atan2(i-o,a-n);e.setRotation(C);var R;R=it._tempMatrix;R.identity();R.rotate(C);R.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY());R.translate(n,o);S.copyTo(e.resultMatrix);e.updateChild()}}it.radDeg=180/Math.PI;it.degRad=Math.PI/180;it._tempMatrix=new Pt.Matrix;class Ht{constructor(){this.boneNames=[];this.bendDirection=1;this.mix=1;this.isSpine=true;this.targetBoneIndex=-1;this.boneIndexs=[]}}class O{constructor(t,e){this._debugKey=false;this._segments=[];this._curves=[];this.data=t;this.position=t.position;this.spacing=t.spacing;this.rotateMix=t.rotateMix;this.translateMix=t.translateMix;this.bones=[];var a=this.data.bones;for(var i=0,r=a.length;i<r;i++){this.bones.push(e[a[i]])}}apply(t,e){if(!this.target)return;var a=this.translateMix;var i=this.translateMix;var r=i>0;var s=this.data.spacingMode;var n=s=="length";var o=this.data.rotateMode;var l=o=="tangent";var _=o=="chainScale";var h=[];var x=this.bones.length;var c=l?x:x+1;var d=[];this._spaces=d;d[0]=this.position;var u=this.spacing;if(_||n){for(var f=0,B=c-1;f<B;){var p=this.bones[f];var m=p.length;var g=m*p.resultMatrix.a;var v=m*p.resultMatrix.b;m=Math.sqrt(g*g+v*v);if(_)h[f]=m;d[++f]=n?Math.max(0,m+u):u}}else{for(f=1;f<c;f++){d[f]=u}}var y=this.computeWorldPositions(this.target,t,e,c,l,this.data.positionMode=="percent",s=="percent");if(this._debugKey){for(f=0;f<y.length;f++){e.drawCircle(y[f++],y[f++],5,"#00ff00")}var T=[];for(f=0;f<y.length;f++){T.push(y[f++],y[f++])}e.drawLines(0,0,T,"#ff0000")}var E=y[0];var b=y[1];var S=this.data.offsetRotation;var F=o=="chain"&&S==0;var C;for(f=0,C=3;f<x;f++,C+=3){p=this.bones[f];p.resultMatrix.tx+=(E-p.resultMatrix.tx)*a;p.resultMatrix.ty+=(b-p.resultMatrix.ty)*a;g=y[C];v=y[C+1];var R=g-E,A=v-b;if(_){m=h[f];if(m!=0){var L=(Math.sqrt(R*R+A*A)/m-1)*i+1;p.resultMatrix.a*=L;p.resultMatrix.c*=L}}E=g;b=v;if(r){var I=p.resultMatrix.a;var M=p.resultMatrix.c;var D=p.resultMatrix.b;var w=p.resultMatrix.d;var P;var O;var N;if(l){P=y[C-1]}else if(d[f+1]==0){P=y[C+2]}else{P=Math.atan2(A,R)}P-=Math.atan2(D,I)-S/180*Math.PI;if(F){O=Math.cos(P);N=Math.sin(P);m=p.length;E+=(m*(O*I-N*D)-R)*i;b+=(m*(N*I+O*D)-A)*i}if(P>Math.PI){P-=Math.PI*2}else if(P<-Math.PI){P+=Math.PI*2}P*=i;O=Math.cos(P);N=Math.sin(P);p.resultMatrix.a=O*I-N*D;p.resultMatrix.c=O*M-N*w;p.resultMatrix.b=N*I+O*D;p.resultMatrix.d=N*M+O*w}}}computeWorldVertices2(t,e,a,i,r,s){var n=t.currDisplayData.bones;var o=t.currDisplayData.weights;var l=t.currDisplayData.triangles;var _;var h=0;var x=0;var c=0;var d=0;var u=0;var f=0;var p=0;var m=0;var g=0;var v=0;var y;var T;if(n==null){if(!l)l=o;if(t.deformData)l=t.deformData;var E;E=t.parent;if(e){T=e.length;for(h=0;h<T;h++){if(e[h].name==E){y=e[h];break}}}var b;if(y){b=y.resultMatrix}if(!b)b=O._tempMt;var S=b.tx;var C=b.ty;var R=b.a,A=b.b,L=b.c,I=b.d;if(y)I*=y.d;for(x=a,u=s;u<i;x+=2,u+=2){g=l[x],v=l[x+1];r[u]=g*R+v*A+S;r[u+1]=-(g*L+v*I+C)}return}for(h=0;h<a;h+=2){d=n[x];x+=d+1;c+=d}var M=e;for(u=s,f=c*3;u<i;u+=2){p=0,m=0;d=n[x++];d+=x;for(;x<d;x++,f+=3){_=M[n[x]].resultMatrix;g=o[f];v=o[f+1];var D=o[f+2];p+=(g*_.a+v*_.c+_.tx)*D;m+=(g*_.b+v*_.d+_.ty)*D}r[u]=p;r[u+1]=m}}computeWorldPositions(t,B,F,V,U,k,G){var H=t.currDisplayData.bones;var z=t.currDisplayData.weights;var W=t.currDisplayData.triangles;var e=[];var a=0;var i=t.currDisplayData.verLen;var r=this.position;var X=this._spaces;var s=[];var n=[];var o=i/6;var Y=-1;var l;var _,h;var x;var c;var d;var u;{o--;i-=4;this.computeWorldVertices2(t,B,2,i,e,0);if(this._debugKey){for(a=0;a<e.length;){F.drawCircle(e[a++],e[a++],10,"#ff0000")}}s=e}this._curves.length=o;var j=this._curves;l=0;var f=s[0],p=s[1],m=0,g=0,v=0,y=0,T=0,E=0;var b,S,C,R,A,L,I,M;var D;for(a=0,D=2;a<o;a++,D+=6){m=s[D];g=s[D+1];v=s[D+2];y=s[D+3];T=s[D+4];E=s[D+5];b=(f-m*2+v)*.1875;S=(p-g*2+y)*.1875;C=((m-v)*3-f+T)*.09375;R=((g-y)*3-p+E)*.09375;A=b*2+C;L=S*2+R;I=(m-f)*.75+b+C*.16666667;M=(g-p)*.75+S+R*.16666667;l+=Math.sqrt(I*I+M*M);I+=A;M+=L;A+=C;L+=R;l+=Math.sqrt(I*I+M*M);I+=A;M+=L;l+=Math.sqrt(I*I+M*M);I+=A+C;M+=L+R;l+=Math.sqrt(I*I+M*M);j[a]=l;f=T;p=E}if(k)r*=l;if(G){for(a=0;a<V;a++)X[a]*=l}var w=this._segments;var P=0;var O;for(a=0,_=0,h=0,O=0;a<V;a++,_+=3){c=X[a];r+=c;x=r;if(x<0){this.addBeforePosition(x,s,0,n,_);continue}else if(x>l){this.addAfterPosition(x-l,s,i-4,n,_);continue}for(;;h++){u=j[h];if(x>u)continue;if(h==0)x/=u;else{d=j[h-1];x=(x-d)/(u-d)}break}if(h!=Y){Y=h;var N=h*6;f=s[N];p=s[N+1];m=s[N+2];g=s[N+3];v=s[N+4];y=s[N+5];T=s[N+6];E=s[N+7];b=(f-m*2+v)*.03;S=(p-g*2+y)*.03;C=((m-v)*3-f+T)*.006;R=((g-y)*3-p+E)*.006;A=b*2+C;L=S*2+R;I=(m-f)*.3+b+C*.16666667;M=(g-p)*.3+S+R*.16666667;P=Math.sqrt(I*I+M*M);w[0]=P;for(N=1;N<8;N++){I+=A;M+=L;A+=C;L+=R;P+=Math.sqrt(I*I+M*M);w[N]=P}I+=A;M+=L;P+=Math.sqrt(I*I+M*M);w[8]=P;I+=A+C;M+=L+R;P+=Math.sqrt(I*I+M*M);w[9]=P;O=0}x*=P;for(;;O++){u=w[O];if(x>u)continue;if(O==0)x/=u;else{d=w[O-1];x=O+(x-d)/(u-d)}break}this.addCurvePosition(x*.1,f,p,m,g,v,y,T,E,n,_,U||a>0&&c==0)}return n}addBeforePosition(t,e,a,i,r){var s=e[a],n=e[a+1],o=e[a+2]-s,l=e[a+3]-n,_=Math.atan2(l,o);i[r]=s+t*Math.cos(_);i[r+1]=n+t*Math.sin(_);i[r+2]=_}addAfterPosition(t,e,a,i,r){var s=e[a+2],n=e[a+3],o=s-e[a],l=n-e[a+1],_=Math.atan2(l,o);i[r]=s+t*Math.cos(_);i[r+1]=n+t*Math.sin(_);i[r+2]=_}addCurvePosition(t,e,a,i,r,s,n,o,l,_,h,x){if(t==0)t=1e-4;var c=t*t,d=c*t,u=1-t,f=u*u,p=f*u;var m=u*t,g=m*3,v=u*g,y=g*t;var T=e*p+i*v+s*y+o*d,E=a*p+r*v+n*y+l*d;_[h]=T;_[h+1]=E;if(x){_[h+2]=Math.atan2(E-(a*f+r*m*2+n*c),T-(e*f+i*m*2+s*c))}else{_[h+2]=0}}}O.BEFORE=-2;O.AFTER=-3;O._tempMt=new Pt.Matrix;class zt{constructor(){this.bones=[]}}class _{constructor(t,e){this._temp=[];this._data=t;if(this._bones==null){this._bones=[]}this.target=e[t.targetIndex];var a,i;for(a=0,i=t.boneIndexs.length;a<i;a++){this._bones.push(e[t.boneIndexs[a]])}this.rotateMix=t.rotateMix;this.translateMix=t.translateMix;this.scaleMix=t.scaleMix;this.shearMix=t.shearMix}apply(){var t;var e=this.target.resultMatrix.a,a=this.target.resultMatrix.b,i=this.target.resultMatrix.c,r=this.target.resultMatrix.d;for(var s=0,n=this._bones.length;s<n;s++){t=this._bones[s];if(this.rotateMix>0){var o=t.resultMatrix.a,l=t.resultMatrix.b,_=t.resultMatrix.c,h=t.resultMatrix.d;var x=Math.atan2(i,e)-Math.atan2(_,o)+this._data.offsetRotation*Math.PI/180;if(x>Math.PI)x-=Math.PI*2;else if(x<-Math.PI)x+=Math.PI*2;x*=this.rotateMix;var c=Math.cos(x),d=Math.sin(x);t.resultMatrix.a=c*o-d*_;t.resultMatrix.b=c*l-d*h;t.resultMatrix.c=d*o+c*_;t.resultMatrix.d=d*l+c*h}if(this.translateMix){this._temp[0]=this._data.offsetX;this._temp[1]=this._data.offsetY;this.target.localToWorld(this._temp);t.resultMatrix.tx+=(this._temp[0]-t.resultMatrix.tx)*this.translateMix;t.resultMatrix.ty+=(this._temp[1]-t.resultMatrix.ty)*this.translateMix;t.updateChild()}if(this.scaleMix>0){var u=Math.sqrt(t.resultMatrix.a*t.resultMatrix.a+t.resultMatrix.c*t.resultMatrix.c);var f=Math.sqrt(e*e+i*i);var p=u>1e-5?(u+(f-u+this._data.offsetScaleX)*this.scaleMix)/u:0;t.resultMatrix.a*=p;t.resultMatrix.c*=p;u=Math.sqrt(t.resultMatrix.b*t.resultMatrix.b+t.resultMatrix.d*t.resultMatrix.d);f=Math.sqrt(a*a+r*r);p=u>1e-5?(u+(f-u+this._data.offsetScaleY)*this.scaleMix)/u:0;t.resultMatrix.b*=p;t.resultMatrix.d*=p}if(this.shearMix>0){l=t.resultMatrix.b,h=t.resultMatrix.d;var m=Math.atan2(h,l);x=Math.atan2(r,a)-Math.atan2(i,e)-(m-Math.atan2(t.resultMatrix.c,t.resultMatrix.a));if(x>Math.PI)x-=Math.PI*2;else if(x<-Math.PI)x+=Math.PI*2;x=m+(x+this._data.offsetShearY*Math.PI/180)*this.shearMix;p=Math.sqrt(l*l+h*h);t.resultMatrix.b=Math.cos(x)*p;t.resultMatrix.d=Math.sin(x)*p}}}}class s extends Pt.Sprite{constructor(t=null,e=0){super();this._boneMatrixArray=[];this._lastTime=0;this._currAniIndex=-1;this._pause=true;this._aniClipIndex=-1;this._clipIndex=-1;this._skinIndex=0;this._skinName="default";this._aniMode=0;this._index=-1;this._total=-1;this._indexControl=false;this._eventIndex=0;this._drawOrderIndex=0;this._drawOrder=null;this._lastAniClipIndex=-1;this._lastUpdateAniClipIndex=-1;this._playAudio=true;this._soundChannelArr=[];if(t)this.init(t,e)}init(t,e=0){var a=0,i;if(e==1){this._graphicsCache=[];for(a=0,i=t.getAnimationCount();a<i;a++){this._graphicsCache.push([])}}this._yReverseMatrix=t.yReverseMatrix;this._aniMode=e;this._templet=t;this._templet._addReference(1);this._player=new l;this._player.cacheFrameRate=t.rate;this._player.templet=t;this._player.play();this._parseSrcBoneMatrix();this._boneList=t.mBoneArr;this._rootBone=t.mRootBone;this._aniSectionDic=t.aniSectionDic;if(t.ikArr.length>0){this._ikArr=[];for(a=0,i=t.ikArr.length;a<i;a++){this._ikArr.push(new it(t.ikArr[a],this._boneList))}}if(t.pathArr.length>0){var r;var s;if(this._pathDic==null)this._pathDic={};var n;for(a=0,i=t.pathArr.length;a<i;a++){r=t.pathArr[a];s=new O(r,this._boneList);n=this._boneSlotDic[r.name];if(n){s=new O(r,this._boneList);s.target=n}this._pathDic[r.name]=s}}if(t.tfArr.length>0){this._tfArr=[];for(a=0,i=t.tfArr.length;a<i;a++){this._tfArr.push(new _(t.tfArr[a],this._boneList))}}if(t.skinDataArray.length>0){var o=this._templet.skinDataArray[this._skinIndex];this._skinName=o.name}this._player.on(Pt.Event.PLAYED,this,this._onPlay);this._player.on(Pt.Event.STOPPED,this,this._onStop);this._player.on(Pt.Event.PAUSED,this,this._onPause)}get url(){return this._aniPath}set url(t){this.load(t)}load(t,e=null,a=0){this._aniPath=t;this._complete=e;this._loadAniMode=a;Pt.ILaya.loader.load([{url:t,type:Pt.ILaya.Loader.BUFFER}],Pt.Handler.create(this,this._onLoaded))}_onLoaded(){var t=Pt.ILaya.Loader.getRes(this._aniPath);if(t==null)return;if(M.Templet.TEMPLET_DICTIONARY==null){M.Templet.TEMPLET_DICTIONARY={}}var e;e=M.Templet.TEMPLET_DICTIONARY[this._aniPath];if(e){if(e.isParseFail){this._parseFail()}else{if(e.isParserComplete){this._parseComplete()}else{e.on(Pt.Event.COMPLETE,this,this._parseComplete);e.on(Pt.Event.ERROR,this,this._parseFail)}}}else{e=new M.Templet;e._setCreateURL(this._aniPath);M.Templet.TEMPLET_DICTIONARY[this._aniPath]=e;e.on(Pt.Event.COMPLETE,this,this._parseComplete);e.on(Pt.Event.ERROR,this,this._parseFail);e.isParserComplete=false;e.parseData(null,t)}}_parseComplete(){var t=M.Templet.TEMPLET_DICTIONARY[this._aniPath];if(t){this.init(t,this._loadAniMode);this.play(0,true)}this._complete&&this._complete.runWith(this)}_parseFail(){console.log("[Error]:"+this._aniPath+"解析失败")}_onPlay(){this.event(Pt.Event.PLAYED)}_onStop(){var t;var e=this._templet.eventAniArr;var a=e[this._aniClipIndex];if(a&&this._eventIndex<a.length){for(;this._eventIndex<a.length;this._eventIndex++){t=a[this._eventIndex];if(t.time>=this._player.playStart&&t.time<=this._player.playEnd){this.event(Pt.Event.LABEL,t)}}}this._drawOrder=null;this.event(Pt.Event.STOPPED)}_onPause(){this.event(Pt.Event.PAUSED)}_parseSrcBoneMatrix(){var t=0,e=0;e=this._templet.srcBoneMatrixArr.length;for(t=0;t<e;t++){this._boneMatrixArray.push(new Pt.Matrix)}if(this._aniMode==0){this._boneSlotDic=this._templet.boneSlotDic;this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic;this._boneSlotArray=this._templet.boneSlotArray}else{if(this._boneSlotDic==null)this._boneSlotDic={};if(this._bindBoneBoneSlotDic==null)this._bindBoneBoneSlotDic={};if(this._boneSlotArray==null)this._boneSlotArray=[];var a=this._templet.boneSlotArray;var i;var r;for(t=0,e=a.length;t<e;t++){i=a[t];r=this._bindBoneBoneSlotDic[i.parent];if(r==null){this._bindBoneBoneSlotDic[i.parent]=r=[]}this._boneSlotDic[i.name]=i=i.copy();r.push(i);this._boneSlotArray.push(i)}}}_emitMissedEvents(t,e,a=0){var i=this._templet.eventAniArr;var r=i[this._player.currentAnimationClipIndex];if(r){var s=0,n;var o;n=r.length;for(s=a;s<n;s++){o=r[s];if(o.time>=this._player.playStart&&o.time<=this._player.playEnd){this.event(Pt.Event.LABEL,o)}}}}_update(t=true){if(this._pause)return;if(t&&this._indexControl){return}var e=this.timer.currTimer;var a=this._player.currentKeyframeIndex;var i=e-this._lastTime;if(t){this._player._update(i)}else{a=-1}this._lastTime=e;if(!this._player)return;this._index=this._clipIndex=this._player.currentKeyframeIndex;if(this._index<0)return;if(i>0&&this._clipIndex==a&&this._lastUpdateAniClipIndex==this._aniClipIndex){return}this._lastUpdateAniClipIndex=this._aniClipIndex;if(a>this._clipIndex&&this._eventIndex!=0){this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex);this._eventIndex=0}var r=this._templet.eventAniArr[this._aniClipIndex];var s;if(r&&this._eventIndex<r.length){var n=r[this._eventIndex];if(n.time>=this._player.playStart&&n.time<=this._player.playEnd){if(this._player.currentPlayTime>=n.time){this.event(Pt.Event.LABEL,n);this._eventIndex++;if(this._playAudio&&n.audioValue&&n.audioValue!=="null"&&n.audioValue!=="undefined"){s=Pt.SoundManager.playSound(this._player.templet._path+n.audioValue,1,Pt.Handler.create(this,this._onAniSoundStoped));Pt.SoundManager.playbackRate=this._player.playbackRate;s&&this._soundChannelArr.push(s)}}}else if(n.time<this._player.playStart&&this._playAudio&&n.audioValue&&n.audioValue!=="null"&&n.audioValue!=="undefined"){this._eventIndex++;s=Pt.SoundManager.playSound(this._player.templet._path+n.audioValue,1,Pt.Handler.create(this,this._onAniSoundStoped),null,(this._player.currentPlayTime-n.time)/1e3);Pt.SoundManager.playbackRate=this._player.playbackRate;s&&this._soundChannelArr.push(s)}else{this._eventIndex++}}var o;if(this._aniMode==0){o=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex)||this._createGraphics();if(o&&this.graphics!=o){this.graphics=o}}else if(this._aniMode==1){o=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex)||this._createGraphics();if(o&&this.graphics!=o){this.graphics=o}}else{this._createGraphics()}}_onAniSoundStoped(t){var e;for(var a=this._soundChannelArr.length,i=0;i<a;i++){e=this._soundChannelArr[i];if(e.isStopped||t){!e.isStopped&&e.stop();this._soundChannelArr.splice(i,1);a--;i--}}}_createGraphics(t=-1){if(t==-1)t=this._clipIndex;var e=t*this._player.cacheFrameRateInterval;var a;var i=this._templet.drawOrderAniArr;var r=i[this._aniClipIndex];if(r&&r.length>0){this._drawOrderIndex=0;a=r[this._drawOrderIndex];while(e>=a.time){this._drawOrder=a.drawOrder;this._drawOrderIndex++;if(this._drawOrderIndex>=r.length){break}a=r[this._drawOrderIndex]}}if(this._aniMode==0||this._aniMode==1){this.graphics=U.create()}else{if(this.graphics instanceof U){this.graphics.clear()}else{this.graphics=U.create()}}var s=this.graphics;var n=this._templet.getNodes(this._aniClipIndex);var o=this._player.state==0;this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,null,t,o?e+this._player.cacheFrameRateInterval:e);var l=this._aniSectionDic[this._aniClipIndex];var _=0;var h=0,x=0,c=0,d=0;var u;var f;var p;var m;var B=this._templet.srcBoneMatrixArr.length;var g=this._curOriginalData;for(h=0,d=l[0];h<B;h++){m=this._boneList[h];var v=m.resultTransform;p=this._templet.srcBoneMatrixArr[h];v.scX=p.scX*g[_++];v.skX=p.skX+g[_++];v.skY=p.skY+g[_++];v.scY=p.scY*g[_++];v.x=p.x+g[_++];v.y=p.y+g[_++];if(this._templet.tMatrixDataLen===8){v.skewX=p.skewX+g[_++];v.skewY=p.skewY+g[_++]}}var y={};var T={};var E;for(d+=l[1];h<d;h++){E=n[h];y[E.name]=g[_++];T[E.name]=g[_++];_+=4}var b={};var S={};for(d+=l[2];h<d;h++){E=n[h];b[E.name]=g[_++];S[E.name]=g[_++];_+=4}if(this._pathDic){var C;for(d+=l[3];h<d;h++){E=n[h];C=this._pathDic[E.name];if(C){var F=new Pt.Byte(E.extenData);switch(F.getByte()){case 1:C.position=g[_++];break;case 2:C.spacing=g[_++];break;case 3:C.rotateMix=g[_++];C.translateMix=g[_++];break}}}}this._rootBone.update(this._yReverseMatrix||Pt.Matrix.TEMP.identity());if(this._ikArr){var R;for(h=0,d=this._ikArr.length;h<d;h++){R=this._ikArr[h];if(R.name in b){R.bendDirection=b[R.name]}if(R.name in S){R.mix=S[R.name]}R.apply()}}if(this._pathDic){for(var V in this._pathDic){C=this._pathDic[V];C.apply(this._boneList,s)}}if(this._tfArr){var A;for(h=0,c=this._tfArr.length;h<c;h++){A=this._tfArr[h];A.apply()}}for(h=0,c=this._boneList.length;h<c;h++){m=this._boneList[h];f=this._bindBoneBoneSlotDic[m.name];m.resultMatrix.copyTo(this._boneMatrixArray[h]);if(f){for(x=0,d=f.length;x<d;x++){u=f[x];if(u){u.setParentMatrix(m.resultMatrix)}}}}var L={};var I=this._templet.deformAniArr;var M;if(I&&I.length>0){if(this._lastAniClipIndex!=this._aniClipIndex){this._lastAniClipIndex=this._aniClipIndex;for(h=0,d=this._boneSlotArray.length;h<d;h++){u=this._boneSlotArray[h];u.deformData=null}}var D=I[this._aniClipIndex];M=D["default"];this._setDeform(M,L,this._boneSlotArray,e);var w;for(w in D){if(w!="default"&&w!=this._skinName){M=D[w];this._setDeform(M,L,this._boneSlotArray,e)}}M=D[this._skinName];this._setDeform(M,L,this._boneSlotArray,e)}var P;var O;var N;if(this._drawOrder){for(h=0,d=this._drawOrder.length;h<d;h++){u=this._boneSlotArray[this._drawOrder[h]];P=y[u.name];O=T[u.name];if(!isNaN(P)&&P!=-2){if(this._templet.attachmentNames){u.showDisplayByName(this._templet.attachmentNames[P])}else{u.showDisplayByIndex(P)}}if(L[this._drawOrder[h]]){N=L[this._drawOrder[h]];if(u.currDisplayData&&N[u.currDisplayData.attachmentName]){u.deformData=N[u.currDisplayData.attachmentName]}else{u.deformData=null}}else{u.deformData=null}if(!isNaN(O)){u.draw(s,this._boneMatrixArray,this._aniMode==2,O)}else{u.draw(s,this._boneMatrixArray,this._aniMode==2)}}}else{for(h=0,d=this._boneSlotArray.length;h<d;h++){u=this._boneSlotArray[h];P=y[u.name];O=T[u.name];if(!isNaN(P)&&P!=-2){if(this._templet.attachmentNames){u.showDisplayByName(this._templet.attachmentNames[P])}else{u.showDisplayByIndex(P)}}if(L[h]){N=L[h];if(u.currDisplayData&&N[u.currDisplayData.attachmentName]){u.deformData=N[u.currDisplayData.attachmentName]}else{u.deformData=null}}else{u.deformData=null}if(!isNaN(O)){u.draw(s,this._boneMatrixArray,this._aniMode==2,O)}else{u.draw(s,this._boneMatrixArray,this._aniMode==2)}}}if(this._aniMode==0){this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,s);this._checkIsAllParsed(this._aniClipIndex)}else if(this._aniMode==1){this._setGrahicsDataWithCache(this._aniClipIndex,t,s)}return s}_checkIsAllParsed(t){var e,a;a=Math.floor(.01+this._templet.getAniDuration(t)/1e3*this._player.cacheFrameRate);for(e=0;e<a;e++){if(!this._templet.getGrahicsDataWithCache(t,e))return}if(!this._templet.getGrahicsDataWithCache(t,a)){this._createGraphics(a);return}this._templet.deleteAniData(t)}_setDeform(t,e,a,i){if(!t)return;var r;var s;var n;var o,l,_;if(t){for(o=0,l=t.deformSlotDataList.length;o<l;o++){r=t.deformSlotDataList[o];for(_=0;_<r.deformSlotDisplayList.length;_++){s=r.deformSlotDisplayList[_];n=a[s.slotIndex];s.apply(i,n);if(!e[s.slotIndex]){e[s.slotIndex]={}}e[s.slotIndex][s.attachment]=s.deformData}}}}getAnimNum(){return this._templet.getAnimationCount()}getAniNameByIndex(t){return this._templet.getAniNameByIndex(t)}getSlotByName(t){return this._boneSlotDic[t]}showSkinByName(t,e=true){this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)}showSkinByIndex(t,e=true){for(var a=0;a<this._boneSlotArray.length;a++){this._boneSlotArray[a].showSlotData(null,e)}if(this._templet.showSkinByIndex(this._boneSlotDic,t,e)){var i=this._templet.skinDataArray[t];this._skinIndex=t;this._skinName=i.name}this._clearCache()}showSlotSkinByIndex(t,e){if(this._aniMode==0)return;var a=this.getSlotByName(t);if(a){a.showDisplayByIndex(e)}this._clearCache()}showSlotSkinByName(t,e){if(this._aniMode==0)return;var a=this.getSlotByName(t);if(a){a.showDisplayByName(e)}this._clearCache()}replaceSlotSkinName(t,e,a){if(this._aniMode==0)return;var i=this.getSlotByName(t);if(i){i.replaceDisplayByName(e,a)}this._clearCache()}replaceSlotSkinByIndex(t,e,a){if(this._aniMode==0)return;var i=this.getSlotByName(t);if(i){i.replaceDisplayByIndex(e,a)}this._clearCache()}setSlotSkin(t,e){if(this._aniMode==0)return;var a=this.getSlotByName(t);if(a){a.replaceSkin(e)}this._clearCache()}_clearCache(){if(this._aniMode==1){for(var t=0,e=this._graphicsCache.length;t<e;t++){for(var a=0,i=this._graphicsCache[t].length;a<i;a++){var r=this._graphicsCache[t][a];if(r&&r!=this.graphics){U.recycle(r)}}this._graphicsCache[t].length=0}}}play(t,e,a=true,i=0,r=0,s=true,n=true){this._playAudio=n;this._indexControl=false;var o=-1;var l;if(e){l=2147483647}else{l=0}if(typeof t=="string"){for(var _=0,h=this._templet.getAnimationCount();_<h;_++){var x=this._templet.getAnimation(_);if(x&&t==x.name){o=_;break}}}else{o=t}if(o>-1&&o<this.getAnimNum()){this._aniClipIndex=o;if(a||this._pause||this._currAniIndex!=o){this._currAniIndex=o;this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(o));this._drawOrder=null;this._eventIndex=0;this._player.play(o,this._player.playbackRate,l,i,r);if(s)this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex);if(this._pause){this._pause=false;this._lastTime=Pt.ILaya.Browser.now();this.timer.frameLoop(1,this,this._update,null,true)}this._update()}}}stop(){if(!this._pause){this._pause=true;if(this._player){this._player.stop(true)}if(this._soundChannelArr.length>0){this._onAniSoundStoped(true)}this.timer.clear(this,this._update)}}playbackRate(t){if(this._player){this._player.playbackRate=t}}paused(){if(!this._pause){this._pause=true;if(this._player){this._player.paused=true}if(this._soundChannelArr.length>0){var t;for(var e=this._soundChannelArr.length,a=0;a<e;a++){t=this._soundChannelArr[a];if(!t.isStopped){t.pause()}}}this.timer.clear(this,this._update)}}resume(){this._indexControl=false;if(this._pause){this._pause=false;if(this._player){this._player.paused=false}if(this._soundChannelArr.length>0){var t;for(var e=this._soundChannelArr.length,a=0;a<e;a++){t=this._soundChannelArr[a];if(t.audioBuffer){t.resume()}}}this._lastTime=Pt.ILaya.Browser.now();this.timer.frameLoop(1,this,this._update,null,true)}}_getGrahicsDataWithCache(t,e){return this._graphicsCache[t][e]}_setGrahicsDataWithCache(t,e,a){this._graphicsCache[t][e]=a}destroy(t=true){super.destroy(t);this._templet._removeReference(1);this._templet=null;if(this._player)this._player.offAll();this._player=null;this._curOriginalData=null;this._boneMatrixArray.length=0;this._lastTime=0;this.timer.clear(this,this._update);if(this._soundChannelArr.length>0){this._onAniSoundStoped(true)}}get index(){return this._index}set index(t){if(this.player){this._index=t;this._player.currentTime=this._index*1e3/this._player.cacheFrameRate;this._indexControl=true;this._update(false)}}get total(){if(this._templet&&this._player){this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate)}else{this._total=-1}return this._total}get player(){return this._player}get templet(){return this._templet}}s.useSimpleMeshInCanvas=false;M.Skeleton=s;Pt.ILaya.regClass(s);Pt.ClassUtils.regClass("laya.ani.bone.Skeleton",s);Pt.ClassUtils.regClass("Laya.Skeleton",s);class Wt{constructor(){this.slotArr=[]}}class Xt{createTexture(t){if(this.texture)return this.texture;this.texture=new Pt.Texture(t.bitmap,this.uvs);if(this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]){this.texture.width=t.height;this.texture.height=t.width;this.texture.offsetX=-t.offsetX;this.texture.offsetY=-t.offsetY;this.texture.sourceWidth=t.sourceHeight;this.texture.sourceHeight=t.sourceWidth}else{this.texture.width=t.width;this.texture.height=t.height;this.texture.offsetX=-t.offsetX;this.texture.offsetY=-t.offsetY;this.texture.sourceWidth=t.sourceWidth;this.texture.sourceHeight=t.sourceHeight}return this.texture}destory(){if(this.texture)this.texture.destroy()}}class Yt{constructor(){this.displayArr=[]}getDisplayByName(t){var e;for(var a=0,i=this.displayArr.length;a<i;a++){e=this.displayArr[a];if(e.attachmentName==t){return a}}return-1}}class jt{constructor(){this.boneIndexs=[]}}class n extends E{constructor(){super(...arguments);this._graphicsCache=[];this.srcBoneMatrixArr=[];this.ikArr=[];this.tfArr=[];this.pathArr=[];this.boneSlotDic={};this.bindBoneBoneSlotDic={};this.boneSlotArray=[];this.skinDataArray=[];this.skinDic={};this.subTextureDic={};this.isParseFail=false;this.drawOrderAniArr=[];this.eventAniArr=[];this.attachmentNames=null;this.deformAniArr=[];this.skinSlotDisplayDataArr=[];this._isParseAudio=false;this._isDestroyed=false;this._rate=30;this.isParserComplete=false;this.aniSectionDic={};this._textureDic={};this.mBoneArr=[]}loadAni(t){this._skBufferUrl=t;Pt.ILaya.loader.load(t,Pt.Handler.create(this,this.onComplete),null,Pt.ILaya.Loader.BUFFER)}onComplete(t=null){if(this._isDestroyed){this.destroy();return}var e=Pt.ILaya.Loader.getRes(this._skBufferUrl);if(!e){this.event(Pt.Event.ERROR,"load failed:"+this._skBufferUrl);return}this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/";this.parseData(null,e)}parseData(t,e,a=30){if(!this._path){var i=this._relativeUrl||this.url;if(i){var r=i.lastIndexOf("/");if(r>0){this._path=i.slice(0,r)+"/"}else{this._path=""}}}this._mainTexture=t;this._rate=a;this.parse(e)}buildArmature(t=0){return new s(this,t)}parse(t){super.parse(t);this.event(Pt.Event.LOADED,this);if(this._aniVersion===n.LAYA_ANIMATION_VISION){this._isParseAudio=true}else if(this._aniVersion!=n.LAYA_ANIMATION_160_VISION){console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+n.LAYA_ANIMATION_VISION)}if(this._mainTexture){this._parsePublicExtData()}else{this._parseTexturePath()}}_parseTexturePath(){if(this._isDestroyed){this.destroy();return}var t=0;this._loadList=[];var e=new Pt.Byte(this.getPublicExtData());var a=0,i=0,r=0,s=0;var n=0;var o=e.getInt32();var l=e.readUTFString();var _=l.split("\n");var h;for(t=0;t<o;t++){h=this._path+_[t*2];l=_[t*2+1];a=e.getFloat32();i=e.getFloat32();r=e.getFloat32();s=e.getFloat32();n=e.getFloat32();n=e.getFloat32();n=e.getFloat32();n=e.getFloat32();if(this._loadList.indexOf(h)==-1){this._loadList.push(h)}}Pt.ILaya.loader.load(this._loadList,Pt.Handler.create(this,this._textureComplete))}_textureComplete(){var t;for(var e=0,a=this._loadList.length;e<a;e++){t=this._loadList[e];this._textureDic[t]=Pt.ILaya.Loader.getRes(t)}this._parsePublicExtData()}_parsePublicExtData(){var t=0,e=0,a=0,i=0,r=0;for(t=0,r=this.getAnimationCount();t<r;t++){this._graphicsCache.push([])}var s;s=this._aniClassName!="Dragon";var n=new Pt.Byte(this.getPublicExtData());var B=0,F=0,o=0,l=0;var V=0,U=0,k=0,G=0;var _=0;var H=n.getInt32();var h=n.readUTFString();var z=h.split("\n");var x;var W;for(t=0;t<H;t++){x=this._mainTexture;W=this._path+z[t*2];h=z[t*2+1];if(this._mainTexture==null){x=this._textureDic[W]}if(!x){this.event(Pt.Event.ERROR,this);this.isParseFail=true;return}B=n.getFloat32();F=n.getFloat32();o=n.getFloat32();l=n.getFloat32();_=n.getFloat32();V=isNaN(_)?0:_;_=n.getFloat32();U=isNaN(_)?0:_;_=n.getFloat32();k=isNaN(_)?o:_;_=n.getFloat32();G=isNaN(_)?l:_;this.subTextureDic[h]=Pt.Texture.create(x,B,F,o,l,-V,-U,k,G)}this._mainTexture=x;var X=n.getUint16();var c;for(t=0;t<X;t++){c=[];c.push(n.getUint16());c.push(n.getUint16());c.push(n.getUint16());c.push(n.getUint16());this.aniSectionDic[t]=c}var d;var u;var f;var p;var m=n.getInt16();var Y={};var g;for(t=0;t<m;t++){d=new Nt;if(t==0){g=d}else{d.root=g}d.d=s?-1:1;f=n.readUTFString();p=n.readUTFString();d.length=n.getFloat32();if(n.getByte()==1){d.inheritRotation=false}if(n.getByte()==1){d.inheritScale=false}d.name=f;if(p){u=Y[p];if(u){u.addChild(d)}else{this.mRootBone=d}}Y[f]=d;this.mBoneArr.push(d)}this.tMatrixDataLen=n.getUint16();var j=n.getUint16();var q=Math.floor(j/this.tMatrixDataLen);var v;var Z=this.srcBoneMatrixArr;for(t=0;t<q;t++){v=new Ot;v.scX=n.getFloat32();v.skX=n.getFloat32();v.skY=n.getFloat32();v.scY=n.getFloat32();v.x=n.getFloat32();v.y=n.getFloat32();if(this.tMatrixDataLen===8){v.skewX=n.getFloat32();v.skewY=n.getFloat32()}Z.push(v);d=this.mBoneArr[t];d.transform=v}var y;var K=n.getUint16();var Q;for(t=0;t<K;t++){y=new Ht;Q=n.getUint16();for(e=0;e<Q;e++){y.boneNames.push(n.readUTFString());y.boneIndexs.push(n.getInt16())}y.name=n.readUTFString();y.targetBoneName=n.readUTFString();y.targetBoneIndex=n.getInt16();y.bendDirection=n.getFloat32();y.mix=n.getFloat32();y.isSpine=s;this.ikArr.push(y)}var T;var J=n.getUint16();var $;for(t=0;t<J;t++){T=new jt;$=n.getUint16();for(e=0;e<$;e++){T.boneIndexs.push(n.getInt16())}T.name=n.getUTFString();T.targetIndex=n.getInt16();T.rotateMix=n.getFloat32();T.translateMix=n.getFloat32();T.scaleMix=n.getFloat32();T.shearMix=n.getFloat32();T.offsetRotation=n.getFloat32();T.offsetX=n.getFloat32();T.offsetY=n.getFloat32();T.offsetScaleX=n.getFloat32();T.offsetScaleY=n.getFloat32();T.offsetShearY=n.getFloat32();this.tfArr.push(T)}var E;var tt=n.getUint16();var et;for(t=0;t<tt;t++){E=new zt;E.name=n.readUTFString();et=n.getUint16();for(e=0;e<et;e++){E.bones.push(n.getInt16())}E.target=n.readUTFString();E.positionMode=n.readUTFString();E.spacingMode=n.readUTFString();E.rotateMode=n.readUTFString();E.offsetRotation=n.getFloat32();E.position=n.getFloat32();E.spacing=n.getFloat32();E.rotateMix=n.getFloat32();E.translateMix=n.getFloat32();this.pathArr.push(E)}var at;var it;var rt;var st;var nt;var ot;var lt;var b;var S;var C;var R;var _t=n.getInt16();for(t=0;t<_t;t++){var ht=n.getUint8();var xt={};this.deformAniArr.push(xt);for(var ct=0;ct<ht;ct++){b=new Ft;b.skinName=n.getUTFString();xt[b.skinName]=b;at=n.getInt16();for(e=0;e<at;e++){S=new Vt;b.deformSlotDataList.push(S);it=n.getInt16();for(a=0;a<it;a++){C=new Ut;S.deformSlotDisplayList.push(C);C.slotIndex=rt=n.getInt16();C.attachment=st=n.getUTFString();nt=n.getInt16();for(i=0;i<nt;i++){if(n.getByte()==1){C.tweenKeyList.push(true)}else{C.tweenKeyList.push(false)}ot=n.getFloat32();C.timeList.push(ot);R=[];C.vectices.push(R);lt=n.getInt16();for(r=0;r<lt;r++){R.push(n.getFloat32())}}}}}}var dt;var ut=n.getInt16();var ft;var A;var pt;for(t=0;t<ut;t++){ft=n.getInt16();dt=[];for(e=0;e<ft;e++){A=new kt;A.time=n.getFloat32();pt=n.getInt16();for(a=0;a<pt;a++){A.drawOrder.push(n.getInt16())}dt.push(A)}this.drawOrderAniArr.push(dt)}var mt;var gt=n.getInt16();var vt;var L;for(t=0;t<gt;t++){vt=n.getInt16();mt=[];for(e=0;e<vt;e++){L=new Gt;L.name=n.getUTFString();if(this._isParseAudio)L.audioValue=n.getUTFString();L.intValue=n.getInt32();L.floatValue=n.getFloat32();L.stringValue=n.getUTFString();L.time=n.getFloat32();mt.push(L)}this.eventAniArr.push(mt)}var yt=n.getInt16();if(yt>0){this.attachmentNames=[];for(t=0;t<yt;t++){this.attachmentNames.push(n.getUTFString())}}var Tt=n.getInt16();var I;var M;for(t=0;t<Tt;t++){I=new Bt;I.name=n.readUTFString();I.parent=n.readUTFString();I.attachmentName=n.readUTFString();I.srcDisplayIndex=I.displayIndex=n.getInt16();I.templet=this;this.boneSlotDic[I.name]=I;M=this.bindBoneBoneSlotDic[I.parent];if(M==null){this.bindBoneBoneSlotDic[I.parent]=M=[]}M.push(I);this.boneSlotArray.push(I)}var Et=n.readUTFString();var D=Et.split("\n");var w=0;var bt=n.getUint8();var P,O,N;var St,Ct;var Rt,At,Lt,It,Mt;for(t=0;t<bt;t++){P=new Wt;P.name=D[w++];St=n.getUint8();for(e=0;e<St;e++){O=new Yt;O.name=D[w++];I=this.boneSlotDic[O.name];Ct=n.getUint8();for(a=0;a<Ct;a++){N=new Xt;this.skinSlotDisplayDataArr.push(N);N.name=D[w++];N.attachmentName=D[w++];N.transform=new Ot;N.transform.scX=n.getFloat32();N.transform.skX=n.getFloat32();N.transform.skY=n.getFloat32();N.transform.scY=n.getFloat32();N.transform.x=n.getFloat32();N.transform.y=n.getFloat32();O.displayArr.push(N);N.width=n.getFloat32();N.height=n.getFloat32();N.type=n.getUint8();N.verLen=n.getUint16();m=n.getUint16();if(m>0){N.bones=[];for(i=0;i<m;i++){var Dt=n.getUint16();N.bones.push(Dt)}}Rt=n.getUint16();if(Rt>0){N.uvs=[];for(i=0;i<Rt;i++){N.uvs.push(n.getFloat32())}}At=n.getUint16();if(At>0){N.weights=[];for(i=0;i<At;i++){N.weights.push(n.getFloat32())}}Lt=n.getUint16();if(Lt>0){N.triangles=[];for(i=0;i<Lt;i++){N.triangles.push(n.getUint16())}}It=n.getUint16();if(It>0){N.vertices=[];for(i=0;i<It;i++){N.vertices.push(n.getFloat32())}}Mt=n.getUint16();if(Mt>0){N.lengths=[];for(i=0;i<Mt;i++){N.lengths.push(n.getFloat32())}}}P.slotArr.push(O)}this.skinDic[P.name]=P;this.skinDataArray.push(P)}var wt=n.getUint8();if(wt==1){this.yReverseMatrix=new Pt.Matrix(1,0,0,-1,0,0);if(g){g.setTempMatrix(this.yReverseMatrix)}}else{if(g){g.setTempMatrix(new Pt.Matrix)}}this.showSkinByIndex(this.boneSlotDic,0);this.isParserComplete=true;this.event(Pt.Event.COMPLETE,this)}getTexture(t){var e=this.subTextureDic[t];if(!e){e=this.subTextureDic[t.substr(0,t.length-1)]}if(e==null){return this._mainTexture}return e}showSkinByIndex(t,e,a=true){if(e<0&&e>=this.skinDataArray.length)return false;var i,r;var s;var n;var o=this.skinDataArray[e];if(o){for(i=0,r=o.slotArr.length;i<r;i++){n=o.slotArr[i];if(n){s=t[n.name];if(s){s.showSlotData(n,a);if(a&&s.attachmentName!="undefined"&&s.attachmentName!="null"){s.showDisplayByName(s.attachmentName)}else{s.showDisplayByIndex(s.displayIndex)}}}}return true}return false}getSkinIndexByName(t){var e;for(var a=0,i=this.skinDataArray.length;a<i;a++){e=this.skinDataArray[a];if(e.name==t){return a}}return-1}getGrahicsDataWithCache(t,e){if(this._graphicsCache[t]&&this._graphicsCache[t][e]){return this._graphicsCache[t][e]}return null}_setCreateURL(t){this._skBufferUrl=this._relativeUrl=t;super._setCreateURL(t)}setGrahicsDataWithCache(t,e,a){this._graphicsCache[t][e]=a}deleteAniData(t){if(this._anis[t]){var e=this._anis[t];e.bone3DMap=null;e.nodes=null}}destroy(){this._isDestroyed=true;var t;for(t in this.subTextureDic){if(t){this.subTextureDic[t].destroy()}}for(t in this._textureDic){if(t){this._textureDic[t].destroy()}}var e;for(var a=0,i=this.skinSlotDisplayDataArr.length;a<i;a++){e=this.skinSlotDisplayDataArr[a];e.destory()}this.skinSlotDisplayDataArr.length=0;if(this._relativeUrl){delete n.TEMPLET_DICTIONARY[this._relativeUrl]}super.destroy();Pt.ILaya.loader.clearRes(this._skBufferUrl)}getAniNameByIndex(t){var e=this.getAnimation(t);if(e)return e.name;return null}get rate(){return this._rate}set rate(t){this._rate=t}}n.LAYA_ANIMATION_160_VISION="LAYAANIMATION:1.6.0";n.LAYA_ANIMATION_VISION="LAYAANIMATION:1.7.0";M.Templet=n;class p extends Pt.Sprite{constructor(t=null){super();this._start=0;this._Pos=0;this._ended=true;this._loadedImage={};this._endFrame=-1;this.interval=30;this._ids={};this._idOfSprite=[];this._reset();this._playing=false;this._parentMovieClip=t;if(!t){this._movieClipList=[this];this._isRoot=true;this._setBitUp(Pt.Const.DISPLAY)}else{this._isRoot=false;this._movieClipList=t._movieClipList;this._movieClipList.push(this)}}destroy(t=true){this._clear();super.destroy(t)}_setDisplay(t){super._setDisplay(t);if(this._isRoot){this._onDisplay(t)}}_onDisplay(t){if(t)this.timer.loop(this.interval,this,this.updates,null,true);else this.timer.clear(this,this.updates)}updates(){if(this._parentMovieClip)return;var t,e;e=this._movieClipList.length;for(t=0;t<e;t++){this._movieClipList[t]&&this._movieClipList[t]._update()}}get index(){return this._playIndex}set index(t){this._playIndex=t;if(this._data)this._displayFrame(this._playIndex);if(this._labels&&this._labels[t])this.event(Pt.Event.LABEL,this._labels[t])}addLabel(t,e){if(!this._labels)this._labels={};this._labels[e]=t}removeLabel(t){if(!t)this._labels=null;else if(!this._labels){for(var e in this._labels){if(this._labels[e]===t){delete this._labels[e];break}}}}get count(){return this._count}get playing(){return this._playing}_update(){if(!this._data)return;if(!this._playing)return;this._playIndex++;if(this._playIndex>=this._count){if(!this.loop){this._playIndex--;this.stop();return}this._playIndex=0}this._parseFrame(this._playIndex);if(this._labels&&this._labels[this._playIndex])this.event(Pt.Event.LABEL,this._labels[this._playIndex]);if(this._endFrame!=-1&&this._endFrame==this._playIndex){this._endFrame=-1;if(this._completeHandler!=null){var t=this._completeHandler;this._completeHandler=null;t.run()}this.stop()}}stop(){this._playing=false}gotoAndStop(t){this.index=t;this.stop()}_clear(){this.stop();this._idOfSprite.length=0;if(!this._parentMovieClip){this.timer.clear(this,this.updates);var t,e;e=this._movieClipList.length;for(t=0;t<e;t++){if(this._movieClipList[t]!=this)this._movieClipList[t]._clear()}this._movieClipList.length=0}if(this._atlasPath){Pt.ILaya.Loader.clearRes(this._atlasPath)}var a;for(a in this._loadedImage){if(this._loadedImage[a]){Pt.ILaya.Loader.clearRes(a);this._loadedImage[a]=false}}this.removeChildren();this.graphics=null;this._parentMovieClip=null}play(t=0,e=true){this.loop=e;this._playing=true;if(this._data)this._displayFrame(t)}_displayFrame(t=-1){if(t!=-1){if(this._curIndex>t)this._reset();this._parseFrame(t)}}_reset(t=true){if(t&&this._curIndex!=1)this.removeChildren();this._preIndex=this._curIndex=-1;this._Pos=this._start}_parseFrame(t){var e,a,i,r,s,n,o=false;var l=this._idOfSprite,_=this._data,h;if(this._ended)this._reset();_.pos=this._Pos;this._ended=false;this._playIndex=t;if(this._curIndex>t&&t<this._preIndex){this._reset(true);_.pos=this._Pos}while(this._curIndex<=t&&!this._ended){r=_.getUint16();switch(r){case 12:i=_.getUint16();s=this._ids[_.getUint16()];this._Pos=_.pos;_.pos=s;if((n=_.getUint8())==0){var x=_.getUint16();a=l[i];if(!a){a=l[i]=new Pt.Sprite;var c=new Pt.Sprite;c.loadImage(this.basePath+x+".png");this._loadedImage[this.basePath+x+".png"]=true;a.addChild(c);c.size(_.getFloat32(),_.getFloat32());var d=_._getMatrix();c.transform=d}a.alpha=1}else if(n==1){e=l[i];if(!e){l[i]=e=new p(this);e.interval=this.interval;e._ids=this._ids;e.basePath=this.basePath;e._setData(_,s);e._initState();e.play(0)}e.alpha=1}_.pos=this._Pos;break;case 3:var u=l[_.getUint16()];if(u){this.addChild(u);u.zOrder=_.getUint16();o=true}break;case 4:u=l[_.getUint16()];u&&u.removeSelf();break;case 5:l[_.getUint16()][p._ValueList[_.getUint16()]]=_.getFloat32();break;case 6:l[_.getUint16()].visible=_.getUint8()>0;break;case 7:a=l[_.getUint16()];var f=a.transform||Pt.Matrix.create();f.setTo(_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32());a.transform=f;break;case 8:l[_.getUint16()].setPos(_.getFloat32(),_.getFloat32());break;case 9:l[_.getUint16()].setSize(_.getFloat32(),_.getFloat32());break;case 10:l[_.getUint16()].alpha=_.getFloat32();break;case 11:l[_.getUint16()].setScale(_.getFloat32(),_.getFloat32());break;case 98:h=_.getString();this.event(h);if(h=="stop")this.stop();break;case 99:this._curIndex=_.getUint16();o&&this.updateZOrder();break;case 100:this._count=this._curIndex+1;this._ended=true;if(this._playing){this.event(Pt.Event.FRAME);this.event(Pt.Event.END);this.event(Pt.Event.COMPLETE)}this._reset(false);break}}if(this._playing&&!this._ended)this.event(Pt.Event.FRAME);this._Pos=_.pos}_setData(t,e){this._data=t;this._start=e+3}set url(t){this.load(t)}load(t,e=false,a=null){this._url=t;if(e)this._atlasPath=a?a:t.split(".swf")[0]+".json";this.stop();this._clear();this._movieClipList=[this];var i;i=[{url:t,type:Pt.ILaya.Loader.BUFFER}];if(this._atlasPath){i.push({url:this._atlasPath,type:Pt.ILaya.Loader.ATLAS})}Pt.ILaya.loader.load(i,Pt.Handler.create(this,this._onLoaded))}_onLoaded(){var t;t=Pt.ILaya.Loader.getRes(this._url);if(!t){this.event(Pt.Event.ERROR,"file not find");return}if(this._atlasPath&&!Pt.ILaya.Loader.getAtlas(this._atlasPath)){this.event(Pt.Event.ERROR,"Atlas not find");return}this.basePath=this._atlasPath?Pt.ILaya.Loader.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/";this._initData(t)}_initState(){this._reset();this._ended=false;var t=this._playing;this._playing=false;this._curIndex=0;while(!this._ended)this._parseFrame(++this._curIndex);this._playing=t}_initData(t){this._data=new Pt.Byte(t);var e,a=this._data.getUint16();for(e=0;e<a;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16();this._setData(this._data,this._ids[32767]);this._initState();this.play(0);this.event(Pt.Event.LOADED);if(!this._parentMovieClip)this.timer.loop(this.interval,this,this.updates,null,true)}playTo(t,e,a=null){this._completeHandler=a;this._endFrame=e;this.play(t,false)}}p._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"];t.AnimationContent=D;t.AnimationNodeContent=w;t.AnimationParser01=i;t.AnimationParser02=T;t.AnimationPlayer=l;t.AnimationState=e;t.AnimationTemplet=E;t.BezierLerp=x;t.Bone=Nt;t.BoneSlot=Bt;t.DeformAniData=Ft;t.DeformSlotData=Vt;t.DeformSlotDisplayData=Ut;t.DrawOrderData=kt;t.EventData=Gt;t.GraphicsAni=U;t.IAniLib=M;t.IkConstraint=it;t.IkConstraintData=Ht;t.KeyFramesContent=P;t.MeshData=a;t.MovieClip=p;t.PathConstraint=O;t.PathConstraintData=zt;t.Skeleton=s;t.SkinData=Wt;t.SkinMeshForGraphic=r;t.SkinSlotDisplayData=Xt;t.SlotData=Yt;t.Templet=n;t.TfConstraint=_;t.TfConstraintData=jt;t.Transform=Ot;t.UVTools=y})(window.Laya=window.Laya||{},Laya);(function(t,x){"use strict";class a{constructor(){this.textureName=null;this.textureCount=1;this.maxPartices=100;this.duration=1;this.ageAddScale=0;this.emitterVelocitySensitivity=1;this.minStartSize=100;this.maxStartSize=100;this.minEndSize=100;this.maxEndSize=100;this.minHorizontalVelocity=0;this.maxHorizontalVelocity=0;this.minVerticalVelocity=0;this.maxVerticalVelocity=0;this.endVelocity=1;this.gravity=new Float32Array([0,0,0]);this.minRotateSpeed=0;this.maxRotateSpeed=0;this.minStartRadius=0;this.maxStartRadius=0;this.minEndRadius=0;this.maxEndRadius=0;this.minHorizontalStartRadian=0;this.maxHorizontalStartRadian=0;this.minVerticalStartRadian=0;this.maxVerticalStartRadian=0;this.useEndRadian=true;this.minHorizontalEndRadian=0;this.maxHorizontalEndRadian=0;this.minVerticalEndRadian=0;this.maxVerticalEndRadian=0;this.minStartColor=new Float32Array([1,1,1,1]);this.maxStartColor=new Float32Array([1,1,1,1]);this.minEndColor=new Float32Array([1,1,1,1]);this.maxEndColor=new Float32Array([1,1,1,1]);this.colorComponentInter=false;this.disableColor=false;this.blendState=0;this.emitterType="null";this.emissionRate=0;this.pointEmitterPosition=new Float32Array([0,0,0]);this.pointEmitterPositionVariance=new Float32Array([0,0,0]);this.pointEmitterVelocity=new Float32Array([0,0,0]);this.pointEmitterVelocityAddVariance=new Float32Array([0,0,0]);this.boxEmitterCenterPosition=new Float32Array([0,0,0]);this.boxEmitterSize=new Float32Array([0,0,0]);this.boxEmitterVelocity=new Float32Array([0,0,0]);this.boxEmitterVelocityAddVariance=new Float32Array([0,0,0]);this.sphereEmitterCenterPosition=new Float32Array([0,0,0]);this.sphereEmitterRadius=1;this.sphereEmitterVelocity=0;this.sphereEmitterVelocityAddVariance=0;this.ringEmitterCenterPosition=new Float32Array([0,0,0]);this.ringEmitterRadius=30;this.ringEmitterVelocity=0;this.ringEmitterVelocityAddVariance=0;this.ringEmitterUp=2;this.positionVariance=new Float32Array([0,0,0])}static checkSetting(t){var e;for(e in a._defaultSetting){if(!(e in t)){t[e]=a._defaultSetting[e]}}t.endVelocity=+t.endVelocity;t.gravity[0]=+t.gravity[0];t.gravity[1]=+t.gravity[1];t.gravity[2]=+t.gravity[2]}}a._defaultSetting=new a;class e{constructor(){}addParticleArray(t,e){}}class c{constructor(){}static Create(t,e,a,i){var r=new c;r.position=e;x.MathUtil.scaleVector3(a,t.emitterVelocitySensitivity,c._tempVelocity);var s=x.MathUtil.lerp(t.minHorizontalVelocity,t.maxHorizontalVelocity,Math.random());var n=Math.random()*Math.PI*2;c._tempVelocity[0]+=s*Math.cos(n);c._tempVelocity[2]+=s*Math.sin(n);c._tempVelocity[1]+=x.MathUtil.lerp(t.minVerticalVelocity,t.maxVerticalVelocity,Math.random());r.velocity=c._tempVelocity;r.startColor=c._tempStartColor;r.endColor=c._tempEndColor;var o;if(t.disableColor){for(o=0;o<3;o++){r.startColor[o]=1;r.endColor[o]=1}r.startColor[o]=x.MathUtil.lerp(t.minStartColor[o],t.maxStartColor[o],Math.random());r.endColor[o]=x.MathUtil.lerp(t.minEndColor[o],t.maxEndColor[o],Math.random())}else{if(t.colorComponentInter){for(o=0;o<4;o++){r.startColor[o]=x.MathUtil.lerp(t.minStartColor[o],t.maxStartColor[o],Math.random());r.endColor[o]=x.MathUtil.lerp(t.minEndColor[o],t.maxEndColor[o],Math.random())}}else{x.MathUtil.lerpVector4(t.minStartColor,t.maxStartColor,Math.random(),r.startColor);x.MathUtil.lerpVector4(t.minEndColor,t.maxEndColor,Math.random(),r.endColor)}}r.sizeRotation=c._tempSizeRotation;var l=Math.random();r.sizeRotation[0]=x.MathUtil.lerp(t.minStartSize,t.maxStartSize,l);r.sizeRotation[1]=x.MathUtil.lerp(t.minEndSize,t.maxEndSize,l);r.sizeRotation[2]=x.MathUtil.lerp(t.minRotateSpeed,t.maxRotateSpeed,Math.random());r.radius=c._tempRadius;var _=Math.random();r.radius[0]=x.MathUtil.lerp(t.minStartRadius,t.maxStartRadius,_);r.radius[1]=x.MathUtil.lerp(t.minEndRadius,t.maxEndRadius,_);r.radian=c._tempRadian;r.radian[0]=x.MathUtil.lerp(t.minHorizontalStartRadian,t.maxHorizontalStartRadian,Math.random());r.radian[1]=x.MathUtil.lerp(t.minVerticalStartRadian,t.maxVerticalStartRadian,Math.random());var h=t.useEndRadian;r.radian[2]=h?x.MathUtil.lerp(t.minHorizontalEndRadian,t.maxHorizontalEndRadian,Math.random()):r.radian[0];r.radian[3]=h?x.MathUtil.lerp(t.minVerticalEndRadian,t.maxVerticalEndRadian,Math.random()):r.radian[1];r.durationAddScale=t.ageAddScale*Math.random();r.time=i;return r}}c._tempVelocity=new Float32Array(3);c._tempStartColor=new Float32Array(4);c._tempEndColor=new Float32Array(4);c._tempSizeRotation=new Float32Array(3);c._tempRadius=new Float32Array(2);c._tempRadian=new Float32Array(4);class i extends e{constructor(t){super();this._floatCountPerVertex=29;this._firstActiveElement=0;this._firstNewElement=0;this._firstFreeElement=0;this._firstRetiredElement=0;this._currentTime=0;this.settings=t}reUse(t,e){return 0}initialize(){var t=0;this._vertices=this._mesh._vb.getFloat32Array();t=this._mesh._stride/4;var e=0;var a=0;for(var i=0;i<this.settings.maxPartices;i++){var r=Math.random();var s=this.settings.textureCount?1/this.settings.textureCount:1;var n;for(n=0;n<this.settings.textureCount;n+=s){if(r<n+s)break}this._vertices[e++]=-1;this._vertices[e++]=-1;this._vertices[e++]=0;this._vertices[e++]=n;e=a+=t;this._vertices[e++]=1;this._vertices[e++]=-1;this._vertices[e++]=1;this._vertices[e++]=n;e=a+=t;this._vertices[e++]=1;this._vertices[e++]=1;this._vertices[e++]=1;this._vertices[e++]=n+s;e=a+=t;this._vertices[e++]=-1;this._vertices[e++]=1;this._vertices[e++]=0;this._vertices[e++]=n+s;e=a+=t}}update(t){this._currentTime+=t/1e3;this.retireActiveParticles();this.freeRetiredParticles();if(this._firstActiveElement==this._firstFreeElement)this._currentTime=0;if(this._firstRetiredElement==this._firstActiveElement)this._drawCounter=0}retireActiveParticles(){const t=1e-4;var e=this.settings.duration;while(this._firstActiveElement!=this._firstNewElement){var a=this._firstActiveElement*this._floatCountPerVertex*4;var i=a+28;var r=this._currentTime-this._vertices[i];r*=1+this._vertices[a+27];if(r+t<e)break;this._vertices[i]=this._drawCounter;this._firstActiveElement++;if(this._firstActiveElement>=this.settings.maxPartices)this._firstActiveElement=0}}freeRetiredParticles(){while(this._firstRetiredElement!=this._firstActiveElement){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*4+28];if(t<3)break;this._firstRetiredElement++;if(this._firstRetiredElement>=this.settings.maxPartices)this._firstRetiredElement=0}}addNewParticlesToVertexBuffer(){}addParticleArray(t,e){var a=this._firstFreeElement+1;if(a>=this.settings.maxPartices)a=0;if(a===this._firstRetiredElement)return;var i=c.Create(this.settings,t,e,this._currentTime);var r=this._firstFreeElement*this._floatCountPerVertex*4;for(var s=0;s<4;s++){var n,o;for(n=0,o=4;n<3;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.position[n];for(n=0,o=7;n<3;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.velocity[n];for(n=0,o=10;n<4;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.startColor[n];for(n=0,o=14;n<4;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.endColor[n];for(n=0,o=18;n<3;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.sizeRotation[n];for(n=0,o=21;n<2;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.radius[n];for(n=0,o=23;n<4;n++)this._vertices[r+s*this._floatCountPerVertex+o+n]=i.radian[n];this._vertices[r+s*this._floatCountPerVertex+27]=i.durationAddScale;this._vertices[r+s*this._floatCountPerVertex+28]=i.time}this._firstFreeElement=a}}var r="attribute vec4 a_CornerTextureCoordinate;\r\nattribute vec3 a_Position;\r\nattribute vec3 a_Velocity;\r\nattribute vec4 a_StartColor;\r\nattribute vec4 a_EndColor;\r\nattribute vec3 a_SizeRotation;\r\nattribute vec2 a_Radius;\r\nattribute vec4 a_Radian;\r\nattribute float a_AgeAddScale;\r\nattribute float a_Time;\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\n\r\nuniform float u_CurrentTime;\r\nuniform float u_Duration;\r\nuniform float u_EndVelocity;\r\nuniform vec3 u_Gravity;\r\n\r\nuniform vec2 size;\r\nuniform mat4 u_mmat;\r\n\r\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\r\n{\r\n\r\n   float startVelocity = length(velocity);//起始标量速度\r\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\r\n\r\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\r\n   \r\n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \r\n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\r\n   \r\n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\r\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\r\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\r\n   \r\n   float r =cos(radianVertical)* radius;\r\n   addPosition.y += sin(radianVertical) * radius;\r\n\t\r\n   addPosition.x += cos(radianHorizontal) *r;\r\n   addPosition.z += sin(radianHorizontal) *r;\r\n  \r\n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\r\n   position+=addPosition;\r\n   return  vec4(position,1.0);\r\n}\r\n\r\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\r\n{    \r\n    float size = mix(startSize, endSize, normalizedAge);\r\n    return size;\r\n}\r\n\r\nmat2 ComputeParticleRotation(in float rot,in float age)\r\n{    \r\n    float rotation =rot * age;\r\n    //计算2x2旋转矩阵.\r\n    float c = cos(rotation);\r\n    float s = sin(rotation);\r\n    return mat2(c, -s, s, c);\r\n}\r\n\r\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\r\n{\r\n\tvec4 color=mix(startColor,endColor,normalizedAge);\r\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\r\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\r\n   \r\n    return color;\r\n}\r\n\r\nvoid main()\r\n{\r\n   float age = u_CurrentTime - a_Time;\r\n   age *= 1.0 + a_AgeAddScale;\r\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\r\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\r\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\r\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\r\n\t\r\n    mat4 mat=u_mmat;\r\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\r\n    gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\r\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\r\n   \r\n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\r\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\r\n}\r\n\r\n";var s="#if defined(GL_FRAGMENT_PRECISION_HIGH)\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\nuniform sampler2D u_texture;\r\n\r\nvoid main()\r\n{\t\r\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\r\n\tgl_FragColor.xyz *= v_Color.w;\r\n}";class n extends x.Shader{constructor(){super(r,s,"ParticleShader",null,["a_CornerTextureCoordinate",0,"a_Position",1,"a_Velocity",2,"a_StartColor",3,"a_EndColor",4,"a_SizeRotation",5,"a_Radius",6,"a_Radian",7,"a_AgeAddScale",8,"a_Time",9])}}n.vs=r;n.ps=s;class o extends x.Value2D{constructor(){super(0,0);if(!o.pShader){o.pShader=new n}}upload(){var t=this.size;t[0]=x.RenderState2D.width;t[1]=x.RenderState2D.height;this.alpha=this.ALPHA*x.RenderState2D.worldAlpha;o.pShader.upload(this)}}o.pShader=null;class l extends i{constructor(t){super(t);this.x=0;this.y=0;this.sv=new o;this._key={};var e=this;x.ILaya.loader.load(this.settings.textureName,x.Handler.create(null,function(t){e.texture=t}),null,x.Loader.IMAGE);this.sv.u_Duration=this.settings.duration;this.sv.u_Gravity=this.settings.gravity;this.sv.u_EndVelocity=this.settings.endVelocity;this._blendFn=x.BlendMode.fns[t.blendState];this._mesh=x.MeshParticle2D.getAMesh(this.settings.maxPartices);this.initialize()}getRenderType(){return-111}releaseRender(){}addParticleArray(t,e){t[0]+=this.x;t[1]+=this.y;super.addParticleArray(t,e)}addNewParticlesToVertexBuffer(){var t=this._mesh._vb;t.clear();t.append(this._vertices);var e;if(this._firstNewElement<this._firstFreeElement){e=this._firstNewElement*4*this._floatCountPerVertex*4;t.subUpload(e,e,e+(this._firstFreeElement-this._firstNewElement)*4*this._floatCountPerVertex*4)}else{e=this._firstNewElement*4*this._floatCountPerVertex*4;t.subUpload(e,e,e+(this.settings.maxPartices-this._firstNewElement)*4*this._floatCountPerVertex*4);if(this._firstFreeElement>0){t.setNeedUpload();t.subUpload(0,0,this._firstFreeElement*4*this._floatCountPerVertex*4)}}this._firstNewElement=this._firstFreeElement}renderSubmit(){if(this.texture&&this.texture.getIsReady()){this.update(x.ILaya.timer._delta);this.sv.u_CurrentTime=this._currentTime;if(this._firstNewElement!=this._firstFreeElement){this.addNewParticlesToVertexBuffer()}this.blend();if(this._firstActiveElement!=this._firstFreeElement){var t=x.WebGLContext.mainContext;this._mesh.useMesh(t);this.sv.u_texture=this.texture._getSource();this.sv.upload();if(this._firstActiveElement<this._firstFreeElement){t.drawElements(t.TRIANGLES,(this._firstFreeElement-this._firstActiveElement)*6,t.UNSIGNED_SHORT,this._firstActiveElement*6*2)}else{x.WebGLContext.mainContext.drawElements(t.TRIANGLES,(this.settings.maxPartices-this._firstActiveElement)*6,t.UNSIGNED_SHORT,this._firstActiveElement*6*2);if(this._firstFreeElement>0)t.drawElements(t.TRIANGLES,this._firstFreeElement*6,t.UNSIGNED_SHORT,0)}x.Stat.renderBatches++}this._drawCounter++}return 1}updateParticleForNative(){if(this.texture&&this.texture.getIsReady()){this.update(x.ILaya.timer._delta);this.sv.u_CurrentTime=this._currentTime;if(this._firstNewElement!=this._firstFreeElement){this._firstNewElement=this._firstFreeElement}}}getMesh(){return this._mesh}getConchMesh(){return this._conchMesh}getFirstNewElement(){return this._firstNewElement}getFirstFreeElement(){return this._firstFreeElement}getFirstActiveElement(){return this._firstActiveElement}getFirstRetiredElement(){return this._firstRetiredElement}setFirstFreeElement(t){this._firstFreeElement=t}setFirstNewElement(t){this._firstNewElement=t}addDrawCounter(){this._drawCounter++}blend(){if(x.BlendMode.activeBlendFunction!==this._blendFn){var t=x.WebGLContext.mainContext;t.enable(t.BLEND);this._blendFn(t);x.BlendMode.activeBlendFunction=this._blendFn}}dispose(){this._mesh.releaseMesh()}}l.activeBlendType=-1;class _{constructor(){this._frameTime=0;this._emissionRate=60;this._emissionTime=0;this.minEmissionTime=1/60}set particleTemplate(t){this._particleTemplate=t}set emissionRate(t){if(t<=0)return;this._emissionRate=t;t>0&&(this.minEmissionTime=1/t)}get emissionRate(){return this._emissionRate}start(t=Number.MAX_VALUE){if(this._emissionRate!=0)this._emissionTime=t}stop(){this._emissionTime=0}clear(){this._emissionTime=0}emit(){}advanceTime(t=1){this._emissionTime-=t;if(this._emissionTime<0)return;this._frameTime+=t;if(this._frameTime<this.minEmissionTime)return;while(this._frameTime>this.minEmissionTime){this._frameTime-=this.minEmissionTime;this.emit()}}}class h extends _{constructor(t){super();this.template=t}set template(t){this._particleTemplate=t;if(!t){this._emitFun=null;this.setting=null;this._posRange=null}this.setting=t.settings;this._posRange=this.setting.positionVariance;if(this._particleTemplate instanceof l){this._emitFun=this.webGLEmit}}get template(){return this._particleTemplate}emit(){super.emit();if(this._emitFun!=null)this._emitFun()}getRandom(t){return(Math.random()*2-1)*t}webGLEmit(){var t=new Float32Array(3);t[0]=this.getRandom(this._posRange[0]);t[1]=this.getRandom(this._posRange[1]);t[2]=this.getRandom(this._posRange[2]);var e=new Float32Array(3);e[0]=0;e[1]=0;e[2]=0;this._particleTemplate.addParticleArray(t,e)}canvasEmit(){var t=new Float32Array(3);t[0]=this.getRandom(this._posRange[0]);t[1]=this.getRandom(this._posRange[1]);t[2]=this.getRandom(this._posRange[2]);var e=new Float32Array(3);e[0]=0;e[1]=0;e[2]=0;this._particleTemplate.addParticleArray(t,e)}}class d extends x.Sprite{constructor(t){super();this._matrix4=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.autoPlay=true;this.customRenderEnable=true;if(t)this.setParticleSetting(t)}set url(t){this.load(t)}load(t){x.ILaya.loader.load(t,x.Handler.create(this,this.setParticleSetting),null,x.ILaya.Loader.JSON)}setParticleSetting(t){if(!t)return this.stop();a.checkSetting(t);this.customRenderEnable=true;this._particleTemplate=new l(t);this.graphics._saveToCmd(null,x.DrawParticleCmd.create(this._particleTemplate));if(!this._emitter){this._emitter=new h(this._particleTemplate)}else{this._emitter.template=this._particleTemplate}if(this.autoPlay){this.emitter.start();this.play()}}get emitter(){return this._emitter}play(){x.ILaya.timer.frameLoop(1,this,this._loop)}stop(){x.ILaya.timer.clear(this,this._loop)}_loop(){this.advanceTime(1/60)}advanceTime(t=1){if(this._canvasTemplate){this._canvasTemplate.advanceTime(t)}if(this._emitter){this._emitter.advanceTime(t)}}customRender(t,e,a){this._matrix4[0]=t._curMat.a;this._matrix4[1]=t._curMat.b;this._matrix4[4]=t._curMat.c;this._matrix4[5]=t._curMat.d;this._matrix4[12]=t._curMat.tx;this._matrix4[13]=t._curMat.ty;var i=this._particleTemplate.sv;i.u_mmat=this._matrix4;if(this._canvasTemplate){this._canvasTemplate.render(t,e,a)}}destroy(t=true){if(this._particleTemplate instanceof l)this._particleTemplate.dispose();super.destroy(t)}}x.ClassUtils.regClass("laya.particle.Particle2D",d);x.ClassUtils.regClass("Laya.Particle2D",d);x.ILaya.regClass(d);class u{constructor(t,e,a){this._timeLeftOver=0;this._tempVelocity=new Float32Array([0,0,0]);this._tempPosition=new Float32Array([0,0,0]);this._templet=t;this._timeBetweenParticles=1/e;this._previousPosition=a}update(t,e){t=t/1e3;if(t>0){x.MathUtil.subtractVector3(e,this._previousPosition,this._tempVelocity);x.MathUtil.scaleVector3(this._tempVelocity,1/t,this._tempVelocity);var a=this._timeLeftOver+t;var i=-this._timeLeftOver;while(a>this._timeBetweenParticles){i+=this._timeBetweenParticles;a-=this._timeBetweenParticles;x.MathUtil.lerpVector3(this._previousPosition,e,i/t,this._tempPosition);this._templet.addParticleArray(this._tempPosition,this._tempVelocity)}this._timeLeftOver=a}this._previousPosition[0]=e[0];this._previousPosition[1]=e[1];this._previousPosition[2]=e[2]}}t.Emitter2D=h;t.EmitterBase=_;t.Particle2D=d;t.ParticleData=c;t.ParticleEmitter=u;t.ParticleSetting=a;t.ParticleShader=n;t.ParticleShaderValue=o;t.ParticleTemplate2D=l;t.ParticleTemplateBase=e;t.ParticleTemplateWebGL=i})(window.Laya=window.Laya||{},Laya);(function(t,c){"use strict";class s{}s.touchScrollEnable=true;s.mouseWheelEnable=true;s.showButtons=true;s.popupBgColor="#000000";s.popupBgAlpha=.5;s.closeDialogOnSide=true;window.UIConfig=s;class n{}n.defaultSizeGrid=[4,4,4,4,0];n.labelColor="#000000";n.labelPadding=[2,2,2,2];n.inputLabelPadding=[1,1,1,3];n.buttonStateNum=3;n.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"];n.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"];n.scrollBarMinNum=15;n.scrollBarDelayTime=500;class e extends c.Graphics{constructor(){super(...arguments);this.autoCacheCmd=true;this._width=0;this._height=0;this.uv=null}destroy(){super.destroy();this._source=null;this._sizeGrid=null;this._offset=null}get sizeGrid(){return this._sizeGrid}set sizeGrid(t){this._sizeGrid=t.map(t=>{return+t});this._setChanged()}get width(){if(this._width)return this._width;if(this._source)return this._source.sourceWidth;return 0}set width(t){if(this._width!=t){this._width=t;this._setChanged()}}get height(){if(this._height)return this._height;if(this._source)return this._source.sourceHeight;return 0}set height(t){if(this._height!=t){this._height=t;this._setChanged()}}get source(){return this._source}set source(t){if(t){this._source=t;this._setChanged()}else{this._source=null;if(this._drawGridCmd){if(this._one){if(this._one==this._drawGridCmd){this.clear()}}let t=this.cmds;if(t&&t.length>0){if(t[0]==this._drawGridCmd){t.splice(0,1)}}}}}_setChanged(){if(!this._isChanged){this._isChanged=true;c.ILaya.timer.callLater(this,this.changeSource)}}_createDrawTexture(t,e=0,a=0,i=0,r=0,s=null,n=1,o=null,l=null,_){if(!t||n<.01)return null;if(!t.getIsReady())return null;if(!i)i=t.sourceWidth;if(!r)r=t.sourceHeight;if(t.getIsReady()){var h=i/t.sourceWidth;var x=r/t.sourceHeight;i=t.width*h;r=t.height*x;if(i<=0||r<=0)return null;e+=t.offsetX*h;a+=t.offsetY*x}if(this._sp){this._sp._renderType|=c.SpriteConst.GRAPHICS;this._sp._setRenderType(this._sp._renderType)}return c.DrawTextureCmd.create.call(this,t,e,a,i,r,s,n,o,l,_)}changeSource(){this._isChanged=false;var e=this._source;if(!e||!e.bitmap)return;var a=this.width;var i=this.height;var r=this._sizeGrid;var t=e.sourceWidth;var s=e.sourceHeight;if(!r||t===a&&s===i){let t=this._createDrawTexture(e,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,a,i,null,1,null,null,this.uv);t&&this._setDrawGridCmd(t)}else{let t=c.Draw9GridTexture.create(e,0,0,a,i,r);this._setDrawGridCmd(t)}this._repaint()}drawBitmap(t,e,a,i,r=0,s=0){if(r<.1||s<.1)return;if(t&&(e.width!=r||e.height!=s))this.fillTexture(e,a,i,r,s);else this.drawImage(e,a,i,r,s)}static getTexture(t,e,a,i,r){if(i<=0)i=1;if(r<=0)r=1;t.$_GID||(t.$_GID=c.Utils.getGID());var s;if(!s||!s._getSource()){s=c.Texture.createFromTexture(t,e,a,i,r)}return s}_setDrawGridCmd(e){var t=this._source;if(!t||!t.bitmap){return}let a=this.cmds;if(!this._one&&(!a||a.length<=0)){this._saveToCmd(null,e)}else{let t=this._one;if(t){if(t==this._drawGridCmd){this._one=e}else{this.clear();this._saveToCmd(null,e);this._saveToCmd(null,t)}}else{a.splice(0,0,e)}}this._drawGridCmd=e}}c.ClassUtils.regClass("laya.ui.AutoBitmap",e);c.ClassUtils.regClass("Laya.AutoBitmap",e);class a extends c.Component{constructor(){super(...arguments);this._top=NaN;this._bottom=NaN;this._left=NaN;this._right=NaN;this._centerX=NaN;this._centerY=NaN}onReset(){this._top=this._bottom=this._left=this._right=this._centerX=this._centerY=NaN}_onEnable(){if(this.owner.parent)this._onAdded();else this.owner.once(c.Event.ADDED,this,this._onAdded)}_onDisable(){this.owner.off(c.Event.ADDED,this,this._onAdded);if(this.owner.parent)this.owner.parent.off(c.Event.RESIZE,this,this._onParentResize)}_onAdded(){if(this.owner.parent)this.owner.parent.on(c.Event.RESIZE,this,this._onParentResize);this.resetLayoutX();this.resetLayoutY()}_onParentResize(){var t=this.resetLayoutX();var e=this.resetLayoutY();if(t||e)this.owner.event(c.Event.RESIZE)}resetLayoutX(){var t=this.owner;if(!t)return false;var e=t.parent;if(e){if(!isNaN(this.centerX)){t.x=Math.round((e.width-t.displayWidth)*.5+this.centerX+t.pivotX*t.scaleX)}else if(!isNaN(this.left)){t.x=Math.round(this.left+t.pivotX*t.scaleX);if(!isNaN(this.right)){var a=(e._width-this.left-this.right)/(t.scaleX||.01);if(a!=t.width){t.width=a;return true}}}else if(!isNaN(this.right)){t.x=Math.round(e.width-t.displayWidth-this.right+t.pivotX*t.scaleX)}}return false}resetLayoutY(){var t=this.owner;if(!t)return false;var e=t.parent;if(e){if(!isNaN(this.centerY)){t.y=Math.round((e.height-t.displayHeight)*.5+this.centerY+t.pivotY*t.scaleY)}else if(!isNaN(this.top)){t.y=Math.round(this.top+t.pivotY*t.scaleY);if(!isNaN(this.bottom)){var a=(e._height-this.top-this.bottom)/(t.scaleY||.01);if(a!=t.height){t.height=a;return true}}}else if(!isNaN(this.bottom)){t.y=Math.round(e.height-t.displayHeight-this.bottom+t.pivotY*t.scaleY)}}return false}resetLayout(){if(this.owner){this.resetLayoutX();this.resetLayoutY()}}get top(){return this._top}set top(t){if(this._top!=t){this._top=t;this.resetLayoutY()}}get bottom(){return this._bottom}set bottom(t){if(this._bottom!=t){this._bottom=t;this.resetLayoutY()}}get left(){return this._left}set left(t){if(this._left!=t){this._left=t;this.resetLayoutX()}}get right(){return this._right}set right(t){if(this._right!=t){this._right=t;this.resetLayoutX()}}get centerX(){return this._centerX}set centerX(t){if(this._centerX!=t){this._centerX=t;this.resetLayoutX()}}get centerY(){return this._centerY}set centerY(t){if(this._centerY!=t){this._centerY=t;this.resetLayoutY()}}}a.EMPTY=null;c.ILaya.regClass(a);a.EMPTY=new a;c.ClassUtils.regClass("laya.ui.Widget",a);c.ClassUtils.regClass("Laya.Widget",a);class i extends c.Event{}i.SHOW_TIP="showtip";i.HIDE_TIP="hidetip";c.ILaya.regClass(i);c.ClassUtils.regClass("laya.ui.UIEvent",i);c.ClassUtils.regClass("Laya.UIEvent",i);class _{static fillArray(t,e,a=null){var i=t.concat();if(e){var r=e.split(",");for(var s=0,n=Math.min(i.length,r.length);s<n;s++){var o=r[s];i[s]=o=="true"?true:o=="false"?false:o;if(a!=null)i[s]=a(o)}}return i}static toColor(t){return c.Utils.toHexColor(t)}static gray(t,e=true){if(e){_.addFilter(t,_.grayFilter)}else{_.clearFilter(t,c.ColorFilter)}}static addFilter(t,e){var a=t.filters||[];a.push(e);t.filters=a}static clearFilter(t,e){var a=t.filters;if(a!=null&&a.length>0){for(var i=a.length-1;i>-1;i--){var r=a[i];if(r instanceof e)a.splice(i,1)}t.filters=a}}static _getReplaceStr(t){return _.escapeSequence[t]}static adptString(t){return t.replace(/\\(\w)/g,_._getReplaceStr)}static getBindFun(t){if(!_._funMap){_._funMap=new c.WeakObject}var e=_._funMap.get(t);if(e==null){var a='"'+t+'"';a=a.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"');var i="(function(data){if(data==null)return;with(data){try{\nreturn "+a+"\n}catch(e){}}})";e=window.Laya._runScript(i);_._funMap.set(t,e)}return e}}_.grayFilter=new c.ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]);_.escapeSequence={"\\n":"\n","\\t":"\t"};_._funMap=null;c.ClassUtils.regClass("laya.ui.UIUtils",_);c.ClassUtils.regClass("Laya.UIUtils",_);class r extends c.Sprite{constructor(t=true){super();this._anchorX=NaN;this._anchorY=NaN;this._widget=a.EMPTY;if(t){this.preinitialize();this.createChildren();this.initialize()}}destroy(t=true){super.destroy(t);this._dataSource=null;this._tag=null;this._toolTip=null}preinitialize(){}createChildren(){}initialize(){}get width(){return this.get_width()}get_width(){if(this._width)return this._width;return this.measureWidth()}measureWidth(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var a=this.getChildAt(e);if(a._visible){t=Math.max(a._x+a.width*a.scaleX,t)}}return t}commitMeasure(){}get height(){return this.get_height()}get_height(){if(this._height)return this._height;return this.measureHeight()}measureHeight(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var a=this.getChildAt(e);if(a._visible){t=Math.max(a._y+a.height*a.scaleY,t)}}return t}get dataSource(){return this.get_dataSource()}get_dataSource(){return this._dataSource}set dataSource(t){this.set_dataSource(t)}set_dataSource(t){this._dataSource=t;for(var e in this._dataSource){if(e in this&&!(typeof this[e]=="function")){this[e]=this._dataSource[e]}}}get top(){return this.get_top()}get_top(){return this._widget.top}set top(t){this.set_top(t)}set_top(t){if(t!=this._widget.top){this._getWidget().top=t}}get bottom(){return this.get_bottom()}get_bottom(){return this._widget.bottom}set bottom(t){this.set_bottom(t)}set_bottom(t){if(t!=this._widget.bottom){this._getWidget().bottom=t}}get left(){return this._widget.left}set left(t){if(t!=this._widget.left){this._getWidget().left=t}}get right(){return this._widget.right}set right(t){if(t!=this._widget.right){this._getWidget().right=t}}get centerX(){return this._widget.centerX}set centerX(t){if(t!=this._widget.centerX){this._getWidget().centerX=t}}get centerY(){return this._widget.centerY}set centerY(t){if(t!=this._widget.centerY){this._getWidget().centerY=t}}_sizeChanged(){if(!isNaN(this._anchorX))this.pivotX=this.anchorX*this.width;if(!isNaN(this._anchorY))this.pivotY=this.anchorY*this.height;this.event(c.Event.RESIZE);if(this._widget!==a.EMPTY)this._widget.resetLayout()}get tag(){return this._tag}set tag(t){this._tag=t}get toolTip(){return this._toolTip}set toolTip(t){if(this._toolTip!=t){this._toolTip=t;if(t!=null){this.on(c.Event.MOUSE_OVER,this,this.onMouseOver);this.on(c.Event.MOUSE_OUT,this,this.onMouseOut)}else{this.off(c.Event.MOUSE_OVER,this,this.onMouseOver);this.off(c.Event.MOUSE_OUT,this,this.onMouseOut)}}}onMouseOver(t){c.ILaya.stage.event(i.SHOW_TIP,this._toolTip)}onMouseOut(t){c.ILaya.stage.event(i.HIDE_TIP,this._toolTip)}get gray(){return this._gray}set gray(t){if(t!==this._gray){this._gray=t;_.gray(this,t)}}get disabled(){return this._disabled}set disabled(t){if(t!==this._disabled){this.gray=this._disabled=t;this.mouseEnabled=!t}}_getWidget(){this._widget===a.EMPTY&&(this._widget=this.addComponent(a));return this._widget}set scaleX(t){this.set_scaleX(t)}set_scaleX(t){if(super.get_scaleX()==t)return;super.set_scaleX(t);this.event(c.Event.RESIZE)}get scaleX(){return super.scaleX}set scaleY(t){this.set_scaleY(t)}set_scaleY(t){if(super.get_scaleY()==t)return;super.set_scaleY(t);this.event(c.Event.RESIZE)}get scaleY(){return super.scaleY}onCompResize(){this._sizeChanged()}set width(t){this.set_width(t)}set_width(t){if(super.get_width()==t)return;super.set_width(t);this.callLater(this._sizeChanged)}set height(t){this.set_height(t)}set_height(t){if(super.get_height()==t)return;super.set_height(t);this.callLater(this._sizeChanged)}get anchorX(){return this.get_anchorX()}get_anchorX(){return this._anchorX}set anchorX(t){this.set_anchorX(t)}set_anchorX(t){if(this._anchorX!=t){this._anchorX=t;this.callLater(this._sizeChanged)}}get anchorY(){return this.get_anchorY()}get_anchorY(){return this._anchorY}set anchorY(t){this.set_anchorY(t)}set_anchorY(t){if(this._anchorY!=t){this._anchorY=t;this.callLater(this._sizeChanged)}}_childChanged(t=null){this.callLater(this._sizeChanged);super._childChanged(t)}}c.ILaya.regClass(r);c.ClassUtils.regClass("laya.ui.UIComponent",r);c.ClassUtils.regClass("Laya.UIComponent",r);class o extends r{constructor(t=null){super();this.skin=t}destroy(t=true){super.destroy(t);this._bitmap&&this._bitmap.destroy();this._bitmap=null}dispose(){this.destroy(true);c.ILaya.loader.clearRes(this._skin)}createChildren(){this.graphics=this._bitmap=new e;this._bitmap.autoCacheCmd=false}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(t){var e=c.Loader.getRes(t);if(e){this.source=e;this.onCompResize()}else c.ILaya.loader.load(this._skin,c.Handler.create(this,this.setSource,[this._skin]),null,c.Loader.IMAGE,1,true,this._group)}else{this.source=null}}}get source(){return this._bitmap.source}set source(t){if(!this._bitmap)return;this._bitmap.source=t;this.event(c.Event.LOADED);this.repaint()}get group(){return this._group}set group(t){if(t&&this._skin)c.Loader.setGroup(this._skin,t);this._group=t}setSource(t,e=null){if(t===this._skin&&e){this.source=e;this.onCompResize()}}measureWidth(){return this._bitmap.width}measureHeight(){return this._bitmap.height}set width(t){super.width=t;this._bitmap.width=t==0?1e-7:t}get width(){return super.width}set height(t){super.height=t;this._bitmap.height=t==0?1e-7:t}get height(){return super.height}get sizeGrid(){if(this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(",");return null}set sizeGrid(t){this._bitmap.sizeGrid=_.fillArray(n.defaultSizeGrid,t,Number)}set dataSource(t){this._dataSource=t;if(typeof t=="string")this.skin=t;else super.dataSource=t}get dataSource(){return super.dataSource}}c.ILaya.regClass(o);c.ClassUtils.regClass("laya.ui.Image",o);c.ClassUtils.regClass("Laya.Image",o);class B extends o{constructor(t=null){super();this.advsListArr=[];this.resUrl="https://unioncdn.layabox.com/config/iconlist.json";this._http=new c.Browser.window.XMLHttpRequest;this._data=[];this._resquestTime=36e4;this._playIndex=0;this._lunboTime=5e3;this.skin=t;this.setLoadUrl();this.init();this.size(120,120)}setLoadUrl(){}init(){if(this.isSupportJump()){if(c.Browser.onMiniGame||c.Browser.onBDMiniGame){c.ILaya.timer.loop(this._resquestTime,this,this.onGetAdvsListData)}this.onGetAdvsListData();this.initEvent()}else this.visible=false}initEvent(){this.on(c.Event.CLICK,this,this.onAdvsImgClick)}onAdvsImgClick(){var t=this.getCurrentAppidObj();if(t)this.jumptoGame()}revertAdvsData(){if(this.advsListArr[this._playIndex]){this.visible=true;this.skin=this.advsListArr[this._playIndex]}}isSupportJump(){if(c.Browser.onMiniGame){var t=window.wx.navigateToMiniProgram instanceof Function;return t}else if(c.Browser.onBDMiniGame)return true;return false}jumptoGame(){var t=this.advsListArr[this._playIndex];var e=parseInt(t.gameid);var a=t.extendInfo;var i=t.path;if(c.Browser.onMiniGame){if(this.isSupportJump()){window.wx.navigateToMiniProgram({appId:this._appid,path:"",extraData:"",envVersion:"release",success:function t(){console.log("-------------跳转成功--------------")},fail:function t(){console.log("-------------跳转失败--------------")},complete:function t(){console.log("-------------跳转接口调用成功--------------");this.updateAdvsInfo()}.bind(this)})}}else if(c.Browser.onBDMiniGame);else{this.visible=false}}updateAdvsInfo(){this.visible=false;this.onLunbo();c.ILaya.timer.loop(this._lunboTime,this,this.onLunbo)}onLunbo(){if(this._playIndex>=this.advsListArr.length-1)this._playIndex=0;else this._playIndex+=1;this.visible=true;this.revertAdvsData()}getCurrentAppidObj(){return this.advsListArr[this._playIndex]}onGetAdvsListData(){var e=this;var t=B.randRange(1e4,1e6);var a=this.resUrl+"?"+t;this._http.open("get",a,true);this._http.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this._http.responseType="text";this._http.onerror=function(t){e._onError(t)};this._http.onload=function(t){e._onLoad(t)};this._http.send(null)}static randRange(t,e){return Math.floor(Math.random()*(e-t+1))+t}_onError(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)}_onLoad(t){var e=this._http;var a=e.status!==undefined?e.status:200;if(a===200||a===204||a===0){this.complete()}else{this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)}}error(t){this.event(c.Event.ERROR,t)}complete(){try{this._data=this._http.response||this._http.responseText;this._data=JSON.parse(this._data);this.advsListArr=this._data.list;this._appid=this._data.appid;this.updateAdvsInfo();this.revertAdvsData()}catch(t){this.error(t.message)}}getAdvsQArr(t){var e=[];var a=c.LocalStorage.getJSON("gameObj");for(var i in t){var r=t[i];if(a&&a[r.gameid]&&!r.isQiangZhi)continue;e.push(r)}return e}clear(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null}destroy(t=true){c.ILaya.timer.clear(this,this.onLunbo);super.destroy(true);this.clear();c.ILaya.timer.clear(this,this.onGetAdvsListData)}}c.ClassUtils.regClass("laya.ui.AdvImage",B);c.ClassUtils.regClass("Laya.AdvImage",B);class d extends r{set dataSource(t){this._dataSource=t;for(var e in t){var a=this.getChildByName(e);if(a)a.dataSource=t[e];else if(e in this&&!(this[e]instanceof Function))this[e]=t[e]}}get dataSource(){return super.dataSource}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t;if(t){this._onResize(null);this.on(c.Event.RESIZE,this,this._onResize)}else{this.graphics.clear();this.off(c.Event.RESIZE,this,this._onResize)}}_onResize(t){this.graphics.clear();this.graphics.drawRect(0,0,this.width,this.height,this._bgColor)}}c.ILaya.regClass(d);c.ClassUtils.regClass("laya.ui.Box",d);c.ClassUtils.regClass("Laya.Box",d);class l extends r{constructor(t=null,e=""){super();this._labelColors=n.buttonLabelColors;this._state=0;this._autoSize=true;this._stateNum=n.buttonStateNum;this._stateChanged=false;this.skin=t;this.label=e}destroy(t=true){super.destroy(t);this._bitmap&&this._bitmap.destroy();this._text&&this._text.destroy(t);this._bitmap=null;this._text=null;this._clickHandler=null;this._labelColors=this._sources=this._strokeColors=null}createChildren(){this.graphics=this._bitmap=new e}createText(){if(!this._text){this._text=new c.Text;this._text.overflow=c.Text.HIDDEN;this._text.align="center";this._text.valign="middle";this._text.width=this._width;this._text.height=this._height}}initialize(){if(this._mouseState!==1){this.mouseEnabled=true;this._setBit(c.Const.HAS_MOUSE,true)}this._createListener(c.Event.MOUSE_OVER,this,this.onMouse,null,false,false);this._createListener(c.Event.MOUSE_OUT,this,this.onMouse,null,false,false);this._createListener(c.Event.MOUSE_DOWN,this,this.onMouse,null,false,false);this._createListener(c.Event.MOUSE_UP,this,this.onMouse,null,false,false);this._createListener(c.Event.CLICK,this,this.onMouse,null,false,false)}onMouse(t){if(this.toggle===false&&this._selected)return;if(t.type===c.Event.CLICK){this.toggle&&(this.selected=!this._selected);this._clickHandler&&this._clickHandler.run();return}!this._selected&&(this.state=l.stateMap[t.type])}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(t){if(!c.Loader.getRes(t)){c.ILaya.loader.load(this._skin,c.Handler.create(this,this._skinLoaded),null,c.Loader.IMAGE,1)}else{this._skinLoaded()}}else{this._skinLoaded()}}}_skinLoaded(){this.callLater(this.changeClips);this._setStateChanged();this._sizeChanged();this.event(c.Event.LOADED)}get stateNum(){return this._stateNum}set stateNum(t){if(typeof t=="string"){t=parseInt(t)}if(this._stateNum!=t){this._stateNum=t<1?1:t>3?3:t;this.callLater(this.changeClips)}}changeClips(){var t=c.Loader.getRes(this._skin);if(!t){console.log("lose skin",this._skin);return}var e=t.sourceWidth;var a=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=c.Utils.getGID());var i=t.$_GID+"-"+this._stateNum;var r=c.WeakObject.I.get(i);if(!c.Utils.isOkTextureList(r)){r=null}if(r)this._sources=r;else{this._sources=[];if(this._stateNum===1){this._sources.push(t)}else{for(var s=0;s<this._stateNum;s++){this._sources.push(c.Texture.createFromTexture(t,0,a*s,e,a))}}c.WeakObject.I.set(i,this._sources)}if(this._autoSize){this._bitmap.width=this._width||e;this._bitmap.height=this._height||a;if(this._text){this._text.width=this._bitmap.width;this._text.height=this._bitmap.height}}else{this._text&&(this._text.x=e)}}measureWidth(){this.runCallLater(this.changeClips);if(this._autoSize)return this._bitmap.width;this.runCallLater(this.changeState);return this._bitmap.width+(this._text?this._text.width:0)}measureHeight(){this.runCallLater(this.changeClips);return this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}get label(){return this._text?this._text.text:null}set label(t){if(!this._text&&!t)return;this.createText();if(this._text.text!=t){t&&!this._text.parent&&this.addChild(this._text);this._text.text=(t+"").replace(/\\n/g,"\n");this._setStateChanged()}}get selected(){return this._selected}set selected(t){if(this._selected!=t){this._selected=t;this.state=this._selected?2:0;this.event(c.Event.CHANGE)}}get state(){return this._state}set state(t){if(this._state!=t){this._state=t;this._setStateChanged()}}changeState(){this._stateChanged=false;this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]);if(this.label){this._text.color=this._labelColors[t];if(this._strokeColors)this._text.strokeColor=this._strokeColors[t]}}get labelColors(){return this._labelColors.join(",")}set labelColors(t){this._labelColors=_.fillArray(n.buttonLabelColors,t,String);this._setStateChanged()}get strokeColors(){return this._strokeColors?this._strokeColors.join(","):""}set strokeColors(t){this._strokeColors=_.fillArray(n.buttonLabelColors,t,String);this._setStateChanged()}get labelPadding(){this.createText();return this._text.padding.join(",")}set labelPadding(t){this.createText();this._text.padding=_.fillArray(n.labelPadding,t,Number)}get labelSize(){this.createText();return this._text.fontSize}set labelSize(t){this.createText();this._text.fontSize=t}get labelStroke(){this.createText();return this._text.stroke}set labelStroke(t){this.createText();this._text.stroke=t}get labelStrokeColor(){this.createText();return this._text.strokeColor}set labelStrokeColor(t){this.createText();this._text.strokeColor=t}get labelBold(){this.createText();return this._text.bold}set labelBold(t){this.createText();this._text.bold=t}get labelFont(){this.createText();return this._text.font}set labelFont(t){this.createText();this._text.font=t}get labelAlign(){this.createText();return this._text.align}set labelAlign(t){this.createText();this._text.align=t}get clickHandler(){return this._clickHandler}set clickHandler(t){this._clickHandler=t}get text(){this.createText();return this._text}get sizeGrid(){if(this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(",");return null}set sizeGrid(t){this._bitmap.sizeGrid=_.fillArray(n.defaultSizeGrid,t,Number)}set width(t){super.set_width(t);if(this._autoSize){this._bitmap.width=t;this._text&&(this._text.width=t)}}get width(){return super.get_width()}set height(t){super.set_height(t);if(this._autoSize){this._bitmap.height=t;this._text&&(this._text.height=t)}}get height(){return super.get_height()}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.label=t+"";else super.set_dataSource(t)}get dataSource(){return super.get_dataSource()}get iconOffset(){return this._bitmap._offset?this._bitmap._offset.join(","):null}set iconOffset(t){if(t)this._bitmap._offset=_.fillArray([1,1],t,Number);else this._bitmap._offset=[]}_setStateChanged(){if(!this._stateChanged){this._stateChanged=true;this.callLater(this.changeState)}}}l.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0};c.ILaya.regClass(l);c.ClassUtils.regClass("laya.ui.Button",l);c.ClassUtils.regClass("Laya.Button",l);class h extends l{constructor(t=null,e=""){super(t,e);this.toggle=true;this._autoSize=false}preinitialize(){super.preinitialize();this.toggle=true;this._autoSize=false}initialize(){super.initialize();this.createText();this._text.align="left";this._text.valign="top";this._text.width=0}set dataSource(t){this._dataSource=t;if(t instanceof Boolean)this.selected=t;else if(typeof t=="string")this.selected=t==="true";else super.dataSource=t}get dataSource(){return super.dataSource}}c.ILaya.regClass(h);c.ClassUtils.regClass("laya.ui.CheckBox",h);c.ClassUtils.regClass("Laya.CheckBox",h);class x extends r{constructor(t=null,e=1,a=1){super();this._clipX=1;this._clipY=1;this._clipWidth=0;this._clipHeight=0;this._interval=50;this._index=0;this._toIndex=-1;this._clipX=e;this._clipY=a;this.skin=t}destroy(t=true){super.destroy(true);this._bitmap&&this._bitmap.destroy();this._bitmap=null;this._sources=null}dispose(){this.destroy(true);c.ILaya.loader.clearRes(this._skin)}createChildren(){this.graphics=this._bitmap=new e}_onDisplay(t){if(this._isPlaying){if(this._getBit(c.Const.DISPLAYED_INSTAGE))this.play();else this.stop()}else if(this._autoPlay){this.play()}}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(t){if(!c.Loader.getRes(t)){c.ILaya.loader.load(this._skin,c.Handler.create(this,this._skinLoaded),null,c.Loader.IMAGE,1)}else{this._skinLoaded()}}else{this._bitmap.source=null}}}_skinLoaded(){this._setClipChanged();this._sizeChanged();this.event(c.Event.LOADED)}get clipX(){return this._clipX}set clipX(t){this._clipX=t||1;this._setClipChanged()}get clipY(){return this._clipY}set clipY(t){this._clipY=t||1;this._setClipChanged()}get clipWidth(){return this._clipWidth}set clipWidth(t){this._clipWidth=t;this._setClipChanged()}get clipHeight(){return this._clipHeight}set clipHeight(t){this._clipHeight=t;this._setClipChanged()}changeClip(){this._clipChanged=false;if(!this._skin)return;var t=c.Loader.getRes(this._skin);if(t){this.loadComplete(this._skin,t)}else{c.ILaya.loader.load(this._skin,c.Handler.create(this,this.loadComplete,[this._skin]))}}loadComplete(t,e){if(t===this._skin&&e){var a=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX);var i=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY);var r=this._skin+a+i;var s=c.WeakObject.I.get(r);if(!c.Utils.isOkTextureList(s)){s=null}if(s)this._sources=s;else{this._sources=[];for(var n=0;n<this._clipY;n++){for(var o=0;o<this._clipX;o++){this._sources.push(c.Texture.createFromTexture(e,a*o,i*n,a,i))}}c.WeakObject.I.set(r,this._sources)}this.index=this._index;this.event(c.Event.LOADED);this.onCompResize()}}get sources(){return this._sources}set sources(t){this._sources=t;this.index=this._index;this.event(c.Event.LOADED)}get group(){return this._group}set group(t){if(t&&this._skin)c.Loader.setGroup(this._skin,t);this._group=t}set width(t){super.width=t;this._bitmap.width=t}get width(){return super.width}set height(t){super.height=t;this._bitmap.height=t}get height(){return super.height}measureWidth(){this.runCallLater(this.changeClip);return this._bitmap.width}measureHeight(){this.runCallLater(this.changeClip);return this._bitmap.height}get sizeGrid(){if(this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(",");return null}set sizeGrid(t){this._bitmap.sizeGrid=_.fillArray(n.defaultSizeGrid,t,Number)}get index(){return this._index}set index(t){this._index=t;this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]);this.event(c.Event.CHANGE)}get total(){this.runCallLater(this.changeClip);return this._sources?this._sources.length:0}get autoPlay(){return this._autoPlay}set autoPlay(t){if(this._autoPlay!=t){this._autoPlay=t;t?this.play():this.stop()}}get interval(){return this._interval}set interval(t){if(this._interval!=t){this._interval=t;if(this._isPlaying)this.play()}}get isPlaying(){return this._isPlaying}set isPlaying(t){this._isPlaying=t}play(t=0,e=-1){this._isPlaying=true;this.index=t;this._toIndex=e;this._index++;c.ILaya.timer.loop(this.interval,this,this._loop);this.on(c.Event.DISPLAY,this,this._onDisplay);this.on(c.Event.UNDISPLAY,this,this._onDisplay)}_loop(){if(this._visible&&this._sources){this._index++;if(this._toIndex>-1&&this._index>=this._toIndex)this.stop();else if(this._index>=this._sources.length)this._index=0;this.index=this._index}}stop(){this._isPlaying=false;c.ILaya.timer.clear(this,this._loop);this.event(c.Event.COMPLETE)}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.index=parseInt(t);else super.dataSource=t}get dataSource(){return super.dataSource}get bitmap(){return this._bitmap}_setClipChanged(){if(!this._clipChanged){this._clipChanged=true;this.callLater(this.changeClip)}}}c.ILaya.regClass(x);c.ClassUtils.regClass("laya.ui.Clip",x);c.ClassUtils.regClass("Laya.Clip",x);class u extends r{constructor(t=true){super(false);this._gridSize=11;this._bgColor="#ffffff";this._borderColor="#000000";this._inputColor="#000000";this._inputBgColor="#efefef";this._colors=[];this._selectedColor="#000000";if(t){this.preinitialize();this.createChildren();this.initialize()}}destroy(t=true){c.ILaya.stage.off(c.Event.MOUSE_DOWN,this,this.removeColorBox);super.destroy(t);this._colorPanel&&this._colorPanel.destroy(t);this._colorButton&&this._colorButton.destroy(t);this._colorPanel=null;this._colorTiles=null;this._colorBlock=null;this._colorInput=null;this._colorButton=null;this._colors=null;this.changeHandler=null}createChildren(){this.addChild(this._colorButton=new l);this._colorPanel=new d;this._colorPanel.size(230,166);this._colorPanel.addChild(this._colorTiles=new c.Sprite);this._colorPanel.addChild(this._colorBlock=new c.Sprite);this._colorPanel.addChild(this._colorInput=new c.Input)}initialize(){this._colorButton.on(c.Event.CLICK,this,this.onColorButtonClick);this._colorBlock.pos(5,5);this._colorInput.pos(60,5);this._colorInput.size(60,20);this._colorInput.on(c.Event.CHANGE,this,this.onColorInputChange);this._colorInput.on(c.Event.KEY_DOWN,this,this.onColorFieldKeyDown);this._colorTiles.pos(5,30);this._colorTiles.on(c.Event.MOUSE_MOVE,this,this.onColorTilesMouseMove);this._colorTiles.on(c.Event.CLICK,this,this.onColorTilesClick);this._colorTiles.size(20*this._gridSize,12*this._gridSize);this._colorPanel.on(c.Event.MOUSE_DOWN,this,this.onPanelMouseDown);this.bgColor=this._bgColor}onPanelMouseDown(t){t.stopPropagation()}changePanel(){this._panelChanged=false;var t=this._colorPanel.graphics;t.clear(true);t.drawRect(0,0,230,166,this._bgColor,this._borderColor);this.drawBlock(this._selectedColor);this._colorInput.borderColor=this._borderColor;this._colorInput.bgColor=this._inputBgColor;this._colorInput.color=this._inputColor;t=this._colorTiles.graphics;t.clear(true);var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935];for(var a=0;a<12;a++){for(var i=0;i<20;i++){var r;if(i===0)r=e[a];else if(i===1)r=0;else r=(((a*3+i/6)%3<<0)+(a/6<<0)*3)*51<<16|i%6*51<<8|(a<<0)%6*51;var s=_.toColor(r);this._colors.push(s);var n=i*this._gridSize;var o=a*this._gridSize;t.drawRect(n,o,this._gridSize,this._gridSize,s,"#000000")}}}onColorButtonClick(t){if(this._colorPanel.parent)this.close();else this.open()}open(){let t=c.ILaya.stage;var e=this.localToGlobal(new c.Point);var a=e.x+this._colorPanel.width<=t.width?e.x:t.width-this._colorPanel.width;var i=e.y+this._colorButton.height;i=i+this._colorPanel.height<=t.height?i:e.y-this._colorPanel.height;this._colorPanel.pos(a,i);this._colorPanel.zOrder=1001;t.addChild(this._colorPanel);t.on(c.Event.MOUSE_DOWN,this,this.removeColorBox)}close(){c.ILaya.stage.off(c.Event.MOUSE_DOWN,this,this.removeColorBox);this._colorPanel.removeSelf()}removeColorBox(t=null){this.close()}onColorFieldKeyDown(t){if(t.keyCode==13){if(this._colorInput.text)this.selectedColor=this._colorInput.text;else this.selectedColor=null;this.close();t.stopPropagation()}}onColorInputChange(t=null){if(this._colorInput.text)this.drawBlock(this._colorInput.text);else this.drawBlock("#FFFFFF")}onColorTilesClick(t){this.selectedColor=this.getColorByMouse();this.close()}onColorTilesMouseMove(t){this._colorInput.focus=false;var e=this.getColorByMouse();this._colorInput.text=e;this.drawBlock(e)}getColorByMouse(){var t=this._colorTiles.getMousePoint();var e=Math.floor(t.x/this._gridSize);var a=Math.floor(t.y/this._gridSize);return this._colors[a*20+e]}drawBlock(t){var e=this._colorBlock.graphics;e.clear(true);var a=t?t:"#ffffff";e.drawRect(0,0,50,20,a,this._borderColor);t||e.drawLine(0,0,50,20,"#ff0000")}get selectedColor(){return this._selectedColor}set selectedColor(t){if(this._selectedColor!=t){this._selectedColor=this._colorInput.text=t;this.drawBlock(t);this.changeColor();this.changeHandler&&this.changeHandler.runWith(this._selectedColor);this.event(c.Event.CHANGE,c.Event.EMPTY.setTo(c.Event.CHANGE,this,this))}}get skin(){return this._colorButton.skin}set skin(t){this._colorButton.once(c.Event.LOADED,this,this.changeColor);this._colorButton.skin=t}changeColor(){var t=this.graphics;t.clear(true);var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t;this._setPanelChanged()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t;this._setPanelChanged()}get inputColor(){return this._inputColor}set inputColor(t){this._inputColor=t;this._setPanelChanged()}get inputBgColor(){return this._inputBgColor}set inputBgColor(t){this._inputBgColor=t;this._setPanelChanged()}_setPanelChanged(){if(!this._panelChanged){this._panelChanged=true;this.callLater(this.changePanel)}}}c.ILaya.regClass(u);c.ClassUtils.regClass("laya.ui.ColorPicker",u);c.ClassUtils.regClass("Laya.ColorPicker",u);class f extends r{constructor(t=""){super();this.text=t}destroy(t=true){super.destroy(t);this._tf=null}createChildren(){this.addChild(this._tf=new c.Text)}get text(){return this._tf.text}set text(t){if(this._tf.text!=t){if(t)t=_.adptString(t+"");this._tf.text=t;this.event(c.Event.CHANGE);if(!this._width||!this._height)this.onCompResize()}}changeText(t){this._tf.changeText(t)}get wordWrap(){return this._tf.wordWrap}set wordWrap(t){this._tf.wordWrap=t}get color(){return this._tf.color}set color(t){this._tf.color=t}get font(){return this._tf.font}set font(t){this._tf.font=t}get align(){return this._tf.align}set align(t){this._tf.align=t}get valign(){return this._tf.valign}set valign(t){this._tf.valign=t}get bold(){return this._tf.bold}set bold(t){this._tf.bold=t}get italic(){return this._tf.italic}set italic(t){this._tf.italic=t}get leading(){return this._tf.leading}set leading(t){this._tf.leading=t}get fontSize(){return this._tf.fontSize}set fontSize(t){this._tf.fontSize=t}get padding(){return this._tf.padding.join(",")}set padding(t){this._tf.padding=_.fillArray(n.labelPadding,t,Number)}get bgColor(){return this._tf.bgColor}set bgColor(t){this._tf.bgColor=t}get borderColor(){return this._tf.borderColor}set borderColor(t){this._tf.borderColor=t}get stroke(){return this._tf.stroke}set stroke(t){this._tf.stroke=t}get strokeColor(){return this._tf.strokeColor}set strokeColor(t){this._tf.strokeColor=t}get textField(){return this._tf}measureWidth(){return this._tf.width}measureHeight(){return this._tf.height}get width(){if(this._width||this._tf.text)return super.width;return 0}set width(t){super.width=t;this._tf.width=t}get height(){if(this._height||this._tf.text)return super.height;return 0}set height(t){super.height=t;this._tf.height=t}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.text=t+"";else super.dataSource=t}get dataSource(){return super.dataSource}get overflow(){return this._tf.overflow}set overflow(t){this._tf.overflow=t}get underline(){return this._tf.underline}set underline(t){this._tf.underline=t}get underlineColor(){return this._tf.underlineColor}set underlineColor(t){this._tf.underlineColor=t}}c.ILaya.regClass(f);c.ClassUtils.regClass("laya.ui.Label",f);c.ClassUtils.regClass("Laya.Label",f);class p extends r{constructor(t=null){super();this.isVertical=true;this.showLabel=true;this._max=100;this._min=0;this._tick=1;this._value=0;if(!p.label){p.label=new f}this.skin=t}destroy(t=true){super.destroy(t);this._bg&&this._bg.destroy(t);this._bar&&this._bar.destroy(t);this._progress&&this._progress.destroy(t);this._bg=null;this._bar=null;this._progress=null;this.changeHandler=null}createChildren(){this.addChild(this._bg=new o);this.addChild(this._bar=new l)}initialize(){this._bar.on(c.Event.MOUSE_DOWN,this,this.onBarMouseDown);this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0";if(this._progress)this._progress.sizeGrid=this._bar.sizeGrid;this.allowClickBack=true}onBarMouseDown(t){var e=c.ILaya;this._globalSacle||(this._globalSacle=new c.Point);this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01);this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width;this._tx=e.stage.mouseX;this._ty=e.stage.mouseY;e.stage.on(c.Event.MOUSE_MOVE,this,this.mouseMove);e.stage.once(c.Event.MOUSE_UP,this,this.mouseUp);e.stage.once(c.Event.MOUSE_OUT,this,this.mouseUp);this.showValueText()}showValueText(){if(this.showLabel){var t=p.label;this.addChild(t);t.textField.changeText(this._value+"");if(this.isVertical){t.x=this._bar._x+20;t.y=(this._bar.height-t.height)*.5+this._bar._y}else{t.y=this._bar._y-20;t.x=(this._bar.width-t.width)*.5+this._bar._x}}}hideValueText(){p.label&&p.label.removeSelf()}mouseUp(t){let e=c.ILaya.stage;e.off(c.Event.MOUSE_MOVE,this,this.mouseMove);e.off(c.Event.MOUSE_UP,this,this.mouseUp);e.off(c.Event.MOUSE_OUT,this,this.mouseUp);this.sendChangeEvent(c.Event.CHANGED);this.hideValueText()}mouseMove(t){let e=c.ILaya.stage;var a=this._value;if(this.isVertical){this._bar.y+=(e.mouseY-this._ty)/this._globalSacle.y;if(this._bar._y>this._maxMove)this._bar.y=this._maxMove;else if(this._bar._y<0)this._bar.y=0;this._value=this._bar._y/this._maxMove*(this._max-this._min)+this._min;if(this._progress)this._progress.height=this._bar._y+.5*this._bar.height}else{this._bar.x+=(e.mouseX-this._tx)/this._globalSacle.x;if(this._bar._x>this._maxMove)this._bar.x=this._maxMove;else if(this._bar._x<0)this._bar.x=0;this._value=this._bar._x/this._maxMove*(this._max-this._min)+this._min;if(this._progress)this._progress.width=this._bar._x+.5*this._bar.width}this._tx=e.mouseX;this._ty=e.mouseY;if(this._tick!=0){var i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i}if(this._value!=a){this.sendChangeEvent()}this.showValueText()}sendChangeEvent(t=c.Event.CHANGE){this.event(t);this.changeHandler&&this.changeHandler.runWith(this._value)}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(this._skin&&!c.Loader.getRes(this._skin)){c.ILaya.loader.load([this._skin,this._skin.replace(".png","$bar.png")],c.Handler.create(this,this._skinLoaded))}else{this._skinLoaded()}}}_skinLoaded(){this._bg.skin=this._skin;this._bar.skin=this._skin.replace(".png","$bar.png");var t=this._skin.replace(".png","$progress.png");if(c.Loader.getRes(t)){if(!this._progress){this.addChild(this._progress=new o);this._progress.sizeGrid=this._bar.sizeGrid;this.setChildIndex(this._progress,1)}this._progress.skin=t}this.setBarPoint();this.callLater(this.changeValue);this._sizeChanged();this.event(c.Event.LOADED)}setBarPoint(){if(this.isVertical)this._bar.x=Math.round((this._bg.width-this._bar.width)*.5);else this._bar.y=Math.round((this._bg.height-this._bar.height)*.5)}measureWidth(){return Math.max(this._bg.width,this._bar.width)}measureHeight(){return Math.max(this._bg.height,this._bar.height)}_sizeChanged(){super._sizeChanged();if(this.isVertical)this._bg.height=this.height;else this._bg.width=this.width;this.setBarPoint();this.changeValue()}get sizeGrid(){return this._bg.sizeGrid}set sizeGrid(t){this._bg.sizeGrid=t;this._bar.sizeGrid=t;if(this._progress)this._progress.sizeGrid=this._bar.sizeGrid}setSlider(t,e,a){this._value=-1;this._min=t;this._max=e>t?e:t;this.value=a<t?t:a>e?e:a}get tick(){return this._tick}set tick(t){if(this._tick!=t){this._tick=t;this.callLater(this.changeValue)}}changeValue(){if(this.tick!=0){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t}this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;if(e===0)e=1;if(this.isVertical){this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height);if(this._progress)this._progress.height=this._bar._y+.5*this._bar.height}else{this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width);if(this._progress)this._progress.width=this._bar._x+.5*this._bar.width}}get max(){return this._max}set max(t){if(this._max!=t){this._max=t;this.callLater(this.changeValue)}}get min(){return this._min}set min(t){if(this._min!=t){this._min=t;this.callLater(this.changeValue)}}get value(){return this._value}set value(t){if(this._value!=t){var e=this._value;this._value=t;this.changeValue();if(this._value!=e){this.sendChangeEvent()}}}get allowClickBack(){return this._allowClickBack}set allowClickBack(t){if(this._allowClickBack!=t){this._allowClickBack=t;if(t)this._bg.on(c.Event.MOUSE_DOWN,this,this.onBgMouseDown);else this._bg.off(c.Event.MOUSE_DOWN,this,this.onBgMouseDown)}}onBgMouseDown(t){var e=this._bg.getMousePoint();if(this.isVertical)this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min;else this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.value=Number(t);else super.dataSource=t}get dataSource(){return super.dataSource}get bar(){return this._bar}}p.label=null;c.ILaya.regClass(p);c.ClassUtils.regClass("laya.ui.Slider",p);c.ClassUtils.regClass("Laya.Slider",p);class m extends r{constructor(t=null){super();this.rollRatio=.97;this.scaleBar=true;this.autoHide=false;this.elasticDistance=0;this.elasticBackTime=500;this._showButtons=s.showButtons;this._scrollSize=1;this._thumbPercent=1;this._lastOffset=0;this._checkElastic=false;this._isElastic=false;this._hide=false;this._clickOnly=true;this._touchScrollEnable=s.touchScrollEnable;this._mouseWheelEnable=s.mouseWheelEnable;this.skin=t;this.max=1}destroy(t=true){this.stopScroll();this.target=null;super.destroy(t);this.upButton&&this.upButton.destroy(t);this.downButton&&this.downButton.destroy(t);this.slider&&this.slider.destroy(t);this.upButton=this.downButton=null;this.slider=null;this.changeHandler=null;this._offsets=null}createChildren(){this.addChild(this.slider=new p);this.addChild(this.upButton=new l);this.addChild(this.downButton=new l)}initialize(){this.slider.showLabel=false;this.slider.tick=0;this.slider.on(c.Event.CHANGE,this,this.onSliderChange);this.slider.setSlider(0,0,0);this.upButton.on(c.Event.MOUSE_DOWN,this,this.onButtonMouseDown);this.downButton.on(c.Event.MOUSE_DOWN,this,this.onButtonMouseDown)}onSliderChange(){if(this._value!=this.slider.value)this.value=this.slider.value}onButtonMouseDown(t){var e=t.currentTarget===this.upButton;this.slide(e);c.ILaya.timer.once(n.scrollBarDelayTime,this,this.startLoop,[e]);c.ILaya.stage.once(c.Event.MOUSE_UP,this,this.onStageMouseUp)}startLoop(t){c.ILaya.timer.frameLoop(1,this,this.slide,[t])}slide(t){if(t)this.value-=this._scrollSize;else this.value+=this._scrollSize}onStageMouseUp(t){c.ILaya.timer.clear(this,this.startLoop);c.ILaya.timer.clear(this,this.slide)}get skin(){return this._skin}set skin(t){if(t==" ")return;if(this._skin!=t){this._skin=t;if(this._skin&&!c.Loader.getRes(this._skin)){c.ILaya.loader.load([this._skin,this._skin.replace(".png","$up.png"),this._skin.replace(".png","$down.png"),this._skin.replace(".png","$bar.png")],c.Handler.create(this,this._skinLoaded))}else{this._skinLoaded()}}}_skinLoaded(){this.slider.skin=this._skin;this.callLater(this.changeScrollBar);this._sizeChanged();this.event(c.Event.LOADED)}changeScrollBar(){this.upButton.visible=this._showButtons;this.downButton.visible=this._showButtons;if(this._showButtons){this.upButton.skin=this._skin.replace(".png","$up.png");this.downButton.skin=this._skin.replace(".png","$down.png")}if(this.slider.isVertical)this.slider.y=this._showButtons?this.upButton.height:0;else this.slider.x=this._showButtons?this.upButton.width:0;this.resetPositions();this.repaint()}_sizeChanged(){super._sizeChanged();this.repaint();this.resetPositions();this.event(c.Event.CHANGE);this.changeHandler&&this.changeHandler.runWith(this.value)}resetPositions(){if(this.slider.isVertical)this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0);else this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0);this.resetButtonPosition()}resetButtonPosition(){if(this.slider.isVertical)this.downButton.y=this.slider._y+this.slider.height;else this.downButton.x=this.slider._x+this.slider.width}measureWidth(){if(this.slider.isVertical)return this.slider.width;return 100}measureHeight(){if(this.slider.isVertical)return 100;return this.slider.height}setScroll(t,e,a){this.runCallLater(this._sizeChanged);this.slider.setSlider(t,e,a);this.slider.bar.visible=e>0;if(!this._hide&&this.autoHide)this.visible=false}get max(){return this.slider.max}set max(t){this.slider.max=t}get min(){return this.slider.min}set min(t){this.slider.min=t}get value(){return this._value}set value(t){if(t!==this._value){this._value=t;if(!this._isElastic){if(this.slider["_value"]!=t){this.slider["_value"]=t;this.slider.changeValue()}this._value=this.slider["_value"]}this.event(c.Event.CHANGE);this.changeHandler&&this.changeHandler.runWith(this._value)}}get isVertical(){return this.slider.isVertical}set isVertical(t){this.slider.isVertical=t}get sizeGrid(){return this.slider.sizeGrid}set sizeGrid(t){this.slider.sizeGrid=t}get scrollSize(){return this._scrollSize}set scrollSize(t){this._scrollSize=t}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.value=Number(t);else super.dataSource=t}get dataSource(){return super.dataSource}get thumbPercent(){return this._thumbPercent}set thumbPercent(t){this.runCallLater(this.changeScrollBar);this.runCallLater(this._sizeChanged);t=t>=1?.99:t;this._thumbPercent=t;if(this.scaleBar){if(this.slider.isVertical)this.slider.bar.height=Math.max(this.slider.height*t,n.scrollBarMinNum);else this.slider.bar.width=Math.max(this.slider.width*t,n.scrollBarMinNum)}}get target(){return this._target}set target(t){if(this._target){this._target.off(c.Event.MOUSE_WHEEL,this,this.onTargetMouseWheel);this._target.off(c.Event.MOUSE_DOWN,this,this.onTargetMouseDown)}this._target=t;if(t){this._mouseWheelEnable&&this._target.on(c.Event.MOUSE_WHEEL,this,this.onTargetMouseWheel);this._touchScrollEnable&&this._target.on(c.Event.MOUSE_DOWN,this,this.onTargetMouseDown)}}get hide(){return this._hide}set hide(t){this._hide=t;this.visible=!t}get showButtons(){return this._showButtons}set showButtons(t){this._showButtons=t;this.callLater(this.changeScrollBar)}get touchScrollEnable(){return this._touchScrollEnable}set touchScrollEnable(t){this._touchScrollEnable=t;this.target=this._target}get mouseWheelEnable(){return this._mouseWheelEnable}set mouseWheelEnable(t){this._mouseWheelEnable=t;this.target=this._target}onTargetMouseWheel(t){this.value-=t.delta*this._scrollSize;this.target=this._target}onTargetMouseDown(t){if(this.isLockedFun&&!this.isLockedFun(t))return;this.event(c.Event.END);this._clickOnly=true;this._lastOffset=0;this._checkElastic=false;this._lastPoint||(this._lastPoint=new c.Point);this._lastPoint.setTo(c.ILaya.stage.mouseX,c.ILaya.stage.mouseY);c.ILaya.timer.clear(this,this.tweenMove);c.Tween.clearTween(this);c.ILaya.stage.once(c.Event.MOUSE_UP,this,this.onStageMouseUp2);c.ILaya.stage.once(c.Event.MOUSE_OUT,this,this.onStageMouseUp2);c.ILaya.timer.frameLoop(1,this,this.loop)}startDragForce(){this._clickOnly=true;this._lastOffset=0;this._checkElastic=false;this._lastPoint||(this._lastPoint=new c.Point);this._lastPoint.setTo(c.ILaya.stage.mouseX,c.ILaya.stage.mouseY);c.ILaya.timer.clear(this,this.tweenMove);c.Tween.clearTween(this);c.ILaya.stage.once(c.Event.MOUSE_UP,this,this.onStageMouseUp2);c.ILaya.stage.once(c.Event.MOUSE_OUT,this,this.onStageMouseUp2);c.ILaya.timer.frameLoop(1,this,this.loop)}cancelDragOp(){c.ILaya.stage.off(c.Event.MOUSE_UP,this,this.onStageMouseUp2);c.ILaya.stage.off(c.Event.MOUSE_OUT,this,this.onStageMouseUp2);c.ILaya.timer.clear(this,this.tweenMove);c.ILaya.timer.clear(this,this.loop);this._target.mouseEnabled=true}checkTriggers(t=false){if(this.value>=0&&this.value-this._lastOffset<=0){if(this.triggerDownDragLimit&&this.triggerDownDragLimit(t)){this.cancelDragOp();this.value=0;return true}}if(this.value<=this.max&&this.value-this._lastOffset>=this.max){if(this.triggerUpDragLimit&&this.triggerUpDragLimit(t)){this.cancelDragOp();this.value=this.max;return true}}return false}get lastOffset(){return this._lastOffset}startTweenMoveForce(t){this._lastOffset=t;c.ILaya.timer.frameLoop(1,this,this.tweenMove,[200])}loop(){var t=c.ILaya.stage.mouseY;var e=c.ILaya.stage.mouseX;this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x;if(this._clickOnly){if(Math.abs(this._lastOffset*(this.isVertical?c.ILaya.stage._canvasTransform.getScaleY():c.ILaya.stage._canvasTransform.getScaleX()))>1){this._clickOnly=false;if(this.checkTriggers())return;this._offsets||(this._offsets=[]);this._offsets.length=0;this._target.mouseEnabled=false;if(!this.hide&&this.autoHide){this.alpha=1;this.visible=true}this.event(c.Event.START)}else return}else{if(this.checkTriggers())return}this._offsets.push(this._lastOffset);this._lastPoint.x=e;this._lastPoint.y=t;if(this._lastOffset===0)return;if(!this._checkElastic){if(this.elasticDistance>0){if(!this._checkElastic&&this._lastOffset!=0){if(this._lastOffset>0&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max){this._isElastic=true;this._checkElastic=true}else{this._isElastic=false}}}else{this._checkElastic=true}}if(this._isElastic){if(this._value<=this.min){if(this._lastOffset>0){this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance)}else{this.value-=this._lastOffset*.5;if(this._value>=this.min)this._checkElastic=false}}else if(this._value>=this.max){if(this._lastOffset<0){this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)}else{this.value-=this._lastOffset*.5;if(this._value<=this.max)this._checkElastic=false}}}else{this.value-=this._lastOffset}}onStageMouseUp2(t){c.ILaya.stage.off(c.Event.MOUSE_UP,this,this.onStageMouseUp2);c.ILaya.stage.off(c.Event.MOUSE_OUT,this,this.onStageMouseUp2);c.ILaya.timer.clear(this,this.loop);if(this._clickOnly){if(this._value>=this.min&&this._value<=this.max)return}this._target.mouseEnabled=true;if(this._isElastic){if(this._value<this.min){c.Tween.to(this,{value:this.min},this.elasticBackTime,c.Ease.sineOut,c.Handler.create(this,this.elasticOver))}else if(this._value>this.max){c.Tween.to(this,{value:this.max},this.elasticBackTime,c.Ease.sineOut,c.Handler.create(this,this.elasticOver))}}else{if(!this._offsets)return;if(this._offsets.length<1){this._offsets[0]=this.isVertical?c.ILaya.stage.mouseY-this._lastPoint.y:c.ILaya.stage.mouseX-this._lastPoint.x}var e=0;var a=Math.min(this._offsets.length,3);for(var i=0;i<a;i++){e+=this._offsets[this._offsets.length-1-i]}this._lastOffset=e/a;e=Math.abs(this._lastOffset);if(e<2){this.event(c.Event.END);return}if(e>250)this._lastOffset=this._lastOffset>0?250:-250;var r=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/150)));c.ILaya.timer.frameLoop(1,this,this.tweenMove,[r])}}elasticOver(){this._isElastic=false;if(!this.hide&&this.autoHide){c.Tween.to(this,{alpha:0},500)}this.event(c.Event.END)}tweenMove(t){this._lastOffset*=this.rollRatio;if(this.checkTriggers(true)){return}var e;if(t>0){if(this._lastOffset>0&&this.value<=this.min){this._isElastic=true;e=-(this.min-t-this.value)*.5;if(this._lastOffset>e)this._lastOffset=e}else if(this._lastOffset<0&&this.value>=this.max){this._isElastic=true;e=-(this.max+t-this.value)*.5;if(this._lastOffset<e)this._lastOffset=e}}this.value-=this._lastOffset;if(Math.abs(this._lastOffset)<.1){c.ILaya.timer.clear(this,this.tweenMove);if(this._isElastic){if(this._value<this.min){c.Tween.to(this,{value:this.min},this.elasticBackTime,c.Ease.sineOut,c.Handler.create(this,this.elasticOver))}else if(this._value>this.max){c.Tween.to(this,{value:this.max},this.elasticBackTime,c.Ease.sineOut,c.Handler.create(this,this.elasticOver))}else{this.elasticOver()}return}this.event(c.Event.END);if(!this.hide&&this.autoHide){c.Tween.to(this,{alpha:0},500)}}}stopScroll(){this.onStageMouseUp2(null);c.ILaya.timer.clear(this,this.tweenMove);c.Tween.clearTween(this)}get tick(){return this.slider.tick}set tick(t){this.slider.tick=t}}c.ILaya.regClass(m);c.ClassUtils.regClass("laya.ui.ScrollBar",m);c.ClassUtils.regClass("Laya.ScrollBar",m);class g extends m{}c.ILaya.regClass(g);c.ClassUtils.regClass("laya.ui.VScrollBar",g);c.ClassUtils.regClass("Laya.VScrollBar",g);class v extends m{initialize(){super.initialize();this.slider.isVertical=false}}c.ILaya.regClass(v);c.ClassUtils.regClass("laya.ui.HScrollBar",v);c.ClassUtils.regClass("Laya.HScrollBar",v);class y extends d{constructor(){super(...arguments);this.selectEnable=false;this.totalPage=0;this._$componentType="List";this._repeatX=0;this._repeatY=0;this._repeatX2=0;this._repeatY2=0;this._spaceX=0;this._spaceY=0;this._cells=[];this._startIndex=0;this._selectedIndex=-1;this._page=0;this._isVertical=true;this._cellSize=20;this._cellOffset=0;this._createdLine=0;this._offset=new c.Point;this._usedCache=null;this._elasticEnabled=false;this._preLen=0}destroy(t=true){this._content&&this._content.destroy(t);this._scrollBar&&this._scrollBar.destroy(t);super.destroy(t);this._content=null;this._scrollBar=null;this._itemRender=null;this._cells=null;this._array=null;this.selectHandler=this.renderHandler=this.mouseHandler=null}createChildren(){this.addChild(this._content=new d)}set cacheAs(t){super.cacheAs=t;if(this._scrollBar){this._usedCache=null;if(t!=="none")this._scrollBar.on(c.Event.START,this,this.onScrollStart);else this._scrollBar.off(c.Event.START,this,this.onScrollStart)}}get cacheAs(){return super.cacheAs}onScrollStart(){this._usedCache||(this._usedCache=super.cacheAs);super.cacheAs="none";this._scrollBar.once(c.Event.END,this,this.onScrollEnd)}onScrollEnd(){super.cacheAs=this._usedCache}get content(){return this._content}get vScrollBarSkin(){return this._scrollBar?this._scrollBar.skin:null}set vScrollBarSkin(t){this._removePreScrollBar();var e=new g;e.name="scrollBar";e.right=0;e.skin=t;e.elasticDistance=this._elasticEnabled?200:0;this.scrollBar=e;this.addChild(e);this._setCellChanged()}_removePreScrollBar(){var t=this.removeChildByName("scrollBar");if(t)t.destroy(true)}get hScrollBarSkin(){return this._scrollBar?this._scrollBar.skin:null}set hScrollBarSkin(t){this._removePreScrollBar();var e=new v;e.name="scrollBar";e.bottom=0;e.skin=t;e.elasticDistance=this._elasticEnabled?200:0;this.scrollBar=e;this.addChild(e);this._setCellChanged()}get scrollBar(){return this._scrollBar}set scrollBar(t){if(this._scrollBar!=t){this._scrollBar=t;if(t){this._isVertical=this._scrollBar.isVertical;this.addChild(this._scrollBar);this._scrollBar.on(c.Event.CHANGE,this,this.onScrollBarChange)}}}get itemRender(){return this._itemRender}set itemRender(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;e>-1;e--){this._cells[e].destroy()}this._cells.length=0;this._setCellChanged()}}set width(t){if(t!=this._width){super.width=t;this._setCellChanged()}}get width(){return super.width}set height(t){if(t!=this._height){super.height=t;this._setCellChanged()}}get height(){return super.height}get repeatX(){return this._repeatX>0?this._repeatX:this._repeatX2>0?this._repeatX2:1}set repeatX(t){this._repeatX=t;this._setCellChanged()}get repeatY(){return this._repeatY>0?this._repeatY:this._repeatY2>0?this._repeatY2:1}set repeatY(t){this._repeatY=t;this._setCellChanged()}get spaceX(){return this._spaceX}set spaceX(t){this._spaceX=t;this._setCellChanged()}get spaceY(){return this._spaceY}set spaceY(t){this._spaceY=t;this._setCellChanged()}changeCells(){this._cellChanged=false;if(this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell();var e=t.width+this._spaceX||1;var a=t.height+this._spaceY||1;if(this._width>0)this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e);if(this._height>0)this._repeatY2=this._isVertical?Math.ceil(this._height/a):Math.round(this._height/a);var i=this._width?this._width:e*this.repeatX-this._spaceX;var r=this._height?this._height:a*this.repeatY-this._spaceY;this._cellSize=this._isVertical?a:e;this._cellOffset=this._isVertical?a*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-i-this._spaceX;if(this._isVertical&&this.vScrollBarSkin)this._scrollBar.height=r;else if(!this._isVertical&&this.hScrollBarSkin)this._scrollBar.width=i;this.setContentSize(i,r);var s=this._isVertical?this.repeatX:this.repeatY;var n=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,s,n);this._createdLine=n;if(this._array){this.array=this._array;this.runCallLater(this.renderItems)}}}_getOneCell(){if(this._cells.length===0){var t=this.createItem();this._offset.setTo(t._x,t._y);if(this.cacheContent)return t;this._cells.push(t)}return this._cells[0]}_createItems(t,e,a){var i=this._content;var r=this._getOneCell();var s=r.width+this._spaceX;var n=r.height+this._spaceY;if(this.cacheContent){var o=new d;o.cacheAs="normal";o.pos((this._isVertical?0:t)*s,(this._isVertical?t:0)*n);this._content.addChild(o);i=o}else{var l=[];for(var _=this._cells.length-1;_>-1;_--){var h=this._cells[_];h.removeSelf();l.push(h)}this._cells.length=0}for(var x=t;x<a;x++){for(var c=0;c<e;c++){if(l&&l.length){r=l.pop()}else{r=this.createItem()}r.x=(this._isVertical?c:x)*s-i._x;r.y=(this._isVertical?x:c)*n-i._y;r.name="item"+(x*e+c);i.addChild(r);this.addCell(r)}}}createItem(){var t=[];if(typeof this._itemRender=="function"){var e=new this._itemRender}else{e=c.SceneUtils.createComp(this._itemRender,null,null,t)}if(t.length==0&&e["_watchMap"]){var a=e["_watchMap"];for(var i in a){var r=a[i];for(var s=0;s<r.length;s++){var n=r[s];t.push(n.comp,n.prop,n.value)}}}if(t.length)e["_$bindData"]=t;return e}addCell(t){t.on(c.Event.CLICK,this,this.onCellMouse);t.on(c.Event.RIGHT_CLICK,this,this.onCellMouse);t.on(c.Event.MOUSE_OVER,this,this.onCellMouse);t.on(c.Event.MOUSE_OUT,this,this.onCellMouse);t.on(c.Event.MOUSE_DOWN,this,this.onCellMouse);t.on(c.Event.MOUSE_UP,this,this.onCellMouse);this._cells.push(t)}_afterInited(){this.initItems()}initItems(){if(!this._itemRender&&this.getChildByName("item0")!=null){this.repeatX=1;var t;t=0;for(var e=0;e<1e4;e++){var a=this.getChildByName("item"+e);if(a){this.addCell(a);t++;continue}break}this.repeatY=t}}setContentSize(t,e){this._content.width=t;this._content.height=e;if(this._scrollBar||this._offset.x!=0||this._offset.y!=0){this._content._style.scrollRect||(this._content.scrollRect=c.Rectangle.create());this._content._style.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e);this._content.scrollRect=this._content.scrollRect}this.event(c.Event.RESIZE)}onCellMouse(t){if(t.type===c.Event.MOUSE_DOWN)this._isMoved=false;var e=t.currentTarget;var a=this._startIndex+this._cells.indexOf(e);if(a<0)return;if(t.type===c.Event.CLICK||t.type===c.Event.RIGHT_CLICK){if(this.selectEnable&&!this._isMoved)this.selectedIndex=a;else this.changeCellState(e,true,0)}else if((t.type===c.Event.MOUSE_OVER||t.type===c.Event.MOUSE_OUT)&&this._selectedIndex!==a){this.changeCellState(e,t.type===c.Event.MOUSE_OVER,0)}this.mouseHandler&&this.mouseHandler.runWith([t,a])}changeCellState(t,e,a){var i=t.getChildByName("selectBox");if(i){this.selectEnable=true;i.visible=e;i.index=a}}_sizeChanged(){super._sizeChanged();this.setContentSize(this.width,this.height);if(this._scrollBar)this.callLater(this.onScrollBarChange)}onScrollBarChange(t=null){this.runCallLater(this.changeCells);var e=this._scrollBar.value;var a=this._isVertical?this.repeatX:this.repeatY;var i=this._isVertical?this.repeatY:this.repeatX;var r=Math.floor(e/this._cellSize);if(!this.cacheContent){var s=r*a;var n=0;if(s>this._startIndex){n=s-this._startIndex;var o=true;var l=this._startIndex+a*(i+1);this._isMoved=true}else if(s<this._startIndex){n=this._startIndex-s;o=false;l=this._startIndex-1;this._isMoved=true}for(var _=0;_<n;_++){if(o){var h=this._cells.shift();this._cells[this._cells.length]=h;var x=l+_}else{h=this._cells.pop();this._cells.unshift(h);x=l-_}var c=Math.floor(x/a)*this._cellSize;this._isVertical?h.y=c:h.x=c;this.renderItem(h,x)}this._startIndex=s;this.changeSelectStatus()}else{n=i+1;if(this._createdLine-r<n){this._createItems(this._createdLine,a,this._createdLine+n);this.renderItems(this._createdLine*a,0);this._createdLine+=n}}var d=this._content._style.scrollRect;if(this._isVertical){d.y=e-this._offset.y;d.x=-this._offset.x}else{d.y=-this._offset.y;d.x=e-this._offset.x}this._content.scrollRect=d}posCell(t,e){if(!this._scrollBar)return;var a=this._isVertical?this.repeatX:this.repeatY;var i=this._isVertical?this.repeatY:this.repeatX;var r=Math.floor(e/a)*this._cellSize;this._isVertical?t._y=r:t.x=r}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(this._selectedIndex!=t){this._selectedIndex=t;this.changeSelectStatus();this.event(c.Event.CHANGE);this.selectHandler&&this.selectHandler.runWith(t);this.startIndex=this._startIndex}}changeSelectStatus(){for(var t=0,e=this._cells.length;t<e;t++){this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)}}get selectedItem(){return this._selectedIndex!=-1?this._array[this._selectedIndex]:null}set selectedItem(t){this.selectedIndex=this._array.indexOf(t)}get selection(){return this.getCell(this._selectedIndex)}set selection(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}get startIndex(){return this._startIndex}set startIndex(t){this._startIndex=t>0?t:0;this.callLater(this.renderItems)}renderItems(t=0,e=0){for(var a=t,i=e||this._cells.length;a<i;a++){this.renderItem(this._cells[a],this._startIndex+a)}this.changeSelectStatus()}renderItem(t,e){if(this._array&&e>=0&&e<this._array.length){t.visible=true;if(t["_$bindData"]){t["_dataSource"]=this._array[e];this._bindData(t,this._array[e])}else t.dataSource=this._array[e];if(!this.cacheContent){this.posCell(t,e)}if(this.hasListener(c.Event.RENDER))this.event(c.Event.RENDER,[t,e]);if(this.renderHandler)this.renderHandler.runWith([t,e])}else{t.visible=false;t.dataSource=null}}_bindData(t,e){var a=t._$bindData;for(var i=0,r=a.length;i<r;i++){var s=a[i++];var n=a[i++];var o=a[i];var l=_.getBindFun(o);s[n]=l.call(this,e)}}get array(){return this._array}set array(t){this.runCallLater(this.changeCells);this._array=t||[];this._preLen=this._array.length;var e=this._array.length;this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY));this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1;this.startIndex=this._startIndex;if(this._scrollBar){this._scrollBar.stopScroll();var a=this._isVertical?this.repeatX:this.repeatY;var i=this._isVertical?this.repeatY:this.repeatX;var r=Math.ceil(e/a);var s=this._cellOffset>0?this.totalPage+1:this.totalPage;if(s>1&&r>=i){this._scrollBar.scrollSize=this._cellSize;this._scrollBar.thumbPercent=i/r;this._scrollBar.setScroll(0,(r-i)*this._cellSize+this._cellOffset,this._scrollBar.value);this._scrollBar.target=this._content}else{this._scrollBar.setScroll(0,0,0);this._scrollBar.target=this._content}}}updateArray(t){this._array=t;var e;if(this._array){e=this._preLen-this._startIndex;if(e>=0)this.renderItems(e);this._preLen=this._array.length}if(this._scrollBar){var a=t.length;var i=this._isVertical?this.repeatX:this.repeatY;var r=this._isVertical?this.repeatY:this.repeatX;var s=Math.ceil(a/i);if(s>=r){this._scrollBar.thumbPercent=r/s;this._scrollBar.slider["_max"]=(s-r)*this._cellSize+this._cellOffset}}}get page(){return this._page}set page(t){this._page=t;if(this._array){this._page=t>0?t:0;this._page=this._page<this.totalPage?this._page:this.totalPage-1;this.startIndex=this._page*this.repeatX*this.repeatY}}get length(){return this._array?this._array.length:0}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.selectedIndex=parseInt(t);else if(t instanceof Array)this.array=t;else super.dataSource=t}get dataSource(){return super.dataSource}get cells(){this.runCallLater(this.changeCells);return this._cells}get elasticEnabled(){return this._elasticEnabled}set elasticEnabled(t){this._elasticEnabled=t;if(this._scrollBar){this._scrollBar.elasticDistance=t?200:0}}refresh(){this.array=this._array}getItem(t){if(t>-1&&t<this._array.length){return this._array[t]}return null}changeItem(t,e){if(t>-1&&t<this._array.length){this._array[t]=e;if(t>=this._startIndex&&t<this._startIndex+this._cells.length){this.renderItem(this.getCell(t),t)}}}setItem(t,e){this.changeItem(t,e)}addItem(t){this._array.push(t);this.array=this._array}addItemAt(t,e){this._array.splice(e,0,t);this.array=this._array}deleteItem(t){this._array.splice(t,1);this.array=this._array}getCell(t){this.runCallLater(this.changeCells);if(t>-1&&this._cells){return this._cells[(t-this._startIndex)%this._cells.length]}return null}scrollTo(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else{this.startIndex=t}}tweenTo(t,e=200,a=null){if(this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY;c.Tween.to(this._scrollBar,{value:Math.floor(t/i)*this._cellSize},e,null,a,0,true)}else{this.startIndex=t;if(a)a.run()}}_setCellChanged(){if(!this._cellChanged){this._cellChanged=true;this.callLater(this.changeCells)}}commitMeasure(){this.runCallLater(this.changeCells)}}c.ILaya.regClass(y);c.ClassUtils.regClass("laya.ui.List",y);c.ClassUtils.regClass("Laya.List",y);class T extends r{constructor(t=null,e=null){super();this._visibleNum=6;this._itemColors=n.comboBoxItemColors;this._itemSize=12;this._labels=[];this._selectedIndex=-1;this.itemRender=null;this.skin=t;this.labels=e}destroy(t=true){super.destroy(t);this._button&&this._button.destroy(t);this._list&&this._list.destroy(t);this._button=null;this._list=null;this._itemColors=null;this._labels=null;this._selectHandler=null}createChildren(){this.addChild(this._button=new l);this._button.text.align="left";this._button.labelPadding="0,0,0,5";this._button.on(c.Event.MOUSE_DOWN,this,this.onButtonMouseDown)}_createList(){this._list=new y;if(this._scrollBarSkin)this._list.vScrollBarSkin=this._scrollBarSkin;this._setListEvent(this._list)}_setListEvent(t){this._list.selectEnable=true;this._list.on(c.Event.MOUSE_DOWN,this,this.onListDown);this._list.mouseHandler=c.Handler.create(this,this.onlistItemMouse,null,false);if(this._list.scrollBar)this._list.scrollBar.on(c.Event.MOUSE_DOWN,this,this.onScrollBarDown)}onListDown(t){t.stopPropagation()}onScrollBarDown(t){t.stopPropagation()}onButtonMouseDown(t){this.callLater(this.switchTo,[!this._isOpen])}get skin(){return this._button.skin}set skin(t){if(this._button.skin!=t){this._button.skin=t;this._listChanged=true}}measureWidth(){return this._button.width}measureHeight(){return this._button.height}changeList(){this._listChanged=false;var t=this.width-2;var e=this._itemColors[2];this._itemHeight=this._itemSize+6;this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]};this._list.repeatY=this._visibleNum;this._list.refresh()}onlistItemMouse(t,e){var a=t.type;if(a===c.Event.MOUSE_OVER||a===c.Event.MOUSE_OUT){if(this._isCustomList)return;var i=this._list.getCell(e);if(!i)return;var r=i.getChildByName("label");if(r){if(a===c.Event.ROLL_OVER){r.bgColor=this._itemColors[0];r.color=this._itemColors[1]}else{r.bgColor=null;r.color=this._itemColors[2]}}}else if(a===c.Event.CLICK){this.selectedIndex=e;this.isOpen=false}}switchTo(t){this.isOpen=t}changeOpen(){this.isOpen=!this._isOpen}set width(t){super.width=t;this._button.width=this._width;this._itemChanged=true;this._listChanged=true}get width(){return super.width}set height(t){super.height=t;this._button.height=this._height}get height(){return super.height}get labels(){return this._labels.join(",")}set labels(t){if(this._labels.length>0)this.selectedIndex=-1;if(t)this._labels=t.split(",");else this._labels.length=0;this._itemChanged=true}changeItem(){this._itemChanged=false;this._listHeight=this._labels.length>0?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight;if(!this._isCustomList){var t=this._list.graphics;t.clear(true);t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}var e=this._list.array||[];e.length=0;for(var a=0,i=this._labels.length;a<i;a++){e.push({label:this._labels[a]})}this._list.height=this._listHeight;this._list.array=e}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(this._selectedIndex!=t){this._selectedIndex=t;if(this._labels.length>0)this.changeSelected();else this.callLater(this.changeSelected);this.event(c.Event.CHANGE,[c.Event.EMPTY.setTo(c.Event.CHANGE,this,this)]);this._selectHandler&&this._selectHandler.runWith(this._selectedIndex)}}changeSelected(){this._button.label=this.selectedLabel}get selectHandler(){return this._selectHandler}set selectHandler(t){this._selectHandler=t}get selectedLabel(){return this._selectedIndex>-1&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null}set selectedLabel(t){this.selectedIndex=this._labels.indexOf(t)}get visibleNum(){return this._visibleNum}set visibleNum(t){this._visibleNum=t;this._listChanged=true}get itemColors(){return String(this._itemColors)}set itemColors(t){this._itemColors=_.fillArray(this._itemColors,t,String);this._listChanged=true}get itemSize(){return this._itemSize}set itemSize(t){this._itemSize=t;this._listChanged=true}get isOpen(){return this._isOpen}set isOpen(t){if(this._isOpen!=t){this._isOpen=t;this._button.selected=this._isOpen;if(this._isOpen){this._list||this._createList();this._listChanged&&!this._isCustomList&&this.changeList();this._itemChanged&&this.changeItem();var e=this.localToGlobal(c.Point.TEMP.setTo(0,0));var a=e.y+this._button.height;a=a+this._listHeight<=c.ILaya.stage.height?a:e.y-this._listHeight;this._list.pos(e.x,a);this._list.zOrder=1001;c.ILaya.stage.addChild(this._list);c.ILaya.stage.once(c.Event.MOUSE_DOWN,this,this.removeList);c.ILaya.stage.on(c.Event.MOUSE_WHEEL,this,this._onStageMouseWheel);this._list.selectedIndex=this._selectedIndex}else{this._list&&this._list.removeSelf()}}}_onStageMouseWheel(t){if(!this._list||this._list.contains(t.target))return;this.removeList(null)}removeList(t){c.ILaya.stage.off(c.Event.MOUSE_DOWN,this,this.removeList);c.ILaya.stage.off(c.Event.MOUSE_WHEEL,this,this._onStageMouseWheel);this.isOpen=false}get scrollBarSkin(){return this._scrollBarSkin}set scrollBarSkin(t){this._scrollBarSkin=t}get sizeGrid(){return this._button.sizeGrid}set sizeGrid(t){this._button.sizeGrid=t}get scrollBar(){return this.list.scrollBar}get button(){return this._button}get list(){this._list||this._createList();return this._list}set list(t){if(t){t.removeSelf();this._isCustomList=true;this._list=t;this._setListEvent(t);this._itemHeight=t.getCell(0).height+t.spaceY}}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.selectedIndex=parseInt(t);else if(t instanceof Array)this.labels=t.join(",");else super.dataSource=t}get dataSource(){return super.dataSource}get labelColors(){return this._button.labelColors}set labelColors(t){if(this._button.labelColors!=t){this._button.labelColors=t}}get labelPadding(){return this._button.text.padding.join(",")}set labelPadding(t){this._button.text.padding=_.fillArray(n.labelPadding,t,Number)}get labelSize(){return this._button.text.fontSize}set labelSize(t){this._button.text.fontSize=t}get labelBold(){return this._button.text.bold}set labelBold(t){this._button.text.bold=t}get labelFont(){return this._button.text.font}set labelFont(t){this._button.text.font=t}get stateNum(){return this._button.stateNum}set stateNum(t){this._button.stateNum=t}}c.ILaya.regClass(T);c.ClassUtils.regClass("laya.ui.ComboBox",T);c.ClassUtils.regClass("Laya.ComboBox",T);class E extends r{constructor(t=null){super();this._value=.5;this.skin=t}destroy(t=true){super.destroy(t);this._bg&&this._bg.destroy(t);this._bar&&this._bar.destroy(t);this._bg=this._bar=null;this.changeHandler=null}createChildren(){this.addChild(this._bg=new o);this.addChild(this._bar=new o);this._bar._bitmap.autoCacheCmd=false}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(this._skin&&!c.Loader.getRes(this._skin)){c.ILaya.loader.load(this._skin,c.Handler.create(this,this._skinLoaded),null,c.Loader.IMAGE,1)}else{this._skinLoaded()}}}_skinLoaded(){this._bg.skin=this._skin;this._bar.skin=this._skin.replace(".png","$bar.png");this.callLater(this.changeValue);this._sizeChanged();this.event(c.Event.LOADED)}measureWidth(){return this._bg.width}measureHeight(){return this._bg.height}get value(){return this._value}set value(t){if(this._value!=t){t=t>1?1:t<0?0:t;this._value=t;this.callLater(this.changeValue);this.event(c.Event.CHANGE);this.changeHandler&&this.changeHandler.runWith(t)}}changeValue(){if(this.sizeGrid){var t=this.sizeGrid.split(",");var e=Number(t[3]);var a=Number(t[1]);var i=this.width-e-a;var r=i*this._value;this._bar.width=e+a+r;this._bar.visible=this._bar.width>e+a}else{this._bar.width=this.width*this._value}}get bar(){return this._bar}get bg(){return this._bg}get sizeGrid(){return this._bg.sizeGrid}set sizeGrid(t){this._bg.sizeGrid=this._bar.sizeGrid=t}set width(t){super.width=t;this._bg.width=this._width;this.callLater(this.changeValue)}get width(){return super.width}set height(t){super.height=t;this._bg.height=this._height;this._bar.height=this._height}get height(){return super.height}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.value=Number(t);else super.dataSource=t}get dataSource(){return super.dataSource}}c.ILaya.regClass(E);c.ClassUtils.regClass("laya.ui.ProgressBar",E);c.ClassUtils.regClass("Laya.ProgressBar",E);class b extends l{constructor(t=null,e=""){super(t,e);this.toggle=false;this._autoSize=false}destroy(t=true){super.destroy(t);this._value=null}preinitialize(){super.preinitialize();this.toggle=false;this._autoSize=false}initialize(){super.initialize();this.createText();this._text.align="left";this._text.valign="top";this._text.width=0;this.on(c.Event.CLICK,this,this.onClick)}onClick(t){this.selected=true}get value(){return this._value!=null?this._value:this.label}set value(t){this._value=t}}c.ILaya.regClass(b);c.ClassUtils.regClass("laya.ui.Radio",b);c.ClassUtils.regClass("Laya.Radio",b);class S extends d{constructor(t=null,e=null){super();this._selectedIndex=-1;this._direction="horizontal";this._space=0;this.skin=e;this.labels=t}preinitialize(){this.mouseEnabled=true}destroy(t=true){super.destroy(t);this._items&&(this._items.length=0);this._items=null;this.selectHandler=null}addItem(t,e=true){var a=t;var i=this._items.length;a.name="item"+i;this.addChild(a);this.initItems();if(e&&i>0){var r=this._items[i-1];if(this._direction=="horizontal"){a.x=r._x+r.width+this._space}else{a.y=r._y+r.height+this._space}}else{if(e){a.x=0;a.y=0}}return i}delItem(t,e=true){var a=this._items.indexOf(t);if(a!=-1){var i=t;this.removeChild(i);for(var r=a+1,s=this._items.length;r<s;r++){var n=this._items[r];n.name="item"+(r-1);if(e){if(this._direction=="horizontal"){n.x-=i.width+this._space}else{n.y-=i.height+this._space}}}this.initItems();if(this._selectedIndex>-1){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1;this._selectedIndex=-1;this.selectedIndex=o}}}_afterInited(){this.initItems()}initItems(){this._items||(this._items=[]);this._items.length=0;for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(e==null)break;this._items.push(e);e.selected=t===this._selectedIndex;e.clickHandler=c.Handler.create(this,this.itemClick,[t],false)}}itemClick(t){this.selectedIndex=t}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(this._selectedIndex!=t){this.setSelect(this._selectedIndex,false);this._selectedIndex=t;this.setSelect(t,true);this.event(c.Event.CHANGE);this.selectHandler&&this.selectHandler.runWith(this._selectedIndex)}}setSelect(t,e){if(this._items&&t>-1&&t<this._items.length)this._items[t].selected=e}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(this._skin&&!c.Loader.getRes(this._skin)){c.ILaya.loader.load(this._skin,c.Handler.create(this,this._skinLoaded),null,c.Loader.IMAGE,1)}else{this._skinLoaded()}}}_skinLoaded(){this._setLabelChanged();this.event(c.Event.LOADED)}get labels(){return this._labels}set labels(t){if(this._labels!=t){this._labels=t;this.removeChildren();this._setLabelChanged();if(this._labels){var e=this._labels.split(",");for(var a=0,i=e.length;a<i;a++){var r=this.createItem(this._skin,e[a]);r.name="item"+a;this.addChild(r)}}this.initItems()}}createItem(t,e){return null}get labelColors(){return this._labelColors}set labelColors(t){if(this._labelColors!=t){this._labelColors=t;this._setLabelChanged()}}get labelStroke(){return this._labelStroke}set labelStroke(t){if(this._labelStroke!=t){this._labelStroke=t;this._setLabelChanged()}}get labelStrokeColor(){return this._labelStrokeColor}set labelStrokeColor(t){if(this._labelStrokeColor!=t){this._labelStrokeColor=t;this._setLabelChanged()}}get strokeColors(){return this._strokeColors}set strokeColors(t){if(this._strokeColors!=t){this._strokeColors=t;this._setLabelChanged()}}get labelSize(){return this._labelSize}set labelSize(t){if(this._labelSize!=t){this._labelSize=t;this._setLabelChanged()}}get stateNum(){return this._stateNum}set stateNum(t){if(this._stateNum!=t){this._stateNum=t;this._setLabelChanged()}}get labelBold(){return this._labelBold}set labelBold(t){if(this._labelBold!=t){this._labelBold=t;this._setLabelChanged()}}get labelFont(){return this._labelFont}set labelFont(t){if(this._labelFont!=t){this._labelFont=t;this._setLabelChanged()}}get labelPadding(){return this._labelPadding}set labelPadding(t){if(this._labelPadding!=t){this._labelPadding=t;this._setLabelChanged()}}get direction(){return this._direction}set direction(t){this._direction=t;this._setLabelChanged()}get space(){return this._space}set space(t){this._space=t;this._setLabelChanged()}changeLabels(){this._labelChanged=false;if(this._items){var t=0;for(var e=0,a=this._items.length;e<a;e++){var i=this._items[e];this._skin&&(i.skin=this._skin);this._labelColors&&(i.labelColors=this._labelColors);this._labelSize&&(i.labelSize=this._labelSize);this._labelStroke&&(i.labelStroke=this._labelStroke);this._labelStrokeColor&&(i.labelStrokeColor=this._labelStrokeColor);this._strokeColors&&(i.strokeColors=this._strokeColors);this._labelBold&&(i.labelBold=this._labelBold);this._labelPadding&&(i.labelPadding=this._labelPadding);this._labelAlign&&(i.labelAlign=this._labelAlign);this._stateNum&&(i.stateNum=this._stateNum);this._labelFont&&(i.labelFont=this._labelFont);if(this._direction==="horizontal"){i.y=0;i.x=t;t+=i.width+this._space}else{i.x=0;i.y=t;t+=i.height+this._space}}}this._sizeChanged()}commitMeasure(){this.runCallLater(this.changeLabels)}get items(){return this._items}get selection(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null}set selection(t){this.selectedIndex=this._items.indexOf(t)}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string")this.selectedIndex=parseInt(t);else if(t instanceof Array)this.labels=t.join(",");else super.dataSource=t}get dataSource(){return super.dataSource}_setLabelChanged(){if(!this._labelChanged){this._labelChanged=true;this.callLater(this.changeLabels)}}}c.ILaya.regClass(S);c.ClassUtils.regClass("laya.ui.UIGroup",S);c.ClassUtils.regClass("Laya.UIGroup",S);class C extends S{createItem(t,e){return new b(t,e)}}c.ILaya.regClass(C);c.ClassUtils.regClass("laya.ui.RadioGroup",C);c.ClassUtils.regClass("Laya.RadioGroup",C);class R extends S{createItem(t,e){return new l(t,e)}}c.ILaya.regClass(R);c.ClassUtils.regClass("laya.ui.Tab",R);c.ClassUtils.regClass("Laya.Tab",R);class A extends d{constructor(){super(...arguments);this._setIndexHandler=c.Handler.create(this,this.setIndex,null,false)}setItems(t){this.removeChildren();var e=0;for(var a=0,i=t.length;a<i;a++){var r=t[a];if(r){r.name="item"+e;this.addChild(r);e++}}this.initItems()}addItem(t){t.name="item"+this._items.length;this.addChild(t);this.initItems()}_afterInited(){this.initItems()}initItems(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(e==null){break}this._items.push(e);e.visible=t==this._selectedIndex}}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(this._selectedIndex!=t){this.setSelect(this._selectedIndex,false);this._selectedIndex=t;this.setSelect(this._selectedIndex,true)}}setSelect(t,e){if(this._items&&t>-1&&t<this._items.length){this._items[t].visible=e}}get selection(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null}set selection(t){this.selectedIndex=this._items.indexOf(t)}get setIndexHandler(){return this._setIndexHandler}set setIndexHandler(t){this._setIndexHandler=t}setIndex(t){this.selectedIndex=t}get items(){return this._items}set dataSource(t){this._dataSource=t;if(typeof t=="number"||typeof t=="string"){this.selectedIndex=parseInt(t)}else{for(var e in this._dataSource){if(e in this){this[e]=this._dataSource[e]}}}}get dataSource(){return super.dataSource}}c.ILaya.regClass(A);c.ClassUtils.regClass("laya.ui.ViewStack",A);c.ClassUtils.regClass("Laya.ViewStack",A);class L extends f{constructor(t=""){super();this.text=t;this.skin=this.skin}preinitialize(){this.mouseEnabled=true}destroy(t=true){super.destroy(t);this._bg&&this._bg.destroy();this._bg=null}createChildren(){this.addChild(this._tf=new c.Input);this._tf.padding=n.inputLabelPadding;this._tf.on(c.Event.INPUT,this,this._onInput);this._tf.on(c.Event.ENTER,this,this._onEnter);this._tf.on(c.Event.BLUR,this,this._onBlur);this._tf.on(c.Event.FOCUS,this,this._onFocus)}_onFocus(){this.event(c.Event.FOCUS,this)}_onBlur(){this.event(c.Event.BLUR,this)}_onInput(){this.event(c.Event.INPUT,this)}_onEnter(){this.event(c.Event.ENTER,this)}initialize(){this.width=128;this.height=22}get bg(){return this._bg}set bg(t){this.graphics=this._bg=t}get skin(){return this._skin}set skin(t){if(this._skin!=t){this._skin=t;if(this._skin&&!c.Loader.getRes(this._skin)){c.ILaya.loader.load(this._skin,c.Handler.create(this,this._skinLoaded),null,c.Loader.IMAGE,1)}else{this._skinLoaded()}}}_skinLoaded(){this._bg||(this.graphics=this._bg=new e);this._bg.source=c.Loader.getRes(this._skin);this._width&&(this._bg.width=this._width);this._height&&(this._bg.height=this._height);this._sizeChanged();this.event(c.Event.LOADED)}get sizeGrid(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null}set sizeGrid(t){this._bg||(this.graphics=this._bg=new e);this._bg.sizeGrid=_.fillArray(n.defaultSizeGrid,t,Number)}set text(t){if(this._tf.text!=t){t=t+"";this._tf.text=t;this.event(c.Event.CHANGE)}}get text(){return super.text}set width(t){super.width=t;this._bg&&(this._bg.width=t)}get width(){return super.width}set height(t){super.height=t;this._bg&&(this._bg.height=t)}get height(){return super.height}get multiline(){return this._tf.multiline}set multiline(t){this._tf.multiline=t}set editable(t){this._tf.editable=t}get editable(){return this._tf.editable}select(){this._tf.select()}get restrict(){return this._tf.restrict}set restrict(t){this._tf.restrict=t}get prompt(){return this._tf.prompt}set prompt(t){this._tf.prompt=t}get promptColor(){return this._tf.promptColor}set promptColor(t){this._tf.promptColor=t}get maxChars(){return this._tf.maxChars}set maxChars(t){this._tf.maxChars=t}get focus(){return this._tf.focus}set focus(t){this._tf.focus=t}get type(){return this._tf.type}set type(t){this._tf.type=t}setSelection(t,e){this._tf.setSelection(t,e)}}c.ILaya.regClass(L);c.ClassUtils.regClass("laya.ui.TextInput",L);c.ClassUtils.regClass("Laya.TextInput",L);class I extends L{constructor(t=""){super(t);this.on(c.Event.CHANGE,this,this._onTextChange)}_onTextChange(){this.callLater(this.changeScroll)}destroy(t=true){this._vScrollBar&&this._vScrollBar.destroy();this._hScrollBar&&this._hScrollBar.destroy();this._vScrollBar=null;this._hScrollBar=null;super.destroy(t)}initialize(){this.width=180;this.height=150;this._tf.wordWrap=true;this.multiline=true}set width(t){super.width=t;this.callLater(this.changeScroll)}get width(){return super.width}set height(t){super.height=t;this.callLater(this.changeScroll)}get height(){return super.height}get vScrollBarSkin(){return this._vScrollBar?this._vScrollBar.skin:null}set vScrollBarSkin(t){if(this._vScrollBar==null){this.addChild(this._vScrollBar=new g);this._vScrollBar.on(c.Event.CHANGE,this,this.onVBarChanged);this._vScrollBar.target=this._tf;this.callLater(this.changeScroll)}this._vScrollBar.skin=t}get hScrollBarSkin(){return this._hScrollBar?this._hScrollBar.skin:null}set hScrollBarSkin(t){if(this._hScrollBar==null){this.addChild(this._hScrollBar=new v);this._hScrollBar.on(c.Event.CHANGE,this,this.onHBarChanged);this._hScrollBar.mouseWheelEnable=false;this._hScrollBar.target=this._tf;this.callLater(this.changeScroll)}this._hScrollBar.skin=t}onVBarChanged(t){if(this._tf.scrollY!=this._vScrollBar.value){this._tf.scrollY=this._vScrollBar.value}}onHBarChanged(t){if(this._tf.scrollX!=this._hScrollBar.value){this._tf.scrollX=this._hScrollBar.value}}get vScrollBar(){return this._vScrollBar}get hScrollBar(){return this._hScrollBar}get maxScrollY(){return this._tf.maxScrollY}get scrollY(){return this._tf.scrollY}get maxScrollX(){return this._tf.maxScrollX}get scrollX(){return this._tf.scrollX}changeScroll(){var t=this._vScrollBar&&this._tf.maxScrollY>0;var e=this._hScrollBar&&this._tf.maxScrollX>0;var a=t?this._width-this._vScrollBar.width:this._width;var i=e?this._height-this._hScrollBar.height:this._height;var r=this._tf.padding||n.labelPadding;this._tf.width=a;this._tf.height=i;if(this._vScrollBar){this._vScrollBar.x=this._width-this._vScrollBar.width-r[2];this._vScrollBar.y=r[1];this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-r[1]-r[3];this._vScrollBar.scrollSize=1;this._vScrollBar.thumbPercent=i/Math.max(this._tf.textHeight,i);this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY);this._vScrollBar.visible=t}if(this._hScrollBar){this._hScrollBar.x=r[0];this._hScrollBar.y=this._height-this._hScrollBar.height-r[3];this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-r[0]-r[2];this._hScrollBar.scrollSize=Math.max(a*.033,1);this._hScrollBar.thumbPercent=a/Math.max(this._tf.textWidth,a);this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX);this._hScrollBar.visible=e}}scrollTo(t){this.commitMeasure();this._tf.scrollY=t}}c.ILaya.regClass(I);c.ClassUtils.regClass("laya.ui.TextArea",I);c.ClassUtils.regClass("Laya.TextArea",I);class F extends d{constructor(){super(...arguments);this._oldW=0;this._oldH=0}onEnable(){c.ILaya.stage.on("resize",this,this.onResize);this.onResize()}onDisable(){c.ILaya.stage.off("resize",this,this.onResize)}onResize(){let t=c.ILaya.stage;if(this.width>0&&this.height>0){var e=Math.min(t.width/this._oldW,t.height/this._oldH);super.width=t.width;super.height=t.height;this.scale(e,e)}}set width(t){super.width=t;this._oldW=t}get width(){return super.width}set height(t){super.height=t;this._oldH=t}get height(){return super.height}}c.ILaya.regClass(F);c.ClassUtils.regClass("laya.ui.ScaleBox",F);c.ClassUtils.regClass("Laya.ScaleBox",F);class V extends p{constructor(t=null){super(t);this.isVertical=false}}c.ILaya.regClass(V);c.ClassUtils.regClass("laya.ui.HSlider",V);c.ClassUtils.regClass("Laya.HSlider",V);class U extends d{constructor(){super();this._usedCache=null;this._elasticEnabled=false;this.width=this.height=100}destroy(t=true){super.destroy(t);this._content&&this._content.destroy(t);this._vScrollBar&&this._vScrollBar.destroy(t);this._hScrollBar&&this._hScrollBar.destroy(t);this._vScrollBar=null;this._hScrollBar=null;this._content=null}destroyChildren(){this._content.destroyChildren()}createChildren(){super.addChild(this._content=new d)}addChild(t){t.on(c.Event.RESIZE,this,this.onResize);this._setScrollChanged();return this._content.addChild(t)}onResize(){this._setScrollChanged()}addChildAt(t,e){t.on(c.Event.RESIZE,this,this.onResize);this._setScrollChanged();return this._content.addChildAt(t,e)}removeChild(t){t.off(c.Event.RESIZE,this,this.onResize);this._setScrollChanged();return this._content.removeChild(t)}removeChildAt(t){this.getChildAt(t).off(c.Event.RESIZE,this,this.onResize);this._setScrollChanged();return this._content.removeChildAt(t)}removeChildren(t=0,e=2147483647){this._content.removeChildren(t,e);this._setScrollChanged();return this}getChildAt(t){return this._content.getChildAt(t)}getChildByName(t){return this._content.getChildByName(t)}getChildIndex(t){return this._content.getChildIndex(t)}get numChildren(){return this._content.numChildren}changeScroll(){this._scrollChanged=false;var t=this.contentWidth||1;var e=this.contentHeight||1;var a=this._vScrollBar;var i=this._hScrollBar;var r=a&&e>this._height;var s=i&&t>this._width;var n=r?this._width-a.width:this._width;var o=s?this._height-i.height:this._height;if(a){a.x=this._width-a.width;a.y=0;a.height=this._height-(s?i.height:0);a.scrollSize=Math.max(this._height*.033,1);a.thumbPercent=o/e;a.setScroll(0,e-o,a.value)}if(i){i.x=0;i.y=this._height-i.height;i.width=this._width-(r?a.width:0);i.scrollSize=Math.max(this._width*.033,1);i.thumbPercent=n/t;i.setScroll(0,t-n,i.value)}}_sizeChanged(){super._sizeChanged();this.setContentSize(this._width,this._height)}get contentWidth(){var t=0;for(var e=this._content.numChildren-1;e>-1;e--){var a=this._content.getChildAt(e);t=Math.max(a._x+a.width*a.scaleX-a.pivotX,t)}return t}get contentHeight(){var t=0;for(var e=this._content.numChildren-1;e>-1;e--){var a=this._content.getChildAt(e);t=Math.max(a._y+a.height*a.scaleY-a.pivotY,t)}return t}setContentSize(t,e){var a=this._content;a.width=t;a.height=e;a._style.scrollRect||(a.scrollRect=c.Rectangle.create());a._style.scrollRect.setTo(0,0,t,e);a.scrollRect=a.scrollRect}set width(t){super.width=t;this._setScrollChanged()}get width(){return super.width}set height(t){super.height=t;this._setScrollChanged()}get height(){return super.height}get vScrollBarSkin(){return this._vScrollBar?this._vScrollBar.skin:null}set vScrollBarSkin(t){if(this._vScrollBar==null){super.addChild(this._vScrollBar=new g);this._vScrollBar.on(c.Event.CHANGE,this,this.onScrollBarChange,[this._vScrollBar]);this._vScrollBar.target=this._content;this._vScrollBar.elasticDistance=this._elasticEnabled?200:0;this._setScrollChanged()}this._vScrollBar.skin=t}get hScrollBarSkin(){return this._hScrollBar?this._hScrollBar.skin:null}set hScrollBarSkin(t){if(this._hScrollBar==null){super.addChild(this._hScrollBar=new v);this._hScrollBar.on(c.Event.CHANGE,this,this.onScrollBarChange,[this._hScrollBar]);this._hScrollBar.target=this._content;this._hScrollBar.elasticDistance=this._elasticEnabled?200:0;this._setScrollChanged()}this._hScrollBar.skin=t}get vScrollBar(){return this._vScrollBar}get hScrollBar(){return this._hScrollBar}get content(){return this._content}onScrollBarChange(t){var e=this._content._style.scrollRect;if(e){var a=Math.round(t.value);t.isVertical?e.y=a:e.x=a;this._content.scrollRect=e}}scrollTo(t=0,e=0){if(this.vScrollBar)this.vScrollBar.value=e;if(this.hScrollBar)this.hScrollBar.value=t}refresh(){this.changeScroll()}set cacheAs(t){super.cacheAs=t;this._usedCache=null;if(t!=="none"){this._hScrollBar&&this._hScrollBar.on(c.Event.START,this,this.onScrollStart);this._vScrollBar&&this._vScrollBar.on(c.Event.START,this,this.onScrollStart)}else{this._hScrollBar&&this._hScrollBar.off(c.Event.START,this,this.onScrollStart);this._vScrollBar&&this._vScrollBar.off(c.Event.START,this,this.onScrollStart)}}get cacheAs(){return super.cacheAs}get elasticEnabled(){return this._elasticEnabled}set elasticEnabled(t){this._elasticEnabled=t;if(this._vScrollBar){this._vScrollBar.elasticDistance=t?200:0}if(this._hScrollBar){this._hScrollBar.elasticDistance=t?200:0}}onScrollStart(){this._usedCache||(this._usedCache=super.cacheAs);super.cacheAs="none";this._hScrollBar&&this._hScrollBar.once(c.Event.END,this,this.onScrollEnd);this._vScrollBar&&this._vScrollBar.once(c.Event.END,this,this.onScrollEnd)}onScrollEnd(){super.cacheAs=this._usedCache}_setScrollChanged(){if(!this._scrollChanged){this._scrollChanged=true;this.callLater(this.changeScroll)}}}c.ILaya.regClass(U);c.ClassUtils.regClass("laya.ui.Panel",U);c.ClassUtils.regClass("Laya.Panel",U);class k extends p{}c.ILaya.regClass(k);c.ClassUtils.regClass("laya.ui.VSlider",k);c.ClassUtils.regClass("Laya.VSlider",k);class G extends d{constructor(){super();this._spaceLeft=10;this._spaceBottom=0;this._keepStatus=true;this.width=this.height=200}destroy(t=true){super.destroy(t);this._list&&this._list.destroy(t);this._list=null;this._source=null;this._renderHandler=null}createChildren(){this.addChild(this._list=new y);this._list.renderHandler=c.Handler.create(this,this.renderItem,null,false);this._list.repeatX=1;this._list.on(c.Event.CHANGE,this,this.onListChange)}onListChange(t=null){this.event(c.Event.CHANGE)}get keepStatus(){return this._keepStatus}set keepStatus(t){this._keepStatus=t}get array(){return this._list.array}set array(t){if(this._keepStatus&&this._list.array&&t){this.parseOpenStatus(this._list.array,t)}this._source=t;this._list.array=this.getArray()}get source(){return this._source}get list(){return this._list}get itemRender(){return this._list.itemRender}set itemRender(t){this._list.itemRender=t}get scrollBarSkin(){return this._list.vScrollBarSkin}set scrollBarSkin(t){this._list.vScrollBarSkin=t}get scrollBar(){return this._list.scrollBar}get mouseHandler(){return this._list.mouseHandler}set mouseHandler(t){this._list.mouseHandler=t}get renderHandler(){return this._renderHandler}set renderHandler(t){this._renderHandler=t}get spaceLeft(){return this._spaceLeft}set spaceLeft(t){this._spaceLeft=t}get spaceBottom(){return this._list.spaceY}set spaceBottom(t){this._list.spaceY=t}get selectedIndex(){return this._list.selectedIndex}set selectedIndex(t){this._list.selectedIndex=t}get selectedItem(){return this._list.selectedItem}set selectedItem(t){this._list.selectedItem=t}set width(t){super.width=t;this._list.width=t}get width(){return super.width}set height(t){super.height=t;this._list.height=t}get height(){return super.height}getArray(){var a=[];for(let e in this._source){let t=this._source[e];if(this.getParentOpenStatus(t)){t.x=this._spaceLeft*this.getDepth(t);a.push(t)}}return a}getDepth(t,e=0){if(t.nodeParent==null)return e;else return this.getDepth(t.nodeParent,e+1)}getParentOpenStatus(t){var e=t.nodeParent;if(e==null){return true}else{if(e.isOpen){if(e.nodeParent!=null)return this.getParentOpenStatus(e);else return true}else{return false}}}renderItem(t,e){var a=t.dataSource;if(a){t.left=a.x;var i=t.getChildByName("arrow");if(i){if(a.hasChild){i.visible=true;i.index=a.isOpen?1:0;i.tag=e;i.off(c.Event.CLICK,this,this.onArrowClick);i.on(c.Event.CLICK,this,this.onArrowClick)}else{i.visible=false}}var r=t.getChildByName("folder");if(r){if(r.clipY==2){r.index=a.isDirectory?0:1}else{r.index=a.isDirectory?a.isOpen?1:0:2}}this._renderHandler&&this._renderHandler.runWith([t,e])}}onArrowClick(t){var e=t.currentTarget;var a=e.tag;this._list.array[a].isOpen=!this._list.array[a].isOpen;this.event(c.Event.OPEN);this._list.array=this.getArray()}setItemState(t,e){if(!this._list.array[t])return;this._list.array[t].isOpen=e;this._list.array=this.getArray()}fresh(){this._list.array=this.getArray();this.repaint()}set dataSource(t){this._dataSource=t;super.dataSource=t}get dataSource(){return super.dataSource}set xml(t){var e=[];this.parseXml(t.childNodes[0],e,null,true);this.array=e}parseXml(t,e,a,i){var r;var s=t.childNodes;var n=s.length;if(!i){r={};var o=t.attributes;for(let t in o){var l=o[t];var _=l.nodeName;var h=l.nodeValue;r[_]=h=="true"?true:h=="false"?false:h}r.nodeParent=a;if(n>0)r.isDirectory=true;r.hasChild=n>0;e.push(r)}for(var x=0;x<n;x++){var c=s[x];this.parseXml(c,e,r,false)}}parseOpenStatus(t,e){for(var a=0,i=e.length;a<i;a++){var r=e[a];if(r.isDirectory){for(var s=0,n=t.length;s<n;s++){var o=t[s];if(o.isDirectory&&this.isSameParent(o,r)&&r.label==o.label){r.isOpen=o.isOpen;break}}}}}isSameParent(t,e){if(t.nodeParent==null&&e.nodeParent==null)return true;else if(t.nodeParent==null||e.nodeParent==null)return false;else{if(t.nodeParent.label==e.nodeParent.label)return this.isSameParent(t.nodeParent,e.nodeParent);else return false}}get selectedPath(){if(this._list.selectedItem){return this._list.selectedItem.path}return null}filter(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t);this._list.array=e}else{this._list.array=this.getArray()}}getFilterSource(e,a,i){i=i.toLocaleLowerCase();for(let t of e){if(!t.isDirectory&&String(t.label).toLowerCase().indexOf(i)>-1){t.x=0;a.push(t)}if(t.child&&t.child.length>0){this.getFilterSource(t.child,a,i)}}}}c.ILaya.regClass(G);c.ClassUtils.regClass("laya.ui.Tree",G);c.ClassUtils.regClass("Laya.Tree",G);class M extends d{constructor(){super(...arguments);this._space=0;this._align="none";this._itemChanged=false}addChild(t){t.on(c.Event.RESIZE,this,this.onResize);this._setItemChanged();return super.addChild(t)}onResize(t){this._setItemChanged()}addChildAt(t,e){t.on(c.Event.RESIZE,this,this.onResize);this._setItemChanged();return super.addChildAt(t,e)}removeChildAt(t){this.getChildAt(t).off(c.Event.RESIZE,this,this.onResize);this._setItemChanged();return super.removeChildAt(t)}refresh(){this._setItemChanged()}changeItems(){this._itemChanged=false}get space(){return this._space}set space(t){this._space=t;this._setItemChanged()}get align(){return this._align}set align(t){this._align=t;this._setItemChanged()}sortItem(t){if(t)t.sort(function(t,e){return t.y-e.y})}_setItemChanged(){if(!this._itemChanged){this._itemChanged=true;this.callLater(this.changeItems)}}}c.ILaya.regClass(M);c.ClassUtils.regClass("laya.ui.LayoutBox",M);c.ClassUtils.regClass("Laya.LayoutBox",M);class D extends M{sortItem(t){if(t)t.sort(function(t,e){return t.x-e.x})}set height(t){if(this._height!=t){super.height=t;this.callLater(this.changeItems)}}get height(){return super.height}changeItems(){this._itemChanged=false;var t=[];var e=0;for(var a=0,i=this.numChildren;a<i;a++){var r=this.getChildAt(a);if(r){t.push(r);e=this._height?this._height:Math.max(e,r.height*r.scaleY)}}this.sortItem(t);var s=0;for(a=0,i=t.length;a<i;a++){r=t[a];r.x=s;s+=r.width*r.scaleX+this._space;if(this._align==D.TOP){r.y=0}else if(this._align==D.MIDDLE){r.y=(e-r.height*r.scaleY)*.5}else if(this._align==D.BOTTOM){r.y=e-r.height*r.scaleY}}this._sizeChanged()}}D.NONE="none";D.TOP="top";D.MIDDLE="middle";D.BOTTOM="bottom";c.ILaya.regClass(D);c.ClassUtils.regClass("laya.ui.HBox",D);c.ClassUtils.regClass("Laya.HBox",D);class w extends M{set width(t){if(this._width!=t){super.width=t;this.callLater(this.changeItems)}}get width(){return super.width}changeItems(){this._itemChanged=false;var t=[];var e=0;for(var a=0,i=this.numChildren;a<i;a++){var r=this.getChildAt(a);if(r){t.push(r);e=this._width?this._width:Math.max(e,r.width*r.scaleX)}}this.sortItem(t);var s=0;for(a=0,i=t.length;a<i;a++){r=t[a];r.y=s;s+=r.height*r.scaleY+this._space;if(this._align==w.LEFT){r.x=0}else if(this._align==w.CENTER){r.x=(e-r.width*r.scaleX)*.5}else if(this._align==w.RIGHT){r.x=e-r.width*r.scaleX}}this._sizeChanged()}}w.NONE="none";w.LEFT="left";w.CENTER="center";w.RIGHT="right";c.ILaya.regClass(w);c.ClassUtils.regClass("laya.ui.VBox",w);c.ClassUtils.regClass("Laya.VBox",w);class H extends x{constructor(t=null,e=null){super();this._valueArr="";this._indexMap=null;this._sheet=null;this._direction="horizontal";this._spaceX=0;this._spaceY=0;this._align="left";this._wordsW=0;this._wordsH=0;if(t)this.skin=t;if(e)this.sheet=e}createChildren(){this._bitmap=new e;this.on(c.Event.LOADED,this,this._onClipLoaded)}_onClipLoaded(){this.callLater(this.changeValue)}get sheet(){return this._sheet}set sheet(t){t+="";this._sheet=t;var e=t.split(" ");this._clipX=String(e[0]).length;this.clipY=e.length;this._indexMap={};for(var a=0;a<this._clipY;a++){var i=e[a].split("");for(var r=0,s=i.length;r<s;r++){this._indexMap[i[r]]=a*this._clipX+r}}}get value(){if(!this._valueArr)return"";return this._valueArr}set value(t){t+="";this._valueArr=t;this.callLater(this.changeValue)}get direction(){return this._direction}set direction(t){this._direction=t;this.callLater(this.changeValue)}get spaceX(){return this._spaceX}set spaceX(t){this._spaceX=t;if(this._direction==="horizontal")this.callLater(this.changeValue)}get spaceY(){return this._spaceY}set spaceY(t){this._spaceY=t;if(!(this._direction==="horizontal"))this.callLater(this.changeValue)}set align(t){this._align=t;this.callLater(this.changeValue)}get align(){return this._align}changeValue(){if(!this._sources)return;if(!this._valueArr)return;this.graphics.clear(true);var t;t=this._sources[0];if(!t)return;var e=this._direction==="horizontal";if(e){this._wordsW=this._valueArr.length*(t.sourceWidth+this.spaceX);this._wordsH=t.sourceHeight}else{this._wordsW=t.sourceWidth;this._wordsH=(t.sourceHeight+this.spaceY)*this._valueArr.length}var a=0;if(this._width){switch(this._align){case"center":a=.5*(this._width-this._wordsW);break;case"right":a=this._width-this._wordsW;break;default:a=0}}for(var i=0,r=this._valueArr.length;i<r;i++){var s=this._indexMap[this._valueArr.charAt(i)];if(!this.sources[s])continue;t=this.sources[s];if(e)this.graphics.drawImage(t,a+i*(t.sourceWidth+this.spaceX),0,t.sourceWidth,t.sourceHeight);else this.graphics.drawImage(t,0+a,i*(t.sourceHeight+this.spaceY),t.sourceWidth,t.sourceHeight)}if(!this._width){this._widget.resetLayoutX();this.callLater(this._sizeChanged)}if(!this._height){this._widget.resetLayoutY();this.callLater(this._sizeChanged)}}set width(t){super.width=t;this.callLater(this.changeValue)}get width(){return super.width}set height(t){super.height=t;this.callLater(this.changeValue)}get height(){return super.height}measureWidth(){return this._wordsW}measureHeight(){return this._wordsH}destroy(t=true){this._valueArr=null;this._indexMap=null;this.graphics.clear(true);this.removeSelf();this.off(c.Event.LOADED,this,this._onClipLoaded);super.destroy(t)}}c.ILaya.regClass(H);c.ClassUtils.regClass("laya.ui.FontClip",H);c.ClassUtils.regClass("Laya.FontClip",H);class P extends c.Scene{constructor(){super(false);this._watchMap={};this._anchorX=NaN;this._anchorY=NaN;this._widget=a.EMPTY;this.createChildren()}static __init__(){c.ILaya.ClassUtils.regShortClassName([A,l,I,u,d,F,h,x,T,r,v,V,o,f,y,U,E,b,C,m,p,R,L,P,g,k,G,D,w,c.Animation,c.Text,H])}static regComponent(t,e){c.ILaya.ClassUtils.regClass(t,e)}static regViewRuntime(t,e){c.ILaya.ClassUtils.regClass(t,e)}static regUI(t,e){c.ILaya.loader.cacheRes(t,e)}destroy(t=true){this._watchMap=null;super.destroy(t)}changeData(t){var e=this._watchMap[t];if(!e)return;for(var a=0,i=e.length;a<i;a++){var r=e[a];r.exe(this)}}get top(){return this._widget.top}set top(t){if(t!=this._widget.top){this._getWidget().top=t}}get bottom(){return this._widget.bottom}set bottom(t){if(t!=this._widget.bottom){this._getWidget().bottom=t}}get left(){return this._widget.left}set left(t){if(t!=this._widget.left){this._getWidget().left=t}}get right(){return this._widget.right}set right(t){if(t!=this._widget.right){this._getWidget().right=t}}get centerX(){return this._widget.centerX}set centerX(t){if(t!=this._widget.centerX){this._getWidget().centerX=t}}get centerY(){return this._widget.centerY}set centerY(t){if(t!=this._widget.centerY){this._getWidget().centerY=t}}get anchorX(){return this._anchorX}set anchorX(t){if(this._anchorX!=t){this._anchorX=t;this.callLater(this._sizeChanged)}}get anchorY(){return this._anchorY}set anchorY(t){if(this._anchorY!=t){this._anchorY=t;this.callLater(this._sizeChanged)}}_sizeChanged(){if(!isNaN(this._anchorX))this.pivotX=this.anchorX*this.width;if(!isNaN(this._anchorY))this.pivotY=this.anchorY*this.height;this.event(c.Event.RESIZE)}_getWidget(){this._widget===a.EMPTY&&(this._widget=this.addComponent(a));return this._widget}loadUI(t){var e=P.uiMap[t];P.uiMap&&this.createView(e)}get dataSource(){return this._dataSource}set dataSource(t){this._dataSource=t;for(var e in t){var a=this.getChildByName(e);if(a instanceof r)a.dataSource=t[e];else if(e in this&&!(this[e]instanceof Function))this[e]=t[e]}}}P.uiMap={};c.ILaya.regClass(P);c.ClassUtils.regClass("laya.ui.View",P);c.ClassUtils.regClass("Laya.View",P);class z{}z.Dialog=null;class W extends c.Sprite{constructor(){super();this.maskLayer=new c.Sprite;this.popupEffect=t=>{t.scale(1,1);t._effectTween=c.Tween.from(t,{x:c.ILaya.stage.width/2,y:c.ILaya.stage.height/2,scaleX:0,scaleY:0},300,c.Ease.backOut,c.Handler.create(this,this.doOpen,[t]),0,false,false)};this.closeEffect=t=>{t._effectTween=c.Tween.to(t,{x:c.ILaya.stage.width/2,y:c.ILaya.stage.height/2,scaleX:0,scaleY:0},300,c.Ease.strongOut,c.Handler.create(this,this.doClose,[t]),0,false,false)};this.popupEffectHandler=new c.Handler(this,this.popupEffect);this.closeEffectHandler=new c.Handler(this,this.closeEffect);this.mouseEnabled=this.maskLayer.mouseEnabled=true;this.zOrder=1e3;c.ILaya.stage.addChild(this);c.ILaya.stage.on(c.Event.RESIZE,this,this._onResize);if(s.closeDialogOnSide)this.maskLayer.on("click",this,this._closeOnSide);this._onResize(null)}_closeOnSide(){var t=this.getChildAt(this.numChildren-1);if(t instanceof z.Dialog)t.close()}setLockView(t){if(!this.lockLayer){this.lockLayer=new d;this.lockLayer.mouseEnabled=true;this.lockLayer.size(c.ILaya.stage.width,c.ILaya.stage.height)}this.lockLayer.removeChildren();if(t){t.centerX=t.centerY=0;this.lockLayer.addChild(t)}}_onResize(t=null){var e=this.maskLayer.width=c.ILaya.stage.width;var a=this.maskLayer.height=c.ILaya.stage.height;if(this.lockLayer)this.lockLayer.size(e,a);this.maskLayer.graphics.clear(true);this.maskLayer.graphics.drawRect(0,0,e,a,s.popupBgColor);this.maskLayer.alpha=s.popupBgAlpha;for(var i=this.numChildren-1;i>-1;i--){var r=this.getChildAt(i);if(r.isPopupCenter)this._centerDialog(r)}}_centerDialog(t){t.x=Math.round((c.ILaya.stage.width-t.width>>1)+t.pivotX);t.y=Math.round((c.ILaya.stage.height-t.height>>1)+t.pivotY)}open(t,e=false,a=false){if(e)this._closeAll();this._clearDialogEffect(t);if(t.isPopupCenter)this._centerDialog(t);this.addChild(t);if(t.isModal||this._getBit(c.Const.HAS_ZORDER))c.ILaya.timer.callLater(this,this._checkMask);if(a&&t.popupEffect!=null)t.popupEffect.runWith(t);else this.doOpen(t);this.event(c.Event.OPEN)}_clearDialogEffect(t){if(t._effectTween){c.Tween.clear(t._effectTween);t._effectTween=null}}doOpen(t){t.onOpened(t._param)}lock(t){if(this.lockLayer){if(t)this.addChild(this.lockLayer);else this.lockLayer.removeSelf()}}close(t){this._clearDialogEffect(t);if(t.isShowEffect&&t.closeEffect!=null)t.closeEffect.runWith([t]);else this.doClose(t);this.event(c.Event.CLOSE)}doClose(t){t.removeSelf();t.isModal&&this._checkMask();t.closeHandler&&t.closeHandler.runWith(t.closeType);t.onClosed(t.closeType);if(t.autoDestroyAtClosed)t.destroy()}closeAll(){this._closeAll();this.event(c.Event.CLOSE)}_closeAll(){for(var t=this.numChildren-1;t>-1;t--){var e=this.getChildAt(t);if(e&&e.close!=null){this.doClose(e)}}}getDialogsByGroup(t){var e=[];for(var a=this.numChildren-1;a>-1;a--){var i=this.getChildAt(a);if(i&&i.group===t){e.push(i)}}return e}closeByGroup(t){var e=[];for(var a=this.numChildren-1;a>-1;a--){var i=this.getChildAt(a);if(i&&i.group===t){i.close();e.push(i)}}return e}_checkMask(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;t>-1;t--){var e=this.getChildAt(t);if(e&&e.isModal){this.addChildAt(this.maskLayer,t);return}}}}c.ClassUtils.regClass("laya.ui.DialogManager",W);c.ClassUtils.regClass("Laya.DialogManager",W);class O extends P{constructor(){super();this.isShowEffect=true;this.isPopupCenter=true;this.popupEffect=O.manager.popupEffectHandler;this.closeEffect=O.manager.closeEffectHandler;this._dealDragArea();this.on(c.Event.CLICK,this,this._onClick)}static get manager(){return O._manager=O._manager||new W}static set manager(t){O._manager=t}_dealDragArea(){var t=this.getChildByName("drag");if(t){this.dragArea=t._x+","+t._y+","+t.width+","+t.height;t.removeSelf()}}get dragArea(){if(this._dragArea)return this._dragArea.toString();return null}set dragArea(t){if(t){var e=_.fillArray([0,0,0,0],t,Number);this._dragArea=new c.Rectangle(e[0],e[1],e[2],e[3]);this.on(c.Event.MOUSE_DOWN,this,this._onMouseDown)}else{this._dragArea=null;this.off(c.Event.MOUSE_DOWN,this,this._onMouseDown)}}_onMouseDown(t){var e=this.getMousePoint();if(this._dragArea.contains(e.x,e.y))this.startDrag();else this.stopDrag()}_onClick(t){var e=t.target;if(e){switch(e.name){case O.CLOSE:case O.CANCEL:case O.SURE:case O.NO:case O.OK:case O.YES:this.close(e.name);return}}}open(t=true,e=null){this._dealDragArea();this._param=e;O.manager.open(this,t,this.isShowEffect);O.manager.lock(false)}close(t=null){this.closeType=t;O.manager.close(this)}destroy(t=true){this.closeHandler=null;this.popupEffect=null;this.closeEffect=null;this._dragArea=null;super.destroy(t)}show(t=false,e=true){this._open(false,t,e)}popup(t=false,e=true){this._open(true,t,e)}_open(t,e,a){this.isModal=t;this.isShowEffect=a;O.manager.lock(true);this.open(e)}get isPopup(){return this.parent!=null}set zOrder(t){super.zOrder=t;O.manager._checkMask()}get zOrder(){return super.zOrder}static setLockView(t){O.manager.setLockView(t)}static lock(t){O.manager.lock(t)}static closeAll(){O.manager.closeAll()}static getDialogsByGroup(t){return O.manager.getDialogsByGroup(t)}static closeByGroup(t){return O.manager.closeByGroup(t)}}O.CLOSE="close";O.CANCEL="cancel";O.SURE="sure";O.NO="no";O.YES="yes";O.OK="ok";z.Dialog=O;c.ILaya.regClass(O);c.ClassUtils.regClass("laya.ui.Dialog",O);c.ClassUtils.regClass("Laya.Dialog",O);class N extends r{constructor(){super();this._tipBox=new r;this._tipBox.addChild(this._tipText=new c.Text);this._tipText.x=this._tipText.y=5;this._tipText.color=N.tipTextColor;this._defaultTipHandler=this._showDefaultTip;c.ILaya.stage.on(i.SHOW_TIP,this,this._onStageShowTip);c.ILaya.stage.on(i.HIDE_TIP,this,this._onStageHideTip);this.zOrder=1100}_onStageHideTip(t){c.ILaya.timer.clear(this,this._showTip);this.closeAll();this.removeSelf()}_onStageShowTip(t){c.ILaya.timer.once(N.tipDelay,this,this._showTip,[t],true)}_showTip(t){if(typeof t=="string"){var e=String(t);if(Boolean(e)){this._defaultTipHandler(e)}}else if(t instanceof c.Handler){t.run()}else if(t instanceof Function){t.apply()}{c.ILaya.stage.on(c.Event.MOUSE_MOVE,this,this._onStageMouseMove);c.ILaya.stage.on(c.Event.MOUSE_DOWN,this,this._onStageMouseDown)}this._onStageMouseMove(null)}_onStageMouseDown(t){this.closeAll()}_onStageMouseMove(t){this._showToStage(this,N.offsetX,N.offsetY)}_showToStage(t,e=0,a=0){var i=t.getBounds();t.x=c.ILaya.stage.mouseX+e;t.y=c.ILaya.stage.mouseY+a;if(t._x+i.width>c.ILaya.stage.width){t.x-=i.width+e}if(t._y+i.height>c.ILaya.stage.height){t.y-=i.height+a}}closeAll(){c.ILaya.timer.clear(this,this._showTip);c.ILaya.stage.off(c.Event.MOUSE_MOVE,this,this._onStageMouseMove);c.ILaya.stage.off(c.Event.MOUSE_DOWN,this,this._onStageMouseDown);this.removeChildren()}showDislayTip(t){this.addChild(t);this._showToStage(this);c.ILaya.stage.addChild(this)}_showDefaultTip(t){this._tipText.text=t;var e=this._tipBox.graphics;e.clear(true);e.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,N.tipBackColor);this.addChild(this._tipBox);this._showToStage(this);c.ILaya.stage.addChild(this)}get defaultTipHandler(){return this._defaultTipHandler}set defaultTipHandler(t){this._defaultTipHandler=t}}N.offsetX=10;N.offsetY=15;N.tipTextColor="#ffffff";N.tipBackColor="#111111";N.tipDelay=200;c.ILaya.regClass(N);c.ClassUtils.regClass("laya.ui.TipManager",N);c.ClassUtils.regClass("Laya.TipManager",N);class X{static __init__(){}}class Y extends r{constructor(){super();this._width=this._height=200;var t=new c.Texture;t.bitmap=new c.Texture2D;this.texture=t}onEnable(){this.postMsg({type:"display",rate:c.Laya.stage.frameRate});if(window.wx&&window.sharedCanvas)c.Laya.timer.frameLoop(1,this,this._onLoop)}onDisable(){this.postMsg({type:"undisplay"});c.Laya.timer.clear(this,this._onLoop)}_onLoop(){let t=window.sharedCanvas;this.texture.sourceWidth=t.width;this.texture.sourceHeight=t.height;this.texture.bitmap.loadImageSource(t)}set width(t){super.width=t;if(window.sharedCanvas)window.sharedCanvas.width=t;this.callLater(this._postMsg)}get width(){return super.width}set height(t){super.height=t;if(window.sharedCanvas)window.sharedCanvas.height=t;this.callLater(this._postMsg)}get height(){return super.height}set x(t){super.x=t;this.callLater(this._postMsg)}get x(){return super.x}set y(t){super.y=t;this.callLater(this._postMsg)}get y(){return super.y}_postMsg(){var t=new c.Matrix;t.translate(this.x,this.y);var e=c.Laya.stage;t.scale(e._canvasTransform.getScaleX()*this.globalScaleX*e.transform.getScaleX(),e._canvasTransform.getScaleY()*this.globalScaleY*e.transform.getScaleY());this.postMsg({type:"changeMatrix",a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty,w:this.width,h:this.height})}postMsg(t){if(window.wx&&window.wx.getOpenDataContext){var e=window.wx.getOpenDataContext();e.postMessage(t)}}}c.ILaya.regClass(Y);c.ClassUtils.regClass("laya.ui.WXOpenDataViewer",Y);c.ClassUtils.regClass("Laya.WXOpenDataViewer",Y);t.AdvImage=B;t.AutoBitmap=e;t.Box=d;t.Button=l;t.CheckBox=h;t.Clip=x;t.ColorPicker=u;t.ComboBox=T;t.Dialog=O;t.DialogManager=W;t.FontClip=H;t.HBox=D;t.HScrollBar=v;t.HSlider=V;t.IUI=z;t.Image=o;t.Label=f;t.LayoutBox=M;t.List=y;t.Panel=U;t.ProgressBar=E;t.Radio=b;t.RadioGroup=C;t.ScaleBox=F;t.ScrollBar=m;t.Slider=p;t.Styles=n;t.Tab=R;t.TextArea=I;t.TextInput=L;t.TipManager=N;t.Tree=G;t.UIComponent=r;t.UIConfig=s;t.UIEvent=i;t.UIGroup=S;t.UILib=X;t.UIUtils=_;t.VBox=w;t.VScrollBar=g;t.VSlider=k;t.View=P;t.ViewStack=A;t.WXOpenDataViewer=Y;t.Widget=a})(window.Laya=window.Laya||{},Laya);(function(H,Et){"use strict";class z{constructor(){}static isZero(t){return Math.abs(t)<z.zeroTolerance}static nearEqual(t,e){if(z.isZero(t-e))return true;return false}static fastInvSqrt(t){if(z.isZero(t))return t;return 1/Math.sqrt(t)}}z.zeroTolerance=1e-6;z.MaxValue=340282347e30;z.MinValue=-340282347e30;z.Deg2Rad=Math.PI/180;class Ct{constructor(t=0,e=0){this.x=t;this.y=e}setValue(t,e){this.x=t;this.y=e}static scale(t,e,a){a.x=t.x*e;a.y=t.y*e}fromArray(t,e=0){this.x=t[e+0];this.y=t[e+1]}cloneTo(t){var e=t;e.x=this.x;e.y=this.y}static dot(t,e){return t.x*e.x+t.y*e.y}static normalize(t,e){var a=t.x,i=t.y;var r=a*a+i*i;if(r>0){r=1/Math.sqrt(r);e.x=a*r;e.y=i*r}}static scalarLength(t){var e=t.x,a=t.y;return Math.sqrt(e*e+a*a)}clone(){var t=new Ct;this.cloneTo(t);return t}forNativeElement(t=null){if(t){this.elements=t;this.elements[0]=this.x;this.elements[1]=this.y}else{this.elements=new Float32Array([this.x,this.y])}Ct.rewriteNumProperty(this,"x",0);Ct.rewriteNumProperty(this,"y",1)}static rewriteNumProperty(t,e,a){Object["defineProperty"](t,e,{get:function(){return this.elements[a]},set:function(t){this.elements[a]=t}})}}Ct.ZERO=new Ct(0,0);Ct.ONE=new Ct(1,1);class bt{constructor(t=0,e=0,a=0,i=0){this.x=t;this.y=e;this.z=a;this.w=i}setValue(t,e,a,i){this.x=t;this.y=e;this.z=a;this.w=i}fromArray(t,e=0){this.x=t[e+0];this.y=t[e+1];this.z=t[e+2];this.w=t[e+3]}cloneTo(t){var e=t;e.x=this.x;e.y=this.y;e.z=this.z;e.w=this.w}clone(){var t=new bt;this.cloneTo(t);return t}static lerp(t,e,a,i){var r=t.x,s=t.y,n=t.z,o=t.w;i.x=r+a*(e.x-r);i.y=s+a*(e.y-s);i.z=n+a*(e.z-n);i.w=o+a*(e.w-o)}static transformByM4x4(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=t.w;var o=e.elements;a.x=i*o[0]+r*o[4]+s*o[8]+n*o[12];a.y=i*o[1]+r*o[5]+s*o[9]+n*o[13];a.z=i*o[2]+r*o[6]+s*o[10]+n*o[14];a.w=i*o[3]+r*o[7]+s*o[11]+n*o[15]}static equals(t,e){return z.nearEqual(Math.abs(t.x),Math.abs(e.x))&&z.nearEqual(Math.abs(t.y),Math.abs(e.y))&&z.nearEqual(Math.abs(t.z),Math.abs(e.z))&&z.nearEqual(Math.abs(t.w),Math.abs(e.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}static normalize(t,e){var a=t.length();if(a>0){var i=1/a;e.x=t.x*i;e.y=t.y*i;e.z=t.z*i;e.w=t.w*i}}static add(t,e,a){a.x=t.x+e.x;a.y=t.y+e.y;a.z=t.z+e.z;a.w=t.w+e.w}static subtract(t,e,a){a.x=t.x-e.x;a.y=t.y-e.y;a.z=t.z-e.z;a.w=t.w-e.w}static multiply(t,e,a){a.x=t.x*e.x;a.y=t.y*e.y;a.z=t.z*e.z;a.w=t.w*e.w}static scale(t,e,a){a.x=t.x*e;a.y=t.y*e;a.z=t.z*e;a.w=t.w*e}static Clamp(t,e,a,i){var r=t.x;var s=t.y;var n=t.z;var o=t.w;var l=e.x;var _=e.y;var h=e.z;var x=e.w;var c=a.x;var d=a.y;var u=a.z;var f=a.w;r=r>c?c:r;r=r<l?l:r;s=s>d?d:s;s=s<_?_:s;n=n>u?u:n;n=n<h?h:n;o=o>f?f:o;o=o<x?x:o;i.x=r;i.y=s;i.z=n;i.w=o}static distanceSquared(t,e){var a=t.x-e.x;var i=t.y-e.y;var r=t.z-e.z;var s=t.w-e.w;return a*a+i*i+r*r+s*s}static distance(t,e){var a=t.x-e.x;var i=t.y-e.y;var r=t.z-e.z;var s=t.w-e.w;return Math.sqrt(a*a+i*i+r*r+s*s)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static min(t,e,a){a.x=Math.min(t.x,e.x);a.y=Math.min(t.y,e.y);a.z=Math.min(t.z,e.z);a.w=Math.min(t.w,e.w)}static max(t,e,a){a.x=Math.max(t.x,e.x);a.y=Math.max(t.y,e.y);a.z=Math.max(t.z,e.z);a.w=Math.max(t.w,e.w)}forNativeElement(t=null){if(t){this.elements=t;this.elements[0]=this.x;this.elements[1]=this.y;this.elements[2]=this.z;this.elements[3]=this.w}else{this.elements=new Float32Array([this.x,this.y,this.z,this.w])}Ct.rewriteNumProperty(this,"x",0);Ct.rewriteNumProperty(this,"y",1);Ct.rewriteNumProperty(this,"z",2);Ct.rewriteNumProperty(this,"w",3)}}bt.ZERO=new bt;bt.ONE=new bt(1,1,1,1);bt.UnitX=new bt(1,0,0,0);bt.UnitY=new bt(0,1,0,0);bt.UnitZ=new bt(0,0,1,0);bt.UnitW=new bt(0,0,0,1);class St{constructor(t=0,e=0,a=0,i=null){this.x=t;this.y=e;this.z=a}static distanceSquared(t,e){var a=t.x-e.x;var i=t.y-e.y;var r=t.z-e.z;return a*a+i*i+r*r}static distance(t,e){var a=t.x-e.x;var i=t.y-e.y;var r=t.z-e.z;return Math.sqrt(a*a+i*i+r*r)}static min(t,e,a){a.x=Math.min(t.x,e.x);a.y=Math.min(t.y,e.y);a.z=Math.min(t.z,e.z)}static max(t,e,a){a.x=Math.max(t.x,e.x);a.y=Math.max(t.y,e.y);a.z=Math.max(t.z,e.z)}static transformQuat(t,e,a){var i=t.x,r=t.y,s=t.z,n=e.x,o=e.y,l=e.z,_=e.w,h=_*i+o*s-l*r,x=_*r+l*i-n*s,c=_*s+n*r-o*i,d=-n*i-o*r-l*s;a.x=h*_+d*-n+x*-l-c*-o;a.y=x*_+d*-o+c*-n-h*-l;a.z=c*_+d*-l+h*-o-x*-n}static scalarLength(t){var e=t.x,a=t.y,i=t.z;return Math.sqrt(e*e+a*a+i*i)}static scalarLengthSquared(t){var e=t.x,a=t.y,i=t.z;return e*e+a*a+i*i}static normalize(t,e){var a=t.x,i=t.y,r=t.z;var s=a*a+i*i+r*r;if(s>0){s=1/Math.sqrt(s);e.x=a*s;e.y=i*s;e.z=r*s}}static multiply(t,e,a){a.x=t.x*e.x;a.y=t.y*e.y;a.z=t.z*e.z}static scale(t,e,a){a.x=t.x*e;a.y=t.y*e;a.z=t.z*e}static lerp(t,e,a,i){var r=t.x,s=t.y,n=t.z;i.x=r+a*(e.x-r);i.y=s+a*(e.y-s);i.z=n+a*(e.z-n)}static transformV3ToV3(t,e,a){var i=St._tempVector4;St.transformV3ToV4(t,e,i);a.x=i.x;a.y=i.y;a.z=i.z}static transformV3ToV4(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=e.elements;a.x=i*n[0]+r*n[4]+s*n[8]+n[12];a.y=i*n[1]+r*n[5]+s*n[9]+n[13];a.z=i*n[2]+r*n[6]+s*n[10]+n[14];a.w=i*n[3]+r*n[7]+s*n[11]+n[15]}static TransformNormal(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=e.elements;a.x=i*n[0]+r*n[4]+s*n[8];a.y=i*n[1]+r*n[5]+s*n[9];a.z=i*n[2]+r*n[6]+s*n[10]}static transformCoordinate(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=e.elements;var o=i*n[3]+r*n[7]+s*n[11]+n[15];a.x=(i*n[0]+r*n[4]+s*n[8]+n[12])/o;a.y=(i*n[1]+r*n[5]+s*n[9]+n[13])/o;a.z=(i*n[2]+r*n[6]+s*n[10]+n[14])/o}static Clamp(t,e,a,i){var r=t.x;var s=t.y;var n=t.z;var o=e.x;var l=e.y;var _=e.z;var h=a.x;var x=a.y;var c=a.z;r=r>h?h:r;r=r<o?o:r;s=s>x?x:s;s=s<l?l:s;n=n>c?c:n;n=n<_?_:n;i.x=r;i.y=s;i.z=n}static add(t,e,a){a.x=t.x+e.x;a.y=t.y+e.y;a.z=t.z+e.z}static subtract(t,e,a){a.x=t.x-e.x;a.y=t.y-e.y;a.z=t.z-e.z}static cross(t,e,a){var i=t.x,r=t.y,s=t.z,n=e.x,o=e.y,l=e.z;a.x=r*l-s*o;a.y=s*n-i*l;a.z=i*o-r*n}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static equals(t,e){return z.nearEqual(t.x,e.x)&&z.nearEqual(t.y,e.y)&&z.nearEqual(t.z,e.z)}setValue(t,e,a){this.x=t;this.y=e;this.z=a}fromArray(t,e=0){this.x=t[e+0];this.y=t[e+1];this.z=t[e+2]}cloneTo(t){var e=t;e.x=this.x;e.y=this.y;e.z=this.z}clone(){var t=new St;this.cloneTo(t);return t}toDefault(){this.x=0;this.y=0;this.z=0}forNativeElement(t=null){if(t){this.elements=t;this.elements[0]=this.x;this.elements[1]=this.y;this.elements[2]=this.z}else{this.elements=new Float32Array([this.x,this.y,this.z])}Ct.rewriteNumProperty(this,"x",0);Ct.rewriteNumProperty(this,"y",1);Ct.rewriteNumProperty(this,"z",2)}}St._tempVector4=new bt;St._ZERO=new St(0,0,0);St._ONE=new St(1,1,1);St._NegativeUnitX=new St(-1,0,0);St._UnitX=new St(1,0,0);St._UnitY=new St(0,1,0);St._UnitZ=new St(0,0,1);St._ForwardRH=new St(0,0,-1);St._ForwardLH=new St(0,0,1);St._Up=new St(0,1,0);(function(t){t[t["High"]=0]="High";t[t["Low"]=1]="Low"})(H.PBRRenderQuality||(H.PBRRenderQuality={}));class T{constructor(){var t=this.elements=new Float32Array(9);t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1}static createRotationQuaternion(t,e){var a=t.x;var i=t.y;var r=t.z;var s=t.w;var n=a*a;var o=i*i;var l=r*r;var _=a*i;var h=r*s;var x=r*a;var c=i*s;var d=i*r;var u=a*s;var f=e.elements;f[0]=1-2*(o+l);f[1]=2*(_+h);f[2]=2*(x-c);f[3]=2*(_-h);f[4]=1-2*(l+n);f[5]=2*(d+u);f[6]=2*(x+c);f[7]=2*(d-u);f[8]=1-2*(o+n)}static createFromTranslation(t,e){var a=e.elements;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=t.x;a[7]=t.y;a[8]=1}static createFromRotation(t,e){var a=e.elements;var i=Math.sin(t),r=Math.cos(t);a[0]=r;a[1]=i;a[2]=0;a[3]=-i;a[4]=r;a[5]=0;a[6]=0;a[7]=0;a[8]=1}static createFromScaling(t,e){var a=e.elements;a[0]=t.x;a[1]=0;a[2]=0;a[3]=0;a[4]=t.y;a[5]=0;a[6]=0;a[7]=0;a[8]=t.z}static createFromMatrix4x4(t,e){var a=t.elements;var i=e.elements;i[0]=a[0];i[1]=a[1];i[2]=a[2];i[3]=a[4];i[4]=a[5];i[5]=a[6];i[6]=a[8];i[7]=a[9];i[8]=a[10]}static multiply(t,e,a){var i=t.elements;var r=e.elements;var s=a.elements;var n=i[0],o=i[1],l=i[2];var _=i[3],h=i[4],x=i[5];var c=i[6],d=i[7],u=i[8];var f=r[0],p=r[1],m=r[2];var g=r[3],v=r[4],y=r[5];var T=r[6],E=r[7],b=r[8];s[0]=f*n+p*_+m*c;s[1]=f*o+p*h+m*E;s[2]=f*l+p*x+m*u;s[3]=g*n+v*_+y*c;s[4]=g*o+v*h+y*d;s[5]=g*l+v*x+y*u;s[6]=T*n+E*_+b*c;s[7]=T*o+E*h+b*d;s[8]=T*l+E*x+b*u}determinant(){var t=this.elements;var e=t[0],a=t[1],i=t[2];var r=t[3],s=t[4],n=t[5];var o=t[6],l=t[7],_=t[8];return e*(_*s-n*l)+a*(-_*r+n*o)+i*(l*r-s*o)}translate(t,e){var a=e.elements;var i=this.elements;var r=i[0],s=i[1],n=i[2];var o=i[3],l=i[4],_=i[5];var h=i[6],x=i[7],c=i[8];var d=t.x,u=t.y;a[0]=r;a[1]=s;a[2]=n;a[3]=o;a[4]=l;a[5]=_;a[6]=d*r+u*o+h;a[7]=d*s+u*l+x;a[8]=d*n+u*_+c}rotate(t,e){var a=e.elements;var i=this.elements;var r=i[0],s=i[1],n=i[2];var o=i[3],l=i[4],_=i[5];var h=i[6],x=i[7],c=i[8];var d=Math.sin(t);var u=Math.cos(t);a[0]=u*r+d*o;a[1]=u*s+d*l;a[2]=u*n+d*_;a[3]=u*o-d*r;a[4]=u*l-d*s;a[5]=u*_-d*n;a[6]=h;a[7]=x;a[8]=c}scale(t,e){var a=e.elements;var i=this.elements;var r=t.x,s=t.y;a[0]=r*i[0];a[1]=r*i[1];a[2]=r*i[2];a[3]=s*i[3];a[4]=s*i[4];a[5]=s*i[5];a[6]=i[6];a[7]=i[7];a[8]=i[8]}invert(t){var e=t.elements;var a=this.elements;var i=a[0],r=a[1],s=a[2];var n=a[3],o=a[4],l=a[5];var _=a[6],h=a[7],x=a[8];var c=x*o-l*h;var d=-x*n+l*_;var u=h*n-o*_;var f=i*c+r*d+s*u;if(!f){t=null}f=1/f;e[0]=c*f;e[1]=(-x*r+s*h)*f;e[2]=(l*r-s*o)*f;e[3]=d*f;e[4]=(x*i-s*_)*f;e[5]=(-l*i+s*n)*f;e[6]=u*f;e[7]=(-h*i+r*_)*f;e[8]=(o*i-r*n)*f}transpose(t){var e=t.elements;var a=this.elements;if(t===this){var i=a[1],r=a[2],s=a[5];e[1]=a[3];e[2]=a[6];e[3]=i;e[5]=a[7];e[6]=r;e[7]=s}else{e[0]=a[0];e[1]=a[3];e[2]=a[6];e[3]=a[1];e[4]=a[4];e[5]=a[7];e[6]=a[2];e[7]=a[5];e[8]=a[8]}}identity(){var t=this.elements;t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1}cloneTo(t){var e,a,i;a=this.elements;i=t.elements;if(a===i){return}for(e=0;e<9;++e){i[e]=a[e]}}clone(){var t=new T;this.cloneTo(t);return t}static lookAt(t,e,a,i){St.subtract(t,e,T._tempV30);St.normalize(T._tempV30,T._tempV30);St.cross(a,T._tempV30,T._tempV31);St.normalize(T._tempV31,T._tempV31);St.cross(T._tempV30,T._tempV31,T._tempV32);var r=T._tempV30;var s=T._tempV31;var n=T._tempV32;var o=i.elements;o[0]=s.x;o[3]=s.y;o[6]=s.z;o[1]=n.x;o[4]=n.y;o[7]=n.z;o[2]=r.x;o[5]=r.y;o[8]=r.z}}T.DEFAULT=new T;T._tempV30=new St;T._tempV31=new St;T._tempV32=new St;class D{}D.Shader3D=null;D.Scene3D=null;D.MeshRenderStaticBatchManager=null;D.MeshRenderDynamicBatchManager=null;D.SubMeshDynamicBatch=null;D.Laya3D=null;D.Matrix4x4=null;D.Physics3D=null;D.ShadowLightType=null;class M{constructor(t=0,e=0,a=0,i=1,r=null){this.x=t;this.y=e;this.z=a;this.w=i}static createFromYawPitchRoll(t,e,a,i){var r=a*.5;var s=e*.5;var n=t*.5;var o=Math.sin(r);var l=Math.cos(r);var _=Math.sin(s);var h=Math.cos(s);var x=Math.sin(n);var c=Math.cos(n);i.x=c*_*l+x*h*o;i.y=x*h*l-c*_*o;i.z=c*h*o-x*_*l;i.w=c*h*l+x*_*o}static multiply(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=t.w;var o=e.x;var l=e.y;var _=e.z;var h=e.w;var x=r*_-s*l;var c=s*o-i*_;var d=i*l-r*o;var u=i*o+r*l+s*_;a.x=i*h+o*n+x;a.y=r*h+l*n+c;a.z=s*h+_*n+d;a.w=n*h-u}static arcTanAngle(t,e){if(t==0){if(e==1)return Math.PI/2;return-Math.PI/2}if(t>0)return Math.atan(e/t);if(t<0){if(e>0)return Math.atan(e/t)+Math.PI;return Math.atan(e/t)-Math.PI}return 0}static angleTo(t,e,a){St.subtract(e,t,M.TEMPVector30);St.normalize(M.TEMPVector30,M.TEMPVector30);a.x=Math.asin(M.TEMPVector30.y);a.y=M.arcTanAngle(-M.TEMPVector30.z,-M.TEMPVector30.x)}static createFromAxisAngle(t,e,a){e=e*.5;var i=Math.sin(e);a.x=i*t.x;a.y=i*t.y;a.z=i*t.z;a.w=Math.cos(e)}static createFromMatrix4x4(t,e){var a=t.elements;var i;var r;var s=a[0]+a[5]+a[10];if(s>0){i=Math.sqrt(s+1);e.w=i*.5;i=.5/i;e.x=(a[6]-a[9])*i;e.y=(a[8]-a[2])*i;e.z=(a[1]-a[4])*i}else if(a[0]>=a[5]&&a[0]>=a[10]){i=Math.sqrt(1+a[0]-a[5]-a[10]);r=.5/i;e.x=.5*i;e.y=(a[1]+a[4])*r;e.z=(a[2]+a[8])*r;e.w=(a[6]-a[9])*r}else if(a[5]>a[10]){i=Math.sqrt(1+a[5]-a[0]-a[10]);r=.5/i;e.x=(a[4]+a[1])*r;e.y=.5*i;e.z=(a[9]+a[6])*r;e.w=(a[8]-a[2])*r}else{i=Math.sqrt(1+a[10]-a[0]-a[5]);r=.5/i;e.x=(a[8]+a[2])*r;e.y=(a[9]+a[6])*r;e.z=.5*i;e.w=(a[1]-a[4])*r}}static slerp(t,e,a,i){var r=t.x,s=t.y,n=t.z,o=t.w,l=e.x,_=e.y,h=e.z,x=e.w;var c,d,u,f,p;d=r*l+s*_+n*h+o*x;if(d<0){d=-d;l=-l;_=-_;h=-h;x=-x}if(1-d>1e-6){c=Math.acos(d);u=Math.sin(c);f=Math.sin((1-a)*c)/u;p=Math.sin(a*c)/u}else{f=1-a;p=a}i.x=f*r+p*l;i.y=f*s+p*_;i.z=f*n+p*h;i.w=f*o+p*x;return i}static lerp(t,e,a,i){var r=1-a;if(M.dot(t,e)>=0){i.x=r*t.x+a*e.x;i.y=r*t.y+a*e.y;i.z=r*t.z+a*e.z;i.w=r*t.w+a*e.w}else{i.x=r*t.x-a*e.x;i.y=r*t.y-a*e.y;i.z=r*t.z-a*e.z;i.w=r*t.w-a*e.w}i.normalize(i)}static add(t,e,a){a.x=t.x+e.x;a.y=t.y+e.y;a.z=t.z+e.z;a.w=t.w+e.w}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}scaling(t,e){e.x=this.x*t;e.y=this.y*t;e.z=this.z*t;e.w=this.w*t}normalize(t){var e=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;if(e>0){e=1/Math.sqrt(e);t.x=this.x*e;t.y=this.y*e;t.z=this.z*e;t.w=this.w*e}}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}rotateX(t,e){t*=.5;var a=Math.sin(t),i=Math.cos(t);e.x=this.x*i+this.w*a;e.y=this.y*i+this.z*a;e.z=this.z*i-this.y*a;e.w=this.w*i-this.x*a}rotateY(t,e){t*=.5;var a=Math.sin(t),i=Math.cos(t);e.x=this.x*i-this.z*a;e.y=this.y*i+this.w*a;e.z=this.z*i+this.x*a;e.w=this.w*i-this.y*a}rotateZ(t,e){t*=.5;var a=Math.sin(t),i=Math.cos(t);e.x=this.x*i+this.y*a;e.y=this.y*i-this.x*a;e.z=this.z*i+this.w*a;e.w=this.w*i-this.z*a}getYawPitchRoll(t){St.transformQuat(St._ForwardRH,this,M.TEMPVector31);St.transformQuat(St._Up,this,M.TEMPVector32);var e=M.TEMPVector32;M.angleTo(St._ZERO,M.TEMPVector31,M.TEMPVector33);var a=M.TEMPVector33;if(a.x==Math.PI/2){a.y=M.arcTanAngle(e.z,e.x);a.z=0}else if(a.x==-Math.PI/2){a.y=M.arcTanAngle(-e.z,-e.x);a.z=0}else{D.Matrix4x4.createRotationY(-a.y,D.Matrix4x4.TEMPMatrix0);D.Matrix4x4.createRotationX(-a.x,D.Matrix4x4.TEMPMatrix1);St.transformCoordinate(M.TEMPVector32,D.Matrix4x4.TEMPMatrix0,M.TEMPVector32);St.transformCoordinate(M.TEMPVector32,D.Matrix4x4.TEMPMatrix1,M.TEMPVector32);a.z=M.arcTanAngle(e.y,-e.x)}if(a.y<=-Math.PI)a.y=Math.PI;if(a.z<=-Math.PI)a.z=Math.PI;if(a.y>=Math.PI&&a.z>=Math.PI){a.y=0;a.z=0;a.x=Math.PI-a.x}var i=t;i.x=a.y;i.y=a.x;i.z=a.z}invert(t){var e=this.x,a=this.y,i=this.z,r=this.w;var s=e*e+a*a+i*i+r*r;var n=s?1/s:0;t.x=-e*n;t.y=-a*n;t.z=-i*n;t.w=r*n}identity(){this.x=0;this.y=0;this.z=0;this.w=1}fromArray(t,e=0){this.x=t[e+0];this.y=t[e+1];this.z=t[e+2];this.w=t[e+3]}cloneTo(t){if(this===t){return}t.x=this.x;t.y=this.y;t.z=this.z;t.w=this.w}clone(){var t=new M;this.cloneTo(t);return t}equals(t){return z.nearEqual(this.x,t.x)&&z.nearEqual(this.y,t.y)&&z.nearEqual(this.z,t.z)&&z.nearEqual(this.w,t.w)}static rotationLookAt(t,e,a){M.lookAt(St._ZERO,t,e,a)}static lookAt(t,e,a,i){T.lookAt(t,e,a,M._tempMatrix3x3);M.rotationMatrix(M._tempMatrix3x3,i)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}static invert(t,e){var a=t.lengthSquared();if(!z.isZero(a)){a=1/a;e.x=-t.x*a;e.y=-t.y*a;e.z=-t.z*a;e.w=t.w*a}}static rotationMatrix(t,e){var a=t.elements;var i=a[0];var r=a[1];var s=a[2];var n=a[3];var o=a[4];var l=a[5];var _=a[6];var h=a[7];var x=a[8];var c,d;var u=i+o+x;if(u>0){c=Math.sqrt(u+1);e.w=c*.5;c=.5/c;e.x=(l-h)*c;e.y=(_-s)*c;e.z=(r-n)*c}else if(i>=o&&i>=x){c=Math.sqrt(1+i-o-x);d=.5/c;e.x=.5*c;e.y=(r+n)*d;e.z=(s+_)*d;e.w=(l-h)*d}else if(o>x){c=Math.sqrt(1+o-i-x);d=.5/c;e.x=(n+r)*d;e.y=.5*c;e.z=(h+l)*d;e.w=(_-s)*d}else{c=Math.sqrt(1+x-i-o);d=.5/c;e.x=(_+s)*d;e.y=(h+l)*d;e.z=.5*c;e.w=(r-n)*d}}forNativeElement(t=null){if(t){this.elements=t;this.elements[0]=this.x;this.elements[1]=this.y;this.elements[2]=this.z;this.elements[3]=this.w}else{this.elements=new Float32Array([this.x,this.y,this.z,this.w])}Ct.rewriteNumProperty(this,"x",0);Ct.rewriteNumProperty(this,"y",1);Ct.rewriteNumProperty(this,"z",2);Ct.rewriteNumProperty(this,"w",3)}}M.TEMPVector30=new St;M.TEMPVector31=new St;M.TEMPVector32=new St;M.TEMPVector33=new St;M._tempMatrix3x3=new T;M.DEFAULT=new M;M.NAN=new M(NaN,NaN,NaN,NaN);class k{constructor(t=1,e=0,a=0,i=0,r=0,s=1,n=0,o=0,l=0,_=0,h=1,x=0,c=0,d=0,u=0,f=1,p=null){var m=p?this.elements=p:this.elements=new Float32Array(16);m[0]=t;m[1]=e;m[2]=a;m[3]=i;m[4]=r;m[5]=s;m[6]=n;m[7]=o;m[8]=l;m[9]=_;m[10]=h;m[11]=x;m[12]=c;m[13]=d;m[14]=u;m[15]=f}static createRotationX(t,e){var a=e.elements;var i=Math.sin(t),r=Math.cos(t);a[1]=a[2]=a[3]=a[4]=a[7]=a[8]=a[11]=a[12]=a[13]=a[14]=0;a[0]=a[15]=1;a[5]=a[10]=r;a[6]=i;a[9]=-i}static createRotationY(t,e){var a=e.elements;var i=Math.sin(t),r=Math.cos(t);a[1]=a[3]=a[4]=a[6]=a[7]=a[9]=a[11]=a[12]=a[13]=a[14]=0;a[5]=a[15]=1;a[0]=a[10]=r;a[2]=-i;a[8]=i}static createRotationZ(t,e){var a=e.elements;var i=Math.sin(t),r=Math.cos(t);a[2]=a[3]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0;a[10]=a[15]=1;a[0]=a[5]=r;a[1]=i;a[4]=-i}static createRotationYawPitchRoll(t,e,a,i){M.createFromYawPitchRoll(t,e,a,k._tempQuaternion);k.createRotationQuaternion(k._tempQuaternion,i)}static createRotationAxis(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=Math.cos(e);var o=Math.sin(e);var l=i*i;var _=r*r;var h=s*s;var x=i*r;var c=i*s;var d=r*s;var u=a.elements;u[3]=u[7]=u[11]=u[12]=u[13]=u[14]=0;u[15]=1;u[0]=l+n*(1-l);u[1]=x-n*x+o*s;u[2]=c-n*c-o*r;u[4]=x-n*x-o*s;u[5]=_+n*(1-_);u[6]=d-n*d+o*i;u[8]=c-n*c+o*r;u[9]=d-n*d-o*i;u[10]=h+n*(1-h)}setRotation(t){var e=t.x;var a=t.y;var i=t.z;var r=t.w;var s=e*e;var n=a*a;var o=i*i;var l=e*a;var _=i*r;var h=i*e;var x=a*r;var c=a*i;var d=e*r;var u=this.elements;u[0]=1-2*(n+o);u[1]=2*(l+_);u[2]=2*(h-x);u[4]=2*(l-_);u[5]=1-2*(o+s);u[6]=2*(c+d);u[8]=2*(h+x);u[9]=2*(c-d);u[10]=1-2*(n+s)}setPosition(t){var e=this.elements;e[12]=t.x;e[13]=t.y;e[14]=t.z}static createRotationQuaternion(t,e){var a=e.elements;var i=t.x;var r=t.y;var s=t.z;var n=t.w;var o=i*i;var l=r*r;var _=s*s;var h=i*r;var x=s*n;var c=s*i;var d=r*n;var u=r*s;var f=i*n;a[3]=a[7]=a[11]=a[12]=a[13]=a[14]=0;a[15]=1;a[0]=1-2*(l+_);a[1]=2*(h+x);a[2]=2*(c-d);a[4]=2*(h-x);a[5]=1-2*(_+o);a[6]=2*(u+f);a[8]=2*(c+d);a[9]=2*(u-f);a[10]=1-2*(l+o)}static createTranslate(t,e){var a=e.elements;a[4]=a[8]=a[1]=a[9]=a[2]=a[6]=a[3]=a[7]=a[11]=0;a[0]=a[5]=a[10]=a[15]=1;a[12]=t.x;a[13]=t.y;a[14]=t.z}static createScaling(t,e){var a=e.elements;a[0]=t.x;a[5]=t.y;a[10]=t.z;a[1]=a[4]=a[8]=a[12]=a[9]=a[13]=a[2]=a[6]=a[14]=a[3]=a[7]=a[11]=0;a[15]=1}static multiply(t,B,F){var e=B.elements;var a=t.elements;var i=F.elements;var r=e[0],s=e[1],n=e[2],o=e[3];var l=e[4],_=e[5],h=e[6],x=e[7];var c=e[8],d=e[9],u=e[10],f=e[11];var p=e[12],m=e[13],g=e[14],v=e[15];var y=a[0],T=a[1],E=a[2],b=a[3];var S=a[4],C=a[5],R=a[6],A=a[7];var L=a[8],I=a[9],M=a[10],D=a[11];var w=a[12],P=a[13],O=a[14],N=a[15];i[0]=r*y+s*S+n*L+o*w;i[1]=r*T+s*C+n*I+o*P;i[2]=r*E+s*R+n*M+o*O;i[3]=r*b+s*A+n*D+o*N;i[4]=l*y+_*S+h*L+x*w;i[5]=l*T+_*C+h*I+x*P;i[6]=l*E+_*R+h*M+x*O;i[7]=l*b+_*A+h*D+x*N;i[8]=c*y+d*S+u*L+f*w;i[9]=c*T+d*C+u*I+f*P;i[10]=c*E+d*R+u*M+f*O;i[11]=c*b+d*A+u*D+f*N;i[12]=p*y+m*S+g*L+v*w;i[13]=p*T+m*C+g*I+v*P;i[14]=p*E+m*R+g*M+v*O;i[15]=p*b+m*A+g*D+v*N}static multiplyForNative(t,e,a){Et.LayaGL.instance.matrix4x4Multiply(t.elements,e.elements,a.elements)}static createFromQuaternion(t,e){var a=e.elements;var i=t.x,r=t.y,s=t.z,n=t.w;var o=i+i;var l=r+r;var _=s+s;var h=i*o;var x=r*o;var c=r*l;var d=s*o;var u=s*l;var f=s*_;var p=n*o;var m=n*l;var g=n*_;a[0]=1-c-f;a[1]=x+g;a[2]=d-m;a[3]=0;a[4]=x-g;a[5]=1-h-f;a[6]=u+p;a[7]=0;a[8]=d+m;a[9]=u-p;a[10]=1-h-c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1}static createAffineTransformation(t,e,a,i){var r=i.elements;var s=e.x,n=e.y,o=e.z,l=e.w,_=s+s,h=n+n,x=o+o;var c=s*_,d=s*h,u=s*x,f=n*h,p=n*x,m=o*x;var g=l*_,v=l*h,y=l*x,T=a.x,E=a.y,b=a.z;r[0]=(1-(f+m))*T;r[1]=(d+y)*T;r[2]=(u-v)*T;r[3]=0;r[4]=(d-y)*E;r[5]=(1-(c+m))*E;r[6]=(p+g)*E;r[7]=0;r[8]=(u+v)*b;r[9]=(p-g)*b;r[10]=(1-(c+f))*b;r[11]=0;r[12]=t.x;r[13]=t.y;r[14]=t.z;r[15]=1}static createLookAt(t,e,a,i){var r=i.elements;var s=k._tempVector0;var n=k._tempVector1;var o=k._tempVector2;St.subtract(t,e,o);St.normalize(o,o);St.cross(a,o,s);St.normalize(s,s);St.cross(o,s,n);r[3]=r[7]=r[11]=0;r[15]=1;r[0]=s.x;r[4]=s.y;r[8]=s.z;r[1]=n.x;r[5]=n.y;r[9]=n.z;r[2]=o.x;r[6]=o.y;r[10]=o.z;r[12]=-St.dot(s,t);r[13]=-St.dot(n,t);r[14]=-St.dot(o,t)}static createPerspective(t,e,a,i,r){var s=1/Math.tan(t*.5);var n=s/e;var o=a/n;var l=a/s;k.createPerspectiveOffCenter(-o,o,-l,l,a,i,r)}static createPerspectiveOffCenter(t,e,a,i,r,s,n){var o=n.elements;var l=s/(s-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[12]=o[13]=o[15]=0;o[0]=2*r/(e-t);o[5]=2*r/(i-a);o[8]=(t+e)/(e-t);o[9]=(i+a)/(i-a);o[10]=-l;o[11]=-1;o[14]=-r*l}static createOrthoOffCenter(t,e,a,i,r,s,n){var o=n.elements;var l=1/(s-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[8]=o[7]=o[9]=o[11]=0;o[15]=1;o[0]=2/(e-t);o[5]=2/(i-a);o[10]=-l;o[12]=(t+e)/(t-e);o[13]=(i+a)/(a-i);o[14]=-r*l}getElementByRowColumn(t,e){if(t<0||t>3)throw new Error("row Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||e>3)throw new Error("column Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[t*4+e]}setElementByRowColumn(t,e,a){if(t<0||t>3)throw new Error("row Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||e>3)throw new Error("column Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[t*4+e]=a}equalsOtherMatrix(t){var e=this.elements;var a=t.elements;return z.nearEqual(e[0],a[0])&&z.nearEqual(e[1],a[1])&&z.nearEqual(e[2],a[2])&&z.nearEqual(e[3],a[3])&&z.nearEqual(e[4],a[4])&&z.nearEqual(e[5],a[5])&&z.nearEqual(e[6],a[6])&&z.nearEqual(e[7],a[7])&&z.nearEqual(e[8],a[8])&&z.nearEqual(e[9],a[9])&&z.nearEqual(e[10],a[10])&&z.nearEqual(e[11],a[11])&&z.nearEqual(e[12],a[12])&&z.nearEqual(e[13],a[13])&&z.nearEqual(e[14],a[14])&&z.nearEqual(e[15],a[15])}decomposeTransRotScale(t,e,a){var i=k._tempMatrix4x4;if(this.decomposeTransRotMatScale(t,i,a)){M.createFromMatrix4x4(i,e);return true}else{e.identity();return false}}decomposeTransRotMatScale(t,e,a){var i=this.elements;var r=t;var s=e.elements;var n=a;r.x=i[12];r.y=i[13];r.z=i[14];var o=i[0],l=i[1],_=i[2];var h=i[4],x=i[5],c=i[6];var d=i[8],u=i[9],f=i[10];var p=n.x=Math.sqrt(o*o+l*l+_*_);var m=n.y=Math.sqrt(h*h+x*x+c*c);var g=n.z=Math.sqrt(d*d+u*u+f*f);if(z.isZero(p)||z.isZero(m)||z.isZero(g)){s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0;s[0]=s[5]=s[10]=s[15]=1;return false}var v=k._tempVector0;v.x=d/g;v.y=u/g;v.z=f/g;var y=k._tempVector1;y.x=o/p;y.y=l/p;y.z=_/p;var T=k._tempVector2;St.cross(v,y,T);var E=k._tempVector1;St.cross(T,v,E);s[3]=s[7]=s[11]=s[12]=s[13]=s[14]=0;s[15]=1;s[0]=E.x;s[1]=E.y;s[2]=E.z;s[4]=T.x;s[5]=T.y;s[6]=T.z;s[8]=v.x;s[9]=v.y;s[10]=v.z;s[0]*o+s[1]*l+s[2]*_<0&&(n.x=-p);s[4]*h+s[5]*x+s[6]*c<0&&(n.y=-m);s[8]*d+s[9]*u+s[10]*f<0&&(n.z=-g);return true}decomposeYawPitchRoll(t){var e=Math.asin(-this.elements[9]);t.y=e;var a=Math.cos(e);if(a>z.zeroTolerance){t.z=Math.atan2(this.elements[1],this.elements[5]);t.x=Math.atan2(this.elements[8],this.elements[10])}else{t.z=Math.atan2(-this.elements[4],this.elements[0]);t.x=0}}normalize(){var t=this.elements;var e=t[0],a=t[1],i=t[2],r=Math.sqrt(e*e+a*a+i*i);if(r){if(r==1)return}else{t[0]=0;t[1]=0;t[2]=0;return}r=1/r;t[0]=e*r;t[1]=a*r;t[2]=i*r}transpose(){var t,e;t=this.elements;e=t[1];t[1]=t[4];t[4]=e;e=t[2];t[2]=t[8];t[8]=e;e=t[3];t[3]=t[12];t[12]=e;e=t[6];t[6]=t[9];t[9]=e;e=t[7];t[7]=t[13];t[13]=e;e=t[11];t[11]=t[14];t[14]=e;return this}invert(t){var e=this.elements;var a=t.elements;var i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],l=e[5],_=e[6],h=e[7],x=e[8],c=e[9],d=e[10],u=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=i*l-r*o,y=i*_-s*o,T=i*h-n*o,E=r*_-s*l,b=r*h-n*l,S=s*h-n*_,C=x*p-c*f,R=x*m-d*f,A=x*g-u*f,L=c*m-d*p,I=c*g-u*p,M=d*g-u*m,D=v*M-y*I+T*L+E*A-b*R+S*C;if(Math.abs(D)===0){return}D=1/D;a[0]=(l*M-_*I+h*L)*D;a[1]=(s*I-r*M-n*L)*D;a[2]=(p*S-m*b+g*E)*D;a[3]=(d*b-c*S-u*E)*D;a[4]=(_*A-o*M-h*R)*D;a[5]=(i*M-s*A+n*R)*D;a[6]=(m*T-f*S-g*y)*D;a[7]=(x*S-d*T+u*y)*D;a[8]=(o*I-l*A+h*C)*D;a[9]=(r*A-i*I-n*C)*D;a[10]=(f*b-p*T+g*v)*D;a[11]=(c*T-x*b-u*v)*D;a[12]=(l*R-o*L-_*C)*D;a[13]=(i*L-r*R+s*C)*D;a[14]=(p*y-f*E-m*v)*D;a[15]=(x*E-c*y+d*v)*D}static billboard(t,e,a,i,r,s){St.subtract(t,e,k._tempVector0);var n=St.scalarLengthSquared(k._tempVector0);if(z.isZero(n)){St.scale(r,-1,k._tempVector1);k._tempVector1.cloneTo(k._tempVector0)}else{St.scale(k._tempVector0,1/Math.sqrt(n),k._tempVector0)}St.cross(i,k._tempVector0,k._tempVector2);St.normalize(k._tempVector2,k._tempVector2);St.cross(k._tempVector0,k._tempVector2,k._tempVector3);var o=k._tempVector2;var l=k._tempVector3;var _=k._tempVector0;var h=t;var x=s.elements;x[0]=o.x;x[1]=o.y;x[2]=o.z;x[3]=0;x[4]=l.x;x[5]=l.y;x[6]=l.z;x[7]=0;x[8]=_.x;x[9]=_.y;x[10]=_.z;x[11]=0;x[12]=h.x;x[13]=h.y;x[14]=h.z;x[15]=1}identity(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0;t[0]=t[5]=t[10]=t[15]=1}cloneTo(t){var e,a,i;a=this.elements;i=t.elements;if(a===i){return}for(e=0;e<16;++e){i[e]=a[e]}}clone(){var t=new k;this.cloneTo(t);return t}static translation(t,e){var a=e.elements;a[0]=a[5]=a[10]=a[15]=1;a[12]=t.x;a[13]=t.y;a[14]=t.z}getTranslationVector(t){var e=this.elements;t.x=e[12];t.y=e[13];t.z=e[14]}setTranslationVector(t){var e=this.elements;var a=t;e[12]=a.x;e[13]=a.y;e[14]=a.z}getForward(t){var e=this.elements;t.x=-e[8];t.y=-e[9];t.z=-e[10]}setForward(t){var e=this.elements;e[8]=-t.x;e[9]=-t.y;e[10]=-t.z}getInvertFront(){this.decomposeTransRotScale(k._tempVector0,k._tempQuaternion,k._tempVector1);var t=k._tempVector1;var e=t.x<0;t.y<0&&(e=!e);t.z<0&&(e=!e);return e}}k._tempMatrix4x4=new k;k.TEMPMatrix0=new k;k.TEMPMatrix1=new k;k._tempVector0=new St;k._tempVector1=new St;k._tempVector2=new St;k._tempVector3=new St;k._tempQuaternion=new M;k.DEFAULT=new k;k.ZERO=new k(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);class o{constructor(){this._scale=new St(1,1,1);this._centerMatrix=new k;this._attatched=false;this._indexInCompound=-1;this._compoundParent=null;this._attatchedCollisionObject=null;this._referenceCount=0;this._localOffset=new St(0,0,0);this._localRotation=new M(0,0,0,1);this.needsCustomCollisionCallback=false}static __init__(){var t=D.Physics3D._bullet;o._btScale=t.btVector3_create(1,1,1);o._btVector30=t.btVector3_create(0,0,0);o._btQuaternion0=t.btQuaternion_create(0,0,0,1);o._btTransform0=t.btTransform_create()}static _createAffineTransformation(t,e,a){var i=e.x,r=e.y,s=e.z,n=e.w,o=i+i,l=r+r,_=s+s;var h=i*o,x=i*l,c=i*_,d=r*l,u=r*_,f=s*_;var p=n*o,m=n*l,g=n*_;a[0]=1-(d+f);a[1]=x+g;a[2]=c-m;a[3]=0;a[4]=x-g;a[5]=1-(h+f);a[6]=u+p;a[7]=0;a[8]=c+m;a[9]=u-p;a[10]=1-(h+d);a[11]=0;a[12]=t.x;a[13]=t.y;a[14]=t.z;a[15]=1}get type(){return this._type}get localOffset(){return this._localOffset}set localOffset(t){this._localOffset=t;if(this._compoundParent)this._compoundParent._updateChildTransform(this)}get localRotation(){return this._localRotation}set localRotation(t){this._localRotation=t;if(this._compoundParent)this._compoundParent._updateChildTransform(this)}_setScale(t){if(this._compoundParent){this.updateLocalTransformations()}else{var e=D.Physics3D._bullet;e.btVector3_setValue(o._btScale,t.x,t.y,t.z);e.btCollisionShape_setLocalScaling(this._btShape,o._btScale)}}_addReference(){this._referenceCount++}_removeReference(){this._referenceCount--}updateLocalTransformations(){if(this._compoundParent){var t=o._tempVector30;St.multiply(this.localOffset,this._scale,t);o._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else{o._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}}cloneTo(t){var e=t;this._localOffset.cloneTo(e.localOffset);this._localRotation.cloneTo(e.localRotation);e.localOffset=e.localOffset;e.localRotation=e.localRotation}clone(){return null}destroy(){if(this._btShape){D.Physics3D._bullet.btCollisionShape_destroy(this._btShape);this._btShape=null}}}o.SHAPEORIENTATION_UPX=0;o.SHAPEORIENTATION_UPY=1;o.SHAPEORIENTATION_UPZ=2;o.SHAPETYPES_BOX=0;o.SHAPETYPES_SPHERE=1;o.SHAPETYPES_CYLINDER=2;o.SHAPETYPES_CAPSULE=3;o.SHAPETYPES_CONVEXHULL=4;o.SHAPETYPES_COMPOUND=5;o.SHAPETYPES_STATICPLANE=6;o.SHAPETYPES_CONE=7;o._tempVector30=new St;class i extends o{constructor(t,e){super();this._normal=t;this._offset=e;this._type=o.SHAPETYPES_STATICPLANE;var a=D.Physics3D._bullet;a.btVector3_setValue(i._btNormal,-t.x,t.y,t.z);this._btShape=a.btStaticPlaneShape_create(i._btNormal,e)}static __init__(){i._btNormal=D.Physics3D._bullet.btVector3_create(0,0,0)}clone(){var t=new i(this._normal,this._offset);this.cloneTo(t);return t}}class E extends o{constructor(){super();this._childColliderShapes=[];this._type=o.SHAPETYPES_COMPOUND;this._btShape=D.Physics3D._bullet.btCompoundShape_create()}static __init__(){var t=D.Physics3D._bullet;E._btVector3One=t.btVector3_create(1,1,1);E._btTransform=t.btTransform_create();E._btOffset=t.btVector3_create(0,0,0);E._btRotation=t.btQuaternion_create(0,0,0,1)}_clearChildShape(t){t._attatched=false;t._compoundParent=null;t._indexInCompound=-1}_addReference(){}_removeReference(){}_updateChildTransform(t){var e=D.Physics3D._bullet;var a=t.localOffset;var i=t.localRotation;var r=o._btVector30;var s=o._btQuaternion0;var n=o._btTransform0;e.btVector3_setValue(r,-a.x,a.y,a.z);e.btQuaternion_setValue(s,-i.x,i.y,i.z,-i.w);e.btTransform_setOrigin(n,r);e.btTransform_setRotation(n,s);e.btCompoundShape_updateChildTransform(this._btShape,t._indexInCompound,n,true)}addChildShape(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=true;t._compoundParent=this;t._indexInCompound=this._childColliderShapes.length;this._childColliderShapes.push(t);var e=t.localOffset;var a=t.localRotation;var i=D.Physics3D._bullet;i.btVector3_setValue(E._btOffset,-e.x,e.y,e.z);i.btQuaternion_setValue(E._btRotation,-a.x,a.y,a.z,-a.w);i.btTransform_setOrigin(E._btTransform,E._btOffset);i.btTransform_setRotation(E._btTransform,E._btRotation);var r=i.btCollisionShape_getLocalScaling(this._btShape);i.btCollisionShape_setLocalScaling(this._btShape,E._btVector3One);i.btCompoundShape_addChildShape(this._btShape,E._btTransform,t._btShape);i.btCollisionShape_setLocalScaling(this._btShape,r);this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}removeChildShape(t){if(t._compoundParent===this){var e=t._indexInCompound;this._clearChildShape(t);var a=this._childColliderShapes[this._childColliderShapes.length-1];a._indexInCompound=e;this._childColliderShapes[e]=a;this._childColliderShapes.pop();D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,e)}}clearChildShape(){for(var t=0,e=this._childColliderShapes.length;t<e;t++){this._clearChildShape(this._childColliderShapes[t]);D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,0)}this._childColliderShapes.length=0}getChildShapeCount(){return this._childColliderShapes.length}cloneTo(t){var e=t;e.clearChildShape();for(var a=0,i=this._childColliderShapes.length;a<i;a++)e.addChildShape(this._childColliderShapes[a].clone())}clone(){var t=new E;this.cloneTo(t);return t}destroy(){super.destroy();for(var t=0,e=this._childColliderShapes.length;t<e;t++){var a=this._childColliderShapes[t];if(a._referenceCount===0)a.destroy()}}}class d extends Et.EventDispatcher{constructor(t){super();this._localPosition=new St(0,0,0);this._localRotation=new M(0,0,0,1);this._localScale=new St(1,1,1);this._localRotationEuler=new St(0,0,0);this._localMatrix=new k;this._position=new St(0,0,0);this._rotation=new M(0,0,0,1);this._scale=new St(1,1,1);this._rotationEuler=new St(0,0,0);this._worldMatrix=new k;this._children=null;this._parent=null;this._dummy=null;this._transformFlag=0;this._owner=t;this._children=[];this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION|d.TRANSFORM_LOCALEULER|d.TRANSFORM_LOCALMATRIX,false);this._setTransformFlag(d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER|d.TRANSFORM_WORLDSCALE|d.TRANSFORM_WORLDMATRIX,true)}get _isFrontFaceInvert(){var t=this.getWorldLossyScale();var e=t.x<0;t.y<0&&(e=!e);t.z<0&&(e=!e);return e}get owner(){return this._owner}get worldNeedUpdate(){return this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)}get localPositionX(){return this._localPosition.x}set localPositionX(t){this._localPosition.x=t;this.localPosition=this._localPosition}get localPositionY(){return this._localPosition.y}set localPositionY(t){this._localPosition.y=t;this.localPosition=this._localPosition}get localPositionZ(){return this._localPosition.z}set localPositionZ(t){this._localPosition.z=t;this.localPosition=this._localPosition}get localPosition(){return this._localPosition}set localPosition(t){if(this._localPosition!==t)t.cloneTo(this._localPosition);this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,true);this._onWorldPositionTransform()}get localRotationX(){return this.localRotation.x}set localRotationX(t){this._localRotation.x=t;this.localRotation=this._localRotation}get localRotationY(){return this.localRotation.y}set localRotationY(t){this._localRotation.y=t;this.localRotation=this._localRotation}get localRotationZ(){return this.localRotation.z}set localRotationZ(t){this._localRotation.z=t;this.localRotation=this._localRotation}get localRotationW(){return this.localRotation.w}set localRotationW(t){this._localRotation.w=t;this.localRotation=this._localRotation}get localRotation(){if(this._getTransformFlag(d.TRANSFORM_LOCALQUATERNION)){var t=this._localRotationEuler;M.createFromYawPitchRoll(t.y/d._angleToRandin,t.x/d._angleToRandin,t.z/d._angleToRandin,this._localRotation);this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION,false)}return this._localRotation}set localRotation(t){if(this._localRotation!==t)t.cloneTo(this._localRotation);this._localRotation.normalize(this._localRotation);this._setTransformFlag(d.TRANSFORM_LOCALEULER|d.TRANSFORM_LOCALMATRIX,true);this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION,false);this._onWorldRotationTransform()}get localScaleX(){return this._localScale.x}set localScaleX(t){this._localScale.x=t;this.localScale=this._localScale}get localScaleY(){return this._localScale.y}set localScaleY(t){this._localScale.y=t;this.localScale=this._localScale}get localScaleZ(){return this._localScale.z}set localScaleZ(t){this._localScale.z=t;this.localScale=this._localScale}get localScale(){return this._localScale}set localScale(t){if(this._localScale!==t)t.cloneTo(this._localScale);this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,true);this._onWorldScaleTransform()}get localRotationEulerX(){return this.localRotationEuler.x}set localRotationEulerX(t){this._localRotationEuler.x=t;this.localRotationEuler=this._localRotationEuler}get localRotationEulerY(){return this.localRotationEuler.y}set localRotationEulerY(t){this._localRotationEuler.y=t;this.localRotationEuler=this._localRotationEuler}get localRotationEulerZ(){return this.localRotationEuler.z}set localRotationEulerZ(t){this._localRotationEuler.z=t;this.localRotationEuler=this._localRotationEuler}get localRotationEuler(){if(this._getTransformFlag(d.TRANSFORM_LOCALEULER)){this._localRotation.getYawPitchRoll(d._tempVector30);var t=d._tempVector30;var e=this._localRotationEuler;e.x=t.y*d._angleToRandin;e.y=t.x*d._angleToRandin;e.z=t.z*d._angleToRandin;this._setTransformFlag(d.TRANSFORM_LOCALEULER,false)}return this._localRotationEuler}set localRotationEuler(t){if(this._localRotationEuler!==t)t.cloneTo(this._localRotationEuler);this._setTransformFlag(d.TRANSFORM_LOCALEULER,false);this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION|d.TRANSFORM_LOCALMATRIX,true);this._onWorldRotationTransform()}get localMatrix(){if(this._getTransformFlag(d.TRANSFORM_LOCALMATRIX)){k.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,false)}return this._localMatrix}set localMatrix(t){if(this._localMatrix!==t)t.cloneTo(this._localMatrix);this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale);this._setTransformFlag(d.TRANSFORM_LOCALEULER,true);this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,false);this._onWorldTransform()}get position(){if(this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)){if(this._parent!=null){var t=this.worldMatrix.elements;this._position.x=t[12];this._position.y=t[13];this._position.z=t[14]}else{this._localPosition.cloneTo(this._position)}this._setTransformFlag(d.TRANSFORM_WORLDPOSITION,false)}return this._position}set position(t){if(this._parent!=null){var e=d._tempMatrix0;this._parent.worldMatrix.invert(e);St.transformCoordinate(t,e,this._localPosition)}else{t.cloneTo(this._localPosition)}this.localPosition=this._localPosition;if(this._position!==t)t.cloneTo(this._position);this._setTransformFlag(d.TRANSFORM_WORLDPOSITION,false)}get rotation(){if(this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)){if(this._parent!=null)M.multiply(this._parent.rotation,this.localRotation,this._rotation);else this.localRotation.cloneTo(this._rotation);this._setTransformFlag(d.TRANSFORM_WORLDQUATERNION,false)}return this._rotation}set rotation(t){if(this._parent!=null){this._parent.rotation.invert(d._tempQuaternion0);M.multiply(d._tempQuaternion0,t,this._localRotation)}else{t.cloneTo(this._localRotation)}this.localRotation=this._localRotation;if(t!==this._rotation)t.cloneTo(this._rotation);this._setTransformFlag(d.TRANSFORM_WORLDQUATERNION,false)}get rotationEuler(){if(this._getTransformFlag(d.TRANSFORM_WORLDEULER)){this.rotation.getYawPitchRoll(d._tempVector30);var t=d._tempVector30;var e=this._rotationEuler;e.x=t.y*d._angleToRandin;e.y=t.x*d._angleToRandin;e.z=t.z*d._angleToRandin;this._setTransformFlag(d.TRANSFORM_WORLDEULER,false)}return this._rotationEuler}set rotationEuler(t){M.createFromYawPitchRoll(t.y/d._angleToRandin,t.x/d._angleToRandin,t.z/d._angleToRandin,this._rotation);this.rotation=this._rotation;if(this._rotationEuler!==t)t.cloneTo(this._rotationEuler);this._setTransformFlag(d.TRANSFORM_WORLDEULER,false)}get worldMatrix(){if(this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)){if(this._parent!=null)k.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix);else this.localMatrix.cloneTo(this._worldMatrix);this._setTransformFlag(d.TRANSFORM_WORLDMATRIX,false)}return this._worldMatrix}set worldMatrix(t){if(this._parent===null){t.cloneTo(this._localMatrix)}else{this._parent.worldMatrix.invert(this._localMatrix);k.multiply(this._localMatrix,t,this._localMatrix)}this.localMatrix=this._localMatrix;if(this._worldMatrix!==t)t.cloneTo(this._worldMatrix);this._setTransformFlag(d.TRANSFORM_WORLDMATRIX,false)}_getScaleMatrix(){var t=d._tempQuaternion0;var e=d._tempMatrix3x30;var a=d._tempMatrix3x31;var i=d._tempMatrix3x32;T.createFromMatrix4x4(this.worldMatrix,a);this.rotation.invert(t);T.createRotationQuaternion(t,e);T.multiply(e,a,i);return i}_setTransformFlag(t,e){if(e)this._transformFlag|=t;else this._transformFlag&=~t}_getTransformFlag(t){return(this._transformFlag&t)!=0}_setParent(t){if(this._parent!==t){if(this._parent){var e=this._parent._children;var a=e.indexOf(this);e.splice(a,1)}if(t){t._children.push(this);t&&this._onWorldTransform()}this._parent=t}}_onWorldPositionRotationTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)||!this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)||!this._getTransformFlag(d.TRANSFORM_WORLDEULER)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER,true);this.event(Et.Event.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionRotationTransform()}}_onWorldPositionScaleTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)||!this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDSCALE,true);this.event(Et.Event.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionScaleTransform()}}_onWorldPositionTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION,true);this.event(Et.Event.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionTransform()}}_onWorldRotationTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)||!this._getTransformFlag(d.TRANSFORM_WORLDEULER)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER,true);this.event(Et.Event.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionRotationTransform()}}_onWorldScaleTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDSCALE,true);this.event(Et.Event.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionScaleTransform()}}_onWorldTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)||!this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)||!this._getTransformFlag(d.TRANSFORM_WORLDEULER)||!this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER|d.TRANSFORM_WORLDSCALE,true);this.event(Et.Event.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldTransform()}}translate(t,e=true){if(e){k.createFromQuaternion(this.localRotation,d._tempMatrix0);St.transformCoordinate(t,d._tempMatrix0,d._tempVector30);St.add(this.localPosition,d._tempVector30,this._localPosition);this.localPosition=this._localPosition}else{St.add(this.position,t,this._position);this.position=this._position}}rotate(t,e=true,a=true){var i;if(a){i=t}else{St.scale(t,Math.PI/180,d._tempVector30);i=d._tempVector30}M.createFromYawPitchRoll(i.y,i.x,i.z,d._tempQuaternion0);if(e){M.multiply(this._localRotation,d._tempQuaternion0,this._localRotation);this.localRotation=this._localRotation}else{M.multiply(d._tempQuaternion0,this.rotation,this._rotation);this.rotation=this._rotation}}getForward(t){var e=this.worldMatrix.elements;t.x=-e[8];t.y=-e[9];t.z=-e[10]}getUp(t){var e=this.worldMatrix.elements;t.x=e[4];t.y=e[5];t.z=e[6]}getRight(t){var e=this.worldMatrix.elements;t.x=e[0];t.y=e[1];t.z=e[2]}lookAt(t,e,a=false){var i;if(a){i=this._localPosition;if(Math.abs(i.x-t.x)<z.zeroTolerance&&Math.abs(i.y-t.y)<z.zeroTolerance&&Math.abs(i.z-t.z)<z.zeroTolerance)return;M.lookAt(this._localPosition,t,e,this._localRotation);this._localRotation.invert(this._localRotation);this.localRotation=this._localRotation}else{var r=this.position;i=r;if(Math.abs(i.x-t.x)<z.zeroTolerance&&Math.abs(i.y-t.y)<z.zeroTolerance&&Math.abs(i.z-t.z)<z.zeroTolerance)return;M.lookAt(r,t,e,this._rotation);this._rotation.invert(this._rotation);this.rotation=this._rotation}}getWorldLossyScale(){if(this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){if(this._parent!==null){var t=this._getScaleMatrix().elements;this._scale.x=t[0];this._scale.y=t[4];this._scale.z=t[8]}else{this._localScale.cloneTo(this._scale)}this._setTransformFlag(d.TRANSFORM_WORLDSCALE,false)}return this._scale}setWorldLossyScale(t){if(this._parent!==null){var e=d._tempMatrix3x33;var a=d._tempMatrix3x33;var i=a.elements;var r=this._parent._getScaleMatrix();r.invert(r);T.createFromScaling(t,e);T.multiply(r,e,a);this._localScale.x=i[0];this._localScale.y=i[4];this._localScale.z=i[8]}else{t.cloneTo(this._localScale)}this.localScale=this._localScale;if(this._scale!==t)t.cloneTo(this._scale);this._setTransformFlag(d.TRANSFORM_WORLDSCALE,false)}get scale(){console.warn("Transfrm3D: discard function,please use getWorldLossyScale instead.");return this.getWorldLossyScale()}set scale(t){console.warn("Transfrm3D: discard function,please use setWorldLossyScale instead.");this.setWorldLossyScale(t)}}d._tempVector30=new St;d._tempQuaternion0=new M;d._tempMatrix0=new k;d._tempMatrix3x30=new T;d._tempMatrix3x31=new T;d._tempMatrix3x32=new T;d._tempMatrix3x33=new T;d.TRANSFORM_LOCALQUATERNION=1;d.TRANSFORM_LOCALEULER=2;d.TRANSFORM_LOCALMATRIX=4;d.TRANSFORM_WORLDPOSITION=8;d.TRANSFORM_WORLDQUATERNION=16;d.TRANSFORM_WORLDSCALE=32;d.TRANSFORM_WORLDMATRIX=64;d.TRANSFORM_WORLDEULER=128;d._angleToRandin=180/Math.PI;class B{constructor(){}static setColliderCollision(t,e,a){}static getIColliderCollision(t,e){return false}}B.COLLISIONFILTERGROUP_DEFAULTFILTER=1;B.COLLISIONFILTERGROUP_STATICFILTER=2;B.COLLISIONFILTERGROUP_KINEMATICFILTER=4;B.COLLISIONFILTERGROUP_DEBRISFILTER=8;B.COLLISIONFILTERGROUP_SENSORTRIGGER=16;B.COLLISIONFILTERGROUP_CHARACTERFILTER=32;B.COLLISIONFILTERGROUP_CUSTOMFILTER1=64;B.COLLISIONFILTERGROUP_CUSTOMFILTER2=128;B.COLLISIONFILTERGROUP_CUSTOMFILTER3=256;B.COLLISIONFILTERGROUP_CUSTOMFILTER4=512;B.COLLISIONFILTERGROUP_CUSTOMFILTER5=1024;B.COLLISIONFILTERGROUP_CUSTOMFILTER6=2048;B.COLLISIONFILTERGROUP_CUSTOMFILTER7=4096;B.COLLISIONFILTERGROUP_CUSTOMFILTER8=8192;B.COLLISIONFILTERGROUP_CUSTOMFILTER9=16384;B.COLLISIONFILTERGROUP_CUSTOMFILTER10=32768;B.COLLISIONFILTERGROUP_ALLFILTER=-1;B.gravity=new St(0,-9.81,0);class b extends o{constructor(t=1,e=1,a=1){super();this._sizeX=t;this._sizeY=e;this._sizeZ=a;this._type=o.SHAPETYPES_BOX;var i=D.Physics3D._bullet;i.btVector3_setValue(b._btSize,t/2,e/2,a/2);this._btShape=i.btBoxShape_create(b._btSize)}static __init__(){b._btSize=D.Physics3D._bullet.btVector3_create(0,0,0)}get sizeX(){return this._sizeX}get sizeY(){return this._sizeY}get sizeZ(){return this._sizeZ}clone(){var t=new b(this._sizeX,this._sizeY,this._sizeZ);this.cloneTo(t);return t}}class S extends o{constructor(t=.5,e=1.25,a=o.SHAPEORIENTATION_UPY){super();this._radius=t;this._length=e;this._orientation=a;this._type=o.SHAPETYPES_CAPSULE;var i=D.Physics3D._bullet;switch(a){case o.SHAPEORIENTATION_UPX:this._btShape=i.btCapsuleShapeX_create(t,e-t*2);break;case o.SHAPEORIENTATION_UPY:this._btShape=i.btCapsuleShape_create(t,e-t*2);break;case o.SHAPEORIENTATION_UPZ:this._btShape=i.btCapsuleShapeZ_create(t,e-t*2);break;default:throw"CapsuleColliderShape:unknown orientation."}}get radius(){return this._radius}get length(){return this._length}get orientation(){return this._orientation}_setScale(t){var e=S._tempVector30;switch(this.orientation){case o.SHAPEORIENTATION_UPX:e.x=t.x;e.y=e.z=Math.max(t.y,t.z);break;case o.SHAPEORIENTATION_UPY:e.y=t.y;e.x=e.z=Math.max(t.x,t.z);break;case o.SHAPEORIENTATION_UPZ:e.z=t.z;e.x=e.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}super._setScale(e)}clone(){var t=new S(this._radius,this._length,this._orientation);this.cloneTo(t);return t}}S._tempVector30=new St;class C extends o{constructor(t=.5,e=1,a=o.SHAPEORIENTATION_UPY){super();this._radius=1;this._height=.5;this._radius=t;this._height=e;this._orientation=a;this._type=o.SHAPETYPES_CYLINDER;var i=D.Physics3D._bullet;switch(a){case o.SHAPEORIENTATION_UPX:this._btShape=i.btConeShapeX_create(t,e);break;case o.SHAPEORIENTATION_UPY:this._btShape=i.btConeShape_create(t,e);break;case o.SHAPEORIENTATION_UPZ:this._btShape=i.btConeShapeZ_create(t,e);break;default:throw"ConeColliderShape:unknown orientation."}}get radius(){return this._radius}get height(){return this._height}get orientation(){return this._orientation}clone(){var t=new C(this._radius,this._height,this._orientation);this.cloneTo(t);return t}}class A extends o{constructor(t=.5,e=1,a=o.SHAPEORIENTATION_UPY){super();this._radius=1;this._height=.5;this._radius=t;this._height=e;this._orientation=a;this._type=o.SHAPETYPES_CYLINDER;var i=D.Physics3D._bullet;switch(a){case o.SHAPEORIENTATION_UPX:i.btVector3_setValue(A._btSize,e/2,t,t);this._btShape=i.btCylinderShapeX_create(A._btSize);break;case o.SHAPEORIENTATION_UPY:i.btVector3_setValue(A._btSize,t,e/2,t);this._btShape=i.btCylinderShape_create(A._btSize);break;case o.SHAPEORIENTATION_UPZ:i.btVector3_setValue(A._btSize,t,t,e/2);this._btShape=i.btCylinderShapeZ_create(A._btSize);break;default:throw"CapsuleColliderShape:unknown orientation."}}static __init__(){A._btSize=D.Physics3D._bullet.btVector3_create(0,0,0)}get radius(){return this._radius}get height(){return this._height}get orientation(){return this._orientation}clone(){var t=new A(this._radius,this._height,this._orientation);this.cloneTo(t);return t}}class L extends o{constructor(){super();this._mesh=null;this._convex=false}get mesh(){return this._mesh}set mesh(t){if(this._mesh!==t){var e=D.Physics3D._bullet;if(this._mesh){e.btCollisionShape_destroy(this._btShape)}if(t){this._btShape=e.btGImpactMeshShape_create(t._getPhysicMesh());e.btGImpactShapeInterface_updateBound(this._btShape)}this._mesh=t}}get convex(){return this._convex}set convex(t){this._convex=t}_setScale(t){if(this._compoundParent){this.updateLocalTransformations()}else{var e=D.Physics3D._bullet;e.btVector3_setValue(o._btScale,t.x,t.y,t.z);e.btCollisionShape_setLocalScaling(this._btShape,o._btScale);e.btGImpactShapeInterface_updateBound(this._btShape)}}cloneTo(t){var e=t;e.convex=this._convex;e.mesh=this._mesh;super.cloneTo(t)}clone(){var t=new L;this.cloneTo(t);return t}destroy(){if(this._btShape){D.Physics3D._bullet.btCollisionShape_destroy(this._btShape);this._btShape=null}}}class V extends o{constructor(t=.5){super();this._radius=t;this._type=o.SHAPETYPES_SPHERE;this._btShape=D.Physics3D._bullet.btSphereShape_create(t)}get radius(){return this._radius}clone(){var t=new V(this._radius);this.cloneTo(t);return t}}class I extends Et.Component{constructor(t,e){super();this._restitution=0;this._friction=.5;this._rollingFriction=0;this._ccdMotionThreshold=0;this._ccdSweptSphereRadius=0;this._collisionGroup=B.COLLISIONFILTERGROUP_DEFAULTFILTER;this._canCollideWith=B.COLLISIONFILTERGROUP_ALLFILTER;this._colliderShape=null;this._transformFlag=2147483647;this._controlBySimulation=false;this._enableProcessCollisions=true;this._inPhysicUpdateListIndex=-1;this.canScaleShape=true;this._collisionGroup=t;this._canCollideWith=e;I._physicObjectsMap[this.id]=this}static __init__(){var t=D.Physics3D._bullet;I._btVector30=t.btVector3_create(0,0,0);I._btQuaternion0=t.btQuaternion_create(0,0,0,1)}static _createAffineTransformationArray(t,e,a,i,r,s,n,o,l){var _=i+i,h=r+r,x=s+s;var c=i*_,d=i*h,u=i*x,f=r*h,p=r*x,m=s*x;var g=n*_,v=n*h,y=n*x,T=o[0],E=o[1],b=o[2];l[0]=(1-(f+m))*T;l[1]=(d+y)*T;l[2]=(u-v)*T;l[3]=0;l[4]=(d-y)*E;l[5]=(1-(c+m))*E;l[6]=(p+g)*E;l[7]=0;l[8]=(u+v)*b;l[9]=(p-g)*b;l[10]=(1-(c+f))*b;l[11]=0;l[12]=t;l[13]=e;l[14]=a;l[15]=1}static _creatShape(t){var e;switch(t.type){case"BoxColliderShape":var a=t.size;e=a?new b(a[0],a[1],a[2]):new b;break;case"SphereColliderShape":e=new V(t.radius);break;case"CapsuleColliderShape":e=new S(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var i=new L;t.mesh&&(i.mesh=Et.Loader.getRes(t.mesh));e=i;break;case"ConeColliderShape":e=new C(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":e=new A(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var r=e.localOffset;r.fromArray(t.center);e.localOffset=r}return e}static physicVector3TransformQuat(t,e,a,i,r,s){var n=t.x,o=t.y,l=t.z,_=r*n+a*l-i*o,h=r*o+i*n-e*l,x=r*l+e*o-a*n,c=-e*n-a*o-i*l;s.x=_*r+c*-e+h*-i-x*-a;s.y=h*r+c*-a+x*-e-_*-i;s.z=x*r+c*-i+_*-a-h*-e}static physicQuaternionMultiply(t,e,a,i,r,s){var n=r.x;var o=r.y;var l=r.z;var _=r.w;var h=e*l-a*o;var x=a*n-t*l;var c=t*o-e*n;var d=t*n+e*o+a*l;s.x=t*_+n*i+h;s.y=e*_+o*i+x;s.z=a*_+l*i+c;s.w=i*_-d}get restitution(){return this._restitution}set restitution(t){this._restitution=t;this._btColliderObject&&D.Physics3D._bullet.btCollisionObject_setRestitution(this._btColliderObject,t)}get friction(){return this._friction}set friction(t){this._friction=t;this._btColliderObject&&D.Physics3D._bullet.btCollisionObject_setFriction(this._btColliderObject,t)}get rollingFriction(){return this._rollingFriction}set rollingFriction(t){this._rollingFriction=t;this._btColliderObject&&D.Physics3D._bullet.btCollisionObject_setRollingFriction(this._btColliderObject,t)}get ccdMotionThreshold(){return this._ccdMotionThreshold}set ccdMotionThreshold(t){this._ccdMotionThreshold=t;this._btColliderObject&&D.Physics3D._bullet.btCollisionObject_setCcdMotionThreshold(this._btColliderObject,t)}get ccdSweptSphereRadius(){return this._ccdSweptSphereRadius}set ccdSweptSphereRadius(t){this._ccdSweptSphereRadius=t;this._btColliderObject&&D.Physics3D._bullet.btCollisionObject_setCcdSweptSphereRadius(this._btColliderObject,t)}get isActive(){return this._btColliderObject?D.Physics3D._bullet.btCollisionObject_isActive(this._btColliderObject):false}get colliderShape(){return this._colliderShape}set colliderShape(t){var e=this._colliderShape;if(e){e._attatched=false;e._attatchedCollisionObject=null}this._colliderShape=t;if(t){if(t._attatched){throw"PhysicsComponent: this shape has attatched to other entity."}else{t._attatched=true;t._attatchedCollisionObject=this}if(this._btColliderObject){D.Physics3D._bullet.btCollisionObject_setCollisionShape(this._btColliderObject,t._btShape);var a=this._simulation&&this._enabled;a&&e&&this._removeFromSimulation();this._onShapeChange(t);if(a){this._derivePhysicsTransformation(true);this._addToSimulation()}}}else{if(this._simulation&&this._enabled)e&&this._removeFromSimulation()}}get simulation(){return this._simulation}get collisionGroup(){return this._collisionGroup}set collisionGroup(t){if(this._collisionGroup!==t){this._collisionGroup=t;if(this._simulation&&this._colliderShape&&this._enabled){this._removeFromSimulation();this._addToSimulation()}}}get canCollideWith(){return this._canCollideWith}set canCollideWith(t){if(this._canCollideWith!==t){this._canCollideWith=t;if(this._simulation&&this._colliderShape&&this._enabled){this._removeFromSimulation();this._addToSimulation()}}}_parseShape(t){var e=t.length;if(e===1){var a=I._creatShape(t[0]);this.colliderShape=a}else{var i=new E;for(var r=0;r<e;r++){a=I._creatShape(t[r]);i.addChildShape(a)}this.colliderShape=i}}_onScaleChange(t){this._colliderShape._setScale(t)}_onEnable(){this._simulation=this.owner._scene.physicsSimulation;D.Physics3D._bullet.btCollisionObject_setContactProcessingThreshold(this._btColliderObject,1e30);if(this._colliderShape){this._derivePhysicsTransformation(true);this._addToSimulation()}}_onDisable(){if(this._colliderShape){this._removeFromSimulation();this._inPhysicUpdateListIndex!==-1&&this._simulation._physicsUpdateList.remove(this)}this._simulation=null}_onDestroy(){delete I._physicObjectsMap[this.id];D.Physics3D._bullet.btCollisionObject_destroy(this._btColliderObject);this._colliderShape.destroy();super._onDestroy();this._btColliderObject=null;this._colliderShape=null;this._simulation=null;this.owner.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}_isValid(){return this._simulation&&this._colliderShape&&this._enabled}_parse(t){t.collisionGroup!=null&&(this.collisionGroup=t.collisionGroup);t.canCollideWith!=null&&(this.canCollideWith=t.canCollideWith);t.ccdMotionThreshold!=null&&(this.ccdMotionThreshold=t.ccdMotionThreshold);t.ccdSweptSphereRadius!=null&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)}_setTransformFlag(t,e){if(e)this._transformFlag|=t;else this._transformFlag&=~t}_getTransformFlag(t){return(this._transformFlag&t)!=0}_addToSimulation(){}_removeFromSimulation(){}_derivePhysicsTransformation(t){var e=D.Physics3D._bullet;var a=this._btColliderObject;var i=e.btCollisionObject_getWorldTransform(a);this._innerDerivePhysicsTransformation(i,t);e.btCollisionObject_setWorldTransform(a,i)}_innerDerivePhysicsTransformation(t,e){var a=D.Physics3D._bullet;var i=this.owner._transform;if(e||this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)){var r=this._colliderShape.localOffset;var s=i.position;var n=I._btVector30;if(r.x!==0||r.y!==0||r.z!==0){var o=I._tempVector30;var l=i.worldMatrix;St.transformCoordinate(r,l,o);a.btVector3_setValue(n,-o.x,o.y,o.z)}else{a.btVector3_setValue(n,-s.x,s.y,s.z)}a.btTransform_setOrigin(t,n);this._setTransformFlag(d.TRANSFORM_WORLDPOSITION,false)}if(e||this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)){var _=this._colliderShape.localRotation;var h=I._btQuaternion0;var x=i.rotation;if(_.x!==0||_.y!==0||_.z!==0||_.w!==1){var c=I._tempQuaternion0;I.physicQuaternionMultiply(x.x,x.y,x.z,x.w,_,c);a.btQuaternion_setValue(h,-c.x,c.y,c.z,-c.w)}else{a.btQuaternion_setValue(h,-x.x,x.y,x.z,-x.w)}a.btTransform_setRotation(t,h);this._setTransformFlag(d.TRANSFORM_WORLDQUATERNION,false)}if(e||this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){this._onScaleChange(i.getWorldLossyScale());this._setTransformFlag(d.TRANSFORM_WORLDSCALE,false)}}_updateTransformComponent(t){var e=D.Physics3D._bullet;var a=this._colliderShape;var i=a.localOffset;var r=a.localRotation;var s=this.owner._transform;var n=s.position;var o=s.rotation;var l=e.btTransform_getOrigin(t);var _=e.btTransform_getRotation(t);var h=-e.btQuaternion_x(_);var x=e.btQuaternion_y(_);var c=e.btQuaternion_z(_);var d=-e.btQuaternion_w(_);if(r.x!==0||r.y!==0||r.z!==0||r.w!==1){var u=I._tempQuaternion0;r.invert(u);I.physicQuaternionMultiply(h,x,c,d,u,o)}else{o.x=h;o.y=x;o.z=c;o.w=d}s.rotation=o;if(i.x!==0||i.y!==0||i.z!==0){var f=e.btCollisionShape_getLocalScaling(a._btShape);var p=I._tempVector30;p.x=i.x*e.btVector3_x(f);p.y=i.y*e.btVector3_y(f);p.z=i.z*e.btVector3_z(f);St.transformQuat(p,o,p);n.x=-e.btVector3_x(l)-p.x;n.y=e.btVector3_y(l)-p.y;n.z=e.btVector3_z(l)-p.z}else{n.x=-e.btVector3_x(l);n.y=e.btVector3_y(l);n.z=e.btVector3_z(l)}s.position=n}_onShapeChange(t){var e=this._btColliderObject;var a=D.Physics3D._bullet;var i=a.btCollisionObject_getCollisionFlags(e);if(t.needsCustomCollisionCallback){if((i&I.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)===0)a.btCollisionObject_setCollisionFlags(e,i|I.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}else{if((i&I.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)>0)a.btCollisionObject_setCollisionFlags(e,i^I.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}}_onAdded(){this.enabled=this._enabled;this.restitution=this._restitution;this.friction=this._friction;this.rollingFriction=this._rollingFriction;this.ccdMotionThreshold=this._ccdMotionThreshold;this.ccdSweptSphereRadius=this._ccdSweptSphereRadius;this.owner.transform.on(Et.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}_onTransformChanged(t){if(I._addUpdateList||!this._controlBySimulation){t&=d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDSCALE;if(t){this._transformFlag|=t;if(this._isValid()&&this._inPhysicUpdateListIndex===-1)this._simulation._physicsUpdateList.add(this)}}}_cloneTo(t){var e=t;e.restitution=this._restitution;e.friction=this._friction;e.rollingFriction=this._rollingFriction;e.ccdMotionThreshold=this._ccdMotionThreshold;e.ccdSweptSphereRadius=this._ccdSweptSphereRadius;e.collisionGroup=this._collisionGroup;e.canCollideWith=this._canCollideWith;e.canScaleShape=this.canScaleShape;this._colliderShape&&(e.colliderShape=this._colliderShape.clone())}}I.ACTIVATIONSTATE_ACTIVE_TAG=1;I.ACTIVATIONSTATE_ISLAND_SLEEPING=2;I.ACTIVATIONSTATE_WANTS_DEACTIVATION=3;I.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4;I.ACTIVATIONSTATE_DISABLE_SIMULATION=5;I.COLLISIONFLAGS_STATIC_OBJECT=1;I.COLLISIONFLAGS_KINEMATIC_OBJECT=2;I.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4;I.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8;I.COLLISIONFLAGS_CHARACTER_OBJECT=16;I.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32;I.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64;I._tempVector30=new St;I._tempQuaternion0=new M;I._tempQuaternion1=new M;I._tempMatrix4x40=new k;I._physicObjectsMap={};I._addUpdateList=true;class e{constructor(){this.elements=[];this.length=0}_add(t){if(this.length===this.elements.length)this.elements.push(t);else this.elements[this.length]=t}add(t){if(this.length===this.elements.length)this.elements.push(t);else this.elements[this.length]=t;this.length++}}class U extends e{constructor(){super()}add(t){var e=t._inPhysicUpdateListIndex;if(e!==-1)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t);t._inPhysicUpdateListIndex=this.length++}remove(t){var e=t._inPhysicUpdateListIndex;this.length--;if(e!==this.length){var a=this.elements[this.length];this.elements[e]=a;a._inPhysicUpdateListIndex=e}t._inPhysicUpdateListIndex=-1}}class a{constructor(){this._idCounter=0;this.colliderA=null;this.colliderB=null;this.distance=0;this.normal=new St;this.positionOnA=new St;this.positionOnB=new St;this._id=++this._idCounter}}class r{constructor(){this.succeeded=false;this.collider=null;this.point=new St;this.normal=new St;this.hitFraction=0}}class Y{constructor(){this._lastUpdateFrame=-2147483648;this._updateFrame=-2147483648;this._isTrigger=false;this.contacts=[]}_setUpdateFrame(t){this._lastUpdateFrame=this._updateFrame;this._updateFrame=t}}class j{constructor(){this._hitResultsPoolIndex=0;this._hitResultsPool=[];this._contactPonintsPoolIndex=0;this._contactPointsPool=[];this._collisionsPool=[];this._collisions={}}getHitResult(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];if(!t){t=new r;this._hitResultsPool.push(t)}return t}recoverAllHitResultsPool(){this._hitResultsPoolIndex=0}getContactPoints(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];if(!t){t=new a;this._contactPointsPool.push(t)}return t}recoverAllContactPointsPool(){this._contactPonintsPoolIndex=0}getCollision(t,e){var a;var i=t.id;var r=e.id;var s=this._collisions[i];if(s)a=s[r];if(!a){if(!s){s={};this._collisions[i]=s}a=this._collisionsPool.length===0?new Y:this._collisionsPool.pop();a._colliderA=t;a._colliderB=e;s[r]=a}return a}recoverCollision(t){var e=t._colliderA.id;var a=t._colliderB.id;this._collisions[e][a]=null;this._collisionsPool.push(t)}garbageCollection(){this._hitResultsPoolIndex=0;this._hitResultsPool.length=0;this._contactPonintsPoolIndex=0;this._contactPointsPool.length=0;this._collisionsPool.length=0;for(var t in this._collisionsPool){var e=this._collisionsPool[t];var a=true;for(var i in e){if(e[i])a=false;else delete e[i]}if(a)delete this._collisionsPool[t]}}}class w{constructor(t,e=0){this._gravity=new St(0,-10,0);this._btVector3Zero=D.Physics3D._bullet.btVector3_create(0,0,0);this._btDefaultQuaternion=D.Physics3D._bullet.btQuaternion_create(0,0,0,-1);this._collisionsUtils=new j;this._previousFrameCollisions=[];this._currentFrameCollisions=[];this._currentConstraint={};this._physicsUpdateList=new U;this._characters=[];this._updatedRigidbodies=0;this.maxSubSteps=1;this.fixedTimeStep=1/60;this.maxSubSteps=t.maxSubSteps;this.fixedTimeStep=t.fixedTimeStep;var a=D.Physics3D._bullet;this._btCollisionConfiguration=a.btDefaultCollisionConfiguration_create();this._btDispatcher=a.btCollisionDispatcher_create(this._btCollisionConfiguration);this._btBroadphase=a.btDbvtBroadphase_create();a.btOverlappingPairCache_setInternalGhostPairCallback(a.btDbvtBroadphase_getOverlappingPairCache(this._btBroadphase),a.btGhostPairCallback_create());var i=t.flags;if(i&w.PHYSICSENGINEFLAGS_COLLISIONSONLY){this._btCollisionWorld=new a.btCollisionWorld(this._btDispatcher,this._btBroadphase,this._btCollisionConfiguration)}else if(i&w.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT){throw"PhysicsSimulation:SoftBody processing is not yet available"}else{var r=a.btSequentialImpulseConstraintSolver_create();this._btDiscreteDynamicsWorld=a.btDiscreteDynamicsWorld_create(this._btDispatcher,this._btBroadphase,r,this._btCollisionConfiguration);this._btCollisionWorld=this._btDiscreteDynamicsWorld}if(this._btDiscreteDynamicsWorld){this._btSolverInfo=a.btDynamicsWorld_getSolverInfo(this._btDiscreteDynamicsWorld);this._btDispatchInfo=a.btCollisionWorld_getDispatchInfo(this._btDiscreteDynamicsWorld)}this._btClosestRayResultCallback=a.ClosestRayResultCallback_create(this._btVector3Zero,this._btVector3Zero);this._btAllHitsRayResultCallback=a.AllHitsRayResultCallback_create(this._btVector3Zero,this._btVector3Zero);this._btClosestConvexResultCallback=a.ClosestConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero);this._btAllConvexResultCallback=a.AllConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero);this.setHitsRayResultCallbackFlag();a.btGImpactCollisionAlgorithm_RegisterAlgorithm(this._btDispatcher)}static __init__(){var t=D.Physics3D._bullet;w._btTempVector30=t.btVector3_create(0,0,0);w._btTempVector31=t.btVector3_create(0,0,0);w._btTempQuaternion0=t.btQuaternion_create(0,0,0,1);w._btTempQuaternion1=t.btQuaternion_create(0,0,0,1);w._btTempTransform0=t.btTransform_create();w._btTempTransform1=t.btTransform_create()}static createConstraint(){}get continuousCollisionDetection(){return D.Physics3D._bullet.btCollisionWorld_get_m_useContinuous(this._btDispatchInfo)}set continuousCollisionDetection(t){D.Physics3D._bullet.btCollisionWorld_set_m_useContinuous(this._btDispatchInfo,t)}get gravity(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity}set gravity(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t;var e=D.Physics3D._bullet;var a=w._btTempVector30;e.btVector3_setValue(a,-t.x,t.y,t.z);e.btDiscreteDynamicsWorld_setGravity(this._btDiscreteDynamicsWorld,a)}get speculativeContactRestitution(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return D.Physics3D._bullet.btDiscreteDynamicsWorld_getApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld)}set speculativeContactRestitution(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";D.Physics3D._bullet.btDiscreteDynamicsWorld_setApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld,t)}_simulate(t){this._updatedRigidbodies=0;var e=D.Physics3D._bullet;if(this._btDiscreteDynamicsWorld)e.btDiscreteDynamicsWorld_stepSimulation(this._btDiscreteDynamicsWorld,t,this.maxSubSteps,this.fixedTimeStep);else e.PerformDiscreteCollisionDetection(this._btCollisionWorld)}_destroy(){var t=D.Physics3D._bullet;if(this._btDiscreteDynamicsWorld){t.btCollisionWorld_destroy(this._btDiscreteDynamicsWorld);this._btDiscreteDynamicsWorld=null}else{t.btCollisionWorld_destroy(this._btCollisionWorld);this._btCollisionWorld=null}t.btDbvtBroadphase_destroy(this._btBroadphase);this._btBroadphase=null;t.btCollisionDispatcher_destroy(this._btDispatcher);this._btDispatcher=null;t.btDefaultCollisionConfiguration_destroy(this._btCollisionConfiguration);this._btCollisionConfiguration=null}_addPhysicsCollider(t,e,a){D.Physics3D._bullet.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,a)}_removePhysicsCollider(t){D.Physics3D._bullet.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject)}_addRigidBody(t,e,a){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";D.Physics3D._bullet.btDiscreteDynamicsWorld_addRigidBody(this._btCollisionWorld,t._btColliderObject,e,a)}_removeRigidBody(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";D.Physics3D._bullet.btDiscreteDynamicsWorld_removeRigidBody(this._btCollisionWorld,t._btColliderObject)}_addCharacter(t,e,a){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var i=D.Physics3D._bullet;i.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,a);i.btDynamicsWorld_addAction(this._btCollisionWorld,t._btKinematicCharacter)}_removeCharacter(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var e=D.Physics3D._bullet;e.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject);e.btDynamicsWorld_removeAction(this._btCollisionWorld,t._btKinematicCharacter)}raycastFromTo(t,e,a=null,i=B.COLLISIONFILTERGROUP_ALLFILTER,r=B.COLLISIONFILTERGROUP_ALLFILTER){var s=D.Physics3D._bullet;var n=this._btClosestRayResultCallback;var o=w._btTempVector30;var l=w._btTempVector31;s.btVector3_setValue(o,-t.x,t.y,t.z);s.btVector3_setValue(l,-e.x,e.y,e.z);s.ClosestRayResultCallback_set_m_rayFromWorld(n,o);s.ClosestRayResultCallback_set_m_rayToWorld(n,l);s.RayResultCallback_set_m_collisionFilterGroup(n,i);s.RayResultCallback_set_m_collisionFilterMask(n,r);s.RayResultCallback_set_m_collisionObject(n,null);s.RayResultCallback_set_m_closestHitFraction(n,1);s.btCollisionWorld_rayTest(this._btCollisionWorld,o,l,n);if(s.RayResultCallback_hasHit(n)){if(a){a.succeeded=true;a.collider=I._physicObjectsMap[s.btCollisionObject_getUserIndex(s.RayResultCallback_get_m_collisionObject(n))];a.hitFraction=s.RayResultCallback_get_m_closestHitFraction(n);var _=s.ClosestRayResultCallback_get_m_hitPointWorld(n);var h=a.point;h.x=-s.btVector3_x(_);h.y=s.btVector3_y(_);h.z=s.btVector3_z(_);var x=s.ClosestRayResultCallback_get_m_hitNormalWorld(n);var c=a.normal;c.x=-s.btVector3_x(x);c.y=s.btVector3_y(x);c.z=s.btVector3_z(x)}return true}else{if(a)a.succeeded=false;return false}}raycastAllFromTo(t,e,a,i=B.COLLISIONFILTERGROUP_ALLFILTER,r=B.COLLISIONFILTERGROUP_ALLFILTER){var s=D.Physics3D._bullet;var n=this._btAllHitsRayResultCallback;var o=w._btTempVector30;var l=w._btTempVector31;a.length=0;s.btVector3_setValue(o,-t.x,t.y,t.z);s.btVector3_setValue(l,-e.x,e.y,e.z);s.AllHitsRayResultCallback_set_m_rayFromWorld(n,o);s.AllHitsRayResultCallback_set_m_rayToWorld(n,l);s.RayResultCallback_set_m_collisionFilterGroup(n,i);s.RayResultCallback_set_m_collisionFilterMask(n,r);var _=s.AllHitsRayResultCallback_get_m_collisionObjects(n);var h=s.AllHitsRayResultCallback_get_m_hitPointWorld(n);var x=s.AllHitsRayResultCallback_get_m_hitNormalWorld(n);var c=s.AllHitsRayResultCallback_get_m_hitFractions(n);s.tBtCollisionObjectArray_clear(_);s.tVector3Array_clear(h);s.tVector3Array_clear(x);s.tScalarArray_clear(c);s.btCollisionWorld_rayTest(this._btCollisionWorld,o,l,n);var d=s.tBtCollisionObjectArray_size(_);if(d>0){this._collisionsUtils.recoverAllHitResultsPool();for(var u=0;u<d;u++){var f=this._collisionsUtils.getHitResult();a.push(f);f.succeeded=true;f.collider=I._physicObjectsMap[s.btCollisionObject_getUserIndex(s.tBtCollisionObjectArray_at(_,u))];f.hitFraction=s.tScalarArray_at(c,u);var p=s.tVector3Array_at(h,u);var m=f.point;m.x=-s.btVector3_x(p);m.y=s.btVector3_y(p);m.z=s.btVector3_z(p);var g=s.tVector3Array_at(x,u);var v=f.normal;v.x=-s.btVector3_x(g);v.y=s.btVector3_y(g);v.z=s.btVector3_z(g)}return true}else{return false}}rayCast(t,e=null,a=2147483647,i=B.COLLISIONFILTERGROUP_ALLFILTER,r=B.COLLISIONFILTERGROUP_ALLFILTER){var s=t.origin;var n=w._tempVector30;St.normalize(t.direction,n);St.scale(n,a,n);St.add(s,n,n);return this.raycastFromTo(s,n,e,i,r)}rayCastAll(t,e,a=2147483647,i=B.COLLISIONFILTERGROUP_ALLFILTER,r=B.COLLISIONFILTERGROUP_ALLFILTER){var s=t.origin;var n=w._tempVector30;St.normalize(t.direction,n);St.scale(n,a,n);St.add(s,n,n);return this.raycastAllFromTo(s,n,e,i,r)}shapeCast(t,e,a,i=null,r=null,s=null,n=B.COLLISIONFILTERGROUP_ALLFILTER,o=B.COLLISIONFILTERGROUP_ALLFILTER,l=0){var _=D.Physics3D._bullet;var h=this._btClosestConvexResultCallback;var x=w._btTempVector30;var c=w._btTempVector31;var d=w._btTempQuaternion0;var u=w._btTempQuaternion1;var f=w._btTempTransform0;var p=w._btTempTransform1;var m=t._btShape;_.btVector3_setValue(x,-e.x,e.y,e.z);_.btVector3_setValue(c,-a.x,a.y,a.z);_.ConvexResultCallback_set_m_collisionFilterGroup(h,n);_.ConvexResultCallback_set_m_collisionFilterMask(h,o);_.btTransform_setOrigin(f,x);_.btTransform_setOrigin(p,c);if(r){_.btQuaternion_setValue(d,-r.x,r.y,r.z,-r.w);_.btTransform_setRotation(f,d)}else{_.btTransform_setRotation(f,this._btDefaultQuaternion)}if(s){_.btQuaternion_setValue(u,-s.x,s.y,s.z,-s.w);_.btTransform_setRotation(p,u)}else{_.btTransform_setRotation(p,this._btDefaultQuaternion)}_.ClosestConvexResultCallback_set_m_hitCollisionObject(h,null);_.ConvexResultCallback_set_m_closestHitFraction(h,1);_.btCollisionWorld_convexSweepTest(this._btCollisionWorld,m,f,p,h,l);if(_.ConvexResultCallback_hasHit(h)){if(i){i.succeeded=true;i.collider=I._physicObjectsMap[_.btCollisionObject_getUserIndex(_.ClosestConvexResultCallback_get_m_hitCollisionObject(h))];i.hitFraction=_.ConvexResultCallback_get_m_closestHitFraction(h);var g=_.ClosestConvexResultCallback_get_m_hitPointWorld(h);var v=_.ClosestConvexResultCallback_get_m_hitNormalWorld(h);var y=i.point;var T=i.normal;y.x=-_.btVector3_x(g);y.y=_.btVector3_y(g);y.z=_.btVector3_z(g);T.x=-_.btVector3_x(v);T.y=_.btVector3_y(v);T.z=_.btVector3_z(v)}return true}else{if(i)i.succeeded=false;return false}}shapeCastAll(t,e,a,i,r=null,s=null,n=B.COLLISIONFILTERGROUP_ALLFILTER,o=B.COLLISIONFILTERGROUP_ALLFILTER,l=0){var _=D.Physics3D._bullet;var h=this._btAllConvexResultCallback;var x=w._btTempVector30;var c=w._btTempVector31;var d=w._btTempQuaternion0;var u=w._btTempQuaternion1;var f=w._btTempTransform0;var p=w._btTempTransform1;var m=t._btShape;i.length=0;_.btVector3_setValue(x,-e.x,e.y,e.z);_.btVector3_setValue(c,-a.x,a.y,a.z);_.ConvexResultCallback_set_m_collisionFilterGroup(h,n);_.ConvexResultCallback_set_m_collisionFilterMask(h,o);_.btTransform_setOrigin(f,x);_.btTransform_setOrigin(p,c);if(r){_.btQuaternion_setValue(d,-r.x,r.y,r.z,-r.w);_.btTransform_setRotation(f,d)}else{_.btTransform_setRotation(f,this._btDefaultQuaternion)}if(s){_.btQuaternion_setValue(u,-s.x,s.y,s.z,-s.w);_.btTransform_setRotation(p,u)}else{_.btTransform_setRotation(p,this._btDefaultQuaternion)}var g=_.AllConvexResultCallback_get_m_collisionObjects(h);var v=_.AllConvexResultCallback_get_m_hitPointWorld(h);var y=_.AllConvexResultCallback_get_m_hitNormalWorld(h);var T=_.AllConvexResultCallback_get_m_hitFractions(h);_.tVector3Array_clear(v);_.tVector3Array_clear(y);_.tScalarArray_clear(T);_.tBtCollisionObjectArray_clear(g);_.btCollisionWorld_convexSweepTest(this._btCollisionWorld,m,f,p,h,l);var E=_.tBtCollisionObjectArray_size(g);if(E>0){this._collisionsUtils.recoverAllHitResultsPool();for(var b=0;b<E;b++){var S=this._collisionsUtils.getHitResult();i.push(S);S.succeeded=true;S.collider=I._physicObjectsMap[_.btCollisionObject_getUserIndex(_.tBtCollisionObjectArray_at(g,b))];S.hitFraction=_.tScalarArray_at(T,b);var C=_.tVector3Array_at(v,b);var R=S.point;R.x=-_.btVector3_x(C);R.y=_.btVector3_y(C);R.z=_.btVector3_z(C);var A=_.tVector3Array_at(y,b);var L=S.normal;L.x=-_.btVector3_x(A);L.y=_.btVector3_y(A);L.z=_.btVector3_z(A)}return true}else{return false}}addConstraint(t,e=false){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";D.Physics3D._bullet.btCollisionWorld_addConstraint(this._btDiscreteDynamicsWorld,t._btConstraint,e);this._currentConstraint[t.id]=t}removeConstraint(t){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";D.Physics3D._bullet.btCollisionWorld_removeConstraint(this._btDiscreteDynamicsWorld,t._btConstraint);delete this._currentConstraint[t.id]}setHitsRayResultCallbackFlag(t=1){var e=D.Physics3D._bullet;e.RayResultCallback_set_m_flags(this._btAllHitsRayResultCallback,t);e.RayResultCallback_set_m_flags(this._btClosestRayResultCallback,t)}_updatePhysicsTransformFromRender(){var t=this._physicsUpdateList.elements;for(var e=0,a=this._physicsUpdateList.length;e<a;e++){var i=t[e];i._derivePhysicsTransformation(false);i._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}_updateCharacters(){for(var t=0,e=this._characters.length;t<e;t++){var a=this._characters[t];a._updateTransformComponent(D.Physics3D._bullet.btCollisionObject_getWorldTransform(a._btColliderObject))}}_updateCollisions(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions;this._currentFrameCollisions.length=0;this._previousFrameCollisions=t;var e=Et.Stat.loopCount;var a=D.Physics3D._bullet;var i=a.btDispatcher_getNumManifolds(this._btDispatcher);for(var r=0;r<i;r++){var s=a.btDispatcher_getManifoldByIndexInternal(this._btDispatcher,r);var n=I._physicObjectsMap[a.btCollisionObject_getUserIndex(a.btPersistentManifold_getBody0(s))];var o=I._physicObjectsMap[a.btCollisionObject_getUserIndex(a.btPersistentManifold_getBody1(s))];var l=null;var _;var h=null;var x=n.isTrigger||o.isTrigger;if(x&&(n.owner._needProcessTriggers||o.owner._needProcessTriggers)){var c=a.btPersistentManifold_getNumContacts(s);for(var d=0;d<c;d++){var u=a.btPersistentManifold_getContactPoint(s,d);var f=a.btManifoldPoint_getDistance(u);if(f<=0){l=this._collisionsUtils.getCollision(n,o);h=l.contacts;_=l._updateFrame!==e;if(_){l._isTrigger=true;h.length=0}break}}}else if(n.owner._needProcessCollisions||o.owner._needProcessCollisions){if(n._enableProcessCollisions||o._enableProcessCollisions){c=a.btPersistentManifold_getNumContacts(s);for(d=0;d<c;d++){u=a.btPersistentManifold_getContactPoint(s,d);f=a.btManifoldPoint_getDistance(u);if(f<=0){var p=this._collisionsUtils.getContactPoints();p.colliderA=n;p.colliderB=o;p.distance=f;var m=a.btManifoldPoint_get_m_normalWorldOnB(u);var g=p.normal;g.x=-a.btVector3_x(m);g.y=a.btVector3_y(m);g.z=a.btVector3_z(m);var v=a.btManifoldPoint_get_m_positionWorldOnA(u);var y=p.positionOnA;y.x=-a.btVector3_x(v);y.y=a.btVector3_y(v);y.z=a.btVector3_z(v);var T=a.btManifoldPoint_get_m_positionWorldOnB(u);var E=p.positionOnB;E.x=-a.btVector3_x(T);E.y=a.btVector3_y(T);E.z=a.btVector3_z(T);if(!l){l=this._collisionsUtils.getCollision(n,o);h=l.contacts;_=l._updateFrame!==e;if(_){l._isTrigger=false;h.length=0}}h.push(p)}}}}if(l&&_){this._currentFrameCollisions.push(l);l._setUpdateFrame(e)}}}_eventScripts(){var t=Et.Stat.loopCount;for(var e=0,a=this._currentFrameCollisions.length;e<a;e++){var i=this._currentFrameCollisions[e];var r=i._colliderA;var s=i._colliderB;if(r.destroyed||s.destroyed)continue;if(t-i._lastUpdateFrame===1){var n=r.owner;var o=n._scripts;if(o){if(i._isTrigger){if(n._needProcessTriggers){for(var l=0,_=o.length;l<_;l++)o[l].onTriggerStay(s)}}else{if(n._needProcessCollisions){for(l=0,_=o.length;l<_;l++){i.other=s;o[l].onCollisionStay(i)}}}}var h=s.owner;var x=h._scripts;if(x){if(i._isTrigger){if(h._needProcessTriggers){for(l=0,_=x.length;l<_;l++)x[l].onTriggerStay(r)}}else{if(h._needProcessCollisions){for(l=0,_=x.length;l<_;l++){i.other=r;x[l].onCollisionStay(i)}}}}}else{n=r.owner;o=n._scripts;if(o){if(i._isTrigger){if(n._needProcessTriggers){for(l=0,_=o.length;l<_;l++)o[l].onTriggerEnter(s)}}else{if(n._needProcessCollisions){for(l=0,_=o.length;l<_;l++){i.other=s;o[l].onCollisionEnter(i)}}}}h=s.owner;x=h._scripts;if(x){if(i._isTrigger){if(h._needProcessTriggers){for(l=0,_=x.length;l<_;l++)x[l].onTriggerEnter(r)}}else{if(h._needProcessCollisions){for(l=0,_=x.length;l<_;l++){i.other=r;x[l].onCollisionEnter(i)}}}}}}for(e=0,a=this._previousFrameCollisions.length;e<a;e++){var c=this._previousFrameCollisions[e];var d=c._colliderA;var u=c._colliderB;if(d.destroyed||u.destroyed)continue;if(t-c._updateFrame===1){this._collisionsUtils.recoverCollision(c);n=d.owner;o=n._scripts;if(o){if(c._isTrigger){if(n._needProcessTriggers){for(l=0,_=o.length;l<_;l++)o[l].onTriggerExit(u)}}else{if(n._needProcessCollisions){for(l=0,_=o.length;l<_;l++){c.other=u;o[l].onCollisionExit(c)}}}}h=u.owner;x=h._scripts;if(x){if(c._isTrigger){if(h._needProcessTriggers){for(l=0,_=x.length;l<_;l++)x[l].onTriggerExit(d)}}else{if(h._needProcessCollisions){for(l=0,_=x.length;l<_;l++){c.other=d;x[l].onCollisionExit(c)}}}}}}for(var f in this._currentConstraint){var p=this._currentConstraint[f];var m=p.owner._scripts;if(p.enabled&&p._isBreakConstrained()&&!!m){if(m.length!=0){for(e=0,a=m.length;e<a;e++){m[e].onJointBreak()}}}}}clearForces(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";D.Physics3D._bullet.btDiscreteDynamicsWorld_clearForces(this._btDiscreteDynamicsWorld)}}w.PHYSICSENGINEFLAGS_NONE=0;w.PHYSICSENGINEFLAGS_COLLISIONSONLY=1;w.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2;w.PHYSICSENGINEFLAGS_MULTITHREADED=4;w.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8;w.SOLVERMODE_RANDMIZE_ORDER=1;w.SOLVERMODE_FRICTION_SEPARATE=2;w.SOLVERMODE_USE_WARMSTARTING=4;w.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16;w.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32;w.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64;w.SOLVERMODE_CACHE_FRIENDLY=128;w.SOLVERMODE_SIMD=256;w.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512;w.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024;w.HITSRAYRESULTCALLBACK_FLAG_NONE=0;w.HITSRAYRESULTCALLBACK_FLAG_FILTERBACKFACESS=1;w.HITSRAYRESULTCALLBACK_FLAG_KEEPUNFILIPPEDNORMAL=2;w.HITSRAYRESULTCALLBACK_FLAG_USESUBSIMPLEXCONVEXCASTRAYTEST=4;w.HITSRAYRESULTCALLBACK_FLAG_USEGJKCONVEXCASTRAYTEST=8;w.HITSRAYRESULTCALLBACK_FLAG_TERMINATOR=4294967295;w._tempVector30=new St;w.disableSimulation=false;class q{constructor(){}static lightAttenTexture(t,e,a,i,r,s){var n=t/a;var o=1/(1+25*n);if(n>=.64){if(n>1){o=0}else{o*=1-(n-.64)/(1-.64)}}s[r]=Math.floor(o*255+.5)}static haloTexture(t,e,a,i,r,s){a>>=1;i>>=1;var n=(t-a)/a;var o=(e-i)/i;var l=n*n+o*o;if(l>1){l=1}s[r]=Math.floor((1-l)*255+.5)}static _generateTexture2D(t,e,a,i){var r=0;var s=0;switch(t.format){case Et.TextureFormat.R8G8B8:s=3;break;case Et.TextureFormat.R8G8B8A8:s=4;break;case Et.TextureFormat.Alpha8:s=1;break;default:throw"GeneratedTexture._generateTexture: unkonw texture format."}var n=new Uint8Array(e*a*s);for(var o=0;o<a;o++){for(var l=0;l<e;l++){i(l,o,e,a,r,n);r+=s}}t.setPixels(n)}}class F{static _createFloatTextureBuffer(t,e){var a=new Et.Texture2D(t,e,Et.TextureFormat.R32G32B32A32,false,false);a.filterMode=Et.FilterMode.Point;a.wrapModeU=Et.WarpMode.Clamp;a.wrapModeV=Et.WarpMode.Clamp;a.anisoLevel=0;return a}static _convertToLayaVec3(t,e,a){var i=D.Physics3D._bullet;e.x=a?-i.btVector3_x(t):i.btVector3_x(t);e.y=i.btVector3_y(t);e.z=i.btVector3_z(t)}static _convertToBulletVec3(t,e,a){D.Physics3D._bullet.btVector3_setValue(e,a?-t.x:t.x,t.y,t.z)}static _rotationTransformScaleSkinAnimation(t,e,a,i,r,s,n,o,l,_,h,x){var c=F._tempArray16_0;var d=F._tempArray16_1;var u=F._tempArray16_2;var f=i+i;var p=r+r;var m=s+s;var g=i*f;var v=r*f;var y=r*p;var T=s*f;var E=s*p;var b=s*m;var S=n*f;var C=n*p;var R=n*m;c[15]=1;c[0]=1-y-b;c[1]=v+R;c[2]=T-C;c[4]=v-R;c[5]=1-g-b;c[6]=E+S;c[8]=T+C;c[9]=E-S;c[10]=1-g-y;d[15]=1;d[0]=o;d[5]=l;d[10]=_;var A,L,I,M,D;for(A=0;A<4;A++){L=c[A];I=c[A+4];M=c[A+8];D=c[A+12];u[A]=L;u[A+4]=I;u[A+8]=M;u[A+12]=L*t+I*e+M*a+D}for(A=0;A<4;A++){L=u[A];I=u[A+4];M=u[A+8];D=u[A+12];h[A+x]=L*d[0]+I*d[1]+M*d[2]+D*d[3];h[A+x+4]=L*d[4]+I*d[5]+M*d[6]+D*d[7];h[A+x+8]=L*d[8]+I*d[9]+M*d[10]+D*d[11];h[A+x+12]=L*d[12]+I*d[13]+M*d[14]+D*d[15]}}static _computeBoneAndAnimationDatasByBindPoseMatrxix(t,e,a,i,r,s){var n=0;var o=0;var l;var _;var h=t.length;for(l=0;l<h;n+=t[l].keyframeWidth,o+=16,l++){F._rotationTransformScaleSkinAnimation(e[n+0],e[n+1],e[n+2],e[n+3],e[n+4],e[n+5],e[n+6],e[n+7],e[n+8],e[n+9],i,o);if(l!=0){_=t[l].parentIndex*16;F.mulMatrixByArray(i,_,i,o,i,o)}}var x=a.length;for(l=0;l<x;l++){F.mulMatrixByArrayAndMatrixFast(i,s[l]*16,a[l],r,l*16)}}static _computeAnimationDatasByArrayAndMatrixFast(t,e,a,i){for(var r=0,s=t.length;r<s;r++)F.mulMatrixByArrayAndMatrixFast(e,i[r]*16,t[r],a,r*16)}static _computeBoneAndAnimationDatasByBindPoseMatrxixOld(t,e,a,i,r){var s=0;var n=0;var o;var l;var _=t.length;for(o=0;o<_;s+=t[o].keyframeWidth,n+=16,o++){F._rotationTransformScaleSkinAnimation(e[s+7],e[s+8],e[s+9],e[s+3],e[s+4],e[s+5],e[s+6],e[s+0],e[s+1],e[s+2],i,n);if(o!=0){l=t[o].parentIndex*16;F.mulMatrixByArray(i,l,i,n,i,n)}}var h=a.length;for(o=0;o<h;o++){var x=o*16;F.mulMatrixByArrayAndMatrixFast(i,x,a[o],r,x)}}static _computeAnimationDatasByArrayAndMatrixFastOld(t,e,a){var i=t.length;for(var r=0;r<i;r++){var s=r*16;F.mulMatrixByArrayAndMatrixFast(e,s,t[r],a,s)}}static _computeRootAnimationData(t,e,a){for(var i=0,r=0,s=0,n=t.length;i<n;r+=t[i].keyframeWidth,s+=16,i++)F.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],a,s)}static transformVector3ArrayByQuat(t,e,a,i,r){var s=t[e],n=t[e+1],o=t[e+2],l=a.x,_=a.y,h=a.z,x=a.w,c=x*s+_*o-h*n,d=x*n+h*s-l*o,u=x*o+l*n-_*s,f=-l*s-_*n-h*o;i[r]=c*x+f*-l+d*-h-u*-_;i[r+1]=d*x+f*-_+u*-l-c*-h;i[r+2]=u*x+f*-h+c*-_-d*-l}static mulMatrixByArray(t,e,a,i,r,s){var n,o,l,_,h;if(r===a){a=F._tempArray16_3;for(n=0;n<16;++n){a[n]=r[s+n]}i=0}for(n=0;n<4;n++){o=t[e+n];l=t[e+n+4];_=t[e+n+8];h=t[e+n+12];r[s+n]=o*a[i+0]+l*a[i+1]+_*a[i+2]+h*a[i+3];r[s+n+4]=o*a[i+4]+l*a[i+5]+_*a[i+6]+h*a[i+7];r[s+n+8]=o*a[i+8]+l*a[i+9]+_*a[i+10]+h*a[i+11];r[s+n+12]=o*a[i+12]+l*a[i+13]+_*a[i+14]+h*a[i+15]}}static mulMatrixByArrayFast(t,e,a,i,r,s){var n,o,l,_,h;for(n=0;n<4;n++){o=t[e+n];l=t[e+n+4];_=t[e+n+8];h=t[e+n+12];r[s+n]=o*a[i+0]+l*a[i+1]+_*a[i+2]+h*a[i+3];r[s+n+4]=o*a[i+4]+l*a[i+5]+_*a[i+6]+h*a[i+7];r[s+n+8]=o*a[i+8]+l*a[i+9]+_*a[i+10]+h*a[i+11];r[s+n+12]=o*a[i+12]+l*a[i+13]+_*a[i+14]+h*a[i+15]}}static mulMatrixByArrayAndMatrixFast(t,e,a,i,r){var s,n,o,l,_;var h=a.elements;var x=h[0],c=h[1],d=h[2],u=h[3];var f=h[4],p=h[5],m=h[6],g=h[7];var v=h[8],y=h[9],T=h[10],E=h[11];var b=h[12],S=h[13],C=h[14],R=h[15];var A=e;var L=e+4;var I=e+8;var M=e+12;var D=r;var w=r+4;var P=r+8;var O=r+12;for(s=0;s<4;s++){n=t[A+s];o=t[L+s];l=t[I+s];_=t[M+s];i[D+s]=n*x+o*c+l*d+_*u;i[w+s]=n*f+o*p+l*m+_*g;i[P+s]=n*v+o*y+l*T+_*E;i[O+s]=n*b+o*S+l*C+_*R}}static createAffineTransformationArray(t,e,a,i,r,s,n,o,l,_,h,x){var c=i+i,d=r+r,u=s+s;var f=i*c,p=i*d,m=i*u,g=r*d,v=r*u,y=s*u;var T=n*c,E=n*d,b=n*u;h[x+0]=(1-(g+y))*o;h[x+1]=(p+b)*o;h[x+2]=(m-E)*o;h[x+3]=0;h[x+4]=(p-b)*l;h[x+5]=(1-(f+y))*l;h[x+6]=(v+T)*l;h[x+7]=0;h[x+8]=(m+E)*_;h[x+9]=(v-T)*_;h[x+10]=(1-(f+g))*_;h[x+11]=0;h[x+12]=t;h[x+13]=e;h[x+14]=a;h[x+15]=1}static transformVector3ArrayToVector3ArrayCoordinate(t,e,a,i,r){var s=t[e+0];var n=t[e+1];var o=t[e+2];var l=a.elements;var _=s*l[3]+n*l[7]+o*l[11]+l[15];i[r]=s*l[0]+n*l[4]+o*l[8]+l[12]/_;i[r+1]=s*l[1]+n*l[5]+o*l[9]+l[13]/_;i[r+2]=s*l[2]+n*l[6]+o*l[10]+l[14]/_}static transformVector3ArrayToVector3ArrayNormal(t,e,a,i,r){var s=t[e+0];var n=t[e+1];var o=t[e+2];var l=a.elements;i[r]=s*l[0]+n*l[4]+o*l[8];i[r+1]=s*l[1]+n*l[5]+o*l[9];i[r+2]=s*l[2]+n*l[6]+o*l[10]}static transformLightingMapTexcoordArray(t,e,a,i,r){i[r+0]=t[e+0]*a.x+a.z;i[r+1]=1-((1-t[e+1])*a.y+a.w)}static getURLVerion(t){var e=t.indexOf("?");return e>=0?t.substr(e):null}static _createAffineTransformationArray(t,e,a,i){var r=e.x,s=e.y,n=e.z,o=e.w,l=r+r,_=s+s,h=n+n;var x=r*l,c=r*_,d=r*h,u=s*_,f=s*h,p=n*h;var m=o*l,g=o*_,v=o*h,y=a.x,T=a.y,E=a.z;i[0]=(1-(u+p))*y;i[1]=(c+v)*y;i[2]=(d-g)*y;i[3]=0;i[4]=(c-v)*T;i[5]=(1-(x+p))*T;i[6]=(f+m)*T;i[7]=0;i[8]=(d+g)*E;i[9]=(f-m)*E;i[10]=(1-(x+u))*E;i[11]=0;i[12]=t.x;i[13]=t.y;i[14]=t.z;i[15]=1}static _mulMatrixArray(B,F,t,V,e){var a=F;var i=B;var r=V;var s=a[t],n=a[t+1],o=a[t+2],l=a[t+3];var _=a[t+4],h=a[t+5],x=a[t+6],c=a[t+7];var d=a[t+8],u=a[t+9],f=a[t+10],p=a[t+11];var m=a[t+12],g=a[t+13],v=a[t+14],y=a[t+15];var T=i[0],E=i[1],b=i[2],S=i[3];var C=i[4],R=i[5],A=i[6],L=i[7];var I=i[8],M=i[9],D=i[10],w=i[11];var P=i[12],O=i[13],N=i[14],U=i[15];r[e]=s*T+n*C+o*I+l*P;r[e+1]=s*E+n*R+o*M+l*O;r[e+2]=s*b+n*A+o*D+l*N;r[e+3]=s*S+n*L+o*w+l*U;r[e+4]=_*T+h*C+x*I+c*P;r[e+5]=_*E+h*R+x*M+c*O;r[e+6]=_*b+h*A+x*D+c*N;r[e+7]=_*S+h*L+x*w+c*U;r[e+8]=d*T+u*C+f*I+p*P;r[e+9]=d*E+u*R+f*M+p*O;r[e+10]=d*b+u*A+f*D+p*N;r[e+11]=d*S+u*L+f*w+p*U;r[e+12]=m*T+g*C+v*I+y*P;r[e+13]=m*E+g*R+v*M+y*O;r[e+14]=m*b+g*A+v*D+y*N;r[e+15]=m*S+g*L+v*w+y*U}static arcTanAngle(t,e){if(t==0){if(e==1)return Math.PI/2;return-Math.PI/2}if(t>0)return Math.atan(e/t);if(t<0){if(e>0)return Math.atan(e/t)+Math.PI;return Math.atan(e/t)-Math.PI}return 0}static angleTo(t,e,a){St.subtract(e,t,M.TEMPVector30);St.normalize(M.TEMPVector30,M.TEMPVector30);a.x=Math.asin(M.TEMPVector30.y);a.y=F.arcTanAngle(-M.TEMPVector30.z,-M.TEMPVector30.x)}static transformQuat(t,e,a){var i=e;var r=t.x,s=t.y,n=t.z,o=i[0],l=i[1],_=i[2],h=i[3],x=h*r+l*n-_*s,c=h*s+_*r-o*n,d=h*n+o*s-l*r,u=-o*r-l*s-_*n;a.x=x*h+u*-o+c*-_-d*-l;a.y=c*h+u*-l+d*-o-x*-_;a.z=d*h+u*-_+x*-l-c*-o}static quaternionWeight(t,e,a){a.x=t.x*e;a.y=t.y*e;a.z=t.z*e;a.w=t.w}static quaternionConjugate(t,e){e.x=-t.x;e.y=-t.y;e.z=-t.z;e.w=t.w}static scaleWeight(t,e,a){var i=t.x,r=t.y,s=t.z;a.x=i>0?Math.pow(Math.abs(i),e):-Math.pow(Math.abs(i),e);a.y=r>0?Math.pow(Math.abs(r),e):-Math.pow(Math.abs(r),e);a.z=s>0?Math.pow(Math.abs(s),e):-Math.pow(Math.abs(s),e)}static scaleBlend(t,e,a,i){var r=F._tempVector3_0;var s=F._tempVector3_1;F.scaleWeight(t,1-a,r);F.scaleWeight(e,a,s);var n=a>.5?e:t;i.x=n.x>0?Math.abs(r.x*s.x):-Math.abs(r.x*s.x);i.y=n.y>0?Math.abs(r.y*s.y):-Math.abs(r.y*s.y);i.z=n.z>0?Math.abs(r.z*s.z):-Math.abs(r.z*s.z)}static matrix4x4MultiplyFFF(t,e,a){var i,r,s,n,o;if(a===e){e=new Float32Array(16);for(i=0;i<16;++i){e[i]=a[i]}}var l=e[0],_=e[1],h=e[2],x=e[3];var c=e[4],d=e[5],u=e[6],f=e[7];var p=e[8],m=e[9],g=e[10],v=e[11];var y=e[12],T=e[13],E=e[14],b=e[15];for(i=0;i<4;i++){r=t[i];s=t[i+4];n=t[i+8];o=t[i+12];a[i]=r*l+s*_+n*h+o*x;a[i+4]=r*c+s*d+n*u+o*f;a[i+8]=r*p+s*m+n*g+o*v;a[i+12]=r*y+s*T+n*E+o*b}}static matrix4x4MultiplyFFFForNative(t,e,a){Et.LayaGL.instance.matrix4x4Multiply(t,e,a)}static matrix4x4MultiplyMFM(t,e,a){F.matrix4x4MultiplyFFF(t.elements,e,a.elements)}static _buildTexture2D(t,e,a,i,r=false){var s=new Et.Texture2D(t,e,a,r,true);s.anisoLevel=1;s.filterMode=Et.FilterMode.Point;q._generateTexture2D(s,t,e,i);return s}static _drawBound(t,e,a){if(t.lineCount+12>t.maxLineCount)t.maxLineCount+=12;var i=F._tempVector3_0;var r=F._tempVector3_1;var s=e.min;var n=e.max;i.setValue(s.x,s.y,s.z);r.setValue(n.x,s.y,s.z);t.addLine(i,r,a,a);i.setValue(s.x,s.y,s.z);r.setValue(s.x,s.y,n.z);t.addLine(i,r,a,a);i.setValue(n.x,s.y,s.z);r.setValue(n.x,s.y,n.z);t.addLine(i,r,a,a);i.setValue(s.x,s.y,n.z);r.setValue(n.x,s.y,n.z);t.addLine(i,r,a,a);i.setValue(s.x,s.y,s.z);r.setValue(s.x,n.y,s.z);t.addLine(i,r,a,a);i.setValue(s.x,s.y,n.z);r.setValue(s.x,n.y,n.z);t.addLine(i,r,a,a);i.setValue(n.x,s.y,s.z);r.setValue(n.x,n.y,s.z);t.addLine(i,r,a,a);i.setValue(n.x,s.y,n.z);r.setValue(n.x,n.y,n.z);t.addLine(i,r,a,a);i.setValue(s.x,n.y,s.z);r.setValue(n.x,n.y,s.z);t.addLine(i,r,a,a);i.setValue(s.x,n.y,s.z);r.setValue(s.x,n.y,n.z);t.addLine(i,r,a,a);i.setValue(n.x,n.y,s.z);r.setValue(n.x,n.y,n.z);t.addLine(i,r,a,a);i.setValue(s.x,n.y,n.z);r.setValue(n.x,n.y,n.z);t.addLine(i,r,a,a)}static _getHierarchyPath(t,e,a){a.length=0;var i=e;while(i!==t){var r=i._parent;if(r)a.push(r.getChildIndex(i));else return null;i=r}return a}static _getNodeByHierarchyPath(t,e){var a=t;for(var i=e.length-1;i>=0;i--){a=a.getChildAt(e[i])}return a}}F._tempVector3_0=new St;F._tempVector3_1=new St;F._tempArray16_0=new Float32Array(16);F._tempArray16_1=new Float32Array(16);F._tempArray16_2=new Float32Array(16);F._tempArray16_3=new Float32Array(16);F._compIdToNode=new Object;class Z extends I{constructor(t=.1,e=null,a=B.COLLISIONFILTERGROUP_DEFAULTFILTER,i=B.COLLISIONFILTERGROUP_ALLFILTER){super(a,i);this._upAxis=new St(0,1,0);this._maxSlope=45;this._jumpSpeed=10;this._fallSpeed=55;this._gravity=new St(0,-9.8*3,0);this._btKinematicCharacter=null;this._stepHeight=t;e&&(this._upAxis=e);this._controlBySimulation=true}static __init__(){Z._btTempVector30=D.Physics3D._bullet.btVector3_create(0,0,0)}get fallSpeed(){return this._fallSpeed}set fallSpeed(t){this._fallSpeed=t;D.Physics3D._bullet.btKinematicCharacterController_setFallSpeed(this._btKinematicCharacter,t)}get jumpSpeed(){return this._jumpSpeed}set jumpSpeed(t){this._jumpSpeed=t;D.Physics3D._bullet.btKinematicCharacterController_setJumpSpeed(this._btKinematicCharacter,t)}get gravity(){return this._gravity}set gravity(t){this._gravity=t;var e=D.Physics3D._bullet;var a=Z._btTempVector30;e.btVector3_setValue(a,-t.x,t.y,t.z);e.btKinematicCharacterController_setGravity(this._btKinematicCharacter,a)}get maxSlope(){return this._maxSlope}set maxSlope(t){this._maxSlope=t;D.Physics3D._bullet.btKinematicCharacterController_setMaxSlope(this._btKinematicCharacter,t/180*Math.PI)}get isGrounded(){return D.Physics3D._bullet.btKinematicCharacterController_onGround(this._btKinematicCharacter)}get stepHeight(){return this._stepHeight}set stepHeight(t){this._stepHeight=t;D.Physics3D._bullet.btKinematicCharacterController_setStepHeight(this._btKinematicCharacter,t)}get upAxis(){return this._upAxis}set upAxis(t){this._upAxis=t;var e=Z._btTempVector30;F._convertToBulletVec3(t,e,false);D.Physics3D._bullet.btKinematicCharacterController_setUp(this._btKinematicCharacter,e)}_constructCharacter(){var t=D.Physics3D._bullet;if(this._btKinematicCharacter)t.btKinematicCharacterController_destroy(this._btKinematicCharacter);var e=Z._btTempVector30;t.btVector3_setValue(e,this._upAxis.x,this._upAxis.y,this._upAxis.z);this._btKinematicCharacter=t.btKinematicCharacterController_create(this._btColliderObject,this._colliderShape._btShape,this._stepHeight,e);this.fallSpeed=this._fallSpeed;this.maxSlope=this._maxSlope;this.jumpSpeed=this._jumpSpeed;this.gravity=this._gravity}_onShapeChange(t){super._onShapeChange(t);this._constructCharacter()}_onAdded(){var t=D.Physics3D._bullet;var e=t.btPairCachingGhostObject_create();t.btCollisionObject_setUserIndex(e,this.id);t.btCollisionObject_setCollisionFlags(e,I.COLLISIONFLAGS_CHARACTER_OBJECT);this._btColliderObject=e;this._colliderShape&&this._constructCharacter();super._onAdded()}_addToSimulation(){this._simulation._characters.push(this);this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}_removeFromSimulation(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)}_cloneTo(t){super._cloneTo(t);var e=t;e.stepHeight=this._stepHeight;e.upAxis=this._upAxis;e.maxSlope=this._maxSlope;e.jumpSpeed=this._jumpSpeed;e.fallSpeed=this._fallSpeed;e.gravity=this._gravity}_onDestroy(){D.Physics3D._bullet.btKinematicCharacterController_destroy(this._btKinematicCharacter);super._onDestroy();this._btKinematicCharacter=null}move(t){var e=Z._btVector30;var a=D.Physics3D._bullet;a.btVector3_setValue(e,-t.x,t.y,t.z);a.btKinematicCharacterController_setWalkDirection(this._btKinematicCharacter,e)}jump(t=null){var e=D.Physics3D._bullet;var a=Z._btVector30;if(t){F._convertToBulletVec3(t,a,true);e.btKinematicCharacterController_jump(this._btKinematicCharacter,a)}else{e.btVector3_setValue(a,0,0,0);e.btKinematicCharacterController_jump(this._btKinematicCharacter,a)}}}Z.UPAXIS_X=0;Z.UPAXIS_Y=1;Z.UPAXIS_Z=2;class t extends I{constructor(t,e){super(t,e);this._isTrigger=false}get isTrigger(){return this._isTrigger}set isTrigger(t){this._isTrigger=t;var e=D.Physics3D._bullet;if(this._btColliderObject){var a=e.btCollisionObject_getCollisionFlags(this._btColliderObject);if(t){if((a&I.COLLISIONFLAGS_NO_CONTACT_RESPONSE)===0)e.btCollisionObject_setCollisionFlags(this._btColliderObject,a|I.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}else{if((a&I.COLLISIONFLAGS_NO_CONTACT_RESPONSE)!==0)e.btCollisionObject_setCollisionFlags(this._btColliderObject,a^I.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}}}_onAdded(){super._onAdded();this.isTrigger=this._isTrigger}_cloneTo(t){super._cloneTo(t);t.isTrigger=this._isTrigger}}class J extends t{constructor(t=B.COLLISIONFILTERGROUP_DEFAULTFILTER,e=B.COLLISIONFILTERGROUP_ALLFILTER){super(t,e);this._isKinematic=false;this._mass=1;this._gravity=new St(0,-10,0);this._angularDamping=0;this._linearDamping=0;this._overrideGravity=false;this._totalTorque=new St(0,0,0);this._totalForce=new St(0,0,0);this._linearVelocity=new St;this._angularVelocity=new St;this._linearFactor=new St(1,1,1);this._angularFactor=new St(1,1,1);this._detectCollisions=true;this._controlBySimulation=true}static __init__(){var t=D.Physics3D._bullet;J._btTempVector30=t.btVector3_create(0,0,0);J._btTempVector31=t.btVector3_create(0,0,0);J._btVector3Zero=t.btVector3_create(0,0,0);J._btInertia=t.btVector3_create(0,0,0);J._btImpulse=t.btVector3_create(0,0,0);J._btImpulseOffset=t.btVector3_create(0,0,0);J._btGravity=t.btVector3_create(0,0,0);J._btTransform0=t.btTransform_create()}get mass(){return this._mass}set mass(t){t=Math.max(t,1e-7);this._mass=t;this._isKinematic||this._updateMass(t)}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t;this._controlBySimulation=!t;var e=D.Physics3D._bullet;var a=!!(this._simulation&&this._enabled&&this._colliderShape);a&&this._removeFromSimulation();var i=this._btColliderObject;var r=e.btCollisionObject_getCollisionFlags(i);if(t){r=r|I.COLLISIONFLAGS_KINEMATIC_OBJECT;e.btCollisionObject_setCollisionFlags(i,r);e.btCollisionObject_forceActivationState(this._btColliderObject,I.ACTIVATIONSTATE_DISABLE_DEACTIVATION);this._enableProcessCollisions=false;this._updateMass(0)}else{if((r&I.COLLISIONFLAGS_KINEMATIC_OBJECT)>0)r=r^I.COLLISIONFLAGS_KINEMATIC_OBJECT;e.btCollisionObject_setCollisionFlags(i,r);e.btCollisionObject_setActivationState(this._btColliderObject,I.ACTIVATIONSTATE_ACTIVE_TAG);this._enableProcessCollisions=true;this._updateMass(this._mass)}var s=J._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(i,s);e.btRigidBody_setLinearVelocity(i,s);e.btCollisionObject_setInterpolationAngularVelocity(i,s);e.btRigidBody_setAngularVelocity(i,s);a&&this._addToSimulation()}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t;if(this._btColliderObject)D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,t,this._angularDamping)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t;if(this._btColliderObject)D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,this._linearDamping,t)}get overrideGravity(){return this._overrideGravity}set overrideGravity(t){this._overrideGravity=t;var e=D.Physics3D._bullet;if(this._btColliderObject){var a=e.btRigidBody_getFlags(this._btColliderObject);if(t){if((a&J._BT_DISABLE_WORLD_GRAVITY)===0)e.btRigidBody_setFlags(this._btColliderObject,a|J._BT_DISABLE_WORLD_GRAVITY)}else{if((a&J._BT_DISABLE_WORLD_GRAVITY)>0)e.btRigidBody_setFlags(this._btColliderObject,a^J._BT_DISABLE_WORLD_GRAVITY)}}}get gravity(){var t=D.Physics3D._bullet;J._btGravity=t.btRigidBody_getGravity(this._btColliderObject);F._convertToLayaVec3(J._btGravity,this._gravity,true);return this._gravity}set gravity(t){this._gravity=t;var e=D.Physics3D._bullet;e.btVector3_setValue(J._btGravity,-t.x,t.y,t.z);e.btRigidBody_setGravity(this._btColliderObject,J._btGravity)}get totalForce(){if(this._btColliderObject){var t=D.Physics3D._bullet.btRigidBody_getTotalForce(this._btColliderObject);F._convertToLayaVec3(t,this._totalForce,true);return this._totalForce}return null}get linearFactor(){return this._linearFactor}set linearFactor(t){this._linearFactor=t;var e=J._btTempVector30;F._convertToBulletVec3(t,e,false);D.Physics3D._bullet.btRigidBody_setLinearFactor(this._btColliderObject,e)}get linearVelocity(){if(this._btColliderObject)F._convertToLayaVec3(D.Physics3D._bullet.btRigidBody_getLinearVelocity(this._btColliderObject),this._linearVelocity,true);return this._linearVelocity}set linearVelocity(t){this._linearVelocity=t;if(this._btColliderObject){var e=J._btTempVector30;F._convertToBulletVec3(t,e,true);this.isSleeping&&this.wakeUp();D.Physics3D._bullet.btRigidBody_setLinearVelocity(this._btColliderObject,e)}}get angularFactor(){return this._angularFactor}set angularFactor(t){this._angularFactor=t;var e=J._btTempVector30;F._convertToBulletVec3(t,e,false);D.Physics3D._bullet.btRigidBody_setAngularFactor(this._btColliderObject,e)}get angularVelocity(){if(this._btColliderObject)F._convertToLayaVec3(D.Physics3D._bullet.btRigidBody_getAngularVelocity(this._btColliderObject),this._angularVelocity,true);return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t;if(this._btColliderObject){var e=J._btTempVector30;F._convertToBulletVec3(t,e,true);this.isSleeping&&this.wakeUp();D.Physics3D._bullet.btRigidBody_setAngularVelocity(this._btColliderObject,e)}}get totalTorque(){if(this._btColliderObject){var t=D.Physics3D._bullet.btRigidBody_getTotalTorque(this._btColliderObject);F._convertToLayaVec3(t,this._totalTorque,true);return this._totalTorque}return null}get detectCollisions(){return this._detectCollisions}set detectCollisions(t){if(this._detectCollisions!==t){this._detectCollisions=t;if(this._colliderShape&&this._enabled&&this._simulation){this._simulation._removeRigidBody(this);this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)}}}get isSleeping(){if(this._btColliderObject)return D.Physics3D._bullet.btCollisionObject_getActivationState(this._btColliderObject)===I.ACTIVATIONSTATE_ISLAND_SLEEPING;return false}get sleepLinearVelocity(){return D.Physics3D._bullet.btRigidBody_getLinearSleepingThreshold(this._btColliderObject)}set sleepLinearVelocity(t){var e=D.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,t,e.btRigidBody_getAngularSleepingThreshold(this._btColliderObject))}get sleepAngularVelocity(){return D.Physics3D._bullet.btRigidBody_getAngularSleepingThreshold(this._btColliderObject)}set sleepAngularVelocity(t){var e=D.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,e.btRigidBody_getLinearSleepingThreshold(this._btColliderObject),t)}get btColliderObject(){return this._btColliderObject}set constaintRigidbodyA(t){this._constaintRigidbodyA=t}get constaintRigidbodyA(){return this._constaintRigidbodyA}set constaintRigidbodyB(t){this._constaintRigidbodyB=t}get constaintRigidbodyB(){return this._constaintRigidbodyB}_updateMass(t){if(this._btColliderObject&&this._colliderShape){var e=D.Physics3D._bullet;e.btCollisionShape_calculateLocalInertia(this._colliderShape._btShape,t,J._btInertia);e.btRigidBody_setMassProps(this._btColliderObject,t,J._btInertia);e.btRigidBody_updateInertiaTensor(this._btColliderObject)}}_onScaleChange(t){super._onScaleChange(t);this._updateMass(this._isKinematic?0:this._mass)}_derivePhysicsTransformation(t){var e=D.Physics3D._bullet;var a=this._btColliderObject;var i=e.btCollisionObject_getWorldTransform(a);var r=J._btTransform0;e.btTransform_equal(r,i);this._innerDerivePhysicsTransformation(r,t);e.btRigidBody_setCenterOfMassTransform(a,r)}_onAdded(){var t=D.Physics3D._bullet;var e=t.layaMotionState_create();t.layaMotionState_set_rigidBodyID(e,this._id);this._btLayaMotionState=e;var a=t.btRigidBodyConstructionInfo_create(0,e,null,J._btVector3Zero);var i=t.btRigidBody_create(a);t.btCollisionObject_setUserIndex(i,this.id);this._btColliderObject=i;super._onAdded();this.mass=this._mass;this.linearFactor=this._linearFactor;this.angularFactor=this._angularFactor;this.linearDamping=this._linearDamping;this.angularDamping=this._angularDamping;this.overrideGravity=this._overrideGravity;this.gravity=this._gravity;this.isKinematic=this._isKinematic;t.btRigidBodyConstructionInfo_destroy(a)}_onEnable(){super._onEnable();if(this._constaintRigidbodyA){if(this._constaintRigidbodyA.connectedBody._simulation){this._constaintRigidbodyA._createConstraint();this._constaintRigidbodyA._onEnable()}}if(this._constaintRigidbodyB){if(this._constaintRigidbodyB.ownBody._simulation){this._constaintRigidbodyB._createConstraint();this._constaintRigidbodyB._onEnable()}}}_onShapeChange(t){super._onShapeChange(t);if(this._isKinematic){this._updateMass(0)}else{var e=D.Physics3D._bullet;e.btRigidBody_setCenterOfMassTransform(this._btColliderObject,e.btCollisionObject_getWorldTransform(this._btColliderObject));this._updateMass(this._mass)}}_parse(t){t.friction!=null&&(this.friction=t.friction);t.rollingFriction!=null&&(this.rollingFriction=t.rollingFriction);t.restitution!=null&&(this.restitution=t.restitution);t.isTrigger!=null&&(this.isTrigger=t.isTrigger);t.mass!=null&&(this.mass=t.mass);t.linearDamping!=null&&(this.linearDamping=t.linearDamping);t.angularDamping!=null&&(this.angularDamping=t.angularDamping);t.overrideGravity!=null&&(this.overrideGravity=t.overrideGravity);if(t.linearFactor!=null){var e=this.linearFactor;e.fromArray(t.linearFactor);this.linearFactor=e}if(t.angularFactor!=null){var a=this.angularFactor;a.fromArray(t.angularFactor);this.angularFactor=a}if(t.gravity){this.gravity.fromArray(t.gravity);this.gravity=this.gravity}super._parse(t);this._parseShape(t.shapes);t.isKinematic!=null&&(this.isKinematic=t.isKinematic)}_onDestroy(){D.Physics3D._bullet.btMotionState_destroy(this._btLayaMotionState);super._onDestroy();this._btLayaMotionState=null;this._gravity=null;this._totalTorque=null;this._linearVelocity=null;this._angularVelocity=null;this._linearFactor=null;this._angularFactor=null;if(this.constaintRigidbodyA)this.constaintRigidbodyA._breakConstrained();if(this.constaintRigidbodyB){this.constaintRigidbodyB.connectedBody=null;this.constaintRigidbodyB._onDisable()}}_addToSimulation(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}_removeFromSimulation(){this._simulation._removeRigidBody(this)}_cloneTo(t){super._cloneTo(t);var e=t;e.isKinematic=this._isKinematic;e.mass=this._mass;e.gravity=this._gravity;e.angularDamping=this._angularDamping;e.linearDamping=this._linearDamping;e.overrideGravity=this._overrideGravity;e.linearVelocity=this._linearVelocity;e.angularVelocity=this._angularVelocity;e.linearFactor=this._linearFactor;e.angularFactor=this._angularFactor;e.detectCollisions=this._detectCollisions}applyForce(t,e=null){if(this._btColliderObject==null)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var a=D.Physics3D._bullet;var i=J._btTempVector30;a.btVector3_setValue(i,-t.x,t.y,t.z);if(e){var r=J._btTempVector31;a.btVector3_setValue(r,-e.x,e.y,e.z);a.btRigidBody_applyForce(this._btColliderObject,i,r)}else{a.btRigidBody_applyCentralForce(this._btColliderObject,i)}}applyTorque(t){if(this._btColliderObject==null)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=D.Physics3D._bullet;var a=J._btTempVector30;e.btVector3_setValue(a,-t.x,t.y,t.z);e.btRigidBody_applyTorque(this._btColliderObject,a)}applyImpulse(t,e=null){if(this._btColliderObject==null)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var a=D.Physics3D._bullet;a.btVector3_setValue(J._btImpulse,-t.x,t.y,t.z);if(e){a.btVector3_setValue(J._btImpulseOffset,-e.x,e.y,e.z);a.btRigidBody_applyImpulse(this._btColliderObject,J._btImpulse,J._btImpulseOffset)}else{a.btRigidBody_applyCentralImpulse(this._btColliderObject,J._btImpulse)}}applyTorqueImpulse(t){if(this._btColliderObject==null)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=D.Physics3D._bullet;var a=J._btTempVector30;e.btVector3_setValue(a,-t.x,t.y,t.z);e.btRigidBody_applyTorqueImpulse(this._btColliderObject,a)}wakeUp(){this._btColliderObject&&D.Physics3D._bullet.btCollisionObject_activate(this._btColliderObject,false)}clearForces(){var t=this._btColliderObject;if(t==null)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=D.Physics3D._bullet;e.btRigidBody_clearForces(t);var a=J._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(t,a);e.btRigidBody_setLinearVelocity(t,a);e.btCollisionObject_setInterpolationAngularVelocity(t,a);e.btRigidBody_setAngularVelocity(t,a)}}J.TYPE_STATIC=0;J.TYPE_DYNAMIC=1;J.TYPE_KINEMATIC=2;J._BT_DISABLE_WORLD_GRAVITY=1;J._BT_ENABLE_GYROPSCOPIC_FORCE=2;class ${static __bulletinit__(){this._bullet=window.Physics3D;if(this._bullet){i.__init__();o.__init__();E.__init__();I.__init__();w.__init__();b.__init__();A.__init__();Z.__init__();J.__init__()}}static __cannoninit__(){this._cannon=window.CANNON;if(!this._cannon)return;Et.CannonColliderShape.__init__();Et.CannonPhysicsComponent.__init__();Et.CannonPhysicsSimulation.__init__();Et.CannonBoxColliderShape.__init__();Et.CannonRigidbody3D.__init__()}}$._bullet=null;$._cannon=null;$._enablePhysics=false;class tt{constructor(){this._defaultPhysicsMemory=16;this._maxLightCount=32;this._lightClusterCount=new St(12,12,12);this._editerEnvironment=false;this.isAntialias=true;this.isAlpha=false;this.premultipliedAlpha=true;this.isStencil=true;this.enableMultiLight=true;this.octreeCulling=false;this.octreeInitialSize=64;this.octreeInitialCenter=new St(0,0,0);this.octreeMinNodeSize=2;this.octreeLooseness=1.25;this.debugFrustumCulling=false;this.pbrRenderQuality=H.PBRRenderQuality.High;this.isUseCannonPhysicsEngine=false;this._maxAreaLightCountPerClusterAverage=Math.min(Math.floor(2048/this._lightClusterCount.z-1)*4,this._maxLightCount)}static get useCannonPhysics(){return tt._config.isUseCannonPhysicsEngine}static set useCannonPhysics(t){tt._config.isUseCannonPhysicsEngine=t;if(t){$.__cannoninit__();if(!D.Scene3D.cannonPhysicsSettings)D.Scene3D.cannonPhysicsSettings=new Et.CannonPhysicsSettings}}get defaultPhysicsMemory(){return this._defaultPhysicsMemory}set defaultPhysicsMemory(t){if(t<16)throw"defaultPhysicsMemory must large than 16M";this._defaultPhysicsMemory=t}get maxLightCount(){return this._maxLightCount}set maxLightCount(t){if(t>2048){this._maxLightCount=2048;console.warn("Config3D: maxLightCount must less equal 2048.")}else{this._maxLightCount=t}}get lightClusterCount(){return this._lightClusterCount}set lightClusterCount(t){if(t.x>128||t.y>128||t.z>128){this._lightClusterCount.setValue(Math.min(t.x,128),Math.min(t.y,128),Math.min(t.z,128));console.warn("Config3D: lightClusterCount X and Y、Z must less equal 128.")}else{t.cloneTo(this._lightClusterCount)}var e=Math.floor(2048/this._lightClusterCount.z-1)*4;if(e<this._maxLightCount)console.warn("Config3D: if the area light(PointLight、SpotLight) count is large than "+e+",maybe the far away culster will ingonre some light.");this._maxAreaLightCountPerClusterAverage=Math.min(e,this._maxLightCount)}cloneTo(t){var e=t;e._defaultPhysicsMemory=this._defaultPhysicsMemory;e._editerEnvironment=this._editerEnvironment;e.isAntialias=this.isAntialias;e.isAlpha=this.isAlpha;e.premultipliedAlpha=this.premultipliedAlpha;e.isStencil=this.isStencil;e.octreeCulling=this.octreeCulling;this.octreeInitialCenter.cloneTo(e.octreeInitialCenter);e.octreeInitialSize=this.octreeInitialSize;e.octreeMinNodeSize=this.octreeMinNodeSize;e.octreeLooseness=this.octreeLooseness;e.debugFrustumCulling=this.debugFrustumCulling;e.maxLightCount=this.maxLightCount;e.enableMultiLight=this.enableMultiLight;var a=e.lightClusterCount;this.lightClusterCount.cloneTo(a);e.lightClusterCount=a;e.pbrRenderQuality=this.pbrRenderQuality}clone(){var t=new tt;this.cloneTo(t);return t}}tt._config=new tt;window.Config3D=tt;class et{constructor(){this._ownerPath=[];this._propertys=[];this._keyFrames=[]}get ownerPathCount(){return this._ownerPath.length}get propertyCount(){return this._propertys.length}get keyFramesCount(){return this._keyFrames.length}_setOwnerPathCount(t){this._ownerPath.length=t}_setOwnerPathByIndex(t,e){this._ownerPath[t]=e}_joinOwnerPath(t){return this._ownerPath.join(t)}_setPropertyCount(t){this._propertys.length=t}_setPropertyByIndex(t,e){this._propertys[t]=e}_joinProperty(t){return this._propertys.join(t)}_setKeyframeCount(t){this._keyFrames.length=t}_setKeyframeByIndex(t,e){this._keyFrames[t]=e}getOwnerPathByIndex(t){return this._ownerPath[t]}getPropertyByIndex(t){return this._propertys[t]}getKeyframeByIndex(t){return this._keyFrames[t]}}class at{constructor(){}}class it{constructor(){}cloneTo(t){var e=t;e.time=this.time}clone(){var t=new it;this.cloneTo(t);return t}}class rt extends it{constructor(){super()}cloneTo(t){super.cloneTo(t);var e=t;e.inTangent=this.inTangent;e.outTangent=this.outTangent;e.value=this.value}}class st extends it{constructor(){super();this.inTangent=new bt;this.outTangent=new bt;this.value=new M}cloneTo(t){super.cloneTo(t);var e=t;this.inTangent.cloneTo(e.inTangent);this.outTangent.cloneTo(e.outTangent);this.value.cloneTo(e.value)}}class nt extends it{constructor(){super();this.inTangent=new St;this.outTangent=new St;this.value=new St}cloneTo(t){super.cloneTo(t);var e=t;this.inTangent.cloneTo(e.inTangent);this.outTangent.cloneTo(e.outTangent);this.value.cloneTo(e.value)}}class ot{static READ_DATA(){ot._DATA.offset=ot._reader.getUint32();ot._DATA.size=ot._reader.getUint32()}static READ_BLOCK(){var t=ot._BLOCK.count=ot._reader.getUint16();var e=ot._BLOCK.blockStarts=[];var a=ot._BLOCK.blockLengths=[];for(var i=0;i<t;i++){e.push(ot._reader.getUint32());a.push(ot._reader.getUint32())}}static READ_STRINGS(){var t=ot._reader.getUint32();var e=ot._reader.getUint16();var a=ot._reader.pos;ot._reader.pos=t+ot._DATA.offset;for(var i=0;i<e;i++)ot._strings[i]=ot._reader.readUTFString();ot._reader.pos=a}static parse(t,e){ot._animationClip=t;ot._reader=e;var a=e.__getBuffer();ot.READ_DATA();ot.READ_BLOCK();ot.READ_STRINGS();for(var i=0,r=ot._BLOCK.count;i<r;i++){var s=e.getUint16();var n=ot._strings[s];var o=ot["READ_"+n];if(o==null)throw new Error("model file err,no this function:"+s+" "+n);else o.call(null)}}static READ_ANIMATIONS(){var t,e;var a;var i=ot._reader;var r=i.__getBuffer();var s=[];var n=i.getUint16();s.length=n;for(t=0;t<n;t++)s[t]=i.getFloat32();var o=ot._animationClip;o.name=ot._strings[i.getUint16()];var l=o._duration=i.getFloat32();o.islooping=!!i.getByte();o._frameRate=i.getInt16();var _=i.getInt16();var h=o._nodes;h.count=_;var x=o._nodesMap={};var c=o._nodesDic={};for(t=0;t<_;t++){a=new et;h.setNodeByIndex(t,a);a._indexInList=t;var d=a.type=i.getUint8();var u=i.getUint16();a._setOwnerPathCount(u);for(e=0;e<u;e++)a._setOwnerPathByIndex(e,ot._strings[i.getUint16()]);var f=a._joinOwnerPath("/");var p=x[f];p||(x[f]=p=[]);p.push(a);a.propertyOwner=ot._strings[i.getUint16()];var m=i.getUint16();a._setPropertyCount(m);for(e=0;e<m;e++)a._setPropertyByIndex(e,ot._strings[i.getUint16()]);var g=f+"."+a.propertyOwner+"."+a._joinProperty(".");c[g]=a;a.fullPath=g;var v=i.getUint16();a._setKeyframeCount(v);var y;for(e=0;e<v;e++){switch(d){case 0:var T=new rt;a._setKeyframeByIndex(e,T);y=T.time=s[i.getUint16()];T.inTangent=i.getFloat32();T.outTangent=i.getFloat32();T.value=i.getFloat32();break;case 1:case 3:case 4:var E=new nt;a._setKeyframeByIndex(e,E);y=E.time=s[i.getUint16()];var b=E.inTangent;var S=E.outTangent;var C=E.value;b.x=i.getFloat32();b.y=i.getFloat32();b.z=i.getFloat32();S.x=i.getFloat32();S.y=i.getFloat32();S.z=i.getFloat32();C.x=i.getFloat32();C.y=i.getFloat32();C.z=i.getFloat32();break;case 2:var R=new st;a._setKeyframeByIndex(e,R);y=R.time=s[i.getUint16()];var A=R.inTangent;var L=R.outTangent;var I=R.value;A.x=i.getFloat32();A.y=i.getFloat32();A.z=i.getFloat32();A.w=i.getFloat32();L.x=i.getFloat32();L.y=i.getFloat32();L.z=i.getFloat32();L.w=i.getFloat32();I.x=i.getFloat32();I.y=i.getFloat32();I.z=i.getFloat32();I.w=i.getFloat32();break;default:throw"AnimationClipParser03:unknown type."}}}var M=i.getUint16();for(t=0;t<M;t++){var D=new at;D.time=Math.min(l,i.getFloat32());D.eventName=ot._strings[i.getUint16()];var w;var P=i.getUint16();P>0&&(D.params=w=[]);for(e=0;e<P;e++){var O=i.getByte();switch(O){case 0:w.push(!!i.getByte());break;case 1:w.push(i.getInt32());break;case 2:w.push(i.getFloat32());break;case 3:w.push(ot._strings[i.getUint16()]);break;default:throw new Error("unknown type.")}}o.addEvent(D)}}}ot._strings=[];ot._BLOCK={count:0};ot._DATA={offset:0,size:0};class lt{static READ_DATA(){lt._DATA.offset=lt._reader.getUint32();lt._DATA.size=lt._reader.getUint32()}static READ_BLOCK(){var t=lt._BLOCK.count=lt._reader.getUint16();var e=lt._BLOCK.blockStarts=[];var a=lt._BLOCK.blockLengths=[];for(var i=0;i<t;i++){e.push(lt._reader.getUint32());a.push(lt._reader.getUint32())}}static READ_STRINGS(){var t=lt._reader.getUint32();var e=lt._reader.getUint16();var a=lt._reader.pos;lt._reader.pos=t+lt._DATA.offset;for(var i=0;i<e;i++)lt._strings[i]=lt._reader.readUTFString();lt._reader.pos=a}static parse(t,e,a){lt._animationClip=t;lt._reader=e;lt._version=a;lt.READ_DATA();lt.READ_BLOCK();lt.READ_STRINGS();for(var i=0,r=lt._BLOCK.count;i<r;i++){var s=e.getUint16();var n=lt._strings[s];var o=lt["READ_"+n];if(o==null)throw new Error("model file err,no this function:"+s+" "+n);else o.call(null)}lt._version=null;lt._reader=null;lt._animationClip=null}static READ_ANIMATIONS(){var t,e;var a;var i=lt._reader;var r=i.__getBuffer();var s=[];var n=i.getUint16();s.length=n;for(t=0;t<n;t++)s[t]=i.getFloat32();var o=lt._animationClip;o.name=lt._strings[i.getUint16()];var l=o._duration=i.getFloat32();o.islooping=!!i.getByte();o._frameRate=i.getInt16();var _=i.getInt16();var h=o._nodes;h.count=_;var x=o._nodesMap={};var c=o._nodesDic={};for(t=0;t<_;t++){a=new et;h.setNodeByIndex(t,a);a._indexInList=t;var d=a.type=i.getUint8();var u=i.getUint16();a._setOwnerPathCount(u);for(e=0;e<u;e++)a._setOwnerPathByIndex(e,lt._strings[i.getUint16()]);var f=a._joinOwnerPath("/");var p=x[f];p||(x[f]=p=[]);p.push(a);a.propertyOwner=lt._strings[i.getUint16()];var m=i.getUint16();a._setPropertyCount(m);for(e=0;e<m;e++)a._setPropertyByIndex(e,lt._strings[i.getUint16()]);var g=f+"."+a.propertyOwner+"."+a._joinProperty(".");c[g]=a;a.fullPath=g;var v=i.getUint16();a._setKeyframeCount(v);var y;switch(lt._version){case"LAYAANIMATION:04":for(e=0;e<v;e++){switch(d){case 0:var T=new rt;a._setKeyframeByIndex(e,T);y=T.time=s[i.getUint16()];T.inTangent=i.getFloat32();T.outTangent=i.getFloat32();T.value=i.getFloat32();break;case 1:case 3:case 4:var E=new nt;a._setKeyframeByIndex(e,E);y=E.time=s[i.getUint16()];var b=E.inTangent;var S=E.outTangent;var C=E.value;b.x=i.getFloat32();b.y=i.getFloat32();b.z=i.getFloat32();S.x=i.getFloat32();S.y=i.getFloat32();S.z=i.getFloat32();C.x=i.getFloat32();C.y=i.getFloat32();C.z=i.getFloat32();break;case 2:var R=new st;a._setKeyframeByIndex(e,R);y=R.time=s[i.getUint16()];var A=R.inTangent;var L=R.outTangent;var I=R.value;A.x=i.getFloat32();A.y=i.getFloat32();A.z=i.getFloat32();A.w=i.getFloat32();L.x=i.getFloat32();L.y=i.getFloat32();L.z=i.getFloat32();L.w=i.getFloat32();I.x=i.getFloat32();I.y=i.getFloat32();I.z=i.getFloat32();I.w=i.getFloat32();break;default:throw"AnimationClipParser04:unknown type."}}break;case"LAYAANIMATION:COMPRESSION_04":for(e=0;e<v;e++){switch(d){case 0:T=new rt;a._setKeyframeByIndex(e,T);y=T.time=s[i.getUint16()];T.inTangent=Et.HalfFloatUtils.convertToNumber(i.getUint16());T.outTangent=Et.HalfFloatUtils.convertToNumber(i.getUint16());T.value=Et.HalfFloatUtils.convertToNumber(i.getUint16());break;case 1:case 3:case 4:E=new nt;a._setKeyframeByIndex(e,E);y=E.time=s[i.getUint16()];b=E.inTangent;S=E.outTangent;C=E.value;b.x=Et.HalfFloatUtils.convertToNumber(i.getUint16());b.y=Et.HalfFloatUtils.convertToNumber(i.getUint16());b.z=Et.HalfFloatUtils.convertToNumber(i.getUint16());S.x=Et.HalfFloatUtils.convertToNumber(i.getUint16());S.y=Et.HalfFloatUtils.convertToNumber(i.getUint16());S.z=Et.HalfFloatUtils.convertToNumber(i.getUint16());C.x=Et.HalfFloatUtils.convertToNumber(i.getUint16());C.y=Et.HalfFloatUtils.convertToNumber(i.getUint16());C.z=Et.HalfFloatUtils.convertToNumber(i.getUint16());break;case 2:R=new st;a._setKeyframeByIndex(e,R);y=R.time=s[i.getUint16()];A=R.inTangent;L=R.outTangent;I=R.value;A.x=Et.HalfFloatUtils.convertToNumber(i.getUint16());A.y=Et.HalfFloatUtils.convertToNumber(i.getUint16());A.z=Et.HalfFloatUtils.convertToNumber(i.getUint16());A.w=Et.HalfFloatUtils.convertToNumber(i.getUint16());L.x=Et.HalfFloatUtils.convertToNumber(i.getUint16());L.y=Et.HalfFloatUtils.convertToNumber(i.getUint16());L.z=Et.HalfFloatUtils.convertToNumber(i.getUint16());L.w=Et.HalfFloatUtils.convertToNumber(i.getUint16());I.x=Et.HalfFloatUtils.convertToNumber(i.getUint16());I.y=Et.HalfFloatUtils.convertToNumber(i.getUint16());I.z=Et.HalfFloatUtils.convertToNumber(i.getUint16());I.w=Et.HalfFloatUtils.convertToNumber(i.getUint16());break;default:throw"AnimationClipParser04:unknown type."}}break}}var M=i.getUint16();for(t=0;t<M;t++){var D=new at;D.time=Math.min(l,i.getFloat32());D.eventName=lt._strings[i.getUint16()];var w;var P=i.getUint16();P>0&&(D.params=w=[]);for(e=0;e<P;e++){var O=i.getByte();switch(O){case 0:w.push(!!i.getByte());break;case 1:w.push(i.getInt32());break;case 2:w.push(i.getFloat32());break;case 3:w.push(lt._strings[i.getUint16()]);break;default:throw new Error("unknown type.")}}o.addEvent(D)}}}lt._strings=[];lt._BLOCK={count:0};lt._DATA={offset:0,size:0};class _t{constructor(){this._nodes=[]}get count(){return this._nodes.length}set count(t){this._nodes.length=t}getNodeByIndex(t){return this._nodes[t]}setNodeByIndex(t,e){this._nodes[t]=e}}class ht extends Et.Resource{constructor(){super();this._nodes=new _t;this._animationEvents=[]}static _parse(t,e=null,a=null){var i=new ht;var r=new Et.Byte(t);var s=r.readUTFString();switch(s){case"LAYAANIMATION:03":ot.parse(i,r);break;case"LAYAANIMATION:04":case"LAYAANIMATION:COMPRESSION_04":lt.parse(i,r,s);break;default:throw"unknown animationClip version."}return i}static load(t,e){Et.ILaya.loader.create(t,e,null,ht.ANIMATIONCLIP)}duration(){return this._duration}_hermiteInterpolate(t,e,a,i){var r=t.outTangent,s=e.inTangent;if(Number.isFinite(r)&&Number.isFinite(s)){var n=a*a;var o=n*a;var l=2*o-3*n+1;var _=o-2*n+a;var h=o-n;var x=-2*o+3*n;return l*t.value+_*r*i+h*s*i+x*e.value}else return t.value}_hermiteInterpolateVector3(t,e,a,i,r){var s=t.value;var n=t.outTangent;var o=e.value;var l=e.inTangent;var _=a*a;var h=_*a;var x=2*h-3*_+1;var c=h-2*_+a;var d=h-_;var u=-2*h+3*_;var f=n.x,p=l.x;if(Number.isFinite(f)&&Number.isFinite(p))r.x=x*s.x+c*f*i+d*p*i+u*o.x;else r.x=s.x;f=n.y,p=l.y;if(Number.isFinite(f)&&Number.isFinite(p))r.y=x*s.y+c*f*i+d*p*i+u*o.y;else r.y=s.y;f=n.z,p=l.z;if(Number.isFinite(f)&&Number.isFinite(p))r.z=x*s.z+c*f*i+d*p*i+u*o.z;else r.z=s.z}_hermiteInterpolateQuaternion(t,e,a,i,r){var s=t.value;var n=t.outTangent;var o=e.value;var l=e.inTangent;var _=a*a;var h=_*a;var x=2*h-3*_+1;var c=h-2*_+a;var d=h-_;var u=-2*h+3*_;var f=n.x,p=l.x;if(Number.isFinite(f)&&Number.isFinite(p))r.x=x*s.x+c*f*i+d*p*i+u*o.x;else r.x=s.x;f=n.y,p=l.y;if(Number.isFinite(f)&&Number.isFinite(p))r.y=x*s.y+c*f*i+d*p*i+u*o.y;else r.y=s.y;f=n.z,p=l.z;if(Number.isFinite(f)&&Number.isFinite(p))r.z=x*s.z+c*f*i+d*p*i+u*o.z;else r.z=s.z;f=n.w,p=l.w;if(Number.isFinite(f)&&Number.isFinite(p))r.w=x*s.w+c*f*i+d*p*i+u*o.w;else r.w=s.w}_evaluateClipDatasRealTime(t,e,a,i,r,s){for(var n=0,o=t.count;n<o;n++){var l=t.getNodeByIndex(n);var _=l.type;var h;var x=l._keyFrames;var c=x.length;var d=a[n];if(r){if(d!==-1&&e<x[d].time){d=-1;a[n]=d}h=d+1;while(h<c){if(x[h].time>e)break;d++;h++;a[n]=d}}else{h=d+1;if(h!==c&&e>x[h].time){d=c-1;a[n]=d}h=d+1;while(d>-1){if(x[d].time<e)break;d--;h--;a[n]=d}}var u=h===c;switch(_){case 0:if(d!==-1){var f=x[d];if(u){s[n]=f.value}else{var p=x[h];var m=p.time-f.time;var g;if(m!==0)g=(e-f.time)/m;else g=0;s[n]=this._hermiteInterpolate(f,p,g,m)}}else{s[n]=x[0].value}if(i)s[n]=s[n]-x[0].value;break;case 1:case 4:var v=s[n];this._evaluateFrameNodeVector3DatasRealTime(x,d,u,e,v);if(i){var y=x[0].value;v.x-=y.x;v.y-=y.y;v.z-=y.z}break;case 2:var T=s[n];this._evaluateFrameNodeQuaternionDatasRealTime(x,d,u,e,T);if(i){var E=ht._tempQuaternion0;var b=x[0].value;F.quaternionConjugate(b,E);M.multiply(E,T,T)}break;case 3:v=s[n];this._evaluateFrameNodeVector3DatasRealTime(x,d,u,e,v);if(i){y=x[0].value;v.x/=y.x;v.y/=y.y;v.z/=y.z}break;default:throw"AnimationClip:unknown node type."}}}_evaluateClipDatasRealTimeForNative(t,e,a,i){Et.LayaGL.instance.evaluateClipDatasRealTime(t._nativeObj,e,a,i)}_evaluateFrameNodeVector3DatasRealTime(t,e,a,i,r){if(e!==-1){var s=t[e];if(a){var n=s.value;r.x=n.x;r.y=n.y;r.z=n.z}else{var o=t[e+1];var l;var _=s.time;var h=o.time-_;if(h!==0)l=(i-_)/h;else l=0;this._hermiteInterpolateVector3(s,o,l,h,r)}}else{var x=t[0].value;r.x=x.x;r.y=x.y;r.z=x.z}}_evaluateFrameNodeQuaternionDatasRealTime(t,e,a,i,r){if(e!==-1){var s=t[e];if(a){var n=s.value;r.x=n.x;r.y=n.y;r.z=n.z;r.w=n.w}else{var o=t[e+1];var l;var _=s.time;var h=o.time-_;if(h!==0)l=(i-_)/h;else l=0;this._hermiteInterpolateQuaternion(s,o,l,h,r)}}else{var x=t[0].value;r.x=x.x;r.y=x.y;r.z=x.z;r.w=x.w}}_binarySearchEventIndex(t){var e=0;var a=this._animationEvents.length-1;var i;while(e<=a){i=Math.floor((e+a)/2);var r=this._animationEvents[i].time;if(r==t)return i;else if(r>t)a=i-1;else e=i+1}return e}addEvent(t){var e=this._binarySearchEventIndex(t.time);this._animationEvents.splice(e,0,t)}_disposeResource(){this._nodes=null;this._nodesMap=null}}ht.ANIMATIONCLIP="ANIMATIONCLIP";ht._tempQuaternion0=new M;class xt{constructor(){this._currentState=null}get normalizedTime(){return this._normalizedTime}get duration(){return this._duration}get animatorState(){return this._currentState}_resetPlayState(t){this._finish=false;this._startPlayTime=t;this._elapsedTime=t;this._playEventIndex=0;this._lastIsFront=true}_cloneTo(t){t._finish=this._finish;t._startPlayTime=this._startPlayTime;t._elapsedTime=this._elapsedTime;t._normalizedTime=this._normalizedTime;t._normalizedPlayTime=this._normalizedPlayTime;t._playEventIndex=this._playEventIndex;t._lastIsFront=this._lastIsFront}}class ct{constructor(t){this._defaultState=null;this._referenceCount=0;this._playType=-1;this._crossDuration=-1;this._crossMark=0;this._crossNodesOwnersCount=0;this._crossNodesOwners=[];this._crossNodesOwnersIndicesMap={};this._srcCrossClipNodeIndices=[];this._destCrossClipNodeIndices=[];this._statesMap={};this._states=[];this._playStateInfo=new xt;this._crossPlayStateInfo=new xt;this.blendingMode=ct.BLENDINGMODE_OVERRIDE;this.defaultWeight=1;this.playOnWake=true;this.name=t}get defaultState(){return this._defaultState}set defaultState(t){this._defaultState=t;this._statesMap[t.name]=t}_removeClip(t,e,a,i){var r=i._clip;var s=t[a];t.splice(a,1);delete e[i.name];if(this._animator){var n=r._nodes;var o=s._nodeOwners;r._removeReference();for(var l=0,_=n.count;l<_;l++)this._animator._removeKeyframeNodeOwner(o,n.getNodeByIndex(l))}}_getReferenceCount(){return this._referenceCount}_addReference(t=1){for(var e=0,a=this._states.length;e<a;e++)this._states[e]._addReference(t);this._referenceCount+=t}_removeReference(t=1){for(var e=0,a=this._states.length;e<a;e++)this._states[e]._removeReference(t);this._referenceCount-=t}_clearReference(){this._removeReference(-this._referenceCount)}getCurrentPlayState(){return this._playStateInfo}getAnimatorState(t){var e=this._statesMap[t];return e?e:null}addState(t){var e=t.name;if(this._statesMap[e]){throw"AnimatorControllerLayer:this stat's name has exist."}else{this._statesMap[e]=t;this._states.push(t);if(this._animator){t._clip._addReference();this._animator._getOwnersByClip(t)}}}removeState(t){var e=this._states;var a=-1;for(var i=0,r=e.length;i<r;i++){if(e[i]===t){a=i;break}}if(a!==-1)this._removeClip(e,this._statesMap,a,t)}destroy(){this._clearReference();this._statesMap=null;this._states=null;this._playStateInfo=null;this._crossPlayStateInfo=null;this._defaultState=null}cloneTo(t){var e=t;e.name=this.name;e.blendingMode=this.blendingMode;e.defaultWeight=this.defaultWeight;e.playOnWake=this.playOnWake}clone(){var t=new ct(this.name);this.cloneTo(t);return t}}ct.BLENDINGMODE_OVERRIDE=0;ct.BLENDINGMODE_ADDTIVE=1;class dt{constructor(){this._referenceCount=0;this._clip=null;this._nodeOwners=[];this._currentFrameIndices=null;this._realtimeDatas=[];this._scripts=null;this.speed=1;this.clipStart=0;this.clipEnd=1}get clip(){return this._clip}set clip(t){if(this._clip!==t){if(this._clip)this._referenceCount>0&&this._clip._removeReference(this._referenceCount);if(t){var e=this._realtimeDatas;var a=t._nodes;var i=a.count;this._currentFrameIndices=new Int16Array(i);this._resetFrameIndices();this._referenceCount>0&&t._addReference(this._referenceCount);this._realtimeDatas.length=i;for(var r=0;r<i;r++){switch(a.getNodeByIndex(r).type){case 0:break;case 1:case 3:case 4:e[r]=new St;break;case 2:e[r]=new M;break;default:throw"AnimationClipParser04:unknown type."}}}this._clip=t}}_getReferenceCount(){return this._referenceCount}_addReference(t=1){this._clip&&this._clip._addReference(t);this._referenceCount+=t}_removeReference(t=1){this._clip&&this._clip._removeReference(t);this._referenceCount-=t}_clearReference(){this._removeReference(-this._referenceCount)}_resetFrameIndices(){for(var t=0,e=this._currentFrameIndices.length;t<e;t++)this._currentFrameIndices[t]=-1}addScript(t){var e=new t;this._scripts=this._scripts||[];this._scripts.push(e);return e}getScript(t){if(this._scripts){for(var e=0,a=this._scripts.length;e<a;e++){var i=this._scripts[e];if(i instanceof t)return i}}return null}getScripts(t){var e;if(this._scripts){for(var a=0,i=this._scripts.length;a<i;a++){var r=this._scripts[a];if(r instanceof t){e=e||[];e.push(r)}}}return e}cloneTo(t){var e=t;e.name=this.name;e.speed=this.speed;e.clipStart=this.clipStart;e.clipEnd=this.clipEnd;e.clip=this._clip}clone(){var t=new dt;this.cloneTo(t);return t}}class ut{constructor(){this.indexInList=-1;this.referenceCount=0;this.updateMark=-1;this.type=-1;this.fullPath=null;this.propertyOwner=null;this.property=null;this.defaultValue=null;this.value=null;this.crossFixedValue=null}saveCrossFixedValue(){var t=this.propertyOwner;if(t){switch(this.type){case 0:this.crossFixedValue=this.value;break;case 1:case 3:case 4:this.value.cloneTo(this.crossFixedValue);break;case 2:this.value.cloneTo(this.crossFixedValue);break;default:throw"Animator:unknown type."}}}}class ft extends Et.Component{constructor(){super();this._keyframeNodeOwners=[];this._linkAvatarSpritesData={};this._linkAvatarSprites=[];this._renderableSprites=[];this.cullingMode=ft.CULLINGMODE_CULLCOMPLETELY;this._controllerLayers=[];this._linkSprites={};this._speed=1;this._keyframeNodeOwnerMap={};this._updateMark=0}static _update(t){var e=t._animatorPool;var a=e.elements;for(var i=0,r=e.length;i<r;i++){var s=a[i];s&&s.enabled&&s._update()}}get speed(){return this._speed}set speed(t){this._speed=t}_linkToSprites(t){for(var e in t){var a=this.owner;var i=t[e];for(var r=0,s=i.length;r<s;r++){var n=i[r];if(n===""){break}else{a=a.getChildByName(n);if(!a)break}}a&&this.linkSprite3DToAvatarNode(e,a)}}_addKeyframeNodeOwner(t,e,a){var i=e._indexInList;var r=e.fullPath;var s=this._keyframeNodeOwnerMap[r];if(s){s.referenceCount++;t[i]=s}else{var n=a;for(var o=0,l=e.propertyCount;o<l;o++){n=n[e.getPropertyByIndex(o)];if(!n)break}s=this._keyframeNodeOwnerMap[r]=new ut;s.fullPath=r;s.indexInList=this._keyframeNodeOwners.length;s.referenceCount=1;s.propertyOwner=a;var _=e.propertyCount;var h=[];for(o=0;o<_;o++)h[o]=e.getPropertyByIndex(o);s.property=h;s.type=e.type;if(n){if(e.type===0){s.defaultValue=n}else{var x=new n.constructor;n.cloneTo(x);s.defaultValue=x;s.value=new n.constructor;s.crossFixedValue=new n.constructor}}this._keyframeNodeOwners.push(s);t[i]=s}}_removeKeyframeNodeOwner(t,e){var a=e.fullPath;var i=this._keyframeNodeOwnerMap[a];if(i){i.referenceCount--;if(i.referenceCount===0){delete this._keyframeNodeOwnerMap[a];this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(i),1)}t[e._indexInList]=null}}_getOwnersByClip(t){var e=t._clip._nodes;var a=e.count;var i=t._nodeOwners;i.length=a;for(var r=0;r<a;r++){var s=e.getNodeByIndex(r);var n=this._avatar?this._avatarNodeMap[this._avatar._rootNode.name]:this.owner;for(var o=0,l=s.ownerPathCount;o<l;o++){var _=s.getOwnerPathByIndex(o);if(_===""){break}else{n=n.getChildByName(_);if(!n)break}}if(n){var h=s.propertyOwner;h&&(n=n[h]);n&&this._addKeyframeNodeOwner(i,s,n)}}}_updatePlayer(t,e,a,i){var r=t._clip._duration*(t.clipEnd-t.clipStart);var s=e._elapsedTime;var n=s+a;e._lastElapsedTime=s;e._elapsedTime=n;var o=n/r;e._normalizedTime=o;var l=o%1;e._normalizedPlayTime=l<0?l+1:l;e._duration=r;var _=t._scripts;if(!i&&n>=r){e._finish=true;e._elapsedTime=r;e._normalizedPlayTime=1;if(_){for(var h=0,x=_.length;h<x;h++)_[h].onStateExit()}return}if(_){for(h=0,x=_.length;h<x;h++)_[h].onStateUpdate()}}_eventScript(t,e,a,i,r){if(r){for(var s=e.length;a<s;a++){var n=e[a];if(n.time<=i){for(var o=0,l=t.length;o<l;o++){var _=t[o];var h=_[n.eventName];h&&h.apply(_,n.params)}}else{break}}}else{for(;a>=0;a--){n=e[a];if(n.time>=i){for(o=0,l=t.length;o<l;o++){_=t[o];h=_[n.eventName];h&&h.apply(_,n.params)}}else{break}}}return a}_updateEventScript(t,e){var a=this.owner._scripts;if(a){var i=t._clip;var r=i._animationEvents;var s=i._duration;var n=e._elapsedTime;var o=n%s;var l=Math.abs(Math.floor(n/s)-Math.floor(e._lastElapsedTime/s));var _=e._elapsedTime>=e._lastElapsedTime;if(e._lastIsFront!==_){if(_)e._playEventIndex++;else e._playEventIndex--;e._lastIsFront=_}var h=e._playEventIndex;if(_){var x=this._eventScript(a,r,e._playEventIndex,l>0?s:o,true);h===e._playEventIndex&&(e._playEventIndex=x);for(var c=0,d=l-1;c<d;c++)this._eventScript(a,r,0,s,true);l>0&&o>0&&(e._playEventIndex=this._eventScript(a,r,0,o,true))}else{var x=this._eventScript(a,r,e._playEventIndex,l>0?0:o,false);h===e._playEventIndex&&(e._playEventIndex=x);var u=r.length-1;for(c=0,d=l-1;c<d;c++)this._eventScript(a,r,u,0,false);l>0&&o>0&&(e._playEventIndex=this._eventScript(a,r,u,o,false))}}}_updateClipDatas(t,e,a,i){var r=t._clip;var s=r._duration;var n=t.clipStart*s+a._normalizedPlayTime*a._duration;var o=t._currentFrameIndices;var l=a._elapsedTime>a._lastElapsedTime;r._evaluateClipDatasRealTime(r._nodes,n,o,e,l,t._realtimeDatas)}_applyFloat(t,e,a,i,r,s,n){if(a.updateMark===this._updateMark){if(i){t[e]+=r*n}else{var o=t[e];t[e]=o+r*(n-o)}}else{if(s){if(i)t[e]=a.defaultValue+n;else t[e]=n}else{if(i){t[e]=a.defaultValue+r*n}else{var l=a.defaultValue;t[e]=l+r*(n-l)}}}}_applyPositionAndRotationEuler(t,e,a,i,r,s){if(t.updateMark===this._updateMark){if(e){s.x+=a*r.x;s.y+=a*r.y;s.z+=a*r.z}else{var n=s.x;var o=s.y;var l=s.z;s.x=n+a*(r.x-n);s.y=o+a*(r.y-o);s.z=l+a*(r.z-l)}}else{if(i){if(e){var _=t.defaultValue;s.x=_.x+r.x;s.y=_.y+r.y;s.z=_.z+r.z}else{s.x=r.x;s.y=r.y;s.z=r.z}}else{_=t.defaultValue;if(e){s.x=_.x+a*r.x;s.y=_.y+a*r.y;s.z=_.z+a*r.z}else{var h=_.x;var x=_.y;var c=_.z;s.x=h+a*(r.x-h);s.y=x+a*(r.y-x);s.z=c+a*(r.z-c)}}}}_applyRotation(t,e,a,i,r,s){if(t.updateMark===this._updateMark){if(e){var n=ft._tempQuaternion1;F.quaternionWeight(r,a,n);n.normalize(n);M.multiply(s,n,s)}else{M.lerp(s,r,a,s)}}else{if(i){if(e){var o=t.defaultValue;M.multiply(o,r,s)}else{s.x=r.x;s.y=r.y;s.z=r.z;s.w=r.w}}else{o=t.defaultValue;if(e){n=ft._tempQuaternion1;F.quaternionWeight(r,a,n);n.normalize(n);M.multiply(o,n,s)}else{M.lerp(o,r,a,s)}}}}_applyScale(t,e,a,i,r,s){if(t.updateMark===this._updateMark){if(e){var n=ft._tempVector31;F.scaleWeight(r,a,n);s.x=s.x*n.x;s.y=s.y*n.y;s.z=s.z*n.z}else{F.scaleBlend(s,r,a,s)}}else{if(i){if(e){var o=t.defaultValue;s.x=o.x*r.x;s.y=o.y*r.y;s.z=o.z*r.z}else{s.x=r.x;s.y=r.y;s.z=r.z}}else{o=t.defaultValue;if(e){n=ft._tempVector31;F.scaleWeight(r,a,n);s.x=o.x*n.x;s.y=o.y*n.y;s.z=o.z*n.z}else{F.scaleBlend(o,r,a,s)}}}}_applyCrossData(t,e,a,i,r,s,n){var o=t.propertyOwner;if(o){switch(t.type){case 0:var l=t.property;var _=l.length-1;for(var h=0;h<_;h++){o=o[l[h]];if(!o)break}var x=r+n*(s-r);t.value=x;this._applyFloat(o,l[_],t,e,a,i,x);break;case 1:var c=o.localPosition;var d=t.value;var u=r.x,f=r.y,p=r.z;d.x=u+n*(s.x-u);d.y=f+n*(s.y-f);d.z=p+n*(s.z-p);this._applyPositionAndRotationEuler(t,e,a,i,d,c);o.localPosition=c;break;case 2:var m=o.localRotation;var g=t.value;M.lerp(r,s,n,g);this._applyRotation(t,e,a,i,g,m);o.localRotation=m;break;case 3:var v=o.localScale;var y=t.value;F.scaleBlend(r,s,n,y);this._applyScale(t,e,a,i,y,v);o.localScale=v;break;case 4:var T=o.localRotationEuler;var E=t.value;u=r.x,f=r.y,p=r.z;E.x=u+n*(s.x-u);E.y=f+n*(s.y-f);E.z=p+n*(s.z-p);this._applyPositionAndRotationEuler(t,e,a,i,E,T);o.localRotationEuler=T;break}t.updateMark=this._updateMark}}_setClipDatasToNode(t,e,a,i){var r=t._realtimeDatas;var s=t._clip._nodes;var n=t._nodeOwners;for(var o=0,l=s.count;o<l;o++){var _=n[o];if(_){var h=_.propertyOwner;if(h){switch(_.type){case 0:var x=_.property;var c=x.length-1;for(var d=0;d<c;d++){h=h[x[d]];if(!h)break}this._applyFloat(h,x[c],_,e,a,i,r[o]);break;case 1:var u=h.localPosition;this._applyPositionAndRotationEuler(_,e,a,i,r[o],u);h.localPosition=u;break;case 2:var f=h.localRotation;this._applyRotation(_,e,a,i,r[o],f);h.localRotation=f;break;case 3:var p=h.localScale;this._applyScale(_,e,a,i,r[o],p);h.localScale=p;break;case 4:var m=h.localRotationEuler;this._applyPositionAndRotationEuler(_,e,a,i,r[o],m);h.localRotationEuler=m;break}_.updateMark=this._updateMark}}}}_setCrossClipDatasToNode(t,e,a,i,r){var s=t._crossNodesOwners;var n=t._crossNodesOwnersCount;var o=t.blendingMode!==ct.BLENDINGMODE_OVERRIDE;var l=t.defaultWeight;var _=a._realtimeDatas;var h=t._destCrossClipNodeIndices;var x=a._nodeOwners;var c=e._realtimeDatas;var d=t._srcCrossClipNodeIndices;var u=e._nodeOwners;for(var f=0;f<n;f++){var p=s[f];if(p){var m=d[f];var g=h[f];var v=m!==-1?c[m]:x[g].defaultValue;var y=g!==-1?_[g]:u[m].defaultValue;this._applyCrossData(p,o,l,r,v,y,i)}}}_setFixedCrossClipDatasToNode(t,e,a,i){var r=t._crossNodesOwners;var s=t._crossNodesOwnersCount;var n=t.blendingMode!==ct.BLENDINGMODE_OVERRIDE;var o=t.defaultWeight;var l=e._realtimeDatas;var _=t._destCrossClipNodeIndices;for(var h=0;h<s;h++){var x=r[h];if(x){var c=_[h];var d=x.crossFixedValue;var u=c!==-1?l[c]:x.defaultValue;this._applyCrossData(x,n,o,i,d,u,a)}}}_revertDefaultKeyframeNodes(t){var e=t._nodeOwners;for(var a=0,i=e.length;a<i;a++){var r=e[a];if(r){var s=r.propertyOwner;if(s){switch(r.type){case 0:var n=r.property;var o=n.length-1;for(var l=0;l<o;l++){s=s[n[l]];if(!s)break}s[n[o]]=r.defaultValue;break;case 1:var _=s.localPosition;var h=r.defaultValue;_.x=h.x;_.y=h.y;_.z=h.z;s.localPosition=_;break;case 2:var x=s.localRotation;var c=r.defaultValue;x.x=c.x;x.y=c.y;x.z=c.z;x.w=c.w;s.localRotation=x;break;case 3:var d=s.localScale;h=r.defaultValue;d.x=h.x;d.y=h.y;d.z=h.z;s.localScale=d;break;case 4:var u=s.localRotationEuler;h=r.defaultValue;u.x=h.x;u.y=h.y;u.z=h.z;s.localRotationEuler=u;break;default:throw"Animator:unknown type."}}}}}_onAdded(){var t=this.owner._parent;this.owner._setHierarchyAnimator(this,t?t._hierarchyAnimator:null);this.owner._changeAnimatorToLinkSprite3DNoAvatar(this,true,[])}_onDestroy(){for(var t=0,e=this._controllerLayers.length;t<e;t++)this._controllerLayers[t]._removeReference();var a=this.owner._parent;this.owner._clearHierarchyAnimator(this,a?a._hierarchyAnimator:null)}_onEnable(){this.owner._scene._animatorPool.add(this);for(var t=0,e=this._controllerLayers.length;t<e;t++){if(this._controllerLayers[t].playOnWake){var a=this.getDefaultState(t);a&&this.play(null,t,0)}}}_onDisable(){this.owner._scene._animatorPool.remove(this)}_handleSpriteOwnersBySprite(t,e,a){for(var i=0,r=this._controllerLayers.length;i<r;i++){var s=this._controllerLayers[i]._states;for(var n=0,o=s.length;n<o;n++){var l=s[n];var _=l._clip;var h=e.join("/");var x=_._nodesMap[h];if(x){var c=l._nodeOwners;for(var d=0,u=x.length;d<u;d++){if(t)this._addKeyframeNodeOwner(c,x[d],a);else this._removeKeyframeNodeOwner(c,x[d])}}}}}_parse(t){var e=t.avatar;if(e){this.avatar=Et.Loader.getRes(e.path);var a=e.linkSprites;this._linkSprites=a;this._linkToSprites(a)}var i=t.clipPaths;var r=t.playOnWake;var s=t.layers;for(var n=0;n<s.length;n++){var o=s[n];var l=new ct(o.name);if(n===0)l.defaultWeight=1;else l.defaultWeight=o.weight;var _=o.blendingMode;_&&(l.blendingMode=_);this.addControllerLayer(l);var h=o.states;for(var x=0,c=h.length;x<c;x++){var d=h[x];var u=d.clipPath;if(u){var f=d.name;var p;p=Et.Loader.getRes(u);if(p){var m=new dt;m.name=f;m.clip=p;l.addState(m);x===0&&(this.getControllerLayer(n).defaultState=m)}}}r!==undefined&&(l.playOnWake=r)}var g=t.cullingMode;g!==undefined&&(this.cullingMode=g)}_update(){var t=this.owner._scene.timer;var e=t._delta/1e3;if(this._speed===0||e===0)return;var a;if(this.cullingMode===ft.CULLINGMODE_CULLCOMPLETELY){a=false;for(var i=0,r=this._renderableSprites.length;i<r;i++){if(this._renderableSprites[i]._render.isRender){a=true;break}}}else{a=true}this._updateMark++;var s=t.scale;for(i=0,r=this._controllerLayers.length;i<r;i++){var n=this._controllerLayers[i];var o=n._playStateInfo;var l=n._crossPlayStateInfo;d=n.blendingMode!==ct.BLENDINGMODE_OVERRIDE;switch(n._playType){case 0:var _=o._currentState;var h=_._clip;var x=this._speed*_.speed;var c=o._finish;c||this._updatePlayer(_,o,e*x,h.islooping);if(a){var d=n.blendingMode!==ct.BLENDINGMODE_OVERRIDE;this._updateClipDatas(_,d,o,s*x);this._setClipDatasToNode(_,d,n.defaultWeight,i===0);c||this._updateEventScript(_,o)}break;case 1:_=o._currentState;h=_._clip;var u=n._crossPlayState;var f=u._clip;var p=n._crossDuration;var m=l._startPlayTime;var g=f._duration-m;var v=p>g?g/p:1;var y=this._speed*u.speed;this._updatePlayer(u,l,e*v*y,f.islooping);var T=(l._elapsedTime-m)/v/p;if(T>=1){if(a){this._updateClipDatas(u,d,l,s*y);this._setClipDatasToNode(u,d,n.defaultWeight,i===0);n._playType=0;o._currentState=u;l._cloneTo(o)}}else{if(!o._finish){x=this._speed*_.speed;this._updatePlayer(_,o,e*x,h.islooping);if(a)this._updateClipDatas(_,d,o,s*x)}if(a){this._updateClipDatas(u,d,l,s*v*y);this._setCrossClipDatasToNode(n,_,u,T,i===0)}}if(a){this._updateEventScript(_,o);this._updateEventScript(u,l)}break;case 2:u=n._crossPlayState;f=u._clip;p=n._crossDuration;m=l._startPlayTime;g=f._duration-m;v=p>g?g/p:1;y=this._speed*u.speed;this._updatePlayer(u,l,e*v*y,f.islooping);if(a){T=(l._elapsedTime-m)/v/p;if(T>=1){this._updateClipDatas(u,d,l,s*y);this._setClipDatasToNode(u,d,1,i===0);n._playType=0;o._currentState=u;l._cloneTo(o)}else{this._updateClipDatas(u,d,l,s*v*y);this._setFixedCrossClipDatasToNode(n,u,T,i===0)}this._updateEventScript(u,l)}break}}if(a){if(this._avatar){this._updateAvatarNodesToSprite()}}}_cloneTo(t){var e=t;e.avatar=this.avatar;e.cullingMode=this.cullingMode;for(var a=0,i=this._controllerLayers.length;a<i;a++){var r=this._controllerLayers[a];e.addControllerLayer(r.clone());var s=r._states;for(var n=0,o=s.length;n<o;n++){var l=s[n].clone();var _=e.getControllerLayer(a);_.addState(l);n==0&&(_.defaultState=l)}}e._linkSprites=this._linkSprites;e._linkToSprites(this._linkSprites)}getDefaultState(t=0){var e=this._controllerLayers[t];return e.defaultState}addState(t,e=0){var a=this._controllerLayers[e];a.addState(t);console.warn("Animator:this function is discard,please use animatorControllerLayer.addState() instead.")}removeState(t,e=0){var a=this._controllerLayers[e];a.removeState(t);console.warn("Animator:this function is discard,please use animatorControllerLayer.removeState() instead.")}addControllerLayer(t){this._controllerLayers.push(t);t._animator=this;t._addReference();var e=t._states;for(var a=0,i=e.length;a<i;a++)this._getOwnersByClip(e[a])}getControllerLayer(t=0){return this._controllerLayers[t]}play(t=null,e=0,a=Number.NEGATIVE_INFINITY){var i=this._controllerLayers[e];if(i){var r=i.defaultState;if(!t&&!r)throw new Error("Animator:must have default clip value,please set clip property.");var s=i._playStateInfo;var n=s._currentState;var o=t?i._statesMap[t]:r;var l=o._clip._duration;if(n!==o){if(a!==Number.NEGATIVE_INFINITY)s._resetPlayState(l*a);else s._resetPlayState(0);n!==null&&n!==o&&this._revertDefaultKeyframeNodes(n);i._playType=0;s._currentState=o}else{if(a!==Number.NEGATIVE_INFINITY){s._resetPlayState(l*a);i._playType=0}}var _=o._scripts;if(_){for(var h=0,x=_.length;h<x;h++)_[h].onStateEnter()}}else{console.warn("Invalid layerIndex "+e+".")}}crossFade(t,e,a=0,i=Number.NEGATIVE_INFINITY){var r=this._controllerLayers[a];if(r){var s=r._statesMap[t];if(s){var n=r._playType;if(n===-1){this.play(t,a,i);return}var o=r._crossPlayStateInfo;var l=r._crossNodesOwners;var _=r._crossNodesOwnersIndicesMap;var h=r._playStateInfo._currentState;var x=s._nodeOwners;var c=r._destCrossClipNodeIndices;var d=s._clip;var u=d._nodes;var f=d._nodesDic;switch(n){case 0:var p=h._nodeOwners;var m=r._srcCrossClipNodeIndices;var g=h._clip;var v=g._nodes;var y=g._nodesDic;r._playType=1;var T=++r._crossMark;var E=r._crossNodesOwnersCount=0;for(var b=0,S=v.count;b<S;b++){var C=v.getNodeByIndex(b);var R=C._indexInList;var A=p[R];if(A){var L=C.fullPath;m[E]=R;var I=f[L];if(I)c[E]=I._indexInList;else c[E]=-1;_[L]=T;l[E]=A;E++}}for(b=0,S=u.count;b<S;b++){I=u.getNodeByIndex(b);var M=I._indexInList;var D=x[M];if(D){var w=I.fullPath;if(!y[w]){m[E]=-1;c[E]=M;_[w]=T;l[E]=D;E++}}}break;case 1:case 2:r._playType=2;for(b=0,S=l.length;b<S;b++){var P=l[b];P.saveCrossFixedValue();I=f[P.fullPath];if(I)c[b]=I._indexInList;else c[b]=-1}E=r._crossNodesOwnersCount;T=r._crossMark;for(b=0,S=u.count;b<S;b++){I=u.getNodeByIndex(b);M=I._indexInList;D=x[M];if(D){w=I.fullPath;if(_[w]!==T){c[E]=M;_[w]=T;P=x[M];l[E]=P;P.saveCrossFixedValue();E++}}}break;default:}r._crossNodesOwnersCount=E;r._crossPlayState=s;r._crossDuration=h._clip._duration*e;if(i!==Number.NEGATIVE_INFINITY)o._resetPlayState(d._duration*i);else o._resetPlayState(0);var O=s._scripts;if(O){for(b=0,S=O.length;b<S;b++)O[b].onStateEnter()}}else{console.warn("Invalid name "+a+".")}}else{console.warn("Invalid layerIndex "+a+".")}}getCurrentAnimatorPlayState(t=0){return this._controllerLayers[t]._playStateInfo}get avatar(){return this._avatar}set avatar(t){if(this._avatar!==t){this._avatar=t;if(t){this._getAvatarOwnersAndInitDatasAsync();this.owner._changeHierarchyAnimatorAvatar(this,t)}else{var e=this.owner._parent;this.owner._changeHierarchyAnimatorAvatar(this,e?e._hierarchyAnimator._avatar:null)}}}_isLinkSpriteToAnimationNodeData(t,e,a){var i=this._linkAvatarSpritesData[e];if(a){i||(this._linkAvatarSpritesData[e]=i=[]);i.push(t)}else{var r=i.indexOf(t);i.splice(r,1)}}_getAvatarOwnersAndInitDatasAsync(){for(var t=0,e=this._controllerLayers.length;t<e;t++){var a=this._controllerLayers[t]._states;for(var i=0,r=a.length;i<r;i++)this._getOwnersByClip(a[i])}this._avatar._cloneDatasToAnimator(this);for(var s in this._linkAvatarSpritesData){var n=this._linkAvatarSpritesData[s];if(n){for(var o=0,l=n.length;o<l;o++)this._isLinkSpriteToAnimationNode(n[o],s,true)}}}_isLinkSpriteToAnimationNode(t,e,a){if(this._avatar){var i=this._avatarNodeMap[e];if(i){if(a){t._transform._dummy=i.transform;this._linkAvatarSprites.push(t);var r=i.transform;var s=t.transform;if(!s.owner.isStatic&&r){var n=s.worldMatrix;var o=this.owner._transform._parent;if(o){F.matrix4x4MultiplyMFM(o.worldMatrix,r.getWorldMatrix(),n)}else{var l=n.elements;var _=r.getWorldMatrix();for(var h=0;h<16;h++)l[h]=_[h]}s.worldMatrix=n}}else{t._transform._dummy=null;this._linkAvatarSprites.splice(this._linkAvatarSprites.indexOf(t),1)}}}}_updateAvatarNodesToSprite(){for(var t=0,e=this._linkAvatarSprites.length;t<e;t++){var a=this._linkAvatarSprites[t];var i=a.transform._dummy;var r=a.transform;if(!r.owner.isStatic&&i){var s=r.worldMatrix;var n=this.owner._transform;F.matrix4x4MultiplyMFM(n.worldMatrix,i.getWorldMatrix(),s);r.worldMatrix=s}}}linkSprite3DToAvatarNode(t,e){this._isLinkSpriteToAnimationNodeData(e,t,true);this._isLinkSpriteToAnimationNode(e,t,true);return true}unLinkSprite3DToAvatarNode(t){var e=t.transform._dummy;if(e){var a=e._owner.name;this._isLinkSpriteToAnimationNodeData(t,a,false);this._isLinkSpriteToAnimationNode(t,a,false);return true}else{return false}}_updateAnimationNodeWorldMatix(t,e,a,i,r){Et.LayaGL.instance.updateAnimationNodeWorldMatix(t,e,a,r,i)}}ft._tempVector30=new St;ft._tempVector31=new St;ft._tempQuaternion0=new M;ft._tempQuaternion1=new M;ft.CULLINGMODE_ALWAYSANIMATE=0;ft.CULLINGMODE_CULLCOMPLETELY=2;class pt{constructor(){this.invertY=false}}pt._instance=new pt;class mt extends Et.BaseTexture{constructor(t,e,a=Et.RenderTextureFormat.R8G8B8,i=Et.RenderTextureDepthFormat.DEPTH_16){super(a,false);this._inPool=false;this._isCameraTarget=false;this._glTextureType=Et.LayaGL.instance.TEXTURE_2D;this._width=t;this._height=e;this._depthStencilFormat=i;this._mipmapCount=1;this._create(t,e)}static get currentActive(){return mt._currentActive}static createFromPool(t,e,a=Et.RenderTextureFormat.R8G8B8,i=Et.RenderTextureDepthFormat.DEPTH_16){var r;for(var s=0,n=mt._pool.length;s<n;s++){r=mt._pool[s];if(r._width==t&&r._height==e&&r._format==a&&r._depthStencilFormat==i){r._inPool=false;var o=mt._pool[n-1];mt._pool[s]=o;mt._pool.length-=1;return r}}r=new mt(t,e,a,i);r.lock=true;return r}static recoverToPool(t){if(t._inPool)return;mt._pool.push(t);t._inPool=true}get depthStencilFormat(){return this._depthStencilFormat}get defaulteTexture(){return Et.Texture2D.grayTexture}_create(t,e){var a=Et.LayaGL.instance;var i=a;var r=this._glTextureType;var s=Et.LayaGL.layaGPUInstance;var n=s._isWebGL2;var o=this._format;this._frameBuffer=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer);if(o!==Et.RenderTextureFormat.Depth&&o!==Et.RenderTextureFormat.ShadowMap){Et.WebGLContext.bindTexture(a,r,this._glTexture);switch(o){case Et.RenderTextureFormat.R8G8B8:if(n)i.texStorage2D(r,this._mipmapCount,i.RGB8,t,e);else a.texImage2D(r,0,a.RGB,t,e,0,a.RGB,a.UNSIGNED_BYTE,null);break;case Et.RenderTextureFormat.R8G8B8A8:if(n)i.texStorage2D(r,this._mipmapCount,i.RGBA8,t,e);else a.texImage2D(r,0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,null);break;case Et.RenderTextureFormat.Alpha8:if(n)i.texStorage2D(r,0,i.R8,t,e);else a.texImage2D(r,0,a.ALPHA,t,e,0,a.ALPHA,a.UNSIGNED_BYTE,null);break;case Et.RenderTextureFormat.R16G16B16A16:if(n)i.texStorage2D(r,this._mipmapCount,i.RGBA16F,t,e);else a.texImage2D(r,0,a.RGBA,t,e,0,a.RGBA,s._oesTextureHalfFloat.HALF_FLOAT_OES,null);break}a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._glTexture,0)}if(o==Et.RenderTextureFormat.Depth||o==Et.RenderTextureFormat.ShadowMap){Et.WebGLContext.bindTexture(a,r,this._glTexture);switch(this._depthStencilFormat){case Et.RenderTextureDepthFormat.DEPTH_16:if(n)i.texStorage2D(r,this._mipmapCount,i.DEPTH_COMPONENT16,t,e);else a.texImage2D(r,0,a.DEPTH_COMPONENT,t,e,0,a.DEPTH_COMPONENT,a.UNSIGNED_SHORT,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,this._glTexture,0);break;case Et.RenderTextureDepthFormat.DEPTHSTENCIL_24_8:if(n)i.texStorage2D(r,this._mipmapCount,i.DEPTH24_STENCIL8,t,e);else a.texImage2D(r,0,a.DEPTH_STENCIL,t,e,0,a.DEPTH_STENCIL,s._webgl_depth_texture.UNSIGNED_INT_24_8_WEBGL,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._glTexture,0);break;default:throw"RenderTexture: depth format RenderTexture must use depthFormat with DEPTH_16 and DEPTHSTENCIL_16_8."}if(n&&o==Et.RenderTextureFormat.ShadowMap)i.texParameteri(r,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)}else{if(this._depthStencilFormat!==Et.RenderTextureDepthFormat.DEPTHSTENCIL_NONE){this._depthStencilBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this._depthStencilBuffer);switch(this._depthStencilFormat){case Et.RenderTextureDepthFormat.DEPTH_16:a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,e);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this._depthStencilBuffer);break;case Et.RenderTextureDepthFormat.STENCIL_8:a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,t,e);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthStencilBuffer);break;case Et.RenderTextureDepthFormat.DEPTHSTENCIL_24_8:a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,t,e);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthStencilBuffer);break;default:throw"RenderTexture: unkonw depth format."}a.bindRenderbuffer(a.RENDERBUFFER,null)}}a.bindFramebuffer(a.FRAMEBUFFER,null);this._setWarpMode(a.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(a.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);this._readyed=true;this._activeResource();this._setGPUMemory(t*e*4)}_start(){var t=Et.LayaGL.instance;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);mt._currentActive=this;this._isCameraTarget&&(pt._instance.invertY=true);this._readyed=false}_end(){var t=Et.LayaGL.instance;t.bindFramebuffer(t.FRAMEBUFFER,null);mt._currentActive=null;this._isCameraTarget&&(pt._instance.invertY=false);this._readyed=true}getData(t,e,a,i,r){if(Et.Render.isConchApp&&window.conchConfig.threadMode==2){throw"native 2 thread mode use getDataAsync"}var s=Et.LayaGL.instance;s.bindFramebuffer(s.FRAMEBUFFER,this._frameBuffer);var n=s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE;if(!n){s.bindFramebuffer(s.FRAMEBUFFER,null);return null}s.readPixels(t,e,a,i,s.RGBA,s.UNSIGNED_BYTE,r);s.bindFramebuffer(s.FRAMEBUFFER,null);return r}_disposeResource(){if(this._frameBuffer){var t=Et.LayaGL.instance;t.deleteTexture(this._glTexture);t.deleteFramebuffer(this._frameBuffer);t.deleteRenderbuffer(this._depthStencilBuffer);this._glTexture=null;this._frameBuffer=null;this._depthStencilBuffer=null;this._setGPUMemory(0)}}getDataAsync(t,e,a,i,r){var s=Et.LayaGL.instance;s.bindFramebuffer(s.FRAMEBUFFER,this._frameBuffer);s.readPixelsAsync(t,e,a,i,s.RGBA,s.UNSIGNED_BYTE,function(t){r(new Uint8Array(t))});s.bindFramebuffer(s.FRAMEBUFFER,null)}}mt._pool=[];class gt{constructor(){this._mask=[];this._length=0}_intersectionDefineDatas(t){var e=t._mask;var a=this._mask;for(var i=this._length-1;i>=0;i--){var r=a[i]&e[i];if(r==0&&i==this._length-1)this._length--;else a[i]=r}}add(t){var e=t._index;var a=e+1;var i=this._mask;var r=this._length;if(r<a){i.length<a&&(i.length=a);for(;r<e;r++)i[r]=0;i[e]=t._value;this._length=a}else{i[e]|=t._value}}remove(t){var e=t._index;var a=this._mask;var i=this._length-1;if(e>i)return;var r=a[e]&~t._value;if(e==i&&r===0)this._length--;else a[e]=r}addDefineDatas(t){var e=t._mask;var a=t._length;var i=this._mask;var r=this._length;if(r<a){i.length=a;for(var s=0;s<r;s++)i[s]|=e[s];for(;s<a;s++)i[s]=e[s];this._length=a}else{for(var s=0;s<a;s++){i[s]|=e[s]}}}removeDefineDatas(t){var e=t._mask;var a=this._mask;var i=this._length-1;var r=Math.min(t._length,i);for(;r>=0;r--){var s=a[r]&~e[r];if(r==i&&s===0){i--;this._length--}else{a[r]=s}}}has(t){var e=t._index;if(e>=this._length)return false;return(this._mask[e]&t._value)!==0}clear(){this._length=0}cloneTo(t){var e=t;var a=e._mask;var i=this._mask;var r=this._length;a.length=r;for(var s=0;s<r;s++)a[s]=i[s];e._length=r}clone(){var t=new gt;this.cloneTo(t);return t}}class vt extends Et.Buffer{constructor(t,e,a=false){super();this._vertexDeclaration=null;this._float32Reader=null;var i=Et.LayaGL.instance;this._bufferUsage=e;this._bufferType=i.ARRAY_BUFFER;this._canRead=a;this._byteLength=t;this.bind();i.bufferData(this._bufferType,this._byteLength,this._bufferUsage);if(a){this._buffer=new Uint8Array(t);this._float32Reader=new Float32Array(this._buffer.buffer)}}get vertexDeclaration(){return this._vertexDeclaration}set vertexDeclaration(t){this._vertexDeclaration=t}get canRead(){return this._canRead}bind(){if(Et.Buffer._bindedVertexBuffer!==this._glBuffer){var t=Et.LayaGL.instance;t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer);Et.Buffer._bindedVertexBuffer=this._glBuffer;return true}else{return false}}orphanStorage(){this.bind();Et.LayaGL.instance.bufferData(this._bufferType,this._byteLength,this._bufferUsage)}setData(t,e=0,a=0,i=Number.MAX_SAFE_INTEGER){this.bind();var r=a!==0||i!==Number.MAX_SAFE_INTEGER;if(r){var s=new Uint8Array(t,a,i);Et.LayaGL.instance.bufferSubData(this._bufferType,e,s);if(this._canRead)this._buffer.set(s,e)}else{Et.LayaGL.instance.bufferSubData(this._bufferType,e,t);if(this._canRead)this._buffer.set(new Uint8Array(t),e)}}getUint8Data(){if(this._canRead)return this._buffer;else throw new Error("Can't read data from VertexBuffer with only write flag!")}getFloat32Data(){if(this._canRead)return this._float32Reader;else throw new Error("Can't read data from VertexBuffer with only write flag!")}markAsUnreadbale(){this._canRead=false;this._buffer=null;this._float32Reader=null}destroy(){super.destroy();this._buffer=null;this._float32Reader=null;this._vertexDeclaration=null;this._byteLength=0}}vt.DATATYPE_FLOAT32ARRAY=0;vt.DATATYPE_UINT8ARRAY=1;class _{static __init__(){var t=Et.LayaGL.instance;_._elementInfos={single:[1,t.FLOAT,0],vector2:[2,t.FLOAT,0],vector3:[3,t.FLOAT,0],vector4:[4,t.FLOAT,0],color:[4,t.FLOAT,0],byte4:[4,t.UNSIGNED_BYTE,0],short2:[2,t.FLOAT,0],short4:[4,t.FLOAT,0],normalizedshort2:[2,t.FLOAT,0],normalizedshort4:[4,t.FLOAT,0],halfvector2:[2,t.FLOAT,0],halfvector4:[4,t.FLOAT,0]}}static getElementInfos(t){var e=_._elementInfos[t];if(e)return e;else throw"VertexElementFormat: this vertexElementFormat is not implement."}}_.Single="single";_.Vector2="vector2";_.Vector3="vector3";_.Vector4="vector4";_.Color="color";_.Byte4="byte4";_.Short2="short2";_.Short4="short4";_.NormalizedShort2="normalizedshort2";_.NormalizedShort4="normalizedshort4";_.HalfVector2="halfvector2";_.HalfVector4="halfvector4";class yt{constructor(t=null){this._ownerResource=null;this._data=null;this._defineDatas=new gt;this._runtimeCopyValues=[];this._ownerResource=t;this._initData()}_initData(){this._data=new Object}getData(){return this._data}addDefine(t){this._defineDatas.add(t)}removeDefine(t){this._defineDatas.remove(t)}hasDefine(t){return this._defineDatas.has(t)}clearDefine(){this._defineDatas.clear()}getBool(t){return this._data[t]}setBool(t,e){this._data[t]=e}getInt(t){return this._data[t]}setInt(t,e){this._data[t]=e}getNumber(t){return this._data[t]}setNumber(t,e){this._data[t]=e}getVector2(t){return this._data[t]}setVector2(t,e){this._data[t]=e}getVector3(t){return this._data[t]}setVector3(t,e){this._data[t]=e}getVector(t){return this._data[t]}setVector(t,e){this._data[t]=e}getQuaternion(t){return this._data[t]}setQuaternion(t,e){this._data[t]=e}getMatrix4x4(t){return this._data[t]}setMatrix4x4(t,e){this._data[t]=e}getBuffer(t){return this._data[t]}setBuffer(t,e){this._data[t]=e}setTexture(t,e){var a=this._data[t];this._data[t]=e;if(this._ownerResource&&this._ownerResource.referenceCount>0){a&&a._removeReference();e&&e._addReference()}}getTexture(t){return this._data[t]}setAttribute(t,e){this._data[t]=e}getAttribute(t){return this._data[t]}getLength(){return this._data.length}setLength(t){this._data.length=t}cloneTo(t){var e=t;var a=e._data;for(var i in this._data){var r=this._data[i];if(r!=null){if(typeof r=="number"){a[i]=r}else if(typeof r=="number"){a[i]=r}else if(typeof r=="boolean"){a[i]=r}else if(r instanceof Ct){var s=a[i]||(a[i]=new Ct);r.cloneTo(s);a[i]=s}else if(r instanceof St){var n=a[i]||(a[i]=new St);r.cloneTo(n);a[i]=n}else if(r instanceof bt){var o=a[i]||(a[i]=new bt);r.cloneTo(o);a[i]=o}else if(r instanceof k){var l=a[i]||(a[i]=new k);r.cloneTo(l);a[i]=l}else if(r instanceof Et.BaseTexture){a[i]=r}}}this._defineDatas.cloneTo(e._defineDatas)}clone(){var t=new yt;this.cloneTo(t);return t}cloneToForNative(t){var e=t;var a=this._int32Data.length-e._int32Data.length;if(a>0){e.needRenewArrayBufferForNative(this._int32Data.length)}e._int32Data.set(this._int32Data,0);var i=e._nativeArray;var r=this._nativeArray.length;i.length=r;for(var s=0;s<r;s++){var n=this._nativeArray[s];if(n){if(typeof n=="number"){i[s]=n;e.setNumber(s,n)}else if(typeof n=="number"){i[s]=n;e.setInt(s,n)}else if(typeof n=="boolean"){i[s]=n;e.setBool(s,n)}else if(n instanceof Ct){var o=i[s]||(i[s]=new Ct);n.cloneTo(o);i[s]=o;e.setVector2(s,o)}else if(n instanceof St){var l=i[s]||(i[s]=new St);n.cloneTo(l);i[s]=l;e.setVector3(s,l)}else if(n instanceof bt){var _=i[s]||(i[s]=new bt);n.cloneTo(_);i[s]=_;e.setVector(s,_)}else if(n instanceof k){var h=i[s]||(i[s]=new k);n.cloneTo(h);i[s]=h;e.setMatrix4x4(s,h)}else if(n instanceof Et.BaseTexture){i[s]=n;e.setTexture(s,n)}}}this._defineDatas.cloneTo(e._defineDatas)}_initDataForNative(){var t=8;this._frameCount=-1;this._runtimeCopyValues.length=0;this._nativeArray=[];this._data=new ArrayBuffer(t*4);this._int32Data=new Int32Array(this._data);this._float32Data=new Float32Array(this._data);Et.LayaGL.instance.createArrayBufferRef(this._data,Et.LayaGL.ARRAY_BUFFER_TYPE_DATA,true)}needRenewArrayBufferForNative(t){if(t>=this._int32Data.length){var e=(t+1)*4;var a=this._int32Data;var i=this._data["conchRef"];var r=this._data["_ptrID"];this._data=new ArrayBuffer(e);this._int32Data=new Int32Array(this._data);this._float32Data=new Float32Array(this._data);this._data["conchRef"]=i;this._data["_ptrID"]=r;a&&this._int32Data.set(a,0);var s=Et.LayaGL.instance;if(s.updateArrayBufferRef){s.updateArrayBufferRef(this._data["_ptrID"],i.isSyncToRender(),this._data)}else{window.conch.updateArrayBufferRef(this._data["_ptrID"],i.isSyncToRender(),this._data)}}}getDataForNative(){return this._nativeArray}getIntForNative(t){return this._int32Data[t]}setIntForNative(t,e){this.needRenewArrayBufferForNative(t);this._int32Data[t]=e;this._nativeArray[t]=e}getBoolForNative(t){return this._int32Data[t]==1}setBoolForNative(t,e){this.needRenewArrayBufferForNative(t);this._int32Data[t]=e?1:0;this._nativeArray[t]=e}getNumberForNative(t){return this._float32Data[t]}setNumberForNative(t,e){this.needRenewArrayBufferForNative(t);this._float32Data[t]=e;this._nativeArray[t]=e}getMatrix4x4ForNative(t){return this._nativeArray[t]}setMatrix4x4ForNative(t,e){this.needRenewArrayBufferForNative(t);this._nativeArray[t]=e;var a=this.setReferenceForNative(e.elements);this._int32Data[t]=a}getVectorForNative(t){return this._nativeArray[t]}setVectorForNative(t,e){this.needRenewArrayBufferForNative(t);this._nativeArray[t]=e;if(!e.elements){e.forNativeElement()}var a=this.setReferenceForNative(e.elements);this._int32Data[t]=a}getVector2ForNative(t){return this._nativeArray[t]}setVector2ForNative(t,e){this.needRenewArrayBufferForNative(t);this._nativeArray[t]=e;if(!e.elements){e.forNativeElement()}var a=this.setReferenceForNative(e.elements);this._int32Data[t]=a}getVector3ForNative(t){return this._nativeArray[t]}setVector3ForNative(t,e){this.needRenewArrayBufferForNative(t);this._nativeArray[t]=e;if(!e.elements){e.forNativeElement()}var a=this.setReferenceForNative(e.elements);this._int32Data[t]=a}getQuaternionForNative(t){return this._nativeArray[t]}setQuaternionForNative(t,e){this.needRenewArrayBufferForNative(t);this._nativeArray[t]=e;if(!e.elements){e.forNativeElement()}var a=this.setReferenceForNative(e.elements);this._int32Data[t]=a}getBufferForNative(t){return this._nativeArray[t]}setBufferForNative(t,e){this.needRenewArrayBufferForNative(t);this._nativeArray[t]=e;var a=this.setReferenceForNative(e);this._int32Data[t]=a}getAttributeForNative(t){return this._nativeArray[t]}setAttributeForNative(t,e){this._nativeArray[t]=e;if(!e["_ptrID"]){Et.LayaGL.instance.createArrayBufferRef(e,Et.LayaGL.ARRAY_BUFFER_TYPE_DATA,true)}Et.LayaGL.instance.syncBufferToRenderThread(e);this._int32Data[t]=e["_ptrID"]}getTextureForNative(t){return this._nativeArray[t]}setTextureForNative(t,e){if(!e)return;this.needRenewArrayBufferForNative(t);var a=this._nativeArray[t];this._nativeArray[t]=e;var i=e._getSource()||e.defaulteTexture._getSource();this._int32Data[t]=i.id;if(this._ownerResource&&this._ownerResource.referenceCount>0){a&&a._removeReference();e&&e._addReference()}}setReferenceForNative(t){this.clearRuntimeCopyArray();var e=0;var a=0;if(yt._SET_RUNTIME_VALUE_MODE_REFERENCE_){Et.LayaGL.instance.createArrayBufferRefs(t,Et.LayaGL.ARRAY_BUFFER_TYPE_DATA,true,Et.LayaGL.ARRAY_BUFFER_REF_REFERENCE);e=0;a=t.getPtrID(e)}else{Et.LayaGL.instance.createArrayBufferRefs(t,Et.LayaGL.ARRAY_BUFFER_TYPE_DATA,true,Et.LayaGL.ARRAY_BUFFER_REF_COPY);e=t.getRefNum()-1;a=t.getPtrID(e);this._runtimeCopyValues.push({obj:t,refID:e,ptrID:a})}Et.LayaGL.instance.syncBufferToRenderThread(t,e);return a}static setRuntimeValueMode(t){yt._SET_RUNTIME_VALUE_MODE_REFERENCE_=t}clearRuntimeCopyArray(){var t=Et.Stat.loopCount;if(this._frameCount!=t){this._frameCount=t;for(var e=0,a=this._runtimeCopyValues.length;e<a;e++){var i=this._runtimeCopyValues[e];i.obj.clearRefNum()}this._runtimeCopyValues.length=0}}}yt._SET_RUNTIME_VALUE_MODE_REFERENCE_=true;class Tt{constructor(t,e){this._id=++Tt._uniqueIDCounter;this._vertexElementsDic={};this._vertexStride=t;this._vertexElements=e;var a=e.length;this._shaderValues=new yt(null);for(var i=0;i<a;i++){var r=e[i];var s=r._elementUsage;this._vertexElementsDic[s]=r;var n=new Int32Array(5);var o=_.getElementInfos(r._elementFormat);n[0]=o[0];n[1]=o[1];n[2]=o[2];n[3]=this._vertexStride;n[4]=r._offset;this._shaderValues.setAttribute(s,n)}}get id(){return this._id}get vertexStride(){return this._vertexStride}get vertexElementCount(){return this._vertexElements.length}getVertexElementByIndex(t){return this._vertexElements[t]}getVertexElementByUsage(t){return this._vertexElementsDic[t]}}Tt._uniqueIDCounter=1;class h{constructor(t,e,a){this._offset=t;this._elementFormat=e;this._elementUsage=a}get offset(){return this._offset}get elementFormat(){return this._elementFormat}get elementUsage(){return this._elementUsage}}class Rt extends Et.BufferStateBase{constructor(){super()}applyVertexBuffer(t){if(Et.BufferStateBase._curBindedBufferState===this){var e=Et.LayaGL.instance;var a=t.vertexDeclaration;var i=a._shaderValues.getData();this.vertexDeclaration=a;t.bind();for(var r in i){var s=parseInt(r);var n=i[r];e.enableVertexAttribArray(s);e.vertexAttribPointer(s,n[0],n[1],!!n[2],n[3],n[4])}}else{throw"BufferState: must call bind() function first."}}applyVertexBuffers(t){if(Et.BufferStateBase._curBindedBufferState===this){var e=Et.LayaGL.instance;for(var a=0,i=t.length;a<i;a++){var r=t[a];var s=r.vertexDeclaration;var n=s._shaderValues.getData();r.bind();for(var o in n){var l=parseInt(o);var _=n[o];e.enableVertexAttribArray(l);e.vertexAttribPointer(l,_[0],_[1],!!_[2],_[3],_[4])}}}else{throw"BufferState: must call bind() function first."}}applyInstanceVertexBuffer(t){if(Et.LayaGL.layaGPUInstance.supportInstance()){if(Et.BufferStateBase._curBindedBufferState===this){var e=Et.LayaGL.instance;var a=t.vertexDeclaration;var i=a._shaderValues.getData();t.bind();for(var r in i){var s=parseInt(r);var n=i[r];e.enableVertexAttribArray(s);e.vertexAttribPointer(s,n[0],n[1],!!n[2],n[3],n[4]);Et.LayaGL.layaGPUInstance.vertexAttribDivisor(s,1)}}else{throw"BufferState: must call bind() function first."}}}applyIndexBuffer(t){if(Et.BufferStateBase._curBindedBufferState===this){if(this._bindedIndexBuffer!==t){t._bindForVAO();this._bindedIndexBuffer=t}}else{throw"BufferState: must call bind() function first."}}}class At extends Et.Resource{constructor(){super();this._bufferState=new Rt;this._bufferStateInvertUV=new Rt;var t=Et.LayaGL.instance;this._vertexBuffer=new vt(16*4,t.STATIC_DRAW,false);this._vertexBuffer.vertexDeclaration=At._vertexDeclaration;this._vertexBuffer.setData(At._vertices.buffer);this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.unBind();this._vertexBufferInvertUV=new vt(16*4,t.STATIC_DRAW,false);this._vertexBufferInvertUV.vertexDeclaration=At._vertexDeclaration;this._vertexBufferInvertUV.setData(At._verticesInvertUV.buffer);this._bufferStateInvertUV.bind();this._bufferStateInvertUV.applyVertexBuffer(this._vertexBufferInvertUV);this._bufferStateInvertUV.unBind();this._setGPUMemory(this._vertexBuffer._byteLength+this._vertexBufferInvertUV._byteLength)}static __init__(){At._vertexDeclaration=new Tt(16,[new h(0,_.Vector4,At.SCREENQUAD_POSITION_UV)]);At.instance=new At;At.instance.lock=true}render(){var t=Et.LayaGL.instance;this._bufferState.bind();t.drawArrays(t.TRIANGLE_STRIP,0,4);Et.Stat.renderBatches++}renderInvertUV(){var t=Et.LayaGL.instance;this._bufferStateInvertUV.bind();t.drawArrays(t.TRIANGLE_STRIP,0,4);Et.Stat.renderBatches++}destroy(){super.destroy();this._bufferState.destroy();this._vertexBuffer.destroy();this._bufferStateInvertUV.destroy();this._vertexBufferInvertUV.destroy();this._setGPUMemory(0)}}At.SCREENQUAD_POSITION_UV=0;At._vertices=new Float32Array([1,1,1,1,1,-1,1,0,-1,1,0,1,-1,-1,0,0]);At._verticesInvertUV=new Float32Array([1,1,1,0,1,-1,1,1,-1,1,0,0,-1,-1,0,1]);class Lt extends Et.Resource{constructor(){super();this._bufferState=new Rt;this._bufferStateInvertUV=new Rt;var t=Et.LayaGL.instance;this._vertexBuffer=new vt(12*4,t.STATIC_DRAW,false);this._vertexBuffer.vertexDeclaration=Lt._vertexDeclaration;this._vertexBuffer.setData(Lt._vertices.buffer);this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.unBind();this._vertexBufferInvertUV=new vt(12*4,t.STATIC_DRAW,false);this._vertexBufferInvertUV.vertexDeclaration=Lt._vertexDeclaration;this._vertexBufferInvertUV.setData(Lt._verticesInvertUV.buffer);this._bufferStateInvertUV.bind();this._bufferStateInvertUV.applyVertexBuffer(this._vertexBufferInvertUV);this._bufferStateInvertUV.unBind();this._setGPUMemory(this._vertexBuffer._byteLength+this._vertexBufferInvertUV._byteLength)}static __init__(){Lt._vertexDeclaration=new Tt(16,[new h(0,_.Vector4,Lt.SCREENTRIANGLE_POSITION_UV)]);Lt.instance=new Lt;Lt.instance.lock=true}render(){var t=Et.LayaGL.instance;this._bufferState.bind();t.drawArrays(t.TRIANGLES,0,3);Et.Stat.renderBatches++}renderInvertUV(){var t=Et.LayaGL.instance;this._bufferStateInvertUV.bind();t.drawArrays(t.TRIANGLES,0,3);Et.Stat.renderBatches++}destroy(){super.destroy();this._bufferState.destroy();this._vertexBuffer.destroy();this._bufferStateInvertUV.destroy();this._vertexBufferInvertUV.destroy();this._setGPUMemory(0)}}Lt.SCREENTRIANGLE_POSITION_UV=0;Lt._vertices=new Float32Array([-1,-1,0,0,-1,3,0,2,3,-1,2,0]);Lt._verticesInvertUV=new Float32Array([-1,-1,0,1,-1,3,0,-1,3,-1,2,1]);class It{constructor(t,e){this._index=t;this._value=e}}class Mt{constructor(t,e,a,i){this._subShaderIndex=0;this._passIndex=0;this.setValue(t,e,a,i)}get shader(){return this._shader}get subShaderIndex(){return this._subShaderIndex}get passIndex(){return this._passIndex}get defineNames(){return this._defineNames}setValue(t,e,a,i){if(t){var r=t.getSubShaderAt(e);if(r){var s=r._passes[a];if(s){var n=s._validDefine;for(var o=0,l=i.length;o<l;o++){var _=i[o];if(!n.has(D.Shader3D.getDefineByName(_)))throw`ShaderVariantInfo:Invalid defineName ${_} in ${t._name} subShaderIndex of ${e} passIndex of ${a}.`}}else{throw`ShaderVariantInfo:Shader don't have passIndex of ${a}.`}}else{throw`ShaderVariantInfo:Shader don't have subShaderIndex of ${e}.`}}else{throw`ShaderVariantInfo:Shader can't be null.`}this._shader=t;this._subShaderIndex=e;this._passIndex=a;this._defineNames=i}equal(t){if(this._shader!==t._shader||this._subShaderIndex!==t._subShaderIndex||this._passIndex!==t._passIndex)return false;var e=this._defineNames;var a=t._defineNames;if(e.length!==a.length)return false;for(var i=0,r=this._defineNames.length;i<r;i++){if(e[i]!==a[i])return false}return true}clone(){var t=new Mt(this._shader,this._subShaderIndex,this._passIndex,this._defineNames.slice());return t}}class Dt{constructor(){this._allCompiled=false;this._variants=[]}get allCompiled(){return this._allCompiled}get variantCount(){return this._variants.length}add(t){for(var e=0,a=this._variants.length;e<a;e++){if(this._variants[e].equal(t))return false}this._variants.push(t.clone());this._allCompiled=false;return true}remove(t){for(var e=0,a=this._variants.length;e<a;e++){if(this._variants[e].equal(t)){this._variants.splice(e,1);return true}}return false}contatins(t){for(var e=0,a=this._variants.length;e<a;e++){if(this._variants[e].equal(t))return true}return false}getByIndex(t){return this._variants[t]}clear(){this._variants.length=0}compile(){if(!this._allCompiled){var t=this._variants;for(var e=0,a=t.length;e<a;e++){var i=t[e];D.Shader3D.compileShaderByDefineNames(i._shader._name,i._subShaderIndex,i._passIndex,i._defineNames)}this._allCompiled=true}}}class P{constructor(t,e,a,i,r){this._attributeMap=null;this._uniformMap=null;this._enableInstancing=false;this._supportReflectionProbe=false;this._subShaders=[];this._name=t;this._attributeMap=e;this._uniformMap=a;this._enableInstancing=i;this._supportReflectionProbe=r}static _getNamesByDefineData(t,e){var a=P._maskMap;var i=t._mask;e.length=0;for(var r=0,s=t._length;r<s;r++){var n=a[r];var o=i[r];for(var l=0;l<32;l++){var _=1<<l;if(o>0&&_>o)break;if(o&_)e.push(n[_])}}}static getDefineByName(t){var e=P._defineMap[t];if(!e){var a=P._maskMap;var i=P._defineCounter;var r=Math.floor(i/32);var s=1<<i%32;e=new It(r,s);P._defineMap[t]=e;if(r==a.length){a.length++;a[r]={}}a[r][s]=t;P._defineCounter++}return e}static propertyNameToID(t){if(P._propertyNameMap[t]!=null){return P._propertyNameMap[t]}else{var e=P._propertyNameCounter++;P._propertyNameMap[t]=e;return e}}static getAttributeMapByDefine(t,e){var a={};for(var i in e){a[i]=e[i]}for(var r=0,s=t.length;r<s;r++){var n=t[r];switch(n){case"SIMPLEBONE":if(e["a_Texcoord1"]){a["a_SimpleTextureParams"]=e["a_Texcoord1"];delete a["a_Texcoord1"]}a["a_SimpleTextureParams"]=7;break}}return a}static addInclude(t,e){e=e.replace(Et.ShaderCompile._clearCR,"");Et.ShaderCompile.addInclude(t,e)}static compileShaderByDefineNames(t,e,a,i){var r=P.find(t);if(r){var s=r.getSubShaderAt(e);if(s){var n=s._passes[a];if(n){var o=P._compileDefineDatas;o.clear();for(var l=0,_=i.length;l<_;l++)o.add(P.getDefineByName(i[l]));n.withCompile(o)}else{console.warn("Shader3D: unknown passIndex.")}}else{console.warn("Shader3D: unknown subShaderIndex.")}}else{console.warn("Shader3D: unknown shader name.")}}static add(t,e=null,a=null,i=false,r=false){return P._preCompileShader[t]=new P(t,e,a,i,r)}static find(t){return P._preCompileShader[t]}get name(){return this._name}addSubShader(t){this._subShaders.push(t);t._owner=this}getSubShaderAt(t){return this._subShaders[t]}static compileShader(t,e,a,...i){var r=P.find(t);if(r){var s=r.getSubShaderAt(e);if(s){var n=s._passes[a];if(n){var o=P._compileDefineDatas;var l=o._mask;l.length=0;for(var _=0,h=i.length;_<h;_++)l.push(i[_]);o._length=i.length;n.withCompile(o)}else{console.warn("Shader3D: unknown passIndex.")}}else{console.warn("Shader3D: unknown subShaderIndex.")}}else{console.warn("Shader3D: unknown shader name.")}}}P._compileDefineDatas=new gt;P.RENDER_STATE_CULL=0;P.RENDER_STATE_BLEND=1;P.RENDER_STATE_BLEND_SRC=2;P.RENDER_STATE_BLEND_DST=3;P.RENDER_STATE_BLEND_SRC_RGB=4;P.RENDER_STATE_BLEND_DST_RGB=5;P.RENDER_STATE_BLEND_SRC_ALPHA=6;P.RENDER_STATE_BLEND_DST_ALPHA=7;P.RENDER_STATE_BLEND_CONST_COLOR=8;P.RENDER_STATE_BLEND_EQUATION=9;P.RENDER_STATE_BLEND_EQUATION_RGB=10;P.RENDER_STATE_BLEND_EQUATION_ALPHA=11;P.RENDER_STATE_DEPTH_TEST=12;P.RENDER_STATE_DEPTH_WRITE=13;P.PERIOD_CUSTOM=0;P.PERIOD_MATERIAL=1;P.PERIOD_SPRITE=2;P.PERIOD_CAMERA=3;P.PERIOD_SCENE=4;P._propertyNameCounter=0;P._propertyNameMap={};P._defineCounter=0;P._defineMap={};P._preCompileShader={};P._maskMap=[];P.debugMode=false;P.debugShaderVariantCollection=new Dt;class wt{constructor(){this._commandBuffer=null}static __init__(){wt._screenShaderData=new yt;wt._screenShader=P.find("BlitScreen")}run(){}recover(){this._commandBuffer=null}setContext(t){this._context=t}}wt.SCREENTEXTURE_NAME="u_MainTex";wt.SCREENTEXTUREOFFSETSCALE_NAME="u_OffsetScale";wt.MAINTEXTURE_TEXELSIZE_NAME="u_MainTex_TexelSize";wt.SCREENTEXTURE_ID=P.propertyNameToID(wt.SCREENTEXTURE_NAME);wt.SCREENTEXTUREOFFSETSCALE_ID=P.propertyNameToID(wt.SCREENTEXTUREOFFSETSCALE_NAME);wt.MAINTEXTURE_TEXELSIZE_ID=P.propertyNameToID(wt.MAINTEXTURE_TEXELSIZE_NAME);class Pt extends wt{constructor(){super(...arguments);this._source=null;this._dest=null;this._offsetScale=null;this._shader=null;this._shaderData=null;this._subShader=0;this._sourceTexelSize=new bt;this._screenType=0;this._drawDefineCavans=false}static create(t,e,a=null,i=null,r=null,s=0,n=Pt._SCREENTYPE_QUAD,o=null,l=false){var _;_=Pt._pool.length>0?Pt._pool.pop():new Pt;_._source=t;_._dest=e;_._offsetScale=a;_._shader=i;_._shaderData=r;_._subShader=s;_._screenType=n;_._commandBuffer=o;_._drawDefineCavans=l;return _}run(){var t;if(!this._source){if(!this._commandBuffer._camera._internalRenderTexture)throw"camera internalRenderTexture is null,please set camera enableBuiltInRenderTexture";t=this._commandBuffer._camera._internalRenderTexture}else t=this._source;var e=this._shader||wt._screenShader;var a=this._shaderData||wt._screenShaderData;var i=this._dest?this._dest:this._drawDefineCavans?this._dest:this._commandBuffer._camera._internalRenderTexture;Et.LayaGL.instance.viewport(0,0,i?i.width:pt.clientWidth,i?i.height:pt.clientHeight);a.setTexture(wt.SCREENTEXTURE_ID,t);a.setVector(wt.SCREENTEXTUREOFFSETSCALE_ID,this._offsetScale||Pt._defaultOffsetScale);this._sourceTexelSize.setValue(1/t.width,1/t.height,t.width,t.height);a.setVector(wt.MAINTEXTURE_TEXELSIZE_ID,this._sourceTexelSize);mt.currentActive&&mt.currentActive._end();i&&i._start();var r=e.getSubShaderAt(this._subShader);var s=r._passes;for(var n=0,o=s.length;n<o;n++){var l=Pt._compileDefine;a._defineDatas.cloneTo(l);var _=s[n].withCompile(l);_.bind();_.uploadUniforms(_._materialUniformParamsMap,a,true);_.uploadRenderStateBlendDepth(a);_.uploadRenderStateFrontFace(a,false,null);switch(this._screenType){case Pt._SCREENTYPE_QUAD:pt._instance.invertY?At.instance.renderInvertUV():At.instance.render();break;case Pt._SCREENTYPE_TRIANGLE:pt._instance.invertY?Lt.instance.renderInvertUV():Lt.instance.render();break;default:throw"BlitScreenQuadCMD:unknown screen Type."}}i&&i._end()}recover(){Pt._pool.push(this);this._source=null;this._dest=null;this._offsetScale=null;this._shader=null;this._shaderData=null;this._drawDefineCavans=false;super.recover()}}Pt._SCREENTYPE_QUAD=0;Pt._SCREENTYPE_TRIANGLE=1;Pt._compileDefine=new gt;Pt._pool=[];Pt._defaultOffsetScale=new bt(0,0,1,1);class Ot extends wt{constructor(){super(...arguments);this._renderTexture=null}static create(t){var e;e=Ot._pool.length>0?Ot._pool.pop():new Ot;e._renderTexture=t;return e}run(){mt.currentActive&&mt.currentActive._end();Et.LayaGL.instance.viewport(0,0,this._renderTexture.width,this._renderTexture.height);this._renderTexture._start()}recover(){Ot._pool.push(this);this._renderTexture=null}}Ot._pool=[];(function(t){t[t["Int"]=0]="Int";t[t["Bool"]=1]="Bool";t[t["Number"]=2]="Number";t[t["Vector2"]=3]="Vector2";t[t["Vector3"]=4]="Vector3";t[t["Vector"]=5]="Vector";t[t["Quaternion"]=6]="Quaternion";t[t["Matrix4x4"]=7]="Matrix4x4";t[t["Buffer"]=8]="Buffer";t[t["Texture"]=9]="Texture"})(H.ShaderDataType||(H.ShaderDataType={}));class Nt extends wt{constructor(){super(...arguments);this._shaderData=null;this._nameID=0;this._value=null;this._dataType=-1}static create(t,e,a,i,r){var s;s=Nt._pool.length>0?Nt._pool.pop():new Nt;s._shaderData=t;s._nameID=e;s._value=a;s._dataType=i;s._commandBuffer=r;return s}run(){switch(this._dataType){case H.ShaderDataType.Int:this._shaderData.setInt(this._nameID,this._value);break;case H.ShaderDataType.Number:this._shaderData.setNumber(this._nameID,this._value);break;case H.ShaderDataType.Bool:this._shaderData.setBool(this._nameID,this._value);break;case H.ShaderDataType.Matrix4x4:this._shaderData.setMatrix4x4(this._nameID,this._value);break;case H.ShaderDataType.Quaternion:this._shaderData.setQuaternion(this._nameID,this._value);break;case H.ShaderDataType.Texture:this._shaderData.setTexture(this._nameID,this._value);break;case H.ShaderDataType.Vector:this._shaderData.setVector(this._nameID,this._value);break;case H.ShaderDataType.Vector2:this._shaderData.setVector2(this._nameID,this._value);break;case H.ShaderDataType.Vector3:this._shaderData.setVector3(this._nameID,this._value);break;case H.ShaderDataType.Buffer:this._shaderData.setBuffer(this._nameID,this._value);break;default:throw"no type shaderValue on this CommendBuffer"}}recover(){Nt._pool.push(this);this._shaderData=null;this._nameID=0;this._value=null;this._dataType=-1}}Nt._pool=[];class Bt extends Et.Node{constructor(t=null,e=false){super();this._needProcessCollisions=false;this._needProcessTriggers=false;this._id=++Bt._uniqueIDCounter;this._transform=new d(this);this._isStatic=e;this.layer=0;this.name=t?t:"New Sprite3D"}static __init__(){}static instantiate(t,e=null,a=true,i=null,r=null){var s=t.clone();e&&e.addChild(s);var n=s.transform;if(a){var o=n.worldMatrix;t.transform.worldMatrix.cloneTo(o);n.worldMatrix=o}else{i&&(n.position=i);r&&(n.rotation=r)}return s}static load(t,e){Et.Laya.loader.create(t,e,null,Bt.HIERARCHY)}get id(){return this._id}get layer(){return this._layer}set layer(t){if(this._layer!==t){if(t>=0&&t<=30){this._layer=t}else{throw new Error("Layer value must be 0-30.")}}}get url(){return this._url}get isStatic(){return this._isStatic}get transform(){return this._transform}_setCreateURL(t){this._url=Et.URL.formatURL(t)}_changeAnimatorsToLinkSprite3D(t,e,a){var i=this.getComponent(ft);if(i){if(!i.avatar)t._changeAnimatorToLinkSprite3DNoAvatar(i,e,a)}if(this._parent&&this._parent instanceof Bt){a.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._changeAnimatorsToLinkSprite3D(t,e,a)}}_setHierarchyAnimator(t,e){this._changeHierarchyAnimator(t);this._changeAnimatorAvatar(t.avatar);for(var a=0,i=this._children.length;a<i;a++){var r=this._children[a];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}}_clearHierarchyAnimator(t,e){this._changeHierarchyAnimator(e);this._changeAnimatorAvatar(e?e.avatar:null);for(var a=0,i=this._children.length;a<i;a++){var r=this._children[a];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}}_changeHierarchyAnimatorAvatar(t,e){this._changeAnimatorAvatar(e);for(var a=0,i=this._children.length;a<i;a++){var r=this._children[a];r._hierarchyAnimator==t&&r._changeHierarchyAnimatorAvatar(t,e)}}_changeAnimatorToLinkSprite3DNoAvatar(t,e,a){t._handleSpriteOwnersBySprite(e,a,this);for(var i=0,r=this._children.length;i<r;i++){var s=this._children[i];var n=a.length;a.push(s.name);s._changeAnimatorToLinkSprite3DNoAvatar(t,e,a);a.splice(n,1)}}_changeHierarchyAnimator(t){this._hierarchyAnimator=t}_changeAnimatorAvatar(t){}_onAdded(){if(this._parent instanceof Bt){var t=this._parent;this.transform._setParent(t.transform);if(t._hierarchyAnimator){!this._hierarchyAnimator&&this._setHierarchyAnimator(t._hierarchyAnimator,null);t._changeAnimatorsToLinkSprite3D(this,true,[this.name])}}super._onAdded()}_onRemoved(){super._onRemoved();if(this._parent instanceof Bt){var t=this._parent;this.transform._setParent(null);if(t._hierarchyAnimator){this._hierarchyAnimator==t._hierarchyAnimator&&this._clearHierarchyAnimator(t._hierarchyAnimator,null);t._changeAnimatorsToLinkSprite3D(this,false,[this.name])}}}_parse(t,e){t.isStatic!==undefined&&(this._isStatic=t.isStatic);t.active!==undefined&&(this.active=t.active);t.name!=undefined&&(this.name=t.name);if(t.position!==undefined){var a=this.transform.localPosition;a.fromArray(t.position);this.transform.localPosition=a}if(t.rotationEuler!==undefined){var i=this.transform.localRotationEuler;i.fromArray(t.rotationEuler);this.transform.localRotationEuler=i}if(t.rotation!==undefined){var r=this.transform.localRotation;r.fromArray(t.rotation);this.transform.localRotation=r}if(t.scale!==undefined){var s=this.transform.localScale;s.fromArray(t.scale);this.transform.localScale=s}t.layer!=undefined&&(this.layer=t.layer)}_cloneTo(t,e,a){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var i=t;var r=this._transform;var s=i._transform;i.name=this.name;i.destroyed=this.destroyed;i.active=this.active;s.localPosition=r.localPosition;s.localRotation=r.localRotation;s.localScale=r.localScale;i._isStatic=this._isStatic;i.layer=this.layer;super._cloneTo(i,e,a)}static _createSprite3DInstance(t){var e=t._create();var a=t._children;for(var i=0,r=a.length;i<r;i++){var s=Bt._createSprite3DInstance(a[i]);e.addChild(s)}return e}static _parseSprite3DInstance(t,e,a,i){var r=a._children;var s=i._children;for(var n=0,o=r.length;n<o;n++)Bt._parseSprite3DInstance(t,e,r[n],s[n]);a._cloneTo(i,t,e)}clone(){var t=Bt._createSprite3DInstance(this);Bt._parseSprite3DInstance(this,t,this,t);return t}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._transform=null;this._scripts=null;this._url&&Et.Loader.clearRes(this._url)}_create(){return new Bt}}Bt.HIERARCHY="HIERARCHY";Bt.WORLDMATRIX=P.propertyNameToID("u_WorldMat");Bt.MVPMATRIX=P.propertyNameToID("u_MvpMatrix");Bt._uniqueIDCounter=0;class Ft extends wt{constructor(){super();this._projectionViewWorldMatrix=new k;this._renderShaderValue=new yt;this._renderShaderValue=new yt(null)}static create(t,e,a,i,r,s){var n;n=Ft._pool.length>0?Ft._pool.pop():new Ft;n._mesh=t;n._matrix=e;n._material=a;n._subMeshIndex=i;n._subShaderIndex=r;n._commandBuffer=s;return n}run(){var t=this._material._shader.getSubShaderAt(this._subShaderIndex);this.setContext(this._commandBuffer._context);var e=this._context;var a=e.invertY;var i=e.scene;var r=e.cameraShaderValue;var s=e.projectionViewMatrix;k.multiply(s,this._matrix,this._projectionViewWorldMatrix);this._renderShaderValue.setMatrix4x4(Bt.WORLDMATRIX,this._matrix);this._renderShaderValue.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix);var n=e.pipelineMode;var o=t._passes;for(var l=0,_=o.length;l<_;l++){var h=o[l];if(h._pipelineMode!==n)continue;var x=Ft._compileDefine;i._shaderValues._defineDatas.cloneTo(x);x.addDefineDatas(this._renderShaderValue._defineDatas);x.addDefineDatas(this._material._shaderValues._defineDatas);var c=e.shader=h.withCompile(x);var d=c.bind();c.uploadUniforms(c._sceneUniformParamsMap,i._shaderValues,true);c.uploadUniforms(c._spriteUniformParamsMap,this._renderShaderValue,true);c.uploadUniforms(c._cameraUniformParamsMap,r,true);var u=this._material._shaderValues;c.uploadUniforms(c._materialUniformParamsMap,u,true);c.uploadRenderStateBlendDepth(u);c.uploadRenderStateFrontFace(u,a,this._matrix.getInvertFront())}var f=this._mesh._subMeshes;var p;if(this._subMeshIndex==-1){for(var m=0,g=f.length;m<g;m++){p=f[m];if(p._prepareRender(e)){p._render(e)}}}else{var f=this._mesh._subMeshes;p=f[this._subMeshIndex];if(p._prepareRender(e)){p._render(e)}}}recover(){Ft._pool.push(this);this._renderShaderValue.clearDefine();this._renderShaderValue._initData()}}Ft._pool=[];Ft._compileDefine=new gt;class Vt extends wt{constructor(){super(...arguments);this._clearColor=false;this._clearDepth=false;this._backgroundColor=new bt;this._depth=1}static create(t,e,a,i=1,r){var s;s=Vt._pool.length>0?Vt._pool.pop():new Vt;s._clearColor=t;s._clearDepth=e;a.cloneTo(s._backgroundColor);s._depth=i;s._commandBuffer=r;return s}run(){var t=Et.LayaGL.instance;var e;var a=this._backgroundColor;if(this._clearColor){t.clearColor(a.x,a.y,a.z,a.w);e|=t.COLOR_BUFFER_BIT}if(this._clearDepth){t.clearDepth(this._depth);e|=t.DEPTH_BUFFER_BIT}if(this._clearColor||this._clearDepth){t.clear(e)}}recover(){}}Vt._pool=[];class Ut{}class kt{constructor(){this.updateMark=-1;this.pointLightCount=0;this.spotLightCount=0;this.indices=[]}}class Gt{constructor(t,e,a,i){this._updateMark=0;this._depthSliceParam=new Ct;this._xSlices=t;this._ySlices=e;this._zSlices=a;var r=t*e;var s=a*(1+Math.ceil(i/4));this._clusterTexture=F._createFloatTextureBuffer(r,s);this._clusterTexture.lock=true;this._clusterPixels=new Float32Array(r*s*4);var n=new Array(this._zSlices);for(var o=0;o<this._zSlices;o++){n[o]=new Array(this._ySlices);for(var l=0;l<this._ySlices;l++){n[o][l]=new Array(this._xSlices);for(var _=0;_<this._xSlices;_++)n[o][l][_]=new kt}}this._clusterDatas=n}_insertSpotLightSphere(t,e,a,i,r){var s=Gt._tempVector35;s.x=r.x-t.x;s.y=r.y-t.y;s.z=r.z-t.z;var n=St.dot(s,s);var o=r.w;var l=n>o*o;if(!l)return false;var _=St.dot(s,e);var h=Math.cos(i)*Math.sqrt(n-_*_)-_*Math.sin(i);var x=h>o;var c=_>o+a;var d=_<-o;return!(x||c||d)}_placePointLightToClusters(t,e){var a=this._clusterDatas;var i=this._updateMark;for(var r=e.zMin,s=e.zMax;r<s;r++){for(var n=e.yMin,o=e.yMax;n<o;n++){for(var l=e.xMin,_=e.xMax;l<_;l++){var h=a[r][n][l];if(h.updateMark!=i){h.pointLightCount=0;h.spotLightCount=0;h.updateMark=i}var x=h.indices;var c=h.pointLightCount++;if(c<x.length)x[c]=t;else x.push(t)}}}}_placeSpotLightToClusters(t,e){var a=this._clusterDatas;var i=this._updateMark;for(var r=e.zMin,s=e.zMax;r<s;r++){for(var n=e.yMin,o=e.yMax;n<o;n++){for(var l=e.xMin,_=e.xMax;l<_;l++){var h=a[r][n][l];if(h.updateMark!=i){h.pointLightCount=0;h.spotLightCount=0;h.updateMark=i}var x=h.indices;var c=h.pointLightCount+h.spotLightCount++;if(c<x.length)x[c]=t;else x.push(t)}}}}_insertConePlane(t,e,a,i,r){var s=Gt._tempVector36;var n=Gt._tempVector37;St.cross(r,e,s);St.cross(s,e,n);St.normalize(n,n);var o=a*Math.tan(i);var l=t.x+a*e.x+o*n.x;var _=t.y+a*e.y+o*n.y;var h=t.z+a*e.z+o*n.z;return l*r.x+_*r.y+h*r.z<=0||t.x*r.x+t.y*r.y+t.z*r.z<=0}_shrinkSphereLightZPerspective(t,e,a,i,r){var s=a.z;var n=s-i;var o=s+i;if(n>e||o<=t)return false;var l=this._depthSliceParam;r.zMin=Math.floor(Math.log2(Math.max(n,t))*l.x-l.y);r.zMax=Math.min(Math.ceil(Math.log2(o)*l.x-l.y),this._zSlices);return true}_shrinkSpotLightZPerspective(t,e,a,i,r,s,n){var o=i.x,l=i.y,_=i.z;var h=Math.tan(s)*r;var x=a.x,c=a.y,d=a.z;var u=o-x,f=l-c,p=_-d;var m=u*u+f*f+p*p;var g=Math.sqrt(1-p*p/m);var v=Math.max(Math.min(d,_-g*h),a.z-r);var y=Math.min(Math.max(d,_+g*h),a.z+r);if(v>e||y<=t)return false;var T=this._depthSliceParam;n.zMin=Math.floor(Math.log2(Math.max(v,t))*T.x-T.y);n.zMax=Math.min(Math.ceil(Math.log2(y)*T.x-T.y),this._zSlices);return true}_shrinkSphereLightByBoundOrth(t,e,a,i,r,s,n){var o=r.z;var l=o-s,_=o+s;if(l>i||_<=a)return false;var h=r.x;var x=h-s,c=h+s;if(x>t||c<=-t)return false;var d=r.y;var u=d-s,f=d+s;if(u>e||f<=-e)return false;var p=this._xSlices,m=this._ySlices;var g=this._depthSliceParam;var v=t*2/p,y=e*2/m;n.xMin=Math.max(Math.floor((x+t)/v),0);n.xMax=Math.min(Math.ceil((c+t)/v),p);n.yMin=Math.max(Math.floor((e-f)/y),0);n.yMax=Math.min(Math.ceil((e-u)/y),m);n.zMin=Math.floor(Math.log2(Math.max(l,a))*g.x-g.y);n.zMax=Math.min(Math.ceil(Math.log2(_)*g.x-g.y),this._zSlices);return true}_shrinkSpotLightByBoundOrth(t,e,a,i,r,s,n,o,l){var _=s.x,h=s.y,x=s.z;var c=Math.tan(o)*n;var d=r.x,u=r.y,f=r.z;var p=_-d,m=h-u,g=x-f;var v=p*p+m*m+g*g;var y=Math.sqrt(1-g*g/v);var T=Math.max(Math.min(f,x-y*c),r.z-n);var E=Math.min(Math.max(f,x+y*c),r.z+n);if(T>i||E<=a)return false;var b=Math.sqrt(1-p*p/v);var S=Math.max(Math.min(d,_-b*c),r.x-n);var C=Math.min(Math.max(d,_+b*c),r.x+n);if(S>t||C<=-t)return false;var R=Math.sqrt(1-m*m/v);var A=Math.max(Math.min(u,h-R*c),r.y-n);var L=Math.min(Math.max(u,h+R*c),r.y+n);if(A>e||L<=-e)return false;var I=this._xSlices,M=this._ySlices;var D=this._depthSliceParam;var w=t*2/I,P=e*2/M;l.xMin=Math.max(Math.floor((S+t)/w),0);l.xMax=Math.min(Math.ceil((C+t)/w),I);l.yMin=Math.max(Math.floor((e-L)/P),0);l.yMax=Math.min(Math.ceil((e-A)/P),M);l.zMin=Math.floor(Math.log2(Math.max(T,a))*D.x-D.y);l.zMax=Math.min(Math.ceil(Math.log2(E)*D.x-D.y),this._zSlices);return true}_shrinkXYByRadiusPerspective(t,e,a,i,r){var s,n;var o,l;var _=t.x,h=t.y,x=t.z;var c;var d=this._ySlices+1;for(c=0;c<d;c++){var u=r[c];if(h*u.y+x*u.z<e){n=Math.max(0,c-1);break}}if(c==d)return false;l=this._ySlices;for(c=n+1;c<d;c++){var u=r[c];if(h*u.y+x*u.z<=-e){l=Math.max(0,c);break}}d=this._xSlices+1;for(c=0;c<d;c++){var u=i[c];if(_*u.x+x*u.z<e){s=Math.max(0,c-1);break}}o=this._xSlices;for(c=s+1;c<d;c++){var u=i[c];if(_*u.x+x*u.z<=-e){o=Math.max(0,c);break}}a.xMin=s;a.xMax=o;a.yMin=n;a.yMax=l;return true}_shrinkSpotXYByConePerspective(t,e,a,i,r,s,n){var o,l;var _,h;var x=Gt._tempVector32;var c=r.yMax+1;for(var d=r.yMin+1;d<c;d++){if(this._insertConePlane(t,e,a,i,n[d])){l=Math.max(0,d-1);break}}h=r.yMax;for(var d=l+1;d<c;d++){var u=n[d];x.setValue(0,-u.y,-u.z);if(!this._insertConePlane(t,e,a,i,x)){h=Math.max(0,d);break}}c=r.xMax+1;for(var d=r.xMin+1;d<c;d++){if(this._insertConePlane(t,e,a,i,s[d])){o=Math.max(0,d-1);break}}_=r.xMax;for(var d=o+1;d<c;d++){var u=s[d];x.setValue(-u.x,0,-u.z);if(!this._insertConePlane(t,e,a,i,x)){_=Math.max(0,d);break}}r.xMin=o;r.xMax=_;r.yMin=l;r.yMax=h}_updatePointLightPerspective(t,e,a,i,r,s,n){var o=Gt._tempLightBound;var l=Gt._tempVector30;St.transformV3ToV3(i._transform.position,a,l);l.z*=-1;if(!this._shrinkSphereLightZPerspective(t,e,l,i.range,o))return;if(!this._shrinkXYByRadiusPerspective(l,i.range,o,s,n))return;this._placePointLightToClusters(r,o)}_updateSpotLightPerspective(t,e,a,i,r,s,n){var o=Gt._tempLightBound;var l=Gt._tempVector30;var _=Gt._tempVector31;var h=Gt._tempVector34;var x=i._transform.position;var c=i.range;i._transform.worldMatrix.getForward(_);St.normalize(_,_);St.scale(_,c,h);St.add(x,h,h);St.transformV3ToV3(x,a,l);St.transformV3ToV3(h,a,h);l.z*=-1;h.z*=-1;var d=i.spotAngle/2*Math.PI/180;if(!this._shrinkSpotLightZPerspective(t,e,l,h,c,d,o))return;if(!this._shrinkXYByRadiusPerspective(l,c,o,s,n))return;var u=Gt._tempVector33;u.x=h.x-l.x,u.y=h.y-l.y,u.z=h.z-l.z;St.normalize(u,u);this._shrinkSpotXYByConePerspective(l,u,c,d,o,s,n);this._placeSpotLightToClusters(r,o)}_updatePointLightOrth(t,e,a,i,r,s,n){var o=Gt._tempLightBound;var l=Gt._tempVector30;St.transformV3ToV3(s._transform.position,r,l);l.z*=-1;if(!this._shrinkSphereLightByBoundOrth(t,e,a,i,l,s.range,o))return;this._placePointLightToClusters(n,o)}_updateSpotLightOrth(t,e,a,i,r,s,n){var o=Gt._tempLightBound;var l=Gt._tempVector30;var _=Gt._tempVector31;var h=Gt._tempVector34;var x=s._transform.position;var c=s.range;s._transform.worldMatrix.getForward(_);St.normalize(_,_);St.scale(_,c,h);St.add(x,h,h);St.transformV3ToV3(x,r,l);St.transformV3ToV3(h,r,h);l.z*=-1;h.z*=-1;var d=s.spotAngle/2*Math.PI/180;if(!this._shrinkSpotLightByBoundOrth(t,e,a,i,l,h,c,d,o))return;this._placeSpotLightToClusters(n,o)}update(t,e){this._updateMark++;var a=t.nearPlane;this._depthSliceParam.x=tt._config.lightClusterCount.z/Math.log2(t.farPlane/a);this._depthSliceParam.y=Math.log2(a)*this._depthSliceParam.x;var i=t.nearPlane;var r=t.farPlane;var s=t.viewMatrix;var n=e._directionLights._length;var o=e._pointLights;var l=o._length;var _=o._elements;var h=e._spotLights;var x=h._length;var c=h._elements;if(t.orthographic){var d=t.orthographicVerticalSize/2;var u=d*t.aspectRatio;for(var f=0;f<l;f++,n++)this._updatePointLightOrth(u,d,i,r,s,_[f],n);for(var f=0;f<x;f++,n++)this._updateSpotLightOrth(u,d,i,r,s,c[f],n)}else{t._updateClusterPlaneXY();var p=t._clusterXPlanes;var m=t._clusterYPlanes;for(var f=0;f<l;f++,n++)this._updatePointLightPerspective(i,r,s,_[f],n,p,m);for(var f=0;f<x;f++,n++)this._updateSpotLightPerspective(i,r,s,c[f],n,p,m)}if(l+x>0){var g=this._xSlices,v=this._ySlices,y=this._zSlices;var T=g*v*4;var E=T*y;var b=this._clusterPixels;var S=b.length;var B=this._clusterDatas;var F=this._updateMark;var C=true;for(var R=0;R<y;R++){for(var A=0;A<v;A++){for(var L=0;L<g;L++){var I=B[R][A][L];var M=(L+A*g+R*g*v)*4;if(I.updateMark!==F){b[M]=0;b[M+1]=0}else{if(C){var D=I.indices;var w=I.pointLightCount;var P=I.spotLightCount;var O=w+P;if(E+O<S){b[M]=w;b[M+1]=P;b[M+2]=Math.floor(E/T);b[M+3]=E%T;for(var f=0;f<O;f++)b[E++]=D[f]}else{O=S-(E+O);w=Math.min(w,O);b[M]=w;b[M+1]=Math.min(P,O-w);b[M+2]=Math.floor(E/T);b[M+3]=E%T;for(var f=0;f<O;f++)b[E++]=D[f];C=false}}}}}}var N=this._clusterTexture.width;this._clusterTexture.setSubPixels(0,0,N,Math.ceil(E/(4*N)),b)}}}Gt._tempVector30=new St;Gt._tempVector31=new St;Gt._tempVector32=new St;Gt._tempVector33=new St;Gt._tempVector34=new St;Gt._tempVector35=new St;Gt._tempVector36=new St;Gt._tempVector37=new St;Gt._tempLightBound=new Ut;class O{constructor(t,e=0){this.normal=t;this.distance=e}static createPlaneBy3P(t,e,a,i){var r=e.x-t.x;var s=e.y-t.y;var n=e.z-t.z;var o=a.x-t.x;var l=a.y-t.y;var _=a.z-t.z;var h=s*_-n*l;var x=n*o-r*_;var c=r*l-s*o;var d=1/Math.sqrt(h*h+x*x+c*c);var u=h*d;var f=x*d;var p=c*d;var m=i.normal;m.x=u;m.y=f;m.z=p;i.distance=-(u*t.x+f*t.y+p*t.z)}normalize(){var t=this.normal.x;var e=this.normal.y;var a=this.normal.z;var i=1/Math.sqrt(t*t+e*e+a*a);this.normal.x=t*i;this.normal.y=e*i;this.normal.z=a*i;this.distance*=i}cloneTo(t){var e=t;this.normal.cloneTo(e.normal);e.distance=this.distance}clone(){var t=new O(new St);this.cloneTo(t);return t}}O.PlaneIntersectionType_Back=0;O.PlaneIntersectionType_Front=1;O.PlaneIntersectionType_Intersecting=2;class Ht{constructor(t,e){this.origin=t;this.direction=e}}class zt{}zt.Disjoint=0;zt.Contains=1;zt.Intersects=2;class W{constructor(){}static distancePlaneToPoint(t,e){var a=St.dot(t.normal,e);return a-t.distance}static distanceBoxToPoint(t,e){var a=t.min;var i=a.x;var r=a.y;var s=a.z;var n=t.max;var o=n.x;var l=n.y;var _=n.z;var h=e.x;var x=e.y;var c=e.z;var d=0;if(h<i)d+=(i-h)*(i-h);if(h>o)d+=(o-h)*(o-h);if(x<r)d+=(r-x)*(r-x);if(x>l)d+=(l-x)*(l-x);if(c<s)d+=(s-c)*(s-c);if(c>_)d+=(_-c)*(_-c);return Math.sqrt(d)}static distanceBoxToBox(t,e){var a=t.min;var i=a.x;var r=a.y;var s=a.z;var n=t.max;var o=n.x;var l=n.y;var _=n.z;var h=e.min;var x=h.x;var c=h.y;var d=h.z;var u=e.max;var f=u.x;var p=u.y;var m=u.z;var g=0;var v;if(i>f){v=i-f;g+=v*v}else if(x>o){v=x-o;g+=v*v}if(r>p){v=r-p;g+=v*v}else if(c>l){v=c-l;g+=v*v}if(s>m){v=s-m;g+=v*v}else if(d>_){v=d-_;g+=v*v}return Math.sqrt(g)}static distanceSphereToPoint(t,e){var a=Math.sqrt(St.distanceSquared(t.center,e));a-=t.radius;return Math.max(a,0)}static distanceSphereToSphere(t,e){var a=Math.sqrt(St.distanceSquared(t.center,e.center));a-=t.radius+e.radius;return Math.max(a,0)}static intersectsRayAndTriangleRD(t,e,a,i,B){var r=t.origin;var s=r.x;var n=r.y;var o=r.z;var l=t.direction;var _=l.x;var h=l.y;var x=l.z;var c=e.x;var d=e.y;var u=e.z;var f=a.x;var F=a.y;var V=a.z;var U=i.x;var k=i.y;var G=i.z;var p=W._tempV30.x;var m=W._tempV30.y;var g=W._tempV30.z;p=f-c;m=F-d;g=V-u;var v=W._tempV31.x;var y=W._tempV31.y;var T=W._tempV31.z;v=U-c;y=k-d;T=G-u;var E=W._tempV32.x;var b=W._tempV32.y;var S=W._tempV32.z;E=h*T-x*y;b=x*v-_*T;S=_*y-h*v;var C=p*E+m*b+g*S;if(z.isZero(C)){return false}var R=1/C;var A=W._tempV33.x;var L=W._tempV33.y;var I=W._tempV33.z;A=s-c;L=n-d;I=o-u;var M=A*E+L*b+I*S;M*=R;if(M<0||M>1){return false}var D=W._tempV34.x;var w=W._tempV34.y;var P=W._tempV34.z;D=L*g-I*m;w=I*p-A*g;P=A*m-L*p;var O=_*D+h*w+x*P;O*=R;if(O<0||M+O>1){return false}var N=v*D+y*w+T*P;N*=R;if(N<0){return false}return true}static intersectsRayAndTriangleRP(t,e,a,i,r){var s;if(!W.intersectsRayAndTriangleRD(t,e,a,i,s)){r=St._ZERO;return false}St.scale(t.direction,s,W._tempV30);St.add(t.origin,W._tempV30,r);return true}static intersectsRayAndPoint(t,e){St.subtract(t.origin,e,W._tempV30);var a=St.dot(W._tempV30,t.direction);var i=St.dot(W._tempV30,W._tempV30)-z.zeroTolerance;if(i>0&&a>0)return false;var r=a*a-i;if(r<0)return false;return true}static intersectsRayAndRay(t,e,a){var i=t.origin;var r=i.x;var s=i.y;var n=i.z;var o=t.direction;var l=o.x;var _=o.y;var h=o.z;var x=e.origin;var c=x.x;var d=x.y;var u=x.z;var f=e.direction;var p=f.x;var m=f.y;var g=f.z;St.cross(o,f,W._tempV30);var v=W._tempV30;var y=St.scalarLength(W._tempV30);if(z.isZero(y)){if(z.nearEqual(c,r)&&z.nearEqual(d,s)&&z.nearEqual(u,n)){return true}}y=y*y;var T=c-r;var E=d-s;var b=u-n;var S=p;var C=m;var R=g;var A=v.x;var L=v.y;var I=v.z;var M=T*C*I+E*R*A+b*S*L-T*R*L-E*S*I-b*C*A;S=l;C=_;R=h;var D=M/y;St.scale(o,D,W._tempV30);St.scale(f,D,W._tempV31);St.add(i,W._tempV30,W._tempV32);St.add(x,W._tempV31,W._tempV33);var w=W._tempV32;var P=W._tempV33;if(!z.nearEqual(P.x,w.x)||!z.nearEqual(P.y,w.y)||!z.nearEqual(P.z,w.z)){return false}return true}static intersectsPlaneAndTriangle(t,e,a,i){var r=W.intersectsPlaneAndPoint(t,e);var s=W.intersectsPlaneAndPoint(t,a);var n=W.intersectsPlaneAndPoint(t,i);if(r==O.PlaneIntersectionType_Front&&s==O.PlaneIntersectionType_Front&&n==O.PlaneIntersectionType_Front)return O.PlaneIntersectionType_Front;if(r==O.PlaneIntersectionType_Back&&s==O.PlaneIntersectionType_Back&&n==O.PlaneIntersectionType_Back)return O.PlaneIntersectionType_Back;return O.PlaneIntersectionType_Intersecting}static intersectsRayAndPlaneRD(t,e){var a=e.normal;var i=St.dot(a,t.direction);if(Math.abs(i)<z.zeroTolerance)return-1;var r=St.dot(a,t.origin);var s=(-e.distance-r)/i;if(s<0){if(s<-z.zeroTolerance)return-1;s=0}return s}static intersectsRayAndPlaneRP(t,e,a){var i=W.intersectsRayAndPlaneRD(t,e);if(i==-1){a.setValue(0,0,0);return false}var r=W._tempV30;St.scale(t.direction,i,r);St.add(t.origin,r,a);return true}static intersectsRayAndBoxRD(t,e){var a=t.origin;var i=a.x;var r=a.y;var s=a.z;var n=t.direction;var o=n.x;var l=n.y;var _=n.z;var h=e.min;var x=h.x;var c=h.y;var d=h.z;var u=e.max;var f=u.x;var p=u.y;var m=u.z;var g=0;var v=z.MaxValue;if(z.isZero(o)){if(i<x||i>f){return-1}}else{var y=1/o;var T=(x-i)*y;var E=(f-i)*y;if(T>E){var b=T;T=E;E=b}g=Math.max(T,g);v=Math.min(E,v);if(g>v){return-1}}if(z.isZero(l)){if(r<c||r>p){return-1}}else{var S=1/l;var C=(c-r)*S;var R=(p-r)*S;if(C>R){var A=C;C=R;R=A}g=Math.max(C,g);v=Math.min(R,v);if(g>v){return-1}}if(z.isZero(_)){if(s<d||s>m){return-1}}else{var L=1/_;var I=(d-s)*L;var M=(m-s)*L;if(I>M){var D=I;I=M;M=D}g=Math.max(I,g);v=Math.min(M,v);if(g>v){return-1}}return g}static intersectsRayAndBoxRP(t,e,a){var i=W.intersectsRayAndBoxRD(t,e);if(i===-1){St._ZERO.cloneTo(a);return i}St.scale(t.direction,i,W._tempV30);St.add(t.origin,W._tempV30,W._tempV31);W._tempV31.cloneTo(a);return i}static intersectsRayAndSphereRD(t,e){var a=e.radius;St.subtract(t.origin,e.center,W._tempV30);var i=St.dot(W._tempV30,t.direction);var r=St.dot(W._tempV30,W._tempV30)-a*a;if(r>0&&i>0){return-1}var s=i*i-r;if(s<0){return-1}var n=-i-Math.sqrt(s);if(n<0)n=0;return n}static intersectsRayAndSphereRP(t,e,a){var i=W.intersectsRayAndSphereRD(t,e);if(i===-1){St._ZERO.cloneTo(a);return i}St.scale(t.direction,i,W._tempV30);St.add(t.origin,W._tempV30,W._tempV31);W._tempV31.cloneTo(a);return i}static intersectsSphereAndTriangle(t,e,a,i){var r=t.center;var s=t.radius;W.closestPointPointTriangle(r,e,a,i,W._tempV30);St.subtract(W._tempV30,r,W._tempV31);var n=St.dot(W._tempV31,W._tempV31);return n<=s*s}static intersectsPlaneAndPoint(t,e){var a=St.dot(t.normal,e)+t.distance;if(a>0)return O.PlaneIntersectionType_Front;if(a<0)return O.PlaneIntersectionType_Back;return O.PlaneIntersectionType_Intersecting}static intersectsPlaneAndPlane(t,e){St.cross(t.normal,e.normal,W._tempV30);var a=St.dot(W._tempV30,W._tempV30);if(z.isZero(a))return false;return true}static intersectsPlaneAndPlaneRL(t,e,a){var i=t.normal;var r=e.normal;St.cross(i,r,W._tempV34);var s=St.dot(W._tempV34,W._tempV34);if(z.isZero(s))return false;St.scale(r,t.distance,W._tempV30);St.scale(i,e.distance,W._tempV31);St.subtract(W._tempV30,W._tempV31,W._tempV32);St.cross(W._tempV32,W._tempV34,W._tempV33);St.normalize(W._tempV34,W._tempV34);return true}static intersectsPlaneAndBox(t,e){var a=t.distance;var i=t.normal;var r=i.x;var s=i.y;var n=i.z;var o=e.min;var l=o.x;var _=o.y;var h=o.z;var x=e.max;var c=x.x;var d=x.y;var u=x.z;W._tempV30.x=r>0?l:c;W._tempV30.y=s>0?_:d;W._tempV30.z=n>0?h:u;W._tempV31.x=r>0?c:l;W._tempV31.y=s>0?d:_;W._tempV31.z=n>0?u:h;var f=St.dot(i,W._tempV30);if(f+a>0)return O.PlaneIntersectionType_Front;f=St.dot(i,W._tempV31);if(f+a<0)return O.PlaneIntersectionType_Back;return O.PlaneIntersectionType_Intersecting}static intersectsPlaneAndSphere(t,e){var a=e.radius;var i=St.dot(t.normal,e.center)+t.distance;if(i>a)return O.PlaneIntersectionType_Front;if(i<-a)return O.PlaneIntersectionType_Back;return O.PlaneIntersectionType_Intersecting}static intersectsBoxAndBox(t,e){var a=t.min;var i=t.max;var r=e.min;var s=e.max;if(a.x>s.x||r.x>i.x)return false;if(a.y>s.y||r.y>i.y)return false;if(a.z>s.z||r.z>i.z)return false;return true}static intersectsBoxAndSphere(t,e){var a=e.center;var i=e.radius;var r=W._tempV30;St.Clamp(a,t.min,t.max,r);var s=St.distanceSquared(a,r);return s<=i*i}static intersectsSphereAndSphere(t,e){var a=t.radius+e.radius;return St.distanceSquared(t.center,e.center)<=a*a}static boxContainsPoint(t,e){var a=t.min;var i=t.max;if(a.x<=e.x&&i.x>=e.x&&a.y<=e.y&&i.y>=e.y&&a.z<=e.z&&i.z>=e.z)return zt.Contains;return zt.Disjoint}static boxContainsBox(t,e){var a=t.min;var i=a.x;var r=a.y;var s=a.z;var n=t.max;var o=n.x;var l=n.y;var _=n.z;var h=e.min;var x=h.x;var c=h.y;var d=h.z;var u=e.max;var f=u.x;var p=u.y;var m=u.z;if(o<x||i>f)return zt.Disjoint;if(l<c||r>p)return zt.Disjoint;if(_<d||s>m)return zt.Disjoint;if(i<=x&&f<=o&&r<=c&&p<=l&&s<=d&&m<=_){return zt.Contains}return zt.Intersects}static boxContainsSphere(t,e){var a=t.min;var i=a.x;var r=a.y;var s=a.z;var n=t.max;var o=n.x;var l=n.y;var _=n.z;var h=e.center;var x=h.x;var c=h.y;var d=h.z;var u=e.radius;St.Clamp(h,a,n,W._tempV30);var f=St.distanceSquared(h,W._tempV30);if(f>u*u)return zt.Disjoint;if(i+u<=x&&x<=o-u&&(o-i>u&&r+u<=c)&&(c<=l-u&&l-r>u&&(s+u<=d&&d<=_-u&&_-s>u)))return zt.Contains;return zt.Intersects}static sphereContainsPoint(t,e){if(St.distanceSquared(e,t.center)<=t.radius*t.radius)return zt.Contains;return zt.Disjoint}static sphereContainsTriangle(t,e,a,i){var r=W.sphereContainsPoint(t,e);var s=W.sphereContainsPoint(t,a);var n=W.sphereContainsPoint(t,i);if(r==zt.Contains&&s==zt.Contains&&n==zt.Contains)return zt.Contains;if(W.intersectsSphereAndTriangle(t,e,a,i))return zt.Intersects;return zt.Disjoint}static sphereContainsBox(t,e){var a=t.center;var i=a.x;var r=a.y;var s=a.z;var n=t.radius;var o=e.min;var l=o.x;var _=o.y;var h=o.z;var x=e.max;var c=x.x;var d=x.y;var u=x.z;var f=W._tempV30;var p=f.x;var m=f.y;var g=f.z;if(!W.intersectsBoxAndSphere(e,t))return zt.Disjoint;var v=n*n;p=i-l;m=r-d;g=s-u;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-c;m=r-d;g=s-u;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-c;m=r-_;g=s-u;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-l;m=r-_;g=s-u;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-l;m=r-d;g=s-h;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-c;m=r-d;g=s-h;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-c;m=r-_;g=s-h;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;p=i-l;m=r-_;g=s-h;if(St.scalarLengthSquared(W._tempV30)>v)return zt.Intersects;return zt.Contains}static sphereContainsSphere(t,e){var a=t.radius;var i=e.radius;var r=St.distance(t.center,e.center);if(a+i<r)return zt.Disjoint;if(a-i<r)return zt.Intersects;return zt.Contains}static closestPointPointTriangle(t,e,a,i,r){St.subtract(a,e,W._tempV30);St.subtract(i,e,W._tempV31);St.subtract(t,e,W._tempV32);St.subtract(t,a,W._tempV33);St.subtract(t,i,W._tempV34);var s=St.dot(W._tempV30,W._tempV32);var n=St.dot(W._tempV31,W._tempV32);var o=St.dot(W._tempV30,W._tempV33);var l=St.dot(W._tempV31,W._tempV33);var _=St.dot(W._tempV30,W._tempV34);var h=St.dot(W._tempV31,W._tempV34);if(s<=0&&n<=0){e.cloneTo(r);return}if(o>=0&&l<=o){a.cloneTo(r);return}var x=s*l-o*n;if(x<=0&&s>=0&&o<=0){var c=s/(s-o);St.scale(W._tempV30,c,r);St.add(e,r,r);return}if(h>=0&&_<=h){i.cloneTo(r);return}var d=_*n-s*h;if(d<=0&&n>=0&&h<=0){var u=n/(n-h);St.scale(W._tempV31,u,r);St.add(e,r,r);return}var f=o*h-_*l;if(f<=0&&l-o>=0&&_-h>=0){var p=(l-o)/(l-o+(_-h));St.subtract(i,a,r);St.scale(r,p,r);St.add(a,r,r);return}var m=1/(f+d+x);var g=d*m;var v=x*m;St.scale(W._tempV30,g,W._tempV35);St.scale(W._tempV31,v,W._tempV36);St.add(W._tempV35,W._tempV36,r);St.add(e,r,r)}static closestPointPlanePoint(t,e,a){var i=t.normal;var r=St.dot(i,e)-t.distance;St.scale(i,r,W._tempV30);St.subtract(e,W._tempV30,a)}static closestPointBoxPoint(t,e,a){St.max(e,t.min,W._tempV30);St.min(W._tempV30,t.max,a)}static closestPointSpherePoint(t,e,a){var i=t.center;St.subtract(e,i,a);St.normalize(a,a);St.scale(a,t.radius,a);St.add(a,i,a)}static closestPointSphereSphere(t,e,a){var i=t.center;St.subtract(e.center,i,a);St.normalize(a,a);St.scale(a,t.radius,a);St.add(a,i,a)}}W._tempV30=new St;W._tempV31=new St;W._tempV32=new St;W._tempV33=new St;W._tempV34=new St;W._tempV35=new St;W._tempV36=new St;(function(t){t[t["FarBottomLeft"]=0]="FarBottomLeft";t[t["FarTopLeft"]=1]="FarTopLeft";t[t["FarTopRight"]=2]="FarTopRight";t[t["FarBottomRight"]=3]="FarBottomRight";t[t["nearBottomLeft"]=4]="nearBottomLeft";t[t["nearTopLeft"]=5]="nearTopLeft";t[t["nearTopRight"]=6]="nearTopRight";t[t["nearBottomRight"]=7]="nearBottomRight";t[t["unknown"]=8]="unknown"})(H.FrustumCorner||(H.FrustumCorner={}));class Wt{constructor(t){this._matrix=t;this._near=new O(new St);this._far=new O(new St);this._left=new O(new St);this._right=new O(new St);this._top=new O(new St);this._bottom=new O(new St);Wt.getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}static getPlanesFromMatrix(t,e,a,i,r,s,n){var o=t.elements;var l=o[0];var _=o[1];var h=o[2];var x=o[3];var c=o[4];var d=o[5];var u=o[6];var f=o[7];var p=o[8];var m=o[9];var g=o[10];var v=o[11];var y=o[12];var T=o[13];var E=o[14];var b=o[15];var S=e.normal;S.x=h;S.y=u;S.z=g;e.distance=E;e.normalize();var C=a.normal;C.x=x-h;C.y=f-u;C.z=v-g;a.distance=b-E;a.normalize();var R=i.normal;R.x=x+l;R.y=f+c;R.z=v+p;i.distance=b+y;i.normalize();var A=r.normal;A.x=x-l;A.y=f-c;A.z=v-p;r.distance=b-y;r.normalize();var L=s.normal;L.x=x-_;L.y=f-d;L.z=v-m;s.distance=b-T;s.normalize();var I=n.normal;I.x=x+_;I.y=f+d;I.z=v+m;n.distance=b+T;n.normalize()}get matrix(){return this._matrix}set matrix(t){t.cloneTo(this._matrix);Wt.getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}get near(){return this._near}get far(){return this._far}get left(){return this._left}get right(){return this._right}get top(){return this._top}get bottom(){return this._bottom}equalsBoundFrustum(t){return this._matrix.equalsOtherMatrix(t.matrix)}equalsObj(t){if(t instanceof Wt){var e=t;return this.equalsBoundFrustum(e)}return false}getPlane(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}}static get3PlaneInterPoint(t,e,a,i){var r=t.normal;var s=e.normal;var n=a.normal;St.cross(s,n,Wt._tempV30);St.cross(n,r,Wt._tempV31);St.cross(r,s,Wt._tempV32);var o=St.dot(r,Wt._tempV30);var l=St.dot(s,Wt._tempV31);var _=St.dot(n,Wt._tempV32);St.scale(Wt._tempV30,-t.distance/o,Wt._tempV33);St.scale(Wt._tempV31,-e.distance/l,Wt._tempV34);St.scale(Wt._tempV32,-a.distance/_,Wt._tempV35);St.add(Wt._tempV33,Wt._tempV34,Wt._tempV36);St.add(Wt._tempV35,Wt._tempV36,i)}getCorners(t){Wt.get3PlaneInterPoint(this._near,this._bottom,this._right,t[H.FrustumCorner.nearBottomRight]);Wt.get3PlaneInterPoint(this._near,this._top,this._right,t[H.FrustumCorner.nearTopRight]);Wt.get3PlaneInterPoint(this._near,this._top,this._left,t[H.FrustumCorner.nearTopLeft]);Wt.get3PlaneInterPoint(this._near,this._bottom,this._left,t[H.FrustumCorner.nearBottomLeft]);Wt.get3PlaneInterPoint(this._far,this._bottom,this._right,t[H.FrustumCorner.FarBottomRight]);Wt.get3PlaneInterPoint(this._far,this._top,this._right,t[H.FrustumCorner.FarTopRight]);Wt.get3PlaneInterPoint(this._far,this._top,this._left,t[H.FrustumCorner.FarTopLeft]);Wt.get3PlaneInterPoint(this._far,this._bottom,this._left,t[H.FrustumCorner.FarBottomLeft])}containsPoint(t){var e=O.PlaneIntersectionType_Front;var a=O.PlaneIntersectionType_Front;for(var i=0;i<6;i++){switch(i){case 0:a=W.intersectsPlaneAndPoint(this._near,t);break;case 1:a=W.intersectsPlaneAndPoint(this._far,t);break;case 2:a=W.intersectsPlaneAndPoint(this._left,t);break;case 3:a=W.intersectsPlaneAndPoint(this._right,t);break;case 4:a=W.intersectsPlaneAndPoint(this._top,t);break;case 5:a=W.intersectsPlaneAndPoint(this._bottom,t);break}switch(a){case O.PlaneIntersectionType_Back:return zt.Disjoint;case O.PlaneIntersectionType_Intersecting:e=O.PlaneIntersectionType_Intersecting;break}}switch(e){case O.PlaneIntersectionType_Intersecting:return zt.Intersects;default:return zt.Contains}}intersects(t){var e=t.min;var a=t.max;var i=e.x;var r=e.y;var s=e.z;var n=a.x;var o=a.y;var l=a.z;var _=this._near.normal;if(this._near.distance+_.x*(_.x<0?i:n)+_.y*(_.y<0?r:o)+_.z*(_.z<0?s:l)<0)return false;var h=this._left.normal;if(this._left.distance+h.x*(h.x<0?i:n)+h.y*(h.y<0?r:o)+h.z*(h.z<0?s:l)<0)return false;var x=this._right.normal;if(this._right.distance+x.x*(x.x<0?i:n)+x.y*(x.y<0?r:o)+x.z*(x.z<0?s:l)<0)return false;var c=this._bottom.normal;if(this._bottom.distance+c.x*(c.x<0?i:n)+c.y*(c.y<0?r:o)+c.z*(c.z<0?s:l)<0)return false;var d=this._top.normal;if(this._top.distance+d.x*(d.x<0?i:n)+d.y*(d.y<0?r:o)+d.z*(d.z<0?s:l)<0)return false;var u=this._far.normal;if(this._far.distance+u.x*(u.x<0?i:n)+u.y*(u.y<0?r:o)+u.z*(u.z<0?s:l)<0)return false;return true}containsBoundBox(t){var e=Wt._tempV30,a=Wt._tempV31;var i=t.min;var r=t.max;var s=zt.Contains;for(var n=0;n<6;n++){var o=this.getPlane(n);var l=o.normal;if(l.x>=0){e.x=r.x;a.x=i.x}else{e.x=i.x;a.x=r.x}if(l.y>=0){e.y=r.y;a.y=i.y}else{e.y=i.y;a.y=r.y}if(l.z>=0){e.z=r.z;a.z=i.z}else{e.z=i.z;a.z=r.z}if(W.intersectsPlaneAndPoint(o,e)===O.PlaneIntersectionType_Back)return zt.Disjoint;if(W.intersectsPlaneAndPoint(o,a)===O.PlaneIntersectionType_Back)s=zt.Intersects}return s}containsBoundSphere(t){var e=O.PlaneIntersectionType_Front;var a=O.PlaneIntersectionType_Front;for(var i=0;i<6;i++){switch(i){case 0:a=W.intersectsPlaneAndSphere(this._near,t);break;case 1:a=W.intersectsPlaneAndSphere(this._far,t);break;case 2:a=W.intersectsPlaneAndSphere(this._left,t);break;case 3:a=W.intersectsPlaneAndSphere(this._right,t);break;case 4:a=W.intersectsPlaneAndSphere(this._top,t);break;case 5:a=W.intersectsPlaneAndSphere(this._bottom,t);break}switch(a){case O.PlaneIntersectionType_Back:return zt.Disjoint;case O.PlaneIntersectionType_Intersecting:e=O.PlaneIntersectionType_Intersecting;break}}switch(e){case O.PlaneIntersectionType_Intersecting:return zt.Intersects;default:return zt.Contains}}}Wt._tempV30=new St;Wt._tempV31=new St;Wt._tempV32=new St;Wt._tempV33=new St;Wt._tempV34=new St;Wt._tempV35=new St;Wt._tempV36=new St;class Xt{constructor(t,e,a,i){this.minDepth=0;this.maxDepth=1;this.x=t;this.y=e;this.width=a;this.height=i}project(t,e,a){St.transformV3ToV4(t,e,a);var i=a.x,r=a.y,s=a.z;var n=a.w;if(n!==1){i=i/n;r=r/n;s=s/n}a.x=(i+1)*.5*this.width+this.x;a.y=(-r+1)*.5*this.height+this.y;a.z=s*(this.maxDepth-this.minDepth)+this.minDepth}unprojectFromMat(t,e,a){var i=e.elements;a.x=(t.x-this.x)/this.width*2-1;a.y=-((t.y-this.y)/this.height*2-1);a.z=(t.z-this.minDepth)/(this.maxDepth-this.minDepth);var r=a.x*i[3]+a.y*i[7]+a.z*i[11]+i[15];St.transformV3ToV3(a,e,a);if(r!==1){a.x=a.x/r;a.y=a.y/r;a.z=a.z/r}}unprojectFromWVP(t,e,a,i,r){k.multiply(e,a,Xt._tempMatrix4x4);i&&k.multiply(Xt._tempMatrix4x4,i,Xt._tempMatrix4x4);Xt._tempMatrix4x4.invert(Xt._tempMatrix4x4);this.unprojectFromMat(t,Xt._tempMatrix4x4,r)}cloneTo(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;t.minDepth=this.minDepth;t.maxDepth=this.maxDepth}}Xt._tempMatrix4x4=new k;class Yt{constructor(){}static calculateCursorRay(t,e,a,i,r,s){var n=t.x;var o=t.y;var l=Yt._tempVector30;var _=l;_.x=n;_.y=o;_.z=e.minDepth;var h=Yt._tempVector31;var x=h;x.x=n;x.y=o;x.z=e.maxDepth;var c=s.origin;var d=Yt._tempVector32;e.unprojectFromWVP(l,a,i,r,c);e.unprojectFromWVP(h,a,i,r,d);var u=s.direction;u.x=d.x-c.x;u.y=d.y-c.y;u.z=d.z-c.z;St.normalize(s.direction,s.direction)}static rayIntersectsTriangle(t,e,a,i){var r;var s=Yt._tempVector30,n=Yt._tempVector31;St.subtract(a,e,s);St.subtract(i,e,n);var o=Yt._tempVector32;St.cross(t.direction,n,o);var l;l=St.dot(s,o);if(l>-Number.MIN_VALUE&&l<Number.MIN_VALUE){r=Number.NaN;return r}var _=1/l;var h=Yt._tempVector33;St.subtract(t.origin,e,h);var x;x=St.dot(h,o);x*=_;if(x<0||x>1){r=Number.NaN;return r}var c=Yt._tempVector34;St.cross(h,s,c);var d;d=St.dot(t.direction,c);d*=_;if(d<0||x+d>1){r=Number.NaN;return r}var u;u=St.dot(n,c);u*=_;if(u<0){r=Number.NaN;return r}r=u;return r}}Yt._tempVector30=new St;Yt._tempVector31=new St;Yt._tempVector32=new St;Yt._tempVector33=new St;Yt._tempVector34=new St;(function(t){t[t["UInt8"]=0]="UInt8";t[t["UInt16"]=1]="UInt16";t[t["UInt32"]=2]="UInt32"})(H.IndexFormat||(H.IndexFormat={}));class jt extends Et.Buffer{constructor(t,e,a=35044,i=false){super();this._indexType=t;this._indexCount=e;this._bufferUsage=a;this._bufferType=Et.LayaGL.instance.ELEMENT_ARRAY_BUFFER;this._canRead=i;switch(t){case H.IndexFormat.UInt32:this._indexTypeByteCount=4;break;case H.IndexFormat.UInt16:this._indexTypeByteCount=2;break;case H.IndexFormat.UInt8:this._indexTypeByteCount=1;break;default:throw new Error("unidentification index type.")}var r=this._indexTypeByteCount*e;var s=Et.BufferStateBase._curBindedBufferState;this._byteLength=r;if(s){if(s._bindedIndexBuffer===this){Et.LayaGL.instance.bufferData(this._bufferType,r,this._bufferUsage)}else{s.unBind();this.bind();Et.LayaGL.instance.bufferData(this._bufferType,r,this._bufferUsage);s.bind()}}else{this.bind();Et.LayaGL.instance.bufferData(this._bufferType,r,this._bufferUsage)}if(i){switch(t){case H.IndexFormat.UInt32:this._buffer=new Uint32Array(e);break;case H.IndexFormat.UInt16:this._buffer=new Uint16Array(e);break;case H.IndexFormat.UInt8:this._buffer=new Uint8Array(e);break}}}get indexType(){return this._indexType}get indexTypeByteCount(){return this._indexTypeByteCount}get indexCount(){return this._indexCount}get canRead(){return this._canRead}_bindForVAO(){if(Et.BufferStateBase._curBindedBufferState){var t=Et.LayaGL.instance;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer)}else{throw"IndexBuffer3D: must bind current BufferState."}}bind(){if(Et.BufferStateBase._curBindedBufferState){throw"IndexBuffer3D: must unbind current BufferState."}else{if(Et.Buffer._bindedIndexBuffer!==this._glBuffer){var t=Et.LayaGL.instance;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer);Et.Buffer._bindedIndexBuffer=this._glBuffer;return true}else{return false}}}setData(t,e=0,a=0,i=4294967295){var r=this._indexTypeByteCount;if(a!==0||i!==4294967295){switch(this._indexType){case H.IndexFormat.UInt32:t=new Uint32Array(t.buffer,a*r,i);break;case H.IndexFormat.UInt16:t=new Uint16Array(t.buffer,a*r,i);break;case H.IndexFormat.UInt8:t=new Uint8Array(t.buffer,a*r,i);break}}var s=Et.BufferStateBase._curBindedBufferState;if(s){if(s._bindedIndexBuffer===this){Et.LayaGL.instance.bufferSubData(this._bufferType,e*r,t)}else{s.unBind();this.bind();Et.LayaGL.instance.bufferSubData(this._bufferType,e*r,t);s.bind()}}else{this.bind();Et.LayaGL.instance.bufferSubData(this._bufferType,e*r,t)}if(this._canRead){if(e!==0||a!==0||i!==4294967295){var n=this._buffer.length-e;if(i>n)i=n;for(var o=0;o<i;o++)this._buffer[e+o]=t[o]}else{this._buffer=t}}}getData(){if(this._canRead)return this._buffer;else throw new Error("Can't read data from VertexBuffer with only write flag!")}destroy(){super.destroy();this._buffer=null;this._byteLength=0;this._indexCount=0}}class K{static __init__(){K.instanceWorldMatrixDeclaration=new Tt(64,[new h(0,_.Vector4,K.MESH_WORLDMATRIX_ROW0),new h(16,_.Vector4,K.MESH_WORLDMATRIX_ROW1),new h(32,_.Vector4,K.MESH_WORLDMATRIX_ROW2),new h(48,_.Vector4,K.MESH_WORLDMATRIX_ROW3)]);K.instanceMVPMatrixDeclaration=new Tt(64,[new h(0,_.Vector4,K.MESH_MVPMATRIX_ROW0),new h(16,_.Vector4,K.MESH_MVPMATRIX_ROW1),new h(32,_.Vector4,K.MESH_MVPMATRIX_ROW2),new h(48,_.Vector4,K.MESH_MVPMATRIX_ROW3)]);K.instanceSimpleAnimatorDeclaration=new Tt(16,[new h(0,_.Vector4,K.MESH_SIMPLEANIMATOR)])}static getVertexDeclaration(t,e=true){var a=K._vertexDeclarationMap[t+(e?"_0":"_1")];if(!a){var i=t.split(",");var r=0;var s=[];for(var n=0,o=i.length;n<o;n++){var l;switch(i[n]){case"POSITION":l=new h(r,_.Vector3,K.MESH_POSITION0);r+=12;break;case"NORMAL":l=new h(r,_.Vector3,K.MESH_NORMAL0);r+=12;break;case"COLOR":l=new h(r,_.Vector4,K.MESH_COLOR0);r+=16;break;case"UV":l=new h(r,_.Vector2,K.MESH_TEXTURECOORDINATE0);r+=8;break;case"UV1":l=new h(r,_.Vector2,K.MESH_TEXTURECOORDINATE1);r+=8;break;case"BLENDWEIGHT":l=new h(r,_.Vector4,K.MESH_BLENDWEIGHT0);r+=16;break;case"BLENDINDICES":if(e){l=new h(r,_.Vector4,K.MESH_BLENDINDICES0);r+=16}else{l=new h(r,_.Byte4,K.MESH_BLENDINDICES0);r+=4}break;case"TANGENT":l=new h(r,_.Vector4,K.MESH_TANGENT0);r+=16;break;default:throw"VertexMesh: unknown vertex flag."}s.push(l)}a=new Tt(r,s);K._vertexDeclarationMap[t+(e?"_0":"_1")]=a}return a}}K.MESH_POSITION0=0;K.MESH_COLOR0=1;K.MESH_TEXTURECOORDINATE0=2;K.MESH_NORMAL0=3;K.MESH_TANGENT0=4;K.MESH_BLENDINDICES0=5;K.MESH_BLENDWEIGHT0=6;K.MESH_TEXTURECOORDINATE1=7;K.MESH_WORLDMATRIX_ROW0=8;K.MESH_WORLDMATRIX_ROW1=9;K.MESH_WORLDMATRIX_ROW2=10;K.MESH_WORLDMATRIX_ROW3=11;K.MESH_MVPMATRIX_ROW0=12;K.MESH_MVPMATRIX_ROW1=13;K.MESH_MVPMATRIX_ROW2=14;K.MESH_MVPMATRIX_ROW3=15;K.MESH_SIMPLEANIMATOR=7;K._vertexDeclarationMap={};class qt{constructor(){}_render(t){}}class Zt extends qt{constructor(){super();var t=Et.LayaGL.instance;var e=1;var a=1;var i=1;var r=new Float32Array([-i,e,-a,i,e,-a,i,e,a,-i,e,a,-i,-e,-a,i,-e,-a,i,-e,a,-i,-e,a]);var s=new Uint8Array([0,1,2,2,3,0,4,7,6,6,5,4,0,3,7,7,4,0,1,5,6,6,2,1,3,2,6,6,7,3,0,4,5,5,1,0]);var n=K.getVertexDeclaration("POSITION");this._vertexBuffer=new vt(n.vertexStride*8,t.STATIC_DRAW,false);this._vertexBuffer.vertexDeclaration=n;this._indexBuffer=new jt(H.IndexFormat.UInt8,36,t.STATIC_DRAW,false);this._vertexBuffer.setData(r.buffer);this._indexBuffer.setData(s);var o=new Rt;o.bind();o.applyVertexBuffer(this._vertexBuffer);o.applyIndexBuffer(this._indexBuffer);o.unBind();this._bufferState=o}static __init__(){Zt.instance=new Zt}_render(t){var e=Et.LayaGL.instance;e.drawElements(e.TRIANGLES,36,e.UNSIGNED_BYTE,0);Et.Stat.trianglesFaces+=12;Et.Stat.renderBatches++}}class Kt{constructor(){this._mesh=Zt.instance}get material(){return this._material}set material(t){if(this._material!==t){this._material&&this._material._removeReference();t&&t._addReference();this._material=t}}get mesh(){return this._mesh}set mesh(t){if(this._mesh!==t){this._mesh=t}}_isAvailable(){return this._material&&this._mesh?true:false}_render(t){if(this._material&&this._mesh){var e=Et.LayaGL.instance;var a=t.scene;var i=t.cameraShaderValue;var r=t.camera;var s=yt._SET_RUNTIME_VALUE_MODE_REFERENCE_;Et.ILaya.Render.supportWebGLPlusRendering&&yt.setRuntimeValueMode(false);Et.WebGLContext.setCullFace(e,false);Et.WebGLContext.setDepthFunc(e,e.LEQUAL);Et.WebGLContext.setDepthMask(e,false);var n=Kt._compileDefine;this._material._shaderValues._defineDatas.cloneTo(n);var o=t.shader=this._material._shader.getSubShaderAt(0)._passes[0].withCompile(n);var l=o.bind();var _=Et.Stat.loopCount!==o._uploadMark;var h=o._uploadScene!==a||_;if(h||l){o.uploadUniforms(o._sceneUniformParamsMap,a._shaderValues,h);o._uploadScene=a}var x=r._getRenderTexture();var c=o._uploadCameraShaderValue!==i||_;if(c||l){var d=Kt._tempMatrix0;var u=Kt._tempMatrix1;r.viewMatrix.cloneTo(d);r.projectionMatrix.cloneTo(u);d.setTranslationVector(St._ZERO);if(r.orthographic)k.createPerspective(r.fieldOfView,r.aspectRatio,r.nearPlane,r.farPlane,u);var f=1e-6;var p=1/Math.tan(3.1416*r.fieldOfView/180*.5);u.elements[0]=p/r.aspectRatio;u.elements[5]=p;u.elements[10]=f-1;u.elements[11]=-1;u.elements[14]=-0;r._applyViewProject(t,d,u);o.uploadUniforms(o._cameraUniformParamsMap,i,c);o._uploadCameraShaderValue=i}var m=o._uploadMaterial!==this._material||_;if(m||l){o.uploadUniforms(o._materialUniformParamsMap,this._material._shaderValues,m);o._uploadMaterial=this._material}this._mesh._bufferState.bind();this._mesh._render(t);Et.ILaya.Render.supportWebGLPlusRendering&&yt.setRuntimeValueMode(s);Et.WebGLContext.setDepthFunc(e,e.LESS);Et.WebGLContext.setDepthMask(e,true);r._applyViewProject(t,r.viewMatrix,r.projectionMatrix)}}destroy(){if(this._material){this._material._removeReference();this._material=null}}}Kt._tempMatrix0=new k;Kt._tempMatrix1=new k;Kt._compileDefine=new gt;class Qt extends Bt{constructor(t=.3,e=1e3){super();this._skyRenderer=new Kt;this._forward=new St;this._up=new St;this.clearColor=new bt(100/255,149/255,237/255,255/255);this._shaderValues=new yt(null);this._fieldOfView=60;this._useUserProjectionMatrix=false;this._orthographic=false;this._orthographicVerticalSize=10;this.renderingOrder=0;this._nearPlane=t;this._farPlane=e;this.cullingMask=2147483647;this.useOcclusionCulling=true}get skyRenderer(){return this._skyRenderer}get fieldOfView(){return this._fieldOfView}set fieldOfView(t){this._fieldOfView=t;this._calculateProjectionMatrix()}get nearPlane(){return this._nearPlane}set nearPlane(t){this._nearPlane=t;this._calculateProjectionMatrix()}get farPlane(){return this._farPlane}set farPlane(t){this._farPlane=t;this._calculateProjectionMatrix()}get orthographic(){return this._orthographic}set orthographic(t){this._orthographic=t;this._calculateProjectionMatrix()}get orthographicVerticalSize(){return this._orthographicVerticalSize}set orthographicVerticalSize(t){this._orthographicVerticalSize=t;this._calculateProjectionMatrix()}get renderingOrder(){return this._renderingOrder}set renderingOrder(t){this._renderingOrder=t;this._sortCamerasByRenderingOrder()}_sortCamerasByRenderingOrder(){if(this.displayedInStage){var t=this.scene._cameraPool;var e=t.length-1;for(var a=0;a<e;a++){if(t[a].renderingOrder>t[e].renderingOrder){var i=t[a];t[a]=t[e];t[e]=i}}}}_calculateProjectionMatrix(){}_onScreenSizeChanged(){this._calculateProjectionMatrix()}_prepareCameraToRender(){var t=this._shaderValues;this.transform.getForward(this._forward);this.transform.getUp(this._up);t.setVector3(Qt.CAMERAPOS,this.transform.position);t.setVector3(Qt.CAMERADIRECTION,this._forward);t.setVector3(Qt.CAMERAUP,this._up)}render(t=null,e=null){}addLayer(t){this.cullingMask|=Math.pow(2,t)}removeLayer(t){this.cullingMask&=~Math.pow(2,t)}addAllLayers(){this.cullingMask=2147483647}removeAllLayers(){this.cullingMask=0}resetProjectionMatrix(){this._useUserProjectionMatrix=false;this._calculateProjectionMatrix()}_onActive(){this._scene._addCamera(this);super._onActive()}_onInActive(){this._scene._removeCamera(this);super._onInActive()}_parse(t,e){super._parse(t,e);this.orthographic=t.orthographic;t.orthographicVerticalSize!==undefined&&(this.orthographicVerticalSize=t.orthographicVerticalSize);t.fieldOfView!==undefined&&(this.fieldOfView=t.fieldOfView);this.nearPlane=t.nearPlane;this.farPlane=t.farPlane;var a=t.clearColor;this.clearColor=new bt(a[0],a[1],a[2],a[3]);var i=t.skyboxMaterial;if(i){this._skyRenderer.material=Et.Loader.getRes(i.path)}}destroy(t=true){this._skyRenderer.destroy();this._skyRenderer=null;Et.Laya.stage.off(Et.Event.RESIZE,this,this._onScreenSizeChanged);super.destroy(t)}_create(){return new Qt}}Qt._tempMatrix4x40=new k;Qt.CAMERAPOS=P.propertyNameToID("u_CameraPos");Qt.VIEWMATRIX=P.propertyNameToID("u_View");Qt.PROJECTMATRIX=P.propertyNameToID("u_Projection");Qt.VIEWPROJECTMATRIX=P.propertyNameToID("u_ViewProjection");Qt.CAMERADIRECTION=P.propertyNameToID("u_CameraDirection");Qt.CAMERAUP=P.propertyNameToID("u_CameraUp");Qt.VIEWPORT=P.propertyNameToID("u_Viewport");Qt.PROJECTION_PARAMS=P.propertyNameToID("u_ProjectionParams");Qt.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING";Qt.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING";Qt._invertYScaleMatrix=new k(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1);Qt._invertYProjectionMatrix=new k;Qt._invertYProjectionViewMatrix=new k;Qt.CLEARFLAG_SOLIDCOLOR=0;Qt.CLEARFLAG_SKY=1;Qt.CLEARFLAG_DEPTHONLY=2;Qt.CLEARFLAG_NONE=3;(function(t){t[t["None"]=0]="None";t[t["Hard"]=1]="Hard";t[t["SoftLow"]=2]="SoftLow";t[t["SoftHigh"]=3]="SoftHigh"})(H.ShadowMode||(H.ShadowMode={}));class Jt{}(function(t){t[t["Directional"]=0]="Directional";t[t["Spot"]=1]="Spot";t[t["Point"]=2]="Point"})(H.LightType||(H.LightType={}));class $t extends Bt{constructor(){super();this._shadowMode=H.ShadowMode.None;this._isAlternate=false;this._shadowResolution=2048;this._shadowDistance=50;this._shadowDepthBias=1;this._shadowNormalBias=1;this._shadowNearPlane=.1;this._shadowStrength=1;this._lightWoldMatrix=new k;this._intensity=1;this._intensityColor=new St;this.color=new St(1,1,1);this._lightmapBakedType=$t.LIGHTMAPBAKEDTYPE_REALTIME}get intensity(){return this._intensity}set intensity(t){this._intensity=t}get shadowMode(){return this._shadowMode}set shadowMode(t){this._shadowMode=t}get shadowDistance(){return this._shadowDistance}set shadowDistance(t){this._shadowDistance=t}get shadowResolution(){return this._shadowResolution}set shadowResolution(t){this._shadowResolution=t}get shadowDepthBias(){return this._shadowDepthBias}set shadowDepthBias(t){this._shadowDepthBias=t}get shadowNormalBias(){return this._shadowNormalBias}set shadowNormalBias(t){this._shadowNormalBias=t}get shadowStrength(){return this._shadowStrength}set shadowStrength(t){this._shadowStrength=t}get shadowNearPlane(){return this._shadowNearPlane}set shadowNearPlane(t){this._shadowNearPlane=t}get lightmapBakedType(){return this._lightmapBakedType}set lightmapBakedType(t){if(this._lightmapBakedType!==t){this._lightmapBakedType=t;if(this.activeInHierarchy){if(t!==$t.LIGHTMAPBAKEDTYPE_BAKED)this._addToScene();else this._removeFromScene()}}}get lightWorldMatrix(){var t=this.transform.position;var e=this.transform.rotation;k.createAffineTransformation(t,e,St._ONE,this._lightWoldMatrix);return this._lightWoldMatrix}_parse(t,e){super._parse(t,e);var a=t.color;this.color.fromArray(a);this.intensity=t.intensity;this.lightmapBakedType=t.lightmapBakedType}_cloneTo(t,e,a){super._cloneTo(t,e,a);var i=t;i.color=this.color.clone();i.intensity=this.intensity;i.lightmapBakedType=this.lightmapBakedType}_addToScene(){var t=this._scene;var e=tt._config.maxLightCount;if(t._lightCount<e){t._lightCount++;this._addToLightQueue();this._isAlternate=false}else{t._alternateLights.add(this);this._isAlternate=true;console.warn("LightSprite:light count has large than maxLightCount,the latest added light will be ignore.")}}_removeFromScene(){var t=this._scene;if(this._isAlternate){t._alternateLights.remove(this)}else{t._lightCount--;this._removeFromLightQueue();if(t._alternateLights._length>0){var e=t._alternateLights.shift();e._addToLightQueue();e._isAlternate=false;t._lightCount++}}}_addToLightQueue(){}_removeFromLightQueue(){}_onActive(){super._onActive();this.lightmapBakedType!==$t.LIGHTMAPBAKEDTYPE_BAKED&&this._addToScene()}_onInActive(){super._onInActive();this.lightmapBakedType!==$t.LIGHTMAPBAKEDTYPE_BAKED&&this._removeFromScene()}_create(){return new $t}get diffuseColor(){console.log("LightSprite: discard property,please use color property instead.");return this.color}set diffuseColor(t){console.log("LightSprite: discard property,please use color property instead.");this.color=t}}$t.LIGHTMAPBAKEDTYPE_REALTIME=0;$t.LIGHTMAPBAKEDTYPE_MIXED=1;$t.LIGHTMAPBAKEDTYPE_BAKED=2;(function(t){t[t["NoCascades"]=0]="NoCascades";t[t["TwoCascades"]=1]="TwoCascades";t[t["FourCascades"]=2]="FourCascades"})(H.ShadowCascadesMode||(H.ShadowCascadesMode={}));var te;(function(t){t[t["Near"]=0]="Near";t[t["Far"]=1]="Far";t[t["Left"]=2]="Left";t[t["Right"]=3]="Right";t[t["Bottom"]=4]="Bottom";t[t["Top"]=5]="Top"})(te||(te={}));class ee{static supportShadow(){return Et.LayaGL.layaGPUInstance._isWebGL2||Et.SystemUtils.supportRenderTextureFormat(Et.RenderTextureFormat.Depth)}static init(){if(Et.LayaGL.layaGPUInstance._isWebGL2)ee._shadowTextureFormat=Et.RenderTextureFormat.ShadowMap;else ee._shadowTextureFormat=Et.RenderTextureFormat.Depth}static getTemporaryShadowTexture(t,e,a){var i=mt.createFromPool(t,e,ee._shadowTextureFormat,a);i.filterMode=Et.FilterMode.Bilinear;i.wrapModeU=Et.WarpMode.Clamp;i.wrapModeV=Et.WarpMode.Clamp;return i}static getShadowBias(t,e,a,i){var r;if(t._lightType==H.LightType.Directional){r=2/e.elements[0]}else if(t._lightType==H.LightType.Spot){r=Math.tan(t.spotAngle*.5*z.Deg2Rad)*t.range}else{console.warn("ShadowUtils:Only spot and directional shadow casters are supported now.");r=0}var s=r/a;var n=-t._shadowDepthBias*s;var o=-t._shadowNormalBias*s;if(t.shadowMode==H.ShadowMode.SoftHigh){const l=2.5;n*=l;o*=l}i.setValue(n,o,0,0)}static getCameraFrustumPlanes(t,e){Wt.getPlanesFromMatrix(t,e[te.Near],e[te.Far],e[te.Left],e[te.Right],e[te.Top],e[te.Bottom])}static getFarWithRadius(t,e){return Math.sqrt(t*t/e)}static getCascadesSplitDistance(t,e,a,i,r,s,n,o){o[0]=a;var l=i-a;var _=Math.tan(r*.5);var h=1+_*_*(s*s+1);switch(n){case H.ShadowCascadesMode.NoCascades:o[1]=ee.getFarWithRadius(i,h);break;case H.ShadowCascadesMode.TwoCascades:o[1]=ee.getFarWithRadius(a+l*t,h);o[2]=ee.getFarWithRadius(i,h);break;case H.ShadowCascadesMode.FourCascades:o[1]=ee.getFarWithRadius(a+l*e.x,h);o[2]=ee.getFarWithRadius(a+l*e.y,h);o[3]=ee.getFarWithRadius(a+l*e.z,h);o[4]=ee.getFarWithRadius(i,h);break}}static applySliceTransform(t,e,a,i,r){var s=ee._tempMatrix0.elements;var n=1/e;var o=1/a;s[0]=t.resolution*n;s[5]=t.resolution*o;s[12]=t.offsetX*n;s[13]=t.offsetY*o;s[1]=s[2]=s[2]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[14]=0;s[10]=s[15]=1;var l=i*16;F._mulMatrixArray(s,r,l,r,l)}static getDirectionLightShadowCullPlanes(t,e,a,i,r,s){var n=ee._frustumCorners;var o=ee._backPlaneFaces;var l=ee._frustumPlaneNeighbors;var _=ee._frustumTwoPlaneCorners;var h=ee._edgePlanePoint2;var x=s.cullPlanes;var c=t[te.Near],d=t[te.Far];var u=t[te.Left],f=t[te.Right];var p=t[te.Bottom],m=t[te.Top];var g=a[e]-i;var v=ee._adjustNearPlane;var y=ee._adjustFarPlane;c.normal.cloneTo(v.normal);d.normal.cloneTo(y.normal);v.distance=c.distance-g;y.distance=Math.min(-c.distance+s.sphereCenterZ+s.splitBoundSphere.radius,d.distance);Wt.get3PlaneInterPoint(v,p,f,n[H.FrustumCorner.nearBottomRight]);Wt.get3PlaneInterPoint(v,m,f,n[H.FrustumCorner.nearTopRight]);Wt.get3PlaneInterPoint(v,m,u,n[H.FrustumCorner.nearTopLeft]);Wt.get3PlaneInterPoint(v,p,u,n[H.FrustumCorner.nearBottomLeft]);Wt.get3PlaneInterPoint(y,p,f,n[H.FrustumCorner.FarBottomRight]);Wt.get3PlaneInterPoint(y,m,f,n[H.FrustumCorner.FarTopRight]);Wt.get3PlaneInterPoint(y,m,u,n[H.FrustumCorner.FarTopLeft]);Wt.get3PlaneInterPoint(y,p,u,n[H.FrustumCorner.FarBottomLeft]);var T=0;for(var E=0;E<6;E++){var b;switch(E){case te.Near:b=v;break;case te.Far:b=y;break;default:b=t[E];break}if(St.dot(b.normal,r)<0){b.cloneTo(x[T]);o[T]=E;T++}}var S=T;for(var E=0;E<T;E++){var C=o[E];var R=l[C];for(var A=0;A<4;A++){var L=R[A];var I=true;for(var M=0;M<T;M++)if(L==o[M]){I=false;break}if(I){var D=_[C][L];var w=n[D[0]];var P=n[D[1]];St.add(w,r,h);O.createPlaneBy3P(w,P,h,x[S++])}}}s.cullPlaneCount=S}static getBoundSphereByFrustum(t,e,a,i,r,s,n){var o;var l;var _=Math.sqrt(1+i*i)*Math.tan(a/2);var h=_*_;var x=e-t;var c=e+t;if(h>x/c){o=e;l=e*_}else{o=.5*c*(1+h);l=.5*Math.sqrt(x*x+2*(e*e+t*t)*h+c*c*h*h)}var d=n.center;n.radius=l;St.scale(s,o,d);St.add(r,d,d);return o}static getMaxTileResolutionInAtlas(t,e,a){var i=Math.min(t,e);var r=Math.floor(t/i)*Math.floor(e/i);while(r<a){i=Math.floor(i>>1);r=Math.floor(t/i)*Math.floor(e/i)}return i}static getDirectionalLightMatrices(t,e,a,i,r,s,n,o){var l=n.splitBoundSphere;var _=l.center;var h=l.radius;var x=s/2;var c=h*x/(x-ee.atlasBorderSize);var d=c*2;var u=s/d;var f=d/s;var p=Math.ceil(St.dot(_,t)*u)*f;var m=Math.ceil(St.dot(_,e)*u)*f;var g=St.dot(_,a);_.x=t.x*p+e.x*m+a.x*g;_.y=t.y*p+e.y*m+a.y*g;_.z=t.z*p+e.z*m+a.z*g;var v=n.position;var y=n.viewMatrix;var T=n.projectionMatrix;var E=n.viewProjectMatrix;n.resolution=s;n.offsetX=i%2*s;n.offsetY=Math.floor(i/2)*s;St.scale(a,h+r,v);St.subtract(_,v,v);k.createLookAt(v,_,t,y);k.createOrthoOffCenter(-c,c,-c,c,0,h*2+r,T);k.multiply(T,y,E);F._mulMatrixArray(ee._shadowMapScaleOffsetMatrix.elements,E.elements,0,o,i*16)}static getSpotLightShadowData(t,e,a,i,r,s){var n=t.position=e.transform.position;t.resolution=a;s.setValue(1/a,1/a,a,a);t.offsetX=0;t.offsetY=0;var o=e.lightWorldMatrix;var l=t.viewMatrix;var _=t.projectionMatrix;var h=t.viewProjectMatrix;var x=t.cameraCullInfo.boundFrustum;o.invert(l);k.createPerspective(3.1416*e.spotAngle/180,1,.1,e.range,_);i.y=e.shadowStrength;k.multiply(_,l,h);x.matrix=h;h.cloneTo(r);t.cameraCullInfo.position=n}static prepareShadowReceiverShaderValues(t,e,a,i,r,s,n,o,l){s.setValue(1/e,1/a,e,a);n.setValue(t._shadowStrength,0,0,0);if(r>1){const f=16;for(var _=r*f,h=4*f;_<h;_++)o[_]=0;for(var _=0;_<r;_++){var x=i[_].splitBoundSphere;var c=x.center;var d=x.radius;var u=_*4;l[u]=c.x;l[u+1]=c.y;l[u+2]=c.z;l[u+3]=d*d}const p=4;for(var _=r*p,h=4*p;_<h;_++)l[_]=0}}}ee._tempMatrix0=new k;ee._shadowMapScaleOffsetMatrix=new k(.5,0,0,0,0,.5,0,0,0,0,1,0,.5,.5,0,1);ee._frustumCorners=[new St,new St,new St,new St,new St,new St,new St,new St];ee._adjustNearPlane=new O(new St);ee._adjustFarPlane=new O(new St);ee._backPlaneFaces=new Array(5);ee._edgePlanePoint2=new St;ee._frustumPlaneNeighbors=[[te.Left,te.Right,te.Top,te.Bottom],[te.Left,te.Right,te.Top,te.Bottom],[te.Near,te.Far,te.Top,te.Bottom],[te.Near,te.Far,te.Top,te.Bottom],[te.Near,te.Far,te.Left,te.Right],[te.Near,te.Far,te.Left,te.Right]];ee._frustumTwoPlaneCorners=[[[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.nearBottomLeft,H.FrustumCorner.nearTopLeft],[H.FrustumCorner.nearTopRight,H.FrustumCorner.nearBottomRight],[H.FrustumCorner.nearBottomRight,H.FrustumCorner.nearBottomLeft],[H.FrustumCorner.nearTopLeft,H.FrustumCorner.nearTopRight]],[[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.FarTopLeft,H.FrustumCorner.FarBottomLeft],[H.FrustumCorner.FarBottomRight,H.FrustumCorner.FarTopRight],[H.FrustumCorner.FarBottomLeft,H.FrustumCorner.FarBottomRight],[H.FrustumCorner.FarTopRight,H.FrustumCorner.FarTopLeft]],[[H.FrustumCorner.nearTopLeft,H.FrustumCorner.nearBottomLeft],[H.FrustumCorner.FarBottomLeft,H.FrustumCorner.FarTopLeft],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.nearBottomLeft,H.FrustumCorner.FarBottomLeft],[H.FrustumCorner.FarTopLeft,H.FrustumCorner.nearTopLeft]],[[H.FrustumCorner.nearBottomRight,H.FrustumCorner.nearTopRight],[H.FrustumCorner.FarTopRight,H.FrustumCorner.FarBottomRight],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.FarBottomRight,H.FrustumCorner.nearBottomRight],[H.FrustumCorner.nearTopRight,H.FrustumCorner.FarTopRight]],[[H.FrustumCorner.nearBottomLeft,H.FrustumCorner.nearBottomRight],[H.FrustumCorner.FarBottomRight,H.FrustumCorner.FarBottomLeft],[H.FrustumCorner.FarBottomLeft,H.FrustumCorner.nearBottomLeft],[H.FrustumCorner.nearBottomRight,H.FrustumCorner.FarBottomRight],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.unknown,H.FrustumCorner.unknown]],[[H.FrustumCorner.nearTopRight,H.FrustumCorner.nearTopLeft],[H.FrustumCorner.FarTopLeft,H.FrustumCorner.FarTopRight],[H.FrustumCorner.nearTopLeft,H.FrustumCorner.FarTopLeft],[H.FrustumCorner.FarTopRight,H.FrustumCorner.nearTopRight],[H.FrustumCorner.unknown,H.FrustumCorner.unknown],[H.FrustumCorner.unknown,H.FrustumCorner.unknown]]];ee.atlasBorderSize=4;(function(t){t[t["SolidColor"]=0]="SolidColor";t[t["Sky"]=1]="Sky";t[t["DepthOnly"]=2]="DepthOnly";t[t["Nothing"]=3]="Nothing"})(H.CameraClearFlags||(H.CameraClearFlags={}));(function(t){t[t["BeforeForwardOpaque"]=0]="BeforeForwardOpaque";t[t["BeforeSkyBox"]=2]="BeforeSkyBox";t[t["BeforeTransparent"]=4]="BeforeTransparent";t[t["BeforeImageEffect"]=6]="BeforeImageEffect";t[t["AfterEveryThing"]=8]="AfterEveryThing"})(H.CameraEventFlags||(H.CameraEventFlags={}));class ae extends Qt{constructor(t=0,e=.3,a=1e3){super(e,a);this._updateViewMatrix=true;this._postProcess=null;this._enableHDR=false;this._viewportParams=new bt;this._projectionParams=new bt;this._needBuiltInRenderTexture=false;this._offScreenRenderTexture=null;this._internalRenderTexture=null;this._cameraEventCommandBuffer={};this._clusterPlaneCacheFlag=new Ct(-1,-1);this._screenOffsetScale=new bt;this.enableRender=true;this.clearFlag=H.CameraClearFlags.SolidColor;this._viewMatrix=new k;this._projectionMatrix=new k;this._projectionViewMatrix=new k;this._viewport=new Xt(0,0,0,0);this._normalizedViewport=new Xt(0,0,1,1);this._aspectRatio=t;this._boundFrustum=new Wt(new k);this._calculateProjectionMatrix();Et.Laya.stage.on(Et.Event.RESIZE,this,this._onScreenSizeChanged);this.transform.on(Et.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}get aspectRatio(){if(this._aspectRatio===0){var t=this.viewport;return t.width/t.height}return this._aspectRatio}set aspectRatio(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t;this._calculateProjectionMatrix()}get viewport(){if(this._offScreenRenderTexture)this._calculationViewport(this._normalizedViewport,this._offScreenRenderTexture.width,this._offScreenRenderTexture.height);else this._calculationViewport(this._normalizedViewport,pt.clientWidth,pt.clientHeight);return this._viewport}set viewport(t){var e;var a;if(this._offScreenRenderTexture){e=this._offScreenRenderTexture.width;a=this._offScreenRenderTexture.height}else{e=pt.clientWidth;a=pt.clientHeight}this._normalizedViewport.x=t.x/e;this._normalizedViewport.y=t.y/a;this._normalizedViewport.width=t.width/e;this._normalizedViewport.height=t.height/a;this._calculationViewport(this._normalizedViewport,e,a);this._calculateProjectionMatrix()}get normalizedViewport(){return this._normalizedViewport}set normalizedViewport(t){var e;var a;if(this._offScreenRenderTexture){e=this._offScreenRenderTexture.width;a=this._offScreenRenderTexture.height}else{e=pt.clientWidth;a=pt.clientHeight}if(this._normalizedViewport!==t)t.cloneTo(this._normalizedViewport);this._calculationViewport(t,e,a);this._calculateProjectionMatrix()}get viewMatrix(){if(this._updateViewMatrix){var t=this.transform.getWorldLossyScale();var e=t.x;var a=t.y;var i=t.z;var r=this._viewMatrix.elements;this.transform.worldMatrix.cloneTo(this._viewMatrix);r[0]/=e;r[1]/=e;r[2]/=e;r[4]/=a;r[5]/=a;r[6]/=a;r[8]/=i;r[9]/=i;r[10]/=i;this._viewMatrix.invert(this._viewMatrix);this._updateViewMatrix=false}return this._viewMatrix}get projectionMatrix(){return this._projectionMatrix}set projectionMatrix(t){this._projectionMatrix=t;this._useUserProjectionMatrix=true}get projectionViewMatrix(){k.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix);return this._projectionViewMatrix}get boundFrustum(){this._boundFrustum.matrix=this.projectionViewMatrix;return this._boundFrustum}get renderTarget(){return this._offScreenRenderTexture}set renderTarget(t){var e=this._offScreenRenderTexture;if(e!==t){e&&(e._isCameraTarget=false);t&&(t._isCameraTarget=true);this._offScreenRenderTexture=t;this._calculateProjectionMatrix()}}get postProcess(){return this._postProcess}set postProcess(t){this._postProcess=t;if(!t)return;t&&t._init(this)}get enableHDR(){return this._enableHDR}set enableHDR(t){if(t&&!Et.SystemUtils.supportRenderTextureFormat(Et.RenderTextureFormat.R16G16B16A16)){console.warn("Camera:can't enable HDR in this device.");return}this._enableHDR=t}get enableBuiltInRenderTexture(){return this._needBuiltInRenderTexture}set enableBuiltInRenderTexture(t){this._needBuiltInRenderTexture=t}_calculationViewport(t,e,a){var i=t.x*e;var r=t.y*a;var s=i+Math.max(t.width*e,0);var n=r+Math.max(t.height*a,0);var o=Math.ceil(i);var l=Math.ceil(r);var _=Math.floor(s);var h=Math.floor(n);var x=o-i>=.5?Math.floor(i):o;var c=l-r>=.5?Math.floor(r):l;var d=s-_>=.5?Math.ceil(s):_;var u=n-h>=.5?Math.ceil(n):h;this._viewport.x=x;this._viewport.y=c;this._viewport.width=d-x;this._viewport.height=u-c}_calculateProjectionMatrix(){if(!this._useUserProjectionMatrix){if(this._orthographic){var t=this.orthographicVerticalSize*.5;var e=t*this.aspectRatio;k.createOrthoOffCenter(-e,e,-t,t,this.nearPlane,this.farPlane,this._projectionMatrix)}else{k.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix)}}}_isLayerVisible(t){return(Math.pow(2,t)&this.cullingMask)!=0}_onTransformChanged(t){t&=d.TRANSFORM_WORLDMATRIX;t&&(this._updateViewMatrix=true)}_parse(t,e){super._parse(t,e);var a=t.clearFlag;a!==undefined&&(this.clearFlag=a);var i=t.viewport;this.normalizedViewport=new Xt(i[0],i[1],i[2],i[3]);var r=t.enableHDR;r!==undefined&&(this.enableHDR=r)}_getCanvasWidth(){if(this._offScreenRenderTexture)return this._offScreenRenderTexture.width;else return pt.clientWidth}_getCanvasHeight(){if(this._offScreenRenderTexture)return this._offScreenRenderTexture.height;else return pt.clientHeight}_getRenderTexture(){return this._internalRenderTexture||this._offScreenRenderTexture}_needInternalRenderTexture(){return this._postProcess||this._enableHDR||this._needBuiltInRenderTexture?true:false}_getRenderTextureFormat(){if(this._enableHDR)return Et.RenderTextureFormat.R16G16B16A16;else return Et.RenderTextureFormat.R8G8B8}_prepareCameraToRender(){super._prepareCameraToRender();var t=this.viewport;this._viewportParams.setValue(t.x,t.y,t.width,t.height);this._projectionParams.setValue(this._nearPlane,this._farPlane,pt._instance.invertY?-1:1,0);this._shaderValues.setVector(Qt.VIEWPORT,this._viewportParams);this._shaderValues.setVector(Qt.PROJECTION_PARAMS,this._projectionParams)}_applyViewProject(t,e,a){var i;var r=this._shaderValues;if(t.invertY){k.multiply(Qt._invertYScaleMatrix,a,Qt._invertYProjectionMatrix);k.multiply(Qt._invertYProjectionMatrix,e,Qt._invertYProjectionViewMatrix);a=Qt._invertYProjectionMatrix;i=Qt._invertYProjectionViewMatrix}else{k.multiply(a,e,this._projectionViewMatrix);i=this._projectionViewMatrix}t.viewMatrix=e;t.projectionMatrix=a;t.projectionViewMatrix=i;r.setMatrix4x4(Qt.VIEWMATRIX,e);r.setMatrix4x4(Qt.PROJECTMATRIX,a);r.setMatrix4x4(Qt.VIEWPROJECTMATRIX,i)}_updateClusterPlaneXY(){var t=this.fieldOfView;var e=this.aspectRatio;if(this._clusterPlaneCacheFlag.x!==t||this._clusterPlaneCacheFlag.y!==e){var a=tt._config.lightClusterCount;var i=a.x,r=a.y;var s=i+1,n=r+1;var o=this._clusterXPlanes,l=this._clusterYPlanes;if(!o){o=this._clusterXPlanes=new Array(s);l=this._clusterYPlanes=new Array(n);for(var _=0;_<s;_++)o[_]=new St;for(var _=0;_<n;_++)l[_]=new St}var h=Math.tan(this.fieldOfView/2*Math.PI/180);var x=this.aspectRatio*h;var c=2*h/i;var d=2*x/r;for(var _=0;_<s;_++){var u=-x+d*_;var f=Math.sqrt(1+u*u);var p=1/f;var m=o[_];m.setValue(p,0,-u*p)}for(var _=0;_<n;_++){var u=h-c*_;var f=Math.sqrt(1+u*u);var g=-1/f;var v=l[_];v.setValue(0,g,-u*g)}this._clusterPlaneCacheFlag.x=t;this._clusterPlaneCacheFlag.y=e}}_applyCommandBuffer(t,e){var a=Et.LayaGL.instance;var i=this._cameraEventCommandBuffer[t];if(!i||i.length==0)return;if(this._internalRenderTexture)this._internalRenderTexture._end();i.forEach(function(t){t._context=e;t._apply()});mt.currentActive&&mt.currentActive._end();if(this._internalRenderTexture)this._internalRenderTexture._start();else{a.bindFramebuffer(a.FRAMEBUFFER,null)}a.viewport(0,0,e.viewport.width,e.viewport.height)}render(t=null,e=null){if(!this.activeInHierarchy)return;var a=this.viewport;var i=this._needInternalRenderTexture();var r=Et.LayaGL.instance;var s=pt._instance;var n=s.scene=this._scene;s.pipelineMode="Forward";if(i){this._internalRenderTexture=mt.createFromPool(a.width,a.height,this._getRenderTextureFormat(),Et.RenderTextureDepthFormat.DEPTH_16);this._internalRenderTexture.filterMode=Et.FilterMode.Bilinear}else{this._internalRenderTexture=null}var o;var l=n._mainDirectionLight;var _=l&&l.shadowMode!==H.ShadowMode.None&&ee.supportShadow();if(_){n._shaderValues.removeDefine(Jt.SHADERDEFINE_SHADOW_SPOT);n._shaderValues.addDefine(Jt.SHADERDEFINE_SHADOW);o=D.Scene3D._shadowCasterPass;o.update(this,l,D.ShadowLightType.DirectionLight);o.render(s,n,D.ShadowLightType.DirectionLight)}else{n._shaderValues.removeDefine(Jt.SHADERDEFINE_SHADOW)}var h=n._mainSpotLight;var x=h&&h.shadowMode!==H.ShadowMode.None&&ee.supportShadow();if(x){n._shaderValues.removeDefine(Jt.SHADERDEFINE_SHADOW);n._shaderValues.addDefine(Jt.SHADERDEFINE_SHADOW_SPOT);o=D.Scene3D._shadowCasterPass;o.update(this,h,D.ShadowLightType.SpotLight);o.render(s,n,D.ShadowLightType.SpotLight)}else{n._shaderValues.removeDefine(Jt.SHADERDEFINE_SHADOW_SPOT)}if(_)n._shaderValues.addDefine(Jt.SHADERDEFINE_SHADOW);if(x)n._shaderValues.addDefine(Jt.SHADERDEFINE_SHADOW_SPOT);s.camera=this;s.cameraShaderValue=this._shaderValues;ae._updateMark++;n._preRenderScript();if(i&&!this._offScreenRenderTexture&&(this.clearFlag==H.CameraClearFlags.DepthOnly||this.clearFlag==H.CameraClearFlags.Nothing)){if(this._enableHDR){var c=mt.createFromPool(a.width,a.height,Et.RenderTextureFormat.R8G8B8,Et.RenderTextureDepthFormat.DEPTH_16);c.filterMode=Et.FilterMode.Bilinear;Et.WebGLContext.bindTexture(r,r.TEXTURE_2D,c._getSource());r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a.x,pt.clientHeight-(a.y+a.height),a.width,a.height);var d=Pt.create(c,this._internalRenderTexture);d.run();d.recover();mt.recoverToPool(c)}else{Et.WebGLContext.bindTexture(r,r.TEXTURE_2D,this._internalRenderTexture._getSource());r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a.x,pt.clientHeight-(a.y+a.height),a.width,a.height)}}var u=this._getRenderTexture();u&&u._start();s.viewport=a;this._prepareCameraToRender();var f=tt._config._multiLighting;f&&Gt.instance.update(this,this._scene);this._applyViewProject(s,this.viewMatrix,this._projectionMatrix);n._preCulling(s,this,t,e);n._clear(r,s);this._applyCommandBuffer(H.CameraEventFlags.BeforeForwardOpaque,s);n._renderScene(s,D.Scene3D.SCENERENDERFLAG_RENDERQPAQUE);this._applyCommandBuffer(H.CameraEventFlags.BeforeSkyBox,s);n._renderScene(s,D.Scene3D.SCENERENDERFLAG_SKYBOX);this._applyCommandBuffer(H.CameraEventFlags.BeforeTransparent,s);n._renderScene(s,D.Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT);n._postRenderScript();this._applyCommandBuffer(H.CameraEventFlags.BeforeImageEffect,s);u&&u._end();if(i){if(this._postProcess){this._postProcess._render();this._postProcess._applyPostProcessCommandBuffers()}else if(this._enableHDR||this._needBuiltInRenderTexture){var p=this._getCanvasWidth(),m=this._getCanvasHeight();this._screenOffsetScale.setValue(a.x/p,a.y/m,a.width/p,a.height/m);var d=Pt.create(this._internalRenderTexture,this._offScreenRenderTexture?this._offScreenRenderTexture:null,this._screenOffsetScale,null,null,0,Pt._SCREENTYPE_QUAD,null,true);d.run();d.recover()}mt.recoverToPool(this._internalRenderTexture)}this._applyCommandBuffer(H.CameraEventFlags.AfterEveryThing,s);if(_||x)o.cleanUp()}viewportPointToRay(t,e){Yt.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)}normalizedViewportPointToRay(t,e){var a=ae._tempVector20;var i=this.viewport;a.x=t.x*i.width;a.y=t.y*i.height;Yt.calculateCursorRay(a,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)}worldToViewportPoint(t,e){k.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix);this.viewport.project(t,this._projectionViewMatrix,e);e.x=e.x/Et.Laya.stage.clientScaleX;e.y=e.y/Et.Laya.stage.clientScaleY}worldToNormalizedViewportPoint(t,e){k.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix);this.normalizedViewport.project(t,this._projectionViewMatrix,e);e.x=e.x/Et.Laya.stage.clientScaleX;e.y=e.y/Et.Laya.stage.clientScaleY}convertScreenCoordToOrthographicCoord(t,e){if(this._orthographic){var a=pt.clientWidth;var i=pt.clientHeight;var r=this.orthographicVerticalSize*this.aspectRatio/a;var s=this.orthographicVerticalSize/i;e.x=(-a/2+t.x*Et.Laya.stage.clientScaleX)*r;e.y=(i/2-t.y*Et.Laya.stage.clientScaleY)*s;e.z=(this.nearPlane-this.farPlane)*(t.z+1)/2-this.nearPlane;St.transformCoordinate(e,this.transform.worldMatrix,e);return true}else{return false}}destroy(t=true){this._offScreenRenderTexture=null;this.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onTransformChanged);super.destroy(t)}addCommandBuffer(t,e){var a=this._cameraEventCommandBuffer[t];if(!a)a=this._cameraEventCommandBuffer[t]=[];if(a.indexOf(e)<0)a.push(e);e._camera=this}removeCommandBuffer(t,e){var a=this._cameraEventCommandBuffer[t];if(a){var i=a.indexOf(e);if(i!=-1)a.splice(i,1)}else throw"Camera:unknown event."}removeCommandBuffers(t){if(this._cameraEventCommandBuffer[t])this._cameraEventCommandBuffer[t].length=0}_create(){return new ae}}ae._tempVector20=new Ct;ae._updateMark=0;class ie{constructor(){this.renderSubShader=null;this.renderType=ie.RENDERTYPE_NORMAL}getInvertFront(){return this._transform._isFrontFaceInvert}setTransform(t){this._transform=t}setGeometry(t){this._geometry=t}addToOpaqueRenderQueue(t,e){e.elements.add(this)}addToTransparentRenderQueue(t,e){e.elements.add(this);e.lastTransparentBatched=false;e.lastTransparentRenderElement=this}_update(t,e,a,i,r=0){if(this.material){var s=this.material._shader.getSubShaderAt(0);this.renderSubShader=null;if(a){if(i){var n=s.getFlag(i);if(n){var o=a._subShaders;for(var l=0,_=o.length;l<_;l++){var h=o[l];if(n===h.getFlag(i)){this.renderSubShader=h;break}}if(!this.renderSubShader)return}else{return}}else{this.renderSubShader=a.getSubShaderAt(r)}}else{this.renderSubShader=s}var x=t._getRenderQueue(this.material.renderQueue);if(x.isTransparent)this.addToTransparentRenderQueue(e,x);else this.addToOpaqueRenderQueue(e,x)}}_render(t){var e=t.invertY;var a,i,r;var s=ae._updateMark;var n=t.scene;var o=t.cameraShaderValue;var l=this._transform;var _=this._geometry;t.renderElement=this;var h=s!==this.render._updateMark||this.renderType!==this.render._updateRenderType;if(h){this.render._renderUpdate(t,l);this.render._renderUpdateWithCamera(t,l);this.render._updateMark=s;this.render._updateRenderType=this.renderType}else{if(this.renderType==ie.RENDERTYPE_INSTANCEBATCH){this.render._renderUpdate(t,l);this.render._renderUpdateWithCamera(t,l)}}var x=t.pipelineMode;if(_._prepareRender(t)){var c=this.renderSubShader._passes;for(var d=0,u=c.length;d<u;d++){var f=c[d];if(f._pipelineMode!==x)continue;var p=ie._compileDefine;n._shaderValues._defineDatas.cloneTo(p);p.addDefineDatas(this.render._shaderValues._defineDatas);p.addDefineDatas(this.material._shaderValues._defineDatas);var m=t.shader=f.withCompile(p);var g=m.bind();var v=s!==m._uploadMark;var y=m._uploadScene!==n||v;if(y||g){m.uploadUniforms(m._sceneUniformParamsMap,n._shaderValues,y);m._uploadScene=n}var T=m._uploadRender!==this.render||m._uploadRenderType!==this.renderType||v;if(T||g){m.uploadUniforms(m._spriteUniformParamsMap,this.render._shaderValues,T);m._uploadRender=this.render;m._uploadRenderType=this.renderType}var E=m._uploadCameraShaderValue!==o||v;if(E||g){m.uploadUniforms(m._cameraUniformParamsMap,o,E);m._uploadCameraShaderValue=o}var b=m._uploadMaterial!==this.material||v;if(b||g){m.uploadUniforms(m._materialUniformParamsMap,this.material._shaderValues,b);m._uploadMaterial=this.material}var S=this.material._shaderValues;if(a!==this.material||i!==m){m.uploadRenderStateBlendDepth(S);m.uploadRenderStateFrontFace(S,e,this.getInvertFront());a=this.material;i=m;r=this.render}else{if(r!==this.render){m.uploadRenderStateFrontFace(S,e,this.getInvertFront());r=this.render}}_._render(t);m._uploadMark=s}}if(this.renderType!==ie.RENDERTYPE_NORMAL)this.render._revertBatchRenderUpdate(t)}destroy(){this._transform=null;this._geometry=null;this.material=null;this.render=null}}ie.RENDERTYPE_NORMAL=0;ie.RENDERTYPE_STATICBATCH=1;ie.RENDERTYPE_INSTANCEBATCH=2;ie.RENDERTYPE_VERTEXBATCH=3;ie._compileDefine=new gt;class re extends wt{static create(t,e,a,i){var r;r=re._pool.length>0?re._pool.pop():new re;r._render=t;r._material=e;r._subShaderIndex=a;r._commandBuffer=i;return r}_elementRender(t,e){var a=e.invertY;var i,r,s;var n=ae._updateMark;var o=e.scene;var l=e.cameraShaderValue;var _=t._transform;var h=t._geometry;e.renderElement=t;var x=n!==t.render._updateMark||t.renderType!==t.render._updateRenderType;if(x){t.render._renderUpdate(e,_);t.render._renderUpdateWithCamera(e,_);t.render._updateMark=n;t.render._updateRenderType=t.renderType}else{if(t.renderType==ie.RENDERTYPE_INSTANCEBATCH){t.render._renderUpdate(e,_);t.render._renderUpdateWithCamera(e,_)}}var c=e.pipelineMode;if(h._prepareRender(e)){var d=t.renderSubShader._passes;for(var u=0,f=d.length;u<f;u++){var p=d[u];if(p._pipelineMode!==c)continue;var m=re._compileDefine;o._shaderValues._defineDatas.cloneTo(m);m.addDefineDatas(t.render._shaderValues._defineDatas);m.addDefineDatas(this._material._shaderValues._defineDatas);var g=e.shader=p.withCompile(m);var v=g.bind();var y=n!==g._uploadMark;var T=g._uploadScene!==o||y;if(T||v){g.uploadUniforms(g._sceneUniformParamsMap,o._shaderValues,T);g._uploadScene=o}var E=g._uploadRender!==t.render||g._uploadRenderType!==t.renderType||y;if(E||v){g.uploadUniforms(g._spriteUniformParamsMap,t.render._shaderValues,E);g._uploadRender=t.render;g._uploadRenderType=t.renderType}var b=g._uploadCameraShaderValue!==l||y;if(b||v){g.uploadUniforms(g._cameraUniformParamsMap,l,b);g._uploadCameraShaderValue=l}var S=g._uploadMaterial!==this._material||y;if(S||v){g.uploadUniforms(g._materialUniformParamsMap,this._material._shaderValues,S);g._uploadMaterial=this._material}var C=this._material._shaderValues;if(i!==this._material||r!==g){g.uploadRenderStateBlendDepth(C);g.uploadRenderStateFrontFace(C,a,t.getInvertFront());i=this._material;r=g;s=t.render}else{if(s!==t.render){g.uploadRenderStateFrontFace(C,a,t.getInvertFront());s=t.render}}h._render(e);g._uploadMark=n}}if(t.renderType!==ie.RENDERTYPE_NORMAL)t.render._revertBatchRenderUpdate(e)}run(){if(!this._material)throw"This render command material cannot be empty";this.setContext(this._commandBuffer._context);var t=this._context;var e=t.scene;var a=this._render._renderElements;for(var i=0,r=a.length;i<r;i++){var s=a[i];s._update(e,t,this._material._shader,null,this._subShaderIndex);this._elementRender(s,t)}}recover(){re._pool.push(this)}}re._pool=[];re._compileDefine=new gt;class se extends wt{constructor(){super(...arguments);this._nameID=0;this._value=null;this._dataType=-1}static create(t,e,a,i){var r;r=se._pool.length>0?se._pool.pop():new se;r._nameID=t;r._value=e;r._dataType=a;r._commandBuffer=i;return r}run(){var t=this._commandBuffer._camera.scene._shaderValues;switch(this._dataType){case H.ShaderDataType.Int:t.setInt(this._nameID,this._value);break;case H.ShaderDataType.Number:t.setNumber(this._nameID,this._value);break;case H.ShaderDataType.Bool:t.setBool(this._nameID,this._value);break;case H.ShaderDataType.Matrix4x4:t.setMatrix4x4(this._nameID,this._value);break;case H.ShaderDataType.Quaternion:t.setQuaternion(this._nameID,this._value);break;case H.ShaderDataType.Texture:t.setTexture(this._nameID,this._value);break;case H.ShaderDataType.Vector:t.setVector(this._nameID,this._value);break;case H.ShaderDataType.Vector2:t.setVector2(this._nameID,this._value);break;case H.ShaderDataType.Vector3:t.setVector3(this._nameID,this._value);break;case H.ShaderDataType.Buffer:t.setBuffer(this._nameID,this._value);break;default:throw"no type shaderValue on this CommendBuffer"}}recover(){se._pool.push(this);this._nameID=0;this._value=null;this._dataType=-1}}se._pool=[];class ne{constructor(){this._camera=null;this._commands=[]}_apply(){for(var t=0,e=this._commands.length;t<e;t++)this._commands[t].run()}setShaderDataTexture(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Texture,this))}setGlobalTexture(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Texture,this))}setShaderDataVector(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Vector,this))}setGlobalVector(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Vector,this))}setShaderDataVector3(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Vector3,this))}setGlobalVector3(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Vector3,this))}setShaderDataVector2(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Vector2,this))}setGlobalVector2(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Vector2,this))}setShaderDataNumber(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Number,this))}setGlobalNumber(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Number,this))}setShaderDataInt(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Int,this))}setGlobalInt(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Int,this))}setShaderDataMatrix(t,e,a){this._commands.push(Nt.create(t,e,a,H.ShaderDataType.Matrix4x4,this))}setGlobalMatrix(t,e){this._commands.push(se.create(t,e,H.ShaderDataType.Matrix4x4,this))}blitScreenQuad(t,e,a=null,i=null,r=null,s=0){this._commands.push(Pt.create(t,e,a,i,r,s,Pt._SCREENTYPE_QUAD,this))}blitScreenQuadByMaterial(t,e,a=null,i=null,r=0){var s;var n;if(i){s=i._shader;n=i.shaderData}this._commands.push(Pt.create(t,e,a,s,n,r,Pt._SCREENTYPE_QUAD,this))}blitScreenTriangle(t,e,a=null,i=null,r=null,s=0,n=false){this._commands.push(Pt.create(t,e,a,i,r,s,Pt._SCREENTYPE_TRIANGLE,this,n))}setRenderTarget(t){this._commands.push(Ot.create(t))}clearRenderTarget(t,e,a,i=1){this._commands.push(Vt.create(t,e,a,i,this))}drawMesh(t,e,a,i,r){this._commands.push(Ft.create(t,e,a,i,r,this))}drawRender(t,e,a){this._commands.push(re.create(t,e,a,this))}clear(){for(var t=0,e=this._commands.length;t<e;t++)this._commands[t].recover();this._commands.length=0}}class oe{constructor(){this.source=null;this.destination=null;this.camera=null;this.compositeShaderData=null;this.command=null;this.deferredReleaseTextures=[]}}class le{constructor(){this._compositeShader=P.find("PostProcessComposite");this._compositeShaderData=new yt;this._effects=[];this._context=null;this._context=new oe;this._context.compositeShaderData=this._compositeShaderData;this._context.command=new ne}static __init__(){le.SHADERDEFINE_BLOOM_LOW=P.getDefineByName("BLOOM_LOW");le.SHADERDEFINE_BLOOM=P.getDefineByName("BLOOM");le.SHADERDEFINE_FINALPASS=P.getDefineByName("FINALPASS")}_init(t){this._context.camera=t;this._context.command._camera=t}_render(){var t=yt._SET_RUNTIME_VALUE_MODE_REFERENCE_;Et.ILaya.Render.supportWebGLPlusRendering&&yt.setRuntimeValueMode(false);var e=this._context.camera;var a=e.viewport;var i=e._internalRenderTexture;var r=i;this._context.command.clear();this._context.source=r;this._context.destination=i;this._context.compositeShaderData.clearDefine();this._context.compositeShaderData.setTexture(le.SHADERVALUE_AUTOEXPOSURETEX,Et.Texture2D.whiteTexture);for(var s=0,n=this._effects.length;s<n;s++)this._effects[s].render(this._context);this._compositeShaderData.addDefine(le.SHADERDEFINE_FINALPASS);var o=e._offScreenRenderTexture;var l=o?o:null;this._context.destination=l;var _=e._getCanvasWidth(),h=e._getCanvasHeight();e._screenOffsetScale.setValue(a.x/_,a.y/h,a.width/_,a.height/h);this._context.command.blitScreenTriangle(this._context.source,l,e._screenOffsetScale,this._compositeShader,this._compositeShaderData,0,true);mt.recoverToPool(r);var x=this._context.deferredReleaseTextures;for(s=0,n=x.length;s<n;s++)mt.recoverToPool(x[s]);x.length=0;Et.ILaya.Render.supportWebGLPlusRendering&&yt.setRuntimeValueMode(t)}addEffect(t){this._effects.push(t)}removeEffect(t){var e=this._effects.indexOf(t);if(e!==-1)this._effects.splice(e,1)}_applyPostProcessCommandBuffers(){this._context.command._apply()}}le.SHADERVALUE_MAINTEX=P.propertyNameToID("u_MainTex");le.SHADERVALUE_BLOOMTEX=P.propertyNameToID("u_BloomTex");le.SHADERVALUE_AUTOEXPOSURETEX=P.propertyNameToID("u_AutoExposureTex");le.SHADERVALUE_BLOOM_DIRTTEX=P.propertyNameToID("u_Bloom_DirtTex");le.SHADERVALUE_BLOOMTEX_TEXELSIZE=P.propertyNameToID("u_BloomTex_TexelSize");le.SHADERVALUE_BLOOM_DIRTTILEOFFSET=P.propertyNameToID("u_Bloom_DirtTileOffset");le.SHADERVALUE_BLOOM_SETTINGS=P.propertyNameToID("u_Bloom_Settings");le.SHADERVALUE_BLOOM_COLOR=P.propertyNameToID("u_Bloom_Color");class _e extends Et.EventDispatcher{constructor(t,e=null,a=null,i=null,r=null){super();this._owner=t;this._children=[];this._localMatrix=new Float32Array(16);this._localPosition=new St;this._localRotation=new M;this._localScale=new St;this._worldMatrix=new Float32Array(16);this._localQuaternionUpdate=false;this._locaEulerlUpdate=false;this._localUpdate=false;this._worldUpdate=true}_getlocalMatrix(){if(this._localUpdate){F._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix);this._localUpdate=false}return this._localMatrix}_onWorldTransform(){if(!this._worldUpdate){this._worldUpdate=true;this.event(Et.Event.TRANSFORM_CHANGED);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldTransform()}}get localPosition(){return this._localPosition}set localPosition(t){this._localPosition=t;this._localUpdate=true;this._onWorldTransform()}get localRotation(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;M.createFromYawPitchRoll(t.y/_e._angleToRandin,t.x/_e._angleToRandin,t.z/_e._angleToRandin,this._localRotation);this._localQuaternionUpdate=false}return this._localRotation}set localRotation(t){this._localRotation=t;this._locaEulerlUpdate=true;this._localQuaternionUpdate=false;this._localUpdate=true;this._onWorldTransform()}get localScale(){return this._localScale}set localScale(t){this._localScale=t;this._localUpdate=true;this._onWorldTransform()}get localRotationEuler(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(_e._tempVector3);var t=_e._tempVector3;var e=this._localRotationEuler;e.x=t.y*_e._angleToRandin;e.y=t.x*_e._angleToRandin;e.z=t.z*_e._angleToRandin;this._locaEulerlUpdate=false}return this._localRotationEuler}set localRotationEuler(t){this._localRotationEuler=t;this._locaEulerlUpdate=false;this._localQuaternionUpdate=true;this._localUpdate=true;this._onWorldTransform()}getWorldMatrix(){if(this._worldUpdate){if(this._parent!=null){F.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix)}else{var t=this._worldMatrix;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0;t[0]=t[5]=t[10]=t[15]=1}this._worldUpdate=false}return this._worldMatrix}setParent(t){if(this._parent!==t){if(this._parent){var e=this._parent._children;var a=e.indexOf(this);e.splice(a,1)}if(t){t._children.push(this);t&&this._onWorldTransform()}this._parent=t}}}_e._tempVector3=new St;_e._angleToRandin=180/Math.PI;class he{constructor(t=null,e=null,a=null,i=null){this._children=[];this.transform=new _e(this,t,e,a,i)}addChild(t){t._parent=this;t.transform.setParent(this.transform);this._children.push(t)}removeChild(t){var e=this._children.indexOf(t);e!==-1&&this._children.splice(e,1)}getChildByName(t){for(var e=0,a=this._children.length;e<a;e++){var i=this._children[e];if(i.name===t)return i}return null}getChildByIndex(t){return this._children[t]}getChildCount(){return this._children.length}cloneTo(t){var e=t;e.name=this.name;for(var a=0,i=this._children.length;a<i;a++){var r=this._children[a];var s=r.clone();e.addChild(s);var n=r.transform;var o=s.transform;var l=o.localPosition;var _=o.localRotation;var h=o.localScale;n.localPosition.cloneTo(l);n.localRotation.cloneTo(_);n.localScale.cloneTo(h);o.localPosition=l;o.localRotation=_;o.localScale=h}}clone(){var t=new he;this.cloneTo(t);return t}_cloneNative(t,e,a,i,r,s,n){var o=n._nativeCurCloneCount;r[o]=s;var l=new Float32Array(t.buffer,o*3*4,3);var _=new Float32Array(e.buffer,o*4*4,4);var h=new Float32Array(a.buffer,o*3*4,3);var x=new Float32Array(i.buffer,o*16*4,16);var c=new he(l,_,h,x);c._worldMatrixIndex=o;this._cloneToNative(c,t,e,a,i,r,o,n);return c}_cloneToNative(t,e,a,i,r,s,n,o){var l=t;l.name=this.name;for(var _=0,h=this._children.length;_<h;_++){var x=this._children[_];o._nativeCurCloneCount++;var c=x._cloneNative(e,a,i,r,s,n,o);l.addChild(c);var d=x.transform;var u=c.transform;var f=u.localPosition;var p=u.localRotation;var m=u.localScale;d.localPosition.cloneTo(f);d.localRotation.cloneTo(p);d.localScale.cloneTo(m);u.localPosition=f;u.localRotation=p;u.localScale=m}}}class xe extends Et.Resource{constructor(){super();this._nativeNodeCount=0;this._nativeCurCloneCount=0}static _parse(t,e=null,a=null){var i=new xe;i._rootNode=new he(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16));if(t.version){var r=t.rootNode;r&&i._parseNode(r,i._rootNode)}return i}static load(t,e){Et.ILaya.loader.create(t,e,null,xe.AVATAR)}_initCloneToAnimator(t,e){e._avatarNodeMap[t.name]=t;for(var a=0,i=t.getChildCount();a<i;a++)this._initCloneToAnimator(t.getChildByIndex(a),e)}_parseNode(t,e){var a=t.props.name;e.name=a;var i=t.props;var r=e.transform;var s=r.localPosition;var n=r.localRotation;var o=r.localScale;s.fromArray(i.translate);n.fromArray(i.rotation);o.fromArray(i.scale);r.localPosition=s;r.localRotation=n;r.localScale=o;var l=t.child;for(var _=0,h=l.length;_<h;_++){var x=l[_];var c=new he(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16));e.addChild(c);this._parseNode(x,c)}}_cloneDatasToAnimator(t){var e;e=this._rootNode.clone();var a=this._rootNode.transform;var i=e.transform;var r=i.localPosition;var s=i.localRotation;var n=i.localScale;a.localPosition.cloneTo(r);a.localRotation.cloneTo(s);a.localScale.cloneTo(n);i.localPosition=r;i.localRotation=s;i.localScale=n;t._avatarNodeMap={};this._initCloneToAnimator(e,t)}cloneTo(t){var e=t;var a=this._rootNode.clone();e._rootNode=a}clone(){var t=new xe;this.cloneTo(t);return t}_cloneDatasToAnimatorNative(t){var e=new Float32Array(this._nativeNodeCount*3);var a=new Float32Array(this._nativeNodeCount*4);var i=new Float32Array(this._nativeNodeCount*3);var r=new Float32Array(this._nativeNodeCount*16);var s=new Int16Array(this._nativeNodeCount);t._animationNodeLocalPositions=e;t._animationNodeLocalRotations=a;t._animationNodeLocalScales=i;t._animationNodeWorldMatrixs=r;t._animationNodeParentIndices=s;this._nativeCurCloneCount=0;var n=this._rootNode._cloneNative(e,a,i,r,s,-1,this);var o=this._rootNode.transform;var l=n.transform;var _=l.localPosition;var h=l.localRotation;var x=l.localScale;o.localPosition.cloneTo(_);o.localRotation.cloneTo(h);o.localScale.cloneTo(x);l.localPosition=_;l.localRotation=h;l.localScale=x;t._avatarNodeMap={};this._initCloneToAnimator(n,t)}}xe.AVATAR="AVATAR";class s extends Et.Resource{constructor(){super();this._shaderValues=null;this._shaderValues=new yt(this);this.renderQueue=s.RENDERQUEUE_OPAQUE;this._alphaTest=false}static load(t,e){Et.Laya.loader.create(t,e,null,s.MATERIAL)}static __initDefine__(){s.SHADERDEFINE_ALPHATEST=P.getDefineByName("ALPHATEST")}static _parse(t,e=null,a=null){var i=t;var r=i.props;var s;var n=r.type;var o=Et.ClassUtils.getRegClass(n);if(o)s=new o;else throw"_getSprite3DHierarchyInnerUrls 错误: "+t.type+" 不是类";switch(i.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var l,_;for(var h in r){switch(h){case"type":break;case"vectors":var x=r[h];for(l=0,_=x.length;l<_;l++){var c=x[l];var d=c.value;switch(d.length){case 2:s[c.name]=new Ct(d[0],d[1]);break;case 3:s[c.name]=new St(d[0],d[1],d[2]);break;case 4:s[c.name]=new bt(d[0],d[1],d[2],d[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var u=r[h];for(l=0,_=u.length;l<_;l++){var f=u[l];var p=f.path;p&&(s[f.name]=Et.Loader.getRes(p))}break;case"defines":var m=r[h];for(l=0,_=m.length;l<_;l++){var g=P.getDefineByName(m[l]);s._shaderValues.addDefine(g)}break;case"renderStates":var v=r[h];var y=v[0];var T=s;T.blend=y.blend;T.cull=y.cull;T.depthTest=y.depthTest;T.depthWrite=y.depthWrite;T.blendSrc=y.srcBlend;T.blendDst=y.dstBlend;break;case"cull":s.cull=r[h];break;case"blend":s.blend=r[h];break;case"depthWrite":s.depthWrite=r[h];break;case"srcBlend":s.blendSrc=r[h];break;case"dstBlend":s.blendDst=r[h];break;default:s[h]=r[h]}}break;default:throw new Error("BaseMaterial:unkonwn version.")}return s}get shaderData(){return this._shaderValues}get alphaTestValue(){return this._shaderValues.getNumber(s.ALPHATESTVALUE)}set alphaTestValue(t){this._shaderValues.setNumber(s.ALPHATESTVALUE,t)}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest=t;if(t)this._shaderValues.addDefine(s.SHADERDEFINE_ALPHATEST);else this._shaderValues.removeDefine(s.SHADERDEFINE_ALPHATEST)}_removeTetxureReference(){var t=this._shaderValues.getData();for(var e in t){var a=t[e];if(a&&a instanceof Et.BaseTexture)a._removeReference()}}_disposeResource(){if(this._referenceCount>0)this._removeTetxureReference();this._shaderValues=null}_addReference(t=1){super._addReference(t);var e=this._shaderValues.getData();for(var a in e){var i=e[a];if(i&&i instanceof Et.BaseTexture)i._addReference()}}_removeReference(t=1){super._removeReference(t);this._removeTetxureReference()}setShaderName(t){this._shader=P.find(t);if(!this._shader)throw new Error("BaseMaterial: unknown shader name.")}cloneTo(t){var e=t;e.name=this.name;e.renderQueue=this.renderQueue;this._shaderValues.cloneTo(e._shaderValues)}clone(){var t=new s;this.cloneTo(t);return t}get _defineDatas(){return this._shaderValues._defineDatas}}s.MATERIAL="MATERIAL";s.RENDERQUEUE_OPAQUE=2e3;s.RENDERQUEUE_ALPHATEST=2450;s.RENDERQUEUE_TRANSPARENT=3e3;s.ALPHATESTVALUE=P.propertyNameToID("u_AlphaTestValue");s.SHADERDEFINE_ALPHATEST=null;class ce{static load(t,e){Et.Laya.loader.create(t,e,null,s.MATERIAL)}static __initDefine__(){ce.SHADERDEFINE_ALPHATEST=s.SHADERDEFINE_ALPHATEST}}ce.MATERIAL="MATERIAL";ce.RENDERQUEUE_OPAQUE=2e3;ce.RENDERQUEUE_ALPHATEST=2450;ce.RENDERQUEUE_TRANSPARENT=3e3;ce.ALPHATESTVALUE=P.propertyNameToID("u_AlphaTestValue");ce.SHADERDEFINE_ALPHATEST=null;class p{constructor(){this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.srcBlend=p.BLENDPARAM_ONE;this.dstBlend=p.BLENDPARAM_ZERO;this.srcBlendRGB=p.BLENDPARAM_ONE;this.dstBlendRGB=p.BLENDPARAM_ZERO;this.srcBlendAlpha=p.BLENDPARAM_ONE;this.dstBlendAlpha=p.BLENDPARAM_ZERO;this.blendConstColor=new bt(1,1,1,1);this.blendEquation=p.BLENDEQUATION_ADD;this.blendEquationRGB=p.BLENDEQUATION_ADD;this.blendEquationAlpha=p.BLENDEQUATION_ADD;this.depthTest=p.DEPTHTEST_LEQUAL;this.depthWrite=true}cloneTo(t){var e=t;e.cull=this.cull;e.blend=this.blend;e.srcBlend=this.srcBlend;e.dstBlend=this.dstBlend;e.srcBlendRGB=this.srcBlendRGB;e.dstBlendRGB=this.dstBlendRGB;e.srcBlendAlpha=this.srcBlendAlpha;e.dstBlendAlpha=this.dstBlendAlpha;this.blendConstColor.cloneTo(e.blendConstColor);e.blendEquation=this.blendEquation;e.blendEquationRGB=this.blendEquationRGB;e.blendEquationAlpha=this.blendEquationAlpha;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite}clone(){var t=new p;this.cloneTo(t);return t}}p.CULL_NONE=0;p.CULL_FRONT=1;p.CULL_BACK=2;p.BLEND_DISABLE=0;p.BLEND_ENABLE_ALL=1;p.BLEND_ENABLE_SEPERATE=2;p.BLENDPARAM_ZERO=0;p.BLENDPARAM_ONE=1;p.BLENDPARAM_SRC_COLOR=768;p.BLENDPARAM_ONE_MINUS_SRC_COLOR=769;p.BLENDPARAM_DST_COLOR=774;p.BLENDPARAM_ONE_MINUS_DST_COLOR=775;p.BLENDPARAM_SRC_ALPHA=770;p.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771;p.BLENDPARAM_DST_ALPHA=772;p.BLENDPARAM_ONE_MINUS_DST_ALPHA=773;p.BLENDPARAM_SRC_ALPHA_SATURATE=776;p.BLENDEQUATION_ADD=32774;p.BLENDEQUATION_SUBTRACT=32778;p.BLENDEQUATION_REVERSE_SUBTRACT=32779;p.DEPTHTEST_OFF=0;p.DEPTHTEST_NEVER=512;p.DEPTHTEST_LESS=513;p.DEPTHTEST_EQUAL=514;p.DEPTHTEST_LEQUAL=515;p.DEPTHTEST_GREATER=516;p.DEPTHTEST_NOTEQUAL=517;p.DEPTHTEST_GEQUAL=518;p.DEPTHTEST_ALWAYS=519;class n extends s{constructor(){super();this._enableVertexColor=false;this.setShaderName("BLINNPHONG");this._albedoIntensity=1;this._albedoColor=new bt(1,1,1,1);var t=this._shaderValues;t.setVector(n.ALBEDOCOLOR,new bt(1,1,1,1));t.setVector(n.MATERIALSPECULAR,new bt(1,1,1,1));t.setNumber(n.SHININESS,.078125);t.setNumber(s.ALPHATESTVALUE,.5);t.setVector(n.TILINGOFFSET,new bt(1,1,0,0));this._enableLighting=true;this.renderMode=n.RENDERMODE_OPAQUE}static __initDefine__(){n.SHADERDEFINE_DIFFUSEMAP=P.getDefineByName("DIFFUSEMAP");n.SHADERDEFINE_NORMALMAP=P.getDefineByName("NORMALMAP");n.SHADERDEFINE_SPECULARMAP=P.getDefineByName("SPECULARMAP");n.SHADERDEFINE_TILINGOFFSET=P.getDefineByName("TILINGOFFSET");n.SHADERDEFINE_ENABLEVERTEXCOLOR=P.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t;this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t;this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t;this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t;this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(n.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _SpecColorR(){return this._shaderValues.getVector(n.MATERIALSPECULAR).x}set _SpecColorR(t){this._shaderValues.getVector(n.MATERIALSPECULAR).x=t}get _SpecColorG(){return this._shaderValues.getVector(n.MATERIALSPECULAR).y}set _SpecColorG(t){this._shaderValues.getVector(n.MATERIALSPECULAR).y=t}get _SpecColorB(){return this._shaderValues.getVector(n.MATERIALSPECULAR).z}set _SpecColorB(t){this._shaderValues.getVector(n.MATERIALSPECULAR).z=t}get _SpecColorA(){return this._shaderValues.getVector(n.MATERIALSPECULAR).w}set _SpecColorA(t){this._shaderValues.getVector(n.MATERIALSPECULAR).w=t}get _SpecColor(){return this._shaderValues.getVector(n.MATERIALSPECULAR)}set _SpecColor(t){this.specularColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(n.ALBEDOCOLOR);bt.scale(this._albedoColor,t,e);this._albedoIntensity=t;this._shaderValues.setVector(n.ALBEDOCOLOR,e)}}get _Shininess(){return this._shaderValues.getNumber(n.SHININESS)}set _Shininess(t){t=Math.max(0,Math.min(1,t));this._shaderValues.setNumber(n.SHININESS,t)}get _MainTex_STX(){return this._shaderValues.getVector(n.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.x=t;this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(n.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.y=t;this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(n.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.z=t;this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(n.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.w=t;this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(n.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}set renderMode(t){switch(t){case n.RENDERMODE_OPAQUE:this.alphaTest=false;this.renderQueue=s.RENDERQUEUE_OPAQUE;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;break;case n.RENDERMODE_CUTOUT:this.renderQueue=s.RENDERQUEUE_ALPHATEST;this.alphaTest=true;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;break;case n.RENDERMODE_TRANSPARENT:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_BACK;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t;if(t)this._shaderValues.addDefine(n.SHADERDEFINE_ENABLEVERTEXCOLOR);else this._shaderValues.removeDefine(n.SHADERDEFINE_ENABLEVERTEXCOLOR)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(n.TILINGOFFSET)}set tilingOffset(t){if(t){if(t.x!=1||t.y!=1||t.z!=0||t.w!=0)this._shaderValues.addDefine(n.SHADERDEFINE_TILINGOFFSET);else this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET)}else{this._shaderValues.removeDefine(n.SHADERDEFINE_TILINGOFFSET)}this._shaderValues.setVector(n.TILINGOFFSET,t)}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(n.ALBEDOCOLOR);bt.scale(t,this._albedoIntensity,e);this._albedoColor=t;this._shaderValues.setVector(n.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get specularColorR(){return this._SpecColorR}set specularColorR(t){this._SpecColorR=t}get specularColorG(){return this._SpecColorG}set specularColorG(t){this._SpecColorG=t}get specularColorB(){return this._SpecColorB}set specularColorB(t){this._SpecColorB=t}get specularColorA(){return this._SpecColorA}set specularColorA(t){this._SpecColorA=t}get specularColor(){return this._shaderValues.getVector(n.MATERIALSPECULAR)}set specularColor(t){this._shaderValues.setVector(n.MATERIALSPECULAR,t)}get shininess(){return this._Shininess}set shininess(t){this._Shininess=t}get albedoTexture(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)}set albedoTexture(t){if(t)this._shaderValues.addDefine(n.SHADERDEFINE_DIFFUSEMAP);else this._shaderValues.removeDefine(n.SHADERDEFINE_DIFFUSEMAP);this._shaderValues.setTexture(n.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(n.NORMALTEXTURE)}set normalTexture(t){if(t)this._shaderValues.addDefine(n.SHADERDEFINE_NORMALMAP);else this._shaderValues.removeDefine(n.SHADERDEFINE_NORMALMAP);this._shaderValues.setTexture(n.NORMALTEXTURE,t)}get specularTexture(){return this._shaderValues.getTexture(n.SPECULARTEXTURE)}set specularTexture(t){if(t)this._shaderValues.addDefine(n.SHADERDEFINE_SPECULARMAP);else this._shaderValues.removeDefine(n.SHADERDEFINE_SPECULARMAP);this._shaderValues.setTexture(n.SPECULARTEXTURE,t)}get depthWrite(){return this._shaderValues.getBool(n.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(n.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(n.CULL)}set cull(t){this._shaderValues.setInt(n.CULL,t)}get blend(){return this._shaderValues.getInt(n.BLEND)}set blend(t){this._shaderValues.setInt(n.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(n.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(n.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(n.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(n.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(n.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(n.DEPTH_TEST,t)}clone(){var t=new n;this.cloneTo(t);return t}cloneTo(t){super.cloneTo(t);var e=t;e._enableLighting=this._enableLighting;e._albedoIntensity=this._albedoIntensity;e._enableVertexColor=this._enableVertexColor;this._albedoColor.cloneTo(e._albedoColor)}}n.RENDERMODE_OPAQUE=0;n.RENDERMODE_CUTOUT=1;n.RENDERMODE_TRANSPARENT=2;n.ALBEDOTEXTURE=P.propertyNameToID("u_DiffuseTexture");n.NORMALTEXTURE=P.propertyNameToID("u_NormalTexture");n.SPECULARTEXTURE=P.propertyNameToID("u_SpecularTexture");n.ALBEDOCOLOR=P.propertyNameToID("u_DiffuseColor");n.MATERIALSPECULAR=P.propertyNameToID("u_MaterialSpecular");n.SHININESS=P.propertyNameToID("u_Shininess");n.TILINGOFFSET=P.propertyNameToID("u_TilingOffset");n.CULL=P.propertyNameToID("s_Cull");n.BLEND=P.propertyNameToID("s_Blend");n.BLEND_SRC=P.propertyNameToID("s_BlendSrc");n.BLEND_DST=P.propertyNameToID("s_BlendDst");n.DEPTH_TEST=P.propertyNameToID("s_DepthTest");n.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");class l extends s{constructor(){super();this.setShaderName("Effect");this._color=new bt(1,1,1,1);this._shaderValues.setVector(l.TINTCOLOR,new bt(1,1,1,1));this.renderMode=l.RENDERMODE_ADDTIVE}static __initDefine__(){l.SHADERDEFINE_MAINTEXTURE=P.getDefineByName("MAINTEXTURE");l.SHADERDEFINE_TILINGOFFSET=P.getDefineByName("TILINGOFFSET");l.SHADERDEFINE_ADDTIVEFOG=P.getDefineByName("ADDTIVEFOG")}get _TintColorR(){return this._color.x}set _TintColorR(t){this._color.x=t;this.color=this._color}get _TintColorG(){return this._color.y}set _TintColorG(t){this._color.y=t;this.color=this._color}get _TintColorB(){return this._color.z}set _TintColorB(t){this._color.z=t;this.color=this._color}get _TintColorA(){return this._color.w}set _TintColorA(t){this._color.w=t;this.color=this._color}get _TintColor(){return this._shaderValues.getVector(l.TINTCOLOR)}set _TintColor(t){this.color=t}get _MainTex_STX(){return this._shaderValues.getVector(l.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(l.TILINGOFFSET);e.x=t;this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(l.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(l.TILINGOFFSET);e.y=t;this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(l.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(l.TILINGOFFSET);e.z=t;this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(l.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(l.TILINGOFFSET);e.w=t;this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(l.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}set renderMode(t){switch(t){case l.RENDERMODE_ADDTIVE:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_NONE;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.addDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case l.RENDERMODE_ALPHABLENDED:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_NONE;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.removeDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("MeshEffectMaterial : renderMode value error.")}}get colorR(){return this._TintColorR}set colorR(t){this._TintColorR=t}get colorG(){return this._TintColorG}set colorG(t){this._TintColorG=t}get colorB(){return this._TintColorB}set colorB(t){this._TintColorB=t}get colorA(){return this._TintColorA}set colorA(t){this._TintColorA=t}get color(){return this._shaderValues.getVector(l.TINTCOLOR)}set color(t){this._shaderValues.setVector(l.TINTCOLOR,t)}get texture(){return this._shaderValues.getTexture(l.MAINTEXTURE)}set texture(t){if(t)this._shaderValues.addDefine(l.SHADERDEFINE_MAINTEXTURE);else this._shaderValues.removeDefine(l.SHADERDEFINE_MAINTEXTURE);this._shaderValues.setTexture(l.MAINTEXTURE,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(l.TILINGOFFSET)}set tilingOffset(t){if(t){if(t.x!=1||t.y!=1||t.z!=0||t.w!=0)this._shaderValues.addDefine(l.SHADERDEFINE_TILINGOFFSET);else this._shaderValues.removeDefine(l.SHADERDEFINE_TILINGOFFSET)}else{this._shaderValues.removeDefine(l.SHADERDEFINE_TILINGOFFSET)}this._shaderValues.setVector(l.TILINGOFFSET,t)}get depthWrite(){return this._shaderValues.getBool(l.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(l.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(l.CULL)}set cull(t){this._shaderValues.setInt(l.CULL,t)}get blend(){return this._shaderValues.getInt(l.BLEND)}set blend(t){this._shaderValues.setInt(l.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(l.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(l.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(l.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(l.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(l.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(l.DEPTH_TEST,t)}clone(){var t=new l;this.cloneTo(t);return t}}l.RENDERMODE_ADDTIVE=0;l.RENDERMODE_ALPHABLENDED=1;l.MAINTEXTURE=P.propertyNameToID("u_AlbedoTexture");l.TINTCOLOR=P.propertyNameToID("u_AlbedoColor");l.TILINGOFFSET=P.propertyNameToID("u_TilingOffset");l.CULL=P.propertyNameToID("s_Cull");l.BLEND=P.propertyNameToID("s_Blend");l.BLEND_SRC=P.propertyNameToID("s_BlendSrc");l.BLEND_DST=P.propertyNameToID("s_BlendDst");l.DEPTH_TEST=P.propertyNameToID("s_DepthTest");l.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");class x extends s{constructor(){super();this._enableLighting=true;this.setShaderName("ExtendTerrain");this.renderMode=x.RENDERMODE_OPAQUE}static __initDefine__(){x.SHADERDEFINE_DETAIL_NUM1=P.getDefineByName("ExtendTerrain_DETAIL_NUM1");x.SHADERDEFINE_DETAIL_NUM2=P.getDefineByName("ExtendTerrain_DETAIL_NUM2");x.SHADERDEFINE_DETAIL_NUM3=P.getDefineByName("ExtendTerrain_DETAIL_NUM3");x.SHADERDEFINE_DETAIL_NUM4=P.getDefineByName("ExtendTerrain_DETAIL_NUM4");x.SHADERDEFINE_DETAIL_NUM5=P.getDefineByName("ExtendTerrain_DETAIL_NUM5")}get splatAlphaTexture(){return this._shaderValues.getTexture(x.SPLATALPHATEXTURE)}set splatAlphaTexture(t){this._shaderValues.setTexture(x.SPLATALPHATEXTURE,t)}get diffuseTexture1(){return this._shaderValues.getTexture(x.DIFFUSETEXTURE1)}set diffuseTexture1(t){this._shaderValues.setTexture(x.DIFFUSETEXTURE1,t);this._setDetailNum(1)}get diffuseTexture2(){return this._shaderValues.getTexture(x.DIFFUSETEXTURE2)}set diffuseTexture2(t){this._shaderValues.setTexture(x.DIFFUSETEXTURE2,t);this._setDetailNum(2)}get diffuseTexture3(){return this._shaderValues.getTexture(x.DIFFUSETEXTURE3)}set diffuseTexture3(t){this._shaderValues.setTexture(x.DIFFUSETEXTURE3,t);this._setDetailNum(3)}get diffuseTexture4(){return this._shaderValues.getTexture(x.DIFFUSETEXTURE4)}set diffuseTexture4(t){this._shaderValues.setTexture(x.DIFFUSETEXTURE4,t);this._setDetailNum(4)}get diffuseTexture5(){return this._shaderValues.getTexture(x.DIFFUSETEXTURE5)}set diffuseTexture5(t){this._shaderValues.setTexture(x.DIFFUSETEXTURE5,t);this._setDetailNum(5)}set diffuseScaleOffset1(t){this._shaderValues.setVector(x.DIFFUSESCALEOFFSET1,t)}set diffuseScaleOffset2(t){this._shaderValues.setVector(x.DIFFUSESCALEOFFSET2,t)}set diffuseScaleOffset3(t){this._shaderValues.setVector(x.DIFFUSESCALEOFFSET3,t)}set diffuseScaleOffset4(t){this._shaderValues.setVector(x.DIFFUSESCALEOFFSET4,t)}set diffuseScaleOffset5(t){this._shaderValues.setVector(x.DIFFUSESCALEOFFSET5,t)}set renderMode(t){switch(t){case x.RENDERMODE_OPAQUE:this.renderQueue=s.RENDERQUEUE_OPAQUE;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;break;case x.RENDERMODE_TRANSPARENT:this.renderQueue=s.RENDERQUEUE_OPAQUE;this.depthWrite=false;this.cull=p.CULL_BACK;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LEQUAL;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}}get depthWrite(){return this._shaderValues.getBool(x.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(x.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(x.CULL)}set cull(t){this._shaderValues.setInt(x.CULL,t)}get blend(){return this._shaderValues.getInt(x.BLEND)}set blend(t){this._shaderValues.setInt(x.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(x.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(x.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(x.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(x.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(x.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(x.DEPTH_TEST,t)}_setDetailNum(t){switch(t){case 1:this._shaderValues.addDefine(x.SHADERDEFINE_DETAIL_NUM1);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM2);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM3);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM4);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._shaderValues.addDefine(x.SHADERDEFINE_DETAIL_NUM2);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM1);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM3);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM4);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._shaderValues.addDefine(x.SHADERDEFINE_DETAIL_NUM3);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM1);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM2);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM4);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._shaderValues.addDefine(x.SHADERDEFINE_DETAIL_NUM4);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM1);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM2);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM3);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._shaderValues.addDefine(x.SHADERDEFINE_DETAIL_NUM5);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM1);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM2);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM3);this._shaderValues.removeDefine(x.SHADERDEFINE_DETAIL_NUM4);break}}clone(){var t=new x;this.cloneTo(t);return t}}x.RENDERMODE_OPAQUE=1;x.RENDERMODE_TRANSPARENT=2;x.SPLATALPHATEXTURE=P.propertyNameToID("u_SplatAlphaTexture");x.DIFFUSETEXTURE1=P.propertyNameToID("u_DiffuseTexture1");x.DIFFUSETEXTURE2=P.propertyNameToID("u_DiffuseTexture2");x.DIFFUSETEXTURE3=P.propertyNameToID("u_DiffuseTexture3");x.DIFFUSETEXTURE4=P.propertyNameToID("u_DiffuseTexture4");x.DIFFUSETEXTURE5=P.propertyNameToID("u_DiffuseTexture5");x.DIFFUSESCALEOFFSET1=P.propertyNameToID("u_DiffuseScaleOffset1");x.DIFFUSESCALEOFFSET2=P.propertyNameToID("u_DiffuseScaleOffset2");x.DIFFUSESCALEOFFSET3=P.propertyNameToID("u_DiffuseScaleOffset3");x.DIFFUSESCALEOFFSET4=P.propertyNameToID("u_DiffuseScaleOffset4");x.DIFFUSESCALEOFFSET5=P.propertyNameToID("u_DiffuseScaleOffset5");x.CULL=P.propertyNameToID("s_Cull");x.BLEND=P.propertyNameToID("s_Blend");x.BLEND_SRC=P.propertyNameToID("s_BlendSrc");x.BLEND_DST=P.propertyNameToID("s_BlendDst");x.DEPTH_TEST=P.propertyNameToID("s_DepthTest");x.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");(function(t){t[t["Opaque"]=0]="Opaque";t[t["Cutout"]=1]="Cutout";t[t["Fade"]=2]="Fade";t[t["Transparent"]=3]="Transparent"})(H.PBRRenderMode||(H.PBRRenderMode={}));class c extends s{constructor(){super();this._enableEmission=false;this._shaderValues.setVector(c.ALBEDOCOLOR,new bt(1,1,1,1));this._shaderValues.setVector(c.EMISSIONCOLOR,new bt(1,1,1,1));this._shaderValues.setNumber(c.SMOOTHNESS,.5);this._shaderValues.setNumber(c.SMOOTHNESSSCALE,1);this._shaderValues.setNumber(c.OCCLUSIONSTRENGTH,1);this._shaderValues.setNumber(c.NORMALSCALE,1);this._shaderValues.setNumber(c.PARALLAXSCALE,.001);this._shaderValues.setNumber(s.ALPHATESTVALUE,.5);this.renderMode=H.PBRRenderMode.Opaque}static __init__(){c.SHADERDEFINE_ALBEDOTEXTURE=P.getDefineByName("ALBEDOTEXTURE");c.SHADERDEFINE_NORMALTEXTURE=P.getDefineByName("NORMALTEXTURE");c.SHADERDEFINE_PARALLAXTEXTURE=P.getDefineByName("PARALLAXTEXTURE");c.SHADERDEFINE_OCCLUSIONTEXTURE=P.getDefineByName("OCCLUSIONTEXTURE");c.SHADERDEFINE_EMISSION=P.getDefineByName("EMISSION");c.SHADERDEFINE_EMISSIONTEXTURE=P.getDefineByName("EMISSIONTEXTURE");c.SHADERDEFINE_TILINGOFFSET=P.getDefineByName("TILINGOFFSET");c.SHADERDEFINE_TRANSPARENTBLEND=P.getDefineByName("TRANSPARENTBLEND");c.SHADERDEFINE_LAYA_PBR_BRDF_HIGH=P.getDefineByName("LAYA_PBR_BRDF_HIGH");c.SHADERDEFINE_LAYA_PBR_BRDF_LOW=P.getDefineByName("LAYA_PBR_BRDF_LOW")}get albedoColor(){return this._shaderValues.getVector(c.ALBEDOCOLOR)}set albedoColor(t){this._shaderValues.setVector(c.ALBEDOCOLOR,t)}get albedoTexture(){return this._shaderValues.getTexture(c.ALBEDOTEXTURE)}set albedoTexture(t){if(t)this._shaderValues.addDefine(c.SHADERDEFINE_ALBEDOTEXTURE);else this._shaderValues.removeDefine(c.SHADERDEFINE_ALBEDOTEXTURE);this._shaderValues.setTexture(c.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(c.NORMALTEXTURE)}set normalTexture(t){if(t){this._shaderValues.addDefine(c.SHADERDEFINE_NORMALTEXTURE)}else{this._shaderValues.removeDefine(c.SHADERDEFINE_NORMALTEXTURE)}this._shaderValues.setTexture(c.NORMALTEXTURE,t)}get normalTextureScale(){return this._shaderValues.getNumber(c.NORMALSCALE)}set normalTextureScale(t){this._shaderValues.setNumber(c.NORMALSCALE,t)}get parallaxTexture(){return this._shaderValues.getTexture(c.PARALLAXTEXTURE)}set parallaxTexture(t){if(t)this._shaderValues.addDefine(c.SHADERDEFINE_PARALLAXTEXTURE);else this._shaderValues.removeDefine(c.SHADERDEFINE_PARALLAXTEXTURE);this._shaderValues.setTexture(c.PARALLAXTEXTURE,t)}get parallaxTextureScale(){return this._shaderValues.getNumber(c.PARALLAXSCALE)}set parallaxTextureScale(t){this._shaderValues.setNumber(c.PARALLAXSCALE,Math.max(.005,Math.min(.08,t)))}get occlusionTexture(){return this._shaderValues.getTexture(c.OCCLUSIONTEXTURE)}set occlusionTexture(t){if(t)this._shaderValues.addDefine(c.SHADERDEFINE_OCCLUSIONTEXTURE);else this._shaderValues.removeDefine(c.SHADERDEFINE_OCCLUSIONTEXTURE);this._shaderValues.setTexture(c.OCCLUSIONTEXTURE,t)}get occlusionTextureStrength(){return this._shaderValues.getNumber(c.OCCLUSIONSTRENGTH)}set occlusionTextureStrength(t){this._shaderValues.setNumber(c.OCCLUSIONSTRENGTH,Math.max(0,Math.min(1,t)))}get smoothness(){return this._shaderValues.getNumber(c.SMOOTHNESS)}set smoothness(t){this._shaderValues.setNumber(c.SMOOTHNESS,Math.max(0,Math.min(1,t)))}get smoothnessTextureScale(){return this._shaderValues.getNumber(c.SMOOTHNESSSCALE)}set smoothnessTextureScale(t){this._shaderValues.setNumber(c.SMOOTHNESSSCALE,Math.max(0,Math.min(1,t)))}get enableEmission(){return this._enableEmission}set enableEmission(t){if(t)this._shaderValues.addDefine(c.SHADERDEFINE_EMISSION);else this._shaderValues.removeDefine(c.SHADERDEFINE_EMISSION);this._enableEmission=t}get emissionColor(){return this._shaderValues.getVector(c.EMISSIONCOLOR)}set emissionColor(t){this._shaderValues.setVector(c.EMISSIONCOLOR,t)}get emissionTexture(){return this._shaderValues.getTexture(c.EMISSIONTEXTURE)}set emissionTexture(t){if(t)this._shaderValues.addDefine(c.SHADERDEFINE_EMISSIONTEXTURE);else this._shaderValues.removeDefine(c.SHADERDEFINE_EMISSIONTEXTURE);this._shaderValues.setTexture(c.EMISSIONTEXTURE,t)}get tilingOffset(){return this._shaderValues.getVector(c.TILINGOFFSET)}set tilingOffset(t){if(t){if(t.x!=1||t.y!=1||t.z!=0||t.w!=0)this._shaderValues.addDefine(c.SHADERDEFINE_TILINGOFFSET);else this._shaderValues.removeDefine(c.SHADERDEFINE_TILINGOFFSET)}else{this._shaderValues.removeDefine(c.SHADERDEFINE_TILINGOFFSET)}this._shaderValues.setVector(c.TILINGOFFSET,t)}get depthWrite(){return this._shaderValues.getBool(c.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(c.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(c.CULL)}set cull(t){this._shaderValues.setInt(c.CULL,t)}get blend(){return this._shaderValues.getInt(c.BLEND)}set blend(t){this._shaderValues.setInt(c.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(c.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(c.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(c.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(c.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(c.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(c.DEPTH_TEST,t)}set renderMode(t){switch(t){case H.PBRRenderMode.Opaque:this.alphaTest=false;this.renderQueue=s.RENDERQUEUE_OPAQUE;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.removeDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;case H.PBRRenderMode.Cutout:this.renderQueue=s.RENDERQUEUE_ALPHATEST;this.alphaTest=true;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.removeDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;case H.PBRRenderMode.Fade:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_BACK;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.removeDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;case H.PBRRenderMode.Transparent:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_BACK;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_ONE;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.addDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;default:throw new Error("PBRMaterial:unknown renderMode value.")}}get enableReflection(){return true}set enableReflection(t){}}c.ALBEDOTEXTURE=P.propertyNameToID("u_AlbedoTexture");c.ALBEDOCOLOR=P.propertyNameToID("u_AlbedoColor");c.TILINGOFFSET=P.propertyNameToID("u_TilingOffset");c.NORMALTEXTURE=P.propertyNameToID("u_NormalTexture");c.NORMALSCALE=P.propertyNameToID("u_NormalScale");c.SMOOTHNESS=P.propertyNameToID("u_Smoothness");c.SMOOTHNESSSCALE=P.propertyNameToID("u_SmoothnessScale");c.OCCLUSIONTEXTURE=P.propertyNameToID("u_OcclusionTexture");c.OCCLUSIONSTRENGTH=P.propertyNameToID("u_occlusionStrength");c.PARALLAXTEXTURE=P.propertyNameToID("u_ParallaxTexture");c.PARALLAXSCALE=P.propertyNameToID("u_ParallaxScale");c.EMISSIONTEXTURE=P.propertyNameToID("u_EmissionTexture");c.EMISSIONCOLOR=P.propertyNameToID("u_EmissionColor");c.CULL=P.propertyNameToID("s_Cull");c.BLEND=P.propertyNameToID("s_Blend");c.BLEND_SRC=P.propertyNameToID("s_BlendSrc");c.BLEND_DST=P.propertyNameToID("s_BlendDst");c.DEPTH_TEST=P.propertyNameToID("s_DepthTest");c.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");c.renderQuality=H.PBRRenderQuality.High;var de='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#define SETUP_BRDF_INPUT specularSetup\r\n\r\n#include "Lighting.glsl";\r\n#include "PBRFSInput.glsl";\r\n#include "LayaPBRBRDF.glsl";\r\n#include "GlobalIllumination.glsl";\r\n#include "Shadow.glsl"\r\n#include "PBRCore.glsl";\r\n\r\nvoid main()\r\n{\r\n\tfragmentForward();\r\n}';var ue='#include "PBRVSInput.glsl";\r\n#include "Lighting.glsl";\r\n#include "PBRVertex.glsl";\r\n\r\nvoid main()\r\n{\r\n\tvertexForward();\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var fe='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "ShadowCasterFS.glsl"\r\n\r\nvoid main()\r\n{\r\n\tgl_FragColor=shadowCasterFragment();\r\n}';var pe='#include "ShadowCasterVS.glsl"\r\n\r\nvoid main()\r\n{\r\n\tvec4 positionCS =  shadowCasterVertex();\r\n\tgl_Position=remapGLPositionZ(positionCS);\r\n}';class me{constructor(){this.textureID=-1}}class ge extends Et.Resource{constructor(t,e,a,i,r){super();this._stateParamsMap=[];this._uploadMark=-1;this._uploadRenderType=-1;this._vs=t;this._ps=e;this._attributeMap=a;this._uniformMap=i;this._shaderPass=r;this._globaluniformMap=[];this._create();this.lock=true}_create(){var t=Et.LayaGL.instance;this._program=t.createProgram();this._vshader=this._createShader(t,this._vs,t.VERTEX_SHADER);this._pshader=this._createShader(t,this._ps,t.FRAGMENT_SHADER);t.attachShader(this._program,this._vshader);t.attachShader(this._program,this._pshader);for(var e in this._attributeMap)t.bindAttribLocation(this._program,this._attributeMap[e],e);t.linkProgram(this._program);if(!Et.Render.isConchApp&&P.debugMode&&!t.getProgramParameter(this._program,t.LINK_STATUS))throw t.getProgramInfoLog(this._program);var a=[];var i=[];var r=[];var s=[];var n=[];this._customUniformParamsMap=[];var o=t.getProgramParameter(this._program,t.ACTIVE_UNIFORMS);Et.WebGLContext.useProgram(t,this._program);this._curActTexIndex=0;var l,_,h;for(_=0;_<o;_++){var x=t.getActiveUniform(this._program,_);var c=x.name;l=new me;l.location=t.getUniformLocation(this._program,c);if(c.indexOf("[0]")>0){l.name=c=c.substr(0,c.length-3);l.isArray=true}else{l.name=c;l.isArray=false}l.type=x.type;this._addShaderUnifiormFun(l);var d=this._uniformMap[c];if(d!=null){l.dataOffset=P.propertyNameToID(c);switch(d){case P.PERIOD_CUSTOM:n.push(l);break;case P.PERIOD_MATERIAL:s.push(l);break;case P.PERIOD_SPRITE:r.push(l);break;case P.PERIOD_CAMERA:i.push(l);break;case P.PERIOD_SCENE:a.push(l);break;default:throw new Error("Shader3D: period is unkonw.")}}else{l.dataOffset=P.propertyNameToID(c);this._globaluniformMap[c]=P.PERIOD_SCENE;a.push(l)}}this._sceneUniformParamsMap=Et.LayaGL.instance.createCommandEncoder(a.length*4*5+4,64,true);for(_=0,h=a.length;_<h;_++)this._sceneUniformParamsMap.addShaderUniform(a[_]);this._cameraUniformParamsMap=Et.LayaGL.instance.createCommandEncoder(i.length*4*5+4,64,true);for(_=0,h=i.length;_<h;_++)this._cameraUniformParamsMap.addShaderUniform(i[_]);this._spriteUniformParamsMap=Et.LayaGL.instance.createCommandEncoder(r.length*4*5+4,64,true);for(_=0,h=r.length;_<h;_++)this._spriteUniformParamsMap.addShaderUniform(r[_]);this._materialUniformParamsMap=Et.LayaGL.instance.createCommandEncoder(s.length*4*5+4,64,true);for(_=0,h=s.length;_<h;_++)this._materialUniformParamsMap.addShaderUniform(s[_]);this._customUniformParamsMap.length=n.length;for(_=0,h=n.length;_<h;_++){var u=n[_];this._customUniformParamsMap[u.dataOffset]=u}var f=this._shaderPass._stateMap;for(var p in f)this._stateParamsMap[f[p]]=P.propertyNameToID(p)}_getRenderState(t,e){var a=this._stateParamsMap[e];if(a==null)return null;else return t[a]}_disposeResource(){Et.LayaGL.instance.deleteShader(this._vshader);Et.LayaGL.instance.deleteShader(this._pshader);Et.LayaGL.instance.deleteProgram(this._program);this._vshader=this._pshader=this._program=null;this._setGPUMemory(0);this._curActTexIndex=0}_addShaderUnifiormFun(t){var e=Et.LayaGL.instance;t.caller=this;var a=t.isArray;switch(t.type){case e.BOOL:t.fun=this._uniform1i;t.uploadedValue=new Array(1);break;case e.INT:t.fun=a?this._uniform1iv:this._uniform1i;t.uploadedValue=new Array(1);break;case e.FLOAT:t.fun=a?this._uniform1fv:this._uniform1f;t.uploadedValue=new Array(1);break;case e.FLOAT_VEC2:t.fun=a?this._uniform_vec2v:this._uniform_vec2;t.uploadedValue=new Array(2);break;case e.FLOAT_VEC3:t.fun=a?this._uniform_vec3v:this._uniform_vec3;t.uploadedValue=new Array(3);break;case e.FLOAT_VEC4:t.fun=a?this._uniform_vec4v:this._uniform_vec4;t.uploadedValue=new Array(4);break;case e.FLOAT_MAT2:t.fun=this._uniformMatrix2fv;break;case e.FLOAT_MAT3:t.fun=this._uniformMatrix3fv;break;case e.FLOAT_MAT4:t.fun=a?this._uniformMatrix4fv:this._uniformMatrix4f;break;case e.SAMPLER_2D:case e.SAMPLER_2D_SHADOW:e.uniform1i(t.location,this._curActTexIndex);t.textureID=Et.WebGLContext._glTextureIDs[this._curActTexIndex++];t.fun=this._uniform_sampler2D;break;case 35679:e.uniform1i(t.location,this._curActTexIndex);t.textureID=Et.WebGLContext._glTextureIDs[this._curActTexIndex++];t.fun=this._uniform_sampler3D;break;case e.SAMPLER_CUBE:e.uniform1i(t.location,this._curActTexIndex);t.textureID=Et.WebGLContext._glTextureIDs[this._curActTexIndex++];t.fun=this._uniform_samplerCube;break;default:throw new Error("compile shader err!");break}}_createShader(t,e,a){var i=t.createShader(a);t.shaderSource(i,e);t.compileShader(i);if(P.debugMode&&!t.getShaderParameter(i,t.COMPILE_STATUS))throw t.getShaderInfoLog(i);return i}_uniform1f(t,e){var a=t.uploadedValue;if(a[0]!==e){Et.LayaGL.instance.uniform1f(t.location,a[0]=e);return 1}return 0}_uniform1fv(t,e){if(e.length<4){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){Et.LayaGL.instance.uniform1fv(t.location,e);a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[3];return 1}return 0}else{Et.LayaGL.instance.uniform1fv(t.location,e);return 1}}_uniform_vec2(t,e){var a=t.uploadedValue;if(a[0]!==e.x||a[1]!==e.y){Et.LayaGL.instance.uniform2f(t.location,a[0]=e.x,a[1]=e.y);return 1}return 0}_uniform_vec2v(t,e){if(e.length<2){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){Et.LayaGL.instance.uniform2fv(t.location,e);a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[3];return 1}return 0}else{Et.LayaGL.instance.uniform2fv(t.location,e);return 1}}_uniform_vec3(t,e){var a=t.uploadedValue;if(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z){Et.LayaGL.instance.uniform3f(t.location,a[0]=e.x,a[1]=e.y,a[2]=e.z);return 1}return 0}_uniform_vec3v(t,e){Et.LayaGL.instance.uniform3fv(t.location,e);return 1}_uniform_vec4(t,e){var a=t.uploadedValue;if(a[0]!==e.x||a[1]!==e.y||a[2]!==e.z||a[3]!==e.w){Et.LayaGL.instance.uniform4f(t.location,a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=e.w);return 1}return 0}_uniform_vec4v(t,e){Et.LayaGL.instance.uniform4fv(t.location,e);return 1}_uniformMatrix2fv(t,e){Et.LayaGL.instance.uniformMatrix2fv(t.location,false,e);return 1}_uniformMatrix3fv(t,e){Et.LayaGL.instance.uniformMatrix3fv(t.location,false,e);return 1}_uniformMatrix4f(t,e){var a=e.elements;Et.LayaGL.instance.uniformMatrix4fv(t.location,false,a);return 1}_uniformMatrix4fv(t,e){Et.LayaGL.instance.uniformMatrix4fv(t.location,false,e);return 1}_uniform1i(t,e){var a=t.uploadedValue;if(a[0]!==e){Et.LayaGL.instance.uniform1i(t.location,a[0]=e);return 1}return 0}_uniform1iv(t,e){Et.LayaGL.instance.uniform1iv(t.location,e);return 1}_uniform_ivec2(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]){Et.LayaGL.instance.uniform2i(t.location,a[0]=e[0],a[1]=e[1]);return 1}return 0}_uniform_ivec2v(t,e){Et.LayaGL.instance.uniform2iv(t.location,e);return 1}_uniform_vec3i(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]){Et.LayaGL.instance.uniform3i(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2]);return 1}return 0}_uniform_vec3vi(t,e){Et.LayaGL.instance.uniform3iv(t.location,e);return 1}_uniform_vec4i(t,e){var a=t.uploadedValue;if(a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]){Et.LayaGL.instance.uniform4i(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3]);return 1}return 0}_uniform_vec4vi(t,e){Et.LayaGL.instance.uniform4iv(t.location,e);return 1}_uniform_sampler2D(t,e){var a=e._getSource()||e.defaulteTexture._getSource();var i=Et.LayaGL.instance;Et.WebGLContext.activeTexture(i,t.textureID);Et.WebGLContext.bindTexture(i,i.TEXTURE_2D,a);return 0}_uniform_sampler3D(t,e){var a=e._getSource()||e.defaulteTexture._getSource();var i=Et.LayaGL.instance;Et.WebGLContext.activeTexture(i,t.textureID);Et.WebGLContext.bindTexture(i,WebGL2RenderingContext.TEXTURE_3D,a);return 0}_uniform_samplerCube(t,e){var a=e._getSource()||e.defaulteTexture._getSource();var i=Et.LayaGL.instance;Et.WebGLContext.activeTexture(i,t.textureID);Et.WebGLContext.bindTexture(i,i.TEXTURE_CUBE_MAP,a);return 0}bind(){return Et.WebGLContext.useProgram(Et.LayaGL.instance,this._program)}uploadUniforms(t,e,a){Et.Stat.shaderCall+=Et.LayaGLRunner.uploadShaderUniforms(Et.LayaGL.instance,t,e,a)}uploadRenderStateBlendDepth(t){var e=Et.LayaGL.instance;var a=this._shaderPass.renderState;var i=t.getData();var r=this._getRenderState(i,P.RENDER_STATE_DEPTH_WRITE);var s=this._getRenderState(i,P.RENDER_STATE_DEPTH_TEST);var n=this._getRenderState(i,P.RENDER_STATE_BLEND);r==null&&(r=a.depthWrite);s==null&&(s=a.depthTest);n==null&&(n=a.blend);Et.WebGLContext.setDepthMask(e,r);if(s===p.DEPTHTEST_OFF)Et.WebGLContext.setDepthTest(e,false);else{Et.WebGLContext.setDepthTest(e,true);Et.WebGLContext.setDepthFunc(e,s)}switch(n){case p.BLEND_DISABLE:Et.WebGLContext.setBlend(e,false);break;case p.BLEND_ENABLE_ALL:var o=this._getRenderState(i,P.RENDER_STATE_BLEND_EQUATION);var l=this._getRenderState(i,P.RENDER_STATE_BLEND_SRC);var _=this._getRenderState(i,P.RENDER_STATE_BLEND_DST);o==null&&(o=a.blendEquation);l==null&&(l=a.srcBlend);_==null&&(_=a.dstBlend);Et.WebGLContext.setBlend(e,true);Et.WebGLContext.setBlendEquation(e,o);Et.WebGLContext.setBlendFunc(e,l,_);break;case p.BLEND_ENABLE_SEPERATE:var h=this._getRenderState(i,P.RENDER_STATE_BLEND_EQUATION_RGB);var x=this._getRenderState(i,P.RENDER_STATE_BLEND_EQUATION_ALPHA);var c=this._getRenderState(i,P.RENDER_STATE_BLEND_SRC_RGB);var d=this._getRenderState(i,P.RENDER_STATE_BLEND_DST_RGB);var u=this._getRenderState(i,P.RENDER_STATE_BLEND_SRC_ALPHA);var f=this._getRenderState(i,P.RENDER_STATE_BLEND_DST_ALPHA);h==null&&(h=a.blendEquationRGB);x==null&&(x=a.blendEquationAlpha);c==null&&(c=a.srcBlendRGB);d==null&&(d=a.dstBlendRGB);u==null&&(u=a.srcBlendAlpha);f==null&&(f=a.dstBlendAlpha);Et.WebGLContext.setBlend(e,true);Et.WebGLContext.setBlendEquationSeparate(e,h,x);Et.WebGLContext.setBlendFuncSeperate(e,c,d,u,f);break}}uploadRenderStateFrontFace(t,e,a){var i=Et.LayaGL.instance;var r=this._shaderPass.renderState;var s=t.getData();var n=this._getRenderState(s,P.RENDER_STATE_CULL);n==null&&(n=r.cull);var o;switch(n){case p.CULL_NONE:Et.WebGLContext.setCullFace(i,false);break;case p.CULL_FRONT:Et.WebGLContext.setCullFace(i,true);if(e){if(a)o=i.CCW;else o=i.CW}else{if(a)o=i.CW;else o=i.CCW}Et.WebGLContext.setFrontFace(i,o);break;case p.CULL_BACK:Et.WebGLContext.setCullFace(i,true);if(e){if(a)o=i.CW;else o=i.CCW}else{if(a)o=i.CCW;else o=i.CW}Et.WebGLContext.setFrontFace(i,o);break}}uploadCustomUniform(t,e){Et.Stat.shaderCall+=Et.LayaGLRunner.uploadCustomUniform(Et.LayaGL.instance,this._customUniformParamsMap,t,e)}_uniformMatrix2fvForNative(t,e){Et.LayaGL.instance.uniformMatrix2fvEx(t.location,false,e);return 1}_uniformMatrix3fvForNative(t,e){Et.LayaGL.instance.uniformMatrix3fvEx(t.location,false,e);return 1}_uniformMatrix4fvForNative(t,e){Et.LayaGL.instance.uniformMatrix4fvEx(t.location,false,e);return 1}}class ve extends e{constructor(){super()}add(t){var e=t._getIndexInList();if(e!==-1)throw"SimpleSingletonList:"+t+" has  in  SingletonList.";this._add(t);t._setIndexInList(this.length++)}remove(t){var e=t._getIndexInList();this.length--;if(e!==this.length){var a=this.elements[this.length];this.elements[e]=a;a._setIndexInList(e)}t._setIndexInList(-1)}clear(){var t=this.elements;for(var e=0,a=this.length;e<a;e++)t[e]._setIndexInList(-1);this.length=0}}class ye{constructor(t=1,e=1,a=1,i=1){this.r=t;this.g=e;this.b=a;this.a=i}static gammaToLinearSpace(t){if(t<=.04045)return t/12.92;else if(t<1)return Math.pow((t+.055)/1.055,2.4);else return Math.pow(t,2.4)}static linearToGammaSpace(t){if(t<=0)return 0;else if(t<=.0031308)return 12.92*t;else if(t<=1)return 1.055*Math.pow(t,.41666)-.055;else return Math.pow(t,.41666)}toLinear(t){t.r=ye.gammaToLinearSpace(this.r);t.g=ye.gammaToLinearSpace(this.g);t.b=ye.gammaToLinearSpace(this.b)}toGamma(t){t.r=ye.linearToGammaSpace(this.r);t.g=ye.linearToGammaSpace(this.g);t.b=ye.linearToGammaSpace(this.b)}cloneTo(t){var e=t;e.r=this.r;e.g=this.g;e.b=this.b;e.a=this.a}clone(){var t=new ye;this.cloneTo(t);return t}forNativeElement(){}}ye.RED=new ye(1,0,0,1);ye.GREEN=new ye(0,1,0,1);ye.BLUE=new ye(0,0,1,1);ye.CYAN=new ye(0,1,1,1);ye.YELLOW=new ye(1,.92,.016,1);ye.MAGENTA=new ye(1,0,1,1);ye.GRAY=new ye(.5,.5,.5,1);ye.WHITE=new ye(1,1,1,1);ye.BLACK=new ye(0,0,0,1);class Te{}class Ee{}class be{static __init__(){}static _drawTraversalCullingBound(t,e){var a=t.elements;for(var i=0,r=t.length;i<r;i++){var s=be._tempColor0;s.r=0;s.g=1;s.b=0;s.a=1;F._drawBound(e,a[i].bounds._getBoundBox(),s)}}static _traversalCulling(t,e,a,i,r,s,n){var o=i.elements;var l=t.boundFrustum;var _=t.position;var h=t.cullingMask;var x=Et.Stat.loopCount;for(var c=0,d=i.length;c<d;c++){var u=o[c];var f;if(n)f=u._castShadow&&u._enable;else f=(Math.pow(2,u._owner._layer)&h)!=0&&u._enable;if(f){Et.Stat.frustumCulling++;if(!t.useOcclusionCulling||u._needRender(l,a)){u._renderMark=x;u._distanceForSort=St.distance(u.bounds.getCenter(),_);var p=u._renderElements;for(var m=0,g=p.length;m<g;m++)p[m]._update(e,a,r,s)}}}}static renderObjectCulling(t,e,a,i,r,s){var n=e._opaqueQueue;var o=e._transparentQueue;var l=e._renders;e._clearRenderQueue();var _=e._octree;if(_){_.updateMotionObjects();_.shrinkRootIfPossible();_.getCollidingWithFrustum(t,a,i,r,s)}be._traversalCulling(t,e,a,l,i,r,s);if(be.debugFrustumCulling){var h=e._debugTool;h.clear();if(_){_.drawAllBounds(h);_.drawAllObjects(h)}be._drawTraversalCullingBound(l,h)}var x=n.elements.length;x>0&&n._quickSort(0,x-1);x=o.elements.length;x>0&&o._quickSort(0,x-1)}static cullingShadow(t,e,a){var i=e._renders;e._clearRenderQueue();var r=e._opaqueQueue;var s=t.position;var n=t.cullPlaneCount;var o=t.cullPlanes;var l=t.cullSphere;var _=t.direction;var h=i.elements;var x=Et.Stat.loopCount;for(var c=0,d=i.length;c<d;c++){var u=h[c];var f=u._castShadow&&u._enable;if(f){Et.Stat.frustumCulling++;var p=u.bounds;var m=p.getMin();var g=p.getMax();var v=m.x;var y=m.y;var T=m.z;var E=g.x;var b=g.y;var S=g.z;var C=true;for(var R=0;R<n;R++){var A=o[R];var L=A.normal;if(A.distance+L.x*(L.x<0?v:E)+L.y*(L.y<0?y:b)+L.z*(L.z<0?T:S)<0){C=false;break}}if(C){u._renderMark=x;u._distanceForSort=St.distance(p.getCenter(),s);var I=u._renderElements;for(var R=0,M=I.length;R<M;R++)I[R]._update(e,a,null,null)}}}return r.elements.length>0?true:false}static cullingSpotShadow(t,e,a){var i=e._renders;e._clearRenderQueue();var r=e._opaqueQueue;var s=i.elements;var n=Et.Stat.loopCount;for(var o=0,l=i.length;o<l;o++){var _=s[o];var h=_._castShadow&&_._enable;if(h){if(_._needRender(t.boundFrustum,a)){var x=_.bounds;_._renderMark=n;_._distanceForSort=St.distance(x.getCenter(),t.position);var c=_._renderElements;for(var d=0,u=c.length;d<u;d++)c[d]._update(e,a,null,null)}}}return r.elements.length>0?true:false}static renderObjectCullingNative(t,e,a,i,r,s){var n,o,l;var _=e._opaqueQueue;var h=e._transparentQueue;e._clearRenderQueue();var x=i.length;var c=i.elements;for(n=0;n<x;n++){c[n].bounds;c[n]._updateForNative&&c[n]._updateForNative(a)}var d=t.boundFrustum;be.cullingNative(t._boundFrustumBuffer,be._cullingBuffer,e._cullingBufferIndices,x,e._cullingBufferResult);var u=Et.Stat.loopCount;var f=a.camera._transform.position;for(n=0;n<x;n++){var p=c[n];if(!t.useOcclusionCulling||t._isLayerVisible(p._owner._layer)&&p._enable&&e._cullingBufferResult[n]){p._renderMark=u;p._distanceForSort=St.distance(p.bounds.getCenter(),f);var m=p._renderElements;for(o=0,l=m.length;o<l;o++){var g=m[o];g._update(e,a,r,s)}}}var v=_.elements.length;v>0&&_._quickSort(0,v-1);v=h.elements.length;v>0&&h._quickSort(0,v-1)}static cullingNative(t,e,a,i,r){return Et.LayaGL.instance.culling(t,e,a,i,r)}}be._tempColor0=new ye;be._tempVector0=new St;be._cameraCullInfo=new Te;be._shadowCullInfo=new Ee;be.debugFrustumCulling=false;class Se{constructor(){this._coefficients=new Float32Array(27)}getCoefficient(t,e){return this._coefficients[t*9+e]}setCoefficient(t,e,a){this._coefficients[t*9+e]=a}setCoefficients(t,e,a,i,r,s,n,o,l,_){var h=t*9;this._coefficients[h]=e;this._coefficients[++h]=a;this._coefficients[++h]=i;this._coefficients[++h]=r;this._coefficients[++h]=s;this._coefficients[++h]=n;this._coefficients[++h]=o;this._coefficients[++h]=l;this._coefficients[++h]=_}cloneTo(t){if(this===t)return;var e=this._coefficients;var a=t._coefficients;for(var i=0;i<27;i++)a[i]=e[i]}}Se._default=new Se;class Ce{constructor(){this._pressedSprite=null;this._pressedLoopCount=-1;this.sprite=null;this.mousePositionX=0;this.mousePositionY=0}}class Re{constructor(){this._indexInList=-1;this._identifier=-1;this._position=new Ct}get identifier(){return this._identifier}get position(){return this._position}_getIndexInList(){return this._indexInList}_setIndexInList(t){this._indexInList=t}}class Ae{constructor(){this._eventList=[];this._mouseTouch=new Ce;this._touchPool=[];this._touches=new ve;this._multiTouchEnabled=true;this._pushEventList=(t=>{t.cancelable&&t.preventDefault();this._eventList.push(t)}).bind(this)}__init__(t,e){this._scene=e;t.oncontextmenu=function(t){return false}}_onCanvasEvent(t){t.addEventListener("mousedown",this._pushEventList);t.addEventListener("mouseup",this._pushEventList,true);t.addEventListener("mousemove",this._pushEventList,true);t.addEventListener("touchstart",this._pushEventList);t.addEventListener("touchend",this._pushEventList,true);t.addEventListener("touchmove",this._pushEventList,true);t.addEventListener("touchcancel",this._pushEventList,true)}_offCanvasEvent(t){t.removeEventListener("mousedown",this._pushEventList);t.removeEventListener("mouseup",this._pushEventList,true);t.removeEventListener("mousemove",this._pushEventList,true);t.removeEventListener("touchstart",this._pushEventList);t.removeEventListener("touchend",this._pushEventList,true);t.removeEventListener("touchmove",this._pushEventList,true);t.removeEventListener("touchcancel",this._pushEventList,true);this._eventList.length=0;this._touches.clear()}touchCount(){return this._touches.length}get multiTouchEnabled(){return this._multiTouchEnabled}set multiTouchEnabled(t){this._multiTouchEnabled=t}_getTouch(t,e){var a=this._touchPool[t];if(e==0&&a&&a._getIndexInList()!=-1)return null;if(e==1&&a&&a._getIndexInList()==-1)return null;if(!a){a=new Re;this._touchPool[t]=a;a._identifier=t}return a}_mouseTouchDown(){var t=this._mouseTouch;var e=t.sprite;t._pressedSprite=e;t._pressedLoopCount=Et.Stat.loopCount;if(e){var a=e._scripts;if(a){for(var i=0,r=a.length;i<r;i++)a[i].onMouseDown()}}}_mouseTouchUp(){var t,e;var a=this._mouseTouch;var i=a._pressedSprite;a._pressedSprite=null;a._pressedLoopCount=-1;var r=a.sprite;if(r){if(r===i){var s=r._scripts;if(s){for(t=0,e=s.length;t<e;t++)s[t].onMouseClick()}}}if(i){var n=i._scripts;if(n){for(t=0,e=n.length;t<e;t++)n[t].onMouseUp()}}}_mouseTouchRayCast(t){var e=Ae._tempHitResult0;var a=Ae._tempVector20;var i=Ae._tempRay0;e.succeeded=false;var r=this._mouseTouch.mousePositionX;var s=this._mouseTouch.mousePositionY;a.x=r;a.y=s;for(var n=t.length-1;n>=0;n--){var o=t[n];var l=o.viewport;if(a.x>=l.x&&a.y>=l.y&&a.x<=l.width&&a.y<=l.height){o.viewportPointToRay(a,i);var _=this._scene._physicsSimulation.rayCast(i,e);if(_||(o.clearFlag===H.CameraClearFlags.SolidColor||o.clearFlag===H.CameraClearFlags.Sky))break}}var h=this._mouseTouch;var x=h.sprite;if(e.succeeded){var c=e.collider.owner;h.sprite=c;var d=c._scripts;if(x!==c){if(d){for(var u=0,f=d.length;u<f;u++)d[u].onMouseEnter()}}}else{h.sprite=null}if(x&&x!==c){var p=x._scripts;if(p){for(u=0,f=p.length;u<f;u++)p[u].onMouseOut()}}}_changeTouches(t,e){var a=0,i=0;var r=this._touches.length;for(var s=0,n=t.length;s<n;s++){var o=t[s];var l=o.identifier;if(!this._multiTouchEnabled&&l!==0)continue;var _=this._getTouch(l,e);var h=this._touchPool[l]._position;var x=Ae._tempPoint;x.setTo(o.pageX,o.pageY);Et.ILaya.stage._canvasTransform.invertTransformPoint(x);var c=x.x;var d=x.y;switch(e){case 0:if(!!_)this._touches.add(_);a+=c;i+=d;break;case 1:if(!!_)this._touches.remove(_);a-=c;i-=d;break;case 2:a=c-h.x;i=d-h.y;break}h.x=c;h.y=d}var u=this._touches.length;if(u===0){this._mouseTouch.mousePositionX=0;this._mouseTouch.mousePositionY=0}else{this._mouseTouch.mousePositionX=(this._mouseTouch.mousePositionX*r+a)/u;this._mouseTouch.mousePositionY=(this._mouseTouch.mousePositionY*r+i)/u}}_update(){var t=$._enablePhysics&&!w.disableSimulation;var e,a,i,r;a=this._eventList.length;var s=this._scene._cameraPool;if(a>0){var n=false;for(e=0;e<a;e++){var o=this._eventList[e];switch(o.type){case"mousedown":t&&this._mouseTouchDown();break;case"mouseup":t&&this._mouseTouchUp();break;case"mousemove":var l=Ae._tempPoint;l.setTo(o.pageX,o.pageY);Et.ILaya.stage._canvasTransform.invertTransformPoint(l);this._mouseTouch.mousePositionX=l.x;this._mouseTouch.mousePositionY=l.y;t&&(n=true);break;case"touchstart":var _=this._touches.length;this._changeTouches(o.changedTouches,0);if(t){!tt._config.isUseCannonPhysicsEngine&&this._mouseTouchRayCast(s);_===0&&this._mouseTouchDown()}break;case"touchend":case"touchcancel":this._changeTouches(o.changedTouches,1);t&&this._touches.length===0&&this._mouseTouchUp();break;case"touchmove":this._changeTouches(o.changedTouches,2);t&&(n=true);break;default:throw"Input3D:unkonwn event type."}}n&&!tt._config.isUseCannonPhysicsEngine&&this._mouseTouchRayCast(s);this._eventList.length=0}if(t){var h=this._mouseTouch;var x=h._pressedSprite;if(x&&Et.Stat.loopCount>h._pressedLoopCount){var c=x._scripts;if(c){for(i=0,r=c.length;i<r;i++)c[i].onMouseDrag()}}var d=h.sprite;if(d){var u=d._scripts;if(u){for(i=0,r=u.length;i<r;i++)u[i].onMouseOver()}}}}getTouch(t){if(t<this._touches.length){return this._touches.elements[t]}else{return null}}}Ae._tempPoint=new Et.Point;Ae._tempVector20=new Ct;Ae._tempRay0=new Ht(new St,new St);Ae._tempHitResult0=new r;class Le{constructor(){this.flags=0;this.maxSubSteps=1;this.fixedTimeStep=1/60}}class Ie{constructor(t,e){this._position=t;this._textureCoordinate0=e}static get vertexDeclaration(){return Ie._vertexDeclaration}static __init__(){Ie._vertexDeclaration=new Tt(20,[new h(0,_.Vector3,K.MESH_POSITION0),new h(12,_.Vector2,K.MESH_TEXTURECOORDINATE0)])}get position(){return this._position}get textureCoordinate0(){return this._textureCoordinate0}get vertexDeclaration(){return Ie._vertexDeclaration}}class Me extends qt{constructor(t=48,e=48){super();var a=Et.LayaGL.instance;this._stacks=t;this._slices=e;var i=Ie.vertexDeclaration;var r=i.vertexStride/4;var s=(this._stacks+1)*(this._slices+1);var n=3*this._stacks*(this._slices+1)*2;var o=new Float32Array(s*r);var l=new Uint16Array(n);var _=Math.PI/this._stacks;var h=Math.PI*2/this._slices;var x=0;var c=0;var d=0;for(var u=0;u<this._stacks+1;u++){var f=Math.sin(u*_);var p=Math.cos(u*_);for(var m=0;m<this._slices+1;m++){var g=f*Math.sin(m*h);var v=f*Math.cos(m*h);o[c+0]=g*Me._radius;o[c+1]=p*Me._radius;o[c+2]=v*Me._radius;o[c+3]=-(m/this._slices)+.75;o[c+4]=u/this._stacks;c+=r;if(u!=this._stacks-1){l[d++]=x+1;l[d++]=x;l[d++]=x+(this._slices+1);l[d++]=x+(this._slices+1);l[d++]=x;l[d++]=x+this._slices;x++}}}this._vertexBuffer=new vt(o.length*4,a.STATIC_DRAW,false);this._vertexBuffer.vertexDeclaration=i;this._indexBuffer=new jt(H.IndexFormat.UInt16,l.length,a.STATIC_DRAW,false);this._vertexBuffer.setData(o.buffer);this._indexBuffer.setData(l);var y=new Rt;y.bind();y.applyVertexBuffer(this._vertexBuffer);y.applyIndexBuffer(this._indexBuffer);y.unBind();this._bufferState=y}static __init__(){Me.instance=new Me}get stacks(){return this._stacks}get slices(){return this._slices}_render(t){var e=Et.LayaGL.instance;var a=this._indexBuffer.indexCount;e.drawElements(e.TRIANGLES,a,e.UNSIGNED_SHORT,0);Et.Stat.trianglesFaces+=a/3;Et.Stat.renderBatches++}}Me._radius=1;(function(t){t[t["PositiveX"]=0]="PositiveX";t[t["NegativeX"]=1]="NegativeX";t[t["PositiveY"]=2]="PositiveY";t[t["NegativeY"]=3]="NegativeY";t[t["PositiveZ"]=4]="PositiveZ";t[t["NegativeZ"]=5]="NegativeZ"})(H.TextureCubeFace||(H.TextureCubeFace={}));class De extends Et.BaseTexture{constructor(t,e=Et.TextureFormat.R8G8B8,a=false){super(e,a);this._glTextureType=Et.LayaGL.instance.TEXTURE_CUBE_MAP;this._width=t;this._height=t;var i=Et.LayaGL.instance;this._setWarpMode(i.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(i.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);if(this._mipmap){this._mipmapCount=Math.ceil(Math.log2(t))+1;for(var r=0;r<this._mipmapCount;r++)this._setPixels([],r,Math.max(t>>r,1),Math.max(t>>r,1));this._setGPUMemory(t*t*4*(1+1/3)*6)}else{this._mipmapCount=1;this._setGPUMemory(t*t*4*6)}}static get blackTexture(){return De._blackTexture}static get grayTexture(){return De._grayTexture}static __init__(){var t=new De(1,Et.TextureFormat.R8G8B8,false);var e=new De(1,Et.TextureFormat.R8G8B8,false);var a=new Uint8Array(3);a[0]=0,a[1]=0,a[2]=0;t.setSixSidePixels([a,a,a,a,a,a]);t.lock=true;a[0]=128,a[1]=128,a[2]=128;e.setSixSidePixels([a,a,a,a,a,a]);e.lock=true;De._grayTexture=e;De._blackTexture=t}static _parse(t,e=null,a=null){var i=a?new De(0,a[0],a[1]):new De(0);i.setSixSideImageSources(t);return i}static _parseBin(t,e=null,a=null){var i=a?new De(0,a[0],a[1]):new De(0);i.setSixSideImageSources(t);return i}static load(t,e){var a=Et.LoaderManager.createMap[Et.Utils.getFilecompatibleExtension(t)]?Et.Utils.getFilecompatibleExtension(t):Et.Utils.getFileExtension(t);var i=Et.LoaderManager.createMap[a]?Et.LoaderManager.createMap[a][0]:null;Et.ILaya.loader.create(t,e,null,i)}get defaulteTexture(){return De.grayTexture}_setPixels(t,e,a,i){var r=Et.LayaGL.instance;var s=this._getGLFormat();Et.WebGLContext.bindTexture(r,this._glTextureType,this._glTexture);if(this.format===Et.TextureFormat.R8G8B8){r.pixelStorei(r.UNPACK_ALIGNMENT,1);r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[0]);r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[1]);r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[2]);r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[3]);r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[4]);r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[5]);r.pixelStorei(r.UNPACK_ALIGNMENT,4)}else{r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[0]);r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[1]);r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[2]);r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[3]);r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[4]);r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,e,s,a,i,0,s,r.UNSIGNED_BYTE,t[5])}}setSixSideImageSources(t,e=false){var a;var i;for(var r=0;r<6;r++){var s=t[r];if(!s){console.log("TextureCube: image Source can't be null.");return}var n=s.width;var o=s.height;if(r>0){if(a!==n){console.log("TextureCube: each side image's width and height must same.");return}}a=n;i=o;if(a!==i){console.log("TextureCube: each side image's width and height must same.");return}}this._width=a;this._height=i;var l=Et.LayaGL.instance;Et.WebGLContext.bindTexture(l,this._glTextureType,this._glTexture);var _=this._getGLFormat();if(!Et.Render.isConchApp){e&&l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_Z,0,_,_,l.UNSIGNED_BYTE,t[0]);l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,_,_,l.UNSIGNED_BYTE,t[1]);l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X,0,_,_,l.UNSIGNED_BYTE,t[2]);l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_X,0,_,_,l.UNSIGNED_BYTE,t[3]);l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_Y,0,_,_,l.UNSIGNED_BYTE,t[4]);l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,_,_,l.UNSIGNED_BYTE,t[5]);e&&l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{if(e==true){for(var h=0;h<6;h++)t[h].setPremultiplyAlpha(e)}l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_Z,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[0]);l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[1]);l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[2]);l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_X,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[3]);l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_Y,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[4]);l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[5])}if(this._mipmap&&this._isPot(a)&&this._isPot(i)){l.generateMipmap(this._glTextureType);this._setGPUMemory(a*i*4*(1+1/3)*6)}else{this._setGPUMemory(a*i*4*6)}this._setWarpMode(l.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(l.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._readyed=true;this._activeResource()}setSixSidePixels(t,e=0){if(!t)throw new Error("TextureCube:pixels can't be null.");var a=Math.max(this._width>>e,1);var i=Math.max(this._height>>e,1);var r=a*i*this._getFormatByteCount();if(t[0].length<r)throw"TextureCube:pixels length should at least "+r+".";this._setPixels(t,e,a,i);if(e===0){var s=Et.LayaGL.instance;this._setWarpMode(s.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(s.TEXTURE_WRAP_T,this._wrapModeV)}this._readyed=true;this._activeResource()}setImageSource(t,e,a=0){var i=this._width;var r=this._height;if(e){if(i!==e.width||r!==e.height){console.log("TextureCube: imageSource's width and height must same.");return}}var s=Et.LayaGL.instance;Et.WebGLContext.bindTexture(s,this._glTextureType,this._glTexture);var n=this._getGLFormat();switch(t){case H.TextureCubeFace.NegativeX:s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_X,a,n,n,s.UNSIGNED_BYTE,e);break;case H.TextureCubeFace.PositiveX:s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X,a,n,n,s.UNSIGNED_BYTE,e);break;case H.TextureCubeFace.NegativeY:s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Y,a,n,n,s.UNSIGNED_BYTE,e);break;case H.TextureCubeFace.PositiveY:s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Y,a,n,n,s.UNSIGNED_BYTE,e);break;case H.TextureCubeFace.NegativeZ:s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Z,a,n,n,s.UNSIGNED_BYTE,e);break;case H.TextureCubeFace.PositiveZ:s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Z,a,n,n,s.UNSIGNED_BYTE,e);break}if(this._mipmap&&this._isPot(i)&&this._isPot(r)){s.generateMipmap(this._glTextureType);this._setGPUMemory(i*r*4*(1+1/3)*6)}else{this._setGPUMemory(i*r*4*6)}this._setWarpMode(s.TEXTURE_WRAP_S,this._wrapModeU);this._setWarpMode(s.TEXTURE_WRAP_T,this._wrapModeV);this._setFilterMode(this._filterMode);this._readyed=true}}De.TEXTURECUBE="TEXTURECUBE";De.TEXTURECUBEBIN="TEXTURECUBEBIN";class we{constructor(){this._length=0;this._elements=[]}add(t){if(this._length===this._elements.length)this._elements.push(t);else this._elements[this._length]=t;this._length++}remove(t){var e=this._elements.indexOf(t);this._length--;if(e!==this._length){var a=this._elements[this._length];this._elements[e]=a}}shift(){this._length--;return this._elements.shift()}getBrightestLight(){var t;var e=-1;var a=this._elements;for(var i=0;i<this._length;i++){var r=a[i]._intensity;if(e<r){e=r;t=i}}return t}normalLightOrdering(t){var e=this._elements;var a=this._elements[0];this._elements[0]=this._elements[t];this._elements[t]=a}}class Pe extends we{remove(t){var e=this._elements.indexOf(t);this._elements.splice(e,1);this._length--}}class Oe extends s{constructor(){super();this.setShaderName("LineShader");this._shaderValues.setVector(Oe.COLOR,new bt(1,1,1,1))}static __initDefine__(){}get color(){return this._shaderValues.getVector(Oe.COLOR)}set color(t){this._shaderValues.setVector(Oe.COLOR,t)}set depthWrite(t){this._shaderValues.setBool(Oe.DEPTH_WRITE,t)}get depthWrite(){return this._shaderValues.getBool(Oe.DEPTH_WRITE)}set cull(t){this._shaderValues.setInt(Oe.CULL,t)}get cull(){return this._shaderValues.getInt(Oe.CULL)}set blend(t){this._shaderValues.setInt(Oe.BLEND,t)}get blend(){return this._shaderValues.getInt(Oe.BLEND)}set blendSrc(t){this._shaderValues.setInt(Oe.BLEND_SRC,t)}get blendSrc(){return this._shaderValues.getInt(Oe.BLEND_SRC)}set blendDst(t){this._shaderValues.setInt(Oe.BLEND_DST,t)}get blendDst(){return this._shaderValues.getInt(Oe.BLEND_DST)}set depthTest(t){this._shaderValues.setInt(Oe.DEPTH_TEST,t)}get depthTest(){return this._shaderValues.getInt(Oe.DEPTH_TEST)}clone(){var t=new Oe;this.cloneTo(t);return t}}Oe.COLOR=P.propertyNameToID("u_Color");Oe.CULL=P.propertyNameToID("s_Cull");Oe.BLEND=P.propertyNameToID("s_Blend");Oe.BLEND_SRC=P.propertyNameToID("s_BlendSrc");Oe.BLEND_DST=P.propertyNameToID("s_BlendDst");Oe.DEPTH_TEST=P.propertyNameToID("s_DepthTest");Oe.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");class Ne{constructor(t,e){this.min=t;this.max=e}_rotateExtents(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=e.elements;a.x=Math.abs(n[0]*i)+Math.abs(n[4]*r)+Math.abs(n[8]*s);a.y=Math.abs(n[1]*i)+Math.abs(n[5]*r)+Math.abs(n[9]*s);a.z=Math.abs(n[2]*i)+Math.abs(n[6]*r)+Math.abs(n[10]*s)}getCorners(t){t.length=8;var e=this.min.x;var a=this.min.y;var i=this.min.z;var r=this.max.x;var s=this.max.y;var n=this.max.z;t[0]=new St(e,s,n);t[1]=new St(r,s,n);t[2]=new St(r,a,n);t[3]=new St(e,a,n);t[4]=new St(e,s,i);t[5]=new St(r,s,i);t[6]=new St(r,a,i);t[7]=new St(e,a,i)}getCenter(t){St.add(this.min,this.max,t);St.scale(t,.5,t)}getExtent(t){St.subtract(this.max,this.min,t);St.scale(t,.5,t)}setCenterAndExtent(t,e){St.subtract(t,e,this.min);St.add(t,e,this.max)}tranform(t,e){var a=Ne._tempVector30;var i=Ne._tempVector31;this.getCenter(a);this.getExtent(i);St.transformCoordinate(a,t,a);this._rotateExtents(i,t,i);e.setCenterAndExtent(a,i)}toDefault(){this.min.toDefault();this.max.toDefault()}static createfromPoints(t,e){if(t==null)throw new Error("points");var a=e.min;var i=e.max;a.x=Number.MAX_VALUE;a.y=Number.MAX_VALUE;a.z=Number.MAX_VALUE;i.x=-Number.MAX_VALUE;i.y=-Number.MAX_VALUE;i.z=-Number.MAX_VALUE;for(var r=0,s=t.length;r<s;++r){St.min(a,t[r],a);St.max(i,t[r],i)}}static merge(t,e,a){St.min(t.min,e.min,a.min);St.max(t.max,e.max,a.max)}cloneTo(t){var e=t;this.min.cloneTo(e.min);this.max.cloneTo(e.max)}clone(){var t=new Ne(new St,new St);this.cloneTo(t);return t}}Ne._tempVector30=new St;Ne._tempVector31=new St;class Be{constructor(t,e){this._updateFlag=0;this._center=new St;this._extent=new St;this._boundBox=new Ne(new St,new St);t.cloneTo(this._boundBox.min);e.cloneTo(this._boundBox.max);this._setUpdateFlag(Be._UPDATE_CENTER|Be._UPDATE_EXTENT,true)}setMin(t){var e=this._boundBox.min;if(t!==e)t.cloneTo(e);this._setUpdateFlag(Be._UPDATE_CENTER|Be._UPDATE_EXTENT,true);this._setUpdateFlag(Be._UPDATE_MIN,false)}getMin(){var t=this._boundBox.min;if(this._getUpdateFlag(Be._UPDATE_MIN)){this._getMin(this.getCenter(),this.getExtent(),t);this._setUpdateFlag(Be._UPDATE_MIN,false)}return t}setMax(t){var e=this._boundBox.max;if(t!==e)t.cloneTo(e);this._setUpdateFlag(Be._UPDATE_CENTER|Be._UPDATE_EXTENT,true);this._setUpdateFlag(Be._UPDATE_MAX,false)}getMax(){var t=this._boundBox.max;if(this._getUpdateFlag(Be._UPDATE_MAX)){this._getMax(this.getCenter(),this.getExtent(),t);this._setUpdateFlag(Be._UPDATE_MAX,false)}return t}setCenter(t){if(t!==this._center)t.cloneTo(this._center);this._setUpdateFlag(Be._UPDATE_MIN|Be._UPDATE_MAX,true);this._setUpdateFlag(Be._UPDATE_CENTER,false)}getCenter(){if(this._getUpdateFlag(Be._UPDATE_CENTER)){this._getCenter(this.getMin(),this.getMax(),this._center);this._setUpdateFlag(Be._UPDATE_CENTER,false)}return this._center}setExtent(t){if(t!==this._extent)t.cloneTo(this._extent);this._setUpdateFlag(Be._UPDATE_MIN|Be._UPDATE_MAX,true);this._setUpdateFlag(Be._UPDATE_EXTENT,false)}getExtent(){if(this._getUpdateFlag(Be._UPDATE_EXTENT)){this._getExtent(this.getMin(),this.getMax(),this._extent);this._setUpdateFlag(Be._UPDATE_EXTENT,false)}return this._extent}_getUpdateFlag(t){return(this._updateFlag&t)!=0}_setUpdateFlag(t,e){if(e)this._updateFlag|=t;else this._updateFlag&=~t}_getCenter(t,e,a){St.add(t,e,a);St.scale(a,.5,a)}_getExtent(t,e,a){St.subtract(e,t,a);St.scale(a,.5,a)}_getMin(t,e,a){St.subtract(t,e,a)}_getMax(t,e,a){St.add(t,e,a)}_rotateExtents(t,e,a){var i=t.x;var r=t.y;var s=t.z;var n=e.elements;a.x=Math.abs(n[0]*i)+Math.abs(n[4]*r)+Math.abs(n[8]*s);a.y=Math.abs(n[1]*i)+Math.abs(n[5]*r)+Math.abs(n[9]*s);a.z=Math.abs(n[2]*i)+Math.abs(n[6]*r)+Math.abs(n[10]*s)}_tranform(t,e){var a=e._center;var i=e._extent;St.transformCoordinate(this.getCenter(),t,a);this._rotateExtents(this.getExtent(),t,i);e._boundBox.setCenterAndExtent(a,i);e._updateFlag=0}_getBoundBox(){if(this._updateFlag&Be._UPDATE_MIN){var t=this._boundBox.min;this._getMin(this.getCenter(),this.getExtent(),t);this._setUpdateFlag(Be._UPDATE_MIN,false)}if(this._updateFlag&Be._UPDATE_MAX){var e=this._boundBox.max;this._getMax(this.getCenter(),this.getExtent(),e);this._setUpdateFlag(Be._UPDATE_MAX,false)}return this._boundBox}calculateBoundsintersection(t){var e=this.getMax();var a=this.getMin();var i=t.getMax();var r=t.getMin();var s=Be.TEMP_VECTOR3_MAX0;var n=Be.TEMP_VECTOR3_MAX1;var o=this.getExtent();var l=t.getExtent();s.setValue(Math.max(e.x,i.x)-Math.min(a.x,r.x),Math.max(e.y,i.y)-Math.min(a.y,r.y),Math.max(e.z,i.z)-Math.min(a.z,r.z));n.setValue((o.x+l.x)*2,(o.y+l.y)*2,(o.z+l.z)*2);if(s.x>n.x)return-1;if(s.y>n.y)return-1;if(s.z>n.z)return-1;return(n.x-s.x)*(n.y-s.y)*(n.z-s.z)}cloneTo(t){var e=t;this.getMin().cloneTo(e._boundBox.min);this.getMax().cloneTo(e._boundBox.max);this.getCenter().cloneTo(e._center);this.getExtent().cloneTo(e._extent);e._updateFlag=0}clone(){var t=new Be(new St,new St);this.cloneTo(t);return t}}Be._UPDATE_MIN=1;Be._UPDATE_MAX=2;Be._UPDATE_CENTER=4;Be._UPDATE_EXTENT=8;Be.TEMP_VECTOR3_MAX0=new St;Be.TEMP_VECTOR3_MAX1=new St;class Fe{constructor(){this._destroyed=false}get destroyed(){return this._destroyed}_getType(){throw"GeometryElement:must override it."}_prepareRender(t){return true}_render(t){throw"GeometryElement:must override it."}destroy(){if(this._destroyed)return;this._destroyed=true}}Fe._typeCounter=0;class Ve{constructor(){}static get vertexDeclaration(){return Ve._vertexDeclaration}static __init__(){Ve._vertexDeclaration=new Tt(28,[new h(0,_.Vector3,K.MESH_POSITION0),new h(12,_.Vector4,K.MESH_COLOR0)])}get vertexDeclaration(){return Ve._vertexDeclaration}}class Ue extends Fe{constructor(t,e){super();this._floatCountPerVertices=7;this._minUpdate=Number.MAX_VALUE;this._maxUpdate=Number.MIN_VALUE;this._bufferState=new Rt;this._floatBound=new Float32Array(6);this._calculateBound=false;this._maxLineCount=0;this._lineCount=0;var a=e*2;this._owner=t;this._maxLineCount=e;this._vertices=new Float32Array(a*this._floatCountPerVertices);this._vertexBuffer=new vt(Ve.vertexDeclaration.vertexStride*a,Et.LayaGL.instance.STATIC_DRAW,false);this._vertexBuffer.vertexDeclaration=Ve.vertexDeclaration;this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.unBind();var i=Ue._tempVector0;var r=Ue._tempVector1;i.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);r.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this._bounds=new Be(i,r)}_getType(){return Ue._type}_resizeLineData(t){var e=t*2;var a=this._vertices;this._vertexBuffer.destroy();this._maxLineCount=t;var i=e*this._floatCountPerVertices;this._vertices=new Float32Array(i);this._vertexBuffer=new vt(Ve.vertexDeclaration.vertexStride*e,Et.LayaGL.instance.STATIC_DRAW,false);this._vertexBuffer.vertexDeclaration=Ve.vertexDeclaration;if(i<a.length){this._vertices.set(new Float32Array(a.buffer,0,i));this._vertexBuffer.setData(this._vertices.buffer,0,0,i*4)}else{this._vertices.set(a);this._vertexBuffer.setData(this._vertices.buffer,0,0,a.length*4)}this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.unBind()}_updateLineVertices(t,e,a,i,r){if(e){this._vertices[t+0]=e.x;this._vertices[t+1]=e.y;this._vertices[t+2]=e.z}if(i){this._vertices[t+3]=i.r;this._vertices[t+4]=i.g;this._vertices[t+5]=i.b;this._vertices[t+6]=i.a}if(a){this._vertices[t+7]=a.x;this._vertices[t+8]=a.y;this._vertices[t+9]=a.z}if(r){this._vertices[t+10]=r.r;this._vertices[t+11]=r.g;this._vertices[t+12]=r.b;this._vertices[t+13]=r.a}this._minUpdate=Math.min(this._minUpdate,t);this._maxUpdate=Math.max(this._maxUpdate,t+this._floatCountPerVertices*2);var s=this._bounds;var n=this._floatBound;var o=s.getMin(),l=s.getMax();St.min(o,e,o);St.min(o,a,o);St.max(l,e,l);St.max(l,a,l);s.setMin(o);s.setMax(l);n[0]=o.x,n[1]=o.y,n[2]=o.z;n[3]=l.x,n[4]=l.y,n[5]=l.z}_reCalculateBound(){if(this._calculateBound){var t=this._vertices;var e=Ue._tempVector0;var a=Ue._tempVector1;e.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);a.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<this._lineCount*2;++i){var r=this._floatCountPerVertices*i;var s=t[r+0],n=t[r+1],o=t[r+2];e.x=Math.min(s,e.x);e.y=Math.min(n,e.y);e.z=Math.min(o,e.z);a.x=Math.max(s,a.x);a.y=Math.max(n,a.y);a.z=Math.max(o,a.z)}this._bounds.setMin(e);this._bounds.setMax(a);var l=this._floatBound;l[0]=e.x,l[1]=e.y,l[2]=e.z;l[3]=a.x,l[4]=a.y,l[5]=a.z;this._calculateBound=false}}_removeLineData(t){var e=this._floatCountPerVertices*2;var a=t+1;var i=t*e;var r=this._vertices;var s=new Float32Array(r.buffer,a*e*4,(this._lineCount-a)*e);r.set(s,i);this._minUpdate=Math.min(this._minUpdate,i);this._maxUpdate=Math.max(this._maxUpdate,i+s.length);this._lineCount--;var n=this._floatBound;var o=r[i],l=r[i+1],_=r[i+2];var h=r[i+7],x=r[i+8],c=r[i+9];var d=n[0],u=n[1],f=n[2];var p=n[3],m=n[4],g=n[5];if(o===d||o===p||l===u||l===m||_===f||_===g||h===d||h===p||x===u||x===m||c===f||c===g)this._calculateBound=true}_updateLineData(t,e,a,i,r){var s=this._floatCountPerVertices*2;this._updateLineVertices(t*s,e,a,i,r)}_updateLineDatas(t,e){var a=this._floatCountPerVertices*2;var i=e.length;for(var r=0;r<i;r++){var s=e[r];this._updateLineVertices((t+r)*a,s.startPosition,s.endPosition,s.startColor,s.endColor)}}_getLineData(t,e){var a=e.startPosition;var i=e.startColor;var r=e.endPosition;var s=e.endColor;var n=this._vertices;var o=t*this._floatCountPerVertices*2;a.x=n[o+0];a.y=n[o+1];a.z=n[o+2];i.r=n[o+3];i.g=n[o+4];i.b=n[o+5];i.a=n[o+6];r.x=n[o+7];r.y=n[o+8];r.z=n[o+9];s.r=n[o+10];s.g=n[o+11];s.b=n[o+12];s.a=n[o+13]}_prepareRender(t){return true}_render(t){if(this._minUpdate!==Number.MAX_VALUE&&this._maxUpdate!==Number.MIN_VALUE){this._vertexBuffer.setData(this._vertices.buffer,this._minUpdate*4,this._minUpdate*4,(this._maxUpdate-this._minUpdate)*4);this._minUpdate=Number.MAX_VALUE;this._maxUpdate=Number.MIN_VALUE}if(this._lineCount>0){this._bufferState.bind();var e=Et.LayaGL.instance;e.drawArrays(e.LINES,0,this._lineCount*2);Et.Stat.renderBatches++}}destroy(){if(this._destroyed)return;super.destroy();this._bufferState.destroy();this._vertexBuffer.destroy();this._bufferState=null;this._vertexBuffer=null;this._vertices=null}}Ue._tempVector0=new St;Ue._tempVector1=new St;Ue._type=Fe._typeCounter++;class ke extends Bt{constructor(t){super(t)}static __init__(){ke.SHADERDEFINE_RECEIVE_SHADOW=P.getDefineByName("RECEIVESHADOW");ke.SAHDERDEFINE_LIGHTMAP=P.getDefineByName("LIGHTMAP");ke.SHADERDEFINE_LIGHTMAP_DIRECTIONAL=P.getDefineByName("LIGHTMAP_DIRECTIONAL")}_onInActive(){super._onInActive();this._scene._removeRenderObject(this._render)}_onActive(){super._onActive();this._scene._addRenderObject(this._render)}_onActiveInScene(){super._onActiveInScene();if(D.Laya3D._editerEnvironment){var t=this._scene;var e=new bt;t._allotPickColorByID(this.id,e);t._pickIdToSprite[this.id]=this;this._render._shaderValues.setVector(ke.PICKCOLOR,e)}}_addToInitStaticBatchManager(){}_setBelongScene(t){super._setBelongScene(t);this._render._setBelongScene(t)}_setUnBelongScene(){this._render._shaderValues.removeDefine(ke.SAHDERDEFINE_LIGHTMAP);super._setUnBelongScene()}_changeHierarchyAnimator(t){if(this._hierarchyAnimator){var e=this._hierarchyAnimator._renderableSprites;e.splice(e.indexOf(this),1)}if(t)t._renderableSprites.push(this);super._changeHierarchyAnimator(t)}destroy(t=true){super.destroy(t);this._render._destroy();this._render=null}_create(){return new ke(this.name)}}ke.LIGHTMAPSCALEOFFSET=P.propertyNameToID("u_LightmapScaleOffset");ke.LIGHTMAP=P.propertyNameToID("u_LightMap");ke.LIGHTMAP_DIRECTION=P.propertyNameToID("u_LightMapDirection");ke.PICKCOLOR=P.propertyNameToID("u_PickColor");ke.REFLECTIONTEXTURE=P.propertyNameToID("u_ReflectTexture");ke.REFLECTIONCUBE_HDR_PARAMS=P.propertyNameToID("u_ReflectCubeHDRParams");ke.REFLECTIONCUBE_PROBEPOSITION=P.propertyNameToID("u_SpecCubeProbePosition");ke.REFLECTIONCUBE_PROBEBOXMAX=P.propertyNameToID("u_SpecCubeBoxMax");ke.REFLECTIONCUBE_PROBEBOXMIN=P.propertyNameToID("u_SpecCubeBoxMin");class Ge{constructor(){this.updateMark=-1;this.indexInList=-1;this.batched=false}}class He extends Fe{constructor(){super();this.maxInstanceCount=1024;this.instanceWorldMatrixData=new Float32Array(this.maxInstanceCount*16);this.instanceMVPMatrixData=new Float32Array(this.maxInstanceCount*16);this.instanceSimpleAnimatorData=new Float32Array(this.maxInstanceCount*4);var t=Et.LayaGL.instance;this.instanceWorldMatrixBuffer=new vt(this.instanceWorldMatrixData.length*4,t.DYNAMIC_DRAW);this.instanceMVPMatrixBuffer=new vt(this.instanceMVPMatrixData.length*4,t.DYNAMIC_DRAW);this.instanceWorldMatrixBuffer.vertexDeclaration=K.instanceWorldMatrixDeclaration;this.instanceMVPMatrixBuffer.vertexDeclaration=K.instanceMVPMatrixDeclaration;this.instanceSimpleAnimatorBuffer=new vt(this.instanceSimpleAnimatorData.length*4,t.DYNAMIC_DRAW);this.instanceSimpleAnimatorBuffer.vertexDeclaration=K.instanceSimpleAnimatorDeclaration}static __init__(){He.instance=new He}_render(t){var e=Et.LayaGL.instance;var a=t.renderElement;var i=a.instanceSubMesh;var r=a.instanceBatchElementList.length;var s=i._indexCount;i._mesh._instanceBufferState.bind();Et.LayaGL.layaGPUInstance.drawElementsInstanced(e.TRIANGLES,s,e.UNSIGNED_SHORT,i._indexStart*2,r);Et.Stat.renderBatches++;Et.Stat.savedRenderBatches+=r-1;Et.Stat.trianglesFaces+=s*r/3}}class ze extends ie{constructor(){super();this._dynamicWorldPositionNormalNeedUpdate=true}_onWorldMatrixChanged(){this._dynamicWorldPositionNormalNeedUpdate=true}_computeWorldPositionsAndNormals(t,e,a,i){if(this._dynamicWorldPositionNormalNeedUpdate){var r=this._geometry;var s=r._vertexBuffer;var n=s.vertexDeclaration.vertexStride/4;var o=s.getFloat32Data();var l=this._transform.worldMatrix;var _=this._transform.rotation;var h=r._indices;for(var x=0;x<i;x++){var c=a?h[x]:x;var d=c*n;var u=x*3;F.transformVector3ArrayToVector3ArrayCoordinate(o,d+t,l,this._dynamicWorldPositions,u);e!==-1&&F.transformVector3ArrayByQuat(o,d+e,_,this._dynamicWorldNormals,u)}this._dynamicWorldPositionNormalNeedUpdate=false}}setTransform(t){if(this._transform!==t){this._transform&&this._transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatrixChanged);t&&t.on(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatrixChanged);this._dynamicWorldPositionNormalNeedUpdate=true;this._transform=t}}setGeometry(t){if(this._geometry!==t){var e=t;var a=e._mesh;if(a){var i=a._subMeshes.length>1;var r=i?e._indexCount:a._vertexCount;if(r<=D.SubMeshDynamicBatch.maxAllowVertexCount){var s=r*3;this._dynamicVertexBatch=true;this._dynamicWorldPositions=new Float32Array(s);this._dynamicWorldNormals=new Float32Array(s);this._dynamicVertexCount=r;this._dynamicMultiSubMesh=i}else{this._dynamicVertexBatch=false}}this._geometry=t}}addToOpaqueRenderQueue(t,e){var a=this.staticBatch;var i=e.elements;var r=i.elements;if(a&&(!this.render._probReflection||this.render._probReflection._isScene)){var s=D.MeshRenderStaticBatchManager.instance;var n=s.getBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,a._batchID);if(s._updateCountMark===n.updateMark){var o=n.indexInList;if(n.batched){r[o].staticBatchElementList.add(this)}else{var l=r[o];var _=l.render;var h=s._getBatchRenderElementFromPool();h.renderType=ie.RENDERTYPE_STATICBATCH;h.setGeometry(a);h.material=l.material;var x=a.batchOwner;var c=x?x._transform:null;h.setTransform(c);h.render=_;h.renderSubShader=l.renderSubShader;var d=h.staticBatchElementList;d.length=0;d.add(l);d.add(this);r[o]=h;n.batched=true}}else{n.updateMark=s._updateCountMark;n.indexInList=i.length;n.batched=false;i.add(this)}}else if(this.renderSubShader._owner._enableInstancing&&Et.LayaGL.layaGPUInstance.supportInstance()&&this.render.lightmapIndex<0&&(!this.render._probReflection||this.render._probReflection._isScene)){var u=this._geometry;var f=D.MeshRenderDynamicBatchManager.instance;var p=f.getInstanceBatchOpaquaMark(this.render.receiveShadow,this.material.id,u._id,this._transform._isFrontFaceInvert);if(f._updateCountMark===p.updateMark){var m=p.indexInList;if(p.batched){var g=r[m].instanceBatchElementList;if(g.length===He.instance.maxInstanceCount){p.updateMark=f._updateCountMark;p.indexInList=i.length;p.batched=false;i.add(this)}else{g.add(this)}}else{var v=r[m];var y=v.render;var T=f._getBatchRenderElementFromPool();T.renderType=ie.RENDERTYPE_INSTANCEBATCH;T.setGeometry(He.instance);T.material=v.material;T.setTransform(null);T.render=y;T.instanceSubMesh=u;T.renderSubShader=v.renderSubShader;var E=T.instanceBatchElementList;E.length=0;E.add(v);E.add(this);r[m]=T;p.batched=true}}else{p.updateMark=f._updateCountMark;p.indexInList=i.length;p.batched=false;i.add(this)}}else if(this._dynamicVertexBatch){var b=this._geometry._vertexBuffer.vertexDeclaration;var S=D.MeshRenderDynamicBatchManager.instance;var C=S.getVertexBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,b.id);if(S._updateCountMark===C.updateMark){var R=C.indexInList;if(C.batched){r[R].vertexBatchElementList.add(this)}else{var A=r[R];var L=A.render;var I=S._getBatchRenderElementFromPool();I.renderType=ie.RENDERTYPE_VERTEXBATCH;I.setGeometry(D.SubMeshDynamicBatch.instance);I.material=A.material;I.setTransform(null);I.render=L;I.vertexBatchVertexDeclaration=b;I.renderSubShader=A.renderSubShader;var M=I.vertexBatchElementList;M.length=0;M.add(A);M.add(this);r[R]=I;C.batched=true}}else{C.updateMark=S._updateCountMark;C.indexInList=i.length;C.batched=false;i.add(this)}}else{i.add(this)}}addToTransparentRenderQueue(t,e){var a=this.staticBatch;var i=e.elements;var r=i.elements;if(a){var s=D.MeshRenderStaticBatchManager.instance;var n=e.lastTransparentRenderElement;if(n){var o=n.render;if(n._geometry._getType()!==this._geometry._getType()||n.staticBatch!==a||n.material!==this.material||o.receiveShadow!==this.render.receiveShadow||o.lightmapIndex!==this.render.lightmapIndex){i.add(this);e.lastTransparentBatched=false}else{if(e.lastTransparentBatched){r[i.length-1].staticBatchElementList.add(this)}else{var l=s._getBatchRenderElementFromPool();l.renderType=ie.RENDERTYPE_STATICBATCH;l.setGeometry(a);l.material=n.material;var _=a.batchOwner;var h=_?_._transform:null;l.setTransform(h);l.render=this.render;l.renderSubShader=n.renderSubShader;var x=l.staticBatchElementList;x.length=0;x.add(n);x.add(this);r[i.length-1]=l}e.lastTransparentBatched=true}}else{i.add(this);e.lastTransparentBatched=false}}else if(this.renderSubShader._owner._enableInstancing&&Et.LayaGL.layaGPUInstance.supportInstance()&&this.render.lightmapIndex<0&&(!this.render._probReflection||this.render._probReflection._isScene)){var c=this._geometry;var d=D.MeshRenderDynamicBatchManager.instance;var u=e.lastTransparentRenderElement;if(u){var f=u.render;if(u._geometry._getType()!==this._geometry._getType()||u._geometry!==c||u.material!==this.material||f.receiveShadow!==this.render.receiveShadow){i.add(this);e.lastTransparentBatched=false}else{if(e.lastTransparentBatched){var p=r[i.length-1].instanceBatchElementList;if(p.length===He.instance.maxInstanceCount){i.add(this);e.lastTransparentBatched=false}else{p.add(this);e.lastTransparentBatched=true}}else{var m=d._getBatchRenderElementFromPool();m.renderType=ie.RENDERTYPE_INSTANCEBATCH;m.setGeometry(He.instance);m.material=u.material;m.setTransform(null);m.render=this.render;m.instanceSubMesh=c;m.renderSubShader=u.renderSubShader;var g=m.instanceBatchElementList;g.length=0;g.add(u);g.add(this);r[i.length-1]=m;e.lastTransparentBatched=true}}}else{i.add(this);e.lastTransparentBatched=false}}else if(this._dynamicVertexBatch){var v=this._geometry._vertexBuffer.vertexDeclaration;var y=D.MeshRenderDynamicBatchManager.instance;var T=e.lastTransparentRenderElement;if(T){var E=T.render;if(!T._dynamicVertexBatch||T._geometry._getType()!==this._geometry._getType()||T._geometry._vertexBuffer._vertexDeclaration!==v||T.material!==this.material||E.receiveShadow!==this.render.receiveShadow||E.lightmapIndex!==this.render.lightmapIndex){i.add(this);e.lastTransparentBatched=false}else{if(e.lastTransparentBatched){r[i.length-1].vertexBatchElementList.add(this)}else{var b=y._getBatchRenderElementFromPool();b.renderType=ie.RENDERTYPE_VERTEXBATCH;b.setGeometry(D.SubMeshDynamicBatch.instance);b.material=T.material;b.setTransform(null);b.render=this.render;b.vertexBatchVertexDeclaration=v;b.renderSubShader=T.renderSubShader;var S=b.vertexBatchElementList;S.length=0;S.add(T);S.add(this);r[i.length-1]=b}e.lastTransparentBatched=true}}else{i.add(this);e.lastTransparentBatched=false}}else{i.add(this)}e.lastTransparentRenderElement=this}getInvertFront(){switch(this.renderType){case ie.RENDERTYPE_NORMAL:return this._transform._isFrontFaceInvert;case ie.RENDERTYPE_STATICBATCH:case ie.RENDERTYPE_VERTEXBATCH:return false;case ie.RENDERTYPE_INSTANCEBATCH:return this.instanceBatchElementList.elements[0]._transform._isFrontFaceInvert;default:throw"SubMeshRenderElement: unknown renderType"}}destroy(){super.destroy();this._dynamicWorldPositions=null;this._dynamicWorldNormals=null;this.staticBatch=null;this.staticBatchElementList=null;this.vertexBatchElementList=null;this.vertexBatchVertexDeclaration=null}}class We{constructor(){this._initBatchSprites=[];this._staticBatches={};this._batchRenderElementPoolIndex=0;this._batchRenderElementPool=[]}static _addToStaticBatchQueue(t,e){if(t instanceof ke)e.push(t);for(var a=0,i=t.numChildren;a<i;a++)We._addToStaticBatchQueue(t._children[a],e)}static _registerManager(t){We._managers.push(t)}static combine(t,e=null){if(!e){e=[];if(t)We._addToStaticBatchQueue(t,e)}var a=e.length;if(a>0){for(var i=0;i<a;i++){var r=e[i];if(!r.destroyed){if(r._render._isPartOfStaticBatch)console.warn("StaticBatchManager: Sprite "+r.name+" has a part of Static Batch,it will be ignore.");else r._addToInitStaticBatchManager()}}for(var s=0,n=We._managers.length;s<n;s++){var o=We._managers[s];o._initStaticBatchs(t)}}}_partition(t,e,a){var i=t[Math.floor((a+e)/2)];while(e<=a){while(this._compare(t[e],i)<0)e++;while(this._compare(t[a],i)>0)a--;if(e<a){var r=t[e];t[e]=t[a];t[a]=r;e++;a--}else if(e===a){e++;break}}return e}_quickSort(t,e,a){if(t.length>1){var i=this._partition(t,e,a);var r=i-1;if(e<r)this._quickSort(t,e,r);if(i<a)this._quickSort(t,i,a)}}_compare(t,e){throw"StaticBatch:must override this function."}_initStaticBatchs(t){throw"StaticBatch:must override this function."}_getBatchRenderElementFromPool(){throw"StaticBatch:must override this function."}_addBatchSprite(t){this._initBatchSprites.push(t)}_clear(){this._batchRenderElementPoolIndex=0}_garbageCollection(){throw"StaticBatchManager: must override it."}dispose(){this._staticBatches=null}}We._managers=[];class Xe extends Fe{constructor(t,e){super();this._bufferState=new Rt;this._batchID=Xe._batchIDCounter++;this._batchElements=[];this._currentBatchVertexCount=0;this._currentBatchIndexCount=0;this._vertexDeclaration=e;this.batchOwner=t}_getStaticBatchBakedVertexs(t,e,a,i,r,s){var n=s._vertexBuffer;var o=n.vertexDeclaration;var l=o.getVertexElementByUsage(K.MESH_POSITION0)._offset/4;var _=o.getVertexElementByUsage(K.MESH_NORMAL0);var h=_?_._offset/4:-1;var x=o.getVertexElementByUsage(K.MESH_COLOR0);var c=x?x._offset/4:-1;var d=o.getVertexElementByUsage(K.MESH_TEXTURECOORDINATE0);var u=d?d._offset/4:-1;var f=o.getVertexElementByUsage(K.MESH_TEXTURECOORDINATE1);var p=f?f._offset/4:-1;var m=o.getVertexElementByUsage(K.MESH_TANGENT0);var g=m?m._offset/4:-1;var v=18;var y=o.vertexStride/4;var T=n.getFloat32Data();var E;if(a){var b=a.worldMatrix;b.invert(Xe._tempMatrix4x40);E=Xe._tempMatrix4x41;k.multiply(Xe._tempMatrix4x40,i.worldMatrix,E)}else{E=i.worldMatrix}var S=Xe._tempMatrix4x42;E.invert(S);S.transpose();var C=Xe._tempQuaternion0;E.decomposeTransRotScale(Xe._tempVector30,C,Xe._tempVector31);var R=r.lightmapScaleOffset;var A=s.vertexCount;for(var L=0;L<A;L++){var I=L*y;var M=(L+e)*v;F.transformVector3ArrayToVector3ArrayCoordinate(T,I+l,E,t,M+0);if(h!==-1)F.transformVector3ArrayToVector3ArrayNormal(T,I+h,S,t,M+3);var D,w;var P=M+6;if(c!==-1){var B=I+c;for(D=0,w=4;D<w;D++)t[P+D]=T[B+D]}else{for(D=0,w=4;D<w;D++)t[P+D]=1}if(u!==-1){var O=I+u;t[M+10]=T[O];t[M+11]=T[O+1]}if(R){if(p!==-1)F.transformLightingMapTexcoordArray(T,I+p,R,t,M+12);else F.transformLightingMapTexcoordArray(T,I+u,R,t,M+12)}if(g!==-1){var N=I+g;F.transformVector3ArrayToVector3ArrayNormal(T,N,S,t,M+14);t[M+17]=T[N+3]}}return A}addTest(t){var e;var a=t.meshFilter.sharedMesh.vertexCount;e=this._currentBatchVertexCount+a;if(e>Xe.maxBatchVertexCount)return false;return true}add(t){var e=t.meshFilter.sharedMesh;var a=e.vertexCount;this._batchElements.push(t);var i=t._render;i._isPartOfStaticBatch=true;i._staticBatch=this;var r=i._renderElements;for(var s=0,n=r.length;s<n;s++)r[s].staticBatch=this;this._currentBatchIndexCount+=e._indexBuffer.indexCount;this._currentBatchVertexCount+=a}remove(t){var e=t.meshFilter.sharedMesh;var a=this._batchElements.indexOf(t);if(a!==-1){this._batchElements.splice(a,1);var i=t._render._renderElements;for(var r=0,s=i.length;r<s;r++)i[r].staticBatch=null;this._currentBatchIndexCount=this._currentBatchIndexCount-e._indexBuffer.indexCount;this._currentBatchVertexCount=this._currentBatchVertexCount-e.vertexCount;t._render._isPartOfStaticBatch=false}}finishInit(){if(this._vertexBuffer){this._vertexBuffer.destroy();this._indexBuffer.destroy();Et.Resource._addGPUMemory(-(this._vertexBuffer._byteLength+this._indexBuffer._byteLength))}var t=Et.LayaGL.instance;var e=0;var a=0;var i=this.batchOwner;var r=this._vertexDeclaration.vertexStride/4;var s=new Float32Array(r*this._currentBatchVertexCount);var n=new Uint16Array(this._currentBatchIndexCount);this._vertexBuffer=new vt(this._vertexDeclaration.vertexStride*this._currentBatchVertexCount,t.STATIC_DRAW);this._vertexBuffer.vertexDeclaration=this._vertexDeclaration;this._indexBuffer=new jt(H.IndexFormat.UInt16,this._currentBatchIndexCount,t.STATIC_DRAW);for(var o=0,l=this._batchElements.length;o<l;o++){var _=this._batchElements[o];var h=_.meshFilter.sharedMesh;var x=this._getStaticBatchBakedVertexs(s,e,i?i._transform:null,_._transform,_._render,h);var c=h._indexBuffer.getData();var d=e;var u=a+c.length;var f=_._render._renderElements;for(var p=0,m=h.subMeshCount;p<m;p++){var g=h._subMeshes[p];var v=a+g._indexStart;var y=f[p];y.staticBatchIndexStart=v;y.staticBatchIndexEnd=v+g._indexCount}n.set(c,a);var T;var E=i?_._transform._isFrontFaceInvert!==i.transform._isFrontFaceInvert:_._transform._isFrontFaceInvert;if(E){for(T=a;T<u;T+=3){n[T]=d+n[T];var b=n[T+1];var S=n[T+2];n[T+1]=d+S;n[T+2]=d+b}}else{for(T=a;T<u;T+=3){n[T]=d+n[T];n[T+1]=d+n[T+1];n[T+2]=d+n[T+2]}}a+=c.length;e+=x}this._vertexBuffer.setData(s.buffer);this._indexBuffer.setData(n);var C=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;Et.Resource._addGPUMemory(C);this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.applyIndexBuffer(this._indexBuffer);this._bufferState.unBind()}_render(t){this._bufferState.bind();var e=Et.LayaGL.instance;var a=t.renderElement;var i=a.staticBatchElementList;var r=i.elements;var s=0;var n=0;var o=i.length;for(var l=1;l<o;l++){var _=r[l-1];if(_.staticBatchIndexEnd===r[l].staticBatchIndexStart){n++;continue}else{var h=r[s].staticBatchIndexStart;var x=r[n].staticBatchIndexEnd-h;e.drawElements(e.TRIANGLES,x,e.UNSIGNED_SHORT,h*2);s=++n;Et.Stat.trianglesFaces+=x/3}}h=r[s].staticBatchIndexStart;x=r[n].staticBatchIndexEnd-h;e.drawElements(e.TRIANGLES,x,e.UNSIGNED_SHORT,h*2);Et.Stat.renderBatches++;Et.Stat.savedRenderBatches+=o-1;Et.Stat.trianglesFaces+=x/3}dispose(){var t=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;Et.Resource._addGPUMemory(-t);this._batchElements=null;this.batchOwner=null;this._vertexDeclaration=null;this._bufferState.destroy();this._vertexBuffer.destroy();this._indexBuffer.destroy();this._vertexBuffer=null;this._indexBuffer=null;this._bufferState=null}}Xe._tempVector30=new St;Xe._tempVector31=new St;Xe._tempQuaternion0=new M;Xe._tempMatrix4x40=new k;Xe._tempMatrix4x41=new k;Xe._tempMatrix4x42=new k;Xe.maxBatchVertexCount=65535;Xe._batchIDCounter=0;class Ye extends We{constructor(){super();this._opaqueBatchMarks=[];this._updateCountMark=0}static __init__(){Ye._verDec=K.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT")}_compare(t,e){var a=t._render,i=e._render;var r=t.meshFilter.sharedMesh,s=e.meshFilter.sharedMesh;var n=a.lightmapIndex-i.lightmapIndex;if(n===0){var o=(a.receiveShadow?1:0)-(i.receiveShadow?1:0);if(o===0){var l=a.sharedMaterial&&i.sharedMaterial?a.sharedMaterial.id-i.sharedMaterial.id:0;if(l===0){var _=r._vertexBuffer.vertexDeclaration.id-s._vertexBuffer.vertexDeclaration.id;if(_===0){return s._indexBuffer.indexCount-r._indexBuffer.indexCount}else{return _}}else{return l}}else{return o}}else{return n}}_getBatchRenderElementFromPool(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];if(!t){t=new ze;this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t;t.staticBatchElementList=new e}return t}_getStaticBatch(t,e,a){var i=t[a];if(!i){i=t[a]=new Xe(e,Ye._verDec);this._staticBatches[i._batchID]=i}return i}_initStaticBatchs(t){var e=this._initBatchSprites;this._quickSort(e,0,e.length-1);var a=[];var i=false;var r;var s=0;for(var n=0,o=e.length;n<o;n++){var l=e[n];if(i){if(r.addTest(l)){r.add(l)}else{i=false;s++}}else{var _=o-1;if(n!==_){r=this._getStaticBatch(a,t,s);r.add(l);i=true}}}for(n=0,o=a.length;n<o;n++){var h=a[n];h&&h.finishInit()}this._initBatchSprites.length=0}_removeRenderSprite(t){var e=t._render;var a=e._staticBatch;var i=a._batchElements;var r=i.indexOf(t);if(r!==-1){i.splice(r,1);e._staticBatch=null;var s=e._renderElements;for(var n=0,o=s.length;n<o;n++)s[n].staticBatch=null}if(i.length===0){delete this._staticBatches[a._batchID];a.dispose()}}_clear(){super._clear();this._updateCountMark++}_garbageCollection(){for(var t in this._staticBatches){var e=this._staticBatches[t];if(e._batchElements.length===0){e.dispose();delete this._staticBatches[t]}}}getBatchOpaquaMark(t,e,a,i){var r=e?1:0;var s=this._opaqueBatchMarks[t]||(this._opaqueBatchMarks[t]=[]);var n=s[r]||(s[r]=[]);var o=n[a]||(n[a]=[]);return o[i]||(o[i]=new Ge)}}Ye.instance=new Ye;(function(t){t[t["off"]=0]="off";t[t["simple"]=1]="simple"})(H.ReflectionProbeMode||(H.ReflectionProbeMode={}));class je extends Bt{constructor(){super();this._boxProjection=false;this._size=new St;this._offset=new St;this._reflectionHDRParams=new bt;this._reflectionDecodeFormat=Et.TextureDecodeFormat.Normal;this._isScene=false}get boxProjection(){return this._boxProjection}set boxProjection(t){this._boxProjection=t}get importance(){return this._importance}set importance(t){this._importance=t}get intensity(){return this._intensity}set intensity(t){t=Math.max(Math.min(t,1),0);this._reflectionHDRParams.x=t;if(this._reflectionDecodeFormat==Et.TextureDecodeFormat.RGBM)this._reflectionHDRParams.x*=5;this._intensity=t}get reflectionTexture(){return this._reflectionTexture}set reflectionTexture(t){this._reflectionTexture=t;this._reflectionTexture._addReference()}get bounds(){return this._bounds}set bounds(t){this._bounds=t}get boundsMax(){return this._bounds.getMax()}get boundsMin(){return this._bounds.getMin()}get probePosition(){return this.transform.position}get reflectionHDRParams(){return this._reflectionHDRParams}set reflectionHDRParams(t){this._reflectionHDRParams=t}_parse(t,e){super._parse(t,e);this._boxProjection=t.boxProjection;this._importance=t.importance;this._reflectionTexture=Et.Loader.getRes(t.reflection);var a=this.transform.position;this._size.fromArray(t.boxSize);St.scale(this._size,.5,je.TEMPVECTOR3);this._offset.fromArray(t.boxOffset);var i=new St;var r=new St;St.add(a,je.TEMPVECTOR3,r);St.add(r,this._offset,r);St.subtract(a,je.TEMPVECTOR3,i);St.add(i,this._offset,i);this._reflectionDecodeFormat=t.reflectionDecodingFormat;this.intensity=t.intensity;if(!this._bounds)this.bounds=new Be(i,r);else{this._bounds.setMin(i);this._bounds.setMax(r)}}_setIndexInReflectionList(t){this._indexInReflectProbList=t}_getIndexInReflectionList(){return this._indexInReflectProbList}_onActive(){super._onActive();if(this._reflectionTexture)this.scene._reflectionProbeManager.add(this)}_onInActive(){super._onInActive();if(this.reflectionTexture)this.scene._reflectionProbeManager.remove(this)}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._reflectionTexture&&this._reflectionTexture._removeReference();this._reflectionTexture=null;this._bounds=null}_cloneTo(t,e,a){var i=t;i.bounds=this.bounds;i.boxProjection=this.boxProjection;i.importance=this.importance;i._size=this._size;i._offset=this._offset;i.intensity=this.intensity;i.reflectionHDRParams=this.reflectionHDRParams;super._cloneTo(t,e,a)}}je.TEMPVECTOR3=new St;je.defaultTextureHDRDecodeValues=new bt(1,1,0,0);class qe extends Et.EventDispatcher{constructor(t){super();this._lightmapScaleOffset=new bt(1,1,0,0);this._indexInList=-1;this._indexInCastShadowList=-1;this._boundsChange=true;this._castShadow=false;this._supportOctree=true;this._sharedMaterials=[];this._renderMark=-1;this._indexInOctreeMotionList=-1;this._reflectionMode=H.ReflectionProbeMode.simple;this._updateMark=-1;this._updateRenderType=-1;this._isPartOfStaticBatch=false;this._staticBatch=null;this._id=++qe._uniqueIDCounter;this._indexInCastShadowList=-1;this._bounds=new Be(St._ZERO,St._ZERO);this._renderElements=[];this._owner=t;this._enable=true;this._materialsInstance=[];this._shaderValues=new yt(null);this.lightmapIndex=-1;this.receiveShadow=false;this.sortingFudge=0;t&&this._owner.transform.on(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange)}get id(){return this._id}get lightmapIndex(){return this._lightmapIndex}set lightmapIndex(t){this._lightmapIndex=t}get lightmapScaleOffset(){return this._lightmapScaleOffset}set lightmapScaleOffset(t){if(!t)throw"BaseRender: lightmapScaleOffset can't be null.";this._lightmapScaleOffset=t;this._shaderValues.setVector(ke.LIGHTMAPSCALEOFFSET,t)}get enable(){return this._enable}set enable(t){this._enable=!!t}get material(){var t=this._sharedMaterials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0);var a=this._renderElements[0];a&&(a.material=e)}return this._sharedMaterials[0]}set material(t){this.sharedMaterial=t;this._isSupportReflection()}get materials(){for(var t=0,e=this._sharedMaterials.length;t<e;t++){if(!this._materialsInstance[t]){var a=this._getInstanceMaterial(this._sharedMaterials[t],t);var i=this._renderElements[t];i&&(i.material=a)}}return this._sharedMaterials.slice()}set materials(t){this.sharedMaterials=t;this._isSupportReflection()}get sharedMaterial(){return this._sharedMaterials[0]}set sharedMaterial(t){var e=this._sharedMaterials[0];if(e!==t){this._sharedMaterials[0]=t;this._materialsInstance[0]=false;this._changeMaterialReference(e,t);var a=this._renderElements[0];a&&(a.material=t)}this._isSupportReflection()}get sharedMaterials(){return this._sharedMaterials.slice()}set sharedMaterials(t){var e=this._materialsInstance;var a=this._sharedMaterials;for(var i=0,r=a.length;i<r;i++){var s=a[i];s&&s._removeReference()}if(t){var n=t.length;e.length=n;a.length=n;for(i=0;i<n;i++){s=a[i];var o=t[i];if(s!==o){e[i]=false;var l=this._renderElements[i];l&&(l.material=o)}if(o){o._addReference()}a[i]=o}}else{throw new Error("BaseRender: shadredMaterials value can't be null.")}this._isSupportReflection()}get bounds(){if(this._boundsChange){this._calculateBoundingBox();this._boundsChange=false}return this._bounds}set receiveShadow(t){if(this._receiveShadow!==t){this._receiveShadow=t;if(t)this._shaderValues.addDefine(ke.SHADERDEFINE_RECEIVE_SHADOW);else this._shaderValues.removeDefine(ke.SHADERDEFINE_RECEIVE_SHADOW)}}get receiveShadow(){return this._receiveShadow}get castShadow(){return this._castShadow}set castShadow(t){this._castShadow=t}get isPartOfStaticBatch(){return this._isPartOfStaticBatch}get isRender(){return this._renderMark==-1||this._renderMark==Et.Stat.loopCount-1}set reflectionMode(t){this._reflectionMode=t}get reflectionMode(){return this._reflectionMode}_getOctreeNode(){return this._octreeNode}_setOctreeNode(t){if(!t){this._indexInOctreeMotionList!==-1&&this._octreeNode._octree.removeMotionObject(this)}this._octreeNode=t}_getIndexInMotionList(){return this._indexInOctreeMotionList}_setIndexInMotionList(t){this._indexInOctreeMotionList=t}_changeMaterialReference(t,e){t&&t._removeReference();e._addReference()}_getInstanceMaterial(t,e){var a=t.clone();a.name=a.name+"(Instance)";this._materialsInstance[e]=true;this._changeMaterialReference(this._sharedMaterials[e],a);this._sharedMaterials[e]=a;return a}_isSupportReflection(){this._surportReflectionProbe=false;var t=this._sharedMaterials;for(var e=0,a=t.length;e<a;e++){var i=t[e];this._surportReflectionProbe=this._surportReflectionProbe||i&&i._shader._supportReflectionProbe}}_addReflectionProbeUpdate(){if(this._surportReflectionProbe&&this._reflectionMode==1){this._scene._reflectionProbeManager.addMotionObject(this)}}_applyLightMapParams(){var t=this._scene.lightmaps;var e=this._shaderValues;var a=this._lightmapIndex;if(a>=0&&a<t.length){var i=t[a];e.setTexture(ke.LIGHTMAP,i.lightmapColor);e.addDefine(ke.SAHDERDEFINE_LIGHTMAP);if(i.lightmapDirection){e.setTexture(ke.LIGHTMAP_DIRECTION,i.lightmapDirection);e.addDefine(ke.SHADERDEFINE_LIGHTMAP_DIRECTIONAL)}else{e.removeDefine(ke.SHADERDEFINE_LIGHTMAP_DIRECTIONAL)}}else{e.removeDefine(ke.SAHDERDEFINE_LIGHTMAP);e.removeDefine(ke.SHADERDEFINE_LIGHTMAP_DIRECTIONAL)}}_onWorldMatNeedChange(t){this._boundsChange=true;if(this._octreeNode){t&=d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDSCALE;if(t){if(this._indexInOctreeMotionList===-1)this._octreeNode._octree.addMotionObject(this)}}this._addReflectionProbeUpdate()}_calculateBoundingBox(){throw"BaseRender: must override it."}_getIndexInList(){return this._indexInList}_setIndexInList(t){this._indexInList=t}_setBelongScene(t){this._scene=t}_needRender(t,e){return true}_renderUpdate(t,e){}_renderUpdateWithCamera(t,e){}_revertBatchRenderUpdate(t){}_destroy(){this._indexInOctreeMotionList!==-1&&this._octreeNode._octree.removeMotionObject(this);this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t].destroy();for(t=0,e=this._sharedMaterials.length;t<e;t++)this._sharedMaterials[t].destroyed||this._sharedMaterials[t]._removeReference();this._renderElements=null;this._owner=null;this._sharedMaterials=null;this._bounds=null;this._lightmapScaleOffset=null}markAsUnStatic(){if(this._isPartOfStaticBatch){Ye.instance._removeRenderSprite(this._owner);this._isPartOfStaticBatch=false}}}qe._tempBoundBoxCorners=[new St,new St,new St,new St,new St,new St,new St,new St];qe._uniqueIDCounter=0;qe._defaultLightmapScaleOffset=new bt(1,1,0,0);class Ze extends qe{constructor(t){super(t);this._projectionViewWorldMatrix=new k}_calculateBoundingBox(){var t=this._owner.transform.worldMatrix;var e=this._owner._geometryFilter;e._reCalculateBound();e._bounds._tranform(t,this._bounds)}_renderUpdateWithCamera(t,e){var a=t.projectionViewMatrix;var i=this._shaderValues;if(e){var r=e.worldMatrix;i.setMatrix4x4(Bt.WORLDMATRIX,r);k.multiply(a,r,this._projectionViewWorldMatrix);i.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}else{i.setMatrix4x4(Bt.WORLDMATRIX,k.DEFAULT);i.setMatrix4x4(Bt.MVPMATRIX,a)}}}class Ke extends ke{constructor(t=2,e=null){super(e);this._isRenderActive=false;this._isInRenders=false;this._geometryFilter=new Ue(this,t);this._render=new Ze(this);this._changeRenderObjects(this._render,0,Oe.defaultMaterial)}get maxLineCount(){return this._geometryFilter._maxLineCount}set maxLineCount(t){this._geometryFilter._resizeLineData(t);this._geometryFilter._lineCount=Math.min(this._geometryFilter._lineCount,t)}get lineCount(){return this._geometryFilter._lineCount}set lineCount(t){if(t>this.maxLineCount)throw"PixelLineSprite3D: lineCount can't large than maxLineCount";else this._geometryFilter._lineCount=t}get pixelLineRenderer(){return this._render}_onInActive(){Et.Stat.spriteCount--;if(this._geometryFilter._lineCount!=0&&this._isRenderActive){this._scene._removeRenderObject(this._render);this._isInRenders=false}this._isRenderActive=false}_onActive(){Et.Stat.spriteCount++;this._isRenderActive=true;if(this._geometryFilter._lineCount!=0){this._scene._addRenderObject(this._render);this._isInRenders=true}}_changeRenderObjects(t,e,a){var i=this._render._renderElements;a||(a=Oe.defaultMaterial);var r=i[e];r||(r=i[e]=new ie);r.setTransform(this._transform);r.setGeometry(this._geometryFilter);r.render=this._render;r.material=a}addLine(t,e,a,i){if(this._geometryFilter._lineCount!==this._geometryFilter._maxLineCount)this._geometryFilter._updateLineData(this._geometryFilter._lineCount++,t,e,a,i);else throw"PixelLineSprite3D: lineCount has equal with maxLineCount.";if(this._isRenderActive&&!this._isInRenders&&this._geometryFilter._lineCount>0){this._scene._addRenderObject(this._render);this._isInRenders=true}}addLines(t){var e=this._geometryFilter._lineCount;var a=t.length;if(e+a>this._geometryFilter._maxLineCount){throw"PixelLineSprite3D: lineCount plus lines count must less than maxLineCount."}else{this._geometryFilter._updateLineDatas(e,t);this._geometryFilter._lineCount+=a}if(this._isRenderActive&&!this._isInRenders&&this._geometryFilter._lineCount>0){this._scene._addRenderObject(this._render);this._isInRenders=true}}removeLine(t){if(t<this._geometryFilter._lineCount)this._geometryFilter._removeLineData(t);else throw"PixelLineSprite3D: index must less than lineCount.";if(this._isRenderActive&&this._isInRenders&&this._geometryFilter._lineCount==0){this._scene._removeRenderObject(this._render);this._isInRenders=false}}setLine(t,e,a,i,r){if(t<this._geometryFilter._lineCount)this._geometryFilter._updateLineData(t,e,a,i,r);else throw"PixelLineSprite3D: index must less than lineCount."}getLine(t,e){if(t<this.lineCount)this._geometryFilter._getLineData(t,e);else throw"PixelLineSprite3D: index must less than lineCount."}clear(){this._geometryFilter._lineCount=0;if(this._isRenderActive&&this._isInRenders){this._scene._removeRenderObject(this._render);this._isInRenders=false}}_create(){return new Ke}}class Qe{constructor(t=false){this.isTransparent=false;this.elements=new e;this.lastTransparentRenderElement=null;this.lastTransparentBatched=false;this.isTransparent=t}_compare(t,e){var a=t.material.renderQueue-e.material.renderQueue;if(a===0){var i=this.isTransparent?e.render._distanceForSort-t.render._distanceForSort:t.render._distanceForSort-e.render._distanceForSort;return i+e.render.sortingFudge-t.render.sortingFudge}else{return a}}_partitionRenderObject(t,e){var a=this.elements.elements;var i=a[Math.floor((e+t)/2)];while(t<=e){while(this._compare(a[t],i)<0)t++;while(this._compare(a[e],i)>0)e--;if(t<e){var r=a[t];a[t]=a[e];a[e]=r;t++;e--}else if(t===e){t++;break}}return t}_quickSort(t,e){if(this.elements.length>1){var a=this._partitionRenderObject(t,e);var i=a-1;if(t<i)this._quickSort(t,i);if(a<e)this._quickSort(a,e)}}_render(t){var e=this.elements.elements;for(var a=0,i=this.elements.length;a<i;a++)e[a]._render(t)}clear(){this.elements.length=0;this.lastTransparentRenderElement=null;this.lastTransparentBatched=false}}class Je{constructor(t,e,a,i){this._bounds=new Ne(new St,new St);this._objects=[];this._isContaion=false;this.center=new St;this.baseLength=0;this._setValues(t,e,a,i)}static _encapsulates(t,e){return W.boxContainsBox(t,e)==zt.Contains}_setValues(t,e,a,i){this._octree=t;this._parent=e;this.baseLength=a;i.cloneTo(this.center);var r=this._bounds.min;var s=this._bounds.max;var n=t._looseness*a/2;r.setValue(i.x-n,i.y-n,i.z-n);s.setValue(i.x+n,i.y+n,i.z+n)}_getChildBound(t){if(this._children!=null&&this._children[t]){return this._children[t]._bounds}else{var e=this.baseLength/4;var a=this.baseLength/2*this._octree._looseness/2;var i=Je._tempBoundBox;var r=i.min;var s=i.max;switch(t){case 0:r.x=this.center.x-e-a;r.y=this.center.y+e-a;r.z=this.center.z-e-a;s.x=this.center.x-e+a;s.y=this.center.y+e+a;s.z=this.center.z-e+a;break;case 1:r.x=this.center.x+e-a;r.y=this.center.y+e-a;r.z=this.center.z-e-a;s.x=this.center.x+e+a;s.y=this.center.y+e+a;s.z=this.center.z-e+a;break;case 2:r.x=this.center.x-e-a;r.y=this.center.y+e-a;r.z=this.center.z+e-a;s.x=this.center.x-e+a;s.y=this.center.y+e+a;s.z=this.center.z+e+a;break;case 3:r.x=this.center.x+e-a;r.y=this.center.y+e-a;r.z=this.center.z+e-a;s.x=this.center.x+e+a;s.y=this.center.y+e+a;s.z=this.center.z+e+a;break;case 4:r.x=this.center.x-e-a;r.y=this.center.y-e-a;r.z=this.center.z-e-a;s.x=this.center.x-e+a;s.y=this.center.y-e+a;s.z=this.center.z-e+a;break;case 5:r.x=this.center.x+e-a;r.y=this.center.y-e-a;r.z=this.center.z-e-a;s.x=this.center.x+e+a;s.y=this.center.y-e+a;s.z=this.center.z-e+a;break;case 6:r.x=this.center.x-e-a;r.y=this.center.y-e-a;r.z=this.center.z+e-a;s.x=this.center.x-e+a;s.y=this.center.y-e+a;s.z=this.center.z+e+a;break;case 7:r.x=this.center.x+e-a;r.y=this.center.y-e-a;r.z=this.center.z+e-a;s.x=this.center.x+e+a;s.y=this.center.y-e+a;s.z=this.center.z+e+a;break;default:}return i}}_getChildCenter(t){if(this._children!=null){return this._children[t].center}else{var e=this.baseLength/4;var a=Je._tempVector30;switch(t){case 0:a.x=this.center.x-e;a.y=this.center.y+e;a.z=this.center.z-e;break;case 1:a.x=this.center.x+e;a.y=this.center.y+e;a.z=this.center.z-e;break;case 2:a.x=this.center.x-e;a.y=this.center.y+e;a.z=this.center.z+e;break;case 3:a.x=this.center.x+e;a.y=this.center.y+e;a.z=this.center.z+e;break;case 4:a.x=this.center.x-e;a.y=this.center.y-e;a.z=this.center.z-e;break;case 5:a.x=this.center.x+e;a.y=this.center.y-e;a.z=this.center.z-e;break;case 6:a.x=this.center.x-e;a.y=this.center.y-e;a.z=this.center.z+e;break;case 7:a.x=this.center.x+e;a.y=this.center.y-e;a.z=this.center.z+e;break;default:}return a}}_getChild(t){var e=this.baseLength/4;this._children||(this._children=[]);switch(t){case 0:return this._children[0]||(this._children[0]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x+-e,this.center.y+e,this.center.z-e)));case 1:return this._children[1]||(this._children[1]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x+e,this.center.y+e,this.center.z-e)));case 2:return this._children[2]||(this._children[2]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x-e,this.center.y+e,this.center.z+e)));case 3:return this._children[3]||(this._children[3]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x+e,this.center.y+e,this.center.z+e)));case 4:return this._children[4]||(this._children[4]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x-e,this.center.y-e,this.center.z-e)));case 5:return this._children[5]||(this._children[5]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x+e,this.center.y-e,this.center.z-e)));case 6:return this._children[6]||(this._children[6]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x-e,this.center.y-e,this.center.z+e)));case 7:return this._children[7]||(this._children[7]=new Je(this._octree,this,this.baseLength/2,new St(this.center.x+e,this.center.y-e,this.center.z+e)));default:throw"BoundsOctreeNode: unknown index."}}_shouldMerge(){var t=this._objects.length;for(var e=0;e<8;e++){var a=this._children[e];if(a){if(a._children!=null)return false;t+=a._objects.length}}return t<=Je._NUM_OBJECTS_ALLOWED}_mergeChildren(){for(var t=0;t<8;t++){var e=this._children[t];if(e){e._parent=null;var a=e._objects;for(var i=a.length-1;i>=0;i--){var r=a[i];this._objects.push(r);r._setOctreeNode(this)}}}this._children=null}_merge(){if(this._children===null){var t=this._parent;if(t&&t._shouldMerge()){t._mergeChildren();t._merge()}}}_checkAddNode(t){if(this._children==null){if(this._objects.length<Je._NUM_OBJECTS_ALLOWED||this.baseLength/2<this._octree._minSize){return this}for(var e=this._objects.length-1;e>=0;e--){var a=this._objects[e];var i=this._bestFitChild(a.bounds.getCenter());if(Je._encapsulates(this._getChildBound(i),a.bounds._getBoundBox())){this._objects.splice(this._objects.indexOf(a),1);this._getChild(i)._add(a)}}}var r=this._bestFitChild(t.bounds.getCenter());if(Je._encapsulates(this._getChildBound(r),t.bounds._getBoundBox()))return this._getChild(r)._checkAddNode(t);else return this}_add(t){var e=this._checkAddNode(t);e._objects.push(t);t._setOctreeNode(e)}_remove(t){var e=this._objects.indexOf(t);this._objects.splice(e,1);t._setOctreeNode(null);this._merge()}_addUp(t){if(W.boxContainsBox(this._bounds,t.bounds._getBoundBox())===zt.Contains){this._add(t);return true}else{if(this._parent)return this._parent._addUp(t);else return false}}_getCollidingWithFrustum(t,e,a,i,r,s){var n=t.boundFrustum;var o=t.position;var l=t.cullingMask;if(a){var _=n.containsBoundBox(this._bounds);Et.Stat.octreeNodeCulling++;if(_===zt.Disjoint)return;a=_===zt.Intersects}this._isContaion=!a;var h=e.scene;var x=Et.Stat.loopCount;for(var c=0,d=this._objects.length;c<d;c++){var u=this._objects[c];var f;if(s)f=u._castShadow&&u._enable;else f=(Math.pow(2,u._owner._layer)&l)!=0&&u._enable;if(f){if(a){Et.Stat.frustumCulling++;if(!u._needRender(n,e))continue}u._renderMark=x;u._distanceForSort=St.distance(u.bounds.getCenter(),o);var p=u._renderElements;for(var m=0,g=p.length;m<g;m++){var v=p[m];v._update(h,e,i,r)}}}if(this._children!=null){for(c=0;c<8;c++){var y=this._children[c];y&&y._getCollidingWithFrustum(t,e,a,i,r,s)}}}_getCollidingWithBoundBox(t,e,a){if(e){var i=W.boxContainsBox(this._bounds,t);if(i===zt.Disjoint)return;e=i===zt.Intersects}if(e){for(var r=0,s=this._objects.length;r<s;r++){var n=this._objects[r];if(W.intersectsBoxAndBox(n.bounds._getBoundBox(),t)){a.push(n)}}}if(this._children!=null){for(r=0;r<8;r++){var o=this._children[r];o._getCollidingWithBoundBox(t,e,a)}}}_bestFitChild(t){return(t.x<=this.center.x?0:1)+(t.y>=this.center.y?0:4)+(t.z<=this.center.z?0:2)}_update(t){if(W.boxContainsBox(this._bounds,t.bounds._getBoundBox())===zt.Contains){var e=this._checkAddNode(t);if(e!==t._getOctreeNode()){e._objects.push(t);t._setOctreeNode(e);var a=this._objects.indexOf(t);this._objects.splice(a,1);this._merge()}return true}else{if(this._parent){var i=this._parent._addUp(t);if(i){a=this._objects.indexOf(t);this._objects.splice(a,1);this._merge()}return i}else{return false}}}add(t){if(!Je._encapsulates(this._bounds,t.bounds._getBoundBox()))return false;this._add(t);return true}remove(t){if(t._getOctreeNode()!==this)return false;this._remove(t);return true}update(t){if(t._getOctreeNode()!==this)return false;return this._update(t)}shrinkIfPossible(t){if(this.baseLength<t*2)return this;var e=-1;for(var a=0,i=this._objects.length;a<i;a++){var r=this._objects[a];var s=this._bestFitChild(r.bounds.getCenter());if(a==0||s==e){var n=this._getChildBound(s);if(Je._encapsulates(n,r.bounds._getBoundBox()))a==0&&(e=s);else return this}else{return this}}if(this._children!=null){var o=false;for(a=0,i=this._children.length;a<i;a++){var l=this._children[a];if(l&&l.hasAnyObjects()){if(o)return this;if(e>=0&&e!=a)return this;o=true;e=a}}}else{if(e!=-1){var _=this._getChildCenter(e);this._setValues(this._octree,null,this.baseLength/2,_)}return this}if(e!=-1){var h=this._children[e];h._parent=null;return h}else{return this}}hasAnyObjects(){if(this._objects.length>0)return true;if(this._children!=null){for(var t=0;t<8;t++){var e=this._children[t];if(e&&e.hasAnyObjects())return true}}return false}getCollidingWithBoundBox(t,e){this._getCollidingWithBoundBox(t,true,e)}getCollidingWithRay(t,e,a=Number.MAX_VALUE){var i=W.intersectsRayAndBoxRD(t,this._bounds);if(i==-1||i>a)return;for(var r=0,s=this._objects.length;r<s;r++){var n=this._objects[r];i=W.intersectsRayAndBoxRD(t,n.bounds._getBoundBox());if(i!==-1&&i<=a)e.push(n)}if(this._children!=null){for(r=0;r<8;r++){var o=this._children[r];o.getCollidingWithRay(t,e,a)}}}getCollidingWithFrustum(t,e,a,i,r){this._getCollidingWithFrustum(t,e,true,a,i,r)}isCollidingWithBoundBox(t){if(!W.intersectsBoxAndBox(this._bounds,t))return false;for(var e=0,a=this._objects.length;e<a;e++){var i=this._objects[e];if(W.intersectsBoxAndBox(i.bounds._getBoundBox(),t))return true}if(this._children!=null){for(e=0;e<8;e++){var r=this._children[e];if(r.isCollidingWithBoundBox(t))return true}}return false}isCollidingWithRay(t,e=Number.MAX_VALUE){var a=W.intersectsRayAndBoxRD(t,this._bounds);if(a==-1||a>e)return false;for(var i=0,r=this._objects.length;i<r;i++){var s=this._objects[i];a=W.intersectsRayAndBoxRD(t,s.bounds._getBoundBox());if(a!==-1&&a<=e)return true}if(this._children!=null){for(i=0;i<8;i++){var n=this._children[i];if(n.isCollidingWithRay(t,e))return true}}return false}getBound(){return this._bounds}drawAllBounds(t,e,a){if(this._children===null&&this._objects.length==0)return;e++;var i=Je._tempColor0;if(this._isContaion){i.r=0;i.g=0;i.b=1}else{var r=a?e/a:0;i.r=1-r;i.g=r;i.b=0}i.a=.3;F._drawBound(t,this._bounds,i);if(this._children!=null){for(var s=0;s<8;s++){var n=this._children[s];n&&n.drawAllBounds(t,e,a)}}}drawAllObjects(t,e,a){e++;var i=Je._tempColor0;if(this._isContaion){i.r=0;i.g=0;i.b=1}else{var r=a?e/a:0;i.r=1-r;i.g=r;i.b=0}i.a=1;for(var s=0,n=this._objects.length;s<n;s++)F._drawBound(t,this._objects[s].bounds._getBoundBox(),i);if(this._children!=null){for(s=0;s<8;s++){var o=this._children[s];o&&o.drawAllObjects(t,e,a)}}}}Je._tempVector3=new St;Je._tempVector30=new St;Je._tempVector31=new St;Je._tempColor0=new ye;Je._tempBoundBox=new Ne(new St,new St);Je._NUM_OBJECTS_ALLOWED=8;class $e extends e{constructor(){super()}add(t){var e=t._getIndexInMotionList();if(e!==-1)throw"OctreeMotionList:element has  in  PhysicsUpdateList.";this._add(t);t._setIndexInMotionList(this.length++)}remove(t){var e=t._getIndexInMotionList();this.length--;if(e!==this.length){var a=this.elements[this.length];this.elements[e]=a;a._setIndexInMotionList(e)}t._setIndexInMotionList(-1)}}class ta{constructor(t,e,a,i){this._motionObjects=new $e;this.count=0;if(a>t){console.warn("Minimum node size must be at least as big as the initial world size. Was: "+a+" Adjusted to: "+t);a=t}this._initialSize=t;this._minSize=a;this._looseness=Math.min(Math.max(i,1),2);this._rootNode=new Je(this,null,t,e)}_getMaxDepth(t,e){e++;var a=t._children;if(a!=null){var i=e;for(var r=0,s=a.length;r<s;r++){var n=a[r];n&&(e=Math.max(this._getMaxDepth(n,i),e))}}return e}_grow(t){var e=t.x>=0?1:-1;var a=t.y>=0?1:-1;var i=t.z>=0?1:-1;var r=this._rootNode;var s=this._rootNode.baseLength/2;var n=this._rootNode.baseLength*2;var o=this._rootNode.center;var l=new St(o.x+e*s,o.y+a*s,o.z+i*s);this._rootNode=new Je(this,null,n,l);if(r.hasAnyObjects()){var _=this._rootNode._bestFitChild(r.center);var h=[];for(var x=0;x<8;x++){if(x==_){r._parent=this._rootNode;h[x]=r}}this._rootNode._children=h}}add(t){var e=0;while(!this._rootNode.add(t)){var a=ta._tempVector30;St.subtract(t.bounds.getCenter(),this._rootNode.center,a);this._grow(a);if(++e>20){throw"Aborted Add operation as it seemed to be going on forever ("+(e-1)+") attempts at growing the octree."}}this.count++}remove(t){var e=t._getOctreeNode().remove(t);if(e){this.count--}return e}update(t){var e=0;var a=t._getOctreeNode();if(a){while(!a._update(t)){var i=ta._tempVector30;St.subtract(t.bounds.getCenter(),this._rootNode.center,i);this._grow(i);if(++e>20){throw"Aborted Add operation as it seemed to be going on forever ("+(e-1)+") attempts at growing the octree."}}return true}else{return false}}shrinkRootIfPossible(){this._rootNode=this._rootNode.shrinkIfPossible(this._initialSize)}addMotionObject(t){this._motionObjects.add(t)}removeMotionObject(t){this._motionObjects.remove(t)}updateMotionObjects(){var t=this._motionObjects.elements;for(var e=0,a=this._motionObjects.length;e<a;e++){var i=t[e];this.update(i);i._setIndexInMotionList(-1)}this._motionObjects.length=0}isCollidingWithBoundBox(t){return this._rootNode.isCollidingWithBoundBox(t)}isCollidingWithRay(t,e=Number.MAX_VALUE){return this._rootNode.isCollidingWithRay(t,e)}getCollidingWithBoundBox(t,e){this._rootNode.getCollidingWithBoundBox(t,e)}getCollidingWithRay(t,e,a=Number.MAX_VALUE){this._rootNode.getCollidingWithRay(t,e,a)}getCollidingWithFrustum(t,e,a,i,r){this._rootNode.getCollidingWithFrustum(t,e,a,i,r)}getMaxBounds(){return this._rootNode.getBound()}drawAllBounds(t){var e=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllBounds(t,-1,e)}drawAllObjects(t){var e=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllObjects(t,-1,e)}}ta._tempVector30=new St;class ea{}class aa{constructor(t,e){this.center=t;this.radius=e}toDefault(){this.center.toDefault();this.radius=0}static createFromSubPoints(t,e,a,i){if(t==null){throw new Error("points")}if(e<0||e>=t.length){throw new Error("start"+e+"Must be in the range [0, "+(t.length-1)+"]")}if(a<0||e+a>t.length){throw new Error("count"+a+"Must be in the range <= "+t.length+"}")}var r=e+a;var s=aa._tempVector3;s.x=0;s.y=0;s.z=0;for(var n=e;n<r;++n){St.add(t[n],s,s)}var o=i.center;St.scale(s,1/a,o);var l=0;for(n=e;n<r;++n){var _=St.distanceSquared(o,t[n]);if(_>l)l=_}i.radius=Math.sqrt(l)}static createfromPoints(t,e){if(t==null){throw new Error("points")}aa.createFromSubPoints(t,0,t.length,e)}intersectsRayDistance(t){return W.intersectsRayAndSphereRD(t,this)}intersectsRayPoint(t,e){return W.intersectsRayAndSphereRP(t,this,e)}cloneTo(t){var e=t;this.center.cloneTo(e.center);e.radius=this.radius}clone(){var t=new aa(new St,0);this.cloneTo(t);return t}}aa._tempVector3=new St;class ia{constructor(){this.cameraShaderValue=new yt;this.position=new St;this.viewMatrix=new k;this.projectionMatrix=new k;this.viewProjectMatrix=new k;this.cullPlanes=[new O(new St),new O(new St),new O(new St),new O(new St),new O(new St),new O(new St),new O(new St),new O(new St),new O(new St),new O(new St)];this.splitBoundSphere=new aa(new St,0)}}class ra{constructor(){this.cameraShaderValue=new yt;this.position=new St;this.viewMatrix=new k;this.projectionMatrix=new k;this.viewProjectMatrix=new k;this.cameraCullInfo=new Te}}(function(t){t[t["DirectionLight"]=0]="DirectionLight";t[t["SpotLight"]=1]="SpotLight";t[t["PointLight"]=2]="PointLight"})(H.ShadowLightType||(H.ShadowLightType={}));class sa{constructor(){this._shadowBias=new bt;this._shadowParams=new bt;this._shadowMapSize=new bt;this._shadowMatrices=new Float32Array(16*sa._maxCascades);this._shadowSpotMatrices=new k;this._splitBoundSpheres=new Float32Array(sa._maxCascades*4);this._cascadeCount=0;this._shadowMapWidth=0;this._shadowMapHeight=0;this._shadowSliceDatas=[new ia,new ia,new ia,new ia];this._shadowSpotData=new ra;this._lightUp=new St;this._lightSide=new St;this._lightForward=new St;this._shadowSpotData.cameraCullInfo.boundFrustum=new Wt(new k)}_setupShadowCasterShaderValues(t,e,a,i,r,s,n){e.setVector(sa.SHADOW_BIAS,s);switch(n){case H.LightType.Directional:e.setVector3(sa.SHADOW_LIGHT_DIRECTION,i);break;case H.LightType.Spot:e.setVector(sa.SHADOW_PARAMS,r);break;case H.LightType.Point:break}var o=a.cameraShaderValue;o.setMatrix4x4(Qt.VIEWMATRIX,a.viewMatrix);o.setMatrix4x4(Qt.PROJECTMATRIX,a.projectionMatrix);o.setMatrix4x4(Qt.VIEWPROJECTMATRIX,a.viewProjectMatrix);t.viewMatrix=a.viewMatrix;t.projectionMatrix=a.projectionMatrix;t.projectionViewMatrix=a.viewProjectMatrix}_setupShadowReceiverShaderValues(t){var e=this._light;if(e.shadowCascadesMode!==H.ShadowCascadesMode.NoCascades)t.addDefine(Jt.SHADERDEFINE_SHADOW_CASCADE);else t.removeDefine(Jt.SHADERDEFINE_SHADOW_CASCADE);switch(e.shadowMode){case H.ShadowMode.Hard:t.removeDefine(Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);t.removeDefine(Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);break;case H.ShadowMode.SoftLow:t.addDefine(Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);t.removeDefine(Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);break;case H.ShadowMode.SoftHigh:t.addDefine(Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);t.removeDefine(Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);break}t.setTexture(sa.SHADOW_MAP,this._shadowDirectLightMap);t.setBuffer(sa.SHADOW_MATRICES,this._shadowMatrices);t.setVector(sa.SHADOW_MAP_SIZE,this._shadowMapSize);t.setVector(sa.SHADOW_PARAMS,this._shadowParams);t.setBuffer(sa.SHADOW_SPLIT_SPHERES,this._splitBoundSpheres)}_setupSpotShadowReceiverShaderValues(t){var e=this._light;switch(e.shadowMode){case H.ShadowMode.Hard:t.removeDefine(Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);t.removeDefine(Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);break;case H.ShadowMode.SoftLow:t.addDefine(Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);t.removeDefine(Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);break;case H.ShadowMode.SoftHigh:t.addDefine(Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);t.removeDefine(Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);break}t.setTexture(sa.SHADOW_SPOTMAP,this._shadowSpotLightMap);t.setMatrix4x4(sa.SHADOW_SPOTMATRICES,this._shadowSpotMatrices);t.setVector(sa.SHADOW_MAP_SIZE,this._shadowMapSize);t.setVector(sa.SHADOW_PARAMS,this._shadowParams)}update(t,e,a){switch(a){case H.ShadowLightType.DirectionLight:this._light=e;var i=sa._tempMatrix0;var r=i.elements;var s=this._lightUp;var n=this._lightSide;var o=this._lightForward;k.createFromQuaternion(e._transform.rotation,i);n.setValue(r[0],r[1],r[2]);s.setValue(r[4],r[5],r[6]);o.setValue(-r[8],-r[9],-r[10]);var l=e._shadowResolution;var _=e._shadowCascadesMode;var h;var x;var c,d;if(_==H.ShadowCascadesMode.NoCascades){h=1;x=l;c=l;d=l}else{h=_==H.ShadowCascadesMode.TwoCascades?2:4;x=ee.getMaxTileResolutionInAtlas(l,l,h);c=x*2;d=_==H.ShadowCascadesMode.TwoCascades?x:x*2}this._cascadeCount=h;this._shadowMapWidth=c;this._shadowMapHeight=d;var u=sa._cascadesSplitDistance;var f=sa._frustumPlanes;var p=t.nearPlane;var m=Math.min(t.farPlane,e._shadowDistance);var g=this._shadowMatrices;var v=this._splitBoundSpheres;ee.getCascadesSplitDistance(e._shadowTwoCascadeSplits,e._shadowFourCascadeSplits,p,m,t.fieldOfView*z.Deg2Rad,t.aspectRatio,_,u);ee.getCameraFrustumPlanes(t.projectionViewMatrix,f);var y=sa._tempVector30;t._transform.getForward(y);St.normalize(y,y);for(var T=0;T<h;T++){var E=this._shadowSliceDatas[T];E.sphereCenterZ=ee.getBoundSphereByFrustum(u[T],u[T+1],t.fieldOfView*z.Deg2Rad,t.aspectRatio,t._transform.position,y,E.splitBoundSphere);ee.getDirectionLightShadowCullPlanes(f,T,u,p,o,E);ee.getDirectionalLightMatrices(s,n,o,T,e._shadowNearPlane,x,E,g);if(h>1)ee.applySliceTransform(E,c,d,T,g)}ee.prepareShadowReceiverShaderValues(e,c,d,this._shadowSliceDatas,h,this._shadowMapSize,this._shadowParams,g,v);break;case H.ShadowLightType.SpotLight:this._light=e;var i=sa._tempMatrix0;var o=this._lightForward;var b=this._light._shadowResolution;this._shadowMapWidth=b;this._shadowMapHeight=b;var S=this._shadowSpotData;ee.getSpotLightShadowData(S,this._light,b,this._shadowParams,this._shadowSpotMatrices,this._shadowMapSize);break;case H.ShadowLightType.PointLight:break;default:throw"There is no shadow of this type";break}}render(t,e,a){switch(a){case H.ShadowLightType.DirectionLight:var i=e._shaderValues;t.pipelineMode="ShadowCaster";yt.setRuntimeValueMode(false);var r=this._shadowDirectLightMap=ee.getTemporaryShadowTexture(this._shadowMapWidth,this._shadowMapHeight,Et.RenderTextureDepthFormat.DEPTH_16);r._start();var s=this._light;for(var n=0,o=this._cascadeCount;n<o;n++){var l=this._shadowSliceDatas[n];ee.getShadowBias(s,l.projectionMatrix,l.resolution,this._shadowBias);this._setupShadowCasterShaderValues(t,i,l,this._lightForward,this._shadowParams,this._shadowBias,H.LightType.Directional);var _=be._shadowCullInfo;_.position=l.position;_.cullPlanes=l.cullPlanes;_.cullPlaneCount=l.cullPlaneCount;_.cullSphere=l.splitBoundSphere;_.direction=this._lightForward;var h=be.cullingShadow(_,e,t);t.cameraShaderValue=l.cameraShaderValue;ae._updateMark++;var x=Et.LayaGL.instance;var c=l.resolution;var d=l.offsetX;var u=l.offsetY;x.enable(x.SCISSOR_TEST);x.viewport(d,u,c,c);x.scissor(d,u,c,c);x.clear(x.DEPTH_BUFFER_BIT);if(h){x.scissor(d+1,u+1,c-2,c-2);e._opaqueQueue._render(t)}}r._end();this._setupShadowReceiverShaderValues(i);yt.setRuntimeValueMode(true);t.pipelineMode="Forward";break;case H.ShadowLightType.SpotLight:var i=e._shaderValues;t.pipelineMode="ShadowCaster";yt.setRuntimeValueMode(false);var f=this._light;var r=this._shadowSpotLightMap=ee.getTemporaryShadowTexture(this._shadowMapWidth,this._shadowMapHeight,Et.RenderTextureDepthFormat.DEPTH_16);r._start();var p=this._shadowSpotData;ee.getShadowBias(f,p.projectionMatrix,p.resolution,this._shadowBias);this._setupShadowCasterShaderValues(t,i,p,this._light.transform.position,this._shadowParams,this._shadowBias,H.LightType.Spot);var h=be.cullingSpotShadow(p.cameraCullInfo,e,t);t.cameraShaderValue=p.cameraShaderValue;ae._updateMark++;var x=Et.LayaGL.instance;x.enable(x.SCISSOR_TEST);x.viewport(p.offsetX,p.offsetY,p.resolution,p.resolution);x.scissor(p.offsetX,p.offsetY,p.resolution,p.resolution);x.clear(x.DEPTH_BUFFER_BIT);if(h){x.scissor(p.offsetX,p.offsetY,p.resolution,p.resolution);e._opaqueQueue._render(t)}r._end();this._setupSpotShadowReceiverShaderValues(i);yt.setRuntimeValueMode(true);t.pipelineMode="Forward";break;case H.ShadowLightType.PointLight:break;default:throw"There is no shadow of this type";break}}cleanUp(){this._shadowDirectLightMap&&mt.recoverToPool(this._shadowDirectLightMap);this._shadowSpotLightMap&&mt.recoverToPool(this._shadowSpotLightMap);this._shadowDirectLightMap=null;this._shadowSpotLightMap=null;this._light=null}}sa._tempVector30=new St;sa._tempMatrix0=new k;sa.SHADOW_BIAS=P.propertyNameToID("u_ShadowBias");sa.SHADOW_LIGHT_DIRECTION=P.propertyNameToID("u_ShadowLightDirection");sa.SHADOW_SPLIT_SPHERES=P.propertyNameToID("u_ShadowSplitSpheres");sa.SHADOW_MATRICES=P.propertyNameToID("u_ShadowMatrices");sa.SHADOW_MAP_SIZE=P.propertyNameToID("u_ShadowMapSize");sa.SHADOW_MAP=P.propertyNameToID("u_ShadowMap");sa.SHADOW_PARAMS=P.propertyNameToID("u_ShadowParams");sa.SHADOW_SPOTMAP=P.propertyNameToID("u_SpotShadowMap");sa.SHADOW_SPOTMATRICES=P.propertyNameToID("u_SpotViewProjectMatrix");sa._maxCascades=4;sa._cascadesSplitDistance=new Array(sa._maxCascades+1);sa._frustumPlanes=new Array(new O(new St),new O(new St),new O(new St),new O(new St),new O(new St),new O(new St));class na{constructor(){this._batchRenderElementPool=[]}static _registerManager(t){na._managers.push(t)}_clear(){this._batchRenderElementPoolIndex=0}_getBatchRenderElementFromPool(){throw"StaticBatch:must override this function."}dispose(){}}na._managers=[];class oa extends e{constructor(){super()}add(t){this._add(t);t._setIndexInReflectionList(this.length++)}remove(t){var e=t._getIndexInReflectionList();this.length--;if(e!==this.length){var a=this.elements[this.length];this.elements[e]=a;a._setIndexInReflectionList(e)}t._setIndexInReflectionList(-1)}}class la{constructor(){this._reflectionProbes=new oa;this._motionObjects=new e;this._needUpdateAllRender=false;this._sceneReflectionProbe=new je;this._sceneReflectionProbe.bounds=new Be(new St(0,0,0),new St(0,0,0));this._sceneReflectionProbe.boxProjection=false;this._sceneReflectionProbe._isScene=true}set sceneReflectionProbe(t){this._sceneReflectionProbe.reflectionTexture=t}set sceneReflectionCubeHDRParam(t){this._sceneReflectionProbe.reflectionHDRParams=t}_updateMotionObjects(t){if(this._reflectionProbes.length==0){t._probReflection=this._sceneReflectionProbe;return}var e=this._reflectionProbes.elements;var a=0;var i;var r=t.bounds;var s;for(var n=0,o=this._reflectionProbes.length;n<o;n++){var l=e[n];if(!i){s=r.calculateBoundsintersection(l.bounds);if(s<a)continue}else{if(i.importance>l.importance)continue;s=r.calculateBoundsintersection(l.bounds);if(s<a&&i.importance==l.importance)continue}i=l;a=s}if(!i&&this._sceneReflectionProbe)i=this._sceneReflectionProbe;t._probReflection=i}add(t){this._reflectionProbes.add(t);this._needUpdateAllRender=true}remove(t){this._reflectionProbes.remove(t);this._needUpdateAllRender=true}addMotionObject(t){this._motionObjects.add(t)}update(){var t=this._motionObjects.elements;for(var e=0,a=this._motionObjects.length;e<a;e++){this._updateMotionObjects(t[e])}this.clearMotionObjects()}updateAllRenderObjects(t){var e=t.elements;for(var a=0,i=t.length;a<i;a++){this._updateMotionObjects(e[a])}this._needUpdateAllRender=false}clearMotionObjects(){this._motionObjects.length=0}destroy(){}}(function(t){t[t["SolidColor"]=0]="SolidColor";t[t["SphericalHarmonics"]=1]="SphericalHarmonics"})(H.AmbientMode||(H.AmbientMode={}));class N extends Et.Sprite{constructor(){super();this._lightCount=0;this._pointLights=new we;this._spotLights=new we;this._directionLights=new we;this._alternateLights=new Pe;this._lightmaps=[];this._skyRenderer=new Kt;this._input=new Ae;this._timer=Et.ILaya.timer;this._time=0;this._shCoefficients=new Array(7);this._ambientMode=H.AmbientMode.SolidColor;this._ambientSphericalHarmonics=new Se;this._ambientSphericalHarmonicsIntensity=1;this._reflectionDecodeFormat=Et.TextureDecodeFormat.Normal;this._reflectionIntensity=1;this._collsionTestList=[];this._renders=new ve;this._opaqueQueue=new Qe(false);this._transparentQueue=new Qe(true);this._cameraPool=[];this._animatorPool=new ve;this._scriptPool=new Array;this._tempScriptPool=new Array;this._needClearScriptPool=false;this._reflectionCubeHDRParams=new bt;this._reflectionProbeManager=new la;this.currentCreationLayer=Math.pow(2,0);this.enableLight=true;this._key=new Et.SubmitKey;this._pickIdToSprite=new Object;this._reflectionMode=0;if(!tt._config.isUseCannonPhysicsEngine&&$._bullet)this._physicsSimulation=new w(N.physicsSettings);else if($._cannon){this._cannonPhysicsSimulation=new Et.CannonPhysicsSimulation(N.cannonPhysicsSettings)}this._shaderValues=new yt(null);this.enableFog=false;this.fogStart=300;this.fogRange=1e3;this.fogColor=new St(.7,.7,.7);this.ambientColor=new St(.212,.227,.259);this.reflectionIntensity=1;this.reflection=De.blackTexture;for(var t=0;t<7;t++)this._shCoefficients[t]=new bt;this._reflectionProbeManager.sceneReflectionCubeHDRParam=this._reflectionCubeHDRParams;this._scene=this;this._input.__init__(Et.Render.canvas,this);if(N.octreeCulling)this._octree=new ta(N.octreeInitialSize,N.octreeInitialCenter,N.octreeMinNodeSize,N.octreeLooseness);if(be.debugFrustumCulling){this._debugTool=new Ke;var e=new Oe;e.renderQueue=s.RENDERQUEUE_TRANSPARENT;e.alphaTest=false;e.depthWrite=false;e.cull=p.CULL_BACK;e.blend=p.BLEND_ENABLE_ALL;e.blendSrc=p.BLENDPARAM_SRC_ALPHA;e.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;e.depthTest=p.DEPTHTEST_LESS;this._debugTool.pixelLineRenderer.sharedMaterial=e}}static __init__(){var t=tt._config;var e=t._multiLighting;if(e){const n=4;var a=t.maxLightCount;var i=t.lightClusterCount;Gt.instance=new Gt(i.x,i.y,i.z,Math.min(t.maxLightCount,t._maxAreaLightCountPerClusterAverage));N._lightTexture=F._createFloatTextureBuffer(n,a);N._lightTexture.lock=true;N._lightPixles=new Float32Array(a*n*4)}Jt.SHADERDEFINE_FOG=P.getDefineByName("FOG");Jt.SHADERDEFINE_DIRECTIONLIGHT=P.getDefineByName("DIRECTIONLIGHT");Jt.SHADERDEFINE_POINTLIGHT=P.getDefineByName("POINTLIGHT");Jt.SHADERDEFINE_SPOTLIGHT=P.getDefineByName("SPOTLIGHT");Jt.SHADERDEFINE_SHADOW=P.getDefineByName("SHADOW");Jt.SHADERDEFINE_SHADOW_CASCADE=P.getDefineByName("SHADOW_CASCADE");Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW=P.getDefineByName("SHADOW_SOFT_SHADOW_LOW");Jt.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH=P.getDefineByName("SHADOW_SOFT_SHADOW_HIGH");Jt.SHADERDEFINE_GI_AMBIENT_SH=P.getDefineByName("GI_AMBIENT_SH");Jt.SHADERDEFINE_SHADOW_SPOT=P.getDefineByName("SHADOW_SPOT");Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW=P.getDefineByName("SHADOW_SPOT_SOFT_SHADOW_LOW");Jt.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH=P.getDefineByName("SHADOW_SPOT_SOFT_SHADOW_HIGH");var r=tt._config;var s=N._configDefineValues;r._multiLighting||s.add(P.SHADERDEFINE_LEGACYSINGALLIGHTING);if(Et.LayaGL.layaGPUInstance._isWebGL2)s.add(P.SHADERDEFINE_GRAPHICS_API_GLES3);else s.add(P.SHADERDEFINE_GRAPHICS_API_GLES2);switch(r.pbrRenderQuality){case H.PBRRenderQuality.High:s.add(c.SHADERDEFINE_LAYA_PBR_BRDF_HIGH);break;case H.PBRRenderQuality.Low:s.add(c.SHADERDEFINE_LAYA_PBR_BRDF_LOW);break;default:throw"Scene3D:unknown shader quality."}if(r.isUseCannonPhysicsEngine){N.cannonPhysicsSettings=new Et.CannonPhysicsSettings}else{N.physicsSettings=new Le}}static load(t,e){Et.ILaya.loader.create(t,e,null,N.HIERARCHY)}get url(){return this._url}get enableFog(){return this._enableFog}set enableFog(t){if(this._enableFog!==t){this._enableFog=t;if(t){this._shaderValues.addDefine(Jt.SHADERDEFINE_FOG)}else this._shaderValues.removeDefine(Jt.SHADERDEFINE_FOG)}}get fogColor(){return this._shaderValues.getVector3(N.FOGCOLOR)}set fogColor(t){this._shaderValues.setVector3(N.FOGCOLOR,t)}get fogStart(){return this._shaderValues.getNumber(N.FOGSTART)}set fogStart(t){this._shaderValues.setNumber(N.FOGSTART,t)}get fogRange(){return this._shaderValues.getNumber(N.FOGRANGE)}set fogRange(t){this._shaderValues.setNumber(N.FOGRANGE,t)}get ambientMode(){return this._ambientMode}set ambientMode(t){if(this._ambientMode!==t){switch(t){case H.AmbientMode.SolidColor:this._shaderValues.removeDefine(Jt.SHADERDEFINE_GI_AMBIENT_SH);break;case H.AmbientMode.SphericalHarmonics:this._shaderValues.addDefine(Jt.SHADERDEFINE_GI_AMBIENT_SH);break;default:throw"Scene3D: unknown ambientMode."}this._ambientMode=t}}get ambientColor(){return this._shaderValues.getVector3(N.AMBIENTCOLOR)}set ambientColor(t){this._shaderValues.setVector3(N.AMBIENTCOLOR,t)}get ambientSphericalHarmonics(){return this._ambientSphericalHarmonics}set ambientSphericalHarmonics(t){var e=t||Se._default;this._applySHCoefficients(e,Math.pow(this._ambientSphericalHarmonicsIntensity,2.2));if(this._ambientSphericalHarmonics!=t)t.cloneTo(this._ambientSphericalHarmonics)}get ambientSphericalHarmonicsIntensity(){return this._ambientSphericalHarmonicsIntensity}set ambientSphericalHarmonicsIntensity(t){t=Math.max(Math.min(t,8),0);if(this._ambientSphericalHarmonicsIntensity!==t){var e=this._ambientSphericalHarmonics||Se._default;this._applySHCoefficients(e,Math.pow(t,2.2));this._ambientSphericalHarmonicsIntensity=t}}get reflection(){return this._reflection}set reflection(t){if(this._reflection!=t){t._addReference();this._reflectionProbeManager.sceneReflectionProbe=t;this._reflection=t||De.blackTexture;this._reflectionProbeManager._needUpdateAllRender=true}}get reflectionDecodingFormat(){return this._reflectionDecodeFormat}set reflectionDecodingFormat(t){if(this._reflectionDecodeFormat!=t){this._reflectionCubeHDRParams.x=this._reflectionIntensity;if(this._reflectionDecodeFormat==Et.TextureDecodeFormat.RGBM)this._reflectionCubeHDRParams.x*=5;this._reflectionDecodeFormat=t;this._reflectionProbeManager.sceneReflectionCubeHDRParam=this._reflectionCubeHDRParams}}get reflectionIntensity(){return this._reflectionIntensity}set reflectionIntensity(t){t=Math.max(Math.min(t,1),0);this._reflectionCubeHDRParams.x=t;if(this._reflectionDecodeFormat==Et.TextureDecodeFormat.RGBM)this._reflectionCubeHDRParams.x*=5;this._reflectionIntensity=t;this._reflectionProbeManager.sceneReflectionCubeHDRParam=this._reflectionCubeHDRParams}get skyRenderer(){return this._skyRenderer}get physicsSimulation(){return this._physicsSimulation}get cannonPhysicsSimulation(){return this._cannonPhysicsSimulation}get timer(){return this._timer}set timer(t){this._timer=t}get input(){return this._input}get lightmaps(){return this._lightmaps.slice()}set lightmaps(t){var e=this._lightmaps;if(e){for(var a=0,i=e.length;a<i;a++){var r=e[a];r.lightmapColor._removeReference();r.lightmapDirection._removeReference()}}if(t){var s=t.length;e.length=s;for(a=0;a<s;a++){var r=t[a];r.lightmapColor&&r.lightmapColor._addReference();r.lightmapDirection&&r.lightmapDirection._addReference();e[a]=r}}else{e.length=0}}_applySHCoefficients(t,e){var a=this._shCoefficients;for(var i=0;i<3;i++){var r=a[i];var s=a[i+3];r.setValue(t.getCoefficient(i,3)*e,t.getCoefficient(i,1)*e,t.getCoefficient(i,2)*e,(t.getCoefficient(i,0)-t.getCoefficient(i,6))*e);s.setValue(t.getCoefficient(i,4)*e,t.getCoefficient(i,5)*e,t.getCoefficient(i,6)*3*e,t.getCoefficient(i,7)*e)}a[6].setValue(t.getCoefficient(0,8)*e,t.getCoefficient(1,8)*e,t.getCoefficient(2,8)*e,1);var n=this._shaderValues;n.setVector(N.AMBIENTSHAR,a[0]);n.setVector(N.AMBIENTSHAG,a[1]);n.setVector(N.AMBIENTSHAB,a[2]);n.setVector(N.AMBIENTSHBR,a[3]);n.setVector(N.AMBIENTSHBG,a[4]);n.setVector(N.AMBIENTSHBB,a[5]);n.setVector(N.AMBIENTSHC,a[6])}_update(){var t=this.timer._delta/1e3;this._time+=t;this._shaderValues.setNumber(N.TIME,this._time);var e=this._physicsSimulation;if($._enablePhysics&&!w.disableSimulation&&!tt._config.isUseCannonPhysicsEngine){e._updatePhysicsTransformFromRender();I._addUpdateList=false;e._simulate(t);e._updateCharacters();I._addUpdateList=true;e._updateCollisions();e._eventScripts()}if($._cannon&&tt._config.isUseCannonPhysicsEngine){var a=this._cannonPhysicsSimulation;a._updatePhysicsTransformFromRender();Et.CannonPhysicsComponent._addUpdateList=false;a._simulate(t);Et.CannonPhysicsComponent._addUpdateList=true;a._updateCollisions();a._eventScripts()}this._input._update();this._clearScript();this._updateScript();ft._update(this);Et.VideoTexture._update();if(this._reflectionProbeManager._needUpdateAllRender)this._reflectionProbeManager.updateAllRenderObjects(this._renders);else this._reflectionProbeManager.update();this._lateUpdateScript()}_binarySearchIndexInCameraPool(t){var e=0;var a=this._cameraPool.length-1;var i;while(e<=a){i=Math.floor((e+a)/2);var r=this._cameraPool[i]._renderingOrder;if(r==t._renderingOrder)return i;else if(r>t._renderingOrder)a=i-1;else e=i+1}return e}_allotPickColorByID(t,e){var a=Math.floor(t/(255*255));t-=a*255*255;var i=Math.floor(t/255);t-=i*255;var r=t;e.x=a/255;e.y=i/255;e.z=r/255;e.w=1}_searchIDByPickColor(t){var e=t.x*255*255+t.y*255+t.z;return e}onEnable(){this._input._onCanvasEvent(Et.Render.canvas)}onDisable(){this._input._offCanvasEvent(Et.Render.canvas)}_setCreateURL(t){this._url=Et.URL.formatURL(t)}_getGroup(){return this._group}_setGroup(t){this._group=t}_clearScript(){if(this._needClearScriptPool){var t=this._scriptPool;for(var e=0,a=t.length;e<a;e++){var i=t[e];if(i){i._indexInPool=this._tempScriptPool.length;this._tempScriptPool.push(i)}}this._scriptPool=this._tempScriptPool;t.length=0;this._tempScriptPool=t;this._needClearScriptPool=false}}_updateScript(){var t=this._scriptPool;for(var e=0,a=t.length;e<a;e++){var i=t[e];i&&i.enabled&&i.onUpdate()}}_lateUpdateScript(){var t=this._scriptPool;for(var e=0,a=t.length;e<a;e++){var i=t[e];i&&i.enabled&&i.onLateUpdate()}}_onActive(){super._onActive();Et.ILaya.stage._scene3Ds.push(this)}_onInActive(){super._onInActive();var t=Et.ILaya.stage._scene3Ds;t.splice(t.indexOf(this),1)}_prepareSceneToRender(){var t=this._shaderValues;var e=tt._config._multiLighting;if(e){var a=N._lightTexture;var i=N._lightPixles;const b=a.width;const S=b*4;var r=0;var s=this._directionLights._length;var n=this._directionLights._elements;if(s>0){var o=this._directionLights.getBrightestLight();this._mainDirectionLight=n[o];this._directionLights.normalLightOrdering(o);for(var l=0;l<s;l++,r++){var _=n[l];var h=_._direction;var x=_._intensityColor;var c=S*r;St.scale(_.color,_._intensity,x);_.transform.worldMatrix.getForward(h);St.normalize(h,h);i[c]=x.x;i[c+1]=x.y;i[c+2]=x.z;i[c+4]=h.x;i[c+5]=h.y;i[c+6]=h.z;if(l==0){t.setVector3(N.SUNLIGHTDIRCOLOR,x);t.setVector3(N.SUNLIGHTDIRECTION,h)}}t.addDefine(Jt.SHADERDEFINE_DIRECTIONLIGHT)}else{t.removeDefine(Jt.SHADERDEFINE_DIRECTIONLIGHT)}var d=this._pointLights._length;if(d>0){var u=this._pointLights._elements;var f=this._pointLights.getBrightestLight();this._mainPointLight=u[f];this._pointLights.normalLightOrdering(f);for(var l=0;l<d;l++,r++){var p=u[l];var m=p.transform.position;var x=p._intensityColor;var c=S*r;St.scale(p.color,p._intensity,x);i[c]=x.x;i[c+1]=x.y;i[c+2]=x.z;i[c+3]=p.range;i[c+4]=m.x;i[c+5]=m.y;i[c+6]=m.z}t.addDefine(Jt.SHADERDEFINE_POINTLIGHT)}else{t.removeDefine(Jt.SHADERDEFINE_POINTLIGHT)}var g=this._spotLights._length;if(g>0){var v=this._spotLights._elements;var y=this._spotLights.getBrightestLight();this._mainSpotLight=v[y];this._spotLights.normalLightOrdering(y);for(var l=0;l<g;l++,r++){var T=v[l];var h=T._direction;var m=T.transform.position;var x=T._intensityColor;var c=S*r;St.scale(T.color,T._intensity,x);T.transform.worldMatrix.getForward(h);St.normalize(h,h);i[c]=x.x;i[c+1]=x.y;i[c+2]=x.z;i[c+3]=T.range;i[c+4]=m.x;i[c+5]=m.y;i[c+6]=m.z;i[c+7]=T.spotAngle*Math.PI/180;i[c+8]=h.x;i[c+9]=h.y;i[c+10]=h.z}t.addDefine(Jt.SHADERDEFINE_SPOTLIGHT)}else{t.removeDefine(Jt.SHADERDEFINE_SPOTLIGHT)}r>0&&a.setSubPixels(0,0,b,r,i,0);t.setTexture(N.LIGHTBUFFER,a);t.setInt(N.DIRECTIONLIGHTCOUNT,this._directionLights._length);t.setTexture(N.CLUSTERBUFFER,Gt.instance._clusterTexture)}else{if(this._directionLights._length>0){var _=this._directionLights._elements[0];this._mainDirectionLight=_;St.scale(_.color,_._intensity,_._intensityColor);_.transform.worldMatrix.getForward(_._direction);St.normalize(_._direction,_._direction);t.setVector3(N.LIGHTDIRCOLOR,_._intensityColor);t.setVector3(N.LIGHTDIRECTION,_._direction);t.setVector3(N.SUNLIGHTDIRCOLOR,_._intensityColor);t.setVector3(N.SUNLIGHTDIRECTION,_._direction);t.addDefine(Jt.SHADERDEFINE_DIRECTIONLIGHT)}else{t.removeDefine(Jt.SHADERDEFINE_DIRECTIONLIGHT)}if(this._pointLights._length>0){var p=this._pointLights._elements[0];this._mainPointLight=p;St.scale(p.color,p._intensity,p._intensityColor);t.setVector3(N.POINTLIGHTCOLOR,p._intensityColor);t.setVector3(N.POINTLIGHTPOS,p.transform.position);t.setNumber(N.POINTLIGHTRANGE,p.range);t.addDefine(Jt.SHADERDEFINE_POINTLIGHT)}else{t.removeDefine(Jt.SHADERDEFINE_POINTLIGHT)}if(this._spotLights._length>0){var E=this._spotLights._elements[0];this._mainSpotLight=E;St.scale(E.color,E._intensity,E._intensityColor);t.setVector3(N.SPOTLIGHTCOLOR,E._intensityColor);t.setVector3(N.SPOTLIGHTPOS,E.transform.position);E.transform.worldMatrix.getForward(E._direction);St.normalize(E._direction,E._direction);t.setVector3(N.SPOTLIGHTDIRECTION,E._direction);t.setNumber(N.SPOTLIGHTRANGE,E.range);t.setNumber(N.SPOTLIGHTSPOTANGLE,E.spotAngle*Math.PI/180);t.addDefine(Jt.SHADERDEFINE_SPOTLIGHT)}else{t.removeDefine(Jt.SHADERDEFINE_SPOTLIGHT)}}}_addScript(t){var e=this._scriptPool;t._indexInPool=e.length;e.push(t)}_removeScript(t){this._scriptPool[t._indexInPool]=null;t._indexInPool=-1;this._needClearScriptPool=true}_preRenderScript(){var t=this._scriptPool;for(var e=0,a=t.length;e<a;e++){var i=t[e];i&&i.enabled&&i.onPreRender()}}_postRenderScript(){var t=this._scriptPool;for(var e=0,a=t.length;e<a;e++){var i=t[e];i&&i.enabled&&i.onPostRender()}}_addCamera(t){var e=this._binarySearchIndexInCameraPool(t);var a=t._renderingOrder;var i=this._cameraPool.length;while(e<i&&this._cameraPool[e]._renderingOrder<=a)e++;this._cameraPool.splice(e,0,t)}_removeCamera(t){this._cameraPool.splice(this._cameraPool.indexOf(t),1)}_preCulling(t,e,a,i){var r=be._cameraCullInfo;r.position=e._transform.position;r.cullingMask=e.cullingMask;r.boundFrustum=e.boundFrustum;r.useOcclusionCulling=e.useOcclusionCulling;be.renderObjectCulling(r,this,t,a,i,false)}_clear(t,e){var a=e.viewport;var i=e.camera;var r=i._getRenderTexture();var s,n;var o=a.width;var l=a.height;if(i._needInternalRenderTexture()){s=0;n=0}else{s=a.x;n=i._getCanvasHeight()-a.y-l}t.viewport(s,n,o,l);var _;var h=i.clearFlag;if(h===H.CameraClearFlags.Sky&&!(i.skyRenderer._isAvailable()||this._skyRenderer._isAvailable()))h=H.CameraClearFlags.SolidColor;switch(h){case H.CameraClearFlags.SolidColor:var x=i.clearColor;t.enable(t.SCISSOR_TEST);t.scissor(s,n,o,l);if(x)t.clearColor(x.x,x.y,x.z,x.w);else t.clearColor(0,0,0,0);if(r){_=t.COLOR_BUFFER_BIT;switch(r.depthStencilFormat){case Et.RenderTextureDepthFormat.DEPTH_16:_|=t.DEPTH_BUFFER_BIT;break;case Et.RenderTextureDepthFormat.STENCIL_8:_|=t.STENCIL_BUFFER_BIT;break;case Et.RenderTextureDepthFormat.DEPTHSTENCIL_24_8:_|=t.DEPTH_BUFFER_BIT;_|=t.STENCIL_BUFFER_BIT;break}}else{_=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT}Et.WebGLContext.setDepthMask(t,true);t.clear(_);t.disable(t.SCISSOR_TEST);break;case H.CameraClearFlags.Sky:case H.CameraClearFlags.DepthOnly:t.enable(t.SCISSOR_TEST);t.scissor(s,n,o,l);if(r){switch(r.depthStencilFormat){case Et.RenderTextureDepthFormat.DEPTH_16:_=t.DEPTH_BUFFER_BIT;break;case Et.RenderTextureDepthFormat.STENCIL_8:_=t.STENCIL_BUFFER_BIT;break;case Et.RenderTextureDepthFormat.DEPTHSTENCIL_24_8:_=t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT;break}}else{_=t.DEPTH_BUFFER_BIT}Et.WebGLContext.setDepthMask(t,true);t.clear(_);t.disable(t.SCISSOR_TEST);break;case H.CameraClearFlags.Nothing:break;default:throw new Error("Scene3D:camera clearFlag invalid.")}}_renderScene(t,e){var a=t.camera;switch(e){case N.SCENERENDERFLAG_RENDERQPAQUE:this._opaqueQueue._render(t);break;case N.SCENERENDERFLAG_SKYBOX:if(a.clearFlag===H.CameraClearFlags.Sky){if(a.skyRenderer._isAvailable())a.skyRenderer._render(t);else if(this._skyRenderer._isAvailable())this._skyRenderer._render(t)}break;case N.SCENERENDERFLAG_RENDERTRANSPARENT:this._transparentQueue._render(t);if(be.debugFrustumCulling){var i=this._debugTool._render._renderElements;for(var r=0,s=i.length;r<s;r++){i[r]._update(this,t,null,null);i[r]._render(t)}}break}}_parse(t,e){var a=t.lightmaps;if(a){var i=a.length;var r=new Array(i);for(var s=0;s<i;s++){var n=new ea;var o=a[s];if(o.path){n.lightmapColor=Et.Loader.getRes(o.path)}else{n.lightmapColor=Et.Loader.getRes(o.color.path);if(o.direction)n.lightmapDirection=Et.Loader.getRes(o.direction.path)}r[s]=n}this.lightmaps=r}var l=t.ambientColor;if(l){var _=this.ambientColor;_.fromArray(l);this.ambientColor=_}var h=t.sky;if(h){this._skyRenderer.material=Et.Loader.getRes(h.material.path);switch(h.mesh){case"SkyBox":this._skyRenderer.mesh=Zt.instance;break;case"SkyDome":this._skyRenderer.mesh=Me.instance;break;default:this.skyRenderer.mesh=Zt.instance}}this.enableFog=t.enableFog;this.fogStart=t.fogStart;this.fogRange=t.fogRange;var x=t.fogColor;if(x){var c=this.fogColor;c.fromArray(x);this.fogColor=c}var d=t.ambientSphericalHarmonics;if(d){var u=this.ambientSphericalHarmonics;for(var s=0;s<3;s++){var f=s*9;u.setCoefficients(s,d[f],d[f+1],d[f+2],d[f+3],d[f+4],d[f+5],d[f+6],d[f+7],d[f+8])}this.ambientSphericalHarmonics=u}var p=t.reflection;p!=undefined&&(this.reflection=Et.Loader.getRes(p));var m=t.reflectionDecodingFormat;m!=undefined&&(this.reflectionDecodingFormat=m);var g=t.ambientMode;g!=undefined&&(this.ambientMode=g);var v=t.ambientSphericalHarmonicsIntensity;v!=undefined&&(this.ambientSphericalHarmonicsIntensity=v);var y=t.reflectionIntensity;y!=undefined&&(this.reflectionIntensity=y)}_addRenderObject(t){if(this._octree&&t._supportOctree){this._octree.add(t)}else{this._renders.add(t)}t._addReflectionProbeUpdate()}_removeRenderObject(t){if(this._octree&&t._supportOctree){this._octree.remove(t)}else{this._renders.remove(t)}}_getRenderQueue(t){if(t<=2500)return this._opaqueQueue;else return this._transparentQueue}_clearRenderQueue(){this._opaqueQueue.clear();this._transparentQueue.clear();var t=We._managers;for(var e=0,a=t.length;e<a;e++)t[e]._clear();var i=na._managers;for(var e=0,a=i.length;e<a;e++)i[e]._clear()}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._skyRenderer.destroy();this._skyRenderer=null;this._directionLights=null;this._pointLights=null;this._spotLights=null;this._alternateLights=null;this._shaderValues=null;this._renders=null;this._cameraPool=null;this._octree=null;this._physicsSimulation&&this._physicsSimulation._destroy();this._reflection._removeReference();this._reflection=null;var e=this._lightmaps;if(e){for(var a=0,i=e.length;a<i;a++){var r=e[a];r.lightmapColor&&r.lightmapColor._removeReference();r.lightmapDirection&&r.lightmapDirection._removeReference()}}this._lightmaps=null;this._reflectionProbeManager.destroy();Et.Loader.clearRes(this.url)}render(t,e,a){t._curSubmit=Et.SubmitBase.RENDERBASE;this._children.length>0&&t.addRenderObject(this)}renderSubmit(){var t=Et.LayaGL.instance;this._prepareSceneToRender();var e,a,i;for(e=0,a=this._cameraPool.length,i=a-1;e<a;e++){if(Et.Render.supportWebGLPlusRendering)yt.setRuntimeValueMode(e==i?true:false);var r=this._cameraPool[e];r.enableRender&&r.render()}Et.Context.set2DRenderConfig();return 1}getRenderType(){return 0}releaseRender(){}reUse(t,e){return 0}setGlobalShaderValue(t,e,a){var i=P.propertyNameToID(t);switch(e){case H.ShaderDataType.Int:this._shaderValues.setInt(i,a);break;case H.ShaderDataType.Number:this._shaderValues.setNumber(i,a);break;case H.ShaderDataType.Bool:this._shaderValues.setBool(i,a);break;case H.ShaderDataType.Matrix4x4:this._shaderValues.setMatrix4x4(i,a);break;case H.ShaderDataType.Quaternion:this._shaderValues.setQuaternion(i,a);break;case H.ShaderDataType.Texture:this._shaderValues.setTexture(i,a);break;case H.ShaderDataType.Vector:this._shaderValues.setVector(i,a);break;case H.ShaderDataType.Vector2:this._shaderValues.setVector2(i,a);break;case H.ShaderDataType.Vector3:this._shaderValues.setVector3(i,a);break;case H.ShaderDataType.Buffer:this._shaderValues.setBuffer(i,a);break}}get customReflection(){return this._reflection}set customReflection(t){if(this._reflection!=t){t._addReference();this._reflectionProbeManager.sceneReflectionProbe=t;this._reflection=t}}get reflectionMode(){return this._reflectionMode}set reflectionMode(t){this._reflectionMode=t}setlightmaps(t){var e=this._lightmaps;for(var a=0,i=e.length;a<i;a++)e[a].lightmapColor._removeReference();if(t){var r=t.length;e.length=r;for(a=0;a<r;a++){var s=t[a];s._addReference();e[a]||(e[a]=new ea);e[a].lightmapColor=s}}else{throw new Error("Scene3D: value value can't be null.")}}getlightmaps(){var t=new Array(this._lightmaps.length);for(var e=0;e<this._lightmaps.length;e++){t[e]=this._lightmaps[e].lightmapColor}return t}}N._shadowCasterPass=new sa;N.HIERARCHY="HIERARCHY";N.octreeCulling=false;N.octreeInitialSize=64;N.octreeInitialCenter=new St(0,0,0);N.octreeMinNodeSize=2;N.octreeLooseness=1.25;N.REFLECTIONMODE_SKYBOX=0;N.REFLECTIONMODE_CUSTOM=1;N.SCENERENDERFLAG_RENDERQPAQUE=0;N.SCENERENDERFLAG_SKYBOX=1;N.SCENERENDERFLAG_RENDERTRANSPARENT=2;N.FOGCOLOR=P.propertyNameToID("u_FogColor");N.FOGSTART=P.propertyNameToID("u_FogStart");N.FOGRANGE=P.propertyNameToID("u_FogRange");N.DIRECTIONLIGHTCOUNT=P.propertyNameToID("u_DirationLightCount");N.LIGHTBUFFER=P.propertyNameToID("u_LightBuffer");N.CLUSTERBUFFER=P.propertyNameToID("u_LightClusterBuffer");N.SUNLIGHTDIRECTION=P.propertyNameToID("u_SunLight.direction");N.SUNLIGHTDIRCOLOR=P.propertyNameToID("u_SunLight.color");N.AMBIENTSHAR=P.propertyNameToID("u_AmbientSHAr");N.AMBIENTSHAG=P.propertyNameToID("u_AmbientSHAg");N.AMBIENTSHAB=P.propertyNameToID("u_AmbientSHAb");N.AMBIENTSHBR=P.propertyNameToID("u_AmbientSHBr");N.AMBIENTSHBG=P.propertyNameToID("u_AmbientSHBg");N.AMBIENTSHBB=P.propertyNameToID("u_AmbientSHBb");N.AMBIENTSHC=P.propertyNameToID("u_AmbientSHC");N.LIGHTDIRECTION=P.propertyNameToID("u_DirectionLight.direction");N.LIGHTDIRCOLOR=P.propertyNameToID("u_DirectionLight.color");N.POINTLIGHTPOS=P.propertyNameToID("u_PointLight.position");N.POINTLIGHTRANGE=P.propertyNameToID("u_PointLight.range");N.POINTLIGHTATTENUATION=P.propertyNameToID("u_PointLight.attenuation");N.POINTLIGHTCOLOR=P.propertyNameToID("u_PointLight.color");N.SPOTLIGHTPOS=P.propertyNameToID("u_SpotLight.position");N.SPOTLIGHTDIRECTION=P.propertyNameToID("u_SpotLight.direction");N.SPOTLIGHTSPOTANGLE=P.propertyNameToID("u_SpotLight.spot");N.SPOTLIGHTRANGE=P.propertyNameToID("u_SpotLight.range");N.SPOTLIGHTCOLOR=P.propertyNameToID("u_SpotLight.color");N.AMBIENTCOLOR=P.propertyNameToID("u_AmbientColor");N.TIME=P.propertyNameToID("u_Time");N._configDefineValues=new gt;class _a extends Et.ShaderCompile{constructor(t,e,a,i){super(e,a,null);this._cacheSharders={};this._cacheShaderHierarchy=1;this._renderState=new p;this._validDefine=new gt;this._tags={};this._owner=t;this._stateMap=i;for(var r in this.defs)this._validDefine.add(P.getDefineByName(r))}get renderState(){return this._renderState}_compileToTree(t,e,a,i,r){var s,n;var o,l,_;var h,x,c;var d,u,f;for(d=a;d<e.length;d++){o=e[d];if(o.length<1)continue;h=o.indexOf("//");if(h===0)continue;if(h>=0)o=o.substr(0,h);s=c||new Et.ShaderNode(i);c=null;s.text=o;s.noCompile=true;if((h=o.indexOf("#"))>=0){l="#";for(f=h+1,u=o.length;f<u;f++){var p=o.charAt(f);if(p===" "||p==="\t"||p==="?")break;l+=p}s.name=l;switch(l){case"#ifdef":case"#ifndef":s.src=o;s.noCompile=o.match(/[!&|()=<>]/)!=null;if(!s.noCompile){x=o.replace(/^\s*/,"").split(/\s+/);s.setCondition(x[1],l==="#ifdef"?Et.ShaderCompile.IFDEF_YES:Et.ShaderCompile.IFDEF_ELSE);s.text="//"+s.text}else{console.log("function():Boolean{return "+o.substr(h+s.name.length)+"}")}s.setParent(t);t=s;if(r){x=o.substr(f).split(Et.ShaderCompile._splitToWordExps3);for(f=0;f<x.length;f++){o=x[f];o.length&&(r[o]=true)}}continue;case"#if":case"#elif":s.src=o;s.noCompile=true;if(l=="#elif"){t=t.parent;n=t.childs[t.childs.length-1];n.text=n.src;n.noCompile=true;n.condition=null}s.setParent(t);t=s;if(r){x=o.substr(f).split(Et.ShaderCompile._splitToWordExps3);for(f=0;f<x.length;f++){o=x[f];o.length&&o!="defined"&&(r[o]=true)}}continue;case"#else":s.src=o;t=t.parent;n=t.childs[t.childs.length-1];s.noCompile=n.noCompile;if(!s.noCompile){s.condition=n.condition;s.conditionType=n.conditionType==Et.ShaderCompile.IFDEF_YES?Et.ShaderCompile.IFDEF_ELSE:Et.ShaderCompile.IFDEF_YES;s.text="//"+s.text+" "+n.text+" "+s.conditionType}s.setParent(t);t=s;continue;case"#endif":t=t.parent;n=t.childs[t.childs.length-1];s.noCompile=n.noCompile;if(!s.noCompile){s.text="//"+s.text}s.setParent(t);continue;case"#include":x=Et.ShaderCompile.splitToWords(o,null);var m=Et.ShaderCompile.includes[x[1]];if(!m){throw"ShaderCompile error no this include file:"+x[1]}if((h=x[0].indexOf("?"))<0){s.setParent(t);o=m.getWith(x[2]=="with"?x[3]:null);this._compileToTree(s,o.split("\n"),0,i,r);s.text="";continue}s.setCondition(x[0].substr(h+1),Et.ShaderCompile.IFDEF_YES);s.text=m.getWith(x[2]=="with"?x[3]:null);break;case"#import":x=Et.ShaderCompile.splitToWords(o,null);_=x[1];i.push({node:s,file:Et.ShaderCompile.includes[_],ofs:s.text.length});continue}}else{n=t.childs[t.childs.length-1];if(n&&!n.name){i.length>0&&Et.ShaderCompile.splitToWords(o,n);c=s;n.text+="\n"+o;continue}i.length>0&&Et.ShaderCompile.splitToWords(o,s)}s.setParent(t)}}_resizeCacheShaderMap(t,e,a){var i=this._cacheShaderHierarchy-1;if(e==i){for(var r in t){var s=t[r];for(var n=0,o=a-i;n<o;n++){if(n==o-1)t[0]=s;else t=t[n==0?r:0]={}}}this._cacheShaderHierarchy=a}else{for(var r in t)this._resizeCacheShaderMap(t[r],++e,a)}}_addDebugShaderVariantCollection(t,e,a){var i=P._debugShaderVariantInfo;var r=this._owner;var s=r._owner;var n=t._mask;P._getNamesByDefineData(t,e);a.length=n.length;for(var o=0,l=n.length;o<l;o++)a[o]=n[o];if(i)i.setValue(s,s._subShaders.indexOf(r),r._passes.indexOf(this),e);else P._debugShaderVariantInfo=i=new Mt(s,s._subShaders.indexOf(r),r._passes.indexOf(this),e);P.debugShaderVariantCollection.add(i)}withCompile(t){var e=_a._debugDefineString;var a=_a._debugDefineMask;var i;t._intersectionDefineDatas(this._validDefine);if(P.debugMode){i=t._length;this._addDebugShaderVariantCollection(t,e,a)}t.addDefineDatas(N._configDefineValues);var r=this._cacheSharders;var s=t._length;if(s>this._cacheShaderHierarchy){this._resizeCacheShaderMap(r,0,s);this._cacheShaderHierarchy=s}var n=t._mask;var o=t._length-1;var l=this._cacheShaderHierarchy-1;for(var _=0;_<l;_++){var h=o<_?0:n[_];var x=r[h];x||(r[h]=x={});r=x}var c=o<l?0:n[l];var d=r[c];if(d)return d;var u=_a._defineString;P._getNamesByDefineData(t,u);var f=tt._config;var p=f.lightClusterCount;var m={};var g;var v;var y="";if(Et.WebGL._isWebGL2){g=`#version 300 es\n
				#define attribute in
				#define varying out
				#define texture2D texture\n`;v=`#version 300 es\n
				#define varying in
				out highp vec4 pc_fragColor;
				#define gl_FragColor pc_fragColor
				#define gl_FragDepthEXT gl_FragDepth
				#define texture2D texture
				#define textureCube texture
				#define texture2DProj textureProj
				#define texture2DLodEXT textureLod
				#define texture2DProjLodEXT textureProjLod
				#define textureCubeLodEXT textureLod
				#define texture2DGradEXT textureGrad
				#define texture2DProjGradEXT textureProjGrad
				#define textureCubeGradEXT textureGrad\n`}else{g="";v=`#ifdef GL_EXT_shader_texture_lod
					#extension GL_EXT_shader_texture_lod : enable
				#endif
				#if !defined(GL_EXT_shader_texture_lod)
					#define texture1DLodEXT texture1D
					#define texture2DLodEXT texture2D
					#define texture2DProjLodEXT texture2DProj
					#define texture3DLodEXT texture3D
					#define textureCubeLodEXT textureCube
				#endif\n`}y+="#define MAX_LIGHT_COUNT "+f.maxLightCount+"\n";y+="#define MAX_LIGHT_COUNT_PER_CLUSTER "+f._maxAreaLightCountPerClusterAverage+"\n";y+="#define CLUSTER_X_COUNT "+p.x+"\n";y+="#define CLUSTER_Y_COUNT "+p.y+"\n";y+="#define CLUSTER_Z_COUNT "+p.z+"\n";y+="#define SHADER_CAPAILITY_LEVEL "+Et.SystemUtils._shaderCapailityLevel+"\n";for(var _=0,T=u.length;_<T;_++){var E=u[_];y+="#define "+E+"\n";m[E]=true}var b=this._VS.toscript(m,[]);var S="";if(b[0].indexOf("#version")==0){S=b[0]+"\n";b.shift()}var C=this._PS.toscript(m,[]);var R="";if(C[0].indexOf("#version")==0){R=C[0]+"\n";C.shift()}var A=P.getAttributeMapByDefine(u,this._owner._attributeMap);d=new ge(S+g+y+b.join("\n"),R+v+y+C.join("\n"),A,this._owner._uniformMap||this._owner._owner._uniformMap,this);r[c]=d;if(P.debugMode){var L="";var I="";for(var _=0,T=i;_<T;_++)_==T-1?I+=a[_]:I+=a[_]+",";for(var _=0,T=e.length;_<T;_++)_==T-1?L+=e[_]:L+=e[_]+",";console.log("%cLayaAir: Shader Compile Information---ShaderName:"+this._owner._owner._name+" SubShaderIndex:"+this._owner._owner._subShaders.indexOf(this._owner)+" PassIndex:"+this._owner._passes.indexOf(this)+" DefineMask:["+I+"]"+" DefineNames:["+L+"]","color:green")}return d}setTag(t,e){if(e)this._tags[t]=e;else delete this._tags[t]}getTag(t){return this._tags[t]}}_a._defineString=[];_a._debugDefineString=[];_a._debugDefineMask=[];class ha{constructor(t,e){this._flags={};this._passes=[];this._attributeMap=t;this._uniformMap=e}setFlag(t,e){if(e)this._flags[t]=e;else delete this._flags[t]}getFlag(t){return this._flags[t]}addShaderPass(t,e,a=null,i="Forward"){var r=new _a(this,t,e,a);r._pipelineMode=i;this._passes.push(r);return r}}(function(t){t[t["SpecularTextureAlpha"]=0]="SpecularTextureAlpha";t[t["AlbedoTextureAlpha"]=1]="AlbedoTextureAlpha"})(H.PBRSpecularSmoothnessSource||(H.PBRSpecularSmoothnessSource={}));class xa extends c{constructor(){super();this.setShaderName("PBRSpecular");this._shaderValues.setVector(xa.SPECULARCOLOR,new bt(.2,.2,.2,1))}static __init__(){xa.SHADERDEFINE_SPECULARGLOSSTEXTURE=P.getDefineByName("SPECULARGLOSSTEXTURE");xa.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=P.getDefineByName("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA");var t={a_Position:K.MESH_POSITION0,a_Normal:K.MESH_NORMAL0,a_Tangent0:K.MESH_TANGENT0,a_Texcoord0:K.MESH_TEXTURECOORDINATE0,a_Texcoord1:K.MESH_TEXTURECOORDINATE1,a_BoneWeights:K.MESH_BLENDWEIGHT0,a_BoneIndices:K.MESH_BLENDINDICES0,a_MvpMatrix:K.MESH_MVPMATRIX_ROW0,a_WorldMat:K.MESH_WORLDMATRIX_ROW0};var e={u_Bones:P.PERIOD_CUSTOM,u_MvpMatrix:P.PERIOD_SPRITE,u_WorldMat:P.PERIOD_SPRITE,u_LightmapScaleOffset:P.PERIOD_SPRITE,u_LightMap:P.PERIOD_SPRITE,u_LightMapDirection:P.PERIOD_SPRITE,u_SimpleAnimatorTexture:P.PERIOD_SPRITE,u_SimpleAnimatorParams:P.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:P.PERIOD_SPRITE,u_ReflectCubeHDRParams:P.PERIOD_SPRITE,u_ReflectTexture:P.PERIOD_SPRITE,u_SpecCubeProbePosition:P.PERIOD_SPRITE,u_SpecCubeBoxMax:P.PERIOD_SPRITE,u_SpecCubeBoxMin:P.PERIOD_SPRITE,u_CameraPos:P.PERIOD_CAMERA,u_View:P.PERIOD_CAMERA,u_ProjectionParams:P.PERIOD_CAMERA,u_Viewport:P.PERIOD_CAMERA,u_ViewProjection:P.PERIOD_CAMERA,u_AlphaTestValue:P.PERIOD_MATERIAL,u_AlbedoColor:P.PERIOD_MATERIAL,u_EmissionColor:P.PERIOD_MATERIAL,u_AlbedoTexture:P.PERIOD_MATERIAL,u_NormalTexture:P.PERIOD_MATERIAL,u_ParallaxTexture:P.PERIOD_MATERIAL,u_OcclusionTexture:P.PERIOD_MATERIAL,u_EmissionTexture:P.PERIOD_MATERIAL,u_Smoothness:P.PERIOD_MATERIAL,u_SmoothnessScale:P.PERIOD_MATERIAL,u_occlusionStrength:P.PERIOD_MATERIAL,u_NormalScale:P.PERIOD_MATERIAL,u_ParallaxScale:P.PERIOD_MATERIAL,u_TilingOffset:P.PERIOD_MATERIAL,u_SpecGlossTexture:P.PERIOD_MATERIAL,u_SpecularColor:P.PERIOD_MATERIAL,u_AmbientColor:P.PERIOD_SCENE,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE,u_DirationLightCount:P.PERIOD_SCENE,u_LightBuffer:P.PERIOD_SCENE,u_LightClusterBuffer:P.PERIOD_SCENE,u_ShadowBias:P.PERIOD_SCENE,u_ShadowLightDirection:P.PERIOD_SCENE,u_ShadowMap:P.PERIOD_SCENE,u_ShadowParams:P.PERIOD_SCENE,u_ShadowSplitSpheres:P.PERIOD_SCENE,u_ShadowMatrices:P.PERIOD_SCENE,u_ShadowMapSize:P.PERIOD_SCENE,u_SpotShadowMap:P.PERIOD_SCENE,u_SpotViewProjectMatrix:P.PERIOD_SCENE,u_ShadowLightPosition:P.PERIOD_SCENE,u_AmbientSHAr:P.PERIOD_SCENE,u_AmbientSHAg:P.PERIOD_SCENE,u_AmbientSHAb:P.PERIOD_SCENE,u_AmbientSHBr:P.PERIOD_SCENE,u_AmbientSHBg:P.PERIOD_SCENE,u_AmbientSHBb:P.PERIOD_SCENE,u_AmbientSHC:P.PERIOD_SCENE,"u_DirectionLight.direction":P.PERIOD_SCENE,"u_DirectionLight.color":P.PERIOD_SCENE,"u_PointLight.position":P.PERIOD_SCENE,"u_PointLight.range":P.PERIOD_SCENE,"u_PointLight.color":P.PERIOD_SCENE,"u_SpotLight.position":P.PERIOD_SCENE,"u_SpotLight.direction":P.PERIOD_SCENE,"u_SpotLight.range":P.PERIOD_SCENE,"u_SpotLight.spot":P.PERIOD_SCENE,"u_SpotLight.color":P.PERIOD_SCENE};var a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};var i=P.add("PBRSpecular",t,e,true,true);var r=new ha(t,e);i.addSubShader(r);r.addShaderPass(ue,de,a,"Forward");r.addShaderPass(pe,fe,a,"ShadowCaster")}get specularTexture(){return this._shaderValues.getTexture(xa.SPECULARTEXTURE)}set specularTexture(t){if(t)this._shaderValues.addDefine(xa.SHADERDEFINE_SPECULARGLOSSTEXTURE);else this._shaderValues.removeDefine(xa.SHADERDEFINE_SPECULARGLOSSTEXTURE);this._shaderValues.setTexture(xa.SPECULARTEXTURE,t)}get specularColor(){return this._shaderValues.getVector(xa.SPECULARCOLOR)}set specularColor(t){this._shaderValues.setVector(xa.SPECULARCOLOR,t)}clone(){var t=new xa;this.cloneTo(t);return t}}xa.SPECULARTEXTURE=P.propertyNameToID("u_SpecGlossTexture");xa.SPECULARCOLOR=P.propertyNameToID("u_SpecularColor");var ca='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n#include "Shadow.glsl"\r\n#include "PBRFSInput.glsl";\r\n#include "LayaPBRBRDF.glsl";\r\n#include "GlobalIllumination.glsl";\r\n#include "PBRCore.glsl";\r\n\r\nvoid main()\r\n{\r\n\tfragmentForward();\r\n}';var da='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl"\r\n#include "Shadow.glsl"\r\n#include "PBRVSInput.glsl";\r\n#include "PBRVertex.glsl";\r\n\r\nvoid main()\r\n{\r\n\tvertexForward();\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var ua='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "ShadowCasterFS.glsl"\r\n\r\nvoid main()\r\n{\r\n\tgl_FragColor=shadowCasterFragment();\r\n}';var fa='#include "ShadowCasterVS.glsl"\r\n\r\nvoid main()\r\n{\r\n\tvec4 positionCS =  shadowCasterVertex();\r\n\tgl_Position=remapGLPositionZ(positionCS);\r\n}';(function(t){t[t["MetallicGlossTextureAlpha"]=0]="MetallicGlossTextureAlpha";t[t["AlbedoTextureAlpha"]=1]="AlbedoTextureAlpha"})(H.PBRMetallicSmoothnessSource||(H.PBRMetallicSmoothnessSource={}));class pa extends c{constructor(){super();this._smoothnessSource=0;this.setShaderName("PBR");this._shaderValues.setNumber(pa.METALLIC,0)}static __init__(){pa.SHADERDEFINE_METALLICGLOSSTEXTURE=P.getDefineByName("METALLICGLOSSTEXTURE");pa.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=P.getDefineByName("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA");var t={a_Position:K.MESH_POSITION0,a_Normal:K.MESH_NORMAL0,a_Tangent0:K.MESH_TANGENT0,a_Texcoord0:K.MESH_TEXTURECOORDINATE0,a_Texcoord1:K.MESH_TEXTURECOORDINATE1,a_BoneWeights:K.MESH_BLENDWEIGHT0,a_BoneIndices:K.MESH_BLENDINDICES0,a_MvpMatrix:K.MESH_MVPMATRIX_ROW0,a_WorldMat:K.MESH_WORLDMATRIX_ROW0};var e={u_Bones:P.PERIOD_CUSTOM,u_MvpMatrix:P.PERIOD_SPRITE,u_WorldMat:P.PERIOD_SPRITE,u_LightmapScaleOffset:P.PERIOD_SPRITE,u_LightMap:P.PERIOD_SPRITE,u_LightMapDirection:P.PERIOD_SPRITE,u_SimpleAnimatorTexture:P.PERIOD_SPRITE,u_SimpleAnimatorParams:P.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:P.PERIOD_SPRITE,u_ReflectCubeHDRParams:P.PERIOD_SPRITE,u_ReflectTexture:P.PERIOD_SPRITE,u_SpecCubeProbePosition:P.PERIOD_SPRITE,u_SpecCubeBoxMax:P.PERIOD_SPRITE,u_SpecCubeBoxMin:P.PERIOD_SPRITE,u_CameraPos:P.PERIOD_CAMERA,u_View:P.PERIOD_CAMERA,u_ProjectionParams:P.PERIOD_CAMERA,u_Viewport:P.PERIOD_CAMERA,u_ViewProjection:P.PERIOD_CAMERA,u_AlphaTestValue:P.PERIOD_MATERIAL,u_AlbedoColor:P.PERIOD_MATERIAL,u_EmissionColor:P.PERIOD_MATERIAL,u_AlbedoTexture:P.PERIOD_MATERIAL,u_NormalTexture:P.PERIOD_MATERIAL,u_ParallaxTexture:P.PERIOD_MATERIAL,u_OcclusionTexture:P.PERIOD_MATERIAL,u_EmissionTexture:P.PERIOD_MATERIAL,u_Smoothness:P.PERIOD_MATERIAL,u_SmoothnessScale:P.PERIOD_MATERIAL,u_occlusionStrength:P.PERIOD_MATERIAL,u_NormalScale:P.PERIOD_MATERIAL,u_ParallaxScale:P.PERIOD_MATERIAL,u_TilingOffset:P.PERIOD_MATERIAL,u_MetallicGlossTexture:P.PERIOD_MATERIAL,u_Metallic:P.PERIOD_MATERIAL,u_AmbientColor:P.PERIOD_SCENE,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE,u_DirationLightCount:P.PERIOD_SCENE,u_LightBuffer:P.PERIOD_SCENE,u_LightClusterBuffer:P.PERIOD_SCENE,u_ShadowBias:P.PERIOD_SCENE,u_ShadowLightDirection:P.PERIOD_SCENE,u_ShadowMap:P.PERIOD_SCENE,u_ShadowParams:P.PERIOD_SCENE,u_ShadowSplitSpheres:P.PERIOD_SCENE,u_ShadowMatrices:P.PERIOD_SCENE,u_ShadowMapSize:P.PERIOD_SCENE,u_SpotShadowMap:P.PERIOD_SCENE,u_SpotViewProjectMatrix:P.PERIOD_SCENE,u_ShadowLightPosition:P.PERIOD_SCENE,u_AmbientSHAr:P.PERIOD_SCENE,u_AmbientSHAg:P.PERIOD_SCENE,u_AmbientSHAb:P.PERIOD_SCENE,u_AmbientSHBr:P.PERIOD_SCENE,u_AmbientSHBg:P.PERIOD_SCENE,u_AmbientSHBb:P.PERIOD_SCENE,u_AmbientSHC:P.PERIOD_SCENE,"u_DirectionLight.direction":P.PERIOD_SCENE,"u_DirectionLight.color":P.PERIOD_SCENE,"u_PointLight.position":P.PERIOD_SCENE,"u_PointLight.range":P.PERIOD_SCENE,"u_PointLight.color":P.PERIOD_SCENE,"u_SpotLight.position":P.PERIOD_SCENE,"u_SpotLight.direction":P.PERIOD_SCENE,"u_SpotLight.range":P.PERIOD_SCENE,"u_SpotLight.spot":P.PERIOD_SCENE,"u_SpotLight.color":P.PERIOD_SCENE};var a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};var i=P.add("PBR",t,e,true,true);var r=new ha(t,e);i.addSubShader(r);r.addShaderPass(da,ca,a,"Forward");r.addShaderPass(fa,ua,a,"ShadowCaster")}get metallicGlossTexture(){return this._shaderValues.getTexture(pa.METALLICGLOSSTEXTURE)}set metallicGlossTexture(t){if(t)this._shaderValues.addDefine(pa.SHADERDEFINE_METALLICGLOSSTEXTURE);else this._shaderValues.removeDefine(pa.SHADERDEFINE_METALLICGLOSSTEXTURE);this._shaderValues.setTexture(pa.METALLICGLOSSTEXTURE,t)}get metallic(){return this._shaderValues.getNumber(pa.METALLIC)}set metallic(t){this._shaderValues.setNumber(pa.METALLIC,Math.max(0,Math.min(1,t)))}get smoothnessSource(){return this._smoothnessSource}set smoothnessSource(t){if(t)this._shaderValues.addDefine(pa.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA);else this._shaderValues.removeDefine(pa.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA);this._smoothnessSource=t}clone(){var t=new pa;this.cloneTo(t);return t}}pa.METALLICGLOSSTEXTURE=P.propertyNameToID("u_MetallicGlossTexture");pa.METALLIC=P.propertyNameToID("u_Metallic");class ma extends s{constructor(){super();this.setShaderName("SkyBox");this.tintColor=new bt(.5,.5,.5,.5);this.exposure=1;this.rotation=0}static __initDefine__(){}get tintColor(){return this._shaderValues.getVector(ma.TINTCOLOR)}set tintColor(t){this._shaderValues.setVector(ma.TINTCOLOR,t)}get exposure(){return this._shaderValues.getNumber(ma.EXPOSURE)}set exposure(t){this._shaderValues.setNumber(ma.EXPOSURE,t)}get rotation(){return this._shaderValues.getNumber(ma.ROTATION)}set rotation(t){this._shaderValues.setNumber(ma.ROTATION,t)}get textureCube(){return this._shaderValues.getTexture(ma.TEXTURECUBE)}set textureCube(t){this._shaderValues.setTexture(ma.TEXTURECUBE,t)}clone(){var t=new ma;this.cloneTo(t);return t}}ma.TINTCOLOR=P.propertyNameToID("u_TintColor");ma.EXPOSURE=P.propertyNameToID("u_Exposure");ma.ROTATION=P.propertyNameToID("u_Rotation");ma.TEXTURECUBE=P.propertyNameToID("u_CubeTexture");class ga extends s{constructor(){super();this.setShaderName("SkyBoxProcedural");this.sunDisk=ga.SUN_HIGH_QUALITY;this.sunSize=.04;this.sunSizeConvergence=5;this.atmosphereThickness=1;this.skyTint=new bt(.5,.5,.5,1);this.groundTint=new bt(.369,.349,.341,1);this.exposure=1.3}static __initDefine__(){ga.SHADERDEFINE_SUN_HIGH_QUALITY=P.getDefineByName("SUN_HIGH_QUALITY");ga.SHADERDEFINE_SUN_SIMPLE=P.getDefineByName("SUN_SIMPLE")}get sunDisk(){return this._sunDisk}set sunDisk(t){switch(t){case ga.SUN_HIGH_QUALITY:this._shaderValues.removeDefine(ga.SHADERDEFINE_SUN_SIMPLE);this._shaderValues.addDefine(ga.SHADERDEFINE_SUN_HIGH_QUALITY);break;case ga.SUN_SIMPLE:this._shaderValues.removeDefine(ga.SHADERDEFINE_SUN_HIGH_QUALITY);this._shaderValues.addDefine(ga.SHADERDEFINE_SUN_SIMPLE);break;case ga.SUN_NODE:this._shaderValues.removeDefine(ga.SHADERDEFINE_SUN_HIGH_QUALITY);this._shaderValues.removeDefine(ga.SHADERDEFINE_SUN_SIMPLE);break;default:throw"SkyBoxProceduralMaterial: unknown sun value."}this._sunDisk=t}get sunSize(){return this._shaderValues.getNumber(ga.SUNSIZE)}set sunSize(t){t=Math.min(Math.max(0,t),1);this._shaderValues.setNumber(ga.SUNSIZE,t)}get sunSizeConvergence(){return this._shaderValues.getNumber(ga.SUNSIZECONVERGENCE)}set sunSizeConvergence(t){t=Math.min(Math.max(0,t),20);this._shaderValues.setNumber(ga.SUNSIZECONVERGENCE,t)}get atmosphereThickness(){return this._shaderValues.getNumber(ga.ATMOSPHERETHICKNESS)}set atmosphereThickness(t){t=Math.min(Math.max(0,t),5);this._shaderValues.setNumber(ga.ATMOSPHERETHICKNESS,t)}get skyTint(){return this._shaderValues.getVector(ga.SKYTINT)}set skyTint(t){this._shaderValues.setVector(ga.SKYTINT,t)}get groundTint(){return this._shaderValues.getVector(ga.GROUNDTINT)}set groundTint(t){this._shaderValues.setVector(ga.GROUNDTINT,t)}get exposure(){return this._shaderValues.getNumber(ga.EXPOSURE)}set exposure(t){t=Math.min(Math.max(0,t),8);this._shaderValues.setNumber(ga.EXPOSURE,t)}clone(){var t=new ga;this.cloneTo(t);return t}}ga.SUN_NODE=0;ga.SUN_SIMPLE=1;ga.SUN_HIGH_QUALITY=2;ga.SUNSIZE=P.propertyNameToID("u_SunSize");ga.SUNSIZECONVERGENCE=P.propertyNameToID("u_SunSizeConvergence");ga.ATMOSPHERETHICKNESS=P.propertyNameToID("u_AtmosphereThickness");ga.SKYTINT=P.propertyNameToID("u_SkyTint");ga.GROUNDTINT=P.propertyNameToID("u_GroundTint");ga.EXPOSURE=P.propertyNameToID("u_Exposure");class u extends s{constructor(){super();this._albedoColor=new bt(1,1,1,1);this._albedoIntensity=1;this._enableVertexColor=false;this.setShaderName("Unlit");this._shaderValues.setVector(u.ALBEDOCOLOR,new bt(1,1,1,1));this.renderMode=u.RENDERMODE_OPAQUE}static __initDefine__(){u.SHADERDEFINE_ALBEDOTEXTURE=P.getDefineByName("ALBEDOTEXTURE");u.SHADERDEFINE_TILINGOFFSET=P.getDefineByName("TILINGOFFSET");u.SHADERDEFINE_ENABLEVERTEXCOLOR=P.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t;this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t;this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t;this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t;this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(u.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(u.ALBEDOCOLOR);bt.scale(this._albedoColor,t,e);this._albedoIntensity=t;this._shaderValues.setVector(u.ALBEDOCOLOR,e)}}get _MainTex_STX(){return this._shaderValues.getVector(u.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(u.TILINGOFFSET);e.x=t;this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(u.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(u.TILINGOFFSET);e.y=t;this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(u.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(u.TILINGOFFSET);e.z=t;this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(u.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(u.TILINGOFFSET);e.w=t;this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(u.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(u.ALBEDOCOLOR);bt.scale(t,this._albedoIntensity,e);this._albedoColor=t;this._shaderValues.setVector(u.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get albedoTexture(){return this._shaderValues.getTexture(u.ALBEDOTEXTURE)}set albedoTexture(t){if(t)this._shaderValues.addDefine(u.SHADERDEFINE_ALBEDOTEXTURE);else this._shaderValues.removeDefine(u.SHADERDEFINE_ALBEDOTEXTURE);this._shaderValues.setTexture(u.ALBEDOTEXTURE,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(u.TILINGOFFSET)}set tilingOffset(t){if(t){if(t.x!=1||t.y!=1||t.z!=0||t.w!=0)this._shaderValues.addDefine(u.SHADERDEFINE_TILINGOFFSET);else this._shaderValues.removeDefine(u.SHADERDEFINE_TILINGOFFSET)}else{this._shaderValues.removeDefine(u.SHADERDEFINE_TILINGOFFSET)}this._shaderValues.setVector(u.TILINGOFFSET,t)}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t;if(t)this._shaderValues.addDefine(u.SHADERDEFINE_ENABLEVERTEXCOLOR);else this._shaderValues.removeDefine(u.SHADERDEFINE_ENABLEVERTEXCOLOR)}set renderMode(t){switch(t){case u.RENDERMODE_OPAQUE:this.alphaTest=false;this.renderQueue=s.RENDERQUEUE_OPAQUE;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;break;case u.RENDERMODE_CUTOUT:this.renderQueue=s.RENDERQUEUE_ALPHATEST;this.alphaTest=true;this.depthWrite=true;this.cull=p.CULL_BACK;this.blend=p.BLEND_DISABLE;this.depthTest=p.DEPTHTEST_LESS;break;case u.RENDERMODE_TRANSPARENT:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_BACK;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LESS;break;default:throw new Error("UnlitMaterial : renderMode value error.")}}get depthWrite(){return this._shaderValues.getBool(u.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(u.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(u.CULL)}set cull(t){this._shaderValues.setInt(u.CULL,t)}get blend(){return this._shaderValues.getInt(u.BLEND)}set blend(t){this._shaderValues.setInt(u.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(u.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(u.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(u.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(u.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(u.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(u.DEPTH_TEST,t)}clone(){var t=new u;this.cloneTo(t);return t}}u.RENDERMODE_OPAQUE=0;u.RENDERMODE_CUTOUT=1;u.RENDERMODE_TRANSPARENT=2;u.RENDERMODE_ADDTIVE=3;u.ALBEDOTEXTURE=P.propertyNameToID("u_AlbedoTexture");u.ALBEDOCOLOR=P.propertyNameToID("u_AlbedoColor");u.TILINGOFFSET=P.propertyNameToID("u_TilingOffset");u.CULL=P.propertyNameToID("s_Cull");u.BLEND=P.propertyNameToID("s_Blend");u.BLEND_SRC=P.propertyNameToID("s_BlendSrc");u.BLEND_DST=P.propertyNameToID("s_BlendDst");u.DEPTH_TEST=P.propertyNameToID("s_DepthTest");u.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");class va extends s{constructor(){super();this.setShaderName("WaterPrimary");this._shaderValues.setVector(va.HORIZONCOLOR,new bt(.172,.463,.435,0));this._shaderValues.setNumber(va.WAVESCALE,.15);this._shaderValues.setVector(va.WAVESPEED,new bt(19,9,-16,-7))}static __initDefine__(){va.SHADERDEFINE_MAINTEXTURE=P.getDefineByName("MAINTEXTURE");va.SHADERDEFINE_NORMALTEXTURE=P.getDefineByName("NORMALTEXTURE")}get horizonColor(){return this._shaderValues.getVector(va.HORIZONCOLOR)}set horizonColor(t){this._shaderValues.setVector(va.HORIZONCOLOR,t)}get mainTexture(){return this._shaderValues.getTexture(va.MAINTEXTURE)}set mainTexture(t){if(t)this._shaderValues.addDefine(va.SHADERDEFINE_MAINTEXTURE);else this._shaderValues.removeDefine(va.SHADERDEFINE_MAINTEXTURE);this._shaderValues.setTexture(va.MAINTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(va.NORMALTEXTURE)}set normalTexture(t){if(t)this._shaderValues.addDefine(va.SHADERDEFINE_NORMALTEXTURE);else this._shaderValues.removeDefine(va.SHADERDEFINE_NORMALTEXTURE);this._shaderValues.setTexture(va.NORMALTEXTURE,t)}get waveScale(){return this._shaderValues.getNumber(va.WAVESCALE)}set waveScale(t){this._shaderValues.setNumber(va.WAVESCALE,t)}get waveSpeed(){return this._shaderValues.getVector(va.WAVESPEED)}set waveSpeed(t){this._shaderValues.setVector(va.WAVESPEED,t)}clone(){var t=new va;this.cloneTo(t);return t}}va.HORIZONCOLOR=P.propertyNameToID("u_HorizonColor");va.MAINTEXTURE=P.propertyNameToID("u_MainTexture");va.NORMALTEXTURE=P.propertyNameToID("u_NormalTexture");va.WAVESCALE=P.propertyNameToID("u_WaveScale");va.WAVESPEED=P.propertyNameToID("u_WaveSpeed");class ya{}class Ta extends qe{constructor(t){super(t);this._revertStaticBatchDefineUV1=false;this._projectionViewWorldMatrix=new k}_createRenderElement(){return new ze}_onMeshChange(t){if(t){var e=t.subMeshCount;this._renderElements.length=e;for(var a=0;a<e;a++){var i=this._renderElements[a];if(!i){var r=this.sharedMaterials[a];i=this._renderElements[a]=this._createRenderElement();i.setTransform(this._owner._transform);i.render=this;i.material=r?r:n.defaultMaterial}i.setGeometry(t.getSubMesh(a))}}else{this._renderElements.length=0}this._boundsChange=true}_calculateBoundingBox(){var t=this._owner.meshFilter.sharedMesh;if(t){var e=this._owner.transform.worldMatrix;t.bounds._tranform(e,this._bounds)}}_needRender(t,e){if(t)return t.intersects(this.bounds._getBoundBox());else return true}_renderUpdate(t,e){this._applyLightMapParams();var a=t.renderElement;switch(a.renderType){case ie.RENDERTYPE_NORMAL:this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,e.worldMatrix);break;case ie.RENDERTYPE_STATICBATCH:if(e)this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,e.worldMatrix);else this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,k.DEFAULT);if(!this._shaderValues.hasDefine(ya.SHADERDEFINE_UV1)){this._shaderValues.addDefine(ya.SHADERDEFINE_UV1);this._revertStaticBatchDefineUV1=true}else{this._revertStaticBatchDefineUV1=false}this._shaderValues.setVector(ke.LIGHTMAPSCALEOFFSET,qe._defaultLightmapScaleOffset);break;case ie.RENDERTYPE_VERTEXBATCH:this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,k.DEFAULT);break;case ie.RENDERTYPE_INSTANCEBATCH:var i=He.instance.instanceWorldMatrixData;var r=a.instanceBatchElementList;var s=r.elements;var n=r.length;for(var o=0;o<n;o++)i.set(s[o]._transform.worldMatrix.elements,o*16);var l=He.instance.instanceWorldMatrixBuffer;l.orphanStorage();l.setData(i.buffer,0,0,n*16*4);this._shaderValues.addDefine(ya.SHADERDEFINE_GPU_INSTANCE);break}if(!this._probReflection)return;if(this._reflectionMode==H.ReflectionProbeMode.off){this._shaderValues.removeDefine(ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);this._shaderValues.setVector(ke.REFLECTIONCUBE_HDR_PARAMS,je.defaultTextureHDRDecodeValues);this._shaderValues.setTexture(ke.REFLECTIONTEXTURE,De.blackTexture)}else{if(!this._probReflection.boxProjection){this._shaderValues.removeDefine(ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION)}else{this._shaderValues.addDefine(ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);this._shaderValues.setVector3(ke.REFLECTIONCUBE_PROBEPOSITION,this._probReflection.probePosition);this._shaderValues.setVector3(ke.REFLECTIONCUBE_PROBEBOXMAX,this._probReflection.boundsMax);this._shaderValues.setVector3(ke.REFLECTIONCUBE_PROBEBOXMIN,this._probReflection.boundsMin)}this._shaderValues.setTexture(ke.REFLECTIONTEXTURE,this._probReflection.reflectionTexture);this._shaderValues.setVector(ke.REFLECTIONCUBE_HDR_PARAMS,this._probReflection.reflectionHDRParams)}}_renderUpdateWithCamera(t,e){var a=t.projectionViewMatrix;if(a){var i=t.renderElement;switch(i.renderType){case ie.RENDERTYPE_NORMAL:case ie.RENDERTYPE_STATICBATCH:case ie.RENDERTYPE_VERTEXBATCH:if(e){k.multiply(a,e.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}else{this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,a)}break;case ie.RENDERTYPE_INSTANCEBATCH:var r=He.instance.instanceMVPMatrixData;var s=i.instanceBatchElementList;var n=s.elements;var o=s.length;for(var l=0;l<o;l++){var _=n[l]._transform.worldMatrix;F.mulMatrixByArray(a.elements,0,_.elements,0,r,l*16)}var h=He.instance.instanceMVPMatrixBuffer;h.orphanStorage();h.setData(r.buffer,0,0,o*16*4);break}}}_revertBatchRenderUpdate(t){var e=t.renderElement;switch(e.renderType){case ie.RENDERTYPE_STATICBATCH:if(this._revertStaticBatchDefineUV1)this._shaderValues.removeDefine(ya.SHADERDEFINE_UV1);this._shaderValues.setVector(ke.LIGHTMAPSCALEOFFSET,this.lightmapScaleOffset);break;case ie.RENDERTYPE_INSTANCEBATCH:this._shaderValues.removeDefine(ya.SHADERDEFINE_GPU_INSTANCE);break}}_destroy(){this._isPartOfStaticBatch&&Ye.instance._removeRenderSprite(this._owner);super._destroy()}}class Ea{constructor(t){this._owner=t}get sharedMesh(){return this._sharedMesh}set sharedMesh(t){if(this._sharedMesh!==t){var e=this._owner._render._shaderValues;var a=this._sharedMesh;if(a){a._removeReference();this._getMeshDefine(a,Ea._meshVerticeDefine);for(var i=0,r=Ea._meshVerticeDefine.length;i<r;i++)e.removeDefine(Ea._meshVerticeDefine[i])}if(t){t._addReference();this._getMeshDefine(t,Ea._meshVerticeDefine);for(var i=0,r=Ea._meshVerticeDefine.length;i<r;i++)e.addDefine(Ea._meshVerticeDefine[i])}this._owner._render._onMeshChange(t);this._sharedMesh=t}}_getMeshDefine(t,e){e.length=0;var a;for(var i=0,r=t._subMeshes.length;i<r;i++){var s=t.getSubMesh(i);var n=s._vertexBuffer._vertexDeclaration._vertexElements;for(var o=0,l=n.length;o<l;o++){var _=n[o];var h=_._elementUsage;switch(h){case K.MESH_COLOR0:e.push(ya.SHADERDEFINE_COLOR);break;case K.MESH_TEXTURECOORDINATE0:e.push(ya.SHADERDEFINE_UV0);break;case K.MESH_TEXTURECOORDINATE1:e.push(ya.SHADERDEFINE_UV1);break}}}return a}destroy(){this._owner=null;this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)}}Ea._meshVerticeDefine=[];class ba extends Fe{constructor(){super();this._bufferState=new Rt;var t=Et.LayaGL.instance;var e=K.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT");var a=e.vertexStride*ba.maxIndicesCount;this._vertices=new Float32Array(a/4);this._vertexBuffer=new vt(a,t.DYNAMIC_DRAW);this._indices=new Int16Array(ba.maxIndicesCount);this._indexBuffer=new jt(H.IndexFormat.UInt16,this._indices.length,t.DYNAMIC_DRAW);var i=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;Et.Resource._addMemory(i,i)}static __init__(){ba.instance=new ba}_getBatchVertices(t,e,a,i,r,s){var n=t.vertexStride/4;var o=s._vertexBuffer.getFloat32Data();var l=r.render.lightmapScaleOffset;var _=r._dynamicMultiSubMesh;var h=r._dynamicVertexCount;r._computeWorldPositionsAndNormals(this._positionOffset,this._normalOffset,_,h);var x=r._dynamicWorldPositions;var c=r._dynamicWorldNormals;var d=s._indices;for(var u=0;u<h;u++){var f=_?d[u]:u;var p=f*n;var m=(u+a)*n;var g=u*3;var v=m+this._positionOffset;e[v]=x[g];e[v+1]=x[g+1];e[v+2]=x[g+2];if(this._normalOffset!==-1){v=m+this._normalOffset;e[v]=c[g];e[v+1]=c[g+1];e[v+2]=c[g+2]}if(this._colorOffset!==-1){v=m+this._colorOffset;g=p+this._colorOffset;e[v]=o[g];e[v+1]=o[g+1];e[v+2]=o[g+2];e[v+3]=o[g+3]}if(this._uv0Offset!==-1){v=m+this._uv0Offset;g=p+this._uv0Offset;e[v]=o[g];e[v+1]=o[g+1]}if(this._sTangentOffset!==-1){v=m+this._sTangentOffset;g=p+this._sTangentOffset;e[v]=o[g];e[v+1]=o[g+1];e[v+2]=o[g+2];e[v+3]=o[g+3];v=m+this._sTangentOffset;g=p+this._sTangentOffset;e[v]=o[g];e[v+1]=o[g+1];e[v+2]=o[g+2];e[v+3]=o[g+3]}}}_getBatchIndices(t,e,a,i,r,s){var n=r._indices;var o,l,_;var h=i._isFrontFaceInvert;if(s){if(h){for(o=0,l=n.length;o<l;o+=3){_=e+o;var x=a+o;t[_]=x;t[_+1]=x+2;t[_+2]=x+1}}else{for(o=0,l=n.length;o<l;o+=3){_=e+o;x=a+o;t[_]=x;t[_+1]=x+1;t[_+2]=x+2}}}else{if(h){for(o=0,l=n.length;o<l;o+=3){_=e+o;t[_]=a+n[o];t[_+1]=a+n[o+2];t[_+2]=a+n[o+1]}}else{for(o=0,l=n.length;o<l;o+=3){_=e+o;t[_]=a+n[o];t[_+1]=a+n[o+1];t[_+2]=a+n[o+2]}}}}_flush(t,e){var a=Et.LayaGL.instance;this._vertexBuffer.setData(this._vertices.buffer,0,0,t*this._bufferState.vertexDeclaration.vertexStride);this._indexBuffer.setData(this._indices,0,0,e);a.drawElements(a.TRIANGLES,e,a.UNSIGNED_SHORT,0)}_prepareRender(t){var e=t.renderElement;var a=e.vertexBatchVertexDeclaration;this._bufferState=D.MeshRenderDynamicBatchManager.instance._getBufferState(a);this._positionOffset=a.getVertexElementByUsage(K.MESH_POSITION0)._offset/4;var i=a.getVertexElementByUsage(K.MESH_NORMAL0);this._normalOffset=i?i._offset/4:-1;var r=a.getVertexElementByUsage(K.MESH_COLOR0);this._colorOffset=r?r._offset/4:-1;var s=a.getVertexElementByUsage(K.MESH_TEXTURECOORDINATE0);this._uv0Offset=s?s._offset/4:-1;var n=a.getVertexElementByUsage(K.MESH_TEXTURECOORDINATE1);this._uv1Offset=n?n._offset/4:-1;var o=a.getVertexElementByUsage(K.MESH_TANGENT0);this._sTangentOffset=o?o._offset/4:-1;return true}_render(t){this._bufferState.bind();var e=t.renderElement;var a=e.vertexBatchVertexDeclaration;var i=e.vertexBatchElementList;var r=0;var s=0;var n=a.vertexStride/4;var o=0;var l=i.length;var _=i.elements;for(var h=0;h<l;h++){var x=_[h];var c=x._geometry;var d=c._indexCount;if(s+d>ba.maxIndicesCount){this._flush(r,s);o++;Et.Stat.trianglesFaces+=s/3;r=s=0}var u=x._transform;this._getBatchVertices(a,this._vertices,r,u,x,c);this._getBatchIndices(this._indices,s,r,u,c,x._dynamicMultiSubMesh);r+=x._dynamicVertexCount;s+=d}this._flush(r,s);o++;Et.Stat.renderBatches+=o;Et.Stat.savedRenderBatches+=l-o;Et.Stat.trianglesFaces+=s/3}}ba.maxAllowVertexCount=10;ba.maxAllowAttribueCount=900;ba.maxIndicesCount=32e3;class Sa extends na{constructor(){super();this._instanceBatchOpaqueMarks=[];this._vertexBatchOpaqueMarks=[];this._cacheBufferStates=[];this._updateCountMark=0}getInstanceBatchOpaquaMark(t,e,a,i){var r=this._instanceBatchOpaqueMarks[t?0:1]||(this._instanceBatchOpaqueMarks[t?0:1]=[]);var s=r[e]||(r[e]=[]);var n=s[a]||(s[a]=[]);return n[i?1:0]||(n[i?1:0]=new Ge)}getVertexBatchOpaquaMark(t,e,a,i){var r=this._vertexBatchOpaqueMarks[t]||(this._vertexBatchOpaqueMarks[t]=[]);var s=r[e?0:1]||(r[e?0:1]=[]);var n=s[a]||(s[a]=[]);return n[i]||(n[i]=new Ge)}_getBufferState(t){var e=this._cacheBufferStates[t.id];if(!e){var a=ba.instance;e=new Rt;e.bind();var i=a._vertexBuffer;i.vertexDeclaration=t;e.applyVertexBuffer(i);e.applyIndexBuffer(a._indexBuffer);e.unBind();this._cacheBufferStates[t.id]=e}return e}_getBatchRenderElementFromPool(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];if(!t){t=new ze;this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t;t.vertexBatchElementList=new e;t.instanceBatchElementList=new e}return t}_clear(){super._clear();this._updateCountMark++}}Sa.instance=new Sa;class Ca extends ke{constructor(t=null,e=null){super(e);this._meshFilter=new Ea(this);this._render=new Ta(this);t&&(this._meshFilter.sharedMesh=t)}static __init__(){ya.SHADERDEFINE_UV0=P.getDefineByName("UV");ya.SHADERDEFINE_COLOR=P.getDefineByName("COLOR");ya.SHADERDEFINE_UV1=P.getDefineByName("UV1");ya.SHADERDEFINE_GPU_INSTANCE=P.getDefineByName("GPU_INSTANCE");ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION=P.getDefineByName("SPECCUBE_BOX_PROJECTION");We._registerManager(Ye.instance);na._registerManager(Sa.instance)}get meshFilter(){return this._meshFilter}get meshRenderer(){return this._render}_parse(t,e){super._parse(t,e);var a=this.meshRenderer;var i=t.lightmapIndex;i!=null&&(a.lightmapIndex=i);var r=t.lightmapScaleOffset;r&&(a.lightmapScaleOffset=new bt(r[0],r[1],r[2],r[3]));t.meshPath!=undefined&&(this.meshFilter.sharedMesh=Et.Loader.getRes(t.meshPath));t.enableRender!=undefined&&(a.enable=t.enableRender);t.receiveShadows!=undefined&&(a.receiveShadow=t.receiveShadows);t.castShadow!=undefined&&(a.castShadow=t.castShadow);var s=t.materials;if(s){var n=a.sharedMaterials;var o=s.length;n.length=o;for(var l=0;l<o;l++){n[l]=Et.Loader.getRes(s[l].path)}a.sharedMaterials=n}}_addToInitStaticBatchManager(){if(this.meshFilter.sharedMesh)Ye.instance._addBatchSprite(this)}_cloneTo(t,e,a){var i=t;i._meshFilter.sharedMesh=this._meshFilter.sharedMesh;var r=this._render;var s=i._render;s.enable=r.enable;s.sharedMaterials=r.sharedMaterials;s.castShadow=r.castShadow;var n=r.lightmapScaleOffset;n&&(s.lightmapScaleOffset=n.clone());s.lightmapIndex=r.lightmapIndex;s.receiveShadow=r.receiveShadow;s.sortingFudge=r.sortingFudge;super._cloneTo(t,e,a)}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._meshFilter.destroy()}_create(){return new Ca}}class Ra{}Ra.Blend=0;Ra.Fixed=1;class Aa{constructor(t,e){this._mode=0;this._maxColorRGBKeysCount=0;this._maxColorAlphaKeysCount=0;this._colorRGBKeysCount=0;this._colorAlphaKeysCount=0;this._alphaElements=null;this._rgbElements=null;this._maxColorRGBKeysCount=t;this._maxColorAlphaKeysCount=e;this._rgbElements=new Float32Array(t*4);this._alphaElements=new Float32Array(e*2)}get mode(){return this._mode}set mode(t){this._mode=t}get colorRGBKeysCount(){return this._colorRGBKeysCount}get colorAlphaKeysCount(){return this._colorAlphaKeysCount}get maxColorRGBKeysCount(){return this._maxColorRGBKeysCount}get maxColorAlphaKeysCount(){return this._maxColorAlphaKeysCount}addColorRGB(t,e){if(this._colorRGBKeysCount<this._maxColorRGBKeysCount){var a=this._colorRGBKeysCount*4;this._rgbElements[a]=t;this._rgbElements[a+1]=e.r;this._rgbElements[a+2]=e.g;this._rgbElements[a+3]=e.b;this._colorRGBKeysCount++}else{console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorRGBKeysCount)}}addColorAlpha(t,e){if(this._colorAlphaKeysCount<this._maxColorAlphaKeysCount){var a=this._colorAlphaKeysCount*2;this._alphaElements[a]=t;this._alphaElements[a+1]=e;this._colorAlphaKeysCount++}else{console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorAlphaKeysCount)}}updateColorRGB(t,e,a){if(t<this._colorRGBKeysCount){var i=t*4;this._rgbElements[i]=e;this._rgbElements[i+1]=a.r;this._rgbElements[i+2]=a.g;this._rgbElements[i+3]=a.b}else{console.warn("Gradient:warning:index must lessEqual than colorRGBKeysCount:"+this._colorRGBKeysCount)}}updateColorAlpha(t,e,a){if(t<this._colorAlphaKeysCount){var i=t*2;this._alphaElements[i]=e;this._alphaElements[i+1]=a}else{console.warn("Gradient:warning:index must lessEqual than colorAlphaKeysCount:"+this._colorAlphaKeysCount)}}evaluateColorRGB(t,e,a=0,i=false){t=Math.min(Math.max(t,0),1);var r=this._rgbElements;var s=a;if(i){for(var n=s;n>=0;n--){var o=n*4;var l=r[o];if(t===l){e.r=r[o+1];e.g=r[o+2];e.b=r[o+3];return s}switch(this._mode){case Ra.Blend:if(t>l){var _=r[o+4];if(t>_)throw"Gradient:wrong startSearchIndex.";var h=_-l;var x=_-t;var c=t-l;e.r=(x*r[o+1]+c*r[o+5])/h;e.g=(x*r[o+2]+c*r[o+6])/h;e.b=(x*r[o+3]+c*r[o+7])/h;return s}else{s--;continue}case Ra.Fixed:if(t>l){if(t>r[o+4])throw"Gradient:wrong startSearchIndex.";e.r=r[o+5];e.g=r[o+6];e.b=r[o+7];return s}else{s--;continue}default:throw"Gradient:unknown mode."}}}else{for(var n=0,d=this._rgbElements.length;n<d;n++){o=n*4;var _=r[o];if(t===_){e.r=r[o+1];e.g=r[o+2];e.b=r[o+3];return s}switch(this._mode){case Ra.Blend:if(t<_){var l=r[o-4];if(t<l)throw"Gradient:wrong startSearchIndex.";var h=_-l;var x=_-t;var c=t-l;e.r=(x*r[o-3]+c*r[o+1])/h;e.g=(x*r[o-2]+c*r[o+2])/h;e.b=(x*r[o-1]+c*r[o+3])/h;return s}else{s++;continue}case Ra.Fixed:if(t<_){if(t<r[o-4])throw"Gradient:wrong startSearchIndex.";e.r=r[o+1];e.g=r[o+2];e.b=r[o+3];return s}else{s++;continue}default:throw"Gradient:unknown mode."}}}return s}evaluateColorAlpha(t,e,a=0,i=false){t=Math.min(Math.max(t,0),1);var r=this._alphaElements;var s=a;if(i){for(var n=s;n>=0;n--){var o=n*2;var l=r[o];if(t===l){e.a=r[o+1];return s}switch(this._mode){case Ra.Blend:if(t>l){var _=r[o+2];if(t>_)throw"Gradient:wrong startSearchIndex.";var h=_-l;var x=_-t;var c=t-l;e.a=(x*r[o+1]+c*r[o+3])/h;return s}else{s--;continue}case Ra.Fixed:if(t>l){if(t>r[o+2])throw"Gradient:wrong startSearchIndex.";e.a=r[o+3];return s}else{s--;continue}default:throw"Gradient:unknown mode."}}}else{for(var n=s,d=this._alphaElements.length;n<d;n++){var o=n*2;var _=r[o];if(t===_){e.a=r[o+1];return s}switch(this._mode){case Ra.Blend:if(t<_){var l=r[o-2];if(t<l)throw"Gradient:wrong startSearchIndex.";var h=_-l;var x=_-t;var c=t-l;e.a=(x*r[o-1]+c*r[o+1])/h;return s}else{s++;continue}case Ra.Fixed:if(t<_){if(t<r[o-2])throw"Gradient:wrong startSearchIndex.";e.a=r[o+1];return s}else{s++;continue}default:throw"Gradient:unknown mode."}}}return s}cloneTo(t){var e=t;var a,i;e._colorAlphaKeysCount=this._colorAlphaKeysCount;var r=e._alphaElements;for(a=0,i=this._alphaElements.length;a<i;a++)r[a]=this._alphaElements[a];e._colorRGBKeysCount=this._colorRGBKeysCount;var s=e._rgbElements;for(a=0,i=this._rgbElements.length;a<i;a++)s[a]=this._rgbElements[a]}clone(){var t=new Aa(this._maxColorRGBKeysCount,this._maxColorAlphaKeysCount);this.cloneTo(t);return t}}class La{constructor(t,e,a){this._time=t;this._minCount=e;this._maxCount=a}get time(){return this._time}get minCount(){return this._minCount}get maxCount(){return this._maxCount}cloneTo(t){var e=t;e._time=this._time;e._minCount=this._minCount;e._maxCount=this._maxCount}clone(){var t=new La(this._time,this._minCount,this._maxCount);this.cloneTo(t);return t}}class Ia{constructor(){this._type=0;this._constant=null;this._constantMin=null;this._constantMax=null;this._gradient=null;this._gradientMin=null;this._gradientMax=null}static createByConstant(t){var e=new Ia;e._type=0;e._constant=t;return e}static createByGradient(t){var e=new Ia;e._type=1;e._gradient=t;return e}static createByRandomTwoConstant(t,e){var a=new Ia;a._type=2;a._constantMin=t;a._constantMax=e;return a}static createByRandomTwoGradient(t,e){var a=new Ia;a._type=3;a._gradientMin=t;a._gradientMax=e;return a}get type(){return this._type}get constant(){return this._constant}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get gradient(){return this._gradient}get gradientMin(){return this._gradientMin}get gradientMax(){return this._gradientMax}cloneTo(t){var e=t;e._type=this._type;this._constant.cloneTo(e._constant);this._constantMin.cloneTo(e._constantMin);this._constantMax.cloneTo(e._constantMax);this._gradient.cloneTo(e._gradient);this._gradientMin.cloneTo(e._gradientMin);this._gradientMax.cloneTo(e._gradientMax)}clone(){var t=new Ia;this.cloneTo(t);return t}}class Ma{constructor(t){this._color=t}get color(){return this._color}cloneTo(t){var e=t;this._color.cloneTo(e._color);e.enable=this.enable}clone(){var t;switch(this._color.type){case 0:t=Ia.createByConstant(this._color.constant.clone());break;case 1:t=Ia.createByGradient(this._color.gradient.clone());break;case 2:t=Ia.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=Ia.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone());break}var e=new Ma(t);e.enable=this.enable;return e}}class Da{constructor(){this._type=0;this._constant=0;this._overTime=null;this._constantMin=0;this._constantMax=0;this._overTimeMin=null;this._overTimeMax=null}static createByConstant(t=0){var e=new Da;e._type=0;e._constant=t;return e}static createByOverTime(t){var e=new Da;e._type=1;e._overTime=t;return e}static createByRandomTwoConstant(t=0,e=0){var a=new Da;a._type=2;a._constantMin=t;a._constantMax=e;return a}static createByRandomTwoOverTime(t,e){var a=new Da;a._type=3;a._overTimeMin=t;a._overTimeMax=e;return a}get type(){return this._type}get constant(){return this._constant}get frameOverTimeData(){return this._overTime}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get frameOverTimeDataMin(){return this._overTimeMin}get frameOverTimeDataMax(){return this._overTimeMax}cloneTo(t){var e=t;e._type=this._type;e._constant=this._constant;this._overTime&&this._overTime.cloneTo(e._overTime);e._constantMin=this._constantMin;e._constantMax=this._constantMax;this._overTimeMin&&this._overTimeMin.cloneTo(e._overTimeMin);this._overTimeMax&&this._overTimeMax.cloneTo(e._overTimeMax)}clone(){var t=new Da;this.cloneTo(t);return t}}class wa{constructor(){this._type=0;this._separateAxes=false;this._constant=0;this._constantSeparate=null;this._gradient=null;this._gradientX=null;this._gradientY=null;this._gradientZ=null;this._gradientW=null;this._constantMin=0;this._constantMax=0;this._constantMinSeparate=null;this._constantMaxSeparate=null;this._gradientMin=null;this._gradientMax=null;this._gradientXMin=null;this._gradientXMax=null;this._gradientYMin=null;this._gradientYMax=null;this._gradientZMin=null;this._gradientZMax=null;this._gradientWMin=null;this._gradientWMax=null}static createByConstant(t){var e=new wa;e._type=0;e._separateAxes=false;e._constant=t;return e}static createByConstantSeparate(t){var e=new wa;e._type=0;e._separateAxes=true;e._constantSeparate=t;return e}static createByGradient(t){var e=new wa;e._type=1;e._separateAxes=false;e._gradient=t;return e}static createByGradientSeparate(t,e,a){var i=new wa;i._type=1;i._separateAxes=true;i._gradientX=t;i._gradientY=e;i._gradientZ=a;return i}static createByRandomTwoConstant(t,e){var a=new wa;a._type=2;a._separateAxes=false;a._constantMin=t;a._constantMax=e;return a}static createByRandomTwoConstantSeparate(t,e){var a=new wa;a._type=2;a._separateAxes=true;a._constantMinSeparate=t;a._constantMaxSeparate=e;return a}static createByRandomTwoGradient(t,e){var a=new wa;a._type=3;a._separateAxes=false;a._gradientMin=t;a._gradientMax=e;return a}static createByRandomTwoGradientSeparate(t,e,a,i,r,s,n,o){var l=new wa;l._type=3;l._separateAxes=true;l._gradientXMin=t;l._gradientXMax=e;l._gradientYMin=a;l._gradientYMax=i;l._gradientZMin=r;l._gradientZMax=s;l._gradientWMin=n;l._gradientWMax=o;return l}get type(){return this._type}get separateAxes(){return this._separateAxes}get constant(){return this._constant}get constantSeparate(){return this._constantSeparate}get gradient(){return this._gradient}get gradientX(){return this._gradientX}get gradientY(){return this._gradientY}get gradientZ(){return this._gradientZ}get gradientW(){return this._gradientW}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get constantMinSeparate(){return this._constantMinSeparate}get constantMaxSeparate(){return this._constantMaxSeparate}get gradientMin(){return this._gradientMin}get gradientMax(){return this._gradientMax}get gradientXMin(){return this._gradientXMin}get gradientXMax(){return this._gradientXMax}get gradientYMin(){return this._gradientYMin}get gradientYMax(){return this._gradientYMax}get gradientZMin(){return this._gradientZMin}get gradientZMax(){return this._gradientZMax}get gradientWMin(){return this._gradientWMin}get gradientWMax(){return this._gradientWMax}cloneTo(t){var e=t;e._type=this._type;e._separateAxes=this._separateAxes;e._constant=this._constant;this._constantSeparate.cloneTo(e._constantSeparate);this._gradient.cloneTo(e._gradient);this._gradientX.cloneTo(e._gradientX);this._gradientY.cloneTo(e._gradientY);this._gradientZ.cloneTo(e._gradientZ);e._constantMin=this._constantMin;e._constantMax=this._constantMax;this._constantMinSeparate.cloneTo(e._constantMinSeparate);this._constantMaxSeparate.cloneTo(e._constantMaxSeparate);this._gradientMin.cloneTo(e._gradientMin);this._gradientMax.cloneTo(e._gradientMax);this._gradientXMin.cloneTo(e._gradientXMin);this._gradientXMax.cloneTo(e._gradientXMax);this._gradientYMin.cloneTo(e._gradientYMin);this._gradientYMax.cloneTo(e._gradientYMax);this._gradientZMin.cloneTo(e._gradientZMin);this._gradientZMax.cloneTo(e._gradientZMax)}clone(){var t=new wa;this.cloneTo(t);return t}}class Pa{constructor(){this._currentLength=0;this._elements=new Float32Array(8)}get gradientCount(){return this._currentLength/2}add(t,e){if(this._currentLength<8){if(this._currentLength===6&&t!==1){t=1;console.log("Warning:the forth key is  be force set to 1.")}this._elements[this._currentLength++]=t;this._elements[this._currentLength++]=e}else{console.log("Warning:data count must lessEqual than 4")}}cloneTo(t){var e=t;e._currentLength=this._currentLength;var a=e._elements;for(var i=0,r=this._elements.length;i<r;i++){a[i]=this._elements[i]}}clone(){var t=new Pa;this.cloneTo(t);return t}}class Oa{constructor(){this._currentLength=0;this._elements=new Float32Array(8)}get gradientCount(){return this._currentLength/2}add(t,e){if(this._currentLength<8){if(this._currentLength===6&&t!==1){t=1;console.log("GradientDataNumber warning:the forth key is  be force set to 1.")}this._elements[this._currentLength++]=t;this._elements[this._currentLength++]=e}else{console.log("GradientDataNumber warning:data count must lessEqual than 4")}}getKeyByIndex(t){return this._elements[t*2]}getValueByIndex(t){return this._elements[t*2+1]}getAverageValue(){var t=0;var e=0;for(var a=0,i=this._currentLength-2;a<i;a+=2){var r=this._elements[a+1];r+=this._elements[a+3];r=r*(this._elements[a+2]-this._elements[a]);t+=r;e++}return t/e}cloneTo(t){var e=t;e._currentLength=this._currentLength;var a=e._elements;for(var i=0,r=this._elements.length;i<r;i++)a[i]=this._elements[i]}clone(){var t=new Oa;this.cloneTo(t);return t}}class Na{constructor(){this._type=0;this._separateAxes=false;this._gradient=null;this._gradientX=null;this._gradientY=null;this._gradientZ=null;this._constantMin=0;this._constantMax=0;this._constantMinSeparate=null;this._constantMaxSeparate=null;this._gradientMin=null;this._gradientMax=null;this._gradientXMin=null;this._gradientXMax=null;this._gradientYMin=null;this._gradientYMax=null;this._gradientZMin=null;this._gradientZMax=null}static createByGradient(t){var e=new Na;e._type=0;e._separateAxes=false;e._gradient=t;return e}static createByGradientSeparate(t,e,a){var i=new Na;i._type=0;i._separateAxes=true;i._gradientX=t;i._gradientY=e;i._gradientZ=a;return i}static createByRandomTwoConstant(t,e){var a=new Na;a._type=1;a._separateAxes=false;a._constantMin=t;a._constantMax=e;return a}static createByRandomTwoConstantSeparate(t,e){var a=new Na;a._type=1;a._separateAxes=true;a._constantMinSeparate=t;a._constantMaxSeparate=e;return a}static createByRandomTwoGradient(t,e){var a=new Na;a._type=2;a._separateAxes=false;a._gradientMin=t;a._gradientMax=e;return a}static createByRandomTwoGradientSeparate(t,e,a,i,r,s){var n=new Na;n._type=2;n._separateAxes=true;n._gradientXMin=t;n._gradientXMax=e;n._gradientYMin=a;n._gradientYMax=i;n._gradientZMin=r;n._gradientZMax=s;return n}get type(){return this._type}get separateAxes(){return this._separateAxes}get gradient(){return this._gradient}get gradientX(){return this._gradientX}get gradientY(){return this._gradientY}get gradientZ(){return this._gradientZ}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get constantMinSeparate(){return this._constantMinSeparate}get constantMaxSeparate(){return this._constantMaxSeparate}get gradientMin(){return this._gradientMin}get gradientMax(){return this._gradientMax}get gradientXMin(){return this._gradientXMin}get gradientXMax(){return this._gradientXMax}get gradientYMin(){return this._gradientYMin}get gradientYMax(){return this._gradientYMax}get gradientZMin(){return this._gradientZMin}get gradientZMax(){return this._gradientZMax}getMaxSizeInGradient(t=false){var e,a;var i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(e=0,a=this._gradientX.gradientCount;e<a;e++)i=Math.max(i,this._gradientX.getValueByIndex(e));for(e=0,a=this._gradientY.gradientCount;e<a;e++)i=Math.max(i,this._gradientY.getValueByIndex(e));if(t){for(e=0,a=this._gradientZ.gradientCount;e<a;e++){i=Math.max(i,this._gradientZ.getValueByIndex(e))}}}else{for(e=0,a=this._gradient.gradientCount;e<a;e++)i=Math.max(i,this._gradient.getValueByIndex(e))}break;case 1:if(this._separateAxes){i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x);i=Math.max(i,this._constantMinSeparate.y);if(t){i=i=Math.max(i,this._constantMaxSeparate.z)}}else{i=Math.max(this._constantMin,this._constantMax)}break;case 2:if(this._separateAxes){for(e=0,a=this._gradientXMin.gradientCount;e<a;e++)i=Math.max(i,this._gradientXMin.getValueByIndex(e));for(e=0,a=this._gradientXMax.gradientCount;e<a;e++)i=Math.max(i,this._gradientXMax.getValueByIndex(e));for(e=0,a=this._gradientYMin.gradientCount;e<a;e++)i=Math.max(i,this._gradientYMin.getValueByIndex(e));for(e=0,a=this._gradientZMax.gradientCount;e<a;e++)i=Math.max(i,this._gradientZMax.getValueByIndex(e));if(t){for(e=0,a=this._gradientZMin.gradientCount;e<a;e++){i=Math.max(i,this._gradientZMin.getValueByIndex(e))}for(e=0,a=this._gradientZMax.gradientCount;e<a;e++){i=Math.max(i,this._gradientZMax.getValueByIndex(e))}}}else{for(e=0,a=this._gradientMin.gradientCount;e<a;e++)i=Math.max(i,this._gradientMin.getValueByIndex(e));for(e=0,a=this._gradientMax.gradientCount;e<a;e++)i=Math.max(i,this._gradientMax.getValueByIndex(e))}break}return i}cloneTo(t){var e=t;e._type=this._type;e._separateAxes=this._separateAxes;this._gradient.cloneTo(e._gradient);this._gradientX.cloneTo(e._gradientX);this._gradientY.cloneTo(e._gradientY);this._gradientZ.cloneTo(e._gradientZ);e._constantMin=this._constantMin;e._constantMax=this._constantMax;this._constantMinSeparate.cloneTo(e._constantMinSeparate);this._constantMaxSeparate.cloneTo(e._constantMaxSeparate);this._gradientMin.cloneTo(e._gradientMin);this._gradientMax.cloneTo(e._gradientMax);this._gradientXMin.cloneTo(e._gradientXMin);this._gradientXMax.cloneTo(e._gradientXMax);this._gradientYMin.cloneTo(e._gradientYMin);this._gradientYMax.cloneTo(e._gradientYMax);this._gradientZMin.cloneTo(e._gradientZMin);this._gradientZMax.cloneTo(e._gradientZMax)}clone(){var t=new Na;this.cloneTo(t);return t}}class Ba{constructor(){this._type=0;this._constant=null;this._gradientX=null;this._gradientY=null;this._gradientZ=null;this._constantMin=null;this._constantMax=null;this._gradientXMin=null;this._gradientXMax=null;this._gradientYMin=null;this._gradientYMax=null;this._gradientZMin=null;this._gradientZMax=null}static createByConstant(t){var e=new Ba;e._type=0;e._constant=t;return e}static createByGradient(t,e,a){var i=new Ba;i._type=1;i._gradientX=t;i._gradientY=e;i._gradientZ=a;return i}static createByRandomTwoConstant(t,e){var a=new Ba;a._type=2;a._constantMin=t;a._constantMax=e;return a}static createByRandomTwoGradient(t,e,a,i,r,s){var n=new Ba;n._type=3;n._gradientXMin=t;n._gradientXMax=e;n._gradientYMin=a;n._gradientYMax=i;n._gradientZMin=r;n._gradientZMax=s;return n}get type(){return this._type}get constant(){return this._constant}get gradientX(){return this._gradientX}get gradientY(){return this._gradientY}get gradientZ(){return this._gradientZ}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get gradientXMin(){return this._gradientXMin}get gradientXMax(){return this._gradientXMax}get gradientYMin(){return this._gradientYMin}get gradientYMax(){return this._gradientYMax}get gradientZMin(){return this._gradientZMin}get gradientZMax(){return this._gradientZMax}cloneTo(t){var e=t;e._type=this._type;this._constant.cloneTo(e._constant);this._gradientX.cloneTo(e._gradientX);this._gradientY.cloneTo(e._gradientY);this._gradientZ.cloneTo(e._gradientZ);this._constantMin.cloneTo(e._constantMin);this._constantMax.cloneTo(e._constantMax);this._gradientXMin.cloneTo(e._gradientXMin);this._gradientXMax.cloneTo(e._gradientXMax);this._gradientYMin.cloneTo(e._gradientYMin);this._gradientYMax.cloneTo(e._gradientYMax);this._gradientZMin.cloneTo(e._gradientZMin);this._gradientZMax.cloneTo(e._gradientZMax)}clone(){var t=new Ba;this.cloneTo(t);return t}}class Fa{constructor(t){this._angularVelocity=t}get angularVelocity(){return this._angularVelocity}cloneTo(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity);e.enable=this.enable}clone(){var t;switch(this._angularVelocity.type){case 0:if(this._angularVelocity.separateAxes)t=wa.createByConstantSeparate(this._angularVelocity.constantSeparate.clone());else t=wa.createByConstant(this._angularVelocity.constant);break;case 1:if(this._angularVelocity.separateAxes)t=wa.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone());else t=wa.createByGradient(this._angularVelocity.gradient.clone());break;case 2:if(this._angularVelocity.separateAxes)t=wa.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone());else t=wa.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:if(this._angularVelocity.separateAxes)t=wa.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone());else t=wa.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone());break}var e=new Fa(t);e.enable=this.enable;return e}}(function(t){t[t["Box"]=0]="Box";t[t["Circle"]=1]="Circle";t[t["Cone"]=2]="Cone";t[t["Hemisphere"]=3]="Hemisphere";t[t["Sphere"]=4]="Sphere"})(H.ParticleSystemShapeType||(H.ParticleSystemShapeType={}));class Va{constructor(){this.enable=true;this.randomDirection=0}_getShapeBoundBox(t){throw new Error("BaseShape: must override it.")}_getSpeedBoundBox(t){throw new Error("BaseShape: must override it.")}generatePositionAndDirection(t,e,a=null,i=null){throw new Error("BaseShape: must override it.")}_calculateProceduralBounds(t,e,a){this._getShapeBoundBox(t);var i=t.min;var r=t.max;St.multiply(i,e,i);St.multiply(r,e,r);var s=new Ne(new St,new St);if(this.randomDirection){s.min=new St(-1,-1,-1);s.max=new St(1,1,1)}else{this._getSpeedBoundBox(s)}var n=new Ne(new St,new St);var o=n.min;var l=n.max;St.scale(s.min,a.y,o);St.scale(s.max,a.y,l);St.add(t.min,o,o);St.add(t.max,l,l);St.min(t.min,o,t.min);St.max(t.max,o,t.max);var _=new Ne(new St,new St);var h=_.min;var x=_.max;St.scale(s.min,a.x,h);St.scale(s.max,a.x,x);St.min(_.min,x,o);St.max(_.min,x,l);St.min(t.min,o,t.min);St.max(t.max,o,t.max)}cloneTo(t){var e=t;e.enable=this.enable}clone(){var t=new Va;this.cloneTo(t);return t}}class Ua{static _randomPointUnitArcCircle(t,e,a=null){var i;if(a)i=a.getFloat()*t;else i=Math.random()*t;e.x=Math.cos(i);e.y=Math.sin(i)}static _randomPointInsideUnitArcCircle(t,e,a=null){Ua._randomPointUnitArcCircle(t,e,a);var i;if(a)i=Math.pow(a.getFloat(),1/2);else i=Math.pow(Math.random(),1/2);e.x=e.x*i;e.y=e.y*i}static _randomPointUnitCircle(t,e=null){var a;if(e)a=e.getFloat()*Math.PI*2;else a=Math.random()*Math.PI*2;t.x=Math.cos(a);t.y=Math.sin(a)}static _randomPointInsideUnitCircle(t,e=null){Ua._randomPointUnitCircle(t);var a;if(e)a=Math.pow(e.getFloat(),1/2);else a=Math.pow(Math.random(),1/2);t.x=t.x*a;t.y=t.y*a}static _randomPointUnitSphere(t,e=null){var a;var i;if(e){a=t.z=e.getFloat()*2-1;i=e.getFloat()*Math.PI*2}else{a=t.z=Math.random()*2-1;i=Math.random()*Math.PI*2}var r=Math.sqrt(1-a*a);t.x=r*Math.cos(i);t.y=r*Math.sin(i)}static _randomPointInsideUnitSphere(t,e=null){Ua._randomPointUnitSphere(t);var a;if(e)a=Math.pow(e.getFloat(),1/3);else a=Math.pow(Math.random(),1/3);t.x=t.x*a;t.y=t.y*a;t.z=t.z*a}static _randomPointInsideHalfUnitBox(t,e=null){if(e){t.x=e.getFloat()-.5;t.y=e.getFloat()-.5;t.z=e.getFloat()-.5}else{t.x=Math.random()-.5;t.y=Math.random()-.5;t.z=Math.random()-.5}}constructor(){}}class ka extends Va{constructor(){super();this.shapeType=H.ParticleSystemShapeType.Box;this.x=1;this.y=1;this.z=1}_getShapeBoundBox(t){var e=t.min;e.x=-this.x*.5;e.y=-this.y*.5;e.z=-this.z*.5;var a=t.max;a.x=this.x*.5;a.y=this.y*.5;a.z=this.z*.5}_getSpeedBoundBox(t){var e=t.min;e.x=0;e.y=0;e.z=0;var a=t.max;a.x=0;a.y=1;a.z=0}generatePositionAndDirection(t,e,a=null,i=null){if(a){a.seed=i[16];Ua._randomPointInsideHalfUnitBox(t,a);i[16]=a.seed}else{Ua._randomPointInsideHalfUnitBox(t)}t.x=this.x*t.x;t.y=this.y*t.y;t.z=this.z*t.z;if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointUnitSphere(e,a);i[17]=a.seed}else{Ua._randomPointUnitSphere(e)}}else{e.x=0;e.y=0;e.z=1}}cloneTo(t){super.cloneTo(t);var e=t;e.x=this.x;e.y=this.y;e.z=this.z;e.randomDirection=this.randomDirection}clone(){var t=new ka;this.cloneTo(t);return t}}class Ga extends Va{constructor(){super();this.shapeType=H.ParticleSystemShapeType.Circle;this.radius=1;this.arc=360/180*Math.PI;this.emitFromEdge=false}_getShapeBoundBox(t){var e=t.min;e.x=e.z=-this.radius;e.y=0;var a=t.max;a.x=a.z=this.radius;a.y=0}_getSpeedBoundBox(t){var e=t.min;e.x=e.y=-1;e.z=0;var a=t.max;a.x=a.y=1;a.z=0}generatePositionAndDirection(t,e,a=null,i=null){var r=Ga._tempPositionPoint;if(a){a.seed=i[16];if(this.emitFromEdge)Ua._randomPointUnitArcCircle(this.arc,Ga._tempPositionPoint,a);else Ua._randomPointInsideUnitArcCircle(this.arc,Ga._tempPositionPoint,a);i[16]=a.seed}else{if(this.emitFromEdge)Ua._randomPointUnitArcCircle(this.arc,Ga._tempPositionPoint);else Ua._randomPointInsideUnitArcCircle(this.arc,Ga._tempPositionPoint)}t.x=-r.x;t.y=r.y;t.z=0;St.scale(t,this.radius,t);if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointUnitSphere(e,a);i[17]=a.seed}else{Ua._randomPointUnitSphere(e)}}else{t.cloneTo(e)}}cloneTo(t){super.cloneTo(t);var e=t;e.radius=this.radius;e.arc=this.arc;e.emitFromEdge=this.emitFromEdge;e.randomDirection=this.randomDirection}clone(){var t=new Ga;this.cloneTo(t);return t}}Ga._tempPositionPoint=new Ct;class Ha extends Va{constructor(){super();this.shapeType=H.ParticleSystemShapeType.Cone;this.angle=25/180*Math.PI;this.radius=1;this.length=5;this.emitType=0}_getShapeBoundBox(t){const e=this.radius+this.length*Math.sin(this.angle);const a=this.length*Math.cos(this.angle);var i=t.min;i.x=i.y=-e;i.z=0;var r=t.max;r.x=r.y=e;r.z=a}_getSpeedBoundBox(t){const e=Math.sin(this.angle);var a=t.min;a.x=a.y=-e;a.z=0;var i=t.max;i.x=i.y=e;i.z=1}generatePositionAndDirection(t,e,a=null,i=null){var r=Ha._tempPositionPoint;var s;var n;var o;var l=Math.cos(this.angle);var _=Math.sin(this.angle);switch(this.emitType){case 0:if(a){a.seed=i[16];Ua._randomPointInsideUnitCircle(Ha._tempPositionPoint,a);i[16]=a.seed}else{Ua._randomPointInsideUnitCircle(Ha._tempPositionPoint)}s=r.x;n=r.y;t.x=s*this.radius;t.y=n*this.radius;t.z=0;if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointInsideUnitCircle(Ha._tempDirectionPoint,a);i[17]=a.seed}else{Ua._randomPointInsideUnitCircle(Ha._tempDirectionPoint)}o=Ha._tempDirectionPoint;e.x=o.x*_;e.y=o.y*_}else{e.x=s*_;e.y=n*_}e.z=l;break;case 1:if(a){a.seed=i[16];Ua._randomPointUnitCircle(Ha._tempPositionPoint,a);i[16]=a.seed}else{Ua._randomPointUnitCircle(Ha._tempPositionPoint)}s=r.x;n=r.y;t.x=s*this.radius;t.y=n*this.radius;t.z=0;if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointInsideUnitCircle(Ha._tempDirectionPoint,a);i[17]=a.seed}else{Ua._randomPointInsideUnitCircle(Ha._tempDirectionPoint)}o=Ha._tempDirectionPoint;e.x=o.x*_;e.y=o.y*_}else{e.x=s*_;e.y=n*_}e.z=l;break;case 2:if(a){a.seed=i[16];Ua._randomPointInsideUnitCircle(Ha._tempPositionPoint,a)}else{Ua._randomPointInsideUnitCircle(Ha._tempPositionPoint)}s=r.x;n=r.y;t.x=s*this.radius;t.y=n*this.radius;t.z=0;e.x=s*_;e.y=n*_;e.z=l;St.normalize(e,e);if(a){St.scale(e,this.length*a.getFloat(),e);i[16]=a.seed}else{St.scale(e,this.length*Math.random(),e)}St.add(t,e,t);if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointUnitSphere(e,a);i[17]=a.seed}else{Ua._randomPointUnitSphere(e)}}break;case 3:if(a){a.seed=i[16];Ua._randomPointUnitCircle(Ha._tempPositionPoint,a)}else{Ua._randomPointUnitCircle(Ha._tempPositionPoint)}s=r.x;n=r.y;t.x=s*this.radius;t.y=n*this.radius;t.z=0;e.x=s*_;e.y=n*_;e.z=l;St.normalize(e,e);if(a){St.scale(e,this.length*a.getFloat(),e);i[16]=a.seed}else{St.scale(e,this.length*Math.random(),e)}St.add(t,e,t);if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointUnitSphere(e,a);i[17]=a.seed}else{Ua._randomPointUnitSphere(e)}}break;default:throw new Error("ConeShape:emitType is invalid.")}}cloneTo(t){super.cloneTo(t);var e=t;e.angle=this.angle;e.radius=this.radius;e.length=this.length;e.emitType=this.emitType;e.randomDirection=this.randomDirection}clone(){var t=new Ha;this.cloneTo(t);return t}}Ha._tempPositionPoint=new Ct;Ha._tempDirectionPoint=new Ct;class za extends Va{constructor(){super();this.shapeType=H.ParticleSystemShapeType.Hemisphere;this.radius=1;this.emitFromShell=false}_getShapeBoundBox(t){var e=t.min;e.x=e.y=e.z=-this.radius;var a=t.max;a.x=a.y=this.radius;a.z=0}_getSpeedBoundBox(t){var e=t.min;e.x=e.y=-1;e.z=0;var a=t.max;a.x=a.y=a.z=1}generatePositionAndDirection(t,e,a=null,i=null){if(a){a.seed=i[16];if(this.emitFromShell)Ua._randomPointUnitSphere(t,a);else Ua._randomPointInsideUnitSphere(t,a);i[16]=a.seed}else{if(this.emitFromShell)Ua._randomPointUnitSphere(t);else Ua._randomPointInsideUnitSphere(t)}St.scale(t,this.radius,t);var r=t.z;r<0&&(t.z=r*-1);if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointUnitSphere(e,a);i[17]=a.seed}else{Ua._randomPointUnitSphere(e)}}else{t.cloneTo(e)}}cloneTo(t){super.cloneTo(t);var e=t;e.radius=this.radius;e.emitFromShell=this.emitFromShell;e.randomDirection=this.randomDirection}clone(){var t=new za;this.cloneTo(t);return t}}class Wa extends Va{constructor(){super();this.shapeType=H.ParticleSystemShapeType.Sphere;this.radius=1;this.emitFromShell=false}_getShapeBoundBox(t){var e=t.min;e.x=e.y=e.z=-this.radius;var a=t.max;a.x=a.y=a.z=this.radius}_getSpeedBoundBox(t){var e=t.min;e.x=e.y=e.z=-1;var a=t.max;a.x=a.y=a.z=1}generatePositionAndDirection(t,e,a=null,i=null){if(a){a.seed=i[16];if(this.emitFromShell)Ua._randomPointUnitSphere(t,a);else Ua._randomPointInsideUnitSphere(t,a);i[16]=a.seed}else{if(this.emitFromShell)Ua._randomPointUnitSphere(t);else Ua._randomPointInsideUnitSphere(t)}St.scale(t,this.radius,t);if(this.randomDirection){if(a){a.seed=i[17];Ua._randomPointUnitSphere(e,a);i[17]=a.seed}else{Ua._randomPointUnitSphere(e)}}else{t.cloneTo(e)}}cloneTo(t){super.cloneTo(t);var e=t;e.radius=this.radius;e.emitFromShell=this.emitFromShell;e.randomDirection=this.randomDirection}clone(){var t=new Wa;this.cloneTo(t);return t}}class Xa{constructor(t){this._size=t}get size(){return this._size}cloneTo(t){var e=t;this._size.cloneTo(e._size);e.enable=this.enable}clone(){var t;switch(this._size.type){case 0:if(this._size.separateAxes)t=Na.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone());else t=Na.createByGradient(this._size.gradient.clone());break;case 1:if(this._size.separateAxes)t=Na.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone());else t=Na.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:if(this._size.separateAxes)t=Na.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone());else t=Na.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone());break}var e=new Xa(t);e.enable=this.enable;return e}}class Ya{constructor(){this._type=0;this._constant=0;this._constantMin=0;this._constantMax=0}static createByConstant(t=0){var e=new Ya;e._type=0;e._constant=t;return e}static createByRandomTwoConstant(t=0,e=0){var a=new Ya;a._type=1;a._constantMin=t;a._constantMax=e;return a}get type(){return this._type}get constant(){return this._constant}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}cloneTo(t){var e=t;e._type=this._type;e._constant=this._constant;e._constantMin=this._constantMin;e._constantMax=this._constantMax}clone(){var t=new Ya;this.cloneTo(t);return t}}class ja{constructor(t,e){this.type=0;this.randomRow=false;this.rowIndex=0;this.cycles=0;this.enableUVChannels=0;this.enable=false;this.tiles=new Ct(1,1);this.type=0;this.randomRow=true;this.rowIndex=0;this.cycles=1;this.enableUVChannels=1;this._frame=t;this._startFrame=e}get frame(){return this._frame}get startFrame(){return this._startFrame}cloneTo(t){var e=t;this.tiles.cloneTo(e.tiles);e.type=this.type;e.randomRow=this.randomRow;e.rowIndex=this.rowIndex;e.cycles=this.cycles;e.enableUVChannels=this.enableUVChannels;e.enable=this.enable;this._frame.cloneTo(e._frame);this._startFrame.cloneTo(e._startFrame)}clone(){var t;switch(this._frame.type){case 0:t=Da.createByConstant(this._frame.constant);break;case 1:t=Da.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=Da.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=Da.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone());break}var e;switch(this._startFrame.type){case 0:e=Ya.createByConstant(this._startFrame.constant);break;case 1:e=Ya.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax);break}var a=new ja(t,e);this.cloneTo(a);return a}}class qa{constructor(t){this.enable=false;this.space=0;this._velocity=t}get velocity(){return this._velocity}cloneTo(t){var e=t;this._velocity.cloneTo(e._velocity);e.enable=this.enable;e.space=this.space}clone(){var t;switch(this._velocity.type){case 0:t=Ba.createByConstant(this._velocity.constant.clone());break;case 1:t=Ba.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=Ba.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=Ba.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientZMax.clone());break}var e=new qa(t);e.enable=this.enable;e.space=this.space;return e}}class f{}f.WORLDPOSITION=P.propertyNameToID("u_WorldPosition");f.WORLDROTATION=P.propertyNameToID("u_WorldRotation");f.POSITIONSCALE=P.propertyNameToID("u_PositionScale");f.SIZESCALE=P.propertyNameToID("u_SizeScale");f.SCALINGMODE=P.propertyNameToID("u_ScalingMode");f.GRAVITY=P.propertyNameToID("u_Gravity");f.THREEDSTARTROTATION=P.propertyNameToID("u_ThreeDStartRotation");f.STRETCHEDBILLBOARDLENGTHSCALE=P.propertyNameToID("u_StretchedBillboardLengthScale");f.STRETCHEDBILLBOARDSPEEDSCALE=P.propertyNameToID("u_StretchedBillboardSpeedScale");f.SIMULATIONSPACE=P.propertyNameToID("u_SimulationSpace");f.CURRENTTIME=P.propertyNameToID("u_CurrentTime");f.VOLVELOCITYCONST=P.propertyNameToID("u_VOLVelocityConst");f.VOLVELOCITYGRADIENTX=P.propertyNameToID("u_VOLVelocityGradientX");f.VOLVELOCITYGRADIENTY=P.propertyNameToID("u_VOLVelocityGradientY");f.VOLVELOCITYGRADIENTZ=P.propertyNameToID("u_VOLVelocityGradientZ");f.VOLVELOCITYCONSTMAX=P.propertyNameToID("u_VOLVelocityConstMax");f.VOLVELOCITYGRADIENTXMAX=P.propertyNameToID("u_VOLVelocityGradientMaxX");f.VOLVELOCITYGRADIENTYMAX=P.propertyNameToID("u_VOLVelocityGradientMaxY");f.VOLVELOCITYGRADIENTZMAX=P.propertyNameToID("u_VOLVelocityGradientMaxZ");f.VOLSPACETYPE=P.propertyNameToID("u_VOLSpaceType");f.COLOROVERLIFEGRADIENTALPHAS=P.propertyNameToID("u_ColorOverLifeGradientAlphas");f.COLOROVERLIFEGRADIENTCOLORS=P.propertyNameToID("u_ColorOverLifeGradientColors");f.MAXCOLOROVERLIFEGRADIENTALPHAS=P.propertyNameToID("u_MaxColorOverLifeGradientAlphas");f.MAXCOLOROVERLIFEGRADIENTCOLORS=P.propertyNameToID("u_MaxColorOverLifeGradientColors");f.SOLSIZEGRADIENT=P.propertyNameToID("u_SOLSizeGradient");f.SOLSIZEGRADIENTX=P.propertyNameToID("u_SOLSizeGradientX");f.SOLSIZEGRADIENTY=P.propertyNameToID("u_SOLSizeGradientY");f.SOLSizeGradientZ=P.propertyNameToID("u_SOLSizeGradientZ");f.SOLSizeGradientMax=P.propertyNameToID("u_SOLSizeGradientMax");f.SOLSIZEGRADIENTXMAX=P.propertyNameToID("u_SOLSizeGradientMaxX");f.SOLSIZEGRADIENTYMAX=P.propertyNameToID("u_SOLSizeGradientMaxY");f.SOLSizeGradientZMAX=P.propertyNameToID("u_SOLSizeGradientMaxZ");f.ROLANGULARVELOCITYCONST=P.propertyNameToID("u_ROLAngularVelocityConst");f.ROLANGULARVELOCITYCONSTSEPRARATE=P.propertyNameToID("u_ROLAngularVelocityConstSeprarate");f.ROLANGULARVELOCITYGRADIENT=P.propertyNameToID("u_ROLAngularVelocityGradient");f.ROLANGULARVELOCITYGRADIENTX=P.propertyNameToID("u_ROLAngularVelocityGradientX");f.ROLANGULARVELOCITYGRADIENTY=P.propertyNameToID("u_ROLAngularVelocityGradientY");f.ROLANGULARVELOCITYGRADIENTZ=P.propertyNameToID("u_ROLAngularVelocityGradientZ");f.ROLANGULARVELOCITYCONSTMAX=P.propertyNameToID("u_ROLAngularVelocityConstMax");f.ROLANGULARVELOCITYCONSTMAXSEPRARATE=P.propertyNameToID("u_ROLAngularVelocityConstMaxSeprarate");f.ROLANGULARVELOCITYGRADIENTMAX=P.propertyNameToID("u_ROLAngularVelocityGradientMax");f.ROLANGULARVELOCITYGRADIENTXMAX=P.propertyNameToID("u_ROLAngularVelocityGradientMaxX");f.ROLANGULARVELOCITYGRADIENTYMAX=P.propertyNameToID("u_ROLAngularVelocityGradientMaxY");f.ROLANGULARVELOCITYGRADIENTZMAX=P.propertyNameToID("u_ROLAngularVelocityGradientMaxZ");f.ROLANGULARVELOCITYGRADIENTWMAX=P.propertyNameToID("u_ROLAngularVelocityGradientMaxW");f.TEXTURESHEETANIMATIONCYCLES=P.propertyNameToID("u_TSACycles");f.TEXTURESHEETANIMATIONSUBUVLENGTH=P.propertyNameToID("u_TSASubUVLength");f.TEXTURESHEETANIMATIONGRADIENTUVS=P.propertyNameToID("u_TSAGradientUVs");f.TEXTURESHEETANIMATIONGRADIENTMAXUVS=P.propertyNameToID("u_TSAMaxGradientUVs");class m extends s{constructor(){super();this.setShaderName("PARTICLESHURIKEN");this._color=new bt(1,1,1,1);this.renderMode=m.RENDERMODE_ALPHABLENDED}static __initDefine__(){m.SHADERDEFINE_DIFFUSEMAP=P.getDefineByName("DIFFUSEMAP");m.SHADERDEFINE_TINTCOLOR=P.getDefineByName("TINTCOLOR");m.SHADERDEFINE_ADDTIVEFOG=P.getDefineByName("ADDTIVEFOG");m.SHADERDEFINE_TILINGOFFSET=P.getDefineByName("TILINGOFFSET")}get _TintColor(){return this.color}set _TintColor(t){this.color=t}get _TintColorR(){return this._color.x}set _TintColorR(t){this._color.x=t;this.color=this._color}get _TintColorG(){return this._color.y}set _TintColorG(t){this._color.y=t;this.color=this._color}get _TintColorB(){return this._color.z}set _TintColorB(t){this._color.z=t;this.color=this._color}get _TintColorA(){return this._color.w}set _TintColorA(t){this._color.w=t;this.color=this._color}get _MainTex_ST(){return this._shaderValues.getVector(m.TILINGOFFSET)}set _MainTex_ST(t){var e=this._shaderValues.getVector(m.TILINGOFFSET);e.setValue(t.x,t.y,t.z,t.w);this.tilingOffset=e}get _MainTex_STX(){return this._shaderValues.getVector(m.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(m.TILINGOFFSET);e.x=t;this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(m.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(m.TILINGOFFSET);e.y=t;this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(m.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(m.TILINGOFFSET);e.z=t;this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(m.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(m.TILINGOFFSET);e.w=t;this.tilingOffset=e}set renderMode(t){switch(t){case m.RENDERMODE_ADDTIVE:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.depthWrite=false;this.cull=p.CULL_NONE;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE;this.alphaTest=false;this._shaderValues.addDefine(m.SHADERDEFINE_ADDTIVEFOG);break;case m.RENDERMODE_ALPHABLENDED:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.depthWrite=false;this.cull=p.CULL_NONE;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.alphaTest=false;this._shaderValues.removeDefine(m.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("ShurikenParticleMaterial : renderMode value error.")}}get colorR(){return this._TintColorR}set colorR(t){this._TintColorR=t}get colorG(){return this._TintColorG}set colorG(t){this._TintColorG=t}get colorB(){return this._TintColorB}set colorB(t){this._TintColorB=t}get colorA(){return this._TintColorA}set colorA(t){this._TintColorA=t}get color(){return this._shaderValues.getVector(m.TINTCOLOR)}set color(t){if(t)this._shaderValues.addDefine(m.SHADERDEFINE_TINTCOLOR);else this._shaderValues.removeDefine(m.SHADERDEFINE_TINTCOLOR);this._shaderValues.setVector(m.TINTCOLOR,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(m.TILINGOFFSET)}set tilingOffset(t){if(t){if(t.x!=1||t.y!=1||t.z!=0||t.w!=0)this._shaderValues.addDefine(m.SHADERDEFINE_TILINGOFFSET);else this._shaderValues.removeDefine(m.SHADERDEFINE_TILINGOFFSET)}else{this._shaderValues.removeDefine(m.SHADERDEFINE_TILINGOFFSET)}this._shaderValues.setVector(m.TILINGOFFSET,t)}get texture(){return this._shaderValues.getTexture(m.DIFFUSETEXTURE)}set texture(t){if(t)this._shaderValues.addDefine(m.SHADERDEFINE_DIFFUSEMAP);else this._shaderValues.removeDefine(m.SHADERDEFINE_DIFFUSEMAP);this._shaderValues.setTexture(m.DIFFUSETEXTURE,t)}get depthWrite(){return this._shaderValues.getBool(m.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(m.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(m.CULL)}set cull(t){this._shaderValues.setInt(m.CULL,t)}get blend(){return this._shaderValues.getInt(m.BLEND)}set blend(t){this._shaderValues.setInt(m.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(m.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(m.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(m.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(m.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(m.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(m.DEPTH_TEST,t)}clone(){var t=new m;this.cloneTo(t);return t}}m.RENDERMODE_ALPHABLENDED=0;m.RENDERMODE_ADDTIVE=1;m.DIFFUSETEXTURE=P.propertyNameToID("u_texture");m.TINTCOLOR=P.propertyNameToID("u_Tintcolor");m.TILINGOFFSET=P.propertyNameToID("u_TilingOffset");m.CULL=P.propertyNameToID("s_Cull");m.BLEND=P.propertyNameToID("s_Blend");m.BLEND_SRC=P.propertyNameToID("s_BlendSrc");m.BLEND_DST=P.propertyNameToID("s_BlendDst");m.DEPTH_TEST=P.propertyNameToID("s_DepthTest");m.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");class Za extends qe{constructor(t){super(t);this._finalGravity=new St;this._tempRotationMatrix=new k;this._mesh=null;this.stretchedBillboardCameraSpeedScale=0;this.stretchedBillboardSpeedScale=0;this.stretchedBillboardLengthScale=2;this._defaultBoundBox=new Ne(new St,new St);this.renderMode=0;this._supportOctree=false}get renderMode(){return this._renderMode}set renderMode(t){if(this._renderMode!==t){var e=this._shaderValues;switch(this._renderMode){case 0:e.removeDefine(f.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.removeDefine(f.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.removeDefine(f.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.removeDefine(f.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.removeDefine(f.SHADERDEFINE_RENDERMODE_MESH);break}this._renderMode=t;switch(t){case 0:e.addDefine(f.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.addDefine(f.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.addDefine(f.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.addDefine(f.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.addDefine(f.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}var a=this._owner.particleSystem;a&&a._initBufferDatas()}}get mesh(){return this._mesh}set mesh(t){if(this._mesh!==t){this._mesh&&this._mesh._removeReference();this._mesh=t;t&&t._addReference();this._owner.particleSystem._initBufferDatas()}}_calculateBoundingBox(){var t=this._owner.particleSystem;var e;if(t._useCustomBounds){e=t.customBounds;e._tranform(this._owner.transform.worldMatrix,this._bounds)}else if(t._simulationSupported()){t._generateBounds();e=t._bounds;e._tranform(this._owner.transform.worldMatrix,this._bounds);if(t.gravityModifier!=0){var a=this._bounds.getMax();var i=this._bounds.getMin();var r=t._gravityOffset;a.y-=r.x;i.y-=r.y;this._bounds.setMax(a);this._bounds.setMin(i)}}else{var i=this._bounds.getMin();i.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this._bounds.setMin(i);var a=this._bounds.getMax();a.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._bounds.setMax(a)}}_needRender(t,e){if(t){if(t.intersects(this.bounds._getBoundBox())){if(this._owner.particleSystem.isAlive)return true;else return false}else{return false}}else{return true}}_renderUpdate(t,e){var a=this._owner.particleSystem;var i=this._shaderValues;var r=this._owner.transform;switch(a.simulationSpace){case 0:break;case 1:i.setVector3(f.WORLDPOSITION,r.position);i.setQuaternion(f.WORLDROTATION,r.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(a.scaleMode){case 0:var s=r.getWorldLossyScale();i.setVector3(f.POSITIONSCALE,s);i.setVector3(f.SIZESCALE,s);break;case 1:var n=r.localScale;i.setVector3(f.POSITIONSCALE,n);i.setVector3(f.SIZESCALE,n);break;case 2:i.setVector3(f.POSITIONSCALE,r.getWorldLossyScale());i.setVector3(f.SIZESCALE,St._ONE);break}St.scale(B.gravity,a.gravityModifier,this._finalGravity);i.setVector3(f.GRAVITY,this._finalGravity);i.setInt(f.SIMULATIONSPACE,a.simulationSpace);i.setBool(f.THREEDSTARTROTATION,a.threeDStartRotation);i.setInt(f.SCALINGMODE,a.scaleMode);i.setNumber(f.STRETCHEDBILLBOARDLENGTHSCALE,this.stretchedBillboardLengthScale);i.setNumber(f.STRETCHEDBILLBOARDSPEEDSCALE,this.stretchedBillboardSpeedScale);i.setNumber(f.CURRENTTIME,a._currentTime)}get bounds(){if(this._boundsChange){this._calculateBoundingBox();this._boundsChange=false}return this._bounds}_destroy(){super._destroy();this._mesh&&(this._mesh._removeReference(),this._mesh=null)}}class g{constructor(){}}g.PARTICLE_CORNERTEXTURECOORDINATE0=5;g.PARTICLE_POSITION0=1;g.PARTICLE_COLOR0=2;g.PARTICLE_TEXTURECOORDINATE0=3;g.PARTICLE_SHAPEPOSITIONSTARTLIFETIME=4;g.PARTICLE_DIRECTIONTIME=0;g.PARTICLE_STARTCOLOR0=6;g.PARTICLE_ENDCOLOR0=7;g.PARTICLE_STARTSIZE=8;g.PARTICLE_STARTROTATION=9;g.PARTICLE_STARTSPEED=10;g.PARTICLE_RANDOM0=11;g.PARTICLE_RANDOM1=12;g.PARTICLE_SIMULATIONWORLDPOSTION=13;g.PARTICLE_SIMULATIONWORLDROTATION=14;class Ka extends g{constructor(t,e,a,i,r,s,n,o,l,_,h,x,c,d){super();this._cornerTextureCoordinate=t;this._positionStartLifeTime=e;this._velocity=a;this._startColor=i;this._startSize=r;this._startRotation0=s;this._startRotation1=n;this._startRotation2=o;this._startLifeTime=l;this._time=_;this._startSpeed=h;this._randoms0=this.random0;this._randoms1=this.random1;this._simulationWorldPostion=d}static get vertexDeclaration(){return Ka._vertexDeclaration}static __init__(){Ka._vertexDeclaration=new Tt(152,[new h(0,_.Vector4,g.PARTICLE_CORNERTEXTURECOORDINATE0),new h(16,_.Vector4,g.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),new h(32,_.Vector4,g.PARTICLE_DIRECTIONTIME),new h(48,_.Vector4,g.PARTICLE_STARTCOLOR0),new h(64,_.Vector3,g.PARTICLE_STARTSIZE),new h(76,_.Vector3,g.PARTICLE_STARTROTATION),new h(88,_.Single,g.PARTICLE_STARTSPEED),new h(92,_.Vector4,g.PARTICLE_RANDOM0),new h(108,_.Vector4,g.PARTICLE_RANDOM1),new h(124,_.Vector3,g.PARTICLE_SIMULATIONWORLDPOSTION),new h(136,_.Vector4,g.PARTICLE_SIMULATIONWORLDROTATION)])}get cornerTextureCoordinate(){return this._cornerTextureCoordinate}get positionStartLifeTime(){return this._positionStartLifeTime}get velocity(){return this._velocity}get startColor(){return this._startColor}get startSize(){return this._startSize}get startRotation0(){return this._startRotation0}get startRotation1(){return this._startRotation1}get startRotation2(){return this._startRotation2}get startLifeTime(){return this._startLifeTime}get time(){return this._time}get startSpeed(){return this._startSpeed}get random0(){return this._randoms0}get random1(){return this._randoms1}get simulationWorldPostion(){return this._simulationWorldPostion}}class Qa extends g{constructor(t,e,a,i,r,s,n,o,l,_,h,x,c,d){super();this._cornerTextureCoordinate=t;this._positionStartLifeTime=e;this._velocity=a;this._startColor=i;this._startSize=r;this._startRotation0=s;this._startRotation1=n;this._startRotation2=o;this._startLifeTime=l;this._time=_;this._startSpeed=h;this._randoms0=this.random0;this._randoms1=this.random1;this._simulationWorldPostion=d}static __init__(){Qa._vertexDeclaration=new Tt(172,[new h(0,_.Vector3,g.PARTICLE_POSITION0),new h(12,_.Vector4,g.PARTICLE_COLOR0),new h(28,_.Vector2,g.PARTICLE_TEXTURECOORDINATE0),new h(36,_.Vector4,g.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),new h(52,_.Vector4,g.PARTICLE_DIRECTIONTIME),new h(68,_.Vector4,g.PARTICLE_STARTCOLOR0),new h(84,_.Vector3,g.PARTICLE_STARTSIZE),new h(96,_.Vector3,g.PARTICLE_STARTROTATION),new h(108,_.Single,g.PARTICLE_STARTSPEED),new h(112,_.Vector4,g.PARTICLE_RANDOM0),new h(128,_.Vector4,g.PARTICLE_RANDOM1),new h(144,_.Vector3,g.PARTICLE_SIMULATIONWORLDPOSTION),new h(156,_.Vector4,g.PARTICLE_SIMULATIONWORLDROTATION)])}static get vertexDeclaration(){return Qa._vertexDeclaration}get cornerTextureCoordinate(){return this._cornerTextureCoordinate}get position(){return this._positionStartLifeTime}get velocity(){return this._velocity}get startColor(){return this._startColor}get startSize(){return this._startSize}get startRotation0(){return this._startRotation0}get startRotation1(){return this._startRotation1}get startRotation2(){return this._startRotation2}get startLifeTime(){return this._startLifeTime}get time(){return this._time}get startSpeed(){return this._startSpeed}get random0(){return this._randoms0}get random1(){return this._randoms1}get simulationWorldPostion(){return this._simulationWorldPostion}}class Ja{constructor(t){this._temp=new Uint32Array(1);this.seeds=new Uint32Array(4);this.seeds[0]=t;this.seeds[1]=this.seeds[0]*1812433253+1;this.seeds[2]=this.seeds[1]*1812433253+1;this.seeds[3]=this.seeds[2]*1812433253+1}static getFloatFromInt(t){return(t&8388607)*(1/8388607)}static getByteFromInt(t){return(t&8388607)>>>15}get seed(){return this.seeds[0]}set seed(t){this.seeds[0]=t;this.seeds[1]=this.seeds[0]*1812433253+1;this.seeds[2]=this.seeds[1]*1812433253+1;this.seeds[3]=this.seeds[2]*1812433253+1}getUint(){this._temp[0]=this.seeds[0]^this.seeds[0]<<11;this.seeds[0]=this.seeds[1];this.seeds[1]=this.seeds[2];this.seeds[2]=this.seeds[3];this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^(this._temp[0]^this._temp[0]>>>8);return this.seeds[3]}getFloat(){this.getUint();return(this.seeds[3]&8388607)*(1/8388607)}getSignedFloat(){return this.getFloat()*2-1}}class $a{constructor(){this._emissionRate=10;this._destroyed=false;this._bursts=[]}set emissionRate(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}get emissionRate(){return this._emissionRate}get destroyed(){return this._destroyed}destroy(){this._bursts=null;this._destroyed=true}getBurstsCount(){return this._bursts.length}getBurstByIndex(t){return this._bursts[t]}addBurst(t){var e=this._bursts.length;if(e>0)for(var a=0;a<e;a++){if(this._bursts[a].time>t.time)this._bursts.splice(a,0,t)}this._bursts.push(t)}removeBurst(t){var e=this._bursts.indexOf(t);if(e!==-1){this._bursts.splice(e,1)}}removeBurstByIndex(t){this._bursts.splice(t,1)}clearBurst(){this._bursts.length=0}cloneTo(t){var e=t;var a=e._bursts;a.length=this._bursts.length;for(var i=0,r=this._bursts.length;i<r;i++){var s=a[i];if(s)this._bursts[i].cloneTo(s);else a[i]=this._bursts[i].clone()}e._emissionRate=this._emissionRate;e.enable=this.enable}clone(){var t=new $a;this.cloneTo(t);return t}}class Q{constructor(){}static _getStartLifetimeFromGradient(t,e){for(var a=1,i=t.gradientCount;a<i;a++){var r=t.getKeyByIndex(a);if(r>=e){var s=t.getKeyByIndex(a-1);var n=(e-s)/(r-s);return Et.MathUtil.lerp(t.getValueByIndex(a-1),t.getValueByIndex(a),n)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")}static _randomInvertRoationArray(t,e,a,i,r){var s;if(i){i.seed=r[6];s=i.getFloat();r[6]=i.seed}else{s=Math.random()}if(s<a){e.x=-t.x;e.y=-t.y;e.z=-t.z}else{e.x=t.x;e.y=t.y;e.z=t.z}}static _randomInvertRoation(t,e,a,i){var r;if(a){a.seed=i[6];r=a.getFloat();i[6]=a.seed}else{r=Math.random()}if(r<e)t=-t;return t}static create(t,e,B){var a=t.autoRandomSeed;var i=t._rand;var r=t._randomSeeds;switch(t.startColorType){case 0:var s=t.startColorConstant;Q.startColor.x=s.x;Q.startColor.y=s.y;Q.startColor.z=s.z;Q.startColor.w=s.w;break;case 2:if(a){bt.lerp(t.startColorConstantMin,t.startColorConstantMax,Math.random(),Q.startColor)}else{i.seed=r[3];bt.lerp(t.startColorConstantMin,t.startColorConstantMax,i.getFloat(),Q.startColor);r[3]=i.seed}break}var n=t.colorOverLifetime;if(n&&n.enable){var o=n.color;switch(o.type){case 0:Q.startColor.x=Q.startColor.x*o.constant.x;Q.startColor.y=Q.startColor.y*o.constant.y;Q.startColor.z=Q.startColor.z*o.constant.z;Q.startColor.w=Q.startColor.w*o.constant.w;break;case 2:var l;if(a){l=Math.random()}else{i.seed=r[10];l=i.getFloat();r[10]=i.seed}var _=o.constantMin;var h=o.constantMax;Q.startColor.x=Q.startColor.x*Et.MathUtil.lerp(_.x,h.x,l);Q.startColor.y=Q.startColor.y*Et.MathUtil.lerp(_.y,h.y,l);Q.startColor.z=Q.startColor.z*Et.MathUtil.lerp(_.z,h.z,l);Q.startColor.w=Q.startColor.w*Et.MathUtil.lerp(_.w,h.w,l);break}}var x=Q.startSize;switch(t.startSizeType){case 0:if(t.threeDStartSize){var c=t.startSizeConstantSeparate;x[0]=c.x;x[1]=c.y;x[2]=c.z}else{x[0]=x[1]=x[2]=t.startSizeConstant}break;case 2:if(t.threeDStartSize){var d=t.startSizeConstantMinSeparate;var u=t.startSizeConstantMaxSeparate;if(a){x[0]=Et.MathUtil.lerp(d.x,u.x,Math.random());x[1]=Et.MathUtil.lerp(d.y,u.y,Math.random());x[2]=Et.MathUtil.lerp(d.z,u.z,Math.random())}else{i.seed=r[4];x[0]=Et.MathUtil.lerp(d.x,u.x,i.getFloat());x[1]=Et.MathUtil.lerp(d.y,u.y,i.getFloat());x[2]=Et.MathUtil.lerp(d.z,u.z,i.getFloat());r[4]=i.seed}}else{if(a){x[0]=x[1]=x[2]=Et.MathUtil.lerp(t.startSizeConstantMin,t.startSizeConstantMax,Math.random())}else{i.seed=r[4];x[0]=x[1]=x[2]=Et.MathUtil.lerp(t.startSizeConstantMin,t.startSizeConstantMax,i.getFloat());r[4]=i.seed}}break}var f=t.sizeOverLifetime;if(f&&f.enable&&f.size.type===1){var p=f.size;if(p.separateAxes){if(a){x[0]=x[0]*Et.MathUtil.lerp(p.constantMinSeparate.x,p.constantMaxSeparate.x,Math.random());x[1]=x[1]*Et.MathUtil.lerp(p.constantMinSeparate.y,p.constantMaxSeparate.y,Math.random());x[2]=x[2]*Et.MathUtil.lerp(p.constantMinSeparate.z,p.constantMaxSeparate.z,Math.random())}else{i.seed=r[11];x[0]=x[0]*Et.MathUtil.lerp(p.constantMinSeparate.x,p.constantMaxSeparate.x,i.getFloat());x[1]=x[1]*Et.MathUtil.lerp(p.constantMinSeparate.y,p.constantMaxSeparate.y,i.getFloat());x[2]=x[2]*Et.MathUtil.lerp(p.constantMinSeparate.z,p.constantMaxSeparate.z,i.getFloat());r[11]=i.seed}}else{var m;if(a){m=Et.MathUtil.lerp(p.constantMin,p.constantMax,Math.random())}else{i.seed=r[11];m=Et.MathUtil.lerp(p.constantMin,p.constantMax,i.getFloat());r[11]=i.seed}x[0]=x[0]*m;x[1]=x[1]*m;x[2]=x[2]*m}}var g=e.renderMode;if(g!==1){switch(t.startRotationType){case 0:if(t.threeDStartRotation){var v=t.startRotationConstantSeparate;var y=Q._tempVector30;Q._randomInvertRoationArray(v,y,t.randomizeRotationDirection,a?null:i,r);Q.startRotation[0]=y.x;Q.startRotation[1]=y.y;if(g!==4)Q.startRotation[2]=-y.z;else Q.startRotation[2]=y.z}else{Q.startRotation[0]=Q._randomInvertRoation(t.startRotationConstant,t.randomizeRotationDirection,a?null:i,r);Q.startRotation[1]=0;Q.startRotation[2]=0}break;case 2:if(t.threeDStartRotation){var T=t.startRotationConstantMinSeparate;var E=t.startRotationConstantMaxSeparate;var b=Q._tempVector30;if(a){b.x=Et.MathUtil.lerp(T.x,E.x,Math.random());b.y=Et.MathUtil.lerp(T.y,E.y,Math.random());b.z=Et.MathUtil.lerp(T.z,E.z,Math.random())}else{i.seed=r[5];b.x=Et.MathUtil.lerp(T.x,E.x,i.getFloat());b.y=Et.MathUtil.lerp(T.y,E.y,i.getFloat());b.z=Et.MathUtil.lerp(T.z,E.z,i.getFloat());r[5]=i.seed}Q._randomInvertRoationArray(b,b,t.randomizeRotationDirection,a?null:i,r);Q.startRotation[0]=b.x;Q.startRotation[1]=b.y;if(g!==4)Q.startRotation[2]=-b.z;else Q.startRotation[2]=b.z}else{if(a){Q.startRotation[0]=Q._randomInvertRoation(Et.MathUtil.lerp(t.startRotationConstantMin,t.startRotationConstantMax,Math.random()),t.randomizeRotationDirection,a?null:i,r)}else{i.seed=r[5];Q.startRotation[0]=Q._randomInvertRoation(Et.MathUtil.lerp(t.startRotationConstantMin,t.startRotationConstantMax,i.getFloat()),t.randomizeRotationDirection,a?null:i,r);r[5]=i.seed}}break}}switch(t.startLifetimeType){case 0:Q.startLifeTime=t.startLifetimeConstant;break;case 1:Q.startLifeTime=Q._getStartLifetimeFromGradient(t.startLifeTimeGradient,t.emissionTime);break;case 2:if(a){Q.startLifeTime=Et.MathUtil.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,Math.random())}else{i.seed=r[7];Q.startLifeTime=Et.MathUtil.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,i.getFloat());r[7]=i.seed}break;case 3:var S=t.emissionTime;if(a){Q.startLifeTime=Et.MathUtil.lerp(Q._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,S),Q._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,S),Math.random())}else{i.seed=r[7];Q.startLifeTime=Et.MathUtil.lerp(Q._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,S),Q._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,S),i.getFloat());r[7]=i.seed}break}var C=t.textureSheetAnimation;var F=C&&C.enable;if(F){var R=C.tiles;var A=R.x,L=R.y;var I=1/A,M=1/L;var D;var w=C.startFrame;switch(w.type){case 0:D=w.constant;break;case 1:if(a){D=Et.MathUtil.lerp(w.constantMin,w.constantMax,Math.random())}else{i.seed=r[14];D=Et.MathUtil.lerp(w.constantMin,w.constantMax,i.getFloat());r[14]=i.seed}break}var P=C.frame;var O=C.cycles;switch(P.type){case 0:D+=P.constant*O;break;case 2:if(a){D+=Et.MathUtil.lerp(P.constantMin,P.constantMax,Math.random())*O}else{i.seed=r[15];D+=Et.MathUtil.lerp(P.constantMin,P.constantMax,i.getFloat())*O;r[15]=i.seed}break}var N=0;switch(C.type){case 0:N=Math.floor(D/A);break;case 1:if(C.randomRow){if(a){N=Math.floor(Math.random()*L)}else{i.seed=r[13];N=Math.floor(i.getFloat()*L);r[13]=i.seed}}else{N=C.rowIndex}break}var V=Math.floor(D%A);Q.startUVInfo=Q.startUVInfo;Q.startUVInfo[0]=I;Q.startUVInfo[1]=M;Q.startUVInfo[2]=V*I;Q.startUVInfo[3]=N*M}else{Q.startUVInfo=Q.startUVInfo;Q.startUVInfo[0]=1;Q.startUVInfo[1]=1;Q.startUVInfo[2]=0;Q.startUVInfo[3]=0}}}Q._tempVector30=new St;Q.startColor=new bt;Q.startSize=new Float32Array(3);Q.startRotation=new Float32Array(3);Q.startUVInfo=new Float32Array(4);class ti extends Fe{constructor(t){super();this._boundingSphere=null;this._boundingBox=null;this._boundingBoxCorners=null;this._bounds=null;this._gravityOffset=new Ct;this._customBounds=null;this._useCustomBounds=false;this._owner=null;this._ownerRender=null;this._vertices=null;this._floatCountPerVertex=0;this._startLifeTimeIndex=0;this._timeIndex=0;this._simulateUpdate=false;this._firstActiveElement=0;this._firstNewElement=0;this._firstFreeElement=0;this._firstRetiredElement=0;this._drawCounter=0;this._bufferMaxParticles=0;this._emission=null;this._shape=null;this._isEmitting=false;this._isPlaying=false;this._isPaused=false;this._playStartDelay=0;this._frameRateTime=0;this._emissionTime=0;this._totalDelayTime=0;this._burstsIndex=0;this._velocityOverLifetime=null;this._colorOverLifetime=null;this._sizeOverLifetime=null;this._rotationOverLifetime=null;this._textureSheetAnimation=null;this._startLifetimeType=0;this._startLifetimeConstant=0;this._startLifeTimeGradient=null;this._startLifetimeConstantMin=0;this._startLifetimeConstantMax=0;this._startLifeTimeGradientMin=null;this._startLifeTimeGradientMax=null;this._maxStartLifetime=0;this._uvLength=new Ct;this._vertexStride=0;this._indexStride=0;this._vertexBuffer=null;this._indexBuffer=null;this._bufferState=new Rt;this._updateMask=0;this._currentTime=0;this._startUpdateLoopCount=0;this._rand=null;this._randomSeeds=null;this.duration=0;this.looping=false;this.prewarm=false;this.startDelayType=0;this.startDelay=0;this.startDelayMin=0;this.startDelayMax=0;this.startSpeedType=0;this.startSpeedConstant=0;this.startSpeedConstantMin=0;this.startSpeedConstantMax=0;this.threeDStartSize=false;this.startSizeType=0;this.startSizeConstant=0;this.startSizeConstantSeparate=null;this.startSizeConstantMin=0;this.startSizeConstantMax=0;this.startSizeConstantMinSeparate=null;this.startSizeConstantMaxSeparate=null;this.threeDStartRotation=false;this.startRotationType=0;this.startRotationConstant=0;this.startRotationConstantSeparate=null;this.startRotationConstantMin=0;this.startRotationConstantMax=0;this.startRotationConstantMinSeparate=null;this.startRotationConstantMaxSeparate=null;this.randomizeRotationDirection=0;this.startColorType=0;this.startColorConstant=new bt(1,1,1,1);this.startColorConstantMin=new bt(0,0,0,0);this.startColorConstantMax=new bt(1,1,1,1);this.gravityModifier=0;this.simulationSpace=0;this.simulationSpeed=1;this.scaleMode=1;this.playOnAwake=false;this.randomSeed=null;this.autoRandomSeed=false;this.isPerformanceMode=false;this._firstActiveElement=0;this._firstNewElement=0;this._firstFreeElement=0;this._firstRetiredElement=0;this._owner=t;this._ownerRender=t.particleRenderer;this._boundingBoxCorners=[];this._boundingSphere=new aa(new St,Number.MAX_VALUE);this._boundingBox=new Ne(new St(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new St(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE));this._bounds=new Be(this._boundingBox.min,this._boundingBox.max);this._useCustomBounds=false;this._currentTime=0;this._isEmitting=false;this._isPlaying=false;this._isPaused=false;this._burstsIndex=0;this._frameRateTime=0;this._emissionTime=0;this._totalDelayTime=0;this._simulateUpdate=false;this._bufferMaxParticles=1;this.duration=5;this.looping=true;this.prewarm=false;this.startDelayType=0;this.startDelay=0;this.startDelayMin=0;this.startDelayMax=0;this._startLifetimeType=0;this._startLifetimeConstant=5;this._startLifeTimeGradient=new Oa;this._startLifetimeConstantMin=0;this._startLifetimeConstantMax=5;this._startLifeTimeGradientMin=new Oa;this._startLifeTimeGradientMax=new Oa;this._maxStartLifetime=5;this.startSpeedType=0;this.startSpeedConstant=5;this.startSpeedConstantMin=0;this.startSpeedConstantMax=5;this.threeDStartSize=false;this.startSizeType=0;this.startSizeConstant=1;this.startSizeConstantSeparate=new St(1,1,1);this.startSizeConstantMin=0;this.startSizeConstantMax=1;this.startSizeConstantMinSeparate=new St(0,0,0);this.startSizeConstantMaxSeparate=new St(1,1,1);this.threeDStartRotation=false;this.startRotationType=0;this.startRotationConstant=0;this.startRotationConstantSeparate=new St(0,0,0);this.startRotationConstantMin=0;this.startRotationConstantMax=0;this.startRotationConstantMinSeparate=new St(0,0,0);this.startRotationConstantMaxSeparate=new St(0,0,0);this.gravityModifier=0;this.simulationSpace=1;this.scaleMode=1;this.playOnAwake=true;this._rand=new Ja(0);this.autoRandomSeed=true;this.randomSeed=new Uint32Array(1);this._randomSeeds=new Uint32Array(ti._RANDOMOFFSET.length);this.isPerformanceMode=true;this._emission=new $a;this._emission.enable=true}get maxParticles(){return this._bufferMaxParticles-1}set maxParticles(t){var e=t+1;if(e!==this._bufferMaxParticles){this._bufferMaxParticles=e;this._initBufferDatas()}}get emission(){return this._emission}get aliveParticleCount(){if(this._firstNewElement>=this._firstRetiredElement)return this._firstNewElement-this._firstRetiredElement;else return this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}get emissionTime(){return this._emissionTime>this.duration?this.duration:this._emissionTime}get shape(){return this._shape}set shape(t){if(this._shape!==t){if(t&&t.enable)this._owner._render._shaderValues.addDefine(f.SHADERDEFINE_SHAPE);else this._owner._render._shaderValues.removeDefine(f.SHADERDEFINE_SHAPE);this._shape=t}}get isAlive(){if(this._isPlaying||this.aliveParticleCount>0)return true;return false}get isEmitting(){return this._isEmitting}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get startLifetimeType(){return this._startLifetimeType}set startLifetimeType(t){var e,a;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var i=i;for(e=0,a=i.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,i.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,a=r.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var s=s;for(e=0,a=s.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,s.getValueByIndex(e));break}this._startLifetimeType=t}get startLifetimeConstant(){return this._startLifetimeConstant}set startLifetimeConstant(t){if(this._startLifetimeType===0)this._maxStartLifetime=t;this._startLifetimeConstant=t}get startLifeTimeGradient(){return this._startLifeTimeGradient}set startLifeTimeGradient(t){if(this._startLifetimeType===1){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,a=t.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}get startLifetimeConstantMin(){return this._startLifetimeConstantMin}set startLifetimeConstantMin(t){if(this._startLifetimeType===2)this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax);this._startLifetimeConstantMin=t}get startLifetimeConstantMax(){return this._startLifetimeConstantMax}set startLifetimeConstantMax(t){if(this._startLifetimeType===2)this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t);this._startLifetimeConstantMax=t}get startLifeTimeGradientMin(){return this._startLifeTimeGradientMin}set startLifeTimeGradientMin(t){if(this._startLifetimeType===3){var e,a;this._maxStartLifetime=-Number.MAX_VALUE;for(e=0,a=t.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,a=this._startLifeTimeGradientMax.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}get startLifeTimeGradientMax(){return this._startLifeTimeGradientMax}set startLifeTimeGradientMax(t){if(this._startLifetimeType===3){var e,a;this._maxStartLifetime=-Number.MAX_VALUE;for(e=0,a=this._startLifeTimeGradientMin.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,a=t.gradientCount;e<a;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}get velocityOverLifetime(){return this._velocityOverLifetime}set velocityOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var a=t.velocity;var i=a.type;if(t.enable){switch(i){case 0:e.addDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e.addDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e.addDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e.addDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);break}}else{e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}switch(i){case 0:e.setVector3(f.VOLVELOCITYCONST,a.constant);break;case 1:e.setBuffer(f.VOLVELOCITYGRADIENTX,a.gradientX._elements);e.setBuffer(f.VOLVELOCITYGRADIENTY,a.gradientY._elements);e.setBuffer(f.VOLVELOCITYGRADIENTZ,a.gradientZ._elements);break;case 2:e.setVector3(f.VOLVELOCITYCONST,a.constantMin);e.setVector3(f.VOLVELOCITYCONSTMAX,a.constantMax);break;case 3:e.setBuffer(f.VOLVELOCITYGRADIENTX,a.gradientXMin._elements);e.setBuffer(f.VOLVELOCITYGRADIENTXMAX,a.gradientXMax._elements);e.setBuffer(f.VOLVELOCITYGRADIENTY,a.gradientYMin._elements);e.setBuffer(f.VOLVELOCITYGRADIENTYMAX,a.gradientYMax._elements);e.setBuffer(f.VOLVELOCITYGRADIENTZ,a.gradientZMin._elements);e.setBuffer(f.VOLVELOCITYGRADIENTZMAX,a.gradientZMax._elements);break}e.setInt(f.VOLSPACETYPE,t.space)}else{e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);e.removeDefine(f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}this._velocityOverLifetime=t}get colorOverLifetime(){return this._colorOverLifetime}set colorOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var a=t.color;if(t.enable){switch(a.type){case 1:e.addDefine(f.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e.addDefine(f.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);break}}else{e.removeDefine(f.SHADERDEFINE_COLOROVERLIFETIME);e.removeDefine(f.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}switch(a.type){case 1:var i=a.gradient;e.setBuffer(f.COLOROVERLIFEGRADIENTALPHAS,i._alphaElements);e.setBuffer(f.COLOROVERLIFEGRADIENTCOLORS,i._rgbElements);break;case 3:var r=a.gradientMin;var s=a.gradientMax;e.setBuffer(f.COLOROVERLIFEGRADIENTALPHAS,r._alphaElements);e.setBuffer(f.COLOROVERLIFEGRADIENTCOLORS,r._rgbElements);e.setBuffer(f.MAXCOLOROVERLIFEGRADIENTALPHAS,s._alphaElements);e.setBuffer(f.MAXCOLOROVERLIFEGRADIENTCOLORS,s._rgbElements);break}}else{e.removeDefine(f.SHADERDEFINE_COLOROVERLIFETIME);e.removeDefine(f.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);e.setBuffer(f.COLOROVERLIFEGRADIENTALPHAS,i._alphaElements);e.setBuffer(f.COLOROVERLIFEGRADIENTCOLORS,i._rgbElements);e.setBuffer(f.COLOROVERLIFEGRADIENTALPHAS,r._alphaElements);e.setBuffer(f.COLOROVERLIFEGRADIENTCOLORS,r._rgbElements);e.setBuffer(f.MAXCOLOROVERLIFEGRADIENTALPHAS,s._alphaElements);e.setBuffer(f.MAXCOLOROVERLIFEGRADIENTCOLORS,s._rgbElements)}this._colorOverLifetime=t}get sizeOverLifetime(){return this._sizeOverLifetime}set sizeOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var a=t.size;var i=a.separateAxes;var r=a.type;if(t.enable){switch(r){case 0:if(i)e.addDefine(f.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);else e.addDefine(f.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:if(i)e.addDefine(f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);else e.addDefine(f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);break}}else{e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMECURVE);e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE)}switch(r){case 0:if(i){e.setBuffer(f.SOLSIZEGRADIENTX,a.gradientX._elements);e.setBuffer(f.SOLSIZEGRADIENTY,a.gradientY._elements);e.setBuffer(f.SOLSizeGradientZ,a.gradientZ._elements)}else{e.setBuffer(f.SOLSIZEGRADIENT,a.gradient._elements)}break;case 2:if(i){e.setBuffer(f.SOLSIZEGRADIENTX,a.gradientXMin._elements);e.setBuffer(f.SOLSIZEGRADIENTXMAX,a.gradientXMax._elements);e.setBuffer(f.SOLSIZEGRADIENTY,a.gradientYMin._elements);e.setBuffer(f.SOLSIZEGRADIENTYMAX,a.gradientYMax._elements);e.setBuffer(f.SOLSizeGradientZ,a.gradientZMin._elements);e.setBuffer(f.SOLSizeGradientZMAX,a.gradientZMax._elements)}else{e.setBuffer(f.SOLSIZEGRADIENT,a.gradientMin._elements);e.setBuffer(f.SOLSizeGradientMax,a.gradientMax._elements)}break}}else{e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMECURVE);e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);e.removeDefine(f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE)}this._sizeOverLifetime=t}get rotationOverLifetime(){return this._rotationOverLifetime}set rotationOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var a=t.angularVelocity;if(!a)return;var i=a.separateAxes;var r=a.type;if(t.enable){if(i)e.addDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);else e.addDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIME);switch(r){case 0:e.addDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e.addDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e.addDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e.addDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);break}}else{e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIME);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}switch(r){case 0:if(i){e.setVector3(f.ROLANGULARVELOCITYCONSTSEPRARATE,a.constantSeparate)}else{e.setNumber(f.ROLANGULARVELOCITYCONST,a.constant)}break;case 1:if(i){e.setBuffer(f.ROLANGULARVELOCITYGRADIENTX,a.gradientX._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTY,a.gradientY._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTZ,a.gradientZ._elements)}else{e.setBuffer(f.ROLANGULARVELOCITYGRADIENT,a.gradient._elements)}break;case 2:if(i){e.setVector3(f.ROLANGULARVELOCITYCONSTSEPRARATE,a.constantMinSeparate);e.setVector3(f.ROLANGULARVELOCITYCONSTMAXSEPRARATE,a.constantMaxSeparate)}else{e.setNumber(f.ROLANGULARVELOCITYCONST,a.constantMin);e.setNumber(f.ROLANGULARVELOCITYCONSTMAX,a.constantMax)}break;case 3:if(i){e.setBuffer(f.ROLANGULARVELOCITYGRADIENTX,a.gradientXMin._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTXMAX,a.gradientXMax._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTY,a.gradientYMin._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTYMAX,a.gradientYMax._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTZ,a.gradientZMin._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTZMAX,a.gradientZMax._elements)}else{e.setBuffer(f.ROLANGULARVELOCITYGRADIENT,a.gradientMin._elements);e.setBuffer(f.ROLANGULARVELOCITYGRADIENTMAX,a.gradientMax._elements)}break}}else{e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIME);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);e.removeDefine(f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}this._rotationOverLifetime=t}get textureSheetAnimation(){return this._textureSheetAnimation}set textureSheetAnimation(t){var e=this._owner._render._shaderValues;if(t){var a=t.frame;var i=a.type;if(t.enable){switch(i){case 1:e.addDefine(f.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e.addDefine(f.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);break}}else{e.removeDefine(f.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);e.removeDefine(f.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}if(i===1||i===3){e.setNumber(f.TEXTURESHEETANIMATIONCYCLES,t.cycles);var r=t.tiles;var s=this._uvLength;s.x=1/r.x;s.y=1/r.y;e.setVector2(f.TEXTURESHEETANIMATIONSUBUVLENGTH,this._uvLength)}switch(i){case 1:e.setBuffer(f.TEXTURESHEETANIMATIONGRADIENTUVS,a.frameOverTimeData._elements);break;case 3:e.setBuffer(f.TEXTURESHEETANIMATIONGRADIENTUVS,a.frameOverTimeDataMin._elements);e.setBuffer(f.TEXTURESHEETANIMATIONGRADIENTMAXUVS,a.frameOverTimeDataMax._elements);break}}else{e.removeDefine(f.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);e.removeDefine(f.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}this._textureSheetAnimation=t}_getVertexBuffer(t=0){if(t===0)return this._vertexBuffer;else return null}_getIndexBuffer(){return this._indexBuffer}_generateBoundingSphere(){var t=this._boundingSphere.center;t.x=0;t.y=0;t.z=0;this._boundingSphere.radius=Number.MAX_VALUE}_generateBoundingBox(){var B=this._owner;var t=B.particleRenderer;var e=this._boundingBox.min;var a=this._boundingBox.max;var i,r;var s;switch(this.startLifetimeType){case 0:s=this.startLifetimeConstant;break;case 1:s=-Number.MAX_VALUE;var n=n;for(i=0,r=n.gradientCount;i<r;i++)s=Math.max(s,n.getValueByIndex(i));break;case 2:s=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:s=-Number.MAX_VALUE;var o=o;for(i=0,r=o.gradientCount;i<r;i++)s=Math.max(s,o.getValueByIndex(i));var F=F;for(i=0,r=F.gradientCount;i<r;i++)s=Math.max(s,F.getValueByIndex(i));break}var l,_;switch(this.startSpeedType){case 0:l=_=this.startSpeedConstant;break;case 1:break;case 2:l=this.startLifetimeConstantMin;_=this.startLifetimeConstantMax;break;case 3:break}var V,U,h,x;if(this._shape&&this._shape.enable);else{V=U=St._ZERO;h=St._ZERO;x=St._UnitZ}var c=new St(h.x*l,h.y*l,h.z*l);var d=new St(x.x*_,x.y*_,x.z*_);if(this._velocityOverLifetime&&this._velocityOverLifetime.enable){var u;var f;var p=this._velocityOverLifetime.velocity;switch(p.type){case 0:u=f=p.constant;break;case 1:u=f=new St(p.gradientX.getAverageValue(),p.gradientY.getAverageValue(),p.gradientZ.getAverageValue());break;case 2:u=p.constantMin;f=p.constantMax;break;case 3:u=new St(p.gradientXMin.getAverageValue(),p.gradientYMin.getAverageValue(),p.gradientZMin.getAverageValue());f=new St(p.gradientXMax.getAverageValue(),p.gradientYMax.getAverageValue(),p.gradientZMax.getAverageValue());break}}var m,g;var v=this._owner.transform;var k=v.position;var y=ti._tempVector39;var T=t.renderMode;switch(this.scaleMode){case 0:var E=v.getWorldLossyScale();m=E;y.x=E.x;y.y=E.z;y.z=E.y;T===1&&(g=E);break;case 1:var b=v.localScale;m=b;y.x=b.x;y.y=b.z;y.z=b.y;T===1&&(g=b);break;case 2:m=v.getWorldLossyScale();y.x=y.y=y.z=1;T===1&&(g=St._ONE);break}var S,C;if(this._velocityOverLifetime&&this._velocityOverLifetime.enable);else{S=new St(c.x*s,c.y*s,c.z*s);C=new St(d.x*s,d.y*s,d.z*s);if(this.scaleMode!=2){St.add(V,S,e);St.multiply(m,e,e);St.add(U,C,a);St.multiply(m,a,a)}else{St.multiply(m,V,e);St.add(e,S,e);St.multiply(m,U,a);St.add(a,C,a)}}switch(this.simulationSpace){case 0:break;case 1:St.add(e,k,e);St.add(a,k,a);break}var R,A;switch(this.startSizeType){case 0:if(this.threeDStartSize){var L=L;R=Math.max(L.x,L.y);if(T===1)A=L.y}else{R=this.startSizeConstant;if(T===1)A=this.startSizeConstant}break;case 1:break;case 2:if(this.threeDStartSize){var I=I;R=Math.max(I.x,I.y);if(T===1)A=I.y}else{R=this.startSizeConstantMax;if(T===1)A=this.startSizeConstantMax}break;case 3:break}if(this._sizeOverLifetime&&this._sizeOverLifetime.enable){var G=this._sizeOverLifetime.size;R*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var M=ti._tempVector30;var H,D;switch(T){case 0:H=R*ti.halfKSqrtOf2;St.scale(y,R,M);St.subtract(e,M,e);St.add(a,M,a);break;case 1:var w=ti._tempVector31;var z=ti._tempVector32;var W=ti._tempVector33;var P=ti._tempVector34;if(this._velocityOverLifetime&&this._velocityOverLifetime.enable);else{St.multiply(g,d,z);St.multiply(g,c,W)}var X=A*t.stretchedBillboardLengthScale;var Y=St.scalarLength(z)*t.stretchedBillboardSpeedScale+X;var j=St.scalarLength(W)*t.stretchedBillboardSpeedScale+X;var q=ti._tempVector35;var Z=ti._tempVector36;St.normalize(z,q);St.scale(q,Y,P);St.subtract(C,P,P);St.normalize(W,Z);St.scale(Z,j,w);St.add(S,w,w);H=R*ti.halfKSqrtOf2;St.scale(y,H,M);var O=ti._tempVector37;var N=ti._tempVector38;St.scale(q,.5,O);St.scale(Z,.5,N);St.multiply(O,y,O);St.multiply(N,y,N);St.add(e,N,e);St.min(e,P,e);St.subtract(e,M,e);St.subtract(a,O,a);St.max(a,w,a);St.add(a,M,a);break;case 2:R*=Math.cos(.7853981633974483);D=R*.5;M.x=y.x*D;M.y=y.z*D;St.subtract(e,M,e);St.add(a,M,a);break;case 3:R*=Math.cos(.7853981633974483);D=R*.5;St.scale(y,D,M);St.subtract(e,M,e);St.add(a,M,a);break}this._boundingBox.getCorners(this._boundingBoxCorners)}_generateBounds(){var t=this._owner;var e=t.particleRenderer;var a=this._bounds.getMin();var i=this._bounds.getMax();var r=0;switch(this.startLifetimeType){case 0:r=this._startLifetimeConstant;break;case 2:r=this._startLifetimeConstantMax;break;case 1:case 3:default:break}var s=0;switch(this.startSpeedType){case 0:s=this.startSpeedConstant;break;case 2:s=this.startSpeedConstantMax;break;case 1:case 3:default:break}var n=0;if(this.threeDStartSize){switch(this.startSizeType){case 0:n=Math.max(this.startSizeConstantSeparate.x,this.startSizeConstantSeparate.y,this.startSizeConstantSeparate.z);break;case 2:n=Math.max(this.startSizeConstantMaxSeparate.x,this.startSizeConstantMaxSeparate.y,this.startSizeConstantMaxSeparate.z);break;case 1:case 3:default:break}}else{switch(this.startSizeType){case 0:n=this.startSizeConstant;break;case 2:n=this.startSizeConstantMax;break;case 1:case 3:default:break}}var o=ti._tempVector30;var l=ti._tempVector31;var _=ti._tempVector32;var h=ti._tempVector33;o.setValue(0,0,1);l.setValue(0,0,0);_.setValue(0,0,0);h.setValue(0,0,0);if(this.shape&&this.shape.enable){switch(this.shape.shapeType){case H.ParticleSystemShapeType.Sphere:var x=this.shape;o.setValue(1,1,1);l.setValue(1,1,1);_.setValue(x.radius,x.radius,x.radius);h.setValue(x.radius,x.radius,x.radius);break;case H.ParticleSystemShapeType.Hemisphere:var c=this.shape;o.setValue(1,1,1);l.setValue(1,1,1);_.setValue(c.radius,c.radius,c.radius);h.setValue(c.radius,c.radius,0);break;case H.ParticleSystemShapeType.Cone:var d=this.shape;if(d.emitType==0||d.emitType==1){var u=d.angle;var f=Math.sin(u);o.setValue(f,f,1);l.setValue(f,f,0);_.setValue(d.radius,d.radius,0);h.setValue(d.radius,d.radius,0);break}else if(d.emitType==2||d.emitType==3){var u=d.angle;var f=Math.sin(u);var p=d.length;o.setValue(f,f,1);l.setValue(f,f,0);var m=Math.tan(u);var g=d.radius+p*m;_.setValue(g,g,p);h.setValue(g,g,0)}break;case H.ParticleSystemShapeType.Box:var v=this.shape;if(this.shape.randomDirection!=0){o.setValue(1,1,1);l.setValue(1,1,1)}_.setValue(v.x/2,v.y/2,v.z/2);h.setValue(v.x/2,v.y/2,v.z/2);break;case H.ParticleSystemShapeType.Circle:var y=this.shape;o.setValue(1,1,1);l.setValue(1,1,1);_.setValue(y.radius,y.radius,0);h.setValue(y.radius,y.radius,0);break;default:break}}var T=0;var E=e.renderMode==4;switch(e.renderMode){case 0:case 1:case 2:case 3:T=ti.halfKSqrtOf2;break;case 4:var b=e.mesh.bounds;T=Math.sqrt(Math.pow(b.getExtent().x,2)+Math.pow(b.getExtent().y,2)+Math.pow(b.getExtent().z,2));break;default:break}var S=ti._tempVector36;S.setValue(1,1,1);if(this.sizeOverLifetime&&this.sizeOverLifetime.enable){var C=this.sizeOverLifetime.size;var R=C.getMaxSizeInGradient(E);S.setValue(R,R,R)}var A=T*n;St.scale(S,A,S);var L=ti._tempVector34;var I=ti._tempVector35;if(s>0){St.scale(o,s,L);St.scale(l,s,I)}else{St.scale(o,-s,I);St.scale(l,-s,L)}if(this.velocityOverLifetime&&this.velocityOverLifetime.enable){var M=this.velocityOverLifetime.velocity;var D=ti._tempVector37;D.setValue(0,0,0);switch(M.type){case 0:M.constant.cloneTo(D);break;case 2:M.constantMax.cloneTo(D);break;case 1:var B=M.gradientX.getAverageValue();var F=M.gradientY.getAverageValue();var V=M.gradientZ.getAverageValue();D.setValue(B,F,V);break;case 3:var U=M.gradientXMax.getAverageValue();var k=M.gradientYMax.getAverageValue();var G=M.gradientZMax.getAverageValue();D.setValue(U,k,G);break;default:break}if(this.velocityOverLifetime.space==1){St.transformV3ToV3(D,this._owner.transform.worldMatrix,D)}St.add(L,D,L);St.subtract(I,D,I);St.max(L,St._ZERO,L);St.max(I,St._ZERO,I)}St.scale(L,r,L);St.scale(I,r,I);var w=this.gravityModifier;if(w!=0){var P=.5*ti.g*w*r*r;var O=L.y-P;var N=I.y+P;O=O>0?O:0;N=N>0?N:0;this._gravityOffset.setValue(L.y-O,N-I.y)}St.add(L,S,i);St.add(i,_,i);St.add(I,S,a);St.add(a,h,a);St.scale(a,-1,a);this._bounds.setMin(a);this._bounds.setMax(i)}get customBounds(){return this._customBounds}set customBounds(t){if(t){this._useCustomBounds=true}else{this._useCustomBounds=false}this._customBounds=t}_simulationSupported(){if(this.simulationSpace==0){return false}return true}_updateEmission(){if(!this.isAlive)return;if(this._simulateUpdate){this._simulateUpdate=false}else{var t=this._startUpdateLoopCount!==Et.Stat.loopCount&&!this._isPaused?this._owner._scene.timer._delta/1e3:0;t=Math.min(ti._maxElapsedTime,t*this.simulationSpeed);this._updateParticles(t)}}_updateParticles(t){if(this._ownerRender.renderMode===4&&!this._ownerRender.mesh)return;this._currentTime+=t;this._retireActiveParticles();this._freeRetiredParticles();this._totalDelayTime+=t;if(this._totalDelayTime<this._playStartDelay){return}if(this._emission.enable&&this._isEmitting&&!this._isPaused)this._advanceTime(t,this._currentTime)}_updateParticlesSimulationRestart(t){this._firstActiveElement=0;this._firstNewElement=0;this._firstFreeElement=0;this._firstRetiredElement=0;this._burstsIndex=0;this._frameRateTime=t;this._emissionTime=0;this._totalDelayTime=0;this._currentTime=t;var e=t;if(e<this._playStartDelay){this._totalDelayTime=e;return}if(this._emission.enable)this._advanceTime(t,t)}_retireActiveParticles(){const t=1e-4;while(this._firstActiveElement!=this._firstNewElement){var e=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride;var a=e+this._timeIndex;var i=this._currentTime-this._vertices[a];if(i+t<this._vertices[e+this._startLifeTimeIndex])break;this._vertices[a]=this._drawCounter;this._firstActiveElement++;if(this._firstActiveElement>=this._bufferMaxParticles)this._firstActiveElement=0}}_freeRetiredParticles(){while(this._firstRetiredElement!=this._firstActiveElement){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];this._firstRetiredElement++;if(this._firstRetiredElement>=this._bufferMaxParticles)this._firstRetiredElement=0}}_burst(t,e){var a=0;var i=this._emission._bursts;for(var r=i.length;this._burstsIndex<r;this._burstsIndex++){var s=i[this._burstsIndex];var n=s.time;if(t<=n&&n<e){var o;if(this.autoRandomSeed){o=Et.MathUtil.lerp(s.minCount,s.maxCount,Math.random())}else{this._rand.seed=this._randomSeeds[0];o=Et.MathUtil.lerp(s.minCount,s.maxCount,this._rand.getFloat());this._randomSeeds[0]=this._rand.seed}a+=o}else{break}}return a}_advanceTime(t,e){var a;var i=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(this.looping){r+=this._burst(i,this._emissionTime);this._emissionTime-=this.duration;this._burstsIndex=0;r+=this._burst(0,this._emissionTime)}else{r=Math.min(this.maxParticles-this.aliveParticleCount,r);for(a=0;a<r;a++)this.emit(e);this._isPlaying=false;this.stop();return}}else{r+=this._burst(i,this._emissionTime)}r=Math.min(this.maxParticles-this.aliveParticleCount,r);for(a=0;a<r;a++)this.emit(e);var s=this.emission.emissionRate;if(s>0){var n=1/s;this._frameRateTime+=n;this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;while(this._frameRateTime<=e){if(this.emit(this._frameRateTime))this._frameRateTime+=n;else break}this._frameRateTime=Math.floor(e/n)*n}}_initBufferDatas(){if(this._vertexBuffer){var t=this._vertexBuffer._byteLength+this._indexBuffer.indexCount*2;this._vertexBuffer.destroy();this._indexBuffer.destroy();Et.Resource._addMemory(-t,-t)}var e=Et.LayaGL.instance;var a=this._ownerRender;var i=a.renderMode;if(i!==-1&&this.maxParticles>0){var r,s,n,o,l,_,h;var x=0,t=0;var c=a.mesh;if(i===4){if(c){h=Qa.vertexDeclaration;this._floatCountPerVertex=h.vertexStride/4;this._startLifeTimeIndex=12;this._timeIndex=16;this._vertexStride=c._vertexCount;var d=this._bufferMaxParticles*this._vertexStride;var u=Math.floor(d/65535)+1;var f=d%65535;if(u>1){throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.")}x=h.vertexStride*f;this._vertexBuffer=new vt(x,e.DYNAMIC_DRAW);this._vertexBuffer.vertexDeclaration=h;this._vertices=new Float32Array(this._floatCountPerVertex*f);this._indexStride=c._indexBuffer.indexCount;var p=c._indexBuffer.getData();var m=this._bufferMaxParticles*this._indexStride;this._indexBuffer=new jt(H.IndexFormat.UInt16,m,e.STATIC_DRAW);r=new Uint16Array(m);t=x+m*2;l=0;for(s=0;s<this._bufferMaxParticles;s++){var g=s*this._vertexStride;for(n=0,o=p.length;n<o;n++)r[l++]=g+p[n]}this._indexBuffer.setData(r);this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.applyIndexBuffer(this._indexBuffer);this._bufferState.unBind()}}else{h=Ka.vertexDeclaration;this._floatCountPerVertex=h.vertexStride/4;this._startLifeTimeIndex=7;this._timeIndex=11;this._vertexStride=4;x=h.vertexStride*this._bufferMaxParticles*this._vertexStride;this._vertexBuffer=new vt(x,e.DYNAMIC_DRAW);this._vertexBuffer.vertexDeclaration=h;this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride);for(s=0;s<this._bufferMaxParticles;s++){_=s*this._floatCountPerVertex*this._vertexStride;this._vertices[_]=-.5;this._vertices[_+1]=-.5;this._vertices[_+2]=0;this._vertices[_+3]=1;_+=this._floatCountPerVertex;this._vertices[_]=.5;this._vertices[_+1]=-.5;this._vertices[_+2]=1;this._vertices[_+3]=1;_+=this._floatCountPerVertex;this._vertices[_]=.5;this._vertices[_+1]=.5;this._vertices[_+2]=1;this._vertices[_+3]=0;_+=this._floatCountPerVertex;this._vertices[_]=-.5;this._vertices[_+1]=.5;this._vertices[_+2]=0;this._vertices[_+3]=0}this._indexStride=6;this._indexBuffer=new jt(H.IndexFormat.UInt16,this._bufferMaxParticles*6,e.STATIC_DRAW);r=new Uint16Array(this._bufferMaxParticles*6);for(s=0;s<this._bufferMaxParticles;s++){l=s*6;var v=s*this._vertexStride,y=v+2;r[l++]=v;r[l++]=y;r[l++]=v+1;r[l++]=v;r[l++]=v+3;r[l++]=y}this._indexBuffer.setData(r);t=x+this._bufferMaxParticles*6*2;this._bufferState.bind();this._bufferState.applyVertexBuffer(this._vertexBuffer);this._bufferState.applyIndexBuffer(this._indexBuffer);this._bufferState.unBind()}Et.Resource._addMemory(t,t)}}destroy(){super.destroy();var t=this._vertexBuffer._byteLength+this._indexBuffer.indexCount*2;Et.Resource._addMemory(-t,-t);this._bufferState.destroy();this._vertexBuffer.destroy();this._indexBuffer.destroy();this._emission.destroy();this._boundingBox=null;this._boundingSphere=null;this._boundingBoxCorners=null;this._bounds=null;this._customBounds=null;this._bufferState=null;this._vertexBuffer=null;this._indexBuffer=null;this._owner=null;this._vertices=null;this._indexBuffer=null;this._emission=null;this._shape=null;this.startLifeTimeGradient=null;this.startLifeTimeGradientMin=null;this.startLifeTimeGradientMax=null;this.startSizeConstantSeparate=null;this.startSizeConstantMinSeparate=null;this.startSizeConstantMaxSeparate=null;this.startRotationConstantSeparate=null;this.startRotationConstantMinSeparate=null;this.startRotationConstantMaxSeparate=null;this.startColorConstant=null;this.startColorConstantMin=null;this.startColorConstantMax=null;this._velocityOverLifetime=null;this._colorOverLifetime=null;this._sizeOverLifetime=null;this._rotationOverLifetime=null;this._textureSheetAnimation=null}emit(t){var e=ti._tempPosition;var a=ti._tempDirection;if(this._shape&&this._shape.enable){if(this.autoRandomSeed)this._shape.generatePositionAndDirection(e,a);else this._shape.generatePositionAndDirection(e,a,this._rand,this._randomSeeds)}else{e.x=e.y=e.z=0;a.x=a.y=0;a.z=1}return this.addParticle(e,a,t)}addParticle(t,e,a){St.normalize(e,e);var i=this._firstFreeElement+1;if(i>=this._bufferMaxParticles)i=0;if(i===this._firstRetiredElement)return false;var r=this._owner.transform;Q.create(this,this._ownerRender,r);var B=this._currentTime-a;if(B>=Q.startLifeTime)return true;var s,n;if(this.simulationSpace==0){s=r.position;n=r.rotation}var o;switch(this.startSpeedType){case 0:o=this.startSpeedConstant;break;case 2:if(this.autoRandomSeed){o=Et.MathUtil.lerp(this.startSpeedConstantMin,this.startSpeedConstantMax,Math.random())}else{this._rand.seed=this._randomSeeds[8];o=Et.MathUtil.lerp(this.startSpeedConstantMin,this.startSpeedConstantMax,this._rand.getFloat());this._randomSeeds[8]=this._rand.seed}break}var l,_,h,x,c,d,u;var f=this._velocityOverLifetime&&this._velocityOverLifetime.enable;if(f){var F=this._velocityOverLifetime.velocity.type;if(F===2||F===3){if(this.autoRandomSeed){l=Math.random();_=Math.random();h=Math.random()}else{this._rand.seed=this._randomSeeds[9];l=this._rand.getFloat();_=this._rand.getFloat();h=this._rand.getFloat();this._randomSeeds[9]=this._rand.seed}}else{f=false}}else{f=false}var p=this._colorOverLifetime&&this._colorOverLifetime.enable;if(p){var V=this._colorOverLifetime.color.type;if(V===3){if(this.autoRandomSeed){x=Math.random()}else{this._rand.seed=this._randomSeeds[10];x=this._rand.getFloat();this._randomSeeds[10]=this._rand.seed}}else{p=false}}else{p=false}var m=this._sizeOverLifetime&&this._sizeOverLifetime.enable;if(m){var U=this._sizeOverLifetime.size.type;if(U===3){if(this.autoRandomSeed){c=Math.random()}else{this._rand.seed=this._randomSeeds[11];c=this._rand.getFloat();this._randomSeeds[11]=this._rand.seed}}else{m=false}}else{m=false}var g=this._rotationOverLifetime&&this._rotationOverLifetime.enable;if(g){var k=this._rotationOverLifetime.angularVelocity.type;if(k===2||k===3){if(this.autoRandomSeed){d=Math.random()}else{this._rand.seed=this._randomSeeds[12];d=this._rand.getFloat();this._randomSeeds[12]=this._rand.seed}}else{g=false}}else{g=false}var v=this._textureSheetAnimation&&this._textureSheetAnimation.enable;if(v){var G=this._textureSheetAnimation.frame.type;if(G===3){if(this.autoRandomSeed){u=Math.random()}else{this._rand.seed=this._randomSeeds[15];u=this._rand.getFloat();this._randomSeeds[15]=this._rand.seed}}else{v=false}}else{v=false}var y=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride;var T=Q.startUVInfo[0];var E=Q.startUVInfo[1];var b=Q.startUVInfo[2];var S=Q.startUVInfo[3];var C,H,z,R,A,W;var L=this._ownerRender;if(L.renderMode===4){var X=L.mesh._vertexBuffer;C=X.getFloat32Data();var I=X.vertexDeclaration;z=I.getVertexElementByUsage(K.MESH_POSITION0)._offset/4;var Y=I.getVertexElementByUsage(K.MESH_COLOR0);R=Y?Y._offset/4:-1;var j=I.getVertexElementByUsage(K.MESH_TEXTURECOORDINATE0);A=j?j._offset/4:-1;H=I.vertexStride/4;W=0}else{this._vertices[y+2]=b;this._vertices[y+3]=S+E;var M=y+this._floatCountPerVertex;this._vertices[M+2]=b+T;this._vertices[M+3]=S+E;var D=M+this._floatCountPerVertex;this._vertices[D+2]=b+T;this._vertices[D+3]=S;var q=D+this._floatCountPerVertex;this._vertices[q+2]=b;this._vertices[q+3]=S}for(var w=y,Z=y+this._floatCountPerVertex*this._vertexStride;w<Z;w+=this._floatCountPerVertex){var P;if(L.renderMode===4){P=w;var O=H*W++;var N=O+z;this._vertices[P++]=C[N++];this._vertices[P++]=C[N++];this._vertices[P++]=C[N];if(R===-1){this._vertices[P++]=1;this._vertices[P++]=1;this._vertices[P++]=1;this._vertices[P++]=1}else{N=O+R;this._vertices[P++]=C[N++];this._vertices[P++]=C[N++];this._vertices[P++]=C[N++];this._vertices[P++]=C[N]}if(A===-1){this._vertices[P++]=0;this._vertices[P++]=0}else{N=O+A;this._vertices[P++]=b+C[N++]*T;this._vertices[P++]=S+C[N]*E}}else{P=w+4}this._vertices[P++]=t.x;this._vertices[P++]=t.y;this._vertices[P++]=t.z;this._vertices[P++]=Q.startLifeTime;this._vertices[P++]=e.x;this._vertices[P++]=e.y;this._vertices[P++]=e.z;this._vertices[P++]=a;this._vertices[P++]=Q.startColor.x;this._vertices[P++]=Q.startColor.y;this._vertices[P++]=Q.startColor.z;this._vertices[P++]=Q.startColor.w;this._vertices[P++]=Q.startSize[0];this._vertices[P++]=Q.startSize[1];this._vertices[P++]=Q.startSize[2];this._vertices[P++]=Q.startRotation[0];this._vertices[P++]=Q.startRotation[1];this._vertices[P++]=Q.startRotation[2];this._vertices[P++]=o;p&&(this._vertices[P+1]=x);m&&(this._vertices[P+2]=c);g&&(this._vertices[P+3]=d);v&&(this._vertices[P+4]=u);if(f){this._vertices[P+5]=l;this._vertices[P+6]=_;this._vertices[P+7]=h}switch(this.simulationSpace){case 0:P+=8;this._vertices[P++]=s.x;this._vertices[P++]=s.y;this._vertices[P++]=s.z;this._vertices[P++]=n.x;this._vertices[P++]=n.y;this._vertices[P++]=n.z;this._vertices[P++]=n.w;break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}this._firstFreeElement=i;return true}addNewParticlesToVertexBuffer(){var t;var e=this._vertexStride*this._floatCountPerVertex*4;if(this._firstNewElement<this._firstFreeElement){t=this._firstNewElement*e;this._vertexBuffer.setData(this._vertices.buffer,t,t,(this._firstFreeElement-this._firstNewElement)*e)}else{t=this._firstNewElement*e;this._vertexBuffer.setData(this._vertices.buffer,t,t,(this._bufferMaxParticles-this._firstNewElement)*e);if(this._firstFreeElement>0){this._vertexBuffer.setData(this._vertices.buffer,0,0,this._firstFreeElement*e)}}this._firstNewElement=this._firstFreeElement}_getType(){return ti._type}_prepareRender(t){if(this._updateMask!=Et.Stat.loopCount){this._updateMask=Et.Stat.loopCount;this._updateEmission();if(this._firstNewElement!=this._firstFreeElement)this.addNewParticlesToVertexBuffer();this._drawCounter++}if(this._firstActiveElement!=this._firstFreeElement)return true;else return false}_render(t){this._bufferState.bind();var e;var a=Et.LayaGL.instance;if(this._firstActiveElement<this._firstFreeElement){e=(this._firstFreeElement-this._firstActiveElement)*this._indexStride;a.drawElements(a.TRIANGLES,e,a.UNSIGNED_SHORT,2*this._firstActiveElement*this._indexStride);Et.Stat.trianglesFaces+=e/3;Et.Stat.renderBatches++}else{e=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride;a.drawElements(a.TRIANGLES,e,a.UNSIGNED_SHORT,2*this._firstActiveElement*this._indexStride);Et.Stat.trianglesFaces+=e/3;Et.Stat.renderBatches++;if(this._firstFreeElement>0){e=this._firstFreeElement*this._indexStride;a.drawElements(a.TRIANGLES,e,a.UNSIGNED_SHORT,0);Et.Stat.trianglesFaces+=e/3;Et.Stat.renderBatches++}}}play(){this._burstsIndex=0;this._isEmitting=true;this._isPlaying=true;this._isPaused=false;this._emissionTime=0;this._totalDelayTime=0;if(!this.autoRandomSeed){for(var t=0,e=this._randomSeeds.length;t<e;t++)this._randomSeeds[t]=this.randomSeed[0]+ti._RANDOMOFFSET[t]}switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:if(this.autoRandomSeed){this._playStartDelay=Et.MathUtil.lerp(this.startDelayMin,this.startDelayMax,Math.random())}else{this._rand.seed=this._randomSeeds[2];this._playStartDelay=Et.MathUtil.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat());this._randomSeeds[2]=this._rand.seed}break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay;this._startUpdateLoopCount=Et.Stat.loopCount}pause(){this._isPaused=true}simulate(t,e=true){this._simulateUpdate=true;if(e){this._updateParticlesSimulationRestart(t)}else{this._isPaused=false;this._updateParticles(t)}this.pause()}stop(){this._burstsIndex=0;this._isEmitting=false;this._emissionTime=0}cloneTo(t){var e=t;e._useCustomBounds=this._useCustomBounds;this._customBounds&&this._customBounds.cloneTo(e._customBounds);e.duration=this.duration;e.looping=this.looping;e.prewarm=this.prewarm;e.startDelayType=this.startDelayType;e.startDelay=this.startDelay;e.startDelayMin=this.startDelayMin;e.startDelayMax=this.startDelayMax;e._maxStartLifetime=this._maxStartLifetime;e.startLifetimeType=this.startLifetimeType;e.startLifetimeConstant=this.startLifetimeConstant;this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient);e.startLifetimeConstantMin=this.startLifetimeConstantMin;e.startLifetimeConstantMax=this.startLifetimeConstantMax;this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin);this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax);e.startSpeedType=this.startSpeedType;e.startSpeedConstant=this.startSpeedConstant;e.startSpeedConstantMin=this.startSpeedConstantMin;e.startSpeedConstantMax=this.startSpeedConstantMax;e.threeDStartSize=this.threeDStartSize;e.startSizeType=this.startSizeType;e.startSizeConstant=this.startSizeConstant;this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate);e.startSizeConstantMin=this.startSizeConstantMin;e.startSizeConstantMax=this.startSizeConstantMax;this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate);this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate);e.threeDStartRotation=this.threeDStartRotation;e.startRotationType=this.startRotationType;e.startRotationConstant=this.startRotationConstant;this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate);e.startRotationConstantMin=this.startRotationConstantMin;e.startRotationConstantMax=this.startRotationConstantMax;this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate);this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate);e.randomizeRotationDirection=this.randomizeRotationDirection;e.startColorType=this.startColorType;this.startColorConstant.cloneTo(e.startColorConstant);this.startColorConstantMin.cloneTo(e.startColorConstantMin);this.startColorConstantMax.cloneTo(e.startColorConstantMax);e.gravityModifier=this.gravityModifier;e.simulationSpace=this.simulationSpace;e.scaleMode=this.scaleMode;e.playOnAwake=this.playOnAwake;e.autoRandomSeed=this.autoRandomSeed;e.randomSeed[0]=this.randomSeed[0];e.maxParticles=this.maxParticles;this._emission&&(e._emission=this._emission.clone());this.shape&&(e.shape=this.shape.clone());this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone());this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone());this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone());this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone());this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone());e.isPerformanceMode=this.isPerformanceMode;e._isEmitting=this._isEmitting;e._isPlaying=this._isPlaying;e._isPaused=this._isPaused;e._playStartDelay=this._playStartDelay;e._frameRateTime=this._frameRateTime;e._emissionTime=this._emissionTime;e._totalDelayTime=this._totalDelayTime;e._burstsIndex=this._burstsIndex}clone(){var t=new ti(null);this.cloneTo(t);return t}}ti._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447]);ti.halfKSqrtOf2=1.42*.5;ti.g=9.8;ti._maxElapsedTime=1/3;ti._tempVector30=new St;ti._tempVector31=new St;ti._tempVector32=new St;ti._tempVector33=new St;ti._tempVector34=new St;ti._tempVector35=new St;ti._tempVector36=new St;ti._tempVector37=new St;ti._tempVector38=new St;ti._tempVector39=new St;ti._tempPosition=new St;ti._tempDirection=new St;ti._type=Fe._typeCounter++;class ei extends ke{constructor(){super(null);this._render=new Za(this);this._particleSystem=new ti(this);var t=this._render._renderElements;var e=t[0]=new ie;e.setTransform(this._transform);e.render=this._render;e.setGeometry(this._particleSystem);e.material=m.defaultMaterial}static __init__(){f.SHADERDEFINE_RENDERMODE_BILLBOARD=P.getDefineByName("SPHERHBILLBOARD");f.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=P.getDefineByName("STRETCHEDBILLBOARD");f.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=P.getDefineByName("HORIZONTALBILLBOARD");f.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=P.getDefineByName("VERTICALBILLBOARD");f.SHADERDEFINE_COLOROVERLIFETIME=P.getDefineByName("COLOROVERLIFETIME");f.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=P.getDefineByName("RANDOMCOLOROVERLIFETIME");f.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=P.getDefineByName("VELOCITYOVERLIFETIMECONSTANT");f.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=P.getDefineByName("VELOCITYOVERLIFETIMECURVE");f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=P.getDefineByName("VELOCITYOVERLIFETIMERANDOMCONSTANT");f.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=P.getDefineByName("VELOCITYOVERLIFETIMERANDOMCURVE");f.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=P.getDefineByName("TEXTURESHEETANIMATIONCURVE");f.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=P.getDefineByName("TEXTURESHEETANIMATIONRANDOMCURVE");f.SHADERDEFINE_ROTATIONOVERLIFETIME=P.getDefineByName("ROTATIONOVERLIFETIME");f.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=P.getDefineByName("ROTATIONOVERLIFETIMESEPERATE");f.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=P.getDefineByName("ROTATIONOVERLIFETIMECONSTANT");f.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=P.getDefineByName("ROTATIONOVERLIFETIMECURVE");f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=P.getDefineByName("ROTATIONOVERLIFETIMERANDOMCONSTANTS");f.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=P.getDefineByName("ROTATIONOVERLIFETIMERANDOMCURVES");f.SHADERDEFINE_SIZEOVERLIFETIMECURVE=P.getDefineByName("SIZEOVERLIFETIMECURVE");f.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=P.getDefineByName("SIZEOVERLIFETIMECURVESEPERATE");f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=P.getDefineByName("SIZEOVERLIFETIMERANDOMCURVES");f.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=P.getDefineByName("SIZEOVERLIFETIMERANDOMCURVESSEPERATE");f.SHADERDEFINE_RENDERMODE_MESH=P.getDefineByName("RENDERMODE_MESH");f.SHADERDEFINE_SHAPE=P.getDefineByName("SHAPE")}get particleSystem(){return this._particleSystem}get particleRenderer(){return this._render}_parseModule(t,e){for(var a in e){switch(a){case"bases":var i=e.bases;for(var r in i)t[r]=i[r];break;case"vector2s":var s=e.vector2s;for(var r in s){var n=t[r];var o=s[r];n.setValue(o[0],o[1]);t[r]=n}break;case"vector3s":var l=e.vector3s;for(var r in l){var _=t[r];var h=l[r];_.setValue(h[0],h[1],h[2]);t[r]=_}break;case"vector4s":var x=e.vector4s;for(var r in x){var c=t[r];var d=x[r];c.setValue(d[0],d[1],d[2],d[3]);t[r]=c}break;case"gradientDataNumbers":var u=e.gradientDataNumbers;for(var r in u){var f=t[r];var p=e[r];for(var m=0,g=p.length;m<g;m++){var v=p[m];f.add(v.key,v.value)}t[r]=f}break;case"resources":var y=e.resources;for(var r in y)t[r]=Et.Loader.getRes(y[r]);break;case"bursts":var T=e.bursts;for(var m=0,g=T.length;m<g;m++){var E=T[m];t.addBurst(new La(E.time,E.min,E.max))}break;case"randomSeed":t.randomSeed[0]=e.randomSeed;break;case"shapeType":case"type":case"color":case"size":case"frame":case"startFrame":case"angularVelocity":case"velocity":break;default:throw"ShurikenParticle3D:unknown type."}}}_parse(t,B){super._parse(t,B);if(t.main){var e=this.particleSystem;var F=this.particleRenderer;this._parseModule(F,t.renderer);this._parseModule(e,t.main);this._parseModule(e.emission,t.emission);var a=t.shape;if(a){var i;switch(a.shapeType){case 0:i=new Wa;break;case 1:i=new za;break;case 2:i=new Ha;break;case 3:i=new ka;break;case 7:i=new Ga;break;default:throw"ShuriKenParticle3D:unknown shape type."}this._parseModule(i,a);e.shape=i}var r=t.velocityOverLifetime;if(r){var s=r.velocity;var n;switch(s.type){case 0:var o=s.constant;n=Ba.createByConstant(o?new St(o[0],o[1],o[2]):new St(0,0,0));break;case 1:n=Ba.createByGradient(this._initParticleVelocity(s.gradientX),this._initParticleVelocity(s.gradientY),this._initParticleVelocity(s.gradientZ));break;case 2:var l=s.constantMin;var _=s.constantMax;n=Ba.createByRandomTwoConstant(l?new St(l[0],l[1],l[2]):new St(0,0,0),_?new St(_[0],_[1],_[2]):new St(0,0,0));break;case 3:n=Ba.createByRandomTwoGradient(this._initParticleVelocity(s.gradientXMin),this._initParticleVelocity(s.gradientXMax),this._initParticleVelocity(s.gradientYMin),this._initParticleVelocity(s.gradientYMax),this._initParticleVelocity(s.gradientZMin),this._initParticleVelocity(s.gradientZMax));break}var h=new qa(n);this._parseModule(h,r);e.velocityOverLifetime=h}var x=t.colorOverLifetime;if(x){var c=x.color;var d;switch(c.type){case 0:var u=c.constant;d=Ia.createByConstant(u?new bt(u[0],u[1],u[2],u[3]):new bt(0,0,0,0));break;case 1:d=Ia.createByGradient(this._initParticleColor(c.gradient));break;case 2:var f=c.constantMin;var p=c.constantMax;d=Ia.createByRandomTwoConstant(f?new bt(f[0],f[1],f[2],f[3]):new bt(0,0,0,0),f?new bt(p[0],p[1],p[2],p[3]):new bt(0,0,0,0));break;case 3:d=Ia.createByRandomTwoGradient(this._initParticleColor(c.gradientMin),this._initParticleColor(c.gradientMax));break}var m=new Ma(d);this._parseModule(m,x);e.colorOverLifetime=m}var g=t.sizeOverLifetime;if(g){var v=g.size;var y;switch(v.type){case 0:if(v.separateAxes){y=Na.createByGradientSeparate(this._initParticleSize(v.gradientX),this._initParticleSize(v.gradientY),this._initParticleSize(v.gradientZ))}else{y=Na.createByGradient(this._initParticleSize(v.gradient))}break;case 1:if(v.separateAxes){var T=v.constantMinSeparate;var E=v.constantMaxSeparate;y=Na.createByRandomTwoConstantSeparate(T?new St(T[0],T[1],T[2]):new St(0,0,0),E?new St(E[0],E[1],E[2]):new St(0,0,0))}else{y=Na.createByRandomTwoConstant(v.constantMin||0,v.constantMax||0)}break;case 2:if(v.separateAxes){y=Na.createByRandomTwoGradientSeparate(this._initParticleSize(v.gradientXMin),this._initParticleSize(v.gradientYMin),this._initParticleSize(v.gradientZMin),this._initParticleSize(v.gradientXMax),this._initParticleSize(v.gradientYMax),this._initParticleSize(v.gradientZMax))}else{y=Na.createByRandomTwoGradient(this._initParticleSize(v.gradientMin),this._initParticleSize(v.gradientMax))}break}var b=new Xa(y);this._parseModule(b,g);e.sizeOverLifetime=b}var S=t.rotationOverLifetime;if(S){var C=S.angularVelocity;var R;switch(C.type){case 0:if(C.separateAxes){var A=C.constantSeparate;R=wa.createByConstantSeparate(A?new St(A[0],A[1],A[2]):new St(0,0,Math.PI/4))}else{R=wa.createByConstant(C.constant||Math.PI/4)}break;case 1:if(C.separateAxes){R=wa.createByGradientSeparate(this._initParticleRotation(C.gradientX),this._initParticleRotation(C.gradientY),this._initParticleRotation(C.gradientZ))}else{R=wa.createByGradient(this._initParticleRotation(C.gradient))}break;case 2:if(C.separateAxes){var L=C.constantMinSeparate;var I=C.constantMaxSeparate;R=wa.createByRandomTwoConstantSeparate(L?new St(L[0],L[1],L[2]):new St(0,0,0),I?new St(I[0],I[1],I[2]):new St(0,0,Math.PI/4))}else{R=wa.createByRandomTwoConstant(C.constantMin||0,C.constantMax||Math.PI/4)}break;case 3:if(C.separateAxes);else{R=wa.createByRandomTwoGradient(this._initParticleRotation(C.gradientMin),this._initParticleRotation(C.gradientMax))}break}var M=new Fa(R);this._parseModule(M,S);e.rotationOverLifetime=M}var D=t.textureSheetAnimation;if(D){var w=D.frame;var P;switch(w.type){case 0:P=Da.createByConstant(w.constant);break;case 1:P=Da.createByOverTime(this._initParticleFrame(w.overTime));break;case 2:P=Da.createByRandomTwoConstant(w.constantMin,w.constantMax);break;case 3:P=Da.createByRandomTwoOverTime(this._initParticleFrame(w.overTimeMin),this._initParticleFrame(w.overTimeMax));break}var O=D.startFrame;var N;switch(O.type){case 0:N=Ya.createByConstant(O.constant);break;case 1:N=Ya.createByRandomTwoConstant(O.constantMin,O.constantMax);break}var V=new ja(P,N);this._parseModule(V,D);e.textureSheetAnimation=V}}else{this._parseOld(t)}}_activeHierarchy(t){super._activeHierarchy(t);this.particleSystem.playOnAwake&&this.particleSystem.play()}_inActiveHierarchy(t){super._inActiveHierarchy(t);this.particleSystem.isAlive&&this.particleSystem.simulate(0,true)}_cloneTo(t,e,a){var i=t;var r=i._particleSystem;this._particleSystem.cloneTo(r);var s=i._render;var n=this._render;s.sharedMaterials=n.sharedMaterials;s.enable=n.enable;s.renderMode=n.renderMode;s.mesh=n.mesh;s.stretchedBillboardCameraSpeedScale=n.stretchedBillboardCameraSpeedScale;s.stretchedBillboardSpeedScale=n.stretchedBillboardSpeedScale;s.stretchedBillboardLengthScale=n.stretchedBillboardLengthScale;s.sortingFudge=n.sortingFudge;super._cloneTo(t,e,a)}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._particleSystem.destroy();this._particleSystem=null}_create(){return new ei}_parseOld(t){const e=Math.PI/180;var a,B;var i=this.particleRenderer;var F;var V=t.material;V&&(F=Et.Loader.getRes(V.path));i.sharedMaterial=F;var U=t.meshPath;U&&(i.mesh=Et.Loader.getRes(U));i.renderMode=t.renderMode;i.stretchedBillboardCameraSpeedScale=t.stretchedBillboardCameraSpeedScale;i.stretchedBillboardSpeedScale=t.stretchedBillboardSpeedScale;i.stretchedBillboardLengthScale=t.stretchedBillboardLengthScale;i.sortingFudge=t.sortingFudge?t.sortingFudge:0;var r=this.particleSystem;r.isPerformanceMode=t.isPerformanceMode;r.duration=t.duration;r.looping=t.looping;r.prewarm=t.prewarm;r.startDelayType=t.startDelayType;r.startDelay=t.startDelay;r.startDelayMin=t.startDelayMin;r.startDelayMax=t.startDelayMax;r.startLifetimeType=t.startLifetimeType;r.startLifetimeConstant=t.startLifetimeConstant;r.startLifeTimeGradient=ei._initStartLife(t.startLifetimeGradient);r.startLifetimeConstantMin=t.startLifetimeConstantMin;r.startLifetimeConstantMax=t.startLifetimeConstantMax;r.startLifeTimeGradientMin=ei._initStartLife(t.startLifetimeGradientMin);r.startLifeTimeGradientMax=ei._initStartLife(t.startLifetimeGradientMax);r.startSpeedType=t.startSpeedType;r.startSpeedConstant=t.startSpeedConstant;r.startSpeedConstantMin=t.startSpeedConstantMin;r.startSpeedConstantMax=t.startSpeedConstantMax;r.threeDStartSize=t.threeDStartSize;r.startSizeType=t.startSizeType;r.startSizeConstant=t.startSizeConstant;var k=t.startSizeConstantSeparate;var G=r.startSizeConstantSeparate;G.x=k[0];G.y=k[1];G.z=k[2];r.startSizeConstantMin=t.startSizeConstantMin;r.startSizeConstantMax=t.startSizeConstantMax;var H=t.startSizeConstantMinSeparate;var z=r.startSizeConstantMinSeparate;z.x=H[0];z.y=H[1];z.z=H[2];var W=t.startSizeConstantMaxSeparate;var X=r.startSizeConstantMaxSeparate;X.x=W[0];X.y=W[1];X.z=W[2];r.threeDStartRotation=t.threeDStartRotation;r.startRotationType=t.startRotationType;r.startRotationConstant=t.startRotationConstant*e;var Y=t.startRotationConstantSeparate;var j=r.startRotationConstantSeparate;j.x=Y[0]*e;j.y=Y[1]*e;j.z=Y[2]*e;r.startRotationConstantMin=t.startRotationConstantMin*e;r.startRotationConstantMax=t.startRotationConstantMax*e;var q=t.startRotationConstantMinSeparate;var Z=r.startRotationConstantMinSeparate;Z.x=q[0]*e;Z.y=q[1]*e;Z.z=q[2]*e;var K=t.startRotationConstantMaxSeparate;var Q=r.startRotationConstantMaxSeparate;Q.x=K[0]*e;Q.y=K[1]*e;Q.z=K[2]*e;r.randomizeRotationDirection=t.randomizeRotationDirection;r.startColorType=t.startColorType;var s=t.startColorConstant;var n=r.startColorConstant;n.x=s[0];n.y=s[1];n.z=s[2];n.w=s[3];var o=t.startColorConstantMin;var l=r.startColorConstantMin;l.x=o[0];l.y=o[1];l.z=o[2];l.w=o[3];var _=t.startColorConstantMax;var h=r.startColorConstantMax;h.x=_[0];h.y=_[1];h.z=_[2];h.w=_[3];r.gravityModifier=t.gravityModifier;r.simulationSpace=t.simulationSpace;t.simulationSpeed!==undefined&&(r.simulationSpeed=t.simulationSpeed);r.scaleMode=t.scaleMode;r.playOnAwake=t.playOnAwake;r.maxParticles=t.maxParticles;var J=t.autoRandomSeed;J!=null&&(r.autoRandomSeed=J);var $=t.randomSeed;$!=null&&(r.randomSeed[0]=$);var x=t.emission;var c=r.emission;if(x){c.emissionRate=x.emissionRate;var tt=x.bursts;if(tt)for(a=0,B=tt.length;a<B;a++){var et=tt[a];c.addBurst(new La(et.time,et.min,et.max))}c.enable=x.enable}else{c.enable=false}var d=t.shape;if(d){var u;switch(d.shapeType){case 0:var f;u=f=new Wa;f.radius=d.sphereRadius;f.emitFromShell=d.sphereEmitFromShell;f.randomDirection=d.sphereRandomDirection;break;case 1:var p;u=p=new za;p.radius=d.hemiSphereRadius;p.emitFromShell=d.hemiSphereEmitFromShell;p.randomDirection=d.hemiSphereRandomDirection;break;case 2:var m;u=m=new Ha;m.angle=d.coneAngle*e;m.radius=d.coneRadius;m.length=d.coneLength;m.emitType=d.coneEmitType;m.randomDirection=d.coneRandomDirection;break;case 3:var g;u=g=new ka;g.x=d.boxX;g.y=d.boxY;g.z=d.boxZ;g.randomDirection=d.boxRandomDirection;break;case 7:var v;u=v=new Ga;v.radius=d.circleRadius;v.arc=d.circleArc*e;v.emitFromEdge=d.circleEmitFromEdge;v.randomDirection=d.circleRandomDirection;break;default:var y;u=y=new Ga;y.radius=d.circleRadius;y.arc=d.circleArc*e;y.emitFromEdge=d.circleEmitFromEdge;y.randomDirection=d.circleRandomDirection;break}u.enable=d.enable;r.shape=u}var T=t.velocityOverLifetime;if(T){var E=T.velocity;var b;switch(E.type){case 0:var at=E.constant;b=Ba.createByConstant(new St(at[0],at[1],at[2]));break;case 1:b=Ba.createByGradient(this._initParticleVelocity(E.gradientX),this._initParticleVelocity(E.gradientY),this._initParticleVelocity(E.gradientZ));break;case 2:var it=E.constantMin;var rt=E.constantMax;b=Ba.createByRandomTwoConstant(new St(it[0],it[1],it[2]),new St(rt[0],rt[1],rt[2]));break;case 3:b=Ba.createByRandomTwoGradient(this._initParticleVelocity(E.gradientXMin),this._initParticleVelocity(E.gradientXMax),this._initParticleVelocity(E.gradientYMin),this._initParticleVelocity(E.gradientYMax),this._initParticleVelocity(E.gradientZMin),this._initParticleVelocity(E.gradientZMax));break}var st=new qa(b);st.space=T.space;st.enable=T.enable;r.velocityOverLifetime=st}var nt=t.colorOverLifetime;if(nt){var S=nt.color;var C;switch(S.type){case 0:var R=S.constant;C=Ia.createByConstant(new bt(R[0],R[1],R[2],R[3]));break;case 1:C=Ia.createByGradient(this._initParticleColor(S.gradient));break;case 2:var A=S.constantMin;var ot=S.constantMax;C=Ia.createByRandomTwoConstant(new bt(A[0],A[1],A[2],A[3]),new bt(ot[0],ot[1],ot[2],ot[3]));break;case 3:C=Ia.createByRandomTwoGradient(this._initParticleColor(S.gradientMin),this._initParticleColor(S.gradientMax));break}var lt=new Ma(C);lt.enable=nt.enable;r.colorOverLifetime=lt}var _t=t.sizeOverLifetime;if(_t){var L=_t.size;var I;switch(L.type){case 0:if(L.separateAxes){I=Na.createByGradientSeparate(this._initParticleSize(L.gradientX),this._initParticleSize(L.gradientY),this._initParticleSize(L.gradientZ))}else{I=Na.createByGradient(this._initParticleSize(L.gradient))}break;case 1:if(L.separateAxes){var ht=L.constantMinSeparate;var xt=L.constantMaxSeparate;I=Na.createByRandomTwoConstantSeparate(new St(ht[0],ht[1],ht[2]),new St(xt[0],xt[1],xt[2]))}else{I=Na.createByRandomTwoConstant(L.constantMin,L.constantMax)}break;case 2:if(L.separateAxes){I=Na.createByRandomTwoGradientSeparate(this._initParticleSize(L.gradientXMin),this._initParticleSize(L.gradientYMin),this._initParticleSize(L.gradientZMin),this._initParticleSize(L.gradientXMax),this._initParticleSize(L.gradientYMax),this._initParticleSize(L.gradientZMax))}else{I=Na.createByRandomTwoGradient(this._initParticleSize(L.gradientMin),this._initParticleSize(L.gradientMax))}break}var ct=new Xa(I);ct.enable=_t.enable;r.sizeOverLifetime=ct}var dt=t.rotationOverLifetime;if(dt){var M=dt.angularVelocity;var D;switch(M.type){case 0:if(M.separateAxes){var ut=M.constantSeparate;D=wa.createByConstantSeparate(new St(ut[0]*e,ut[1]*e,ut[2]*e))}else{D=wa.createByConstant(M.constant*e)}break;case 1:if(M.separateAxes){D=wa.createByGradientSeparate(this._initParticleRotation(M.gradientX),this._initParticleRotation(M.gradientY),this._initParticleRotation(M.gradientZ))}else{D=wa.createByGradient(this._initParticleRotation(M.gradient))}break;case 2:if(M.separateAxes){var ft=M.constantMinSeparate;var pt=M.constantMaxSeparate;D=wa.createByRandomTwoConstantSeparate(new St(ft[0]*e,ft[1]*e,ft[2]*e),new St(pt[0]*e,pt[1]*e,pt[2]*e))}else{D=wa.createByRandomTwoConstant(M.constantMin*e,M.constantMax*e)}break;case 3:if(M.separateAxes);else{D=wa.createByRandomTwoGradient(this._initParticleRotation(M.gradientMin),this._initParticleRotation(M.gradientMax))}break}var mt=new Fa(D);mt.enable=dt.enable;r.rotationOverLifetime=mt}var w=t.textureSheetAnimation;if(w){var P=w.frame;var O;switch(P.type){case 0:O=Da.createByConstant(P.constant);break;case 1:O=Da.createByOverTime(this._initParticleFrame(P.overTime));break;case 2:O=Da.createByRandomTwoConstant(P.constantMin,P.constantMax);break;case 3:O=Da.createByRandomTwoOverTime(this._initParticleFrame(P.overTimeMin),this._initParticleFrame(P.overTimeMax));break}var gt=w.startFrame;var vt;switch(gt.type){case 0:vt=Ya.createByConstant(gt.constant);break;case 1:vt=Ya.createByRandomTwoConstant(gt.constantMin,gt.constantMax);break}var N=new ja(O,vt);N.enable=w.enable;var yt=w.tiles;N.tiles=new Ct(yt[0],yt[1]);N.type=w.type;N.randomRow=w.randomRow;var Tt=w.rowIndex;Tt!==undefined&&(N.rowIndex=Tt);N.cycles=w.cycles;r.textureSheetAnimation=N}}_initParticleColor(t){var e=new Aa(4,4);if(!t){e.addColorAlpha(0,1);e.addColorAlpha(1,1);e.addColorRGB(0,new ye(1,1,1,1));e.addColorRGB(1,new ye(1,1,1,1))}else{var a=t.alphas;var i,r;if(!a){e.addColorAlpha(0,1);e.addColorAlpha(1,1)}else{for(i=0,r=a.length;i<r;i++){if(i==3&&r>4){i=r-1;console.warn("GradientDataColor warning:alpha data length is large than 4, will ignore the middle data.")}var s=a[i];e.addColorAlpha(s.key,s.value)}}var n=t.rgbs;if(!n){e.addColorRGB(0,new ye(1,1,1,1));e.addColorRGB(1,new ye(1,1,1,1))}else{for(i=0,r=n.length;i<r;i++){if(i==3&&r>4){i=r-1;console.warn("GradientDataColor warning:rgb data length is large than 4, will ignore the middle data.")}var o=n[i];var l=o.value;e.addColorRGB(o.key,new ye(l[0],l[1],l[2],1))}}}return e}_initParticleFrame(t){var e=new Pa;if(t){var a=t.frames;for(var i=0,r=a.length;i<r;i++){var s=a[i];e.add(s.key,s.value)}}else{e.add(0,0);e.add(1,1)}return e}static _initStartLife(t){var e=new Oa;var a=t.startLifetimes;for(var i=0,r=a.length;i<r;i++){var s=a[i];e.add(s.key,s.value)}return e}_initParticleVelocity(t){var e=new Oa;var a=t.velocitys;for(var i=0,r=a.length;i<r;i++){var s=a[i];e.add(s.key,s.value)}return e}_initParticleSize(t){var e=new Oa;if(t){var a=t.sizes;for(var i=0,r=a.length;i<r;i++){var s=a[i];e.add(s.key,s.value)}}else{e.add(0,0);e.add(1,1)}return e}_initParticleRotation(t){var e=new Oa;var a=t.angularVelocitys;for(var i=0,r=a.length;i<r;i++){var s=a[i];e.add(s.key,s.value/180*Math.PI)}return e}}class ai{}class ii extends Ta{constructor(t){super(t);this._bones=[];this._skinnedDataLoopMarks=[];this._localBounds=new Be(St._ZERO,St._ZERO);this._cacheAnimationNode=[]}get localBounds(){return this._localBounds}set localBounds(t){this._localBounds=t}get rootBone(){return this._cacheRootBone}set rootBone(t){if(this._cacheRootBone!=t){if(this._cacheRootBone)this._cacheRootBone.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);else this._owner.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);if(t)t.transform.on(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);else this._owner.transform.on(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);this._cacheRootBone=t;this._onWorldMatNeedChange(d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDSCALE)}}get bones(){return this._bones}_computeSkinnedData(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&!this._cacheAvatar){var t=this._cacheMesh._inverseBindPoses;var e=this._cacheMesh._skinnedMatrixCaches;for(var a=0,i=this._cacheMesh.subMeshCount;a<i;a++){var r=this._cacheMesh.getSubMesh(a)._boneIndicesList;var s=this._skinnedData[a];for(var n=0,o=r.length;n<o;n++){var l=r[n];this._computeSubSkinnedData(t,l,s[n],e)}}}}_computeSubSkinnedData(t,e,a,i){for(var r=0,s=e.length;r<s;r++){var n=e[r];if(this._skinnedDataLoopMarks[n]===Et.Stat.loopCount){var o=i[n];var l=this._skinnedData[o.subMeshIndex][o.batchIndex];var _=o.batchBoneIndex*16;var h=r*16;for(var x=0;x<16;x++)a[h+x]=l[_+x]}else{if(!this._cacheAvatar){F._mulMatrixArray(this._bones[n].transform.worldMatrix.elements,t[n].elements,0,a,r*16)}else{F._mulMatrixArray(this._cacheAnimationNode[n].transform.getWorldMatrix(),t[n].elements,0,a,r*16)}this._skinnedDataLoopMarks[n]=Et.Stat.loopCount}}}_onWorldMatNeedChange(t){this._boundsChange=true;if(this._octreeNode){if(this._cacheAvatar){if(this._indexInOctreeMotionList===-1)this._octreeNode._octree.addMotionObject(this)}else{t&=d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDSCALE;if(t){if(this._indexInOctreeMotionList===-1)this._octreeNode._octree.addMotionObject(this)}}}}_createRenderElement(){return new ie}_onMeshChange(t){super._onMeshChange(t);this._cacheMesh=t;var e=t.subMeshCount;this._skinnedData=[];this._skinnedDataLoopMarks.length=t._inverseBindPoses.length;for(var a=0;a<e;a++){var i=t.getSubMesh(a)._boneIndicesList;var r=i.length;var s=this._skinnedData[a]=[];for(var n=0;n<r;n++)s[n]=new Float32Array(i[n].length*16)}this._cacheAvatar&&t&&this._getCacheAnimationNodes()}_setCacheAnimator(t){this._cacheAnimator=t;this._shaderValues.addDefine(ai.SHADERDEFINE_BONE);this._setRootNode()}_calculateBoundingBox(){if(!this._cacheAvatar){if(this._cacheRootBone)this._localBounds._tranform(this._cacheRootBone.transform.worldMatrix,this._bounds);else this._localBounds._tranform(this._owner.transform.worldMatrix,this._bounds)}else{if(this._cacheAnimator&&this._rootBone){var t=ii._tempMatrix4x4;F.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheRootAnimationNode.transform.getWorldMatrix(),t);this._localBounds._tranform(t,this._bounds)}else{super._calculateBoundingBox()}}}_renderUpdate(t,e){if(this._cacheAnimator){this._computeSkinnedData();if(!this._cacheAvatar){this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,k.DEFAULT)}else{var a=this._cacheAnimator.owner._transform;this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,a.worldMatrix)}}else{this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,e.worldMatrix)}if(!this._probReflection)return;if(this._reflectionMode==H.ReflectionProbeMode.off){this._shaderValues.removeDefine(ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);this._shaderValues.setVector(ke.REFLECTIONCUBE_HDR_PARAMS,je.defaultTextureHDRDecodeValues);this._shaderValues.setTexture(ke.REFLECTIONTEXTURE,De.blackTexture)}else{if(!this._probReflection.boxProjection){this._shaderValues.removeDefine(ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION)}else{this._shaderValues.addDefine(ya.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);this._shaderValues.setVector3(ke.REFLECTIONCUBE_PROBEPOSITION,this._probReflection.probePosition);this._shaderValues.setVector3(ke.REFLECTIONCUBE_PROBEBOXMAX,this._probReflection.boundsMax);this._shaderValues.setVector3(ke.REFLECTIONCUBE_PROBEBOXMIN,this._probReflection.boundsMin)}this._shaderValues.setTexture(ke.REFLECTIONTEXTURE,this._probReflection.reflectionTexture);this._shaderValues.setVector(ke.REFLECTIONCUBE_HDR_PARAMS,this._probReflection.reflectionHDRParams)}}_renderUpdateWithCamera(t,e){var a=t.projectionViewMatrix;if(this._cacheAnimator){if(!this._cacheAvatar){this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,a)}else{var i=this._cacheAnimator.owner._transform;k.multiply(a,i.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}}else{k.multiply(a,e.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}}_destroy(){super._destroy();if(!this._cacheAvatar){if(this._cacheRootBone)!this._cacheRootBone.destroyed&&this._cacheRootBone.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);else this._owner&&!this._owner.destroyed&&this._owner.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange)}else{if(this._cacheRootAnimationNode)this._cacheRootAnimationNode.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange)}}get bounds(){if(this._boundsChange||this._cacheAvatar){this._calculateBoundingBox();this._boundsChange=false}return this._bounds}_setRootBone(t){this._rootBone=t;this._setRootNode()}_setRootNode(){var t;if(this._cacheAnimator&&this._rootBone&&this._cacheAvatar)t=this._cacheAnimator._avatarNodeMap[this._rootBone];else t=null;if(this._cacheRootAnimationNode!=t){this._onWorldMatNeedChange(d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDSCALE);this._owner.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);if(this._cacheRootAnimationNode)this._cacheRootAnimationNode.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);t&&t.transform.on(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);this._cacheRootAnimationNode=t}}_getCacheAnimationNodes(){var t=this._cacheMesh._boneNames;var e=this._cacheMesh._inverseBindPoses.length;this._cacheAnimationNode.length=e;var a=this._cacheAnimator._avatarNodeMap;for(var i=0;i<e;i++){var r=a[t[i]];this._cacheAnimationNode[i]=r}}_setCacheAvatar(t){if(this._cacheAvatar!==t){if(this._cacheMesh){this._cacheAvatar=t;if(t){this._shaderValues.addDefine(ai.SHADERDEFINE_BONE);this._getCacheAnimationNodes()}}else{this._cacheAvatar=t}this._setRootNode()}}_computeSubSkinnedDataNative(t,e,a,i,r){Et.LayaGL.instance.computeSubSkinnedData(t,e,a,i,r)}_computeSkinnedDataForNative(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&!this._cacheAvatar){var t=this._cacheMesh._inverseBindPoses;var e=this._cacheMesh._skinnedMatrixCaches;for(var a=0,i=this._cacheMesh.subMeshCount;a<i;a++){var r=this._cacheMesh.getSubMesh(a)._boneIndicesList;var s=this._skinnedData[a];for(var n=0,o=r.length;n<o;n++){var l=r[n];this._computeSubSkinnedData(t,l,s[n],e)}}}}}ii._tempMatrix4x4=new k;class ri extends ke{constructor(t=null,e=null){super(e);this._meshFilter=new Ea(this);this._render=new ii(this);t&&(this._meshFilter.sharedMesh=t)}static __init__(){ai.SHADERDEFINE_BONE=P.getDefineByName("BONE");ai.SHADERDEFINE_SIMPLEBONE=P.getDefineByName("SIMPLEBONE")}get meshFilter(){return this._meshFilter}get skinnedMeshRenderer(){return this._render}_parse(t,e){super._parse(t,e);var a=this.skinnedMeshRenderer;var i=t.lightmapIndex;i!=null&&(a.lightmapIndex=i);var r=t.lightmapScaleOffset;r&&(a.lightmapScaleOffset=new bt(r[0],r[1],r[2],r[3]));t.enableRender!=undefined&&(a.enable=t.enableRender);t.receiveShadows!=undefined&&(a.receiveShadow=t.receiveShadows);t.castShadow!=undefined&&(a.castShadow=t.castShadow);var s;s=t.meshPath;if(s){var n=Et.Loader.getRes(s);n&&(this.meshFilter.sharedMesh=n)}var o=t.materials;if(o){var l=a.sharedMaterials;var _=o.length;l.length=_;for(var h=0;h<_;h++){l[h]=Et.Loader.getRes(o[h].path)}a.sharedMaterials=l}var x=t.boundBox;var c=x.min;var d=x.max;a.localBounds.setMin(new St(c[0],c[1],c[2]));a.localBounds.setMax(new St(d[0],d[1],d[2]));if(e){var u=t.rootBone;a.rootBone=e[u];var f=t.bones;var p;for(h=0,p=f.length;h<p;h++)a.bones.push(e[f[h]])}else{t.rootBone&&a._setRootBone(t.rootBone)}}_changeHierarchyAnimator(t){super._changeHierarchyAnimator(t);this.skinnedMeshRenderer._setCacheAnimator(t)}_changeAnimatorAvatar(t){this.skinnedMeshRenderer._setCacheAvatar(t)}_cloneTo(t,e,a){var i=t;i.meshFilter.sharedMesh=this.meshFilter.sharedMesh;var r=this._render;var s=i._render;s.enable=r.enable;s.sharedMaterials=r.sharedMaterials;s.castShadow=r.castShadow;var n=r.lightmapScaleOffset;n&&(s.lightmapScaleOffset=n.clone());s.receiveShadow=r.receiveShadow;s.sortingFudge=r.sortingFudge;s._rootBone=r._rootBone;var o=r.bones;var l=s.bones;var _=o.length;l.length=_;var h=r.rootBone;if(h){var x=F._getHierarchyPath(e,h,ri._tempArray0);if(x)s.rootBone=F._getNodeByHierarchyPath(a,x);else s.rootBone=h}for(var c=0;c<o.length;c++){x=F._getHierarchyPath(e,o[c],ri._tempArray0);if(x)l[c]=F._getNodeByHierarchyPath(a,x);else l[c]=o[c]}var d=r.localBounds;d&&d.cloneTo(s.localBounds);super._cloneTo(t,e,a)}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._meshFilter.destroy()}_create(){return new ri}}ri._tempArray0=[];ri.BONES=P.propertyNameToID("u_Bones");ri.SIMPLE_SIMPLEANIMATORTEXTURE=P.propertyNameToID("u_SimpleAnimatorTexture");ri.SIMPLE_SIMPLEANIMATORPARAMS=P.propertyNameToID("u_SimpleAnimatorParams");ri.SIMPLE_SIMPLEANIMATORTEXTURESIZE=P.propertyNameToID("u_SimpleAnimatorTextureSize");class v extends s{constructor(){super();this.setShaderName("Trail");this._color=new bt(1,1,1,1);this._shaderValues.setVector(v.TINTCOLOR,new bt(1,1,1,1));this.renderMode=v.RENDERMODE_ALPHABLENDED}static __initDefine__(){v.SHADERDEFINE_MAINTEXTURE=P.getDefineByName("MAINTEXTURE");v.SHADERDEFINE_TILINGOFFSET=P.getDefineByName("TILINGOFFSET");v.SHADERDEFINE_ADDTIVEFOG=P.getDefineByName("ADDTIVEFOG")}get _TintColorR(){return this._color.x}set _TintColorR(t){this._color.x=t;this.color=this._color}get _TintColorG(){return this._color.y}set _TintColorG(t){this._color.y=t;this.color=this._color}get _TintColorB(){return this._color.z}set _TintColorB(t){this._color.z=t;this.color=this._color}get _TintColorA(){return this._color.w}set _TintColorA(t){this._color.w=t;this.color=this._color}get _MainTex_STX(){return this._shaderValues.getVector(v.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(v.TILINGOFFSET);e.x=t;this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(v.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(v.TILINGOFFSET);e.y=t;this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(v.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(v.TILINGOFFSET);e.z=t;this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(v.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(v.TILINGOFFSET);e.w=t;this.tilingOffset=e}set renderMode(t){switch(t){case v.RENDERMODE_ADDTIVE:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_NONE;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.addDefine(v.SHADERDEFINE_ADDTIVEFOG);break;case v.RENDERMODE_ALPHABLENDED:this.renderQueue=s.RENDERQUEUE_TRANSPARENT;this.alphaTest=false;this.depthWrite=false;this.cull=p.CULL_NONE;this.blend=p.BLEND_ENABLE_ALL;this.blendSrc=p.BLENDPARAM_SRC_ALPHA;this.blendDst=p.BLENDPARAM_ONE_MINUS_SRC_ALPHA;this.depthTest=p.DEPTHTEST_LESS;this._shaderValues.removeDefine(v.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("TrailMaterial : renderMode value error.")}}get colorR(){return this._TintColorR}set colorR(t){this._TintColorR=t}get colorG(){return this._TintColorG}set colorG(t){this._TintColorG=t}get colorB(){return this._TintColorB}set colorB(t){this._TintColorB=t}get colorA(){return this._TintColorA}set colorA(t){this._TintColorA=t}get color(){return this._shaderValues.getVector(v.TINTCOLOR)}set color(t){this._shaderValues.setVector(v.TINTCOLOR,t)}get texture(){return this._shaderValues.getTexture(v.MAINTEXTURE)}set texture(t){if(t)this._shaderValues.addDefine(v.SHADERDEFINE_MAINTEXTURE);else this._shaderValues.removeDefine(v.SHADERDEFINE_MAINTEXTURE);this._shaderValues.setTexture(v.MAINTEXTURE,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(v.TILINGOFFSET)}set tilingOffset(t){if(t){if(t.x!=1||t.y!=1||t.z!=0||t.w!=0)this._shaderValues.addDefine(v.SHADERDEFINE_TILINGOFFSET);else this._shaderValues.removeDefine(v.SHADERDEFINE_TILINGOFFSET)}else{this._shaderValues.removeDefine(v.SHADERDEFINE_TILINGOFFSET)}this._shaderValues.setVector(v.TILINGOFFSET,t)}set depthWrite(t){this._shaderValues.setBool(v.DEPTH_WRITE,t)}get depthWrite(){return this._shaderValues.getBool(v.DEPTH_WRITE)}set cull(t){this._shaderValues.setInt(v.CULL,t)}get cull(){return this._shaderValues.getInt(v.CULL)}set blend(t){this._shaderValues.setInt(v.BLEND,t)}get blend(){return this._shaderValues.getInt(v.BLEND)}set blendSrc(t){this._shaderValues.setInt(v.BLEND_SRC,t)}get blendSrc(){return this._shaderValues.getInt(v.BLEND_SRC)}set blendDst(t){this._shaderValues.setInt(v.BLEND_DST,t)}get blendDst(){return this._shaderValues.getInt(v.BLEND_DST)}set depthTest(t){this._shaderValues.setInt(v.DEPTH_TEST,t)}get depthTest(){return this._shaderValues.getInt(v.DEPTH_TEST)}clone(){var t=new v;this.cloneTo(t);return t}}v.RENDERMODE_ALPHABLENDED=0;v.RENDERMODE_ADDTIVE=1;v.MAINTEXTURE=P.propertyNameToID("u_MainTexture");v.TINTCOLOR=P.propertyNameToID("u_MainColor");v.TILINGOFFSET=P.propertyNameToID("u_TilingOffset");v.CULL=P.propertyNameToID("s_Cull");v.BLEND=P.propertyNameToID("s_Blend");v.BLEND_SRC=P.propertyNameToID("s_BlendSrc");v.BLEND_DST=P.propertyNameToID("s_BlendDst");v.DEPTH_TEST=P.propertyNameToID("s_DepthTest");v.DEPTH_WRITE=P.propertyNameToID("s_DepthWrite");class si{}si.Stretch=0;si.Tile=1;(function(t){t[t["View"]=0]="View";t[t["TransformZ"]=1]="TransformZ"})(H.TrailAlignment||(H.TrailAlignment={}));class ni{static get vertexDeclaration1(){return ni._vertexDeclaration1}static get vertexDeclaration2(){return ni._vertexDeclaration2}get vertexDeclaration(){return ni._vertexDeclaration1}static __init__(){ni._vertexDeclaration1=new Tt(32,[new h(0,_.Vector3,ni.TRAIL_POSITION0),new h(12,_.Vector3,ni.TRAIL_OFFSETVECTOR),new h(24,_.Single,ni.TRAIL_TIME0),new h(28,_.Single,ni.TRAIL_TEXTURECOORDINATE0Y)]);ni._vertexDeclaration2=new Tt(20,[new h(0,_.Single,ni.TRAIL_TEXTURECOORDINATE0X),new h(4,_.Color,ni.TRAIL_COLOR)])}}ni.TRAIL_POSITION0=0;ni.TRAIL_OFFSETVECTOR=1;ni.TRAIL_TIME0=2;ni.TRAIL_TEXTURECOORDINATE0Y=3;ni.TRAIL_TEXTURECOORDINATE0X=4;ni.TRAIL_COLOR=5;class oi extends Fe{constructor(t){super();this._floatCountPerVertices1=8;this._floatCountPerVertices2=5;this._increaseSegementCount=16;this._activeIndex=0;this._endIndex=0;this._needAddFirstVertex=false;this._isTempEndVertex=false;this._vertices1=null;this._vertices2=null;this._lastFixedVertexPosition=new St;this._bufferState=new Rt;this.tmpColor=new ye;this._disappearBoundsMode=false;this._owner=t;this._segementCount=this._increaseSegementCount;this._resizeData(this._segementCount,this._bufferState);var e=this._owner._owner.trailRenderer.bounds;var a=this._owner._owner.transform.position;e.setMin(a);e.setMax(a)}_resizeData(t,e){this._subBirthTime=new Float32Array(t);this._subDistance=new Float64Array(t);var a=Et.LayaGL.instance;var i=t*2;var r=ni.vertexDeclaration1;var s=ni.vertexDeclaration2;var n=[];var o=i*r.vertexStride;var l=i*s.vertexStride;var _=o+l;this._vertices1=new Float32Array(i*this._floatCountPerVertices1);this._vertices2=new Float32Array(i*this._floatCountPerVertices2);this._vertexBuffer1=new vt(o,a.STATIC_DRAW,false);this._vertexBuffer1.vertexDeclaration=r;this._vertexBuffer2=new vt(l,a.DYNAMIC_DRAW,false);this._vertexBuffer2.vertexDeclaration=s;n.push(this._vertexBuffer1);n.push(this._vertexBuffer2);e.bind();e.applyVertexBuffers(n);e.unBind();Et.Resource._addMemory(_,_)}_resetData(){var t=this._endIndex-this._activeIndex;var e=new Float32Array(this._vertices1.buffer,this._floatCountPerVertices1*2*this._activeIndex*4,this._floatCountPerVertices1*2*t);var a=new Float32Array(this._vertices2.buffer,this._floatCountPerVertices2*2*this._activeIndex*4,this._floatCountPerVertices2*2*t);var i=new Float64Array(this._subDistance.buffer,this._activeIndex*8,t);var r=new Float32Array(this._subBirthTime.buffer,this._activeIndex*4,t);if(t===this._segementCount){var s=this._vertexBuffer1._byteLength+this._vertexBuffer2._byteLength;Et.Resource._addMemory(-s,-s);this._vertexBuffer1.destroy();this._vertexBuffer2.destroy();this._segementCount+=this._increaseSegementCount;this._resizeData(this._segementCount,this._bufferState)}this._vertices1.set(e,0);this._vertices2.set(a,0);this._subDistance.set(i,0);this._subBirthTime.set(r,0);this._endIndex=t;this._activeIndex=0;this._vertexBuffer1.setData(this._vertices1.buffer,0,this._floatCountPerVertices1*2*this._activeIndex*4,this._floatCountPerVertices1*2*t*4);this._vertexBuffer2.setData(this._vertices2.buffer,0,this._floatCountPerVertices2*2*this._activeIndex*4,this._floatCountPerVertices2*2*t*4)}_updateTrail(t,e,a){if(!St.equals(e,a)){if(this._endIndex-this._activeIndex===0)this._addTrailByFirstPosition(t,a);else this._addTrailByNextPosition(t,a)}}_addTrailByFirstPosition(t,e){this._endIndex===this._segementCount&&this._resetData();this._subDistance[this._endIndex]=0;this._subBirthTime[this._endIndex]=this._owner._curtime;this._endIndex++;e.cloneTo(this._lastFixedVertexPosition);this._needAddFirstVertex=true}_addTrailByNextPosition(t,e){var a=oi._tempVector30;var i=oi._tempVector31;switch(this._owner.alignment){case H.TrailAlignment.View:var r=t.viewMatrix;St.transformCoordinate(e,r,oi._tempVector33);St.transformCoordinate(this._lastFixedVertexPosition,r,oi._tempVector34);St.subtract(oi._tempVector33,oi._tempVector34,a);St.cross(oi._tempVector33,a,i);break;case H.TrailAlignment.TransformZ:St.subtract(e,this._lastFixedVertexPosition,a);var s=oi._tempVector32;this._owner._owner.transform.getForward(s);St.cross(a,s,i);break}St.normalize(i,i);St.scale(i,this._owner.widthMultiplier/2,i);var n=St.scalarLength(a);var o;var l;if(this._needAddFirstVertex){this._updateVerticesByPositionData(e,i,this._endIndex-1);this._needAddFirstVertex=false}if(n-this._owner.minVertexDistance>=z.zeroTolerance){if(this._isTempEndVertex){o=this._endIndex-1;l=n-this._subDistance[o];this._updateVerticesByPosition(e,i,n,o);this._owner._totalLength+=l}else{this._endIndex===this._segementCount&&this._resetData();this._updateVerticesByPosition(e,i,n,this._endIndex);this._owner._totalLength+=n;this._endIndex++}e.cloneTo(this._lastFixedVertexPosition);this._isTempEndVertex=false}else{if(this._isTempEndVertex){o=this._endIndex-1;l=n-this._subDistance[o];this._updateVerticesByPosition(e,i,n,o);this._owner._totalLength+=l}else{this._endIndex===this._segementCount&&this._resetData();this._updateVerticesByPosition(e,i,n,this._endIndex);this._owner._totalLength+=n;this._endIndex++}this._isTempEndVertex=true}}_updateVerticesByPositionData(t,e,a){var i=this._floatCountPerVertices1*2*a;var r=this._owner._curtime;this._vertices1[i]=t.x;this._vertices1[i+1]=t.y;this._vertices1[i+2]=t.z;this._vertices1[i+3]=-e.x;this._vertices1[i+4]=-e.y;this._vertices1[i+5]=-e.z;this._vertices1[i+6]=r;this._vertices1[i+7]=1;this._vertices1[i+8]=t.x;this._vertices1[i+9]=t.y;this._vertices1[i+10]=t.z;this._vertices1[i+11]=e.x;this._vertices1[i+12]=e.y;this._vertices1[i+13]=e.z;this._vertices1[i+14]=r;this._vertices1[i+15]=0;var s=this._owner._owner.trailRenderer.bounds;var n=s.getMin();var o=s.getMax();var l=oi._tempVector35;var _=oi._tempVector36;var h=oi._tempVector32;St.add(t,e,l);St.subtract(t,e,_);St.min(_,l,h);St.min(n,h,n);s.setMin(n);St.max(l,_,h);St.max(o,h,o);s.setMax(o);var x=this._floatCountPerVertices1*2;this._vertexBuffer1.setData(this._vertices1.buffer,i*4,i*4,x*4)}_updateVerticesByPosition(t,e,a,i){this._updateVerticesByPositionData(t,e,i);this._subDistance[i]=a;this._subBirthTime[i]=this._owner._curtime}_updateVertexBufferUV(){var t;var e,a;if(this._disappearBoundsMode){t=this._owner._owner.trailRenderer.bounds;var i=this._owner._owner.transform.position;t.setMin(i);t.setMax(i);e=t.getMin();a=t.getMax()}var r=this._endIndex;var s=0;var n=this._owner.colorGradient;var o=n.colorAlphaKeysCount-1;var l=n.colorRGBKeysCount-1;var _=this._owner._totalLength;var h=this._floatCountPerVertices2*2;for(var x=this._activeIndex;x<r;x++){x!==this._activeIndex&&(s+=this._subDistance[x]);var c;var d;if(this._owner.textureMode==si.Stretch){c=1-s/_;d=c}else{d=1-s/_;c=1-(_-s)}l=n.evaluateColorRGB(d,this.tmpColor,l,true);o=n.evaluateColorAlpha(d,this.tmpColor,o,true);var u=x*h;this._vertices2[u+0]=c;this._vertices2[u+1]=this.tmpColor.r;this._vertices2[u+2]=this.tmpColor.g;this._vertices2[u+3]=this.tmpColor.b;this._vertices2[u+4]=this.tmpColor.a;this._vertices2[u+5]=c;this._vertices2[u+6]=this.tmpColor.r;this._vertices2[u+7]=this.tmpColor.g;this._vertices2[u+8]=this.tmpColor.b;this._vertices2[u+9]=this.tmpColor.a;if(this._disappearBoundsMode){var f=this._floatCountPerVertices1*2*x;var p=oi._tempVector32;var m=oi._tempVector33;var g=oi._tempVector34;p.setValue(this._vertices1[f+0],this._vertices1[f+1],this._vertices1[f+2]);m.setValue(this._vertices1[f+3],this._vertices1[f+4],this._vertices1[f+5]);St.add(p,m,g);St.min(g,e,e);St.max(g,a,a);St.subtract(p,m,g);St.min(g,e,e);St.max(g,a,a)}}if(this._disappearBoundsMode){t.setMin(e);t.setMax(a);this._disappearBoundsMode=false}var v=this._activeIndex*h;this._vertexBuffer2.setData(this._vertices2.buffer,v*4,v*4,(r*h-v)*4)}_updateDisappear(){var t=this._endIndex;for(var e=this._activeIndex;e<t;e++){if(this._owner._curtime-this._subBirthTime[e]>=this._owner.time+z.zeroTolerance){var a=e+1;if(a!==t)this._owner._totalLength-=this._subDistance[a];if(this._isTempEndVertex&&a===t-1){var i=this._floatCountPerVertices1*e*2;var r=this._lastFixedVertexPosition;r.x=this._vertices1[0];r.y=this._vertices1[1];r.z=this._vertices1[2];this._isTempEndVertex=false}this._activeIndex++;this._disappearBoundsMode=true}else{break}}}_getType(){return oi._type}_prepareRender(t){return this._endIndex-this._activeIndex>1}_render(t){this._bufferState.bind();var e=Et.LayaGL.instance;var a=this._activeIndex*2;var i=this._endIndex*2-a;e.drawArrays(e.TRIANGLE_STRIP,a,i);Et.Stat.renderBatches++;Et.Stat.trianglesFaces+=i-2}destroy(){super.destroy();var t=this._vertexBuffer1._byteLength+this._vertexBuffer2._byteLength;Et.Resource._addMemory(-t,-t);this._bufferState.destroy();this._vertexBuffer1.destroy();this._vertexBuffer2.destroy();this._bufferState=null;this._vertices1=null;this._vertexBuffer1=null;this._vertices2=null;this._vertexBuffer2=null;this._subBirthTime=null;this._subDistance=null;this._lastFixedVertexPosition=null;this._disappearBoundsMode=false}clear(){this._activeIndex=0;this._endIndex=0;this._disappearBoundsMode=false;this._subBirthTime.fill(0);this._subDistance.fill(0);this._segementCount=0;this._isTempEndVertex=false;this._needAddFirstVertex=false;this._lastFixedVertexPosition.setValue(0,0,0)}}oi.ALIGNMENT_VIEW=0;oi.ALIGNMENT_TRANSFORM_Z=1;oi._tempVector30=new St;oi._tempVector31=new St;oi._tempVector32=new St;oi._tempVector33=new St;oi._tempVector34=new St;oi._tempVector35=new St;oi._tempVector36=new St;oi._type=Fe._typeCounter++;class li{constructor(t){this._totalLength=0;this._lastPosition=new St;this._curtime=0;this.alignment=li.ALIGNMENT_VIEW;this._owner=t;this._initDefaultData();this.addRenderElement()}get time(){return this._time}set time(t){this._time=t;this._owner._render._shaderValues.setNumber(li.LIFETIME,t)}get minVertexDistance(){return this._minVertexDistance}set minVertexDistance(t){this._minVertexDistance=t}get widthMultiplier(){return this._widthMultiplier}set widthMultiplier(t){this._widthMultiplier=t}get widthCurve(){return this._widthCurve}set widthCurve(t){this._widthCurve=t;var e=new Float32Array(t.length*4);var a,i,r=0;for(a=0,i=t.length;a<i;a++){e[r++]=t[a].time;e[r++]=t[a].inTangent;e[r++]=t[a].outTangent;e[r++]=t[a].value}this._owner._render._shaderValues.setBuffer(li.WIDTHCURVE,e);this._owner._render._shaderValues.setInt(li.WIDTHCURVEKEYLENGTH,t.length)}get colorGradient(){return this._colorGradient}set colorGradient(t){this._colorGradient=t}get textureMode(){return this._textureMode}set textureMode(t){this._textureMode=t}addRenderElement(){var t=this._owner._render;var e=t._renderElements;var a=t.sharedMaterials[0];a||(a=v.defaultMaterial);var i=new ie;i.setTransform(this._owner._transform);i.render=t;i.material=a;this._trialGeometry=new oi(this);i.setGeometry(this._trialGeometry);e.push(i)}_update(t){var e=this._owner._render;this._curtime+=t.scene.timer._delta/1e3;e._shaderValues.setNumber(li.CURTIME,this._curtime);var a=this._owner.transform.position;var i=e._renderElements[0]._geometry;i._updateDisappear();i._updateTrail(t.camera,this._lastPosition,a);i._updateVertexBufferUV();a.cloneTo(this._lastPosition)}_initDefaultData(){this.time=5;this.minVertexDistance=.1;this.widthMultiplier=1;this.textureMode=si.Stretch;var t=[];var e=new rt;e.time=0;e.inTangent=0;e.outTangent=0;e.value=1;t.push(e);var a=new rt;a.time=1;a.inTangent=0;a.outTangent=0;a.value=1;t.push(a);this.widthCurve=t;var i=new Aa(2,2);i.mode=Ra.Blend;i.addColorRGB(0,ye.WHITE);i.addColorRGB(1,ye.WHITE);i.addColorAlpha(0,1);i.addColorAlpha(1,1);this.colorGradient=i}destroy(){this._trialGeometry.destroy();this._trialGeometry=null;this._widthCurve=null;this._colorGradient=null}clear(){this._trialGeometry.clear();this._lastPosition.setValue(0,0,0);this._curtime=0;this._totalLength=0}}li.CURTIME=P.propertyNameToID("u_CurTime");li.LIFETIME=P.propertyNameToID("u_LifeTime");li.WIDTHCURVE=P.propertyNameToID("u_WidthCurve");li.WIDTHCURVEKEYLENGTH=P.propertyNameToID("u_WidthCurveKeyLength");li.ALIGNMENT_VIEW=0;li.ALIGNMENT_TRANSFORM_Z=1;class _i extends qe{constructor(t){super(t);this._projectionViewWorldMatrix=new k}_calculateBoundingBox(){}_needRender(t,e){this._owner.trailFilter._update(e);if(t)return t.intersects(this.bounds._getBoundBox());else return true}_updateForNative(t){this._owner.trailFilter._update(t)}_renderUpdate(t,e){super._renderUpdate(t,e)}_renderUpdateWithCamera(t,e){var a=t.projectionViewMatrix;if(e){k.multiply(a,e.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}else{this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,a)}}}class hi extends ke{constructor(t=null){super(t);this._render=new _i(this);this._geometryFilter=new li(this)}static __init__(){}get trailFilter(){return this._geometryFilter}get trailRenderer(){return this._render}_parse(t,e){super._parse(t,e);var a=this._render;var i=this._geometryFilter;var r,s;var n=t.materials;if(n){var o=a.sharedMaterials;var l=n.length;o.length=l;for(r=0;r<l;r++)o[r]=Et.Loader.getRes(n[r].path);a.sharedMaterials=o}i.time=t.time;i.minVertexDistance=t.minVertexDistance;i.widthMultiplier=t.widthMultiplier;i.textureMode=t.textureMode;t.alignment!=null&&(i.alignment=t.alignment);var _=[];var h=t.widthCurve;for(r=0,s=h.length;r<s;r++){var x=new rt;x.time=h[r].time;x.inTangent=h[r].inTangent;x.outTangent=h[r].outTangent;x.value=h[r].value;_.push(x)}i.widthCurve=_;var c=t.colorGradient;var d=c.colorKeys;var u=c.alphaKeys;var f=new Aa(d.length,u.length);f.mode=c.mode;for(r=0,s=d.length;r<s;r++){var p=d[r];f.addColorRGB(p.time,new ye(p.value[0],p.value[1],p.value[2],1))}for(r=0,s=u.length;r<s;r++){var m=u[r];f.addColorAlpha(m.time,m.value)}i.colorGradient=f}_onActive(){super._onActive();this._transform.position.cloneTo(this._geometryFilter._lastPosition)}_cloneTo(t,e,a){super._cloneTo(t,e,a);var i,r;var s=t;var n=s.trailFilter;n.time=this.trailFilter.time;n.minVertexDistance=this.trailFilter.minVertexDistance;n.widthMultiplier=this.trailFilter.widthMultiplier;n.textureMode=this.trailFilter.textureMode;n.alignment=this.trailFilter.alignment;var o=this.trailFilter.widthCurve;var l=[];for(i=0,r=o.length;i<r;i++){var _=new rt;o[i].cloneTo(_);l.push(_)}n.widthCurve=l;var h=new Aa(this.trailFilter.colorGradient.maxColorRGBKeysCount,this.trailFilter.colorGradient.maxColorAlphaKeysCount);this.trailFilter.colorGradient.cloneTo(h);n.colorGradient=h;var x=s.trailRenderer;x.sharedMaterial=this.trailRenderer.sharedMaterial}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._geometryFilter.destroy();this._geometryFilter=null}clear(){this._geometryFilter.clear()}_create(){return new hi}}class xi{constructor(t,e,a,i){this._position=t;this._normal=e;this._textureCoord0=a;this._textureCoord1=i}static __init__(){xi._vertexDeclaration=new Tt(40,[new h(0,_.Vector3,xi.TERRAIN_POSITION0),new h(12,_.Vector3,xi.TERRAIN_NORMAL0),new h(24,_.Vector2,xi.TERRAIN_TEXTURECOORDINATE0),new h(32,_.Vector2,xi.TERRAIN_TEXTURECOORDINATE1)])}static get vertexDeclaration(){return xi._vertexDeclaration}get position(){return this._position}get normal(){return this._normal}get textureCoord0(){return this._textureCoord0}get textureCoord1(){return this._textureCoord1}get vertexDeclaration(){return xi._vertexDeclaration}}xi.TERRAIN_POSITION0=0;xi.TERRAIN_NORMAL0=1;xi.TERRAIN_TEXTURECOORDINATE0=2;xi.TERRAIN_TEXTURECOORDINATE1=3;class ci{}ci._interactive={getWorldTransform:(t,e)=>{},setWorldTransform:(t,e)=>{var a=I._physicObjectsMap[t];a._simulation._updatedRigidbodies++;a._updateTransformComponent(e)}};class di extends t{constructor(t=B.COLLISIONFILTERGROUP_DEFAULTFILTER,e=B.COLLISIONFILTERGROUP_ALLFILTER){super(t,e);this._enableProcessCollisions=false}_addToSimulation(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}_removeFromSimulation(){this._simulation._removePhysicsCollider(this)}_parse(t){t.friction!=null&&(this.friction=t.friction);t.rollingFriction!=null&&(this.rollingFriction=t.rollingFriction);t.restitution!=null&&(this.restitution=t.restitution);t.isTrigger!=null&&(this.isTrigger=t.isTrigger);super._parse(t);this._parseShape(t.shapes)}_onAdded(){var t=$._bullet;var e=t.btCollisionObject_create();t.btCollisionObject_setUserIndex(e,this.id);t.btCollisionObject_forceActivationState(e,I.ACTIVATIONSTATE_DISABLE_SIMULATION);var a=t.btCollisionObject_getCollisionFlags(e);if(this.owner.isStatic){if((a&I.COLLISIONFLAGS_KINEMATIC_OBJECT)>0)a=a^I.COLLISIONFLAGS_KINEMATIC_OBJECT;a=a|I.COLLISIONFLAGS_STATIC_OBJECT}else{if((a&I.COLLISIONFLAGS_STATIC_OBJECT)>0)a=a^I.COLLISIONFLAGS_STATIC_OBJECT;a=a|I.COLLISIONFLAGS_KINEMATIC_OBJECT}t.btCollisionObject_setCollisionFlags(e,a);this._btColliderObject=e;super._onAdded()}}class ui extends Fe{constructor(t){super();this._id=++ui._uniqueIDCounter;this._mesh=t;this._boneIndicesList=[];this._subIndexBufferStart=[];this._subIndexBufferCount=[]}get indexCount(){return this._indexCount}_setIndexRange(t,e){this._indexStart=t;this._indexCount=e;this._indices=new Uint16Array(this._indexBuffer.getData().buffer,t*2,e)}_getType(){return ui._type}_prepareRender(t){this._mesh._uploadVerticesData();return true}_render(t){var e=this._mesh;if(e.indexFormat===H.IndexFormat.UInt32&&!Et.LayaGL.layaGPUInstance.supportElementIndexUint32()){console.warn("SubMesh:this device do not support IndexFormat.UInt32.");return}var a=Et.LayaGL.instance;var i=t.renderElement.render._skinnedData;var r;var s;switch(e.indexFormat){case H.IndexFormat.UInt32:r=a.UNSIGNED_INT;s=4;break;case H.IndexFormat.UInt16:r=a.UNSIGNED_SHORT;s=2;break;case H.IndexFormat.UInt8:r=a.UNSIGNED_BYTE;s=1;break}e._bufferState.bind();if(i){var n=i[this._indexInMesh];for(var o=0,l=this._boneIndicesList.length;o<l;o++){t.shader.uploadCustomUniform(ri.BONES,n[o]);a.drawElements(a.TRIANGLES,this._subIndexBufferCount[o],r,this._subIndexBufferStart[o]*s)}}else{a.drawElements(a.TRIANGLES,this._indexCount,r,this._indexStart*s)}Et.Stat.trianglesFaces+=this._indexCount/3;Et.Stat.renderBatches++}getIndices(){if(this._mesh._isReadable)return this._indices.slice();else throw"SubMesh:can't get indices on subMesh,mesh's isReadable must be true."}setIndices(t){this._indexBuffer.setData(t,this._indexStart,0,this._indexCount)}destroy(){if(this._destroyed)return;super.destroy();this._indexBuffer.destroy();this._indexBuffer=null;this._mesh=null;this._boneIndicesList=null;this._subIndexBufferStart=null;this._subIndexBufferCount=null;this._skinAnimationDatas=null}}ui._uniqueIDCounter=0;ui._type=Fe._typeCounter++;class fi{constructor(t,e,a){this.subMeshIndex=t;this.batchIndex=e;this.batchBoneIndex=a}}class pi extends Et.Resource{constructor(t=true){super();this._tempVector30=new St;this._tempVector31=new St;this._tempVector32=new St;this._minVerticesUpdate=-1;this._maxVerticesUpdate=-1;this._needUpdateBounds=true;this._bounds=new Be(new St,new St);this._bufferState=new Rt;this._instanceBufferState=new Rt;this._instanceBufferStateType=0;this._vertexBuffer=null;this._indexBuffer=null;this._skinnedMatrixCaches=[];this._vertexCount=0;this._indexFormat=H.IndexFormat.UInt16;this._isReadable=t;this._subMeshes=[]}static __init__(){var t=$._bullet;if(t){pi._nativeTempVector30=t.btVector3_create(0,0,0);pi._nativeTempVector31=t.btVector3_create(0,0,0);pi._nativeTempVector32=t.btVector3_create(0,0,0)}}static load(t,e){Et.ILaya.loader.create(t,e,null,pi.MESH)}get inverseAbsoluteBindPoses(){return this._inverseBindPoses}get vertexCount(){return this._vertexCount}get indexCount(){return this._indexBuffer.indexCount}get subMeshCount(){return this._subMeshes.length}get bounds(){return this._bounds}set bounds(t){if(this._bounds!==t)t.cloneTo(this._bounds)}get indexFormat(){return this._indexFormat}_getPositionElement(t){var e=t.vertexDeclaration._vertexElements;for(var a=0,i=e.length;a<i;a++){var r=e[a];if(r._elementFormat===_.Vector3&&r._elementUsage===K.MESH_POSITION0)return r}return null}_getVerticeElementData(t,e){t.length=this._vertexCount;var a=this._vertexBuffer.vertexDeclaration;var i=a.getVertexElementByUsage(e);if(i){var r=this._vertexBuffer.getUint8Data();var s=this._vertexBuffer.getFloat32Data();var n=a.vertexStride;var o=n/4;var l=i._offset;var _=l/4;switch(e){case K.MESH_TEXTURECOORDINATE0:case K.MESH_TEXTURECOORDINATE1:for(var h=0;h<this._vertexCount;h++){var x=o*h+_;t[h]=new Ct(s[x],s[x+1])}break;case K.MESH_POSITION0:case K.MESH_NORMAL0:for(var h=0;h<this._vertexCount;h++){var x=o*h+_;t[h]=new St(s[x],s[x+1],s[x+2])}break;case K.MESH_TANGENT0:case K.MESH_BLENDWEIGHT0:for(var h=0;h<this._vertexCount;h++){var x=o*h+_;t[h]=new bt(s[x],s[x+1],s[x+2],s[x+3])}break;case K.MESH_COLOR0:for(var h=0;h<this._vertexCount;h++){var x=o*h+_;t[h]=new ye(s[x],s[x+1],s[x+2],s[x+3])}break;case K.MESH_BLENDINDICES0:for(var h=0;h<this._vertexCount;h++){var x=n*h+l;t[h]=new bt(r[x],r[x+1],r[x+2],r[x+3])}break;default:throw"Mesh:Unknown elementUsage."}}}_setVerticeElementData(t,e){var a=this._vertexBuffer.vertexDeclaration;var i=a.getVertexElementByUsage(e);if(i){var r=this._vertexBuffer.getUint8Data();var s=this._vertexBuffer.getFloat32Data();var n=a.vertexStride;var o=n/4;var l=i._offset;var _=l/4;switch(e){case K.MESH_TEXTURECOORDINATE0:case K.MESH_TEXTURECOORDINATE1:for(var h=0,x=t.length;h<x;h++){var c=o*h+_;var d=t[h];s[c]=d.x;s[c+1]=d.y}break;case K.MESH_POSITION0:case K.MESH_NORMAL0:for(var h=0,x=t.length;h<x;h++){var c=o*h+_;var u=t[h];s[c]=u.x;s[c+1]=u.y;s[c+2]=u.z}break;case K.MESH_TANGENT0:case K.MESH_BLENDWEIGHT0:for(var h=0,x=t.length;h<x;h++){var c=o*h+_;var f=t[h];s[c]=f.x;s[c+1]=f.y;s[c+2]=f.z;s[c+3]=f.w}break;case K.MESH_COLOR0:for(var h=0,x=t.length;h<x;h++){var c=o*h+_;var p=t[h];s[c]=p.r;s[c+1]=p.g;s[c+2]=p.b;s[c+3]=p.a}break;case K.MESH_BLENDINDICES0:for(var h=0,x=t.length;h<x;h++){var c=n*h+l;var f=t[h];r[c]=f.x;r[c+1]=f.y;r[c+2]=f.z;r[c+3]=f.w}break;default:throw"Mesh:Unknown elementUsage."}this._minVerticesUpdate=0;this._maxVerticesUpdate=Number.MAX_SAFE_INTEGER}else{console.warn("Mesh: the mesh don't have  this VertexElement.")}}_disposeResource(){for(var t=0,e=this._subMeshes.length;t<e;t++)this._subMeshes[t].destroy();this._btTriangleMesh&&$._bullet.btStridingMeshInterface_destroy(this._btTriangleMesh);this._vertexBuffer.destroy();this._indexBuffer.destroy();this._bufferState.destroy();this._instanceBufferState.destroy();this._setCPUMemory(0);this._setGPUMemory(0);this._bufferState=null;this._instanceBufferState=null;this._vertexBuffer=null;this._indexBuffer=null;this._subMeshes=null;this._btTriangleMesh=null;this._indexBuffer=null;this._boneNames=null;this._inverseBindPoses=null}_setSubMeshes(t){this._subMeshes=t;for(var e=0,a=t.length;e<a;e++)t[e]._indexInMesh=e}_setBuffer(t,e){var a=this._bufferState;a.bind();a.applyVertexBuffer(t);a.applyIndexBuffer(e);a.unBind()}_setInstanceBuffer(t){var e=this._instanceBufferState;e.bind();e.applyVertexBuffer(this._vertexBuffer);e.applyInstanceVertexBuffer(He.instance.instanceWorldMatrixBuffer);e.applyInstanceVertexBuffer(He.instance.instanceMVPMatrixBuffer);switch(t){case pi.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:e.applyInstanceVertexBuffer(He.instance.instanceSimpleAnimatorBuffer);break}e.applyIndexBuffer(this._indexBuffer);e.unBind()}_getPhysicMesh(){if(!this._btTriangleMesh){var t=$._bullet;var e=t.btTriangleMesh_create();var a=pi._nativeTempVector30;var i=pi._nativeTempVector31;var r=pi._nativeTempVector32;var s=this._tempVector30;var n=this._tempVector31;var o=this._tempVector32;var l=this._vertexBuffer;var _=this._getPositionElement(l);var h=l.getFloat32Data();var x=l.vertexDeclaration.vertexStride/4;var c=_._offset/4;var d=this._indexBuffer.getData();for(var u=0,f=d.length;u<f;u+=3){var p=d[u]*x+c;var m=d[u+1]*x+c;var g=d[u+2]*x+c;s.setValue(h[p],h[p+1],h[p+2]);n.setValue(h[m],h[m+1],h[m+2]);o.setValue(h[g],h[g+1],h[g+2]);F._convertToBulletVec3(s,a,true);F._convertToBulletVec3(n,i,true);F._convertToBulletVec3(o,r,true);t.btTriangleMesh_addTriangle(e,a,i,r,true)}this._btTriangleMesh=e}return this._btTriangleMesh}_uploadVerticesData(){var t=this._minVerticesUpdate;var e=this._maxVerticesUpdate;if(t!==-1&&e!==-1){var a=t;this._vertexBuffer.setData(this._vertexBuffer.getUint8Data().buffer,a,a,e-t);this._minVerticesUpdate=-1;this._maxVerticesUpdate=-1}}getSubMesh(t){return this._subMeshes[t]}getPositions(t){if(this._isReadable)this._getVerticeElementData(t,K.MESH_POSITION0);else throw"Mesh:can't get positions on mesh,isReadable must be true."}setPositions(t){if(this._isReadable){this._setVerticeElementData(t,K.MESH_POSITION0);this._needUpdateBounds=true}else{throw"Mesh:setPosition() need isReadable must be true or use setVertices()."}}getColors(t){if(this._isReadable)this._getVerticeElementData(t,K.MESH_COLOR0);else throw"Mesh:can't get colors on mesh,isReadable must be true."}setColors(t){if(this._isReadable)this._setVerticeElementData(t,K.MESH_COLOR0);else throw"Mesh:setColors() need isReadable must be true or use setVertices()."}getUVs(t,e=0){if(this._isReadable){switch(e){case 0:this._getVerticeElementData(t,K.MESH_TEXTURECOORDINATE0);break;case 1:this._getVerticeElementData(t,K.MESH_TEXTURECOORDINATE1);break;default:throw"Mesh:Invalid channel."}}else{throw"Mesh:can't get uvs on mesh,isReadable must be true."}}setUVs(t,e=0){if(this._isReadable){switch(e){case 0:this._setVerticeElementData(t,K.MESH_TEXTURECOORDINATE0);break;case 1:this._setVerticeElementData(t,K.MESH_TEXTURECOORDINATE1);break;default:throw"Mesh:Invalid channel."}}else{throw"Mesh:setUVs() need isReadable must be true or use setVertices()."}}getNormals(t){if(this._isReadable)this._getVerticeElementData(t,K.MESH_NORMAL0);else throw"Mesh:can't get colors on mesh,isReadable must be true."}setNormals(t){if(this._isReadable)this._setVerticeElementData(t,K.MESH_NORMAL0);else throw"Mesh:setNormals() need must be true or use setVertices()."}getTangents(t){if(this._isReadable)this._getVerticeElementData(t,K.MESH_TANGENT0);else throw"Mesh:can't get colors on mesh,isReadable must be true."}setTangents(t){if(this._isReadable)this._setVerticeElementData(t,K.MESH_TANGENT0);else throw"Mesh:setTangents() need isReadable must be true or use setVertices()."}getBoneWeights(t){if(this._isReadable)this._getVerticeElementData(t,K.MESH_BLENDWEIGHT0);else throw"Mesh:can't get boneWeights on mesh,isReadable must be true."}setBoneWeights(t){if(this._isReadable)this._setVerticeElementData(t,K.MESH_BLENDWEIGHT0);else throw"Mesh:setBoneWeights() need isReadable must be true or use setVertices()."}getBoneIndices(t){if(this._isReadable)this._getVerticeElementData(t,K.MESH_BLENDINDICES0);else throw"Mesh:can't get boneIndices on mesh,isReadable must be true."}setBoneIndices(t){if(this._isReadable)this._setVerticeElementData(t,K.MESH_BLENDINDICES0);else throw"Mesh:setBoneIndices() need isReadable must be true or use setVertices()."}markAsUnreadbale(){this._uploadVerticesData();this._vertexBuffer.markAsUnreadbale();this._isReadable=false}getVertexDeclaration(){return this._vertexBuffer._vertexDeclaration}getVertices(){if(this._isReadable)return this._vertexBuffer.getUint8Data().buffer.slice(0);else throw"Mesh:can't get vertices on mesh,isReadable must be true."}setVertices(t){this._vertexBuffer.setData(t);this._needUpdateBounds=true}getIndices(){if(this._isReadable)return this._indexBuffer.getData().slice();else throw"Mesh:can't get indices on subMesh,mesh's isReadable must be true."}setIndices(t){var e;if(t instanceof Uint32Array)e=H.IndexFormat.UInt32;else if(t instanceof Uint16Array)e=H.IndexFormat.UInt16;else if(t instanceof Uint8Array)e=H.IndexFormat.UInt8;var a=this._indexBuffer;if(this._indexFormat!==e||a.indexCount!==t.length){a.destroy();this._indexBuffer=a=new jt(e,t.length,Et.LayaGL.instance.STATIC_DRAW,this._isReadable)}a.setData(t);this._indexFormat=e}calculateBounds(){if(this._isReadable){if(this._needUpdateBounds){var t=this._tempVector30;var e=this._tempVector31;t.x=t.y=t.z=Number.MAX_VALUE;e.x=e.y=e.z=-Number.MAX_VALUE;var a=this._vertexBuffer;var i=this._getPositionElement(a);var r=a.getFloat32Data();var s=a.vertexDeclaration.vertexStride/4;var n=i._offset/4;for(var o=0,l=r.length;o<l;o+=s){var _=o+n;var h=r[_];var x=r[_+1];var c=r[_+2];t.x=Math.min(t.x,h);t.y=Math.min(t.y,x);t.z=Math.min(t.z,c);e.x=Math.max(e.x,h);e.y=Math.max(e.y,x);e.z=Math.max(e.z,c)}this._bounds.setMin(t);this._bounds.setMax(e);this._needUpdateBounds=false}}else{throw"Mesh:can't calculate bounds on subMesh,mesh's isReadable must be true."}}cloneTo(t){var e=t;var a=this._vertexBuffer;var i=new vt(a._byteLength,a.bufferUsage,a.canRead);i.vertexDeclaration=a.vertexDeclaration;i.setData(a.getUint8Data().slice().buffer);e._vertexBuffer=i;e._vertexCount=this._vertexCount;var r=this._indexBuffer;var s=new jt(H.IndexFormat.UInt16,r.indexCount,r.bufferUsage,r.canRead);s.setData(r.getData().slice());e._indexBuffer=s;e._setBuffer(e._vertexBuffer,s);e._setInstanceBuffer(this._instanceBufferStateType);e._setCPUMemory(this.cpuMemory);e._setGPUMemory(this.gpuMemory);var n;var o=this._boneNames;if(o){var l=e._boneNames=[];for(n=0;n<o.length;n++)l[n]=o[n]}var _=this._inverseBindPoses;if(_){var h=e._inverseBindPoses=[];for(n=0;n<_.length;n++)h[n]=_[n]}var x=this._skinnedMatrixCaches.length;e._skinnedMatrixCaches.length=x;for(n=0;n<x;n++){var c=this._skinnedMatrixCaches[n];e._skinnedMatrixCaches[n]=new fi(c.subMeshIndex,c.batchIndex,c.batchBoneIndex)}for(n=0;n<this.subMeshCount;n++){var d=this._subMeshes[n];var u=d._subIndexBufferStart;var f=d._subIndexBufferCount;var p=d._boneIndicesList;var m=new ui(e);m._subIndexBufferStart.length=u.length;m._subIndexBufferCount.length=f.length;m._boneIndicesList.length=p.length;for(var g=0;g<u.length;g++)m._subIndexBufferStart[g]=u[g];for(g=0;g<f.length;g++)m._subIndexBufferCount[g]=f[g];for(g=0;g<p.length;g++)m._boneIndicesList[g]=new Uint16Array(p[g]);m._indexBuffer=s;m._indexStart=d._indexStart;m._indexCount=d._indexCount;m._indices=new Uint16Array(s.getData().buffer,d._indexStart*2,d._indexCount);var v=e._vertexBuffer;m._vertexBuffer=v;e._subMeshes.push(m)}e._setSubMeshes(e._subMeshes)}clone(){var t=new pi;this.cloneTo(t);return t}}pi.MESH="MESH";pi.MESH_INSTANCEBUFFER_TYPE_NORMAL=0;pi.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR=1;class mi{static __init__(){}static _createMesh(t,e,a){var i=Et.LayaGL.instance;var r=new pi;var s=new ui(r);var n=new vt(e.length*4,i.STATIC_DRAW,true);n.vertexDeclaration=t;n.setData(e.buffer);r._vertexBuffer=n;r._vertexCount=n._byteLength/t.vertexStride;var o=new jt(H.IndexFormat.UInt16,a.length,i.STATIC_DRAW,true);o.setData(a);r._indexBuffer=o;r._setBuffer(n,o);r._setInstanceBuffer(r._instanceBufferStateType);s._vertexBuffer=n;s._indexBuffer=o;s._setIndexRange(0,o.indexCount);var l=s._subIndexBufferStart;var _=s._subIndexBufferCount;var h=s._boneIndicesList;l.length=1;_.length=1;h.length=1;l[0]=0;_[0]=o.indexCount;var x=[];x.push(s);r._setSubMeshes(x);r.calculateBounds();var c=n._byteLength+o._byteLength;r._setCPUMemory(c);r._setGPUMemory(c);return r}static createBox(t=1,e=1,a=1){var i=K.getVertexDeclaration("POSITION,NORMAL,UV");var r=t/2;var s=e/2;var n=a/2;var o=new Float32Array([-r,s,-n,0,1,0,0,0,r,s,-n,0,1,0,1,0,r,s,n,0,1,0,1,1,-r,s,n,0,1,0,0,1,-r,-s,-n,0,-1,0,0,1,r,-s,-n,0,-1,0,1,1,r,-s,n,0,-1,0,1,0,-r,-s,n,0,-1,0,0,0,-r,s,-n,-1,0,0,0,0,-r,s,n,-1,0,0,1,0,-r,-s,n,-1,0,0,1,1,-r,-s,-n,-1,0,0,0,1,r,s,-n,1,0,0,1,0,r,s,n,1,0,0,0,0,r,-s,n,1,0,0,0,1,r,-s,-n,1,0,0,1,1,-r,s,n,0,0,1,0,0,r,s,n,0,0,1,1,0,r,-s,n,0,0,1,1,1,-r,-s,n,0,0,1,0,1,-r,s,-n,0,0,-1,1,0,r,s,-n,0,0,-1,0,0,r,-s,-n,0,0,-1,0,1,-r,-s,-n,0,0,-1,1,1]);var l=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);return mi._createMesh(i,o,l)}static createCapsule(t=.5,e=2,a=16,i=32){var r=(a+1)*(i+1)*2+(i+1)*2;var s=3*a*(i+1)*2*2+2*i*3;var n=K.getVertexDeclaration("POSITION,NORMAL,UV");var o=n.vertexStride/4;var l=new Float32Array(r*o);var _=new Uint16Array(s);var h=Math.PI/2/a;var x=Math.PI*2/i;var c=e/2-t;var d=0;var u=0;var f=0;var p=0;var m=0;var g=0;var v,y;for(v=0;v<=a;v++){for(y=0;y<=i;y++){d=t*Math.cos(v*h)*Math.cos(y*x+Math.PI);u=t*Math.sin(v*h);f=t*Math.cos(v*h)*Math.sin(y*x+Math.PI);l[p++]=d;l[p++]=u+c;l[p++]=f;l[p++]=d;l[p++]=u;l[p++]=f;l[p++]=1-y/i;l[p++]=(1-v/a)*(Math.PI*t/2/(e+Math.PI*t));if(v<a){_[m++]=v*(i+1)+y+(i+1);_[m++]=v*(i+1)+y;_[m++]=v*(i+1)+y+1;_[m++]=v*(i+1)+y+i;_[m++]=v*(i+1)+y;_[m++]=v*(i+1)+y+(i+1)}}}g+=(a+1)*(i+1);for(v=0;v<=a;v++){for(y=0;y<=i;y++){d=t*Math.cos(v*h)*Math.cos(y*x+Math.PI);u=t*Math.sin(-v*h);f=t*Math.cos(v*h)*Math.sin(y*x+Math.PI);l[p++]=d;l[p++]=u-c;l[p++]=f;l[p++]=d;l[p++]=u;l[p++]=f;l[p++]=1-y/i;l[p++]=(v/a*(Math.PI*t/2)+(e+Math.PI*t/2))/(e+Math.PI*t);if(v<a){_[m++]=g+v*(i+1)+y;_[m++]=g+v*(i+1)+y+(i+1);_[m++]=g+v*(i+1)+y+1;_[m++]=g+v*(i+1)+y;_[m++]=g+v*(i+1)+y+i;_[m++]=g+v*(i+1)+y+(i+1)}}}g+=(a+1)*(i+1);for(y=0;y<=i;y++){d=t*Math.cos(y*x+Math.PI);u=c;f=t*Math.sin(y*x+Math.PI);l[p++]=d;l[p+(i+1)*8-1]=d;l[p++]=u;l[p+(i+1)*8-1]=-u;l[p++]=f;l[p+(i+1)*8-1]=f;l[p++]=d;l[p+(i+1)*8-1]=d;l[p++]=0;l[p+(i+1)*8-1]=0;l[p++]=f;l[p+(i+1)*8-1]=f;l[p++]=1-y*1/i;l[p+(i+1)*8-1]=1-y*1/i;l[p++]=Math.PI*t/2/(e+Math.PI*t);l[p+(i+1)*8-1]=(Math.PI*t/2+e)/(e+Math.PI*t)}for(y=0;y<i;y++){_[m++]=y+g+(i+1);_[m++]=y+g+1;_[m++]=y+g;_[m++]=y+g+(i+1);_[m++]=y+g+(i+1)+1;_[m++]=y+g+1}g+=2*(i+1);return mi._createMesh(n,l,_)}static createCone(t=.5,e=1,a=32){var i=a+1+1+(a+1)*2;var r=6*a+3*a;var s=K.getVertexDeclaration("POSITION,NORMAL,UV");var n=s.vertexStride/4;var o=new Float32Array(i*n);var l=new Uint16Array(r);var _=Math.PI*2/a;var h=e/2;var x=0;var c=0;var d=0;var u=0;var f=0;var p=new St;var m=new St(0,-1,0);var g=new St(0,h,0);var v=new St;var y=new St;var T=new M;var E=new St;var b;var S=0;var C=0;for(var R=0;R<=a;R++){x=R*_;d=Math.cos(x+Math.PI)*t;u=h;f=Math.sin(x+Math.PI)*t;o[S++]=0;o[S+(a+1)*8-1]=d;o[S++]=u;o[S+(a+1)*8-1]=-u;o[S++]=0;o[S+(a+1)*8-1]=f;p.x=d;p.y=0;p.z=f;v.x=d;v.y=-u;v.z=f;St.subtract(v,g,y);St.normalize(y,y);b=Math.acos(St.dot(m,y));St.cross(m,y,E);St.normalize(E,E);M.createFromAxisAngle(E,b,T);St.normalize(p,p);St.transformQuat(p,T,p);St.normalize(p,p);o[S++]=p.x;o[S+(a+1)*8-1]=p.x;o[S++]=p.y;o[S+(a+1)*8-1]=p.y;o[S++]=p.z;o[S+(a+1)*8-1]=p.z;o[S++]=1-R*1/a;o[S+(a+1)*8-1]=1-R*1/a;o[S++]=0;o[S+(a+1)*8-1]=1}S+=(a+1)*8;for(var A=0;A<a;A++){l[C++]=A+c+(a+1);l[C++]=A+c+1;l[C++]=A+c;l[C++]=A+c+(a+1);l[C++]=A+c+(a+1)+1;l[C++]=A+c+1}c+=2*(a+1);for(var L=0;L<=a;L++){if(L===0){o[S++]=0;o[S++]=-h;o[S++]=0;o[S++]=0;o[S++]=-1;o[S++]=0;o[S++]=.5;o[S++]=.5}x=L*_;d=Math.cos(x+Math.PI)*t;u=-h;f=Math.sin(x+Math.PI)*t;o[S++]=d;o[S++]=u;o[S++]=f;o[S++]=0;o[S++]=-1;o[S++]=0;o[S++]=.5+Math.cos(x)*.5;o[S++]=.5+Math.sin(x)*.5}for(var I=0;I<a;I++){l[C++]=0+c;l[C++]=I+2+c;l[C++]=I+1+c}c+=a+1+1;return mi._createMesh(s,o,l)}static createCylinder(t=.5,e=2,a=32){var i=a+1+1+(a+1)*2+(a+1+1);var r=3*a+6*a+3*a;var s=K.getVertexDeclaration("POSITION,NORMAL,UV");var n=s.vertexStride/4;var o=new Float32Array(i*n);var l=new Uint16Array(r);var _=Math.PI*2/a;var h=e/2;var x=0;var c=0;var d=0;var u=0;var f=0;var p=0;var m=0;for(var g=0;g<=a;g++){if(g===0){o[p++]=0;o[p++]=h;o[p++]=0;o[p++]=0;o[p++]=1;o[p++]=0;o[p++]=.5;o[p++]=.5}x=g*_;d=Math.cos(x)*t;u=h;f=Math.sin(x)*t;o[p++]=d;o[p++]=u;o[p++]=f;o[p++]=0;o[p++]=1;o[p++]=0;o[p++]=.5+Math.cos(x)*.5;o[p++]=.5+Math.sin(x)*.5}for(var v=0;v<a;v++){l[m++]=0;l[m++]=v+1;l[m++]=v+2}c+=a+1+1;for(var y=0;y<=a;y++){x=y*_;d=Math.cos(x+Math.PI)*t;u=h;f=Math.sin(x+Math.PI)*t;o[p++]=d;o[p+(a+1)*8-1]=d;o[p++]=u;o[p+(a+1)*8-1]=-u;o[p++]=f;o[p+(a+1)*8-1]=f;o[p++]=d;o[p+(a+1)*8-1]=d;o[p++]=0;o[p+(a+1)*8-1]=0;o[p++]=f;o[p+(a+1)*8-1]=f;o[p++]=1-y*1/a;o[p+(a+1)*8-1]=1-y*1/a;o[p++]=0;o[p+(a+1)*8-1]=1}p+=(a+1)*8;for(var T=0;T<a;T++){l[m++]=T+c+(a+1);l[m++]=T+c+1;l[m++]=T+c;l[m++]=T+c+(a+1);l[m++]=T+c+(a+1)+1;l[m++]=T+c+1}c+=2*(a+1);for(var E=0;E<=a;E++){if(E===0){o[p++]=0;o[p++]=-h;o[p++]=0;o[p++]=0;o[p++]=-1;o[p++]=0;o[p++]=.5;o[p++]=.5}x=E*_;d=Math.cos(x+Math.PI)*t;u=-h;f=Math.sin(x+Math.PI)*t;o[p++]=d;o[p++]=u;o[p++]=f;o[p++]=0;o[p++]=-1;o[p++]=0;o[p++]=.5+Math.cos(x)*.5;o[p++]=.5+Math.sin(x)*.5}for(var b=0;b<a;b++){l[m++]=0+c;l[m++]=b+2+c;l[m++]=b+1+c}c+=a+1+1;return mi._createMesh(s,o,l)}static createPlane(t=10,e=10,a=10,i=10){var r=(a+1)*(i+1);var s=a*i*2*3;var n=new Uint16Array(s);var o=K.getVertexDeclaration("POSITION,NORMAL,UV");var l=o.vertexStride/4;var _=new Float32Array(r*l);var h=t/2;var x=e/2;var c=t/a;var d=e/i;var u=0;for(var f=0;f<=i;f++){for(var p=0;p<=a;p++){_[u++]=p*c-h;_[u++]=0;_[u++]=f*d-x;_[u++]=0;_[u++]=1;_[u++]=0;_[u++]=p*1/a;_[u++]=f*1/i}}var m=0;for(f=0;f<i;f++){for(p=0;p<a;p++){n[m++]=(f+1)*(a+1)+p;n[m++]=f*(a+1)+p;n[m++]=(f+1)*(a+1)+p+1;n[m++]=f*(a+1)+p;n[m++]=f*(a+1)+p+1;n[m++]=(f+1)*(a+1)+p+1}}return mi._createMesh(o,_,n)}static createQuad(t=1,e=1){var a=K.getVertexDeclaration("POSITION,NORMAL,UV");var i=t/2;var r=e/2;var s=new Float32Array([-i,r,0,0,0,1,0,0,i,r,0,0,0,1,1,0,-i,-r,0,0,0,1,0,1,i,-r,0,0,0,1,1,1]);var n=new Uint16Array([0,1,2,3,2,1]);return mi._createMesh(a,s,n)}static createSphere(t=.5,e=32,a=32){var i=(e+1)*(a+1);var r=3*e*(a+1)*2;var s=new Uint16Array(r);var n=K.getVertexDeclaration("POSITION,NORMAL,UV");var o=n.vertexStride/4;var l=new Float32Array(i*o);var _=Math.PI/e;var h=Math.PI*2/a;var x=0;i=0;r=0;for(var c=0;c<e+1;c++){var d=Math.sin(c*_);var u=Math.cos(c*_);for(var f=0;f<a+1;f++){var p=d*Math.sin(f*h+Math.PI*1/2);var m=d*Math.cos(f*h+Math.PI*1/2);l[i+0]=p*t;l[i+1]=u*t;l[i+2]=m*t;l[i+3]=p;l[i+4]=u;l[i+5]=m;l[i+6]=f/a;l[i+7]=c/e;i+=o;if(c!=e-1){s[r++]=x+(a+1);s[r++]=x;s[r++]=x+1;s[r++]=x+a;s[r++]=x;s[r++]=x+(a+1);x++}}}return mi._createMesh(n,l,s)}}var gi="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\nuniform sampler2D u_MainTex;\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main() {\r\n\tgl_FragColor = texture2D(u_MainTex, v_Texcoord0);\r\n}\r\n\r\n";var vi='#include "Lighting.glsl";\r\n#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\nattribute vec4 a_PositionTexcoord;\r\nuniform vec4 u_OffsetScale;\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main() {\t\r\n\tgl_Position = vec4(u_OffsetScale.x*2.0-1.0+(a_PositionTexcoord.x+1.0)*u_OffsetScale.z,(1.0-((u_OffsetScale.y*2.0-1.0+(-a_PositionTexcoord.y+1.0)*u_OffsetScale.w)+1.0)/2.0)*2.0-1.0, 0.0, 1.0);\t\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapGLPositionZ(gl_Position);\r\n}';var yi="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#ifdef COLOR\r\n\tvarying vec4 v_Color;\r\n#endif\r\nvarying vec2 v_Texcoord0;\r\n\r\n#ifdef MAINTEXTURE\r\n\tuniform sampler2D u_AlbedoTexture;\r\n#endif\r\n\r\nuniform vec4 u_AlbedoColor;\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\t#ifdef ADDTIVEFOG\r\n\t#else\r\n\t\tuniform vec3 u_FogColor;\r\n\t#endif\r\n#endif\r\n\r\nvoid main()\r\n{\r\n\tvec4 color =  2.0 * u_AlbedoColor;\r\n\t#ifdef COLOR\r\n\t\tcolor *= v_Color;\r\n\t#endif\r\n\t#ifdef MAINTEXTURE\r\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\r\n\t#endif\r\n\t\r\n\tgl_FragColor = color;\r\n\t\r\n\t#ifdef FOG\r\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\r\n\t\t#ifdef ADDTIVEFOG\r\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\r\n\t\t#else\r\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\r\n\t\t#endif\r\n\t#endif\r\n}\r\n\r\n";var Ti='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl";\r\n\r\nattribute vec4 a_Position;\r\nattribute vec4 a_Color;\r\nattribute vec2 a_Texcoord0;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\n\r\n#ifdef COLOR\r\n\tvarying vec4 v_Color;\r\n#endif\r\nvarying vec2 v_Texcoord0;\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\t\r\n\t#ifdef TILINGOFFSET\r\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t#else\r\n\t\tv_Texcoord0=a_Texcoord0;\r\n\t#endif\r\n\t\t\r\n\t#ifdef COLOR\r\n\t\tv_Color = a_Color;\r\n\t#endif\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var Ei='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\r\n\tuniform vec3 u_CameraPos;\r\n\tvarying vec3 v_Normal;\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\tuniform vec3 u_FogColor;\r\n#endif\r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tuniform DirectionLight u_DirectionLight;\r\n\t\t#endif\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tuniform PointLight u_PointLight;\r\n\t\t#endif\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tuniform SpotLight u_SpotLight;\r\n\t\t#endif\r\n\t#else\r\n\t\tuniform mat4 u_View;\r\n\t\tuniform vec4 u_ProjectionParams;\r\n\t\tuniform vec4 u_Viewport;\r\n\t\tuniform int u_DirationLightCount;\r\n\t\tuniform sampler2D u_LightBuffer;\r\n\t\tuniform sampler2D u_LightClusterBuffer;\r\n\t#endif\r\n#endif\r\n\r\n#include "Shadow.glsl"\r\n#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\nvarying float v_posViewZ;\r\n\r\nuniform vec3 u_AmbientColor;\r\n\r\nuniform sampler2D u_SplatAlphaTexture;\r\n\r\nuniform sampler2D u_DiffuseTexture1;\r\nuniform sampler2D u_DiffuseTexture2;\r\nuniform sampler2D u_DiffuseTexture3;\r\nuniform sampler2D u_DiffuseTexture4;\r\nuniform sampler2D u_DiffuseTexture5;\r\n\r\nuniform vec4 u_DiffuseScaleOffset1;\r\nuniform vec4 u_DiffuseScaleOffset2;\r\nuniform vec4 u_DiffuseScaleOffset3;\r\nuniform vec4 u_DiffuseScaleOffset4;\r\nuniform vec4 u_DiffuseScaleOffset5;\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n#ifdef LIGHTMAP\r\n\tuniform sampler2D u_LightMap;\r\n\tvarying vec2 v_LightMapUV;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n\tvec4 splatAlpha = vec4(1.0);\r\n\t#ifdef ExtendTerrain_DETAIL_NUM1\r\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\r\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\r\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\r\n\t#endif\r\n\t#ifdef ExtendTerrain_DETAIL_NUM2\r\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\r\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\r\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\r\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\r\n\t#endif\r\n\t#ifdef ExtendTerrain_DETAIL_NUM3\r\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\r\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\r\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\r\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\r\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\r\n\t#endif\r\n\t#ifdef ExtendTerrain_DETAIL_NUM4\r\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\r\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\r\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\r\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\r\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\r\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\r\n\t#endif\r\n\t#ifdef ExtendTerrain_DETAIL_NUM5\r\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\r\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\r\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\r\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\r\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\r\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\r\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\r\n\t#endif\r\n\t\tgl_FragColor.w = splatAlpha.a;\r\n\t\t\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 normal = v_Normal;\r\n\t\tvec3 dif, spe;\r\n\t#endif\r\n\r\n\tvec3 diffuse = vec3(0.0);\r\n\tvec3 specular= vec3(0.0);\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\r\n\t\tvec3 toEye;\r\n\t\t#ifdef FOG\r\n\t\t\ttoEye=u_CameraPos-v_PositionWorld;\r\n\t\t\tfloat toEyeLength=length(toEye);\r\n\t\t\ttoEye/=toEyeLength;\r\n\t\t#else\r\n\t\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tLayaAirBlinnPhongDiectionLight(vec3(0.0),1.0,normal,vec3(1.0),toEye,u_DirectionLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye,u_PointLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye,u_SpotLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t{\r\n\t\t\t\tif(i >= u_DirationLightCount)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\r\n\t\t\t\tLayaAirBlinnPhongDiectionLight(vec3(0.0),1.0,normal,vec3(1.0),toEye,directionLight,dif,spe);\r\n\t\t\t\tdiffuse+=dif;\r\n\t\t\t\tspecular+=spe;\r\n\t\t\t}\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\r\n\t\t\t#ifdef POINTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye,pointLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\t#ifdef SPOTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye\t,spotLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\nvec3 globalDiffuse = u_AmbientColor;\r\n#ifdef LIGHTMAP\r\n\tglobalDiffuse += decodeHDR(texture2D(u_LightMap, v_LightMapUV),5.0);\r\n#endif\r\n\r\n#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tfloat shadowValue = shadowValue = sampleShadowmap(v_ShadowCoord);\r\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse) * shadowValue, gl_FragColor.a);\r\n#else\r\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse), gl_FragColor.a);\r\n#endif\r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\tgl_FragColor.rgb += specular * shadowValue;\r\n\t#else\r\n\t\tgl_FragColor.rgb += specular;\r\n\t#endif\r\n#endif\r\n\r\n#ifdef FOG\r\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\r\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\r\n#endif\r\n}\r\n\r\n\r\n\r\n\r\n\r\n';var bi='#include "Lighting.glsl";\r\n\r\nattribute vec4 a_Position;\r\nattribute vec2 a_Texcoord0;\r\n\r\nuniform mat4 u_MvpMatrix;\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\r\n\tattribute vec3 a_Normal;\r\n\tvarying vec3 v_Normal;\r\n#endif\r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(CALCULATE_SHADOWS)&&defined(SHADOWMAP_PSSM1))\r\n\tuniform mat4 u_WorldMat;\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tvarying vec2 v_LightMapUV;\r\n\tuniform vec4 u_LightmapScaleOffset;\r\n#endif\r\n\r\n#if defined(CALCULATE_SHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n\tgl_Position = u_MvpMatrix * a_Position;\r\n  \r\n\tv_Texcoord0 = a_Texcoord0;\r\n  \r\n\t#ifdef LIGHTMAP\r\n\t\tv_LightMapUV = vec2(a_Texcoord0.x, 1.0 - a_Texcoord0.y) * u_LightmapScaleOffset.xy + u_LightmapScaleOffset.zw;\r\n\t\tv_LightMapUV.y = 1.0 - v_LightMapUV.y;\r\n\t#endif\r\n  \r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tv_Normal = a_Normal;\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(CALCULATE_SHADOWS)&&defined(SHADOWMAP_PSSM1))\r\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\r\n\t\tv_ShadowCoord = getShadowCoord(vec4(v_PositionWorld));\r\n\t#endif\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var Si='struct LayaGIInput\r\n{\r\n\tvec2 lightmapUV;\r\n\tvec3 worldPos;\r\n};\r\n\r\n#define LAYA_SPECCUBE_LOD_STEPS 6.0\r\n\r\nuniform vec3 u_AmbientColor;\r\n\r\n#if defined(GI_AMBIENT_SH)\r\n\tuniform vec4 u_AmbientSHAr;\r\n\tuniform vec4 u_AmbientSHAg;\r\n\tuniform vec4 u_AmbientSHAb;\r\n\tuniform vec4 u_AmbientSHBr;\r\n\tuniform vec4 u_AmbientSHBg;\r\n\tuniform vec4 u_AmbientSHBb;\r\n\tuniform vec4 u_AmbientSHC;\r\n#endif\r\n\r\nuniform samplerCube u_ReflectTexture;\r\nuniform vec4 u_ReflectCubeHDRParams;\r\n\r\n#ifdef SPECCUBE_BOX_PROJECTION\r\n\tuniform vec3 u_SpecCubeProbePosition;\r\n\tuniform vec3 u_SpecCubeBoxMax;\r\n\tuniform vec3 u_SpecCubeBoxMin;\r\n#endif\r\n\r\n\r\n#ifdef GI_AMBIENT_SH\r\n\tmediump vec3 shEvalLinearL0L1(mediump vec4 normal)\r\n\t{\r\n\t\tmediump vec3 x;\r\n\t\t// Linear (L1) + constant (L0) polynomial terms\r\n\t\tx.r = dot(u_AmbientSHAr, normal);\r\n\t\tx.g = dot(u_AmbientSHAg, normal);\r\n\t\tx.b = dot(u_AmbientSHAb, normal);\r\n\t\treturn x;\r\n\t}\r\n\r\n\tmediump vec3 shEvalLinearL2(mediump vec4 normal)\r\n\t{\r\n\t\tmediump vec3 x1,x2;\r\n\t\t// 4 of the quadratic (L2) polynomials\r\n\t\tmediump vec4 vB = normal.xyzz * normal.yzzx;\r\n\t\tx1.r = dot(u_AmbientSHBr, vB);\r\n\t\tx1.g = dot(u_AmbientSHBg, vB);\r\n\t\tx1.b = dot(u_AmbientSHBb, vB);\r\n\r\n\t\t// Final (5th) quadratic (L2) polynomial\r\n\t\tmediump float vC = normal.x*normal.x - normal.y*normal.y;\r\n\t\tx2 = u_AmbientSHC.rgb * vC;\r\n\r\n\t\treturn x1 + x2;\r\n\t}\r\n\t\r\n\tmediump vec3 shadeSHPerPixel(mediump vec3 normal)\r\n\t{\r\n\t\tmediump vec3 ambientContrib;\r\n\t\tmediump vec4 normalV4=vec4(-normal.x,normal.yz, 1.0);//Note:SH Data is left-hand,so x need inverse\r\n\t\tambientContrib = shEvalLinearL0L1(normalV4);\r\n\t\tambientContrib += shEvalLinearL2(normalV4);\r\n\t\tmediump vec3 ambient = max(vec3(0.0), ambientContrib);\r\n\t\tambient = layaLinearToGammaSpace(ambient);\r\n\t\treturn ambient;\r\n\t}\r\n#endif\r\n\r\n\r\n\r\n mediump vec3 BoxProjectedCubemapDirection(mediump vec3 worldRefl,mediump vec3 worldPos,mediump vec3 cubemapCenter,mediump vec3 boxMin,mediump vec3 boxMax){\r\n\t mediump vec3 nrdir = normalize(worldRefl);\r\n\t mediump vec3 rbmax = (boxMax - worldPos);\r\n\t mediump vec3 rbmin = (boxMin - worldPos);\r\n\t mediump vec3 select = step(vec3(0.0), worldRefl);\r\n\t mediump vec3 rbminmax = mix(rbmin, rbmax, select);\r\n\trbminmax = rbminmax / nrdir;\r\n\tmediump float scalar = min(min(rbminmax.x, rbminmax.y), rbminmax.z);\r\n\t mediump vec3 worldChangeRefl = nrdir * scalar + (worldPos - cubemapCenter);\r\n\treturn worldChangeRefl;\r\n}\r\n\r\n\r\nmediump vec3 layaDecodeDirectionalLightmap (mediump vec3 color, lowp vec4 dirTex, mediump vec3 normalWorld)\r\n{\r\n    // In directional (non-specular) mode Enlighten bakes dominant light direction\r\n    // in a way, that using it for half Lambert and then dividing by a "rebalancing coefficient"\r\n    // gives a result close to plain diffuse response lightmaps, but normalmapped.\r\n\r\n    // Note that dir is not unit length on purpose. Its length is "directionality", like\r\n    // for the directional specular lightmaps.\r\n\tlowp vec3 directional=dirTex.xyz - 0.5;\r\n\tdirectional.x=-directional.x;//NOTE:because coord System\r\n    mediump float halfLambert = dot(normalWorld,directional) + 0.5;\r\n\r\n    return color * halfLambert / max(1e-4, dirTex.w);\r\n}\r\n\r\nvec3 layaGIBase(LayaGIInput giInput,mediump float occlusion, mediump vec3 normalWorld)\r\n{\r\n\tvec3 indirectDiffuse;\r\n\t#ifdef LIGHTMAP\t\r\n\t\tmediump vec3 bakedColor =decodeHDR(texture2D(u_LightMap, giInput.lightmapUV),5.0);\r\n\t\t#ifdef LIGHTMAP_DIRECTIONAL\r\n\t\t\tlowp vec4 bakedDirTex = texture2D (u_LightMapDirection, giInput.lightmapUV);\r\n            indirectDiffuse = layaDecodeDirectionalLightmap (bakedColor, bakedDirTex, normalWorld);\r\n\t\t#else //unDirectional lightmap\r\n\t\t\tindirectDiffuse = bakedColor;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef GI_AMBIENT_SH\r\n\t\t\tindirectDiffuse = shadeSHPerPixel(normalWorld);\r\n\t\t#else\r\n\t\t\tindirectDiffuse = u_AmbientColor; //already in gamma space\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tindirectDiffuse*=occlusion;\r\n\treturn indirectDiffuse;\r\n}\r\n\r\nmediump vec3 layaGlossyEnvironment(mediump vec4 glossIn)\r\n{\r\n\tmediump float perceptualRoughness = glossIn.a;\r\n\r\n\t// use approximation to solve,below is more reasonable,but maybe slow. \r\n\t// float m = perceptualRoughnessToRoughness(perceptualRoughness); // m is the real roughness parameter\r\n    // const float fEps = 1.192092896e-07F;        // smallest such that 1.0+FLT_EPSILON != 1.0  (+1e-4h is NOT good here. is visibly very wrong)\r\n    // float n =  (2.0/max(fEps, m*m))-2.0;        // remap to spec power. See eq. 21 in --\x3e https://dl.dropboxusercontent.com/u/55891920/papers/mm_brdf.pdf\r\n    // n /= 4;                                     // remap from n_dot_h formulatino to n_dot_r. See section "Pre-convolved Cube Maps vs Path Tracers" --\x3e https://s3.amazonaws.com/docs.knaldtech.com/knald/1.0.0/lys_power_drops.html\r\n    // perceptualRoughness = pow( 2/(n+2), 0.25);  // remap back to square root of real roughness (0.25 include both the sqrt root of the conversion and sqrt for going from roughness to perceptualRoughness)\r\n\tperceptualRoughness = perceptualRoughness * (1.7 - 0.7*perceptualRoughness);//just a approximation,but fast.\r\n \r\n\tmediump float mip = perceptualRoughness * LAYA_SPECCUBE_LOD_STEPS;\r\n\tmediump vec3 uvw = glossIn.rgb;\r\n\tuvw.x=-uvw.x;//Note:reflectCube is left-hand,so x need inverse\r\n\tmediump vec4 rgbm=textureCubeLodEXT(u_ReflectTexture,uvw,mip);\r\n\treturn decodeHDR(rgbm,u_ReflectCubeHDRParams.x);\r\n}\r\n\r\nmediump vec3 layaGIIndirectSpecular(LayaGIInput giInput,mediump float occlusion, vec4 glossIn)\r\n{\r\n\t#ifdef SPECCUBE_BOX_PROJECTION\r\n\t\tvec3 originalReflUVW = glossIn.xyz;\r\n\t\tglossIn.xyz =BoxProjectedCubemapDirection(originalReflUVW,giInput.worldPos,u_SpecCubeProbePosition,u_SpecCubeBoxMin,u_SpecCubeBoxMax);\r\n\t#endif\r\n\tmediump vec3 specular = layaGlossyEnvironment(glossIn);\r\n\treturn specular * occlusion;\r\n}\r\n\r\n\r\nLayaGI layaGlobalIllumination(LayaGIInput giInput,mediump float occlusion, mediump vec3 normalWorld,mediump vec4 uvwRoughness)\r\n{\r\n\tLayaGI gi;\r\n\tgi.diffuse = layaGIBase(giInput,occlusion, normalWorld);\r\n\tgi.specular = layaGIIndirectSpecular(giInput,occlusion, uvwRoughness);\r\n\treturn gi;\r\n}\r\n\r\n\r\n';var Ci="#ifdef GRAPHICS_API_GLES3\r\n\t#define INVERSE_MAT(mat) inverse(mat)\r\n#else\r\n\t#define INVERSE_MAT(mat) inverseMat(mat)\r\n#endif\r\n\r\nstruct DirectionLight {\r\n\tvec3 color;\r\n\tvec3 direction;\r\n};\r\n\r\nstruct PointLight {\r\n\tvec3 color;\r\n\tvec3 position;\r\n\tfloat range;\r\n};\r\n\r\nstruct SpotLight {\r\n\tvec3 color;\r\n\tvec3 position;\r\n\tfloat range;\r\n\tvec3 direction;\r\n\tfloat spot;\r\n};\r\n\r\nstruct LayaGI{\r\n\tvec3 diffuse;\r\n\tvec3 specular;\r\n};\r\n\r\nstruct LayaLight{\r\n\tvec3 color;\r\n\tvec3 dir;\r\n};\r\n\r\nconst int c_ClusterBufferWidth = CLUSTER_X_COUNT*CLUSTER_Y_COUNT;\r\nconst int c_ClusterBufferHeight = CLUSTER_Z_COUNT*(1+int(ceil(float(MAX_LIGHT_COUNT_PER_CLUSTER)/4.0)));\r\nconst int c_ClusterBufferFloatWidth = c_ClusterBufferWidth*4;\r\n\r\n#ifndef GRAPHICS_API_GLES3\r\n\tmat3 inverseMat(mat3 m) {\r\n\t\tfloat a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\r\n\t\tfloat a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\r\n\t\tfloat a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\r\n\r\n\t\tfloat b01 = a22 * a11 - a12 * a21;\r\n\t\tfloat b11 = -a22 * a10 + a12 * a20;\r\n\t\tfloat b21 = a21 * a10 - a11 * a20;\r\n\r\n\t\tfloat det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n\t\treturn mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\r\n\t\t\t\t\tb11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\r\n\t\t\t\t\tb21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\r\n\t}\r\n#endif\r\n\r\nivec4 getClusterInfo(sampler2D clusterBuffer,mat4 viewMatrix,vec4 viewport,vec3 position,vec4 fragCoord,vec4 projectParams)\r\n{\r\n\tvec3 viewPos = vec3(viewMatrix*vec4(position, 1.0)); //position in viewspace\r\n\r\n\tint clusterXIndex = int(floor(fragCoord.x/ (float(viewport.z)/float(CLUSTER_X_COUNT))));\r\n    int clusterYIndex = int(floor((viewport.w * (projectParams.z <0.0? 0.0 : 1.0) - fragCoord.y * projectParams.z)/ (float(viewport.w)/float(CLUSTER_Y_COUNT))));//Maybe Flipped ProjectMatrix\r\n\tfloat zSliceParam =float(CLUSTER_Z_COUNT)/log2(projectParams.y / projectParams.x);\r\n \tint clusterZIndex = int(floor(log2(-viewPos.z) * zSliceParam- log2(projectParams.x) * zSliceParam));//projectParams x:cameraNear y:cameraFar\r\n\r\n\tvec2 uv= vec2((float(clusterXIndex + clusterYIndex * CLUSTER_X_COUNT)+0.5)/float(c_ClusterBufferWidth),\r\n\t\t\t\t(float(clusterZIndex)+0.5)/float(c_ClusterBufferHeight));\r\n\tvec4 clusterPixel=texture2D(clusterBuffer, uv);\r\n\treturn ivec4(clusterPixel);//X:Point Count Y:Spot Count Z、W:Light Offset\r\n}\r\n\r\n\r\nint getLightIndex(sampler2D clusterBuffer,int offset,int index) \r\n{\r\n\tint totalOffset=offset+index;\r\n\tint row=totalOffset/c_ClusterBufferFloatWidth;\r\n\tint lastRowFloat=totalOffset-row*c_ClusterBufferFloatWidth;\r\n\tint col=lastRowFloat/4;\r\n\tvec2 uv=vec2((float(col)+0.5)/float(c_ClusterBufferWidth),\r\n\t\t\t\t(float(row)+0.5)/float(c_ClusterBufferHeight));\r\n\tvec4 texel = texture2D(clusterBuffer, uv);\r\n    int pixelComponent = lastRowFloat-col*4;\r\n    if (pixelComponent == 0) \r\n      return int(texel.x);\r\n    else if (pixelComponent == 1) \r\n      return int(texel.y);\r\n    else if (pixelComponent == 2) \r\n      return int(texel.z);\r\n    else //pixelComponent==3\r\n      return int(texel.w);\r\n}\r\n\r\nDirectionLight getDirectionLight(sampler2D lightBuffer,int index) \r\n{\r\n    DirectionLight light;\r\n    float v = (float(index)+0.5)/ float(MAX_LIGHT_COUNT);\r\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\r\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\r\n\tlight.color=p1.rgb;\r\n    light.direction = p2.rgb;\r\n    return light;\r\n}\r\n\r\nPointLight getPointLight(sampler2D lightBuffer,sampler2D clusterBuffer,ivec4 clusterInfo,int index) \r\n{\r\n    PointLight light;\r\n\tint pointIndex=getLightIndex(clusterBuffer,clusterInfo.z*c_ClusterBufferFloatWidth+clusterInfo.w,index);\r\n    float v = (float(pointIndex)+0.5)/ float(MAX_LIGHT_COUNT);\r\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\r\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\r\n\tlight.color=p1.rgb;\r\n\tlight.range = p1.a;\r\n    light.position = p2.rgb;\r\n    return light;\r\n}\r\n\r\nSpotLight getSpotLight(sampler2D lightBuffer,sampler2D clusterBuffer,ivec4 clusterInfo,int index) \r\n{\r\n    SpotLight light;\r\n\tint spoIndex=getLightIndex(clusterBuffer,clusterInfo.z*c_ClusterBufferFloatWidth+clusterInfo.w,clusterInfo.x+index);\r\n    float v = (float(spoIndex)+0.5)/ float(MAX_LIGHT_COUNT);\r\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\r\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\r\n\tvec4 p3 = texture2D(lightBuffer, vec2(0.625,v));\r\n    light.color = p1.rgb;\r\n\tlight.range=p1.a;\r\n    light.position = p2.rgb;\r\n\tlight.spot = p2.a;\r\n\tlight.direction = p3.rgb;\r\n    return light;\r\n}\r\n\r\n// Laya中使用衰减纹理\r\nfloat LayaAttenuation(in vec3 L,in float invLightRadius) {\r\n\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\r\n\tfRatio *= fRatio;\r\n\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\r\n}\r\n\r\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\r\nfloat BasicAttenuation(in vec3 L,in float invLightRadius) {\r\n\tvec3 distance = L * invLightRadius;\r\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius));\r\n\treturn attenuation * attenuation;\r\n}\r\n\r\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\r\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius) {\r\n\tfloat attenuationFactor = 30.0;\r\n\tvec3 distance = L * invLightRadius;\r\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\r\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\r\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\r\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\r\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\r\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\r\n\tattenuation /= 1.0 - attenuationFactor;\r\n\treturn attenuation;\r\n}\r\n\r\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor) {\r\n\tmediump vec3 h = normalize(viewDir-lightVec);\r\n\tlowp float ln = max (0.0, dot (-lightVec,normal));\r\n\tfloat nh = max (0.0, dot (h,normal));\r\n\tdiffuseColor=lightColor * ln;\r\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\r\n}\r\n\r\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor) {\r\n\tvec3 lightVec=normalize(light.direction);\r\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,lightVec,diffuseColor,specularColor);\r\n}\r\n\r\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor) {\r\n\tvec3 lightVec =  pos-light.position;\r\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,lightVec/length(lightVec),diffuseColor,specularColor);\r\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range);\r\n\tdiffuseColor *= attenuate;\r\n\tspecularColor*= attenuate;\r\n}\r\n\r\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor) {\r\n\tvec3 lightVec =  pos-light.position;\r\n\tvec3 normalLightVec=lightVec/length(lightVec);\r\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,normalLightVec,diffuseColor,specularColor);\r\n\tvec2 cosAngles=cos(vec2(light.spot,light.spot*0.5)*0.5);//ConeAttenuation\r\n\tfloat dl=dot(normalize(light.direction),normalLightVec);\r\n\tdl*=smoothstep(cosAngles[0],cosAngles[1],dl);\r\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range)*dl;\r\n\tdiffuseColor *=attenuate;\r\n\tspecularColor *=attenuate;\r\n}\r\n\r\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal) {\r\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\r\n\tmediump vec3 N = unitNormal;\r\n\tmediump vec3 T = tangent;\r\n\tmediump vec3 B = binormal;\r\n\tmat3 TBN = mat3(T, B, N);\r\n\r\n\t// Transform from tangent space to world space.\r\n\tvec3 bumpedNormal =normalize(TBN*normalT);\r\n\treturn bumpedNormal;\r\n}\r\n\r\nvec3 NormalSampleToWorldSpace1(vec4 normalMapSample, vec3 tangent, vec3 binormal, vec3 unitNormal) {\r\n\tvec3 normalT;\r\n\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\r\n\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\r\n\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\r\n\r\n\tvec3 T = normalize(tangent);\r\n\tvec3 B = normalize(binormal);\r\n\tvec3 N = normalize(unitNormal);\r\n\tmat3 TBN = mat3(T, B, N);\r\n\r\n\t// Transform from tangent space to world space.\r\n\tvec3 bumpedNormal = TBN * normalize(normalT);\r\n\r\n\treturn bumpedNormal;\r\n}\r\n\r\nvec3 DecodeLightmap(vec4 color) {\r\n\treturn color.rgb*color.a*5.0;\r\n}\r\n\r\nvec3 decodeHDR(vec4 color,float range) {\r\n\treturn color.rgb*color.a*range;\r\n}\r\n\r\nvec2 TransformUV(vec2 texcoord,vec4 tilingOffset) {\r\n\tvec2 transTexcoord=vec2(texcoord.x,texcoord.y-1.0)*tilingOffset.xy+vec2(tilingOffset.z,-tilingOffset.w);\r\n\ttransTexcoord.y+=1.0;\r\n\treturn transTexcoord;\r\n}\r\n\r\nvec4 remapGLPositionZ(vec4 position) {\r\n\tposition.z=position.z * 2.0 - position.w;\r\n\treturn position;\r\n}\r\n\r\nmediump vec3 layaLinearToGammaSpace (mediump vec3 linRGB)\r\n{\r\n    linRGB = max(linRGB, vec3(0.0));\r\n    // An almost-perfect approximation from http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\r\n    return max(1.055 * pow(linRGB,vec3(0.416666667)) - 0.055, 0.0);   \r\n}\r\n\r\nLayaLight layaDirectionLightToLight(in DirectionLight light,in float attenuate)\r\n{\r\n\tLayaLight relight;\r\n\trelight.color = light.color*attenuate;\r\n\trelight.dir = light.direction;\r\n\treturn relight;\r\n}\r\n\r\nLayaLight layaPointLightToLight(in vec3 pos,in vec3 normal, in PointLight light,in float attenuate)\r\n{\r\n\tLayaLight relight;\r\n\tvec3 lightVec =  pos-light.position;\r\n\tattenuate *= LayaAttenuation(lightVec, 1.0/light.range);\r\n\trelight.color = light.color*attenuate;\r\n\trelight.dir = normalize(lightVec);\r\n\treturn relight;\r\n}\r\n\r\nLayaLight layaSpotLightToLight(in vec3 pos,in vec3 normal, in SpotLight light,in float attenuate)\r\n{\r\n\tLayaLight relight;\r\n\tvec3 lightVec =  pos-light.position;\r\n\tvec3 normalLightVec=lightVec/length(lightVec);\r\n\tvec2 cosAngles=cos(vec2(light.spot,light.spot*0.5)*0.5);//ConeAttenuation\r\n\tfloat dl=dot(normalize(light.direction),normalLightVec);\r\n\tdl*=smoothstep(cosAngles[0],cosAngles[1],dl);\r\n\tattenuate *= LayaAttenuation(lightVec, 1.0/light.range)*dl;\r\n\trelight.dir = normalLightVec;\r\n\trelight.color = light.color*attenuate;\r\n\treturn relight;\r\n}\r\n\r\n\r\n\r\n\r\n";var Ri='// ------------------------------------------------------------------\r\n//  PCF Filtering Tent Functions\r\n// ------------------------------------------------------------------\r\n\r\n// Assuming a isoceles right angled triangle of height "triangleHeight" (as drawn below).\r\n// This function return the area of the triangle above the first texel(in Y the first texel).\r\n//\r\n// |\\      <-- 45 degree slop isosceles right angled triangle\r\n// | \\\r\n// ----    <-- length of this side is "triangleHeight"\r\n// _ _ _ _ <-- texels\r\nfloat sampleShadowGetIRTriangleTexelArea(float triangleHeight)\r\n{\r\n    return triangleHeight - 0.5;\r\n}\r\n\r\n// Assuming a isoceles triangle of 1.5 texels height and 3 texels wide lying on 4 texels.\r\n// This function return the area of the triangle above each of those texels.\r\n//    |    <-- offset from -0.5 to 0.5, 0 meaning triangle is exactly in the center\r\n//   / \\   <-- 45 degree slop isosceles triangle (ie tent projected in 2D)\r\n//  /   \\\r\n// _ _ _ _ <-- texels\r\n// X Y Z W <-- result indices (in computedArea.xyzw and computedAreaUncut.xyzw)\r\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\r\nvoid sampleShadowGetTexelAreasTent3x3(float offset, out vec4 computedArea, out vec4 computedAreaUncut)\r\n{\r\n    // Compute the exterior areas,a and h is same.\r\n    float a = offset + 0.5;\r\n    float offsetSquaredHalved = a * a * 0.5;\r\n    computedAreaUncut.x = computedArea.x = offsetSquaredHalved - offset;\r\n    computedAreaUncut.w = computedArea.w = offsetSquaredHalved;\r\n\r\n    // Compute the middle areas\r\n    // For Y : We find the area in Y of as if the left section of the isoceles triangle would\r\n    // intersect the axis between Y and Z (ie where offset = 0).\r\n    computedAreaUncut.y = sampleShadowGetIRTriangleTexelArea(1.5 - offset);\r\n    // This area is superior to the one we are looking for if (offset < 0) thus we need to\r\n    // subtract the area of the triangle defined by (0,1.5-offset), (0,1.5+offset), (-offset,1.5).\r\n    float clampedOffsetLeft = min(offset,0.0);\r\n    float areaOfSmallLeftTriangle = clampedOffsetLeft * clampedOffsetLeft;\r\n    computedArea.y = computedAreaUncut.y - areaOfSmallLeftTriangle;\r\n\r\n    // We do the same for the Z but with the right part of the isoceles triangle\r\n    computedAreaUncut.z = sampleShadowGetIRTriangleTexelArea(1.5 + offset);\r\n    float clampedOffsetRight = max(offset,0.0);\r\n    float areaOfSmallRightTriangle = clampedOffsetRight * clampedOffsetRight;\r\n    computedArea.z = computedAreaUncut.z - areaOfSmallRightTriangle;\r\n}\r\n\r\n// Assuming a isoceles triangle of 2.5 texel height and 5 texels wide lying on 6 texels.\r\n// This function return the weight of each texels area relative to the full triangle area.\r\n//  /       \\\r\n// _ _ _ _ _ _ <-- texels\r\n// 0 1 2 3 4 5 <-- computed area indices (in texelsWeights[])\r\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\r\nvoid sampleShadowGetTexelWeightsTent5x5(float offset, out vec3 texelsWeightsA, out vec3 texelsWeightsB)\r\n{\r\n    vec4 areaFrom3texelTriangle;\r\n    vec4 areaUncutFrom3texelTriangle;\r\n    sampleShadowGetTexelAreasTent3x3(offset, areaFrom3texelTriangle, areaUncutFrom3texelTriangle);\r\n\r\n    // Triangle slope is 45 degree thus we can almost reuse the result of the 3 texel wide computation.\r\n    // the 5 texel wide triangle can be seen as the 3 texel wide one but shifted up by one unit/texel.\r\n    // 0.16 is 1/(the triangle area)\r\n    texelsWeightsA.x = 0.16 * (areaFrom3texelTriangle.x);\r\n    texelsWeightsA.y = 0.16 * (areaUncutFrom3texelTriangle.y);\r\n    texelsWeightsA.z = 0.16 * (areaFrom3texelTriangle.y + 1.0);\r\n    texelsWeightsB.x = 0.16 * (areaFrom3texelTriangle.z + 1.0);\r\n    texelsWeightsB.y = 0.16 * (areaUncutFrom3texelTriangle.z);\r\n    texelsWeightsB.z = 0.16 * (areaFrom3texelTriangle.w);\r\n}\r\n\r\n// 5x5 Tent filter (45 degree sloped triangles in U and V)\r\nvoid sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize, vec2 coord, out float fetchesWeights[9], out vec2 fetchesUV[9])\r\n{\r\n    // tent base is 5x5 base thus covering from 25 to 36 texels, thus we need 9 bilinear PCF fetches\r\n    vec2 tentCenterInTexelSpace = coord.xy * shadowMapTextureTexelSize.zw;\r\n    vec2 centerOfFetchesInTexelSpace = floor(tentCenterInTexelSpace + 0.5);\r\n    vec2 offsetFromTentCenterToCenterOfFetches = tentCenterInTexelSpace - centerOfFetchesInTexelSpace;\r\n\r\n    // find the weight of each texel based on the area of a 45 degree slop tent above each of them.\r\n    vec3 texelsWeightsUA, texelsWeightsUB;\r\n    vec3 texelsWeightsVA, texelsWeightsVB;\r\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x, texelsWeightsUA, texelsWeightsUB);\r\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y, texelsWeightsVA, texelsWeightsVB);\r\n\r\n    // each fetch will cover a group of 2x2 texels, the weight of each group is the sum of the weights of the texels\r\n    vec3 fetchesWeightsU = vec3(texelsWeightsUA.xz, texelsWeightsUB.y) + vec3(texelsWeightsUA.y, texelsWeightsUB.xz);\r\n    vec3 fetchesWeightsV = vec3(texelsWeightsVA.xz, texelsWeightsVB.y) + vec3(texelsWeightsVA.y, texelsWeightsVB.xz);\r\n\r\n    // move the PCF bilinear fetches to respect texels weights\r\n    vec3 fetchesOffsetsU = vec3(texelsWeightsUA.y, texelsWeightsUB.xz) / fetchesWeightsU.xyz + vec3(-2.5,-0.5,1.5);\r\n    vec3 fetchesOffsetsV = vec3(texelsWeightsVA.y, texelsWeightsVB.xz) / fetchesWeightsV.xyz + vec3(-2.5,-0.5,1.5);\r\n    fetchesOffsetsU *= shadowMapTextureTexelSize.xxx;\r\n    fetchesOffsetsV *= shadowMapTextureTexelSize.yyy;\r\n\r\n    vec2 bilinearFetchOrigin = centerOfFetchesInTexelSpace * shadowMapTextureTexelSize.xy;\r\n    fetchesUV[0] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.x);\r\n    fetchesUV[1] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.x);\r\n    fetchesUV[2] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.x);\r\n    fetchesUV[3] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.y);\r\n    fetchesUV[4] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.y);\r\n    fetchesUV[5] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.y);\r\n    fetchesUV[6] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.z);\r\n    fetchesUV[7] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.z);\r\n    fetchesUV[8] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.z);\r\n\r\n    fetchesWeights[0] = fetchesWeightsU.x * fetchesWeightsV.x;\r\n    fetchesWeights[1] = fetchesWeightsU.y * fetchesWeightsV.x;\r\n    fetchesWeights[2] = fetchesWeightsU.z * fetchesWeightsV.x;\r\n    fetchesWeights[3] = fetchesWeightsU.x * fetchesWeightsV.y;\r\n    fetchesWeights[4] = fetchesWeightsU.y * fetchesWeightsV.y;\r\n    fetchesWeights[5] = fetchesWeightsU.z * fetchesWeightsV.y;\r\n    fetchesWeights[6] = fetchesWeightsU.x * fetchesWeightsV.z;\r\n    fetchesWeights[7] = fetchesWeightsU.y * fetchesWeightsV.z;\r\n    fetchesWeights[8] = fetchesWeightsU.z * fetchesWeightsV.z;\r\n}';var Ai="\r\n\r\n//SimpleSkinnedMesh\r\n#ifdef SIMPLEBONE\r\n\t#ifdef GPU_INSTANCE\r\n\t\tattribute vec4 a_SimpleTextureParams;\r\n\t#else\r\n\t\tuniform vec4 u_SimpleAnimatorParams;\r\n\t#endif\r\n\tuniform sampler2D u_SimpleAnimatorTexture;\r\n\r\n\tuniform float u_SimpleAnimatorTextureSize; \r\n#endif\r\n\r\n\r\n#ifdef SIMPLEBONE\r\n\tmat4 loadMatFromTexture(float FramePos,int boneIndices,float offset)\r\n\t{\r\n\t\tvec2 uv;\r\n\t\tfloat PixelPos = FramePos+float(boneIndices)*4.0;\r\n\t\tfloat halfOffset = offset * 0.5;\r\n\t\tfloat uvoffset = PixelPos/u_SimpleAnimatorTextureSize;\r\n\t\tuv.y = floor(uvoffset)*offset+halfOffset;\r\n\t\tuv.x = mod(float(PixelPos),u_SimpleAnimatorTextureSize)*offset+halfOffset;\r\n\t\tvec4 mat0row = texture2D(u_SimpleAnimatorTexture,uv);\r\n\t\tuv.x+=offset;\r\n\t\tvec4 mat1row = texture2D(u_SimpleAnimatorTexture,uv);\r\n\t\tuv.x+=offset;\r\n\t\tvec4 mat2row = texture2D(u_SimpleAnimatorTexture,uv);\r\n\t\tuv.x+=offset;\r\n\t\tvec4 mat3row = texture2D(u_SimpleAnimatorTexture,uv);\r\n\t\tmat4 m =mat4(mat0row.x,mat0row.y,mat0row.z,mat0row.w,\r\n\t\t\t\tmat1row.x,mat1row.y,mat1row.z,mat1row.w,\r\n\t\t\t\tmat2row.x,mat2row.y,mat2row.z,mat2row.w,\r\n\t\t\t\tmat3row.x,mat3row.y,mat3row.z,mat3row.w);\r\n\t\treturn m;\r\n\t}\r\n#endif\r\n\r\n";var Li="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\nvarying vec4 v_Color;\r\nuniform vec4 u_Color;\r\n\r\nvoid main()\r\n{\r\n  gl_FragColor = v_Color * u_Color; \r\n}\r\n\r\n";var Ii='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n\r\nattribute vec4 a_Position;\r\nuniform mat4 u_MvpMatrix;\r\nuniform vec4 u_Color;\r\nattribute vec4 a_Color;\r\nvarying vec4 v_Color;\r\n\r\n\r\nvoid main()\r\n{\r\n\tgl_Position = u_MvpMatrix * a_Position;\r\n\tv_Color=a_Color*u_Color;\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var Mi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n#include "Shadow.glsl"\r\n\r\nuniform vec4 u_DiffuseColor;\r\n\r\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n\tuniform float u_AlphaTestValue;\r\n#endif\r\n\r\n#ifdef DIFFUSEMAP\r\n\tuniform sampler2D u_DiffuseTexture;\r\n#endif\r\n\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tvarying vec2 v_LightMapUV;\r\n\tuniform sampler2D u_LightMap;\r\n#endif\r\n\r\nvarying vec3 v_Normal;\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tvarying vec3 v_ViewDir; \r\n\r\n\tuniform vec3 u_MaterialSpecular;\r\n\tuniform float u_Shininess;\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tuniform DirectionLight u_DirectionLight;\r\n\t\t#endif\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tuniform PointLight u_PointLight;\r\n\t\t#endif\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tuniform SpotLight u_SpotLight;\r\n\t\t#endif\r\n\t#else\r\n\t\tuniform mat4 u_View;\r\n\t\tuniform vec4 u_ProjectionParams;\r\n\t\tuniform vec4 u_Viewport;\r\n\t\tuniform int u_DirationLightCount;\r\n\t\tuniform sampler2D u_LightBuffer;\r\n\t\tuniform sampler2D u_LightClusterBuffer;\r\n\t#endif\r\n\r\n\t#ifdef SPECULARMAP \r\n\t\tuniform sampler2D u_SpecularTexture;\r\n\t#endif\r\n#endif\r\n\r\n#ifdef NORMALMAP \r\n\tuniform sampler2D u_NormalTexture;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\tuniform vec3 u_FogColor;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n\r\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec3 normal;//light and SH maybe use normal\r\n\t#if defined(NORMALMAP)\r\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\r\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\r\n\t#else\r\n\t\tnormal = normalize(v_Normal);\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 viewDir= normalize(v_ViewDir);\r\n\t#endif\r\n\r\n\tLayaGIInput giInput;\r\n\t#ifdef LIGHTMAP\t\r\n\t\tgiInput.lightmapUV=v_LightMapUV;\r\n\t#endif\r\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\r\n\t\r\n\tvec4 mainColor=u_DiffuseColor;\r\n\t#ifdef DIFFUSEMAP\r\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\r\n\t\tmainColor=mainColor*difTexColor;\r\n\t#endif \r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tmainColor=mainColor*v_Color;\r\n\t#endif \r\n    \r\n\t#ifdef ALPHATEST\r\n\t\tif(mainColor.a<u_AlphaTestValue)\r\n\t\t\tdiscard;\r\n\t#endif\r\n  \r\n\t\r\n\tvec3 diffuse = vec3(0.0);\r\n\tvec3 specular= vec3(0.0);\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 dif,spe;\r\n\t\t#ifdef SPECULARMAP\r\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\r\n\t\t#else\r\n\t\t\t#ifdef DIFFUSEMAP\r\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\r\n\t\t\t#else\r\n\t\t\t\tvec3 gloss=vec3(1.0);\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t\r\n\t\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t#else\r\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t#endif\r\n\t\t\t\tfloat shadowAttenuation=sampleShadowmap(shadowCoord);\r\n\t\t\t\tdif *= shadowAttenuation;\r\n\t\t\t\tspe *= shadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\tfloat spotShadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\tdif *= spotShadowAttenuation;\r\n\t\t\t\tspe *= spotShadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t{\r\n\t\t\t\tif(i >= u_DirationLightCount)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\r\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t\t\t#endif\r\n\t\t\t\t\t\tdirectionLight.color *= sampleShadowmap(shadowCoord);\r\n\t\t\t\t\t}\r\n\t\t\t\t#endif\r\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,dif,spe);\r\n\t\t\t\tdiffuse+=dif;\r\n\t\t\t\tspecular+=spe;\r\n\t\t\t}\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\r\n\t\t\t#ifdef POINTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\t#ifdef SPOTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\t\t\t\tspotLight.color *= sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t#endif\r\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tgl_FragColor.rgb+=specular;\r\n\t#endif\r\n\t  \r\n\t#ifdef FOG\r\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\r\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\r\n\t#endif\r\n}\r\n\r\n';var Di='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl"\r\n#include "Shadow.glsl";\r\n\r\n\r\nattribute vec4 a_Position;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\r\n\tattribute vec2 a_Texcoord0;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#if defined(LIGHTMAP)&&defined(UV1)\r\n\tattribute vec2 a_Texcoord1;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tuniform vec4 u_LightmapScaleOffset;\r\n\tvarying vec2 v_LightMapUV;\r\n#endif\r\n\r\n#ifdef COLOR\r\n\tattribute vec4 a_Color;\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\nattribute vec3 a_Normal;\r\nvarying vec3 v_Normal; \r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tuniform vec3 u_CameraPos;\r\n\tvarying vec3 v_ViewDir; \r\n#endif\r\n\r\n#if defined(NORMALMAP)\r\n\tattribute vec4 a_Tangent0;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_WorldMat;\r\n#else\r\n\tuniform mat4 u_WorldMat;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\t\r\n\tmat4 worldMat;\r\n\t#ifdef GPU_INSTANCE\r\n\t\tworldMat = a_WorldMat;\r\n\t#else\r\n\t\tworldMat = u_WorldMat;\r\n\t#endif\r\n\r\n\tmat3 worldInvMat;\r\n\t#ifdef BONE\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\r\n\t#else\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\r\n\t#endif  \r\n\tv_Normal=normalize(a_Normal*worldInvMat);\r\n\t#if defined(NORMALMAP)\r\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\r\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\tvec3 positionWS=(worldMat*position).xyz;\r\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\t\tv_PositionWorld = positionWS;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\t\t#ifdef TILINGOFFSET\r\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t\t#else\r\n\t\t\tv_Texcoord0=a_Texcoord0;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef LIGHTMAP\r\n\t\t#ifdef UV1\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#else\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#endif \r\n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\r\n\t#endif\r\n\r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tv_Color=a_Color;\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\r\n\t#endif\r\n\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var wi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "ShadowCasterFS.glsl"\r\n\r\nvoid main()\r\n{\r\n\tgl_FragColor=shadowCasterFragment();\r\n}';var Pi='#include "ShadowCasterVS.glsl"\r\n\r\nvoid main()\r\n{\r\n\tvec4 positionCS =  shadowCasterVertex();\r\n\tgl_Position=remapGLPositionZ(positionCS);\r\n}';var Oi="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n  precision highp float;\r\n#else\r\n  precision mediump float;\r\n#endif\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\nuniform sampler2D u_texture;\r\nuniform vec4 u_Tintcolor;\r\n\r\n#ifdef RENDERMODE_MESH\r\n\tvarying vec4 v_MeshColor;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\t#ifdef ADDTIVEFOG\r\n\t#else\r\n\t\tuniform vec3 u_FogColor;\r\n\t#endif\r\n#endif\r\n\r\n\r\nvoid main()\r\n{\t\r\n\t#ifdef RENDERMODE_MESH\r\n\t\tgl_FragColor=v_MeshColor;\r\n\t#else\r\n\t\tgl_FragColor=vec4(1.0);\t\r\n\t#endif\r\n\t\t\r\n\t#ifdef DIFFUSEMAP\r\n\t\t#ifdef TINTCOLOR\r\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\r\n\t\t#else\r\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef TINTCOLOR\r\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\r\n\t\t#else\r\n\t\t\tgl_FragColor*=v_Color;\r\n\t\t#endif\r\n\t#endif\r\n\t\r\n\t#ifdef FOG\r\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\r\n\t\t#ifdef ADDTIVEFOG\r\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\r\n\t\t#else\r\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\r\n\t\t#endif\r\n\t#endif\r\n}";var Ni='// #include "Lighting.glsl";\r\n\r\n//修改这里剔除没有用到的光照函数，增加粒子的编译速度\r\nvec2 TransformUV(vec2 texcoord,vec4 tilingOffset) {\r\n\tvec2 transTexcoord=vec2(texcoord.x,texcoord.y-1.0)*tilingOffset.xy+vec2(tilingOffset.z,-tilingOffset.w);\r\n\ttransTexcoord.y+=1.0;\r\n\treturn transTexcoord;\r\n}\r\n\r\nvec4 remapGLPositionZ(vec4 position) {\r\n\tposition.z=position.z * 2.0 - position.w;\r\n\treturn position;\r\n}\r\n\r\n#if defined(GL_FRAGMENT_PRECISION_HIGH)\r\n  precision highp float;\r\n#else\r\n  precision mediump float;\r\n#endif\r\n\r\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\r\n\tattribute vec4 a_CornerTextureCoordinate;\r\n#endif\r\n#ifdef RENDERMODE_MESH\r\n\tattribute vec3 a_MeshPosition;\r\n\tattribute vec4 a_MeshColor;\r\n\tattribute vec2 a_MeshTextureCoordinate;\r\n\tvarying vec4 v_MeshColor;\r\n#endif\r\n\r\nattribute vec4 a_ShapePositionStartLifeTime;\r\nattribute vec4 a_DirectionTime;\r\nattribute vec4 a_StartColor;\r\nattribute vec3 a_StartSize;\r\nattribute vec3 a_StartRotation0;\r\nattribute float a_StartSpeed;\r\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\n  attribute vec4 a_Random0;\r\n#endif\r\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n  attribute vec4 a_Random1;\r\n#endif\r\nattribute vec3 a_SimulationWorldPostion;\r\nattribute vec4 a_SimulationWorldRotation;\r\n\r\nvarying vec4 v_Color;\r\n#ifdef DIFFUSEMAP\r\n\tvarying vec2 v_TextureCoordinate;\r\n#endif\r\n\r\nuniform float u_CurrentTime;\r\nuniform vec3 u_Gravity;\r\n\r\nuniform vec3 u_WorldPosition;\r\nuniform vec4 u_WorldRotation;\r\nuniform bool u_ThreeDStartRotation;\r\nuniform int u_ScalingMode;\r\nuniform vec3 u_PositionScale;\r\nuniform vec3 u_SizeScale;\r\nuniform mat4 u_View;\r\nuniform mat4 u_Projection;\r\n\r\n#ifdef STRETCHEDBILLBOARD\r\n\tuniform vec3 u_CameraPos;\r\n#endif\r\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\r\nuniform vec3 u_CameraUp;\r\n\r\nuniform  float u_StretchedBillboardLengthScale;\r\nuniform  float u_StretchedBillboardSpeedScale;\r\nuniform int u_SimulationSpace;\r\n\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n  uniform  int  u_VOLSpaceType;\r\n#endif\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\r\n  uniform  vec3 u_VOLVelocityConst;\r\n#endif\r\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\r\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\r\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\r\n#endif\r\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n  uniform  vec3 u_VOLVelocityConstMax;\r\n#endif\r\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\r\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\r\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\r\n#endif\r\n\r\n#ifdef COLOROVERLIFETIME\r\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\r\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\r\n#endif\r\n#ifdef RANDOMCOLOROVERLIFETIME\r\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\r\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\r\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\r\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\r\n#endif\r\n\r\n\r\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\r\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\r\n#endif\r\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\r\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\r\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\r\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\r\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\r\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\r\n#endif\r\n\r\n\r\n#ifdef ROTATIONOVERLIFETIME\r\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\r\n    uniform  float u_ROLAngularVelocityConst;\r\n  #endif\r\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    uniform  float u_ROLAngularVelocityConstMax;\r\n  #endif\r\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\r\n  #endif\r\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\r\n  #endif\r\n#endif\r\n#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\r\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\r\n  #endif\r\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\r\n  #endif\r\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\r\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\r\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\r\n  #endif\r\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\r\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\r\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\r\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\r\n  #endif\r\n#endif\r\n\r\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\r\n  uniform  float u_TSACycles;\r\n  uniform  vec2 u_TSASubUVLength;\r\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\r\n#endif\r\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\r\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\r\n#endif\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\r\n{\r\n\tfloat halfRoll = rot.z * 0.5;\r\n    float halfPitch = rot.x * 0.5;\r\n\tfloat halfYaw = rot.y * 0.5;\r\n\r\n\tfloat sinRoll = sin(halfRoll);\r\n\tfloat cosRoll = cos(halfRoll);\r\n\tfloat sinPitch = sin(halfPitch);\r\n\tfloat cosPitch = cos(halfPitch);\r\n\tfloat sinYaw = sin(halfYaw);\r\n\tfloat cosYaw = cos(halfYaw);\r\n\r\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\r\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\r\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\r\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\r\n\t\r\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\r\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\r\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\r\n\t\r\n\tfloat x = quaX + quaX;\r\n    float y = quaY + quaY;\r\n    float z = quaZ + quaZ;\r\n    float wx = quaW * x;\r\n    float wy = quaW * y;\r\n    float wz = quaW * z;\r\n\tfloat xx = quaX * x;\r\n    float xy = quaX * y;\r\n\tfloat xz = quaX * z;\r\n    float yy = quaY * y;\r\n    float yz = quaY * z;\r\n    float zz = quaZ * z;\r\n\r\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\r\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\r\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\r\n\t\r\n}\r\n\r\n//假定axis已经归一化\r\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\r\n{\r\n\tfloat halfAngle = angle * 0.5;\r\n\tfloat sin = sin(halfAngle);\r\n\t\r\n\tfloat quaX = axis.x * sin;\r\n\tfloat quaY = axis.y * sin;\r\n\tfloat quaZ = axis.z * sin;\r\n\tfloat quaW = cos(halfAngle);\r\n\t\r\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\r\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\r\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\r\n\t\r\n\tfloat x = quaX + quaX;\r\n    float y = quaY + quaY;\r\n    float z = quaZ + quaZ;\r\n    float wx = quaW * x;\r\n    float wy = quaW * y;\r\n    float wz = quaW * z;\r\n\tfloat xx = quaX * x;\r\n    float xy = quaX * y;\r\n\tfloat xz = quaX * z;\r\n    float yy = quaY * y;\r\n    float yz = quaY * z;\r\n    float zz = quaZ * z;\r\n\r\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\r\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\r\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\r\n\t\r\n}\r\n\r\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \r\n{\r\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\r\n}\r\n\r\n \r\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\r\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\r\n{\r\n\tfloat curValue;\r\n\tfor(int i=1;i<4;i++)\r\n\t{\r\n\t\tvec2 gradientNumber=gradientNumbers[i];\r\n\t\tfloat key=gradientNumber.x;\r\n\t\tif(key>=normalizedAge)\r\n\t\t{\r\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\r\n\t\t\tfloat lastKey=lastGradientNumber.x;\r\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\r\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn curValue;\r\n}\r\n#endif\r\n\r\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\r\n{\r\n\tfloat totalValue=0.0;\r\n\tfor(int i=1;i<4;i++)\r\n\t{\r\n\t\tvec2 gradientNumber=gradientNumbers[i];\r\n\t\tfloat key=gradientNumber.x;\r\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\r\n\t\tfloat lastValue=lastGradientNumber.y;\r\n\t\t\r\n\t\tif(key>=normalizedAge){\r\n\t\t\tfloat lastKey=lastGradientNumber.x;\r\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\r\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\telse{\r\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\r\n\t\t}\r\n\t}\r\n\treturn totalValue;\r\n}\r\n#endif\r\n\r\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\r\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\r\n{\r\n\tvec4 overTimeColor;\r\n\tfor(int i=1;i<4;i++)\r\n\t{\r\n\t\tvec2 gradientAlpha=gradientAlphas[i];\r\n\t\tfloat alphaKey=gradientAlpha.x;\r\n\t\tif(alphaKey>=normalizedAge)\r\n\t\t{\r\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\r\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\r\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\r\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfor(int i=1;i<4;i++)\r\n\t{\r\n\t\tvec4 gradientColor=gradientColors[i];\r\n\t\tfloat colorKey=gradientColor.x;\r\n\t\tif(colorKey>=normalizedAge)\r\n\t\t{\r\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\r\n\t\t\tfloat lastColorKey=lastGradientColor.x;\r\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\r\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn overTimeColor;\r\n}\r\n#endif\r\n\r\n\r\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\r\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\r\n{\r\n\tfloat overTimeFrame;\r\n\tfor(int i=1;i<4;i++)\r\n\t{\r\n\t\tvec2 gradientFrame=gradientFrames[i];\r\n\t\tfloat key=gradientFrame.x;\r\n\t\tif(key>=normalizedAge)\r\n\t\t{\r\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\r\n\t\t\tfloat lastKey=lastGradientFrame.x;\r\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\r\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn floor(overTimeFrame);\r\n}\r\n#endif\r\n\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nvec3 computeParticleLifeVelocity(in float normalizedAge)\r\n{\r\n  vec3 outLifeVelocity;\r\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\r\n\t outLifeVelocity=u_VOLVelocityConst; \r\n  #endif\r\n  #ifdef VELOCITYOVERLIFETIMECURVE\r\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\r\n  #endif\r\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \r\n  #endif\r\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\r\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\r\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\r\n  #endif\r\n\t\t\t\t\t\r\n  return outLifeVelocity;\r\n} \r\n#endif\r\n\r\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\r\n{\r\n   vec3 startPosition;\r\n   vec3 lifePosition;\r\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\r\n\t\t  startPosition=startVelocity*age;\r\n\t\t  lifePosition=lifeVelocity*age;\r\n\t#endif\r\n\t#ifdef VELOCITYOVERLIFETIMECURVE\r\n\t\t  startPosition=startVelocity*age;\r\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\r\n\t#endif\r\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n\t\t  startPosition=startVelocity*age;\r\n\t\t  lifePosition=lifeVelocity*age;\r\n\t#endif\r\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n\t\t  startPosition=startVelocity*age;\r\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\r\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\r\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\r\n\t#endif\r\n\t\r\n\tvec3 finalPosition;\r\n\tif(u_VOLSpaceType==0){\r\n\t  if(u_ScalingMode!=2)\r\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\r\n\t  else\r\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\r\n\t}\r\n\telse{\r\n\t  if(u_ScalingMode!=2)\r\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\r\n\t  else\r\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\r\n\t}\r\n  #else\r\n\t startPosition=startVelocity*age;\r\n\t vec3 finalPosition;\r\n\t if(u_ScalingMode!=2)\r\n\t\t\tfinalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\r\n\t else\r\n\t   \tfinalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\r\n  #endif\r\n  \r\n  if(u_SimulationSpace==0)\r\n    finalPosition=finalPosition+a_SimulationWorldPostion;\r\n  else if(u_SimulationSpace==1) \r\n    finalPosition=finalPosition+u_WorldPosition;\r\n  \r\n  finalPosition+=0.5*gravityVelocity*age;\r\n \r\n  return  finalPosition;\r\n}\r\n\r\n\r\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\r\n{\r\n\t#ifdef COLOROVERLIFETIME\r\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\r\n\t#endif\r\n\t\r\n\t#ifdef RANDOMCOLOROVERLIFETIME\r\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\r\n\t#endif\r\n\r\n    return color;\r\n}\r\n\r\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\r\n{\r\n\t#ifdef SIZEOVERLIFETIMECURVE\r\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\r\n\t#endif\r\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \r\n\t#endif\r\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\r\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\r\n\t#endif\r\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\r\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\r\n\t#endif\r\n\treturn size;\r\n}\r\n\r\n#ifdef RENDERMODE_MESH\r\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\r\n{\r\n\t#ifdef SIZEOVERLIFETIMECURVE\r\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\r\n\t#endif\r\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \r\n\t#endif\r\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\r\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\r\n\t#endif\r\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\r\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\r\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\r\n\t#endif\r\n\treturn size;\r\n}\r\n#endif\r\n\r\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\r\n{ \r\n\t#ifdef ROTATIONOVERLIFETIME\r\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\r\n\t        rotation+=ageRot;\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\r\n\t        rotation+=ageRot;\r\n\t    #endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\r\n\t\t#endif\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\r\n\t        rotation+=ageRot;\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\r\n\t        rotation+=ageRot;\r\n\t    #endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\r\n\t\t#endif\r\n\t#endif\r\n\treturn rotation;\r\n}\r\n\r\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\r\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\r\n{ \r\n\t#ifdef ROTATIONOVERLIFETIME\r\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\r\n\t        rotation+=ageRot;\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\r\n\t        rotation+=ageRot;\r\n\t    #endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\r\n\t\t#endif\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\r\n\t        rotation+=ageRot;\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\r\n\t\t#endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\r\n\t        rotation+=ageRot;\r\n\t    #endif\r\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\r\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\r\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\r\n\t\t#endif\r\n\t#endif\r\n\treturn rotation;\r\n}\r\n#endif\r\n\r\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\r\n{ \r\n\t#ifdef TEXTURESHEETANIMATIONCURVE\r\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\r\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\r\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\r\n\t\tfloat floorTotalULength=floor(totalULength);\r\n\t    uv.x+=totalULength-floorTotalULength;\r\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\r\n    #endif\r\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\r\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\r\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\r\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\r\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\r\n\t\tfloat floorTotalULength=floor(totalULength);\r\n\t    uv.x+=totalULength-floorTotalULength;\r\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\r\n    #endif\r\n\treturn uv;\r\n}\r\n\r\nvoid main()\r\n{\r\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\r\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\r\n\tvec3 lifeVelocity;\r\n\tif(normalizedAge<1.0)\r\n\t{ \r\n\t\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\r\n\t\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\r\n\t\t#endif \r\n\t\tvec3 gravityVelocity=u_Gravity*age;\r\n\t\t\r\n\t\tvec4 worldRotation;\r\n\t\tif(u_SimulationSpace==0)\r\n\t\t\tworldRotation=a_SimulationWorldRotation;\r\n\t\telse\r\n\t\t\tworldRotation=u_WorldRotation;\r\n\t\t\r\n\t\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\r\n\t\r\n\t\r\n\t\t#ifdef SPHERHBILLBOARD\r\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\r\n\t\t\tvec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\r\n\t\t\tvec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\r\n\t\t\tvec3 upVector = normalize(cross(sideVector,u_CameraDirection));\r\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\r\n\t\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\r\n\t\t\t\tif(u_ThreeDStartRotation){\r\n\t\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\r\n\t\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\r\n\t\t\t\t\tfloat c = cos(rot);\r\n\t\t\t\t\tfloat s = sin(rot);\r\n\t\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\r\n\t\t\t\t\tcorner=rotation*corner;\r\n\t\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\r\n\t\t\t\t}\r\n\t\t\t#else\r\n\t\t\t\tif(u_ThreeDStartRotation){\r\n\t\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tfloat c = cos(a_StartRotation0.x);\r\n\t\t\t\t\tfloat s = sin(a_StartRotation0.x);\r\n\t\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\r\n\t\t\t\t\tcorner=rotation*corner;\r\n\t\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef STRETCHEDBILLBOARD\r\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\r\n\t\t\tvec3 velocity;\r\n\t\t\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t\t\t\tif(u_VOLSpaceType==0)\r\n\t\t\t\tvelocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\r\n\t\t\t\telse\r\n\t\t\t\tvelocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\r\n\t\t\t#else\r\n\t\t\t\tvelocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\r\n\t\t\t#endif\t\r\n\t\t\tvec3 cameraUpVector = normalize(velocity);\r\n\t\t\tvec3 direction = normalize(center-u_CameraPos);\r\n\t\t\tvec3 sideVector = normalize(cross(direction,normalize(velocity)));\r\n\t\t\t\r\n\t\t\tsideVector=u_SizeScale.xzy*sideVector;\r\n\t\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\r\n\t\t\t\r\n\t\t\tvec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\r\n\t\t\t\r\n\t\t\tconst mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\r\n\t\t\tcorner=rotaionZHalfPI*corner;\r\n\t\t\tcorner.y=corner.y-abs(corner.y);\r\n\t\t\t\r\n\t\t\tfloat speed=length(velocity);//TODO:\r\n\t\t\tcenter +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef HORIZONTALBILLBOARD\r\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\r\n\t\t\tconst vec3 cameraUpVector=vec3(0.0,0.0,1.0);\r\n\t\t\tconst vec3 sideVector = vec3(-1.0,0.0,0.0);\r\n\t\t\t\r\n\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\r\n\t\t\tfloat c = cos(rot);\r\n\t\t\tfloat s = sin(rot);\r\n\t\t\tmat2 rotation= mat2(c, -s, s, c);\r\n\t\t\tcorner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\r\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\r\n\t\t\tcenter +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef VERTICALBILLBOARD\r\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\r\n\t\t\tconst vec3 cameraUpVector =vec3(0.0,1.0,0.0);\r\n\t\t\tvec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\r\n\t\t\t\r\n\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\r\n\t\t\tfloat c = cos(rot);\r\n\t\t\tfloat s = sin(rot);\r\n\t\t\tmat2 rotation= mat2(c, -s, s, c);\r\n\t\t\tcorner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\r\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\r\n\t\t\tcenter +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef RENDERMODE_MESH\r\n\t\t\tvec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\r\n\t\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\r\n\t\t\t\tif(u_ThreeDStartRotation){\r\n\t\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\r\n\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t#ifdef ROTATIONOVERLIFETIME\r\n\t\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\r\n\t\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\r\n\t\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t#ifdef SHAPE\r\n\t\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\r\n\t\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\t\tif(u_SimulationSpace==0)\r\n\t\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\r\n\t\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\r\n\t\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\r\n\t\t\t\t\t\t\t#endif\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t#endif\r\n\t\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\r\n\t\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,-a_StartRotation0.x), age,normalizedAge);\r\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\r\n\t\t\t\t\t#endif\t\t\r\n\t\t\t\t}\r\n\t\t\t#else\r\n\t\t\t\tif(u_ThreeDStartRotation){\r\n\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\r\n\t\t\t\t\t\tif(u_SimulationSpace==0)\r\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\r\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\r\n\t\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t#ifdef SHAPE\r\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\r\n\t\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\r\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\r\n\t\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\r\n\t\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\r\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\r\n\t\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\r\n\t\t\t\t\t\t#endif\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\tv_MeshColor=a_MeshColor;\r\n\t\t#endif\r\n\t\r\n\t\tgl_Position=u_Projection*u_View*vec4(center,1.0);\r\n\t\tv_Color = computeParticleColor(a_StartColor, normalizedAge);\r\n\t\t#ifdef DIFFUSEMAP\r\n\t\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\r\n\t\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\r\n\t\t\t#endif\r\n\t\t\t#ifdef RENDERMODE_MESH\r\n\t\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\r\n\t\t\t#endif\r\n\t\t\t\r\n\t\t\t#ifdef TILINGOFFSET\r\n\t\t\t\tv_TextureCoordinate=TransformUV(v_TextureCoordinate,u_TilingOffset);\r\n\t\t\t#endif\r\n\t\t#endif\r\n   \t}\r\n   \telse\r\n\t{\r\n\t\tgl_Position=vec4(2.0,2.0,2.0,1.0);//Discard use out of X(-1,1),Y(-1,1),Z(0,1)\r\n\t}\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}\r\n\r\n';var Bi='// allow to explicitly override LAYA_BRDF_GI and LAYA_BRDF_LIGHT in custom shader,default is layaBRDFHighGI and layaBRDFHighLight\r\n#if !defined (LAYA_BRDF_GI) \r\n\t#if defined(LAYA_PBR_BRDF_LOW)\r\n\t\t#define LAYA_BRDF_GI layaBRDFLowGI\r\n\t#elif defined(LAYA_PBR_BRDF_HIGH)\r\n\t\t#define LAYA_BRDF_GI layaBRDFHighGI\r\n\t#endif\r\n#endif\r\n#if !defined (LAYA_BRDF_LIGHT)\r\n\t#if defined(LAYA_PBR_BRDF_LOW)\r\n\t\t#define LAYA_BRDF_LIGHT layaBRDFLowLight\r\n\t#elif defined(LAYA_PBR_BRDF_HIGH)\r\n\t\t#define LAYA_BRDF_LIGHT layaBRDFHighLight\r\n\t#endif\r\n#endif\r\n\r\n#define PI 3.14159265359\r\n#define INV_PI 0.31830988618\r\n\r\nmediump float pow4(mediump float x)\r\n{\r\n\treturn x * x * x * x;\r\n}\r\n\r\nmediump float pow5(mediump float x)\r\n{\r\n\treturn x * x * x * x * x;\r\n}\r\n\r\nmediump vec3 fresnelLerp(mediump vec3 F0,mediump vec3 F90,mediump float cosA)\r\n{\r\n\tfloat t = pow5(1.0 - cosA);   // ala Schlick interpoliation\r\n\treturn mix(F0, F90, t);\r\n}\r\n\r\nmediump vec3 fresnelTerm(mediump vec3 F0,mediump float cosA)\r\n{\r\n\tfloat t = pow5(1.0 - cosA);   // ala Schlick interpoliation\r\n\treturn F0 + (vec3(1.0) - F0) * t;\r\n}\r\n\r\n// approximage Schlick with ^4 instead of ^5\r\nmediump vec3 fresnelLerpFast (mediump vec3 F0, mediump vec3 F90,mediump float cosA)\r\n{\r\n    mediump float t = pow4 (1.0 - cosA);\r\n    return mix (F0, F90, t);\r\n}\r\n\r\nfloat smoothnessToPerceptualRoughness(float smoothness)\r\n{\r\n    return 1.0 - smoothness;\r\n}\r\n\r\nfloat perceptualRoughnessToRoughness(float perceptualRoughness)\r\n{\r\n    return perceptualRoughness * perceptualRoughness;\r\n}\r\n\r\nvec3 safeNormalize(vec3 inVec)\r\n{\r\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\r\n\treturn inVec * inversesqrt(dp3);\r\n}\r\n\r\n// Note: Disney diffuse must be multiply by diffuseAlbedo / PI. This is done outside of this function.\r\nmediump float disneyDiffuse(mediump float NdotV,mediump float NdotL,mediump float LdotH,mediump float perceptualRoughness)\r\n{\r\n\t//https://www.cnblogs.com/herenzhiming/articles/5790389.html\r\n\tmediump float fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\r\n\t// Two schlick fresnel term\r\n\tmediump float lightScatter = (1.0 + (fd90 - 1.0) * pow5(1.0 - NdotL));\r\n\tmediump float viewScatter = (1.0 + (fd90 - 1.0) * pow5(1.0 - NdotV));\r\n\r\n\treturn lightScatter * viewScatter;\r\n}\r\n\r\n// Ref: http://jcgt.org/published/0003/02/03/paper.pdf\r\nfloat smithJointGGXVisibilityTerm(float NdotL, float NdotV, float roughness)\r\n{\r\n\t// Original formulation:\r\n    // lambda_v    = (-1 + sqrt(a2 * (1 - NdotL2) / NdotL2 + 1)) * 0.5f;\r\n    // lambda_l    = (-1 + sqrt(a2 * (1 - NdotV2) / NdotV2 + 1)) * 0.5f;\r\n    // G           = 1 / (1 + lambda_v + lambda_l);\r\n\r\n\t// scientific code implement:\r\n\t// Reorder code to be more optimal\r\n    // half a          = roughness;\r\n    // half a2         = a * a;\r\n\r\n    // half lambdaV    = NdotL * sqrt((-NdotV * a2 + NdotV) * NdotV + a2);\r\n    // half lambdaL    = NdotV * sqrt((-NdotL * a2 + NdotL) * NdotL + a2);\r\n\r\n    // Simplify visibility term: (2.0f * NdotL * NdotV) /  ((4.0f * NdotL * NdotV) * (lambda_v + lambda_l + 1e-5f));\r\n    // return 0.5f / (lambdaV + lambdaL + 1e-5f);  \r\n\t// This function is not intended to be running on Mobile,therefore epsilon is smaller than can be represented by half\r\n\r\n\t// Approximation of the above formulation (simplify the sqrt, not mathematically correct but close enough)\r\n\tfloat a = roughness;\r\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\r\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\r\n\treturn 0.5 / (lambdaV + lambdaL + 1e-5);\r\n}\r\n\r\nfloat ggxTerm(float NdotH, float roughness)\r\n{\r\n\tfloat a2 = roughness * roughness;\r\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0; // 2 mad\r\n\treturn INV_PI * a2 / (d * d + 1e-7); // This function is not intended to be running on Mobile,therefore epsilon is smaller than what can be represented by half//返回值小用half来返回\r\n}\r\n\r\n// BRDF1-------------------------------------------------------------------------------------\r\n\r\n// Note: BRDF entry points use smoothness and oneMinusReflectivity for optimization purposes,\r\n// mostly for DX9 SM2.0 level. Most of the math is being done on these (1-x) values, and that saves a few precious ALU slots.\r\n\r\n// Main Physically Based BRDF\r\n// Derived from Disney work and based on Torrance-Sparrow micro-facet model\r\n//\r\n// BRDF = kD / pi + kS * (D * V * F) / 4\r\n// I = BRDF * NdotL\r\n//\r\n// *NDF GGX:\r\n// *Smith for Visiblity term\r\n// *Schlick approximation for Fresnel\r\nmediump vec4 layaBRDFHighLight(mediump vec3 diffColor, mediump vec3 specColor, mediump float oneMinusReflectivity, float perceptualRoughness,float roughness,mediump float nv,vec3 normal, vec3 viewDir,LayaLight light)\r\n{\r\n\tvec3 halfDir = safeNormalize(viewDir-light.dir);\r\n\r\n\tfloat nl = clamp(dot(normal, -light.dir),0.0,1.0);\r\n\tfloat nh = clamp(dot(normal, halfDir),0.0,1.0);\r\n\tmediump float lv = clamp(dot(light.dir, viewDir),0.0,1.0);\r\n\tmediump float lh = clamp(dot(light.dir, -halfDir),0.0,1.0);\r\n\r\n\t// Diffuse term\r\n\tmediump float diffuseTerm = disneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\r\n\r\n\t// Specular term\r\n    // HACK: theoretically we should divide diffuseTerm by Pi and not multiply specularTerm!\r\n    // BUT that will make shader look significantly darker than Legacy ones\r\n\r\n\t// GGX with roughtness to 0 would mean no specular at all, using max(roughness, 0.002) here to match HDrenderloop roughtness remapping.\r\n\troughness = max(roughness, 0.002);\r\n\tfloat V = smithJointGGXVisibilityTerm(nl, nv, roughness);\r\n\tfloat D = ggxTerm(nh, roughness);\r\n\r\n\tfloat specularTerm = V * D * PI; // Torrance-Sparrow model, Fresnel is applied later\r\n\r\n\t//#ifdef LAYA_COLORSPACE_GAMMA\r\n\tspecularTerm = sqrt(max(1e-4, specularTerm));\r\n\t//#endif\r\n\tspecularTerm = max(0.0, specularTerm * nl);\r\n\t\t\r\n\tmediump vec3 color = diffColor * light.color * diffuseTerm + specularTerm * light.color * fresnelTerm(specColor, lh);\r\n\treturn vec4(color, 1.0);\r\n}\r\n\r\nvec4 layaBRDFHighGI(mediump vec3 diffColor,mediump vec3 specColor,mediump float oneMinusReflectivity,float smoothness ,float perceptualRoughness,float roughness,mediump float nv,vec3 normal, vec3 viewDir,LayaGI gi)\r\n{\r\n\t// surfaceReduction = Int D(NdotH) * NdotH * Id(NdotL>0) dH = 1/(roughness^2+1)\r\n\tfloat surfaceReduction;\r\n\tsurfaceReduction = 1.0 - 0.28*roughness*perceptualRoughness;// 1-0.28*x^3 as approximation for (1/(x^4+1))^(1/2.2) on the domain [0;1]\r\n\tfloat grazingTerm = clamp(smoothness + (1.0 - oneMinusReflectivity),0.0,1.0);\r\n\tmediump vec3 color =diffColor * gi.diffuse + surfaceReduction * gi.specular * fresnelLerp(specColor,vec3(grazingTerm), nv);\r\n\treturn vec4(color,1.0);\r\n}\r\n// BRDF1-------------------------------------------------------------------------------------\r\n\r\n\r\n// BRDF2-------------------------------------------------------------------------------------\r\n// Based on Minimalist CookTorrance BRDF\r\n// Implementation is slightly different from original derivation: http://www.thetenthplanet.de/archives/255\r\n//\r\n// *NDF [Modified] GGX:\r\n// *Modified Kelemen and Szirmay-​Kalos for Visibility term\r\n// *Fresnel approximated with 1/LdotH\r\nmediump vec4 layaBRDFLowLight (mediump vec3 diffColor, mediump vec3 specColor,mediump float oneMinusReflectivity,float perceptualRoughness,float roughness,mediump float nv,vec3 normal,vec3 viewDir,LayaLight light)\r\n{\r\n    vec3 halfDir = safeNormalize (viewDir-light.dir);\r\n    mediump float nl = clamp(dot(normal, -light.dir),0.0,1.0);\r\n    float nh = clamp(dot(normal, halfDir),0.0,1.0);\r\n    float lh = clamp(dot(-light.dir, halfDir),0.0,1.0);\r\n\r\n    // GGX Distribution multiplied by combined approximation of Visibility and Fresnel\r\n    // See "Optimizing PBR for Mobile" from Siggraph 2015 moving mobile graphics course\r\n    // https://community.arm.com/events/1155\r\n    mediump float a = roughness;\r\n    float a2 = a*a;\r\n\r\n    float d = nh * nh * (a2 - 1.0) + 1.00001;\r\n\t// #ifdef LAYA_COLORSPACE_GAMMA\r\n\t\t// Tighter approximation for Gamma only rendering mode!\r\n\t\t// DVF = sqrt(DVF);\r\n\t\t// DVF = (a * sqrt(.25)) / (max(sqrt(0.1), lh)*sqrt(roughness + .5) * d);\r\n\t\tfloat specularTerm = a / (max(0.32, lh) * (1.5 + roughness) * d);\r\n\t// #else\r\n\t// \tfloat specularTerm = a2 / (max(0.1f, lh*lh) * (roughness + 0.5f) * (d * d) * 4);\r\n\t// #endif\r\n\r\n    // on mobiles (where half actually means something) denominator have risk of overflow\r\n    // clamp below was added specifically to "fix" that, but dx compiler (we convert bytecode to metal/gles)\r\n    // sees that specularTerm have only non-negative terms, so it skips max(0,..) in clamp (leaving only min(100,...))\r\n\r\n\t//#if defined (SHADER_API_MOBILE)\r\n    specularTerm = specularTerm - 1e-4;\r\n\t//#endif\r\n\r\n\t// #else\r\n\t\t// // Legacy\r\n\t\t// half specularPower = PerceptualRoughnessToSpecPower(perceptualRoughness);\r\n\t\t// // Modified with approximate Visibility function that takes roughness into account\r\n\t\t// // Original ((n+1)*N.H^n) / (8*Pi * L.H^3) didn\'t take into account roughness\r\n\t\t// // and produced extremely bright specular at grazing angles\r\n\r\n\t\t// half invV = lh * lh * smoothness + perceptualRoughness * perceptualRoughness; // approx ModifiedKelemenVisibilityTerm(lh, perceptualRoughness);\r\n\t\t// half invF = lh;\r\n\r\n\t\t// half specularTerm = ((specularPower + 1) * pow (nh, specularPower)) / (8 * invV * invF + 1e-4h);\r\n\r\n\t\t// #ifdef LAYA_COLORSPACE_GAMMA\r\n\t\t// \tspecularTerm = sqrt(max(1e-4f, specularTerm));\r\n\t\t// #endif\r\n\t// #endif\r\n\r\n\t// #if defined (SHADER_API_MOBILE)\r\n\t\tspecularTerm = clamp(specularTerm, 0.0, 100.0); // Prevent FP16 overflow on mobiles\r\n\t// #endif\r\n    \r\n    mediump vec3 color = (diffColor + specularTerm * specColor) * light.color * nl;\r\n\r\n    return vec4(color, 1.0);\r\n}\r\n\r\nmediump vec4 layaBRDFLowGI (mediump vec3 diffColor, mediump vec3 specColor,mediump float oneMinusReflectivity,mediump float smoothness,float perceptualRoughness,float roughness,mediump float nv,vec3 normal,vec3 viewDir,LayaGI gi)\r\n{\r\n\t// surfaceReduction = Int D(NdotH) * NdotH * Id(NdotL>0) dH = 1/(realRoughness^2+1)\r\n\r\n    // 1-0.28*x^3 as approximation for (1/(x^4+1))^(1/2.2) on the domain [0;1]\r\n    // 1-x^3*(0.6-0.08*x)   approximation for 1/(x^4+1)\r\n\t// #ifdef LAYA_COLORSPACE_GAMMA\r\n\t\tmediump float surfaceReduction = 0.28;\r\n\t// #else\r\n\t\t// mediump float surfaceReduction = (0.6-0.08*perceptualRoughness);\r\n\t// #endif\r\n\r\n    surfaceReduction = 1.0 - roughness*perceptualRoughness*surfaceReduction;\r\n\r\n\tmediump float grazingTerm = clamp(smoothness + (1.0-oneMinusReflectivity),0.0,1.0);\r\n\tmediump vec3 color =gi.diffuse * diffColor+ surfaceReduction * gi.specular * fresnelLerpFast (specColor, vec3(grazingTerm), nv);\r\n\r\n    return vec4(color, 1.0);\r\n}\r\n// BRDF2-------------------------------------------------------------------------------------';var Fi="struct FragmentCommonData{\r\n\tvec3 diffColor;\r\n\tvec3 specColor;\r\n\tfloat oneMinusReflectivity;\r\n\tfloat smoothness;\r\n\t//vec3 eyeVec;TODO:maybe can remove\r\n\t//float alpha;\r\n\t//vec3 reflUVW;\r\n};\r\n\r\n#if !defined(SETUP_BRDF_INPUT)//shader内部的宏需要将改成#ifdef改成#if类型 不然会被Laya的shader分析器优化掉\r\n    #define SETUP_BRDF_INPUT metallicSetup//default is metallicSetup,also can be other. \r\n#endif\r\n\r\nconst mediump vec4 dielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\r\n\r\nmediump vec3 diffuseAndSpecularFromMetallic(mediump vec3 albedo,mediump float metallic, out mediump vec3 specColor, out mediump float oneMinusReflectivity)\r\n{\r\n\tspecColor = mix(dielectricSpecularColor.rgb, albedo, metallic);\r\n\toneMinusReflectivity= dielectricSpecularColor.a*(1.0-metallic);//diffuse proportion\r\n\treturn albedo * oneMinusReflectivity;\r\n}\r\n\r\nmediump float specularStrength(mediump vec3 specular)\r\n{\r\n    return max (max (specular.r, specular.g), specular.b);\r\n}\r\n\r\n// Diffuse/Spec Energy conservation\r\nmediump vec3 energyConservationBetweenDiffuseAndSpecular (mediump vec3 albedo, mediump vec3 specColor, out mediump float oneMinusReflectivity)\r\n{\r\n\toneMinusReflectivity = 1.0 - specularStrength(specColor);\r\n    return albedo * (vec3(1.0) - specColor);\r\n}\r\n\r\n#ifdef TRANSPARENTBLEND\r\n\tmediump vec3 preMultiplyAlpha (mediump vec3 diffColor, mediump float alpha, mediump float oneMinusReflectivity,out mediump float modifiedAlpha)\r\n\t{\r\n\t\t// Transparency 'removes' from Diffuse component\r\n\t\tdiffColor *= alpha;\r\n\t\t// Reflectivity 'removes' from the rest of components, including Transparency\r\n\t\t// modifiedAlpha = 1.0-(1.0-alpha)*(1.0-reflectivity) = 1.0-(oneMinusReflectivity - alpha*oneMinusReflectivity) = 1.0-oneMinusReflectivity + alpha*oneMinusReflectivity\r\n\t\tmodifiedAlpha = 1.0 - oneMinusReflectivity + alpha*oneMinusReflectivity;\r\n\t\treturn diffColor;\r\n\t}\r\n#endif\r\n\r\nFragmentCommonData metallicSetup(vec2 uv)\r\n{\r\n\tmediump vec2 metallicGloss = getMetallicGloss(uv);\r\n\tmediump float metallic = metallicGloss.x;\r\n\tmediump float smoothness = metallicGloss.y; // this is 1 minus the square root of real roughness m.\r\n\tmediump float oneMinusReflectivity;\r\n\tmediump vec3 specColor;\r\n\tmediump vec3 diffColor = diffuseAndSpecularFromMetallic(albedo(uv), metallic,/*out*/specColor,/*out*/oneMinusReflectivity);\r\n\r\n\tFragmentCommonData o;\r\n\to.diffColor = diffColor;\r\n\to.specColor = specColor;\r\n\to.oneMinusReflectivity = oneMinusReflectivity;\r\n\to.smoothness = smoothness;\r\n\treturn o;\r\n}\r\n\r\nFragmentCommonData specularSetup(vec2 uv)\r\n{\r\n    mediump vec4 specGloss = specularGloss(uv);\r\n    mediump vec3 specColor = specGloss.rgb;\r\n    mediump float smoothness = specGloss.a;\r\n\r\n    mediump float oneMinusReflectivity;\r\n    mediump vec3 diffColor = energyConservationBetweenDiffuseAndSpecular (albedo(uv), specColor, /*out*/ oneMinusReflectivity);\r\n\r\n    FragmentCommonData o;\r\n    o.diffColor = diffColor;\r\n    o.specColor = specColor;\r\n    o.oneMinusReflectivity = oneMinusReflectivity;\r\n    o.smoothness = smoothness;\r\n    return o;\r\n}\r\n\r\nLayaGI fragmentGI(float smoothness,vec3 eyeVec,mediump float occlusion,mediump vec2 lightmapUV,vec3 worldnormal,vec3 worldPos)\r\n{\r\n\tLayaGIInput giInput;\r\n\t#ifdef LIGHTMAP\r\n\t\tgiInput.lightmapUV=lightmapUV;\r\n\t#endif\r\n\tgiInput.worldPos = worldPos;\r\n\r\n\tvec3 worldViewDir = -eyeVec;\r\n\tmediump vec4 uvwRoughness;\r\n\tuvwRoughness.rgb = reflect(worldViewDir, worldnormal);//reflectUVW\r\n\tuvwRoughness.a= smoothnessToPerceptualRoughness(smoothness);//perceptualRoughness\r\n\r\n\treturn layaGlobalIllumination(giInput,occlusion, worldnormal, uvwRoughness);\r\n}\r\n\r\n\r\nvec3 perPixelWorldNormal(vec2 uv,vec3 normal,vec3 binormal,vec3 tangent)\r\n{\r\n\t#ifdef NORMALTEXTURE\r\n\t\tmediump vec3 normalTangent=normalInTangentSpace(uv);\r\n\t\tvec3 normalWorld = normalize(tangent * normalTangent.x + binormal * normalTangent.y + normal * normalTangent.z);\r\n\t#else\r\n\t\tvec3 normalWorld = normalize(normal);\r\n\t#endif\r\n\t\treturn normalWorld;\r\n}\r\n\r\nvoid fragmentForward()\r\n{\r\n\tvec2 uv;\r\n\t#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)\r\n\t\t#ifdef PARALLAXTEXTURE\r\n\t\t\tuv = parallax(v_Texcoord0,normalize(v_ViewDirForParallax));\r\n\t\t#else\r\n\t\t\tuv = v_Texcoord0;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tmediump float alpha = getAlpha(uv);\r\n\t#ifdef ALPHATEST\r\n\t\tif(alpha<u_AlphaTestValue)\r\n\t\t\tdiscard;\r\n\t#endif\r\n\r\n\tFragmentCommonData o = SETUP_BRDF_INPUT(uv);\r\n\t\r\n\tvec3 binormal;\r\n\tvec3 tangent;\r\n\t#ifdef NORMALTEXTURE\r\n\t\ttangent = v_Tangent;\r\n\t\tbinormal = v_Binormal;\r\n\t#endif\r\n\r\n\tvec3 normal = v_Normal;\r\n\tvec3 normalWorld = perPixelWorldNormal(uv,normal,binormal,tangent);//In FS if the normal use mediump before normalize will cause precision prolem in mobile device.\r\n\tvec3 eyeVec = normalize(v_EyeVec);\r\n\tvec3 posworld = v_PositionWorld;\r\n\r\n\t#ifdef TRANSPARENTBLEND\r\n\t\to.diffColor=preMultiplyAlpha(o.diffColor,alpha,o.oneMinusReflectivity,/*out*/alpha);// shader relies on pre-multiply alpha-blend (srcBlend = One, dstBlend = OneMinusSrcAlpha)\r\n\t#endif\r\n\r\n\tmediump float occlusion = getOcclusion(uv);\r\n\tmediump vec2 lightMapUV;\r\n\t#ifdef LIGHTMAP\r\n\t\tlightMapUV=v_LightMapUV;\r\n\t#endif\r\n\tfloat perceptualRoughness = smoothnessToPerceptualRoughness(o.smoothness);\r\n\tfloat roughness = perceptualRoughnessToRoughness(perceptualRoughness);\r\n\tfloat nv = abs(dot(normalWorld, eyeVec));\r\n\tLayaGI gi =fragmentGI(o.smoothness,eyeVec,occlusion,lightMapUV,normalWorld,posworld);\r\n\tvec4 color = LAYA_BRDF_GI(o.diffColor,o.specColor,o.oneMinusReflectivity,o.smoothness,perceptualRoughness,roughness,nv,normalWorld,eyeVec,gi);\r\n\t\r\n\tfloat shadowAttenuation = 1.0;\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t#else\r\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t#endif\r\n\t\t\t\tshadowAttenuation=sampleShadowmap(shadowCoord);\r\n\t\t\t#endif\r\n\t\t\tLayaLight dirLight = layaDirectionLightToLight(u_DirectionLight,shadowAttenuation);\r\n\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,dirLight);\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tshadowAttenuation = 1.0;\r\n\t\t\tLayaLight poiLight = layaPointLightToLight(posworld,normalWorld,u_PointLight,shadowAttenuation);\r\n\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,poiLight);\r\n\t\t#endif\r\n\t\t\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tshadowAttenuation = 1.0;\r\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\tshadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t#endif\r\n\t\t    LayaLight spoLight = layaSpotLightToLight(posworld,normalWorld,u_SpotLight,shadowAttenuation);\r\n\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,spoLight);\r\n\t\t#endif\r\n\t#else\r\n\t \t#ifdef DIRECTIONLIGHT\r\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t{\r\n\t\t\t\tshadowAttenuation = 1.0;\r\n\t\t\t\tif(i >= u_DirationLightCount)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t\t\t#endif\r\n\t\t\t\t\t\tshadowAttenuation *= sampleShadowmap(shadowCoord);\r\n\t\t\t\t\t}\r\n\t\t\t\t#endif\r\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\r\n\t\t\t\tLayaLight dirLight = layaDirectionLightToLight(directionLight,shadowAttenuation);\r\n\t\t\t \tcolor+=LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,dirLight);\r\n\t\t\t}\r\n\t \t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\r\n\t\t\t#ifdef POINTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tshadowAttenuation = 1.0;\r\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaLight poiLight = layaPointLightToLight(posworld,normalWorld,pointLight,shadowAttenuation);\r\n\t\t\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,poiLight);\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\t#ifdef SPOTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tshadowAttenuation = 1.0;\r\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\t\t\t\tshadowAttenuation= sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t#endif\r\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaLight spoLight = layaSpotLightToLight(posworld,normalWorld,spotLight,shadowAttenuation);\r\n\t\t\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,spoLight);\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t #endif\r\n\r\n\t#ifdef EMISSION\r\n\t\tcolor.rgb += emission(uv);\r\n\t#endif\r\n\r\n\t#ifdef FOG\r\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\r\n\t\tcolor.rgb=mix(color.rgb,u_FogColor,lerpFact);\r\n\t#endif\r\n\t\r\n\tgl_FragColor=vec4(color.rgb,alpha);\r\n}\r\n\r\n\r\n\r\n";var Vi="attribute vec4 a_Position;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n\tattribute mat4 a_WorldMat;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n\tuniform mat4 u_WorldMat;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\nattribute vec3 a_Normal;\r\nvarying vec3 v_Normal; \r\n\r\n#if defined(NORMALTEXTURE)||defined(PARALLAXTEXTURE)\r\n\tattribute vec4 a_Tangent0;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n    #ifdef PARALLAXTEXTURE\r\n\t    varying vec3 v_ViewDirForParallax;\r\n    #endif\r\n#endif\r\n\r\n#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)||(defined(LIGHTMAP)&&defined(UV))\r\n\tattribute vec2 a_Texcoord0;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#if defined(LIGHTMAP)&&defined(UV1)\r\n\tattribute vec2 a_Texcoord1;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tuniform vec4 u_LightmapScaleOffset;\r\n\tvarying vec2 v_LightMapUV;\r\n#endif\r\n\r\nuniform vec3 u_CameraPos;\r\nvarying vec3 v_EyeVec;\r\nvarying vec3 v_PositionWorld;\r\nvarying float v_posViewZ;\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif";var Ui="#ifdef ALPHATEST\r\n\tuniform float u_AlphaTestValue;\r\n#endif\r\n\r\nuniform vec4 u_AlbedoColor;\r\n\r\n#ifdef NORMALTEXTURE\r\n\tuniform sampler2D u_NormalTexture;\r\n\tuniform float u_NormalScale;\r\n#endif\r\n\r\n#ifdef ALBEDOTEXTURE\r\n\tuniform sampler2D u_AlbedoTexture;\r\n#endif\r\n\r\n#ifdef METALLICGLOSSTEXTURE\r\n\tuniform sampler2D u_MetallicGlossTexture;\r\n#endif\r\nuniform float u_Metallic;\r\n\r\n#ifdef SPECULARGLOSSTEXTURE\r\n\tuniform sampler2D u_SpecGlossTexture;\r\n#endif\r\nuniform vec3 u_SpecularColor;\r\n\r\nuniform float u_Smoothness;\r\nuniform float u_SmoothnessScale;\r\n\r\n#ifdef PARALLAXTEXTURE\r\n\tuniform sampler2D u_ParallaxTexture;\r\n\tuniform float u_ParallaxScale;\r\n\tvarying vec3 v_ViewDirForParallax;\r\n#endif\r\n\r\n#ifdef OCCLUSIONTEXTURE\r\n\tuniform sampler2D u_OcclusionTexture;\r\n\tuniform float u_occlusionStrength;\r\n#endif\r\n\r\n#ifdef EMISSION \r\n\t#ifdef EMISSIONTEXTURE\r\n\t\tuniform sampler2D u_EmissionTexture;\r\n\t#endif\r\n\tuniform vec4 u_EmissionColor;\r\n#endif\r\n\r\n#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tvarying vec2 v_LightMapUV;\r\n\tuniform sampler2D u_LightMap;\r\n\t#ifdef LIGHTMAP_DIRECTIONAL\r\n\t\tuniform sampler2D u_LightMapDirection;\r\n\t#endif\r\n#endif\r\n\r\nvarying vec3 v_Normal; \r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tuniform DirectionLight u_DirectionLight;\r\n\t\t#endif\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tuniform PointLight u_PointLight;\r\n\t\t#endif\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tuniform SpotLight u_SpotLight;\r\n\t\t#endif\r\n\t#else\r\n\t\tuniform mat4 u_View;\r\n\t\tuniform vec4 u_ProjectionParams;\r\n\t\tuniform vec4 u_Viewport;\r\n\t\tuniform int u_DirationLightCount;\r\n\t\tuniform sampler2D u_LightBuffer;\r\n\t\tuniform sampler2D u_LightClusterBuffer;\r\n\t#endif\r\n#endif\r\n\r\nvarying vec3 v_EyeVec;\r\n\r\n#ifdef NORMALTEXTURE\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\tuniform vec3 u_FogColor;\r\n#endif\r\n\r\n\r\n//后面考虑宏TODO\r\nvarying vec3 v_PositionWorld;\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\nmediump float lerpOneTo(mediump float b, mediump float t)\r\n{\r\n    mediump float oneMinusT = 1.0 - t;\r\n    return oneMinusT + b * t;\r\n}\r\n\r\n#ifdef EMISSION \r\n\tvec3 emission(vec2 uv)\r\n\t{\r\n\t\t#ifdef EMISSIONTEXTURE\r\n\t\t\treturn texture2D(u_EmissionTexture, uv).rgb * u_EmissionColor.rgb;\r\n\t\t#else\r\n\t\t\treturn u_EmissionColor.rgb;\r\n\t\t#endif\r\n\t}\r\n#endif\r\n\r\nmediump float getAlpha(vec2 uv)\r\n{\r\n\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t\treturn u_AlbedoColor.a;\r\n\t#else\r\n\t\t#ifdef ALBEDOTEXTURE\r\n\t\t\treturn texture2D(u_AlbedoTexture, uv).a * u_AlbedoColor.a;\r\n\t\t#else\r\n\t\t\treturn u_AlbedoColor.a;\r\n\t\t#endif\r\n\t#endif\r\n}\r\n\r\nmediump float getOcclusion(vec2 uv)\r\n{\r\n\t#ifdef OCCLUSIONTEXTURE\r\n\t\tmediump float occ = texture2D(u_OcclusionTexture, uv).g;\r\n\t\treturn lerpOneTo(occ, u_occlusionStrength);\r\n\t#else\r\n\t\treturn 1.0;\r\n\t#endif\r\n}\r\n\r\nmediump vec3 albedo(vec2 uv)\r\n{\r\n\t#ifdef ALBEDOTEXTURE\r\n\t\treturn u_AlbedoColor.rgb * texture2D(u_AlbedoTexture, uv).rgb;\r\n\t#else\r\n\t\treturn u_AlbedoColor.rgb;\r\n\t#endif\r\n\t//TODO:Detail Texture\r\n}\r\n\r\nmediump vec2 getMetallicGloss(vec2 uv)\r\n{\r\n\tmediump vec2 ms;//x is metallic,y is smoothness\r\n\t#ifdef METALLICGLOSSTEXTURE\r\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t\t\tms.x = texture2D(u_MetallicGlossTexture, uv).r;\r\n\t\t\t#ifdef ALBEDOTEXTURE\r\n\t\t\t\tms.y = texture2D(u_AlbedoTexture, uv).a*u_SmoothnessScale;\r\n\t\t\t#else\r\n\t\t\t\tms.y = u_SmoothnessScale;\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\tms = texture2D(u_MetallicGlossTexture, uv).ra;\r\n\t\t\tms.y *= u_SmoothnessScale;\r\n\t\t#endif\r\n\t#else\r\n\t\tms.x = u_Metallic;\r\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t\t\t#ifdef ALBEDOTEXTURE\r\n\t\t\t\tms.y = texture2D(u_AlbedoTexture, uv).a * u_SmoothnessScale;\r\n\t\t\t#else\r\n\t\t\t\tms.y = u_SmoothnessScale;\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\tms.y = u_Smoothness;\r\n\t\t#endif\r\n\t#endif\r\n\treturn ms;\r\n}\r\n\r\nmediump vec4 specularGloss(vec2 uv)\r\n{\r\n\tmediump vec4 sg;\r\n\t#ifdef SPECULARGLOSSTEXTURE\r\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t\t\tsg.rgb = texture2D(u_SpecGlossTexture, uv).rgb;\r\n\t\t\t#ifdef ALBEDOTEXTURE\r\n\t\t\t\tsg.a = texture2D(u_AlbedoTexture, uv).a*u_SmoothnessScale;\r\n\t\t\t#else\r\n\t\t\t\tsg.a = u_SmoothnessScale;\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\tsg = texture2D(u_SpecGlossTexture, uv);\r\n\t\t\tsg.a *= u_SmoothnessScale;\r\n\t\t#endif\r\n\t#else\r\n\t\tsg.rgb = u_SpecularColor.rgb;\r\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t\t\t#ifdef ALBEDOTEXTURE\r\n\t\t\t\tsg.a = texture2D(u_AlbedoTexture, uv).a * u_SmoothnessScale;\r\n\t\t\t#else\r\n\t\t\t\tsg.a = u_SmoothnessScale;\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\tsg.a = u_Smoothness;\r\n\t\t#endif\r\n\t#endif\r\n\t\treturn sg;\r\n}\r\n\r\n\r\n#ifdef NORMALTEXTURE\r\n\tmediump vec3 unpackScaleNormal(mediump vec3 packednormal, mediump float bumpScale)\r\n\t{\r\n\t\tmediump vec3 normal = packednormal.xyz * 2.0 - 1.0;\r\n\t\tnormal.y=-normal.y;//NOTE:because unity to LayaAir coordSystem.\r\n\t\tnormal.xy *= bumpScale;\r\n\t\treturn normal;\r\n\t}\r\n\t\r\n\tmediump vec3 normalInTangentSpace(vec2 texcoords)\r\n\t{\r\n\t\tmediump vec3 normalTangent = unpackScaleNormal(texture2D(u_NormalTexture, texcoords).rgb,u_NormalScale);\r\n\t\treturn normalTangent;\r\n\t}\r\n#endif\r\n\r\n#ifdef PARALLAXTEXTURE\r\n\tmediump vec2 parallaxOffset1Step(mediump float h, mediump float height, mediump vec3 viewDir)\r\n\t{\r\n\t\th = h * height - height / 2.0;\r\n\t\tviewDir.z += 0.42;\r\n\t\treturn h * (viewDir.xy / viewDir.z);\r\n\t}\r\n\r\n\tvec2 parallax(vec2 texcoords, mediump vec3 viewDir)\r\n\t{\r\n\t\tmediump float h = texture2D(u_ParallaxTexture, texcoords.xy).g;\r\n\t\tvec2 offset = parallaxOffset1Step(h, u_ParallaxScale, viewDir);\r\n\t\treturn texcoords+offset;\r\n\t}\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n";var ki="vec2 transformLightMapUV(in vec2 texcoord,in vec4 lightmapScaleOffset)\r\n{\r\n\tvec2 lightMapUV=vec2(texcoord.x,1.0-texcoord.y)*lightmapScaleOffset.xy+lightmapScaleOffset.zw;\r\n\tlightMapUV.y=1.0-lightMapUV.y;\r\n\treturn lightMapUV; \r\n}\r\n\r\nvoid vertexForward()\r\n{\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\r\n\tmat4 worldMat;\r\n\t#ifdef GPU_INSTANCE\r\n\t\tworldMat = a_WorldMat;\r\n\t#else\r\n\t\tworldMat = u_WorldMat;\r\n\t#endif\r\n\r\n\tv_PositionWorld=(worldMat*position).xyz;\r\n\r\n\t#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)\r\n\t\t#ifdef TILINGOFFSET\r\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t\t#else\r\n\t\t\tv_Texcoord0=a_Texcoord0;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tv_EyeVec =u_CameraPos-v_PositionWorld;//will normalize per-pixel\r\n\r\n\t#ifdef LIGHTMAP\r\n\t\tvec2 texcoord;\r\n\t\t#ifdef UV1\r\n\t\t\ttexcoord=a_Texcoord1;\r\n\t\t#else\r\n\t\t\ttexcoord=a_Texcoord0;\r\n\t\t#endif\r\n\t\tv_LightMapUV=transformLightMapUV(texcoord,u_LightmapScaleOffset);\r\n\t#endif\r\n\r\n\tmat3 worldInvMat;\r\n\t#ifdef BONE\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\r\n\t#else\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\r\n\t#endif\r\n\r\n\tv_Normal=normalize(a_Normal*worldInvMat);//if no normalize will cause precision problem.\r\n\r\n\t#ifdef NORMALTEXTURE\r\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\r\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\r\n\t#endif\r\n\r\n\t#ifdef PARALLAXTEXTURE\r\n\t\tvec3 binormal = cross(a_Normal, a_Tangent0.xyz)*a_Tangent0.w;\r\n\t\tmat3 objectTBN = mat3(a_Tangent0.xyz, binormal, a_Normal);\r\n\t\tv_ViewDirForParallax =(u_CameraPos*worldInvMat-position.xyz)*objectTBN;\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\t\tv_ShadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(v_PositionWorld,1.0);\r\n\t#endif\r\n}";var Gi='#include "Lighting.glsl";\r\n#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\nattribute vec4 a_PositionTexcoord;\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main() {\r\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapGLPositionZ(gl_Position);\r\n}';var Hi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform vec4 u_MainTex_TexelSize;\r\n\r\nvoid fragDownsample13() {\r\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n\tgl_FragColor = color;\r\n}\r\n\r\nvoid main() {\r\n\tfragDownsample13();\r\n}';var zi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform vec4 u_MainTex_TexelSize;\r\n\r\nvoid fragDownsample4() {\r\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n\tgl_FragColor = color;\r\n}\r\n\r\nvoid main() {\r\n\tfragDownsample4();\r\n}';var Wi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform sampler2D u_AutoExposureTex;\r\nuniform vec4 u_MainTex_TexelSize;\r\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\r\nuniform vec4 u_Params; // x: clamp, yzw: unused\r\n\r\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\r\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\r\n\tcolor *= autoExposure;\r\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\r\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\r\n\treturn color;\r\n}\r\n\r\nvoid fragPrefilter13() {\r\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\r\n}\r\n\r\nvoid main() {\r\n\tfragPrefilter13();\r\n}';var Xi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform sampler2D u_AutoExposureTex;\r\nuniform vec4 u_MainTex_TexelSize;\r\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\r\nuniform vec4 u_Params; // x: clamp, yzw: unused\r\n\r\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\r\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\r\n\tcolor *= autoExposure;\r\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\r\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\r\n\treturn color;\r\n}\r\n\r\nvoid fragPrefilter4() {\r\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\r\n}\r\n\r\nvoid main() {\r\n\tfragPrefilter4();\r\n}';var Yi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform sampler2D u_BloomTex;\r\n\r\nuniform vec4 u_MainTex_TexelSize;\r\nuniform float u_SampleScale;\r\n\r\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\r\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\r\n\treturn bloom + color;\r\n}\r\n\r\nvoid fragUpsampleBox() {\r\n\tmediump vec4 bloom = upsampleBox(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\r\n\tgl_FragColor = combine(bloom, v_Texcoord0);\r\n}\r\n\r\nvoid main() {\r\n\tfragUpsampleBox();\r\n}';var ji='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform sampler2D u_BloomTex;\r\n\r\nuniform vec4 u_MainTex_TexelSize;\r\nuniform float u_SampleScale;\r\n\r\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\r\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\r\n\treturn bloom + color;\r\n}\r\n\r\nvoid fragUpsampleTent() {\r\n\tmediump vec4 bloom = upsampleTent(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\r\n\tgl_FragColor = combine(bloom, v_Texcoord0);\r\n}\r\n\r\nvoid main() {\r\n\tfragUpsampleTent();\r\n}';var qi='#include "StdLib.glsl";\r\n\r\n#define EPSILON 1.0e-4\r\n\r\n// Quadratic color thresholding\r\n// curve = (threshold - knee, knee * 2, 0.25 / knee)\r\nmediump vec4 quadraticThreshold(mediump vec4 color, mediump float threshold, mediump vec3 curve) {\r\n\t// Pixel brightness\r\n\tmediump float br = max3(color.r, color.g, color.b);\r\n\r\n\t// Under-threshold part: quadratic curve\r\n\tmediump float rq = clamp(br - curve.x, 0.0, curve.y);\r\n\trq = curve.z * rq * rq;\r\n\r\n\t// Combine and apply the brightness response curve.\r\n\tcolor *= max(rq, br - threshold) / max(br, EPSILON);\r\n\r\n\treturn color;\r\n}\r\n\r\n\r\n\r\n//\r\n// sRGB transfer functions\r\n// Fast path ref: http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\r\n//\r\nmediump vec3 sRGBToLinear(mediump vec3 c) {\r\n\t#ifdef USE_VERY_FAST_SRGB\r\n\t\treturn c * c;\r\n\t#elif defined(USE_FAST_SRGB)\r\n\t\treturn c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\r\n\t#else\r\n\t\tmediump vec3 linearRGBLo = c / 12.92;\r\n\t\tmediump vec3 power=vec3(2.4, 2.4, 2.4);\r\n\t\tmediump vec3 linearRGBHi = positivePow((c + 0.055) / 1.055, power);\r\n\t\tmediump vec3 linearRGB =vec3((c.r<=0.04045) ? linearRGBLo.r : linearRGBHi.r,(c.g<=0.04045) ? linearRGBLo.g : linearRGBHi.g,(c.b<=0.04045) ? linearRGBLo.b : linearRGBHi.b);\r\n\t\treturn linearRGB;\r\n\t#endif\r\n}\r\n\r\nmediump vec4 sRGBToLinear(mediump vec4 c){\r\n    return vec4(sRGBToLinear(c.rgb), c.a);\r\n}\r\n\r\n\r\n\r\nmediump vec3 linearToSRGB(mediump vec3 c) {\r\n\t#ifdef USE_VERY_FAST_SRGB\r\n\t\treturn sqrt(c);\r\n\t#elif defined(USE_FAST_SRGB)\r\n\t\treturn max(1.055 * PositivePow(c, 0.416666667) - 0.055, 0.0);\r\n\t#else\r\n\t\tmediump vec3 sRGBLo = c * 12.92;\r\n\t\tmediump vec3 power=vec3(1.0 / 2.4, 1.0 / 2.4, 1.0 / 2.4);\r\n\t\tmediump vec3 sRGBHi = (positivePow(c, power) * 1.055) - 0.055;\r\n\t\tmediump vec3 sRGB =vec3((c.r<=0.0031308) ? sRGBLo.r : sRGBHi.r,(c.g<=0.0031308) ? sRGBLo.g : sRGBHi.g,(c.b<=0.0031308) ? sRGBLo.b : sRGBHi.b);\r\n\t\treturn sRGB;\r\n\t#endif\r\n}\r\n\r\nmediump vec4 linearToSRGB(mediump vec4 c){\r\n    return vec4(linearToSRGB(c.rgb), c.a);\r\n}';var Zi='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Colors.glsl";\r\n#include "Sampling.glsl";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nuniform sampler2D u_MainTex;\r\nuniform sampler2D u_BloomTex;\r\n\r\nuniform sampler2D u_AutoExposureTex;\r\nuniform sampler2D u_Bloom_DirtTex;\r\nuniform vec4 u_BloomTex_TexelSize;\r\nuniform vec4 u_Bloom_DirtTileOffset; // xy: tiling, zw: offset\r\nuniform mediump vec3 u_Bloom_Settings;// x: sampleScale, y: intensity, z: dirt intensity\r\nuniform mediump vec3 u_Bloom_Color;\r\n\r\nvoid main() {\r\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, v_Texcoord0).r;\r\n\tmediump vec4 color=vec4(0.0);\r\n\tcolor = texture2D(u_MainTex, v_Texcoord0);\r\n\t\r\n\tcolor = sRGBToLinear(color);\r\n\tcolor.rgb *= autoExposure;\r\n\t\r\n\t#if defined(BLOOM)||defined(BLOOM_LOW)\r\n\t\t#ifdef BLOOM\r\n\t\t\tmediump vec4 bloom = upsampleTent(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\r\n\t\t#else\r\n\t\t\tmediump vec4 bloom = upsampleBox(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\r\n\t\t#endif\r\n\r\n\t\t// UVs should be Distort(uv * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw)\r\n\t\t// but considering we use a cover-style scale on the dirt texture the difference\r\n\t\t// isn\'t massive so we chose to save a few ALUs here instead in case lens distortion\r\n\t\t// is active\r\n\t\tmediump vec4 dirt =vec4(texture2D(u_Bloom_DirtTex, v_Texcoord0 * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw).rgb, 0.0);\r\n\r\n\t\t// Additive bloom (artist friendly)\r\n\t\tbloom *= u_Bloom_Settings.y;\r\n\t\tdirt *= u_Bloom_Settings.z;\r\n\t\tmediump vec4 bloomColor=vec4(u_Bloom_Color, 1.0);\r\n\t\tcolor += bloom * bloomColor;\r\n\t\tcolor += dirt * bloom;\r\n\t#endif\r\n\t\r\n\tmediump vec4 finalColor = color;\r\n\tfinalColor = linearToSRGB(finalColor);\r\n\t//finalColor.rgb = Dither(finalColor.rgb, v_Texcoord0);//TODO:抖动\r\n\tgl_FragColor = finalColor;\r\n}';var Ki='#include "Lighting.glsl";\r\n\r\nattribute vec4 a_PositionTexcoord;\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main() {\r\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapGLPositionZ(gl_Position);\r\n}';var Qi="// Better, temporally stable box filtering\r\n// [Jimenez14] http://goo.gl/eomGso\r\n// . . . . . . .\r\n// . A . B . C .\r\n// . . D . E . .\r\n// . F . G . H .\r\n// . . I . J . .\r\n// . K . L . M .\r\n// . . . . . . .\r\nmediump vec4 downsampleBox13Tap(sampler2D tex, vec2 uv, vec2 texelSize)\r\n{\r\n    mediump vec4 A = texture2D(tex, uv + texelSize * vec2(-1.0, -1.0));\r\n    mediump vec4 B = texture2D(tex, uv + texelSize * vec2( 0.0, -1.0));\r\n    mediump vec4 C = texture2D(tex, uv + texelSize * vec2( 1.0, -1.0));\r\n    mediump vec4 D = texture2D(tex, uv + texelSize * vec2(-0.5, -0.5));\r\n    mediump vec4 E = texture2D(tex, uv + texelSize * vec2( 0.5, -0.5));\r\n    mediump vec4 F = texture2D(tex, uv + texelSize * vec2(-1.0,  0.0));\r\n    mediump vec4 G = texture2D(tex, uv);\r\n    mediump vec4 H = texture2D(tex, uv + texelSize * vec2( 1.0,  0.0));\r\n    mediump vec4 I = texture2D(tex, uv + texelSize * vec2(-0.5,  0.5));\r\n    mediump vec4 J = texture2D(tex, uv + texelSize * vec2( 0.5,  0.5));\r\n    mediump vec4 K = texture2D(tex, uv + texelSize * vec2(-1.0,  1.0));\r\n    mediump vec4 L = texture2D(tex, uv + texelSize * vec2( 0.0,  1.0));\r\n    mediump vec4 M = texture2D(tex, uv + texelSize * vec2( 1.0,  1.0));\r\n\r\n\tmediump vec2 scale= vec2(0.5, 0.125);\r\n    mediump vec2 div = (1.0 / 4.0) * scale;\r\n\r\n    mediump vec4 o = (D + E + I + J) * div.x;\r\n    o += (A + B + G + F) * div.y;\r\n    o += (B + C + H + G) * div.y;\r\n    o += (F + G + L + K) * div.y;\r\n    o += (G + H + M + L) * div.y;\r\n\r\n    return o;\r\n}\r\n\r\n// Standard box filtering\r\nmediump vec4 downsampleBox4Tap(sampler2D tex, vec2 uv, vec2 texelSize)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\r\n\r\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\r\n    s += texture2D(tex, uv + d.zy);\r\n    s += texture2D(tex, uv + d.xw);\r\n    s += texture2D(tex, uv + d.zw);\r\n\r\n    return s * (1.0 / 4.0);\r\n}\r\n\r\n// 9-tap bilinear upsampler (tent filter)\r\n// . . . . . . .\r\n// . 1 . 2 . 1 .\r\n// . . . . . . .\r\n// . 2 . 4 . 2 .\r\n// . . . . . . .\r\n// . 1 . 2 . 1 .\r\n// . . . . . . .\r\nmediump vec4 upsampleTent(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0) * sampleScale;\r\n\r\n    mediump vec4 s =  texture2D(tex, uv - d.xy);\r\n    s += texture2D(tex, uv - d.wy) * 2.0;\r\n    s += texture2D(tex, uv - d.zy);\r\n\r\n    s += texture2D(tex, uv + d.zw) * 2.0;\r\n    s += texture2D(tex, uv) * 4.0;\r\n    s += texture2D(tex,\tuv + d.xw) * 2.0;\r\n\r\n    s += texture2D(tex, uv + d.zy);\r\n    s += texture2D(tex, uv + d.wy) * 2.0;\r\n    s += texture2D(tex, uv + d.xy);\r\n\r\n    return s * (1.0 / 16.0);\r\n}\r\n\r\n// Standard box filtering\r\nmediump vec4 upsampleBox(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0) * 0.5 * sampleScale;\r\n\r\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\r\n    s += texture2D(tex, uv + d.zy);\r\n    s += texture2D(tex, uv + d.xw);\r\n    s += texture2D(tex, uv + d.zw);\r\n\r\n    return s * (1.0 / 4.0);\r\n}";var Ji="#define HALF_MAX       65504.0 // (2 - 2^-10) * 2^15\r\n\r\n#define FLT_EPSILON    1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\r\n\r\nmediump vec4 safeHDR(mediump vec4 c)\r\n{\r\n    return min(c, HALF_MAX);\r\n}\r\n\r\nfloat max3(float a, float b, float c)\r\n{\r\n    return max(max(a, b), c);\r\n}\r\n\r\nvec3 positivePow(vec3 base, vec3 power)\r\n{\r\n    return pow(max(abs(base), vec3(FLT_EPSILON, FLT_EPSILON, FLT_EPSILON)), power);\r\n}";var $i='#ifndef GRAPHICS_API_GLES3\r\n\t#define NO_NATIVE_SHADOWMAP\r\n#endif\r\n\r\n#if defined(NO_NATIVE_SHADOWMAP)\r\n\t#define TEXTURE2D_SHADOW(textureName) uniform mediump sampler2D textureName\r\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName,coord3.xy).r<coord3.z?0.0:1.0)\r\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2D shadowMap\r\n#else\r\n\t#define TEXTURE2D_SHADOW(textureName) uniform mediump sampler2DShadow textureName\r\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName,coord3,0.0)\r\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2DShadow shadowMap\r\n#endif\r\n\r\n#if defined(RECEIVESHADOW)&&defined(SHADOW)\r\n    #define CALCULATE_SHADOWS\r\n#endif\r\n\r\n#if defined(RECEIVESHADOW)&&defined(SHADOW_SPOT)\r\n\t#define CALCULATE_SPOTSHADOWS\r\n#endif\r\n\r\nuniform vec4 u_ShadowBias; // x: depth bias, y: normal bias\r\n\r\n#if defined(CALCULATE_SHADOWS)||defined(CALCULATE_SPOTSHADOWS)\r\n\t#include "ShadowSampleTent.glsl"\r\n\tuniform vec4 u_ShadowMapSize;\r\n\tuniform vec4 u_ShadowParams; // x: shadowStrength y: ShadowSpotLightStrength\r\n\r\n\t\r\n\tfloat sampleShdowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowMapSize)\r\n\t{\r\n\t\tfloat attenuation;\r\n\t\tvec4 attenuation4;\r\n\t\tvec2 offset=shadowMapSize.xy/2.0;\r\n\t\tvec3 shadowCoord0=shadowCoord + vec3(-offset,0.0);\r\n\t\tvec3 shadowCoord1=shadowCoord + vec3(offset.x,-offset.y,0.0);\r\n\t\tvec3 shadowCoord2=shadowCoord + vec3(-offset.x,offset.y,0.0);\r\n\t\tvec3 shadowCoord3=shadowCoord + vec3(offset,0.0);\r\n\t\tattenuation4.x = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord0);\r\n\t\tattenuation4.y = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord1);\r\n\t\tattenuation4.z = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord2);\r\n\t\tattenuation4.w = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord3);\r\n\t\tattenuation = dot(attenuation4, vec4(0.25));\r\n\t\treturn attenuation;\r\n\t}\r\n\r\n\tfloat sampleShdowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowmapSize)\r\n\t{\r\n\t\tfloat attenuation;\r\n\t\tfloat fetchesWeights[9];\r\n\t\tvec2 fetchesUV[9];\r\n\t\tsampleShadowComputeSamplesTent5x5(shadowmapSize, shadowCoord.xy, fetchesWeights, fetchesUV);\r\n\t\tattenuation = fetchesWeights[0] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[0].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[1] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[1].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[2] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[2].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[3] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[3].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[4] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[4].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[5] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[5].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[6] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[6].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[7] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[7].xy, shadowCoord.z));\r\n\t\tattenuation += fetchesWeights[8] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[8].xy, shadowCoord.z));\r\n\t\treturn attenuation;\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n\r\n\r\n#if defined(CALCULATE_SHADOWS)\r\n\r\n\tTEXTURE2D_SHADOW(u_ShadowMap);\r\n\r\n\tuniform mat4 u_ShadowMatrices[4];\r\n\tuniform vec4 u_ShadowSplitSpheres[4];// max cascade is 4\r\n\r\n\tmediump int computeCascadeIndex(vec3 positionWS)\r\n\t{\r\n\t\tvec3 fromCenter0 = positionWS - u_ShadowSplitSpheres[0].xyz;\r\n\t\tvec3 fromCenter1 = positionWS - u_ShadowSplitSpheres[1].xyz;\r\n\t\tvec3 fromCenter2 = positionWS - u_ShadowSplitSpheres[2].xyz;\r\n\t\tvec3 fromCenter3 = positionWS - u_ShadowSplitSpheres[3].xyz;\r\n\r\n\t\tmediump vec4 comparison = vec4(\r\n\t\t\tdot(fromCenter0, fromCenter0)<u_ShadowSplitSpheres[0].w,\r\n\t\t\tdot(fromCenter1, fromCenter1)<u_ShadowSplitSpheres[1].w,\r\n\t\t\tdot(fromCenter2, fromCenter2)<u_ShadowSplitSpheres[2].w,\r\n\t\t\tdot(fromCenter3, fromCenter3)<u_ShadowSplitSpheres[3].w);\r\n\t\tcomparison.yzw = clamp(comparison.yzw - comparison.xyz,0.0,1.0);//keep the nearest\r\n\t\tmediump vec4 indexCoefficient = vec4(4.0,3.0,2.0,1.0);\r\n\t\tmediump int index = 4 - int(dot(comparison, indexCoefficient));\r\n\t\treturn index;\r\n\t}\r\n\r\n\tvec4 getShadowCoord(vec4 positionWS)\r\n\t{\r\n\t\t#ifdef SHADOW_CASCADE\r\n\t\t\tmediump int cascadeIndex = computeCascadeIndex(positionWS.xyz);\r\n\t\t\tif(cascadeIndex > 3)// out of shadow range cascadeIndex is 4.\r\n\t\t\t\treturn vec4(0.0);\r\n\t\t\t\r\n\t\t\t#ifdef GRAPHICS_API_GLES3\r\n\t\t\t\treturn u_ShadowMatrices[cascadeIndex] * positionWS;\r\n\t\t\t#else\r\n\t\t\t\tmat4 shadowMat;\r\n\t\t\t\tif(cascadeIndex == 0)\r\n\t\t\t\t\tshadowMat = u_ShadowMatrices[0];\r\n\t\t\t\telse if(cascadeIndex == 1)\r\n\t\t\t\t\tshadowMat = u_ShadowMatrices[1];\r\n\t\t\t\telse if(cascadeIndex == 2)\r\n\t\t\t\t\tshadowMat = u_ShadowMatrices[2];\r\n\t\t\t\telse\r\n\t\t\t\t\tshadowMat = u_ShadowMatrices[3];\r\n\t\t\t\treturn shadowMat * positionWS;\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\treturn u_ShadowMatrices[0] * positionWS;\r\n\t\t#endif\r\n\t}\r\n\r\n\tfloat sampleShadowmap(vec4 shadowCoord)\r\n\t{\r\n\t\tshadowCoord.xyz /= shadowCoord.w;\r\n\t\tfloat attenuation = 1.0;\r\n\t\tif(shadowCoord.z > 0.0 && shadowCoord.z < 1.0)\r\n\t\t{\r\n\t\t\t#if defined(SHADOW_SOFT_SHADOW_HIGH)\r\n\t\t\t\tattenuation = sampleShdowMapFiltered9(u_ShadowMap,shadowCoord.xyz,u_ShadowMapSize);\r\n\t\t\t#elif defined(SHADOW_SOFT_SHADOW_LOW)\r\n\t\t\t\tattenuation = sampleShdowMapFiltered4(u_ShadowMap,shadowCoord.xyz,u_ShadowMapSize);\r\n\t\t\t#else\r\n\t\t\t\tattenuation = SAMPLE_TEXTURE2D_SHADOW(u_ShadowMap,shadowCoord.xyz);\r\n\t\t\t#endif\r\n\t\t\tattenuation = mix(1.0,attenuation,u_ShadowParams.x);//shadowParams.x:shadow strength\r\n\t\t}\r\n\t\treturn attenuation;\r\n\t}\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\r\n\tTEXTURE2D_SHADOW(u_SpotShadowMap);\r\n\tuniform mat4 u_SpotViewProjectMatrix;\r\n\tfloat sampleSpotShadowmap(vec4 shadowCoord)\r\n\t{\r\n\t\tshadowCoord.xyz /= shadowCoord.w;\r\n\t\tfloat attenuation = 1.0;\r\n\t\tshadowCoord.xy +=1.0;\r\n\t\tshadowCoord.xy/=2.0; \r\n\t\tif(shadowCoord.z > 0.0 && shadowCoord.z < 1.0)\r\n\t\t{\r\n\t\t\t#if defined(SHADOW_SPOT_SOFT_SHADOW_HIGH)\r\n\t\t\t\tattenuation = sampleShdowMapFiltered9(u_SpotShadowMap,shadowCoord.xyz,u_ShadowMapSize);\r\n\t\t\t#elif defined(SHADOW_SPOT_SOFT_SHADOW_LOW)\r\n\t\t\t\tattenuation = sampleShdowMapFiltered4(u_SpotShadowMap,shadowCoord.xyz,u_ShadowMapSize);\r\n\t\t\t#else\r\n\t\t\t\tattenuation = SAMPLE_TEXTURE2D_SHADOW(u_SpotShadowMap,shadowCoord.xyz);\r\n\t\t\t#endif\r\n\t\t\tattenuation = mix(1.0,attenuation,u_ShadowParams.y);//shadowParams.y:shadow strength\r\n\t\t}\r\n\t\treturn attenuation;\r\n\t}\r\n#endif\r\n\r\nvec3 applyShadowBias(vec3 positionWS, vec3 normalWS, vec3 lightDirection)\r\n{\r\n    float invNdotL = 1.0 - clamp(dot(-lightDirection, normalWS),0.0,1.0);\r\n    float scale = invNdotL * u_ShadowBias.y;\r\n\r\n    // normal bias is negative since we want to apply an inset normal offset\r\n    positionWS += -lightDirection * u_ShadowBias.xxx;\r\n    positionWS += normalWS * vec3(scale);\r\n    return positionWS;\r\n}\r\n';var tr='#include "Lighting.glsl";\r\n#include "Shadow.glsl"\r\n\r\nattribute vec4 a_Position;\r\nattribute vec3 a_Normal;\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_WorldMat;\r\n#else\r\n\tuniform mat4 u_WorldMat;\r\n#endif\r\n\r\nuniform mat4 u_ViewProjection;\r\n\r\n#ifdef SHADOW\r\n\tuniform vec3 u_ShadowLightDirection;\r\n#endif\r\n\r\n\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\r\n\tattribute vec2 a_Texcoord0;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\nvec4 shadowCasterVertex()\r\n{\r\n\tmat4 worldMat;\r\n\t#ifdef GPU_INSTANCE\r\n\t\tworldMat = a_WorldMat;\r\n\t#else\r\n\t\tworldMat = u_WorldMat;\r\n\t#endif\r\n\t\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tworldMat = worldMat * skinTransform;\r\n\t#endif\r\n\r\n\tvec4 positionWS = worldMat * a_Position;\r\n\tvec3 normalWS = normalize(a_Normal*INVERSE_MAT(mat3(worldMat)));//if no normalize will cause precision problem\r\n\r\n\t#ifdef SHADOW\r\n\t\tpositionWS.xyz = applyShadowBias(positionWS.xyz,normalWS,u_ShadowLightDirection);\r\n\t#endif\r\n\r\n\tvec4 positionCS = u_ViewProjection * positionWS;\r\n\t#ifdef SHADOW_SPOT\r\n\t\tpositionCS.z = positionCS.z-u_ShadowBias.x/positionCS.w;\r\n\t#endif\r\n\tpositionCS.z = max(positionCS.z, 0.0);//min ndc z is 0.0\r\n\t\r\n\t// //TODO没考虑UV动画呢\r\n\t// #if defined(DIFFUSEMAP)&&defined(ALPHATEST)\r\n\t// \tv_Texcoord0=a_Texcoord0;\r\n\t// #endif\r\n    return positionCS;\r\n}\r\n';var er="// #ifdef ALPHATEST\r\n// \tuniform float u_AlphaTestValue;\r\n// #endif\r\n\r\n// #ifdef DIFFUSEMAP\r\n// \tuniform sampler2D u_DiffuseTexture;\r\n// #endif\r\n\r\n// #if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n// \tvarying vec2 v_Texcoord0;\r\n// #endif\r\n\r\nvec4 shadowCasterFragment()\r\n{\r\n    return vec4(0.0);\r\n    // #if defined(DIFFUSEMAP)&&defined(ALPHATEST)\r\n\t// \tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\r\n\t// \tif( alpha < u_AlphaTestValue )\r\n\t// \t{\r\n\t// \t\tdiscard;\r\n\t// \t}\r\n\t// #endif\r\n}\r\n";var ar="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\nvarying vec3 v_Texcoord;\r\n\r\nuniform samplerCube u_CubeTexture;\r\nuniform float u_Exposure;\r\nuniform vec4 u_TintColor;\r\n\r\n\r\nvoid main()\r\n{\t\r\n\tvec3 color=textureCube(u_CubeTexture, v_Texcoord).rgb*u_TintColor.rgb*u_Exposure*2.0;\r\n\tgl_FragColor=vec4(color,1.0);\r\n}\r\n\r\n";var ir='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n#include "Lighting.glsl";\r\n\r\nattribute vec4 a_Position;\r\nuniform mat4 u_ViewProjection;\r\nuniform float u_Rotation;\r\nvarying vec3 v_Texcoord;\r\n\r\n\r\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\r\n{\r\n\tfloat angle = degrees * 3.141593 / 180.0;\r\n\tfloat sina=sin(angle);\r\n\tfloat cosa=cos(angle);\r\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\r\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\r\n}\r\n\t\t\r\nvoid main()\r\n{\r\n\tvec4 position=rotateAroundYInDegrees(a_Position,u_Rotation);\r\n\tgl_Position = u_ViewProjection*position;\r\n\tv_Texcoord=vec3(-a_Position.x,a_Position.yz);//转换坐标系\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}\r\n';var rr='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n\r\nconst float MIE_G = -0.990;\r\nconst float MIE_G2 = 0.9801;\r\nconst float SKY_GROUND_THRESHOLD = 0.02;\r\n\r\nuniform float u_SunSize;\r\nuniform float u_SunSizeConvergence;\r\nuniform DirectionLight u_SunLight;\r\n\r\n\r\nvarying vec3 v_GroundColor;\r\nvarying vec3 v_SkyColor;\r\n\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\n\tvarying vec3 v_Vertex;\r\n#elif defined(SUN_SIMPLE)\r\n\tvarying vec3 v_RayDir;\r\n#else\r\n\tvarying float v_SkyGroundFactor;\r\n#endif\r\n\r\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\r\n\tvarying vec3 v_SunColor;\r\n#endif\r\n\r\n// Calculates the Mie phase function\r\nfloat getMiePhase(float eyeCos, float eyeCos2) {\r\n\tfloat temp = 1.0 + MIE_G2 - 2.0 * MIE_G * eyeCos;\r\n\ttemp = pow(temp, pow(u_SunSize,0.65) * 10.0);\r\n\ttemp = max(temp,1.0e-4); // prevent division by zero, esp. in half precision\r\n\ttemp = 1.5 * ((1.0 - MIE_G2) / (2.0 + MIE_G2)) * (1.0 + eyeCos2) / temp;\r\n\treturn temp;\r\n}\r\n\r\n// Calculates the sun shape\r\nfloat calcSunAttenuation(vec3 lightPos, vec3 ray) {\r\n\t#ifdef SUN_HIGH_QUALITY\r\n\t\tfloat focusedEyeCos = pow(clamp(dot(lightPos, ray),0.0,1.0), u_SunSizeConvergence);\r\n\t\treturn getMiePhase(-focusedEyeCos, focusedEyeCos * focusedEyeCos);\r\n\t#else //SUN_SIMPLE\r\n\t\tvec3 delta = lightPos - ray;\r\n\t\tfloat dist = length(delta);\r\n\t\tfloat spot = 1.0 - smoothstep(0.0, u_SunSize, dist);\r\n\t\treturn spot * spot;\r\n\t#endif\r\n}\r\n\r\nvoid main() {\r\n\t// if y > 1 [eyeRay.y < -SKY_GROUND_THRESHOLD] - ground\r\n\t// if y >= 0 and < 1 [eyeRay.y <= 0 and > -SKY_GROUND_THRESHOLD] - horizon\r\n\t// if y < 0 [eyeRay.y > 0] - sky\r\n\tvec3 col = vec3(0.0, 0.0, 0.0);\r\n\r\n\t#ifdef SUN_HIGH_QUALITY\r\n\t\tvec3 ray = normalize(v_Vertex);\r\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tvec3 ray = v_RayDir;\r\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\t\r\n\t#else\r\n\t\tfloat y = v_SkyGroundFactor;\r\n\t#endif\r\n\r\n\t// if we did precalculate color in vprog: just do lerp between them\r\n\tcol = mix(v_SkyColor, v_GroundColor, clamp(y,0.0,1.0));\r\n\r\n\t#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\r\n\t\tif (y < 0.0)\r\n\t\t\tcol += v_SunColor * calcSunAttenuation(-u_SunLight.direction, -ray);\r\n\t#endif\r\n\r\n\tcol = sqrt(col);//linear space convert to gamma space\r\n\tgl_FragColor=vec4(col,1.0);\r\n}\r\n\r\n';var sr="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#include \"Lighting.glsl\";\r\n\r\n#define OUTER_RADIUS 1.025\r\n#define RAYLEIGH (mix(0.0, 0.0025, pow(u_AtmosphereThickness,2.5)))// Rayleigh constant Rayleigh为夜空光和极光亮度单位\r\n#define MIE 0.0010             // Mie constant 米氏散射\r\n#define SUN_BRIGHTNESS 20.0    // Sun brightness\r\n#define MAX_SCATTER 50.0 // Maximum scattering value, to prevent math overflows on Adrenos\r\n\r\nconst float SKY_GROUND_THRESHOLD = 0.02;\r\nconst float outerRadius = OUTER_RADIUS;\r\nconst float outerRadius2 = OUTER_RADIUS*OUTER_RADIUS;\r\nconst float innerRadius = 1.0;\r\nconst float innerRadius2 = 1.0;\r\nconst float cameraHeight = 0.0001;\r\n\r\nconst float HDSundiskIntensityFactor = 15.0;\r\nconst float simpleSundiskIntensityFactor = 27.0;\r\n\r\nconst float sunScale = 400.0 * SUN_BRIGHTNESS;\r\nconst float kmESun = MIE * SUN_BRIGHTNESS;\r\nconst float km4PI = MIE * 4.0 * 3.14159265;\r\nconst float scale = 1.0 / (OUTER_RADIUS - 1.0);\r\nconst float scaleDepth = 0.25;\r\nconst float scaleOverScaleDepth = (1.0 / (OUTER_RADIUS - 1.0)) / 0.25;\r\nconst float samples = 2.0; // THIS IS UNROLLED MANUALLY, DON'T TOUCH\r\n\r\n// RGB wavelengths        .35 (.62=158), .43 (.68=174), .525 (.75=190)\r\nconst vec3 c_DefaultScatteringWavelength = vec3(0.65, 0.57, 0.475);//默认散射波长\r\nconst vec3 c_VariableRangeForScatteringWavelength = vec3(0.15, 0.15, 0.15);//散射播放的可变范围\r\n\r\nattribute vec4 a_Position;\r\n\r\nuniform mat4 u_ViewProjection;\r\nuniform vec3 u_SkyTint;\r\nuniform vec3 u_GroundTint;\r\nuniform float u_Exposure;\r\nuniform float u_AtmosphereThickness;\r\nuniform DirectionLight u_SunLight;\r\n\r\nvarying vec3 v_GroundColor;\r\nvarying vec3 v_SkyColor;\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\n\tvarying vec3 v_Vertex;\r\n#elif defined(SUN_SIMPLE)\r\n\tvarying vec3 v_RayDir;\r\n#else\r\n\tvarying float v_SkyGroundFactor;\r\n#endif\r\n\r\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\r\n\tvarying vec3 v_SunColor;\r\n#endif\r\n\r\n// Calculates the Rayleigh phase function\r\nfloat getRayleighPhase(vec3 light, vec3 ray) \r\n{\r\n\tfloat eyeCos = dot(light, ray);\r\n\treturn 0.75 + 0.75*eyeCos*eyeCos;\r\n}\r\n\r\nfloat scaleAngle(float inCos)\r\n{\r\n\tfloat x = 1.0 - inCos;\r\n\treturn 0.25 * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\n\r\nvoid main () {\r\n\tgl_Position = u_ViewProjection*a_Position;\r\n\r\n\tvec3 skyTintInGammaSpace = u_SkyTint;//支持非GAMMA空间后要调整\r\n\tvec3 scatteringWavelength = mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0) - skyTintInGammaSpace); // using Tint in sRGB+ gamma allows for more visually linear interpolation and to keep (0.5) at (128, gray in sRGB) point\r\n\tvec3 invWavelength = 1.0 / pow(scatteringWavelength, vec3(4.0));\r\n\r\n\tfloat krESun = RAYLEIGH * SUN_BRIGHTNESS;\r\n\tfloat kr4PI = RAYLEIGH * 4.0 * 3.14159265;\r\n\r\n\tvec3 cameraPos = vec3(0.0,innerRadius + cameraHeight,0.0); // The camera's current position\r\n\r\n\t// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\r\n\tvec3 eyeRay = normalize(a_Position.xyz);\r\n\r\n\tfloat far = 0.0;\r\n\tvec3 cIn, cOut;\r\n\tif (eyeRay.y >= 0.0) {// Sky\r\n\t\t// Calculate the length of the \"atmosphere\"\r\n\t\tfar = sqrt(outerRadius2 + innerRadius2 * eyeRay.y * eyeRay.y - innerRadius2) - innerRadius * eyeRay.y;\r\n\r\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\r\n\t\tfloat height = innerRadius + cameraHeight;\r\n\t\tfloat depth = exp(scaleOverScaleDepth * -cameraHeight);\r\n\t\tfloat startAngle = dot(eyeRay, cameraPos) / height;\r\n\t\tfloat startOffset = depth*scaleAngle(startAngle);\r\n\r\n\t\t// Initialize the scattering loop variables\r\n\t\tfloat sampleLength = far / samples;\r\n\t\tfloat scaledLength = sampleLength * scale;\r\n\t\tvec3 sampleRay = eyeRay * sampleLength;\r\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\r\n\r\n\t\tvec3 frontColor = vec3(0.0);\r\n\t\t//unrolling this manually to avoid some platform for loop slow\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat lightAngle = dot(-u_SunLight.direction, samplePoint) / height;\r\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\r\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\r\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat lightAngle = dot(-u_SunLight.direction, samplePoint) / height;\r\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\r\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\r\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\r\n\t\t// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\r\n\t\tcIn = frontColor * (invWavelength * krESun);\r\n\t\tcOut = frontColor * kmESun;\r\n\t} else {// Ground\r\n\t\tfar = (-cameraHeight) / (min(-0.001, eyeRay.y));\r\n\t\tvec3 pos = cameraPos + far * eyeRay;\r\n\r\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\r\n\t\tfloat depth = exp((-cameraHeight) * (1.0/scaleDepth));\r\n\t\tfloat cameraAngle = dot(-eyeRay, pos);\r\n\t\tfloat lightAngle = dot(-u_SunLight.direction, pos);\r\n\t\tfloat cameraScale = scaleAngle(cameraAngle);\r\n\t\tfloat lightScale = scaleAngle(lightAngle);\r\n\t\tfloat cameraOffset = depth*cameraScale;\r\n\t\tfloat temp = lightScale + cameraScale;\r\n\r\n\t\t// Initialize the scattering loop variables\r\n\t\tfloat sampleLength = far / samples;\r\n\t\tfloat scaledLength = sampleLength * scale;\r\n\t\tvec3 sampleRay = eyeRay * sampleLength;\r\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\r\n\r\n\t\t// Now loop through the sample rays\r\n\t\tvec3 frontColor = vec3(0.0, 0.0, 0.0);\r\n\t\tvec3 attenuate;\r\n\r\n\t\t// Loop removed because we kept hitting SM2.0 temp variable limits. Doesn't affect the image too much.\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat scatter = depth*temp - cameraOffset;\r\n\t\t\tattenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\r\n\t\tcIn = frontColor * (invWavelength * krESun + kmESun);\r\n\t\tcOut = clamp(attenuate, 0.0, 1.0);\r\n\t}\r\n\r\n\t#ifdef SUN_HIGH_QUALITY\r\n\t\tv_Vertex = -a_Position.xyz;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tv_RayDir = -eyeRay;\r\n\t#else\r\n\t\tv_SkyGroundFactor = -eyeRay.y / SKY_GROUND_THRESHOLD;\r\n\t#endif\r\n\r\n\t// if we want to calculate color in vprog:\r\n\t// in case of linear: multiply by _Exposure in here (even in case of lerp it will be common multiplier, so we can skip mul in fshader)\r\n\tv_GroundColor = u_Exposure * (cIn + u_GroundTint*u_GroundTint * cOut);//u_GroundColor*u_GroundColor is gamma space convert to linear space\r\n\tv_SkyColor    = u_Exposure * (cIn * getRayleighPhase(-u_SunLight.direction, -eyeRay));\r\n\r\n\t\r\n\t// The sun should have a stable intensity in its course in the sky. Moreover it should match the highlight of a purely specular material.\r\n\t// This matching was done using the Unity3D standard shader BRDF1 on the 5/31/2017\r\n\t// Finally we want the sun to be always bright even in LDR thus the normalization of the lightColor for low intensity.\r\n\tfloat lightColorIntensity = clamp(length(u_SunLight.color), 0.25, 1.0);\r\n\r\n\t#ifdef SUN_HIGH_QUALITY \r\n\t\tv_SunColor = HDSundiskIntensityFactor * clamp(cOut,0.0,1.0) * u_SunLight.color / lightColorIntensity;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tv_SunColor = simpleSundiskIntensityFactor * clamp(cOut * sunScale,0.0,1.0) * u_SunLight.color / lightColorIntensity;\r\n\t#endif\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}\r\n";var nr="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\nuniform sampler2D u_MainTexture;\r\nuniform vec4 u_MainColor;\r\n\r\nvarying vec2 v_Texcoord0;\r\nvarying vec4 v_Color;\r\n\r\nvoid main()\r\n{\r\n\tvec4 color = 2.0 * u_MainColor * v_Color;\r\n\t#ifdef MAINTEXTURE\r\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\r\n\t\tcolor *= mainTextureColor;\r\n\t#endif\r\n\tgl_FragColor = color;\r\n}\r\n\r\n     ";var or='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n#include "Lighting.glsl";\r\n\r\nattribute vec3 a_Position;\r\nattribute vec3 a_OffsetVector;\r\nattribute vec4 a_Color;\r\nattribute float a_Texcoord0X;\r\nattribute float a_Texcoord0Y;\r\nattribute float a_BirthTime;\r\n\r\nuniform mat4 u_View;\r\nuniform mat4 u_Projection;\r\n\r\nuniform vec4 u_TilingOffset;\r\n\r\nuniform float u_CurTime;\r\nuniform float u_LifeTime;\r\nuniform vec4 u_WidthCurve[10];\r\nuniform int u_WidthCurveKeyLength;\r\n\r\nvarying vec2 v_Texcoord0;\r\nvarying vec4 v_Color;\r\n\r\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\r\n{\r\n\tfloat t2 = t * t;\r\n\tfloat t3 = t2 * t;\r\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\tfloat b = t3 - 2.0 * t2 + t;\r\n\tfloat c = t3 - t2;\r\n\tfloat d = -2.0 * t3 + 3.0 * t2;\r\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\r\n}\r\n\r\nfloat getCurWidth(in float normalizeTime)\r\n{\r\n\tfloat width;\r\n\tif(normalizeTime == 0.0){\r\n\t\twidth=u_WidthCurve[0].w;\r\n\t}\r\n\telse if(normalizeTime >= 1.0){\r\n\t\twidth=u_WidthCurve[u_WidthCurveKeyLength - 1].w;\r\n\t}\r\n\telse{\r\n\t\tfor(int i = 0; i < 10; i ++ )\r\n\t\t{\r\n\t\t\tif(normalizeTime == u_WidthCurve[i].x){\r\n\t\t\t\twidth=u_WidthCurve[i].w;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\r\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\r\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\r\n\t\t\t{\r\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\r\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\r\n\t\t\t\tfloat outTangent = lastFrame.z;\r\n\t\t\t\tfloat inTangent = nextFrame.y;\r\n\t\t\t\tfloat value1 = lastFrame.w;\r\n\t\t\t\tfloat value2 = nextFrame.w;\r\n\t\t\t\twidth=hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn width;\r\n}\t\r\n\r\nvoid main()\r\n{\r\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\r\n\t\r\n\t#ifdef TILINGOFFSET\r\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, 1.0 - a_Texcoord0Y) * u_TilingOffset.xy + u_TilingOffset.zw;\r\n\t#else\r\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\r\n\t#endif\r\n\t\r\n\tv_Color = a_Color;\r\n\t\r\n\tgl_Position = u_Projection * u_View * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}\r\n';var lr="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef ALBEDOTEXTURE\r\n\tuniform sampler2D u_AlbedoTexture;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\nuniform vec4 u_AlbedoColor;\r\n\r\n#ifdef ALPHATEST\r\n\tuniform float u_AlphaTestValue;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\t#ifdef ADDTIVEFOG\r\n\t#else\r\n\t\tuniform vec3 u_FogColor;\r\n\t#endif\r\n#endif\r\n\r\nvoid main()\r\n{\r\n\tvec4 color =  u_AlbedoColor;\r\n\t#ifdef ALBEDOTEXTURE\r\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\r\n\t#endif\r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tcolor *= v_Color;\r\n\t#endif\r\n\t\r\n\t#ifdef ALPHATEST\r\n\t\tif(color.a < u_AlphaTestValue)\r\n\t\t\tdiscard;\r\n\t#endif\r\n\t\r\n\tgl_FragColor = color;\r\n\t\r\n\t#ifdef FOG\r\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\r\n\t\t#ifdef ADDTIVEFOG\r\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\r\n\t\t#else\r\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\r\n\t\t#endif\r\n\t#endif\r\n\t\r\n}\r\n\r\n";var _r='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl";\r\n\r\nattribute vec4 a_Position;\r\n\r\nattribute vec2 a_Texcoord0;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\n\r\nattribute vec4 a_Color;\r\nvarying vec4 v_Color;\r\nvarying vec2 v_Texcoord0;\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\nvoid main() {\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\r\n\t#ifdef TILINGOFFSET\r\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t#else\r\n\t\tv_Texcoord0=a_Texcoord0;\r\n\t#endif\r\n\r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tv_Color = a_Color;\r\n\t#endif\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';var hr='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#ifdef MAINTEXTURE\r\n\tuniform sampler2D u_MainTexture;\r\n#endif\r\n\r\n#ifdef NORMALTEXTURE\r\n\tuniform sampler2D u_NormalTexture;\r\n#endif\r\n\r\nuniform vec4 u_HorizonColor;\r\n\r\nvarying vec3 v_Normal;\r\nvarying vec3 v_Tangent;\r\nvarying vec3 v_Binormal;\r\nvarying vec3 v_ViewDir;\r\nvarying vec2 v_Texcoord0;\r\nvarying vec2 v_Texcoord1;\r\n\r\n\r\n#include "Lighting.glsl"\r\n\r\n\r\n\r\nvec3 NormalSampleToWorldSpace(vec4 normalMapSample) {\r\n\tvec3 normalT;\r\n\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\r\n\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\r\n\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\r\n\r\n\tvec3 bumpedNormal = normalize(normalT);\r\n\r\n\treturn bumpedNormal;\r\n}\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec4 bumpColor1 = texture2D(u_NormalTexture, v_Texcoord0);\r\n\tvec4 bumpColor2 = texture2D(u_NormalTexture, v_Texcoord1);\r\n\r\n\tvec3 normal1 = NormalSampleToWorldSpace(bumpColor1);\r\n\tvec3 normal2 = NormalSampleToWorldSpace(bumpColor2);\r\n\t\r\n\tvec3 normal = normalize((normal1 + normal2) * 0.5);\r\n\tvec3 viewDir = normalize(v_ViewDir);\r\n\tfloat fresnel = dot(viewDir, normal);\r\n\t\r\n\tvec4 waterColor = texture2D(u_MainTexture, vec2(fresnel, fresnel));\r\n\t\r\n\tvec4 color;\r\n\tcolor.rgb = mix(waterColor.rgb, u_HorizonColor.rgb, vec3(waterColor.a));\r\n\tcolor.a = u_HorizonColor.a;\r\n\t\r\n\tgl_FragColor = color;\r\n}\r\n\r\n\r\n';var xr='#include "Lighting.glsl";\r\n\r\nattribute vec4 a_Position;\r\nattribute vec3 a_Normal;\r\nattribute vec4 a_Tangent0;\r\n\r\nuniform mat4 u_MvpMatrix;\r\nuniform mat4 u_WorldMat;\r\nuniform vec3 u_CameraPos;\r\nuniform float u_WaveScale;\r\nuniform vec4 u_WaveSpeed;\r\nuniform float u_Time;\r\n\r\nvarying vec3 v_Normal;\r\nvarying vec3 v_Tangent;\r\nvarying vec3 v_Binormal;\r\nvarying vec3 v_ViewDir;\r\nvarying vec2 v_Texcoord0;\r\nvarying vec2 v_Texcoord1;\r\n\r\nvoid main()\r\n{\r\n\tvec4 positionWorld = u_WorldMat * a_Position;\r\n\tvec4 position = u_MvpMatrix * a_Position;\r\n\t\r\n\tvec4 temp = vec4(positionWorld.x, positionWorld.z, positionWorld.x, positionWorld.z) * u_WaveScale + u_WaveSpeed * u_WaveScale * u_Time;\r\n\t\r\n\tv_Texcoord0 = temp.xy * vec2(0.4, 0.45);\r\n\tv_Texcoord1 = temp.wz;\r\n\t\r\n\tmat3 worldMat = mat3(u_WorldMat);\r\n\tv_Normal = worldMat * a_Normal;\r\n\tv_Tangent = worldMat * a_Tangent0.xyz;\r\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\r\n\t\r\n\tv_ViewDir = u_CameraPos - positionWorld.xyz;\r\n\tgl_Position = position;\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}';class cr{constructor(){}static __init__(){P.SHADERDEFINE_LEGACYSINGALLIGHTING=P.getDefineByName("LEGACYSINGLELIGHTING");P.SHADERDEFINE_GRAPHICS_API_GLES2=P.getDefineByName("GRAPHICS_API_GLES2");P.SHADERDEFINE_GRAPHICS_API_GLES3=P.getDefineByName("GRAPHICS_API_GLES3");P.addInclude("Lighting.glsl",Ci);P.addInclude("ShadowSampleTent.glsl",Ri);P.addInclude("GlobalIllumination.glsl",Si);P.addInclude("Shadow.glsl",$i);P.addInclude("ShadowCasterVS.glsl",tr);P.addInclude("ShadowCasterFS.glsl",er);P.addInclude("Colors.glsl",qi);P.addInclude("Sampling.glsl",Qi);P.addInclude("StdLib.glsl",Ji);P.addInclude("PBRVSInput.glsl",Vi);P.addInclude("PBRFSInput.glsl",Ui);P.addInclude("LayaPBRBRDF.glsl",Bi);P.addInclude("PBRCore.glsl",Fi);P.addInclude("PBRVertex.glsl",ki);P.addInclude("LayaUtile.glsl",Ai);var t={a_Position:K.MESH_POSITION0,a_Color:K.MESH_COLOR0,a_Normal:K.MESH_NORMAL0,a_Texcoord0:K.MESH_TEXTURECOORDINATE0,a_Texcoord1:K.MESH_TEXTURECOORDINATE1,a_BoneWeights:K.MESH_BLENDWEIGHT0,a_BoneIndices:K.MESH_BLENDINDICES0,a_Tangent0:K.MESH_TANGENT0,a_MvpMatrix:K.MESH_MVPMATRIX_ROW0,a_WorldMat:K.MESH_WORLDMATRIX_ROW0};var e={u_Bones:P.PERIOD_CUSTOM,u_DiffuseTexture:P.PERIOD_MATERIAL,u_SpecularTexture:P.PERIOD_MATERIAL,u_NormalTexture:P.PERIOD_MATERIAL,u_AlphaTestValue:P.PERIOD_MATERIAL,u_DiffuseColor:P.PERIOD_MATERIAL,u_MaterialSpecular:P.PERIOD_MATERIAL,u_Shininess:P.PERIOD_MATERIAL,u_TilingOffset:P.PERIOD_MATERIAL,u_WorldMat:P.PERIOD_SPRITE,u_MvpMatrix:P.PERIOD_SPRITE,u_LightmapScaleOffset:P.PERIOD_SPRITE,u_LightMap:P.PERIOD_SPRITE,u_LightMapDirection:P.PERIOD_SPRITE,u_SimpleAnimatorTexture:P.PERIOD_SPRITE,u_SimpleAnimatorParams:P.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:P.PERIOD_SPRITE,u_CameraPos:P.PERIOD_CAMERA,u_Viewport:P.PERIOD_CAMERA,u_ProjectionParams:P.PERIOD_CAMERA,u_View:P.PERIOD_CAMERA,u_ViewProjection:P.PERIOD_CAMERA,u_ReflectTexture:P.PERIOD_SCENE,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE,u_DirationLightCount:P.PERIOD_SCENE,u_LightBuffer:P.PERIOD_SCENE,u_LightClusterBuffer:P.PERIOD_SCENE,u_AmbientColor:P.PERIOD_SCENE,u_ShadowBias:P.PERIOD_SCENE,u_ShadowLightDirection:P.PERIOD_SCENE,u_ShadowMap:P.PERIOD_SCENE,u_ShadowParams:P.PERIOD_SCENE,u_ShadowSplitSpheres:P.PERIOD_SCENE,u_ShadowMatrices:P.PERIOD_SCENE,u_ShadowMapSize:P.PERIOD_SCENE,u_SpotShadowMap:P.PERIOD_SCENE,u_SpotViewProjectMatrix:P.PERIOD_SCENE,u_ShadowLightPosition:P.PERIOD_SCENE,u_AmbientSHAr:P.PERIOD_SCENE,u_AmbientSHAg:P.PERIOD_SCENE,u_AmbientSHAb:P.PERIOD_SCENE,u_AmbientSHBr:P.PERIOD_SCENE,u_AmbientSHBg:P.PERIOD_SCENE,u_AmbientSHBb:P.PERIOD_SCENE,u_AmbientSHC:P.PERIOD_SCENE,"u_DirectionLight.color":P.PERIOD_SCENE,"u_DirectionLight.direction":P.PERIOD_SCENE,"u_PointLight.position":P.PERIOD_SCENE,"u_PointLight.range":P.PERIOD_SCENE,"u_PointLight.color":P.PERIOD_SCENE,"u_SpotLight.position":P.PERIOD_SCENE,"u_SpotLight.direction":P.PERIOD_SCENE,"u_SpotLight.range":P.PERIOD_SCENE,"u_SpotLight.spot":P.PERIOD_SCENE,"u_SpotLight.color":P.PERIOD_SCENE};var a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};var i=P.add("BLINNPHONG",null,null,true);var r=new ha(t,e);i.addSubShader(r);r.addShaderPass(Di,Mi,a,"Forward");var s=r.addShaderPass(Pi,wi,a,"ShadowCaster");t={a_Position:K.MESH_POSITION0,a_Color:K.MESH_COLOR0};e={u_MvpMatrix:P.PERIOD_SPRITE,u_Color:P.PERIOD_MATERIAL};a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};i=P.add("LineShader");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(Ii,Li,a);t={a_Position:K.MESH_POSITION0,a_Color:K.MESH_COLOR0,a_Texcoord0:K.MESH_TEXTURECOORDINATE0,a_BoneWeights:K.MESH_BLENDWEIGHT0,a_BoneIndices:K.MESH_BLENDINDICES0,a_MvpMatrix:K.MESH_MVPMATRIX_ROW0};e={u_Bones:P.PERIOD_CUSTOM,u_AlbedoTexture:P.PERIOD_MATERIAL,u_AlbedoColor:P.PERIOD_MATERIAL,u_TilingOffset:P.PERIOD_MATERIAL,u_AlphaTestValue:P.PERIOD_MATERIAL,u_MvpMatrix:P.PERIOD_SPRITE,u_SimpleAnimatorTexture:P.PERIOD_SPRITE,u_SimpleAnimatorParams:P.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:P.PERIOD_SPRITE,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE};a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};i=P.add("Unlit",null,null,true);r=new ha(t,e);i.addSubShader(r);r.addShaderPass(_r,lr,a);t={a_Position:K.MESH_POSITION0,a_Texcoord0:K.MESH_TEXTURECOORDINATE0,a_BoneWeights:K.MESH_BLENDWEIGHT0,a_BoneIndices:K.MESH_BLENDINDICES0,a_MvpMatrix:K.MESH_MVPMATRIX_ROW0};e={u_Bones:P.PERIOD_CUSTOM,u_AlbedoTexture:P.PERIOD_MATERIAL,u_AlbedoColor:P.PERIOD_MATERIAL,u_TilingOffset:P.PERIOD_MATERIAL,u_AlphaTestValue:P.PERIOD_MATERIAL,u_MvpMatrix:P.PERIOD_SPRITE,u_SimpleAnimatorTexture:P.PERIOD_SPRITE,u_SimpleAnimatorParams:P.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:P.PERIOD_SPRITE,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE};a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};i=P.add("Effect",null,null,true);r=new ha(t,e);i.addSubShader(r);r.addShaderPass(Ti,yi,a);t={a_CornerTextureCoordinate:g.PARTICLE_CORNERTEXTURECOORDINATE0,a_MeshPosition:g.PARTICLE_POSITION0,a_MeshColor:g.PARTICLE_COLOR0,a_MeshTextureCoordinate:g.PARTICLE_TEXTURECOORDINATE0,a_ShapePositionStartLifeTime:g.PARTICLE_SHAPEPOSITIONSTARTLIFETIME,a_DirectionTime:g.PARTICLE_DIRECTIONTIME,a_StartColor:g.PARTICLE_STARTCOLOR0,a_EndColor:g.PARTICLE_ENDCOLOR0,a_StartSize:g.PARTICLE_STARTSIZE,a_StartRotation0:g.PARTICLE_STARTROTATION,a_StartSpeed:g.PARTICLE_STARTSPEED,a_Random0:g.PARTICLE_RANDOM0,a_Random1:g.PARTICLE_RANDOM1,a_SimulationWorldPostion:g.PARTICLE_SIMULATIONWORLDPOSTION,a_SimulationWorldRotation:g.PARTICLE_SIMULATIONWORLDROTATION};e={u_Tintcolor:P.PERIOD_MATERIAL,u_TilingOffset:P.PERIOD_MATERIAL,u_texture:P.PERIOD_MATERIAL,u_WorldPosition:P.PERIOD_SPRITE,u_WorldRotation:P.PERIOD_SPRITE,u_PositionScale:P.PERIOD_SPRITE,u_SizeScale:P.PERIOD_SPRITE,u_ScalingMode:P.PERIOD_SPRITE,u_Gravity:P.PERIOD_SPRITE,u_ThreeDStartRotation:P.PERIOD_SPRITE,u_StretchedBillboardLengthScale:P.PERIOD_SPRITE,u_StretchedBillboardSpeedScale:P.PERIOD_SPRITE,u_SimulationSpace:P.PERIOD_SPRITE,u_CurrentTime:P.PERIOD_SPRITE,u_ColorOverLifeGradientAlphas:P.PERIOD_SPRITE,u_ColorOverLifeGradientColors:P.PERIOD_SPRITE,u_MaxColorOverLifeGradientAlphas:P.PERIOD_SPRITE,u_MaxColorOverLifeGradientColors:P.PERIOD_SPRITE,u_VOLVelocityConst:P.PERIOD_SPRITE,u_VOLVelocityGradientX:P.PERIOD_SPRITE,u_VOLVelocityGradientY:P.PERIOD_SPRITE,u_VOLVelocityGradientZ:P.PERIOD_SPRITE,u_VOLVelocityConstMax:P.PERIOD_SPRITE,u_VOLVelocityGradientMaxX:P.PERIOD_SPRITE,u_VOLVelocityGradientMaxY:P.PERIOD_SPRITE,u_VOLVelocityGradientMaxZ:P.PERIOD_SPRITE,u_VOLSpaceType:P.PERIOD_SPRITE,u_SOLSizeGradient:P.PERIOD_SPRITE,u_SOLSizeGradientX:P.PERIOD_SPRITE,u_SOLSizeGradientY:P.PERIOD_SPRITE,u_SOLSizeGradientZ:P.PERIOD_SPRITE,u_SOLSizeGradientMax:P.PERIOD_SPRITE,u_SOLSizeGradientMaxX:P.PERIOD_SPRITE,u_SOLSizeGradientMaxY:P.PERIOD_SPRITE,u_SOLSizeGradientMaxZ:P.PERIOD_SPRITE,u_ROLAngularVelocityConst:P.PERIOD_SPRITE,u_ROLAngularVelocityConstSeprarate:P.PERIOD_SPRITE,u_ROLAngularVelocityGradient:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientX:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientY:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientZ:P.PERIOD_SPRITE,u_ROLAngularVelocityConstMax:P.PERIOD_SPRITE,u_ROLAngularVelocityConstMaxSeprarate:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientMax:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxX:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxY:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxZ:P.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxW:P.PERIOD_SPRITE,u_TSACycles:P.PERIOD_SPRITE,u_TSASubUVLength:P.PERIOD_SPRITE,u_TSAGradientUVs:P.PERIOD_SPRITE,u_TSAMaxGradientUVs:P.PERIOD_SPRITE,u_CameraPos:P.PERIOD_CAMERA,u_CameraDirection:P.PERIOD_CAMERA,u_CameraUp:P.PERIOD_CAMERA,u_View:P.PERIOD_CAMERA,u_Projection:P.PERIOD_CAMERA,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE};a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};i=P.add("PARTICLESHURIKEN");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(Ni,Oi,a);t={a_Position:K.MESH_POSITION0};e={u_TintColor:P.PERIOD_MATERIAL,u_Exposure:P.PERIOD_MATERIAL,u_Rotation:P.PERIOD_MATERIAL,u_CubeTexture:P.PERIOD_MATERIAL,u_ViewProjection:P.PERIOD_CAMERA};i=P.add("SkyBox");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(ir,ar);t={a_Position:K.MESH_POSITION0};e={u_SunSize:P.PERIOD_MATERIAL,u_SunSizeConvergence:P.PERIOD_MATERIAL,u_AtmosphereThickness:P.PERIOD_MATERIAL,u_SkyTint:P.PERIOD_MATERIAL,u_GroundTint:P.PERIOD_MATERIAL,u_Exposure:P.PERIOD_MATERIAL,u_ViewProjection:P.PERIOD_CAMERA,"u_SunLight.direction":P.PERIOD_SCENE,"u_SunLight.color":P.PERIOD_SCENE};i=P.add("SkyBoxProcedural");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(sr,rr);t={a_Position:K.MESH_POSITION0,a_Normal:K.MESH_NORMAL0,a_Texcoord0:K.MESH_TEXTURECOORDINATE0};e={u_MvpMatrix:P.PERIOD_SPRITE,u_WorldMat:P.PERIOD_SPRITE,u_CameraPos:P.PERIOD_CAMERA,u_Viewport:P.PERIOD_CAMERA,u_ProjectionParams:P.PERIOD_CAMERA,u_View:P.PERIOD_CAMERA,u_LightmapScaleOffset:P.PERIOD_SPRITE,u_LightMap:P.PERIOD_SPRITE,u_SplatAlphaTexture:P.PERIOD_MATERIAL,u_DiffuseTexture1:P.PERIOD_MATERIAL,u_DiffuseTexture2:P.PERIOD_MATERIAL,u_DiffuseTexture3:P.PERIOD_MATERIAL,u_DiffuseTexture4:P.PERIOD_MATERIAL,u_DiffuseTexture5:P.PERIOD_MATERIAL,u_DiffuseScaleOffset1:P.PERIOD_MATERIAL,u_DiffuseScaleOffset2:P.PERIOD_MATERIAL,u_DiffuseScaleOffset3:P.PERIOD_MATERIAL,u_DiffuseScaleOffset4:P.PERIOD_MATERIAL,u_DiffuseScaleOffset5:P.PERIOD_MATERIAL,u_FogStart:P.PERIOD_SCENE,u_FogRange:P.PERIOD_SCENE,u_FogColor:P.PERIOD_SCENE,u_DirationLightCount:P.PERIOD_SCENE,u_LightBuffer:P.PERIOD_SCENE,u_LightClusterBuffer:P.PERIOD_SCENE,u_AmbientColor:P.PERIOD_SCENE,u_ShadowMap:P.PERIOD_SCENE,u_shadowMap2:P.PERIOD_SCENE,u_shadowMap3:P.PERIOD_SCENE,u_ShadowSplitSpheres:P.PERIOD_SCENE,u_ShadowMatrices:P.PERIOD_SCENE,u_ShadowMapSize:P.PERIOD_SCENE,"u_DirectionLight.color":P.PERIOD_SCENE,"u_DirectionLight.direction":P.PERIOD_SCENE,"u_PointLight.position":P.PERIOD_SCENE,"u_PointLight.range":P.PERIOD_SCENE,"u_PointLight.color":P.PERIOD_SCENE,"u_SpotLight.position":P.PERIOD_SCENE,"u_SpotLight.direction":P.PERIOD_SCENE,"u_SpotLight.range":P.PERIOD_SCENE,"u_SpotLight.spot":P.PERIOD_SCENE,"u_SpotLight.color":P.PERIOD_SCENE};a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};i=P.add("ExtendTerrain");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(bi,Ei,a);t={a_Position:ni.TRAIL_POSITION0,a_OffsetVector:ni.TRAIL_OFFSETVECTOR,a_Texcoord0X:ni.TRAIL_TEXTURECOORDINATE0X,a_Texcoord0Y:ni.TRAIL_TEXTURECOORDINATE0Y,a_BirthTime:ni.TRAIL_TIME0,a_Color:ni.TRAIL_COLOR};e={u_MvpMatrix:P.PERIOD_SPRITE,u_View:P.PERIOD_CAMERA,u_Projection:P.PERIOD_CAMERA,u_TilingOffset:P.PERIOD_MATERIAL,u_MainTexture:P.PERIOD_MATERIAL,u_MainColor:P.PERIOD_MATERIAL,u_CurTime:P.PERIOD_SPRITE,u_LifeTime:P.PERIOD_SPRITE,u_WidthCurve:P.PERIOD_SPRITE,u_WidthCurveKeyLength:P.PERIOD_SPRITE,u_GradientColorkey:P.PERIOD_SPRITE,u_GradientAlphakey:P.PERIOD_SPRITE};a={s_Cull:P.RENDER_STATE_CULL,s_Blend:P.RENDER_STATE_BLEND,s_BlendSrc:P.RENDER_STATE_BLEND_SRC,s_BlendDst:P.RENDER_STATE_BLEND_DST,s_DepthTest:P.RENDER_STATE_DEPTH_TEST,s_DepthWrite:P.RENDER_STATE_DEPTH_WRITE};i=P.add("Trail");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(or,nr,a);t={a_Position:K.MESH_POSITION0,a_Normal:K.MESH_NORMAL0,a_Tangent0:K.MESH_TANGENT0};e={u_MvpMatrix:P.PERIOD_SPRITE,u_WorldMat:P.PERIOD_SPRITE,u_CameraPos:P.PERIOD_CAMERA,u_Time:P.PERIOD_SCENE,u_MainTexture:P.PERIOD_MATERIAL,u_NormalTexture:P.PERIOD_MATERIAL,u_HorizonColor:P.PERIOD_MATERIAL,u_WaveScale:P.PERIOD_MATERIAL,u_WaveSpeed:P.PERIOD_MATERIAL};i=P.add("WaterPrimary");r=new ha(t,e);i.addSubShader(r);r.addShaderPass(xr,hr);t={a_PositionTexcoord:K.MESH_POSITION0};e={u_MainTex:P.PERIOD_MATERIAL,u_OffsetScale:P.PERIOD_MATERIAL};i=P.add("BlitScreen");r=new ha(t,e);i.addSubShader(r);var s=r.addShaderPass(vi,gi);var n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;t={a_PositionTexcoord:K.MESH_POSITION0};e={u_MainTex:P.PERIOD_MATERIAL,u_BloomTex:P.PERIOD_MATERIAL,u_AutoExposureTex:P.PERIOD_MATERIAL,u_MainTex_TexelSize:P.PERIOD_MATERIAL,u_SampleScale:P.PERIOD_MATERIAL,u_Threshold:P.PERIOD_MATERIAL,u_Params:P.PERIOD_MATERIAL};i=P.add("PostProcessBloom");r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Gi,Wi);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Gi,Xi);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Gi,Hi);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Gi,zi);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Gi,ji);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Gi,Yi);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE;t={a_PositionTexcoord:K.MESH_POSITION0};e={u_MainTex:P.PERIOD_MATERIAL,u_BloomTex:P.PERIOD_MATERIAL,u_AutoExposureTex:P.PERIOD_MATERIAL,u_Bloom_DirtTileOffset:P.PERIOD_MATERIAL,u_Bloom_DirtTex:P.PERIOD_MATERIAL,u_BloomTex_TexelSize:P.PERIOD_MATERIAL,u_Bloom_Settings:P.PERIOD_MATERIAL,u_Bloom_Color:P.PERIOD_MATERIAL};i=P.add("PostProcessComposite");r=new ha(t,e);i.addSubShader(r);s=r.addShaderPass(Ki,Zi);n=s.renderState;n.depthTest=p.DEPTHTEST_ALWAYS;n.depthWrite=false;n.cull=p.CULL_NONE;n.blend=p.BLEND_DISABLE}}class dr extends $t{constructor(){super();this._direction=new St;this._shadowCascadesMode=H.ShadowCascadesMode.NoCascades;this._shadowTwoCascadeSplits=1/3;this._shadowFourCascadeSplits=new St(1/15,3/15,7/15);this._lightType=H.LightType.Directional}get shadowCascadesMode(){return this._shadowCascadesMode}set shadowCascadesMode(t){this._shadowCascadesMode=t}get shadowTwoCascadeSplits(){return this._shadowTwoCascadeSplits}set shadowTwoCascadeSplits(t){this._shadowTwoCascadeSplits=t}get shadowFourCascadeSplits(){return this._shadowFourCascadeSplits}set shadowFourCascadeSplits(t){if(t.x>t.y||t.y>t.z||t.z>1)throw"DiretionLight:Invalid value.";t.cloneTo(this._shadowFourCascadeSplits)}_addToLightQueue(){this._scene._directionLights.add(this)}_removeFromLightQueue(){this._scene._directionLights.remove(this)}_create(){return new dr}}class ur extends $t{constructor(){super();this._range=6;this._lightType=H.LightType.Point}get range(){return this._range}set range(t){this._range=t}_addToLightQueue(){this._scene._pointLights.add(this)}_removeFromLightQueue(){this._scene._pointLights.remove(this)}_parse(t,e){super._parse(t,e);this.range=t.range}_cloneTo(t,e,a){super._cloneTo(t,e,a);var i=t;i.range=this.range;i._lightType=H.LightType.Point}_create(){return new ur}}class fr extends $t{constructor(){super();this._spotAngle=30;this._range=10;this._direction=new St;this._lightType=H.LightType.Spot}get spotAngle(){return this._spotAngle}set spotAngle(t){this._spotAngle=Math.max(Math.min(t,179),0)}get range(){return this._range}set range(t){this._range=t}_addToLightQueue(){this._scene._spotLights.add(this)}_removeFromLightQueue(){this._scene._spotLights.remove(this)}_parse(t,e){super._parse(t,e);this.range=t.range;this.spotAngle=t.spotAngle}_cloneTo(t,e,a){super._cloneTo(t,e,a);var i=t;i.range=this.range;i.spotAngle=this.spotAngle}_create(){return new fr}}class pr extends ii{constructor(t){super(t);this._simpleAnimatorParams=new bt;this._simpleAnimatorOffset=new Ct;this._shaderValues.addDefine(ai.SHADERDEFINE_SIMPLEBONE);this._shaderValues.addDefine(ai.SHADERDEFINE_BONE)}get simpleAnimatorTexture(){return this._simpleAnimatorTexture}set simpleAnimatorTexture(t){this._simpleAnimatorTexture=t;this._simpleAnimatorTextureSize=t.width;this._shaderValues.setTexture(pr.SIMPLE_SIMPLEANIMATORTEXTURE,t);t._addReference();this._shaderValues.setNumber(pr.SIMPLE_SIMPLEANIMATORTEXTURESIZE,this._simpleAnimatorTextureSize)}get simpleAnimatorOffset(){return this._simpleAnimatorOffset}set simpleAnimatorOffset(t){t.cloneTo(this._simpleAnimatorOffset)}_computeAnimatorParamsData(){if(this._cacheMesh){this._simpleAnimatorParams.x=this._simpleAnimatorOffset.x;this._simpleAnimatorParams.y=Math.round(this._simpleAnimatorOffset.y)*this._bonesNums*4}}_createRenderElement(){return new ze}_setCacheAnimator(t){this._cacheAnimator=t;this._shaderValues.addDefine(ai.SHADERDEFINE_SIMPLEBONE)}_onMeshChange(t){super._onMeshChange(t);this._cacheMesh=t}_renderUpdate(t,e){var a=t.renderElement;switch(a.renderType){case ie.RENDERTYPE_NORMAL:if(this._cacheAnimator){var i=this._cacheAnimator.owner.transform.worldMatrix;this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,i)}else{this._shaderValues.setMatrix4x4(Bt.WORLDMATRIX,e.worldMatrix)}this._computeAnimatorParamsData();this._shaderValues.setVector(pr.SIMPLE_SIMPLEANIMATORPARAMS,this._simpleAnimatorParams);break;case ie.RENDERTYPE_INSTANCEBATCH:var r=He.instance.instanceWorldMatrixData;var s=a.instanceBatchElementList;var n=s.elements;var o=s.length;if(this._cacheAnimator){for(var l=0;l<o;l++){var _=n[l].render._cacheAnimator.owner._transform.worldMatrix;r.set(_.elements,l*16)}}else{for(var l=0;l<o;l++)r.set(n[l]._transform.worldMatrix.elements,l*16)}var h=He.instance.instanceWorldMatrixBuffer;h.orphanStorage();h.setData(r.buffer,0,0,o*16*4);this._shaderValues.addDefine(ya.SHADERDEFINE_GPU_INSTANCE);var x=He.instance.instanceSimpleAnimatorData;if(this._cacheAnimator){for(var l=0;l<o;l++){var c=n[l].render;c._computeAnimatorParamsData();var d=c._simpleAnimatorParams;var u=l*4;x[u]=d.x;x[u+1]=d.y}}else{for(var l=0;l<o;l++){x[u]=0;x[u+1]=0}}var f=He.instance.instanceSimpleAnimatorBuffer;f.orphanStorage();f.setData(x.buffer,0,0,o*4*4);break}}_renderUpdateWithCamera(t,e){var a=t.projectionViewMatrix;if(a){var i=t.renderElement;switch(i.renderType){case ie.RENDERTYPE_NORMAL:if(this._cacheAnimator){var r=this._cacheAnimator.owner._transform.worldMatrix;k.multiply(a,r,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}else{k.multiply(a,e.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(Bt.MVPMATRIX,this._projectionViewWorldMatrix)}break;case ie.RENDERTYPE_INSTANCEBATCH:var s=He.instance.instanceMVPMatrixData;var n=i.instanceBatchElementList;var o=n.elements;var l=n.length;if(this._cacheAnimator){for(var _=0;_<l;_++){var h=o[_].render._cacheAnimator.owner._transform.worldMatrix;F.mulMatrixByArray(a.elements,0,h.elements,0,s,_*16)}}else{for(var _=0;_<l;_++){var h=o[_]._transform.worldMatrix;F.mulMatrixByArray(a.elements,0,h.elements,0,s,_*16)}}var x=He.instance.instanceMVPMatrixBuffer;x.orphanStorage();x.setData(s.buffer,0,0,l*16*4);break}}}_destroy(){if(this._cacheRootBone)!this._cacheRootBone.destroyed&&this._cacheRootBone.transform.off(Et.Event.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange);this._simpleAnimatorTexture&&this._simpleAnimatorTexture._removeReference();this._simpleAnimatorTexture=null}}class mr extends ke{constructor(t=null,e=null){super(e);this._meshFilter=new Ea(this);this._render=new pr(this);t&&(this._meshFilter.sharedMesh=t)}static __init__(){pr.SIMPLE_SIMPLEANIMATORPARAMS=mr.SIMPLE_SIMPLEANIMATORPARAMS;pr.SIMPLE_SIMPLEANIMATORTEXTURE=mr.SIMPLE_SIMPLEANIMATORTEXTURE;pr.SIMPLE_SIMPLEANIMATORTEXTURESIZE=mr.SIMPLE_SIMPLEANIMATORTEXTURESIZE}get meshFilter(){return this._meshFilter}get simpleSkinnedMeshRenderer(){return this._render}_parse(t,e){super._parse(t,e);var a=this.simpleSkinnedMeshRenderer;var i=t.lightmapIndex;i!=null&&(a.lightmapIndex=i);var r=t.lightmapScaleOffset;r&&(a.lightmapScaleOffset=new bt(r[0],r[1],r[2],r[3]));t.enableRender!=undefined&&(a.enable=t.enableRender);t.receiveShadows!=undefined&&(a.receiveShadow=t.receiveShadows);t.castShadow!=undefined&&(a.castShadow=t.castShadow);var s;s=t.meshPath;if(s){var n=Et.Loader.getRes(s);n&&(this.meshFilter.sharedMesh=n)}var o=t.materials;if(o){var l=a.sharedMaterials;var _=o.length;l.length=_;for(var h=0;h<_;h++){l[h]=Et.Loader.getRes(o[h].path)}a.sharedMaterials=l}var x=t.boundBox;var c=x.min;var d=x.max;a.localBounds.setMin(new St(c[0],c[1],c[2]));a.localBounds.setMax(new St(d[0],d[1],d[2]));if(e){var u=t.rootBone;a.rootBone=e[u];var f=t.bones;var p;for(h=0,p=f.length;h<p;h++)a.bones.push(e[f[h]]);a._bonesNums=t.bonesNums?t.bonesNums:a.bones.length}else{t.rootBone&&a._setRootBone(t.rootBone)}var m=t.animatorTexture;if(m){var g=Et.Loader.getRes(m);a.simpleAnimatorTexture=g}}_changeHierarchyAnimator(t){super._changeHierarchyAnimator(t);this.simpleSkinnedMeshRenderer._setCacheAnimator(t)}_cloneTo(t,e,a){var i=t;i.meshFilter.sharedMesh=this.meshFilter.sharedMesh;var r=this._render;var s=i._render;s.enable=r.enable;s.sharedMaterials=r.sharedMaterials;s.castShadow=r.castShadow;var n=r.lightmapScaleOffset;n&&(s.lightmapScaleOffset=n.clone());s.receiveShadow=r.receiveShadow;s.sortingFudge=r.sortingFudge;s._rootBone=r._rootBone;var o=r.bones;var l=s.bones;var _=o.length;l.length=_;var h=r.rootBone;if(h){var x=F._getHierarchyPath(e,h,mr._tempArray0);if(x)s.rootBone=F._getNodeByHierarchyPath(a,x);else s.rootBone=h}for(var c=0;c<o.length;c++){x=F._getHierarchyPath(e,o[c],mr._tempArray0);if(x)l[c]=F._getNodeByHierarchyPath(a,x);else l[c]=o[c]}var d=r.localBounds;d&&d.cloneTo(s.localBounds);s.simpleAnimatorOffset=r.simpleAnimatorOffset;s.simpleAnimatorTexture=r.simpleAnimatorTexture;s._bonesNums=r._bonesNums;super._cloneTo(t,e,a)}destroy(t=true){if(this.destroyed)return;super.destroy(t);this._meshFilter.destroy()}_create(){return new mr}}mr._tempArray0=[];mr.SIMPLE_SIMPLEANIMATORTEXTURE=P.propertyNameToID("u_SimpleAnimatorTexture");mr.SIMPLE_SIMPLEANIMATORPARAMS=P.propertyNameToID("u_SimpleAnimatorParams");mr.SIMPLE_SIMPLEANIMATORTEXTURESIZE=P.propertyNameToID("u_SimpleAnimatorTextureSize");class gr{static _createSprite3DInstance(t,e,a){var i;switch(t.type){case"Scene3D":i=new N;break;case"Sprite3D":i=new Bt;break;case"MeshSprite3D":i=new Ca;a&&t.props.isStatic&&a.push(i);break;case"SkinnedMeshSprite3D":i=new ri;break;case"SimpleSkinnedMeshSprite3D":i=new mr;break;case"ShuriKenParticle3D":i=new ei;break;case"Camera":i=new ae;break;case"DirectionLight":i=new dr;break;case"PointLight":i=new ur;break;case"SpotLight":i=new fr;break;case"TrailSprite3D":i=new hi;break;case"ReflectionProbe":i=new je;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var r=t.child;if(r){for(var s=0,n=r.length;s<n;s++){var o=gr._createSprite3DInstance(r[s],e,a);i.addChild(o)}}e[t.instanceID]=i;return i}static _createComponentInstance(t,e,a){var i=e[t.instanceID];i._parse(t.props,e);var r=t.child;if(r){for(var s=0,n=r.length;s<n;s++)gr._createComponentInstance(r[s],e,a)}var o=t.components;if(o){for(var l=0,_=o.length;l<_;l++){var h=o[l];var x=Et.ClassUtils.getRegClass(h.type);if(x){var c=i.addComponent(x);c._parse(h,a)}else{console.warn("Unkown component type.")}}}}static _createNodeByJson02(t,e){var a={};var i={component:[],data:[]};var r=gr._createSprite3DInstance(t,a,e);gr._createComponentInstance(t,a,i);gr._createInteractInstance(i,a);return r}static _createInteractInstance(t,e){var a=t.component;var i=t.data;for(var r=0,s=a.length;r<s;r++){a[r]._parseInteractive(i[r],e)}}static _parse(t,e=null,a=null){var i=t.data;var r=[];var s;switch(t.version){case"LAYAHIERARCHY:02":s=gr._createNodeByJson02(i,r);break;default:s=gr._createNodeByJson(i,r)}We.combine(s,r);return s}static _parseScene(t,e=null,a=null){var i=t.data;var r=[];var s;switch(t.version){case"LAYASCENE3D:02":s=gr._createNodeByJson02(i,r);break;default:s=gr._createNodeByJson(i,r)}We.combine(null,r);return s}static _createNodeByJson(t,e){var a;switch(t.type){case"Scene3D":a=new N;break;case"Sprite3D":a=new Bt;break;case"MeshSprite3D":a=new Ca;e&&t.props.isStatic&&e.push(a);break;case"SkinnedMeshSprite3D":a=new ri;break;case"ShuriKenParticle3D":a=new ei;break;case"Camera":a=new ae;break;case"DirectionLight":a=new dr;break;case"PointLight":a=new ur;break;case"SpotLight":a=new fr;break;case"TrailSprite3D":a=new hi;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var i=t.child;if(i){for(var r=0,s=i.length;r<s;r++){var n=gr._createNodeByJson(i[r],e);a.addChild(n)}}var o=t.components;if(o){for(var l=0,_=o.length;l<_;l++){var h=o[l];var x=Et.ClassUtils.getRegClass(h.type);if(x){var c=a.addComponent(x);c._parse(h)}else{console.warn("Unkown component type.")}}}a._parse(t.props,null);return a}}class R{static parse(t,e,a,i){R._mesh=a;R._subMeshes=i;R._version=e;R._readData=t;R.READ_DATA();R.READ_BLOCK();R.READ_STRINGS();for(var r=0,s=R._BLOCK.count;r<s;r++){R._readData.pos=R._BLOCK.blockStarts[r];var n=R._readData.getUint16();var o=R._strings[n];var l=R["READ_"+o];if(l==null)throw new Error("model file err,no this function:"+n+" "+o);else l.call(null)}R._strings.length=0;R._readData=null;R._version=null;R._mesh=null;R._subMeshes=null}static _readString(){return R._strings[R._readData.getUint16()]}static READ_DATA(){R._DATA.offset=R._readData.getUint32();R._DATA.size=R._readData.getUint32()}static READ_BLOCK(){var t=R._BLOCK.count=R._readData.getUint16();var e=R._BLOCK.blockStarts=[];var a=R._BLOCK.blockLengths=[];for(var i=0;i<t;i++){e.push(R._readData.getUint32());a.push(R._readData.getUint32())}}static READ_STRINGS(){var t=R._readData.getUint32();var e=R._readData.getUint16();var a=R._readData.pos;R._readData.pos=t+R._DATA.offset;for(var i=0;i<e;i++)R._strings[i]=R._readData.readUTFString();R._readData.pos=a}static READ_MESH(){var t=Et.LayaGL.instance;var e=R._readString();var a=R._readData.__getBuffer();var i;var r=0;var s=R._readData.getInt16();var n=R._DATA.offset;for(i=0;i<s;i++){var o=n+R._readData.getUint32();var l=R._readData.getUint32();var _=a.slice(o,o+l);var h=new Float32Array(_);var x=R._readString();var c;switch(R._version){case"LAYAMODEL:0301":case"LAYAMODEL:0400":c=K.getVertexDeclaration(x);break;case"LAYAMODEL:0401":c=K.getVertexDeclaration(x,false);break;default:throw new Error("LoadModelV03: unknown version.")}if(!c)throw new Error("LoadModelV03: unknown vertexDeclaration.");var d=new vt(h.length*4,t.STATIC_DRAW,true);d.vertexDeclaration=c;d.setData(h.buffer);R._mesh._vertexBuffer=d;R._mesh._vertexCount+=d._byteLength/c.vertexStride;r+=h.length*4}var u=n+R._readData.getUint32();var f=R._readData.getUint32();var p=new Uint16Array(a.slice(u,u+f));var m=new jt(H.IndexFormat.UInt16,f/2,t.STATIC_DRAW,true);m.setData(p);R._mesh._indexBuffer=m;r+=m.indexCount*2;R._mesh._setBuffer(R._mesh._vertexBuffer,m);R._mesh._setCPUMemory(r);R._mesh._setGPUMemory(r);var g=R._mesh._boneNames=[];var v=R._readData.getUint16();g.length=v;for(i=0;i<v;i++)g[i]=R._strings[R._readData.getUint16()];R._readData.pos+=8;var y=R._readData.getUint32();var T=R._readData.getUint32();var E=new Float32Array(a.slice(n+y,n+y+T));var b=E.length;var S=R._mesh._inverseBindPosesBuffer=new ArrayBuffer(b*4);R._mesh._inverseBindPoses=[];if(b!=0)R._mesh._instanceBufferStateType=pi.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR;else R._mesh._instanceBufferStateType=pi.MESH_INSTANCEBUFFER_TYPE_NORMAL;R._mesh._setInstanceBuffer(R._mesh._instanceBufferStateType);for(i=0;i<b;i+=16){var C=new k(E[i+0],E[i+1],E[i+2],E[i+3],E[i+4],E[i+5],E[i+6],E[i+7],E[i+8],E[i+9],E[i+10],E[i+11],E[i+12],E[i+13],E[i+14],E[i+15],new Float32Array(S,i*4,16));R._mesh._inverseBindPoses[i/16]=C}return true}static READ_SUBMESH(){var t=R._readData.__getBuffer();var e=new ui(R._mesh);R._readData.getInt16();R._readData.getUint32();R._readData.getUint32();var a=R._readData.getUint32();var i=R._readData.getUint32();var r=R._mesh._indexBuffer;e._indexBuffer=r;e._setIndexRange(a,i);var s=R._mesh._vertexBuffer;e._vertexBuffer=s;var n=R._DATA.offset;var o=e._subIndexBufferStart;var l=e._subIndexBufferCount;var _=e._boneIndicesList;var h=R._readData.getUint16();o.length=h;l.length=h;_.length=h;var x=R._mesh._skinnedMatrixCaches;var c=R._subMeshes.length;x.length=R._mesh._inverseBindPoses.length;for(var d=0;d<h;d++){o[d]=R._readData.getUint32();l[d]=R._readData.getUint32();var u=R._readData.getUint32();var f=R._readData.getUint32();var p=_[d]=new Uint16Array(t.slice(n+u,n+u+f));var m=p.length;for(var g=0;g<m;g++){var v=p[g];x[v]||(x[v]=new fi(c,d,g))}}R._subMeshes.push(e);return true}}R._BLOCK={count:0};R._DATA={offset:0,size:0};R._strings=[];class G{static parse(t,e,a,i){G._mesh=a;G._subMeshes=i;G._version=e;G._readData=t;G.READ_DATA();G.READ_BLOCK();G.READ_STRINGS();for(var r=0,s=G._BLOCK.count;r<s;r++){G._readData.pos=G._BLOCK.blockStarts[r];var n=G._readData.getUint16();var o=G._strings[n];var l=G["READ_"+o];if(l==null)throw new Error("model file err,no this function:"+n+" "+o);else l.call(null)}G._strings.length=0;G._readData=null;G._version=null;G._mesh=null;G._subMeshes=null}static _readString(){return G._strings[G._readData.getUint16()]}static READ_DATA(){G._DATA.offset=G._readData.getUint32();G._DATA.size=G._readData.getUint32()}static READ_BLOCK(){var t=G._BLOCK.count=G._readData.getUint16();var e=G._BLOCK.blockStarts=[];var a=G._BLOCK.blockLengths=[];for(var i=0;i<t;i++){e.push(G._readData.getUint32());a.push(G._readData.getUint32())}}static READ_STRINGS(){var t=G._readData.getUint32();var e=G._readData.getUint16();var a=G._readData.pos;G._readData.pos=t+G._DATA.offset;for(var i=0;i<e;i++)G._strings[i]=G._readData.readUTFString();G._readData.pos=a}static READ_MESH(){var t=Et.LayaGL.instance;var e;var a=0;var B=G._readString();var i=G._readData;var r=i.__getBuffer();var s=i.getInt16();var n=G._DATA.offset;for(e=0;e<s;e++){var o=n+i.getUint32();var l=i.getUint32();var _=G._readString();var h=K.getVertexDeclaration(_,false);var x=h.vertexStride;var c;var d;var u;var f=_.split(",");var p=f.length;var m=G._mesh;switch(G._version){case"LAYAMODEL:05":case"LAYAMODEL:0501":c=r.slice(o,o+l*x);d=new Float32Array(c);u=new Uint8Array(c);break;case"LAYAMODEL:COMPRESSION_05":case"LAYAMODEL:COMPRESSION_0501":c=new ArrayBuffer(x*l);d=new Float32Array(c);u=new Uint8Array(c);var g=i.pos;i.pos=o;for(var v=0;v<l;v++){var y;var T=v*x;for(var E=0;E<p;E++){switch(f[E]){case"POSITION":y=T/4;d[y]=Et.HalfFloatUtils.convertToNumber(i.getUint16());d[y+1]=Et.HalfFloatUtils.convertToNumber(i.getUint16());d[y+2]=Et.HalfFloatUtils.convertToNumber(i.getUint16());T+=12;break;case"NORMAL":y=T/4;d[y]=i.getUint8()/127.5-1;d[y+1]=i.getUint8()/127.5-1;d[y+2]=i.getUint8()/127.5-1;T+=12;break;case"COLOR":y=T/4;d[y]=i.getUint8()/255;d[y+1]=i.getUint8()/255;d[y+2]=i.getUint8()/255;d[y+3]=i.getUint8()/255;T+=16;break;case"UV":y=T/4;d[y]=Et.HalfFloatUtils.convertToNumber(i.getUint16());d[y+1]=Et.HalfFloatUtils.convertToNumber(i.getUint16());T+=8;break;case"UV1":y=T/4;d[y]=Et.HalfFloatUtils.convertToNumber(i.getUint16());d[y+1]=Et.HalfFloatUtils.convertToNumber(i.getUint16());T+=8;break;case"BLENDWEIGHT":y=T/4;d[y]=i.getUint8()/255;d[y+1]=i.getUint8()/255;d[y+2]=i.getUint8()/255;d[y+3]=i.getUint8()/255;T+=16;break;case"BLENDINDICES":u[T]=i.getUint8();u[T+1]=i.getUint8();u[T+2]=i.getUint8();u[T+3]=i.getUint8();T+=4;break;case"TANGENT":y=T/4;d[y]=i.getUint8()/127.5-1;d[y+1]=i.getUint8()/127.5-1;d[y+2]=i.getUint8()/127.5-1;d[y+3]=i.getUint8()/127.5-1;T+=16;break}}}i.pos=g;break}var b=new vt(c.byteLength,t.STATIC_DRAW,true);b.vertexDeclaration=h;b.setData(c);var l=b._byteLength/h.vertexStride;if(l>65535)m._indexFormat=H.IndexFormat.UInt32;else m._indexFormat=H.IndexFormat.UInt16;m._vertexBuffer=b;m._vertexCount+=l;a+=d.length*4}var S=n+i.getUint32();var C=i.getUint32();var R;if(m.indexFormat==H.IndexFormat.UInt32)R=new Uint32Array(r.slice(S,S+C));else R=new Uint16Array(r.slice(S,S+C));var A=new jt(m.indexFormat,R.length,t.STATIC_DRAW,true);A.setData(R);m._indexBuffer=A;m._setBuffer(m._vertexBuffer,A);a+=A.indexCount*2;m._setCPUMemory(a);m._setGPUMemory(a);if(G._version=="LAYAMODEL:0501"||G._version=="LAYAMODEL:COMPRESSION_0501"){var L=m.bounds;var I=L.getMin();var M=L.getMax();I.setValue(i.getFloat32(),i.getFloat32(),i.getFloat32());M.setValue(i.getFloat32(),i.getFloat32(),i.getFloat32());L.setMin(I);L.setMax(M);m.bounds=L}var D=m._boneNames=[];var w=i.getUint16();D.length=w;for(e=0;e<w;e++)D[e]=G._strings[i.getUint16()];var P=i.getUint32();var F=i.getUint32();var O=new Float32Array(r.slice(n+P,n+P+F));var N=O.length;var V=m._inverseBindPosesBuffer=new ArrayBuffer(N*4);m._inverseBindPoses=[];if(N!=0)m._instanceBufferStateType=pi.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR;else m._instanceBufferStateType=pi.MESH_INSTANCEBUFFER_TYPE_NORMAL;m._setInstanceBuffer(m._instanceBufferStateType);for(e=0;e<N;e+=16){var U=new k(O[e+0],O[e+1],O[e+2],O[e+3],O[e+4],O[e+5],O[e+6],O[e+7],O[e+8],O[e+9],O[e+10],O[e+11],O[e+12],O[e+13],O[e+14],O[e+15],new Float32Array(V,e*4,16));m._inverseBindPoses[e/16]=U}return true}static READ_SUBMESH(){var t=G._readData;var e=t.__getBuffer();var a=new ui(G._mesh);t.getInt16();var i=t.getUint32();var r=t.getUint32();var s=G._mesh._indexBuffer;a._indexBuffer=s;a._setIndexRange(i,r);var n=G._mesh._vertexBuffer;a._vertexBuffer=n;var o=G._DATA.offset;var l=a._subIndexBufferStart;var _=a._subIndexBufferCount;var h=a._boneIndicesList;var x=t.getUint16();l.length=x;_.length=x;h.length=x;var c=G._mesh._skinnedMatrixCaches;var d=G._subMeshes.length;c.length=G._mesh._inverseBindPoses.length;for(var u=0;u<x;u++){l[u]=t.getUint32();_[u]=t.getUint32();var f=t.getUint32();var p=t.getUint32();var m=h[u]=new Uint16Array(e.slice(o+f,o+f+p));for(var g=0,v=m.length;g<v;g++){var y=m[g];c[y]||(c[y]=new fi(d,u,g))}}G._subMeshes.push(a);return true}}G._BLOCK={count:0};G._DATA={offset:0,size:0};G._strings=[];class vr{static _parse(t,e=null,a=null){var i=new pi;vr.read(t,i,i._subMeshes);return i}static read(t,e,a){var i=new Et.Byte(t);i.pos=0;var r=i.readUTFString();switch(r){case"LAYAMODEL:0301":case"LAYAMODEL:0400":case"LAYAMODEL:0401":R.parse(i,r,e,a);break;case"LAYAMODEL:05":case"LAYAMODEL:COMPRESSION_05":case"LAYAMODEL:0501":case"LAYAMODEL:COMPRESSION_0501":G.parse(i,r,e,a);break;default:throw new Error("MeshReader: unknown mesh version.")}e._setSubMeshes(a);if(r!="LAYAMODEL:0501"&&r!="LAYAMODEL:COMPRESSION_0501")e.calculateBounds()}}var yr='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n#else\r\n\tprecision mediump float;\r\n#endif\r\n\r\n#define PI 3.14159265359\r\n#include "Lighting.glsl";\r\n\r\nuniform sampler2D u_Texture;\r\nuniform vec4 u_TextureHDRParams;\r\nuniform vec4 u_TintColor;\r\n\r\nvarying vec3 v_Texcoord;\r\nvarying vec2 v_Image180ScaleAndCutoff;\r\nvarying vec4 v_Layout3DScaleAndOffset;\r\n\r\nvec2 ToRadialCoords(vec3 coords)\r\n{\r\n\tvec3 normalizedCoords = normalize(coords);\r\n\tfloat latitude = acos(normalizedCoords.y);\r\n\tfloat longitude = atan(normalizedCoords.z,normalizedCoords.x);\r\n\tvec2 sphereCoords = vec2(longitude, latitude) * vec2(0.5/PI, 1.0/PI);\r\n\treturn vec2(0.5,1.0) - sphereCoords;\r\n}\r\n\r\n\r\nvoid main()\r\n{\t\r\n\tvec2 tc = ToRadialCoords(v_Texcoord);\r\n\tif (tc.x > v_Image180ScaleAndCutoff.y)\r\n\t\tgl_FragColor=vec4(0,0,0,1);\r\n\ttc.x = mod(tc.x*v_Image180ScaleAndCutoff.x, 1.0);\r\n\ttc = (tc + v_Layout3DScaleAndOffset.xy) * v_Layout3DScaleAndOffset.zw;\r\n\r\n\tmediump vec4 tex = texture2D (u_Texture, tc);\r\n\tmediump vec3 c = decodeHDR (tex, u_TextureHDRParams.x);\r\n\tc = c * u_TintColor.rgb * 2.0;//Gamma Space is 2.0,linear space is 4.59479380\r\n\tgl_FragColor=vec4(c, 1.0);\r\n}\r\n\r\n';var Tr='#include "Lighting.glsl";\r\n\r\n#define PI 3.14159265359\r\n\r\nattribute vec4 a_Position;\r\n\r\nuniform mat4 u_ViewProjection;\r\nuniform float u_Rotation;\r\n\r\nvarying vec3 v_Texcoord;\r\nvarying vec2 v_Image180ScaleAndCutoff;\r\nvarying vec4 v_Layout3DScaleAndOffset;\r\n\r\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\r\n{\r\n\tfloat angle = degrees * PI / 180.0;\r\n\tfloat sina=sin(angle);\r\n\tfloat cosa=cos(angle);\r\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\r\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\r\n}\r\n\r\n\t\t\r\nvoid main()\r\n{\r\n\tvec4 position = rotateAroundYInDegrees(a_Position, u_Rotation);\r\n\tgl_Position = u_ViewProjection*position;\r\n\r\n\tv_Texcoord=vec3(-a_Position.x,-a_Position.y,a_Position.z);// NOTE: -a_Position.x convert coords system\r\n\r\n\t// Calculate constant horizontal scale and cutoff for 180 (vs 360) image type\r\n\tv_Image180ScaleAndCutoff = vec2(1.0, 1.0);// 360 degree mode\r\n\r\n\t// Calculate constant scale and offset for 3D layouts\r\n\tv_Layout3DScaleAndOffset = vec4(0,0,1,1);\r\n}\r\n';class Er extends s{constructor(){super();this._exposure=1;this._textureDecodeFormat=Et.TextureDecodeFormat.Normal;this._textureHDRParams=new bt(1,0,0,1);this.setShaderName("SkyPanoramic");var t=this._shaderValues;t.setVector(Er.TINTCOLOR,new bt(.5,.5,.5,.5));t.setNumber(Er.ROTATION,0);t.setVector(Er.TEXTURE_HDR_PARAMS,this._textureHDRParams)}static __init__(){var t={a_Position:K.MESH_POSITION0};var e={u_TintColor:P.PERIOD_MATERIAL,u_TextureHDRParams:P.PERIOD_MATERIAL,u_Rotation:P.PERIOD_MATERIAL,u_Texture:P.PERIOD_MATERIAL,u_ViewProjection:P.PERIOD_CAMERA};var a=P.add("SkyPanoramic");var i=new ha(t,e);a.addSubShader(i);i.addShaderPass(Tr,yr)}get tintColor(){return this._shaderValues.getVector(Er.TINTCOLOR)}set tintColor(t){this._shaderValues.setVector(Er.TINTCOLOR,t)}get exposure(){return this._exposure}set exposure(t){if(this._exposure!==t){this._exposure=t;if(this._textureDecodeFormat==Et.TextureDecodeFormat.RGBM)this._textureHDRParams.x=t*Et.BaseTexture._rgbmRange;else this._textureHDRParams.x=t}}get rotation(){return this._shaderValues.getNumber(Er.ROTATION)}set rotation(t){this._shaderValues.setNumber(Er.ROTATION,t)}get panoramicTexture(){return this._shaderValues.getTexture(Er.TEXTURE)}set panoramicTexture(t){this._shaderValues.setTexture(Er.TEXTURE,t)}get panoramicTextureDecodeFormat(){return this._textureDecodeFormat}set panoramicTextureDecodeFormat(t){if(this._textureDecodeFormat!==t){this._textureDecodeFormat=t;if(t==Et.TextureDecodeFormat.RGBM)this._textureHDRParams.x=this._exposure*Et.BaseTexture._rgbmRange;else this._textureHDRParams.x=this._exposure}}}Er.TINTCOLOR=P.propertyNameToID("u_TintColor");Er.EXPOSURE=P.propertyNameToID("u_Exposure");Er.ROTATION=P.propertyNameToID("u_Rotation");Er.TEXTURE=P.propertyNameToID("u_Texture");Er.TEXTURE_HDR_PARAMS=P.propertyNameToID("u_TextureHDRParams");class br extends Et.Component{constructor(t){super();this._anchor=new St;this._connectAnchor=new St;this._feedbackEnabled=false;this._getJointFeedBack=false;this._currentForce=new St;this._currentTorque=new St;this._constraintType=t;var e=$._bullet;this._btframATrans=e.btTransform_create();this._btframBTrans=e.btTransform_create();e.btTransform_setIdentity(this._btframATrans);e.btTransform_setIdentity(this._btframBTrans);this._btframAPos=e.btVector3_create(0,0,0);this._btframBPos=e.btVector3_create(0,0,0);e.btTransform_setOrigin(this._btframATrans,this._btframAPos);e.btTransform_setOrigin(this._btframBTrans,this._btframBPos);this._breakForce=-1;this._breakTorque=-1}get enabled(){return super.enabled}set enabled(t){super.enabled=t}get appliedImpulse(){if(!this._feedbackEnabled){this._btConstraint.EnableFeedback(true);this._feedbackEnabled=true}return this._btConstraint.AppliedImpulse}set connectedBody(t){this._connectedBody=t;t&&(t.constaintRigidbodyB=this)}get connectedBody(){return this._connectedBody}get ownBody(){return this._ownBody}set ownBody(t){this._ownBody=t;t.constaintRigidbodyA=this}get currentForce(){if(!this._getJointFeedBack)this._getFeedBackInfo();return this._currentForce}get currentTorque(){if(!this._getJointFeedBack)this._getFeedBackInfo();return this._currentTorque}get breakForce(){return this._breakForce}set breakForce(t){this._breakForce=t}get breakTorque(){return this._breakTorque}set breakTorque(t){this._breakTorque=t}set anchor(t){t.cloneTo(this._anchor);this.setFrames()}get anchor(){return this._anchor}set connectAnchor(t){t.cloneTo(this._connectAnchor);this.setFrames()}get connectAnchor(){return this._connectAnchor}setOverrideNumSolverIterations(t){var e=$._bullet;e.btTypedConstraint_setOverrideNumSolverIterations(this._btConstraint,t)}setConstraintEnabled(t){var e=$._bullet;e.btTypedConstraint_setEnabled(this._btConstraint,t)}_onEnable(){super._onEnable();this.enabled=true}_onDisable(){super._onDisable();this.enabled=false}setFrames(){var t=$._bullet;t.btVector3_setValue(this._btframAPos,-this._anchor.x,this.anchor.y,this.anchor.z);t.btVector3_setValue(this._btframBPos,-this._connectAnchor.x,this._connectAnchor.y,this._connectAnchor.z);t.btTransform_setOrigin(this._btframATrans,this._btframAPos);t.btTransform_setOrigin(this._btframBTrans,this._btframBPos)}_addToSimulation(){}_removeFromSimulation(){}_createConstraint(){}setConnectRigidBody(t,e){var a=t&&!!(t._simulation&&t._enabled&&t.colliderShape);var i=e&&!!(e._simulation&&e._enabled&&e.colliderShape);if(!(a&&i))throw"ownerRigid or connectRigidBody is not in Simulation";if(t!=this._ownBody||e!=this._connectedBody){var r=!!(this.enabled&&this._simulation);r&&this._removeFromSimulation();this._ownBody=t;this._connectedBody=e;this._ownBody.constaintRigidbodyA=this;this._connectedBody.constaintRigidbodyB=this;this._createConstraint()}}getcurrentForce(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=$._bullet;var a=e.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(a),e.btVector3_y(a),e.btVector3_z(a));return}getcurrentTorque(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=$._bullet;var a=e.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(a),e.btVector3_y(a),e.btVector3_z(a));return}_onDestroy(){var t=$._bullet;this._simulation&&this._removeFromSimulation();if(this._btConstraint&&this._btJointFeedBackObj&&this._simulation){t.btTypedConstraint_destroy(this._btConstraint);t.btJointFeedback_destroy(this._btJointFeedBackObj);this._btJointFeedBackObj=null;this._btConstraint=null}super._onDisable()}_isBreakConstrained(){this._getJointFeedBack=false;if(this.breakForce==-1&&this.breakTorque==-1)return false;this._getFeedBackInfo();var t=this._breakForce!=-1&&St.scalarLength(this._currentForce)>this._breakForce;var e=this._breakTorque!=-1&&St.scalarLength(this._currentTorque)>this._breakTorque;if(t||e){this._breakConstrained();return true}return false}_parse(t){this._anchor.fromArray(t.anchor);this._connectAnchor.fromArray(t.connectAnchor);this.setFrames()}_getFeedBackInfo(){var t=$._bullet;var e=t.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);var a=t.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);this._currentTorque.setValue(t.btVector3_x(a),t.btVector3_y(a),t.btVector3_z(a));this._currentForce.setValue(t.btVector3_x(e),t.btVector3_y(e),t.btVector3_z(e));this._getJointFeedBack=true}_breakConstrained(){this.ownBody.constaintRigidbodyA=null;this.connectedBody&&(this.connectedBody.constaintRigidbodyB=null);this.destroy()}}br.CONSTRAINT_POINT2POINT_CONSTRAINT_TYPE=3;br.CONSTRAINT_HINGE_CONSTRAINT_TYPE=4;br.CONSTRAINT_CONETWIST_CONSTRAINT_TYPE=5;br.CONSTRAINT_D6_CONSTRAINT_TYPE=6;br.CONSTRAINT_SLIDER_CONSTRAINT_TYPE=7;br.CONSTRAINT_CONTACT_CONSTRAINT_TYPE=8;br.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE=9;br.CONSTRAINT_GEAR_CONSTRAINT_TYPE=10;br.CONSTRAINT_FIXED_CONSTRAINT_TYPE=11;br.CONSTRAINT_MAX_CONSTRAINT_TYPE=12;br.CONSTRAINT_CONSTRAINT_ERP=1;br.CONSTRAINT_CONSTRAINT_STOP_ERP=2;br.CONSTRAINT_CONSTRAINT_CFM=3;br.CONSTRAINT_CONSTRAINT_STOP_CFM=4;br.tempForceV3=new St;class Sr extends br{constructor(){super(br.CONSTRAINT_FIXED_CONSTRAINT_TYPE);this.breakForce=-1;this.breakTorque=-1}_addToSimulation(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}_removeFromSimulation(){this._simulation.removeConstraint(this);this._simulation=null}_createConstraint(){if(this.ownBody&&this.ownBody._simulation&&this.connectedBody&&this.connectedBody._simulation){var t=$._bullet;this._btConstraint=t.btFixedConstraint_create(this.ownBody.btColliderObject,this._btframATrans,this.connectedBody.btColliderObject,this._btframBTrans);this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint);t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj);this._simulation=this.owner._scene.physicsSimulation;this._addToSimulation();$._bullet.btTypedConstraint_setEnabled(this._btConstraint,true)}}_onAdded(){super._onAdded()}_onEnable(){if(!this._btConstraint)return;super._onEnable();if(this._btConstraint)$._bullet.btTypedConstraint_setEnabled(this._btConstraint,true)}_onDisable(){super._onDisable();if(!this.connectedBody)this._removeFromSimulation();if(this._btConstraint)$._bullet.btTypedConstraint_setEnabled(this._btConstraint,false)}_onDestroy(){super._onDestroy()}_parse(t,e=null){super._parse(t);if(t.rigidbodyID!=-1&&t.connectRigidbodyID!=-1){e.component.push(this);e.data.push(t)}t.breakForce!=undefined&&(this.breakForce=t.breakForce);t.breakTorque!=undefined&&(this.breakTorque=t.breakTorque)}_parseInteractive(t=null,e=null){var a=e[t.rigidbodyID];var i=a.getComponent(J);var r=e[t.connectRigidbodyID];var s=r.getComponent(J);this.ownBody=i;this.connectedBody=s}_cloneTo(t){}}class y extends br{constructor(){super(br.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE);this._axis=new St;this._secondaryAxis=new St;this._minLinearLimit=new St;this._maxLinearLimit=new St;this._minAngularLimit=new St;this._maxAngularLimit=new St;this._linearLimitSpring=new St;this._angularLimitSpring=new St;this._linearBounce=new St;this._angularBounce=new St;this._linearDamp=new St;this._angularDamp=new St;this._xMotion=0;this._yMotion=0;this._zMotion=0;this._angularXMotion=0;this._angularYMotion=0;this._angularZMotion=0;var t=$._bullet;this._btAxis=t.btVector3_create(-1,0,0);this._btSecondaryAxis=t.btVector3_create(0,1,0)}get axis(){return this._axis}get secondaryAxis(){return this._secondaryAxis}set maxAngularLimit(t){t.cloneTo(this._maxAngularLimit)}set minAngularLimit(t){t.cloneTo(this._minAngularLimit)}get maxAngularLimit(){return this._maxAngularLimit}get minAngularLimit(){return this._minAngularLimit}set maxLinearLimit(t){t.cloneTo(this._maxLinearLimit)}set minLinearLimit(t){t.cloneTo(this._minLinearLimit)}get maxLinearLimit(){return this._maxLinearLimit}get minLinearLimit(){return this._minLinearLimit}set XMotion(t){if(this._xMotion!=t){this._xMotion=t;this.setLimit(y.MOTION_LINEAR_INDEX_X,t,-this._maxLinearLimit.x,-this._minLinearLimit.x)}}get XMotion(){return this._xMotion}set YMotion(t){if(this._yMotion!=t){this._yMotion=t;this.setLimit(y.MOTION_LINEAR_INDEX_Y,t,this._minLinearLimit.y,this._maxLinearLimit.y)}}get YMotion(){return this._yMotion}set ZMotion(t){if(this._zMotion!=t){this._zMotion=t;this.setLimit(y.MOTION_LINEAR_INDEX_Z,t,this._minLinearLimit.z,this._maxLinearLimit.z)}}get ZMotion(){return this._zMotion}set angularXMotion(t){if(this._angularXMotion!=t){this._angularXMotion=t;this.setLimit(y.MOTION_ANGULAR_INDEX_X,t,-this._maxAngularLimit.x,-this._minAngularLimit.x)}}get angularXMotion(){return this._angularXMotion}set angularYMotion(t){if(this._angularYMotion!=t){this._angularYMotion=t;this.setLimit(y.MOTION_ANGULAR_INDEX_Y,t,this._minAngularLimit.y,this._maxAngularLimit.y)}}get angularYMotion(){return this._angularYMotion}set angularZMotion(t){if(this._angularZMotion!=t){this._angularZMotion=t;this.setLimit(y.MOTION_ANGULAR_INDEX_Z,t,this._minAngularLimit.z,this._maxAngularLimit.z)}}get angularZMotion(){return this._angularZMotion}set linearLimitSpring(t){if(!St.equals(this._linearLimitSpring,t)){t.cloneTo(this._linearLimitSpring);this.setSpring(y.MOTION_LINEAR_INDEX_X,t.x);this.setSpring(y.MOTION_LINEAR_INDEX_Y,t.y);this.setSpring(y.MOTION_LINEAR_INDEX_Z,t.z)}}get linearLimitSpring(){return this._linearLimitSpring}set angularLimitSpring(t){if(!St.equals(this._angularLimitSpring,t)){t.cloneTo(this._angularLimitSpring);this.setSpring(y.MOTION_ANGULAR_INDEX_X,t.x);this.setSpring(y.MOTION_ANGULAR_INDEX_Y,t.y);this.setSpring(y.MOTION_ANGULAR_INDEX_Z,t.z)}}get angularLimitSpring(){return this._angularLimitSpring}set linearBounce(t){if(!St.equals(this._linearBounce,t)){t.cloneTo(this._linearBounce);this.setBounce(y.MOTION_LINEAR_INDEX_X,t.x);this.setBounce(y.MOTION_LINEAR_INDEX_Y,t.y);this.setBounce(y.MOTION_LINEAR_INDEX_Z,t.z)}}get linearBounce(){return this._linearBounce}set angularBounce(t){if(!St.equals(this._angularBounce,t)){t.cloneTo(this._angularBounce);this.setBounce(y.MOTION_ANGULAR_INDEX_X,t.x);this.setBounce(y.MOTION_ANGULAR_INDEX_Y,t.y);this.setBounce(y.MOTION_ANGULAR_INDEX_Z,t.z)}}get angularBounce(){return this._angularBounce}set linearDamp(t){if(!St.equals(this._linearDamp,t)){t.cloneTo(this._linearDamp);this.setDamping(y.MOTION_LINEAR_INDEX_X,t.x);this.setDamping(y.MOTION_LINEAR_INDEX_Y,t.y);this.setDamping(y.MOTION_LINEAR_INDEX_Z,t.z)}}get linearDamp(){return this._linearDamp}set angularDamp(t){if(!St.equals(this._angularDamp,t)){t.cloneTo(this._angularDamp);this.setDamping(y.MOTION_ANGULAR_INDEX_X,t.x);this.setDamping(y.MOTION_ANGULAR_INDEX_Y,t.y);this.setDamping(y.MOTION_ANGULAR_INDEX_Z,t.z)}}get angularDamp(){return this._angularDamp}set anchor(t){t.cloneTo(this._anchor);this.setFrames()}get anchor(){return this._anchor}set connectAnchor(t){t.cloneTo(this._connectAnchor);this.setFrames()}get connectAnchor(){return this._connectAnchor}setAxis(t,e){if(!this._btConstraint)return;var a=$._bullet;this._axis.setValue(t.x,t.y,t.y);this._secondaryAxis.setValue(e.x,e.y,e.z);this._btAxis=a.btVector3_setValue(-t.x,t.y,t.z);this._btSecondaryAxis=a.btVector3_setValue(-e.x,e.y,e.z);a.btGeneric6DofSpring2Constraint_setAxis(this._btConstraint,this._btAxis,this._btSecondaryAxis)}setLimit(t,e,a,i){if(!this._btConstraint)return;var r=$._bullet;switch(e){case y.CONFIG_MOTION_TYPE_LOCKED:r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,0,0);break;case y.CONFIG_MOTION_TYPE_LIMITED:if(a<i)r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,a,i);break;case y.CONFIG_MOTION_TYPE_FREE:r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,1,0);break;default:throw"No Type of Axis Motion"}}setSpring(t,e,a=true){if(!this._btConstraint)return;var i=$._bullet;var r=e>0;i.btGeneric6DofSpring2Constraint_enableSpring(this._btConstraint,t,r);if(r)i.btGeneric6DofSpring2Constraint_setStiffness(this._btConstraint,t,e,a)}setBounce(t,e){if(!this._btConstraint)return;var a=$._bullet;e=e<=0?0:e;a.btGeneric6DofSpring2Constraint_setBounce(this._btConstraint,t,e)}setDamping(t,e,a=true){if(!this._btConstraint)return;var i=$._bullet;e=e<=0?0:e;i.btGeneric6DofSpring2Constraint_setDamping(this._btConstraint,t,e,a)}setEquilibriumPoint(t,e){var a=$._bullet;a.btGeneric6DofSpring2Constraint_setEquilibriumPoint(this._btConstraint,t,e)}enableMotor(t,e){var a=$._bullet;a.btGeneric6DofSpring2Constraint_enableMotor(this._btConstraint,t,e)}setServo(t,e){var a=$._bullet;a.btGeneric6DofSpring2Constraint_setServo(this._btConstraint,t,e)}setTargetVelocity(t,e){var a=$._bullet;a.btGeneric6DofSpring2Constraint_setTargetVelocity(this._btConstraint,t,e)}setTargetPosition(t,e){var a=$._bullet;a.btGeneric6DofSpring2Constraint_setServoTarget(this._btConstraint,t,e)}setMaxMotorForce(t,e){var a=$._bullet;a.btGeneric6DofSpring2Constraint_setMaxMotorForce(this._btConstraint,t,e)}setParam(t,e,a){var i=$._bullet;i.btTypedConstraint_setParam(this._btConstraint,t,e,a)}setFrames(){super.setFrames();var t=$._bullet;if(!this._btConstraint)return;t.btGeneric6DofSpring2Constraint_setFrames(this._btConstraint,this._btframATrans,this._btframBTrans)}_addToSimulation(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}_removeFromSimulation(){this._simulation.removeConstraint(this);this._simulation=null}_createConstraint(){var t=$._bullet;this._btConstraint=t.btGeneric6DofSpring2Constraint_create(this.ownBody.btColliderObject,this._btframAPos,this.connectedBody.btColliderObject,this._btframBPos,y.RO_XYZ);this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint);t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj);this._simulation=this.owner._scene.physicsSimulation;this._initAllConstraintInfo();this._addToSimulation();$._bullet.btTypedConstraint_setEnabled(this._btConstraint,true)}_initAllConstraintInfo(){this.setLimit(y.MOTION_LINEAR_INDEX_X,this._xMotion,-this._maxLinearLimit.x,-this._minLinearLimit.x);this.setLimit(y.MOTION_LINEAR_INDEX_Y,this._yMotion,this._minLinearLimit.y,this._maxLinearLimit.y);this.setLimit(y.MOTION_LINEAR_INDEX_Z,this._zMotion,this._minLinearLimit.z,this._maxLinearLimit.z);this.setLimit(y.MOTION_ANGULAR_INDEX_X,this._angularXMotion,-this._maxAngularLimit.x,-this._minAngularLimit.x);this.setLimit(y.MOTION_ANGULAR_INDEX_Y,this._angularYMotion,this._minAngularLimit.y,this._maxAngularLimit.y);this.setLimit(y.MOTION_ANGULAR_INDEX_Z,this._angularZMotion,this._minAngularLimit.z,this._maxAngularLimit.z);this.setSpring(y.MOTION_LINEAR_INDEX_X,this._linearLimitSpring.x);this.setSpring(y.MOTION_LINEAR_INDEX_Y,this._linearLimitSpring.y);this.setSpring(y.MOTION_LINEAR_INDEX_Z,this._linearLimitSpring.z);this.setSpring(y.MOTION_ANGULAR_INDEX_X,this._angularLimitSpring.x);this.setSpring(y.MOTION_ANGULAR_INDEX_Y,this._angularLimitSpring.y);this.setSpring(y.MOTION_ANGULAR_INDEX_Z,this._angularLimitSpring.z);this.setBounce(y.MOTION_LINEAR_INDEX_X,this._linearBounce.x);this.setBounce(y.MOTION_LINEAR_INDEX_Y,this._linearBounce.y);this.setBounce(y.MOTION_LINEAR_INDEX_Z,this._linearBounce.z);this.setBounce(y.MOTION_ANGULAR_INDEX_X,this._angularBounce.x);this.setBounce(y.MOTION_ANGULAR_INDEX_Y,this._angularBounce.y);this.setBounce(y.MOTION_ANGULAR_INDEX_Z,this._angularBounce.z);this.setDamping(y.MOTION_LINEAR_INDEX_X,this._linearDamp.x);this.setDamping(y.MOTION_LINEAR_INDEX_Y,this._linearDamp.y);this.setDamping(y.MOTION_LINEAR_INDEX_Z,this._linearDamp.z);this.setDamping(y.MOTION_ANGULAR_INDEX_X,this._angularDamp.x);this.setDamping(y.MOTION_ANGULAR_INDEX_Y,this._angularDamp.y);this.setDamping(y.MOTION_ANGULAR_INDEX_Z,this._angularDamp.z);this.setFrames();this.setEquilibriumPoint(0,0)}_onAdded(){super._onAdded()}_onEnable(){if(!this._btConstraint)return;super._onEnable();if(this._btConstraint)$._bullet.btTypedConstraint_setEnabled(this._btConstraint,true)}_onDisable(){super._onDisable();if(!this.connectedBody&&this._simulation)this._removeFromSimulation();if(this._btConstraint)$._bullet.btTypedConstraint_setEnabled(this._btConstraint,false)}_parse(t,e=null){super._parse(t);this._axis.fromArray(t.axis);this._secondaryAxis.fromArray(t.secondaryAxis);var a=t.linearLimit;this._minLinearLimit.setValue(-a,-a,-a);this._maxLinearLimit.setValue(a,a,a);var i=t.linearLimitSpring;this._linearLimitSpring.setValue(i,i,i);var r=t.linearLimitDamper;this._linearDamp.setValue(r,r,r);var s=t.linearLimitBounciness;this._linearBounce.setValue(s,s,s);var n=t.lowAngularXLimit;var o=t.highAngularXLimit;var l=t.angularYLimit;var _=t.angularZLimit;this._minAngularLimit.setValue(n,-l,-_);this._maxAngularLimit.setValue(o,l,_);var h=t.highAngularXLimitBounciness;var x=t.angularYLimitBounciness;var c=t.angularZLimitBounciness;this._angularBounce.setValue(h,x,c);var d=t.angularXLimitSpring;var u=t.angularYZLimitSpring;this._angularLimitSpring.setValue(d,u,u);var f=t.angularXLimitDamper;var p=t.angularYZLimitDamper;this._angularDamp.setValue(f,p,p);this.XMotion=t.xMotion;this.YMotion=t.yMotion;this.ZMotion=t.zMotion;this.angularXMotion=t.angularXMotion;this.angularYMotion=t.angularYMotion;this.angularZMotion=t.angularZMotion;if(t.rigidbodyID!=-1&&t.connectRigidbodyID!=-1){e.component.push(this);e.data.push(t)}t.breakForce!=undefined&&(this.breakForce=t.breakForce);t.breakTorque!=undefined&&(this.breakTorque=t.breakTorque)}_parseInteractive(t=null,e=null){var a=e[t.rigidbodyID];var i=a.getComponent(J);var r=e[t.connectRigidbodyID];var s=r.getComponent(J);this.ownBody=i;this.connectedBody=s}_onDestroy(){super._onDestroy()}_cloneTo(t){}}y.CONFIG_MOTION_TYPE_LOCKED=0;y.CONFIG_MOTION_TYPE_LIMITED=1;y.CONFIG_MOTION_TYPE_FREE=2;y.MOTION_LINEAR_INDEX_X=0;y.MOTION_LINEAR_INDEX_Y=1;y.MOTION_LINEAR_INDEX_Z=2;y.MOTION_ANGULAR_INDEX_X=3;y.MOTION_ANGULAR_INDEX_Y=4;y.MOTION_ANGULAR_INDEX_Z=5;y.RO_XYZ=0;y.RO_XZY=1;y.RO_YXZ=2;y.RO_YZX=3;y.RO_ZXY=4;y.RO_ZYX=5;class X{constructor(){}static get enablePhysics(){return $._enablePhysics}static _cancelLoadByUrl(t){Et.Laya.loader.cancelLoadByUrl(t);X._innerFirstLevelLoaderManager.cancelLoadByUrl(t);X._innerSecondLevelLoaderManager.cancelLoadByUrl(t);X._innerThirdLevelLoaderManager.cancelLoadByUrl(t);X._innerFourthLevelLoaderManager.cancelLoadByUrl(t)}static _changeWebGLSize(t,e){Et.WebGL.onStageResize(t,e);pt.clientWidth=t;pt.clientHeight=e}static __init__(t,e,a){Et.Config.isAntialias=a.isAntialias;Et.Config.isAlpha=a.isAlpha;Et.Config.premultipliedAlpha=a.premultipliedAlpha;Et.Config.isStencil=a.isStencil;if(!Et.WebGL.enable()){alert("Laya3D init error,must support webGL!");return}Et.RunDriver.changeWebGLSize=X._changeWebGLSize;Et.Render.is3DMode=true;Et.Laya.init(t,e);if(!Et.Render.supportWebGLPlusRendering){Et.LayaGL.instance=Et.WebGLContext.mainContext;Et.LayaGL.instance.createCommandEncoder=function(t=128,e=64,a=false){return new Et.CommandEncoder(this,t,e,a)}}a._multiLighting=a.enableMultiLight&&Et.SystemUtils.supportTextureFormat(Et.TextureFormat.R32G32B32A32);D.Shader3D=P;D.Scene3D=N;D.MeshRenderStaticBatchManager=Ye;D.MeshRenderDynamicBatchManager=Sa;D.SubMeshDynamicBatch=ba;D.Laya3D=X;D.Matrix4x4=k;D.Physics3D=$;D.ShadowLightType=H.ShadowLightType;X.enableNative3D();if(a.isUseCannonPhysicsEngine)$.__cannoninit__();$.__bulletinit__();_.__init__();K.__init__();Ka.__init__();Qa.__init__();Ie.__init__();ni.__init__();xi.__init__();Ve.__init__();He.__init__();ba.__init__();cr.__init__();ee.init();c.__init__();pa.__init__();xa.__init__();Er.__init__();pi.__init__();mi.__init__();Bt.__init__();ke.__init__();Ca.__init__();ri.__init__();mr.__init__();ei.__init__();hi.__init__();le.__init__();N.__init__();Ye.__init__();s.__initDefine__();ce.__initDefine__();n.__initDefine__();ga.__initDefine__();u.__initDefine__();v.__initDefine__();l.__initDefine__();va.__initDefine__();m.__initDefine__();x.__initDefine__();Oe.__initDefine__();ma.__initDefine__();wt.__init__();Et.ClassUtils.regClass("Laya.SkyPanoramicMaterial",Er);Et.ClassUtils.regClass("Laya.EffectMaterial",l);Et.ClassUtils.regClass("Laya.UnlitMaterial",u);Et.ClassUtils.regClass("Laya.BlinnPhongMaterial",n);Et.ClassUtils.regClass("Laya.SkyProceduralMaterial",ga);Et.ClassUtils.regClass("Laya.PBRStandardMaterial",pa);Et.ClassUtils.regClass("Laya.PBRSpecularMaterial",xa);Et.ClassUtils.regClass("Laya.SkyBoxMaterial",ma);Et.ClassUtils.regClass("Laya.WaterPrimaryMaterial",va);Et.ClassUtils.regClass("Laya.ExtendTerrainMaterial",x);Et.ClassUtils.regClass("Laya.ShurikenParticleMaterial",m);Et.ClassUtils.regClass("Laya.TrailMaterial",v);Et.ClassUtils.regClass("Laya.PhysicsCollider",di);Et.ClassUtils.regClass("Laya.Rigidbody3D",J);Et.ClassUtils.regClass("Laya.CharacterController",Z);Et.ClassUtils.regClass("Laya.Animator",ft);Et.ClassUtils.regClass("PhysicsCollider",di);Et.ClassUtils.regClass("CharacterController",Z);Et.ClassUtils.regClass("Animator",ft);Et.ClassUtils.regClass("Rigidbody3D",J);Et.ClassUtils.regClass("FixedConstraint",Sr);Et.ClassUtils.regClass("ConfigurableConstraint",y);Oe.defaultMaterial=new Oe;n.defaultMaterial=new n;l.defaultMaterial=new l;u.defaultMaterial=new u;m.defaultMaterial=new m;v.defaultMaterial=new v;ga.defaultMaterial=new ga;ma.defaultMaterial=new ma;va.defaultMaterial=new va;Oe.defaultMaterial.lock=true;n.defaultMaterial.lock=true;l.defaultMaterial.lock=true;u.defaultMaterial.lock=true;m.defaultMaterial.lock=true;v.defaultMaterial.lock=true;ga.defaultMaterial.lock=true;ma.defaultMaterial.lock=true;va.defaultMaterial.lock=true;Et.Texture2D.__init__();De.__init__();Zt.__init__();Me.__init__();At.__init__();Lt.__init__();be.__init__();Et.HalfFloatUtils.__init__();var i=Et.LoaderManager.createMap;i["lh"]=[X.HIERARCHY,gr._parse];i["ls"]=[X.HIERARCHY,gr._parseScene];i["lm"]=[X.MESH,vr._parse];i["lmat"]=[X.MATERIAL,s._parse];i["jpg"]=[X.TEXTURE2D,Et.Texture2D._parse];i["jpeg"]=[X.TEXTURE2D,Et.Texture2D._parse];i["bmp"]=[X.TEXTURE2D,Et.Texture2D._parse];i["gif"]=[X.TEXTURE2D,Et.Texture2D._parse];i["png"]=[X.TEXTURE2D,Et.Texture2D._parse];i["dds"]=[X.TEXTURE2D,Et.Texture2D._parse];i["ktx"]=[X.TEXTURE2D,Et.Texture2D._parse];i["pvr"]=[X.TEXTURE2D,Et.Texture2D._parse];i["lani"]=[X.ANIMATIONCLIP,ht._parse];i["lav"]=[X.AVATAR,xe._parse];i["ltc"]=[X.TEXTURECUBE,De._parse];i["ltcb"]=[X.TEXTURECUBEBIN,De._parseBin];i["ltcb.ls"]=[X.TEXTURECUBEBIN,De._parseBin];i["lanit.ls"]=[X.TEXTURE2D,Et.Texture2D._SimpleAnimatorTextureParse];var r=Et.Loader.parserMap;r[X.HIERARCHY]=X._loadHierarchy;r[X.MESH]=X._loadMesh;r[X.MATERIAL]=X._loadMaterial;r[X.TEXTURECUBE]=X._loadTextureCube;r[X.TEXTURECUBEBIN]=X._loadTextureCubeBin;r[X.TEXTURE2D]=X._loadTexture2D;r[X.ANIMATIONCLIP]=X._loadAnimationClip;r[X.AVATAR]=X._loadAvatar;r[X.SIMPLEANIMATORBIN]=X._loadSimpleAnimator;X._innerFirstLevelLoaderManager.on(Et.Event.ERROR,null,X._eventLoadManagerError);X._innerSecondLevelLoaderManager.on(Et.Event.ERROR,null,X._eventLoadManagerError);X._innerThirdLevelLoaderManager.on(Et.Event.ERROR,null,X._eventLoadManagerError);X._innerFourthLevelLoaderManager.on(Et.Event.ERROR,null,X._eventLoadManagerError)}static enableNative3D(){var t=yt;var e=ge;if(Et.Render.supportWebGLPlusRendering){t.prototype._initData=t.prototype._initDataForNative;t.prototype.setBool=t.prototype.setBoolForNative;t.prototype.getBool=t.prototype.getBoolForNative;t.prototype.setInt=t.prototype.setIntForNative;t.prototype.getInt=t.prototype.getIntForNative;t.prototype.setNumber=t.prototype.setNumberForNative;t.prototype.getNumber=t.prototype.getNumberForNative;t.prototype.setVector=t.prototype.setVectorForNative;t.prototype.getVector=t.prototype.getVectorForNative;t.prototype.setVector2=t.prototype.setVector2ForNative;t.prototype.getVector2=t.prototype.getVector2ForNative;t.prototype.setVector3=t.prototype.setVector3ForNative;t.prototype.getVector3=t.prototype.getVector3ForNative;t.prototype.setQuaternion=t.prototype.setQuaternionForNative;t.prototype.getQuaternion=t.prototype.getQuaternionForNative;t.prototype.setMatrix4x4=t.prototype.setMatrix4x4ForNative;t.prototype.getMatrix4x4=t.prototype.getMatrix4x4ForNative;t.prototype.setBuffer=t.prototype.setBufferForNative;t.prototype.getBuffer=t.prototype.getBufferForNative;t.prototype.setTexture=t.prototype.setTextureForNative;t.prototype.getTexture=t.prototype.getTextureForNative;t.prototype.setAttribute=t.prototype.setAttributeForNative;t.prototype.getAttribute=t.prototype.getAttributeForNative;t.prototype.cloneTo=t.prototype.cloneToForNative;t.prototype.getData=t.prototype.getDataForNative;e.prototype._uniformMatrix2fv=e.prototype._uniformMatrix2fvForNative;e.prototype._uniformMatrix3fv=e.prototype._uniformMatrix3fvForNative;e.prototype._uniformMatrix4fv=e.prototype._uniformMatrix4fvForNative;Et.LayaGLRunner.uploadShaderUniforms=Et.LayaGLRunner.uploadShaderUniformsForNative}}static formatRelativePath(t,e){var a;a=t+e;var i=e.charAt(0);if(i==="."){var r=a.split("/");for(var s=0,n=r.length;s<n;s++){if(r[s]==".."){var o=s-1;if(o>0&&r[o]!==".."){r.splice(o,2);s-=2}}}a=r.join("/")}return a}static _endLoad(t,e=null,a=null){if(a){for(var i=0,r=a.length;i<r;i++){var s=Et.Loader.getRes(a[i]);s&&s._removeReference()}}t.endLoad(e)}static _eventLoadManagerError(t){Et.Laya.loader.event(Et.Event.ERROR,t)}static _addHierarchyInnerUrls(t,e,a,i,r,s,n=null,o=null){var l=X.formatRelativePath(i,r);a&&(l=l+a);t.push({url:l,type:s,constructParams:n,propertyParams:o});e.push(l);return l}static _getSprite3DHierarchyInnerUrls(t,e,a,i,r,s,n,o){var l,_;var h=t.props;switch(t.type){case"Scene3D":var x=h.lightmaps;for(l=0,_=x.length;l<_;l++){var c=x[l];if(c.path){c.path=X._addHierarchyInnerUrls(r,s,n,o,c.path,X.TEXTURE2D,c.constructParams,c.propertyParams)}else{var d=c.color;d.path=X._addHierarchyInnerUrls(r,s,n,o,d.path,X.TEXTURE2D,d.constructParams,d.propertyParams);var u=c.direction;if(u)u.path=X._addHierarchyInnerUrls(r,s,n,o,u.path,X.TEXTURE2D,u.constructParams,u.propertyParams)}}var f=h.reflectionTexture;f&&(h.reflection=X._addHierarchyInnerUrls(i,s,n,o,f,X.TEXTURECUBE));var p=h.reflection;p&&(h.reflection=X._addHierarchyInnerUrls(r,s,n,o,p,X.TEXTURECUBEBIN));if(h.sky){var m=h.sky.material;m&&(m.path=X._addHierarchyInnerUrls(a,s,n,o,m.path,X.MATERIAL))}break;case"Camera":var g=h.skyboxMaterial;g&&(g.path=X._addHierarchyInnerUrls(a,s,n,o,g.path,X.MATERIAL));break;case"TrailSprite3D":case"MeshSprite3D":case"SkinnedMeshSprite3D":case"SimpleSkinnedMeshSprite3D":var v=h.meshPath;v&&(h.meshPath=X._addHierarchyInnerUrls(e,s,n,o,v,X.MESH));var y=h.materials;if(y)for(l=0,_=y.length;l<_;l++)y[l].path=X._addHierarchyInnerUrls(a,s,n,o,y[l].path,X.MATERIAL);if(t.type=="SimpleSkinnedMeshSprite3D")if(h.animatorTexture)h.animatorTexture=X._addHierarchyInnerUrls(r,s,n,o,h.animatorTexture,X.SIMPLEANIMATORBIN);break;case"ShuriKenParticle3D":if(h.main){var T=h.renderer.resources;var E=T.mesh;var b=T.material;E&&(T.mesh=X._addHierarchyInnerUrls(e,s,n,o,E,X.MESH));b&&(T.material=X._addHierarchyInnerUrls(a,s,n,o,b,X.MATERIAL))}else{var S=h.meshPath;S&&(h.meshPath=X._addHierarchyInnerUrls(e,s,n,o,S,X.MESH));h.material.path=X._addHierarchyInnerUrls(a,s,n,o,h.material.path,X.MATERIAL)}break;case"Terrain":X._addHierarchyInnerUrls(r,s,n,o,h.dataPath,X.TERRAINRES);break;case"ReflectionProbe":var C=h.reflection;C&&(h.reflection=X._addHierarchyInnerUrls(e,s,n,o,C,X.TEXTURECUBEBIN));break}var R=t.components;if(R){for(var A=0,B=R.length;A<B;A++){var L=R[A];switch(L.type){case"Animator":var F=L.avatarPath;var I=L.avatar;I&&(I.path=X._addHierarchyInnerUrls(r,s,n,o,I.path,X.AVATAR));var M=L.clipPaths;if(!M){var D=L.layers;for(l=0;l<D.length;l++){var w=D[l].states;for(var P=0,V=w.length;P<V;P++){var O=w[P].clipPath;O&&(w[P].clipPath=X._addHierarchyInnerUrls(r,s,n,o,O,X.ANIMATIONCLIP))}}}else{for(l=0,_=M.length;l<_;l++)M[l]=X._addHierarchyInnerUrls(r,s,n,o,M[l],X.ANIMATIONCLIP)}break;case"PhysicsCollider":case"Rigidbody3D":case"CharacterController":var U=L.shapes;for(l=0;l<U.length;l++){var N=U[l];if(N.type==="MeshColliderShape"){var E=N.mesh;E&&(N.mesh=X._addHierarchyInnerUrls(e,s,n,o,E,X.MESH))}}break}}}var k=t.child;for(l=0,_=k.length;l<_;l++)X._getSprite3DHierarchyInnerUrls(k[l],e,a,i,r,s,n,o)}static _loadHierarchy(t){t._originType=t.type;t.on(Et.Event.LOADED,null,X._onHierarchylhLoaded,[t]);t.load(t.url,Et.Loader.JSON,false,null,true)}static _onHierarchylhLoaded(t,e){var a=t.url;var i=F.getURLVerion(a);var r=Et.URL.getPath(a);var s=[];var n=[];var o=[];var l=[];var _=[];X._getSprite3DHierarchyInnerUrls(e.data,s,n,o,l,_,i,r);var h=s.length+n.length+l.length;var x=h+1;var c=1/x;X._onProcessChange(t,0,c,1);if(l.length>0){var d=h/x;var u=Et.Handler.create(null,X._onProcessChange,[t,c,d],false);X._innerFourthLevelLoaderManager._create(l,false,Et.Handler.create(null,X._onHierarchyInnerForthLevResouLoaded,[t,u,e,_,s,n,o,c+d*l.length,d]),u,null,null,null,1,true)}else{X._onHierarchyInnerForthLevResouLoaded(t,null,e,_,s,n,o,c,d)}}static _onHierarchyInnerForthLevResouLoaded(t,e,a,i,r,s,n,o,l){e&&e.recover();if(n.length>0){var _=Et.Handler.create(null,X._onProcessChange,[t,o,l],false);X._innerThirdLevelLoaderManager._create(n,false,Et.Handler.create(null,X._onHierarchyInnerThirdLevResouLoaded,[t,_,a,i,r,s,o+l*s.length,l]),e,null,null,null,1,true)}else{X._onHierarchyInnerThirdLevResouLoaded(t,null,a,i,r,s,o,l)}}static _onHierarchyInnerThirdLevResouLoaded(t,e,a,i,r,s,n,o){e&&e.recover();if(s.length>0){var l=Et.Handler.create(null,X._onProcessChange,[t,n,o],false);X._innerSecondLevelLoaderManager._create(s,false,Et.Handler.create(null,X._onHierarchyInnerSecondLevResouLoaded,[t,l,a,i,r,n+o*s.length,o]),e,null,null,null,1,true)}else{X._onHierarchyInnerSecondLevResouLoaded(t,null,a,i,r,n,o)}}static _onHierarchyInnerSecondLevResouLoaded(t,e,a,i,r,s,n){e&&e.recover();if(r.length>0){var o=Et.Handler.create(null,X._onProcessChange,[t,s,n],false);X._innerFirstLevelLoaderManager._create(r,false,Et.Handler.create(null,X._onHierarchyInnerFirstLevResouLoaded,[t,o,a,i]),e,null,null,null,1,true)}else{X._onHierarchyInnerFirstLevResouLoaded(t,null,a,i)}}static _onHierarchyInnerFirstLevResouLoaded(t,e,a,i){e&&e.recover();t._cache=t._createCache;var r=a.data.type==="Scene3D"?gr._parseScene(a,t._propertyParams,t._constructParams):gr._parse(a,t._propertyParams,t._constructParams);X._endLoad(t,r,i)}static _loadMesh(t){t.on(Et.Event.LOADED,null,X._onMeshLmLoaded,[t]);t.load(t.url,Et.Loader.BUFFER,false,null,true)}static _onMeshLmLoaded(t,e){t._cache=t._createCache;var a=vr._parse(e,t._propertyParams,t._constructParams);X._endLoad(t,a)}static _loadMaterial(t){t.on(Et.Event.LOADED,null,X._onMaterilLmatLoaded,[t]);t.load(t.url,Et.Loader.JSON,false,null,true)}static _onMaterilLmatLoaded(t,e){var a=t.url;var i=F.getURLVerion(a);var r=Et.URL.getPath(a);var s=[];var n=[];var o=e.customProps;var l;var _=e.version;switch(_){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var h,x;var c=e.props.textures;if(c){for(h=0,x=c.length;h<x;h++){var d=c[h];var u=d.path;if(u){l=X.formatRelativePath(r,u);i&&(l=l+i);s.push({url:l,constructParams:d.constructParams,propertyParams:d.propertyParams});n.push(l);d.path=l}}}break;default:throw new Error("Laya3D:unkonwn version.")}var f=s.length;var p=f+1;var m=1/p;X._onProcessChange(t,0,m,1);if(f>0){var g=Et.Handler.create(null,X._onProcessChange,[t,m,f/p],false);X._innerFourthLevelLoaderManager._create(s,false,Et.Handler.create(null,X._onMateialTexturesLoaded,[t,g,e,n]),g,null,null,null,1,true)}else{X._onMateialTexturesLoaded(t,null,e,null)}}static _onMateialTexturesLoaded(t,e,a,i){t._cache=t._createCache;var r=s._parse(a,t._propertyParams,t._constructParams);X._endLoad(t,r,i);e&&e.recover()}static _loadAvatar(a){a.on(Et.Event.LOADED,null,function(t){a._cache=a._createCache;var e=xe._parse(t,a._propertyParams,a._constructParams);X._endLoad(a,e)});a.load(a.url,Et.Loader.JSON,false,null,true)}static _loadSimpleAnimator(a){a.on(Et.Event.LOADED,null,function(t){a._cache=a._createCache;var e=Et.Texture2D._SimpleAnimatorTextureParse(t,a._propertyParams,a._constructParams);X._endLoad(a,e)});a.load(a.url,Et.Loader.BUFFER,false,null,true)}static _loadAnimationClip(a){a.on(Et.Event.LOADED,null,function(t){a._cache=a._createCache;var e=ht._parse(t,a._propertyParams,a._constructParams);X._endLoad(a,e)});a.load(a.url,Et.Loader.BUFFER,false,null,true)}static _loadTexture2D(a){var t=a.url;var e=t.lastIndexOf(".")+1;var i=t.indexOf("?");var r=i==-1?t.length:i;var s=t.substr(e,r-e);var n;switch(s){case"jpg":case"jpeg":case"bmp":case"gif":case"png":n="nativeimage";break;case"dds":case"ktx":case"pvr":n=Et.Loader.BUFFER;break}a.on(Et.Event.LOADED,null,function(t){a._cache=a._createCache;var e=Et.Texture2D._parse(t,a._propertyParams,a._constructParams);X._endLoad(a,e)});a.load(a.url,n,false,null,true)}static _loadTextureCube(t){t.on(Et.Event.LOADED,null,X._onTextureCubeLtcLoaded,[t]);t.load(t.url,Et.Loader.JSON,false,null,true)}static _loadTextureCubeBin(m){m.on(Et.Event.LOADED,null,t=>{m._cache=m._createCache;var e=new Et.Byte(t);var a=e.readUTFString();if(a!=="LAYATEXTURECUBE:0000")throw"Laya3D:unknow version.";var i=e.readUint8();var r=e.getUint8();var s=e.readUint16();var n=e.getUint8();var o=e.getUint8();var l=e.getUint8();var _=e.getUint8();var h=new De(s,i,r>1?true:false);h.filterMode=n;h.wrapModeU=o;h.wrapModeV=l;h.anisoLevel=_;var x=e.pos;var c=s;for(var d=0;d<r;d++){var u=new Array(6);var f=c*c*h._getFormatByteCount();for(var p=0;p<6;p++){u[p]=new Uint8Array(t,x,f);x+=f}h.setSixSidePixels(u,d);c/=2}X._endLoad(m,h)});m.load(m.url,Et.Loader.BUFFER,false,null,true)}static _onTextureCubeLtcLoaded(t,e){var a=Et.URL.getPath(t.url);var i=[X.formatRelativePath(a,e.front),X.formatRelativePath(a,e.back),X.formatRelativePath(a,e.left),X.formatRelativePath(a,e.right),X.formatRelativePath(a,e.up),X.formatRelativePath(a,e.down)];var r=1/7;X._onProcessChange(t,0,r,1);var s=Et.Handler.create(null,X._onProcessChange,[t,r,6/7],false);X._innerFourthLevelLoaderManager.load(i,Et.Handler.create(null,X._onTextureCubeImagesLoaded,[t,i,s]),s,"nativeimage")}static _onTextureCubeImagesLoaded(t,e,a){var i=new Array(6);for(var r=0;r<6;r++)i[r]=Et.Loader.getRes(e[r]);t._cache=t._createCache;var s=De._parse(i,t._propertyParams,t._constructParams);a.recover();for(r=0;r<6;r++)Et.Loader.clearRes(e[r]);X._endLoad(t,s)}static _onProcessChange(t,e,a,i){i=e+i*a;i<1&&t.event(Et.Event.PROGRESS,i*2/3+1/3)}static init(t,e,a=null,i=null){if(X._isInit){i&&i.run();return}X._isInit=true;a&&a.cloneTo(tt._config);a=tt._config;be.debugFrustumCulling=a.debugFrustumCulling;X._editerEnvironment=a._editerEnvironment;N.octreeCulling=a.octreeCulling;N.octreeInitialSize=a.octreeInitialSize;N.octreeInitialCenter=a.octreeInitialCenter;N.octreeMinNodeSize=a.octreeMinNodeSize;N.octreeLooseness=a.octreeLooseness;var r=window.Physics3D;if(r==null||a.isUseCannonPhysicsEngine){$._enablePhysics=false;X.__init__(t,e,a);i&&i.run()}else{$._enablePhysics=true;r(a.defaultPhysicsMemory*16,ci._interactive).then(function(){X.__init__(t,e,a);i&&i.run()})}}}X.HIERARCHY="HIERARCHY";X.MESH="MESH";X.MATERIAL="MATERIAL";X.TEXTURE2D="TEXTURE2D";X.TEXTURECUBE="TEXTURECUBE";X.TEXTURECUBEBIN="TEXTURECUBEBIN";X.ANIMATIONCLIP="ANIMATIONCLIP";X.AVATAR="AVATAR";X.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA";X.TERRAINRES="TERRAIN";X.SIMPLEANIMATORBIN="SIMPLEANIMATOR";X._innerFirstLevelLoaderManager=new Et.LoaderManager;X._innerSecondLevelLoaderManager=new Et.LoaderManager;X._innerThirdLevelLoaderManager=new Et.LoaderManager;X._innerFourthLevelLoaderManager=new Et.LoaderManager;X._isInit=false;X._editerEnvironment=false;X.physicsSettings=new Le;window.Laya3D=X;class Cr extends e{constructor(){super()}add(t){var e=t._indexInCastShadowList;if(e!==-1)throw"CastShadowList:element has  in  CastShadowList.";this._add(t);t._indexInCastShadowList=this.length++}remove(t){var e=t._indexInCastShadowList;this.length--;if(e!==this.length){var a=this.elements[this.length];this.elements[e]=a;a._indexInCastShadowList=e}t._indexInCastShadowList=-1}}class Rr{constructor(){}onStateEnter(){}onStateUpdate(){}onStateExit(){}}class Ar extends Et.Component{constructor(){super(...arguments);this._indexInPool=-1}get isSingleton(){return false}_checkProcessTriggers(){var t=Ar.prototype;if(this.onTriggerEnter!==t.onTriggerEnter)return true;if(this.onTriggerStay!==t.onTriggerStay)return true;if(this.onTriggerExit!==t.onTriggerExit)return true;return false}_checkProcessCollisions(){var t=Ar.prototype;if(this.onCollisionEnter!==t.onCollisionEnter)return true;if(this.onCollisionStay!==t.onCollisionStay)return true;if(this.onCollisionExit!==t.onCollisionExit)return true;return false}_onAwake(){this.onAwake();if(this.onStart!==Ar.prototype.onStart)Et.Laya.startTimer.callLater(this,this.onStart)}_onEnable(){this.owner._scene._addScript(this);this.onEnable()}_onDisable(){this.owner._scene._removeScript(this);this.owner.offAllCaller(this);this.onDisable()}_onDestroy(){var t=this.owner._scripts;t.splice(t.indexOf(this),1);var e=this.owner;e._needProcessTriggers=false;for(var a=0,i=t.length;a<i;a++){if(t[a]._checkProcessTriggers()){e._needProcessTriggers=true;break}}e._needProcessCollisions=false;for(a=0,i=t.length;a<i;a++){if(t[a]._checkProcessCollisions()){e._needProcessCollisions=true;break}}this.onDestroy()}_isScript(){return true}_onAdded(){var t=this.owner;var e=t._scripts;e||(t._scripts=e=[]);e.push(this);if(!t._needProcessCollisions)t._needProcessCollisions=this._checkProcessCollisions();if(!t._needProcessTriggers)t._needProcessTriggers=this._checkProcessTriggers()}onAwake(){}onEnable(){}onStart(){}onTriggerEnter(t){}onTriggerStay(t){}onTriggerExit(t){}onCollisionEnter(t){}onCollisionStay(t){}onCollisionExit(t){}onJointBreak(){}onMouseDown(){}onMouseDrag(){}onMouseClick(){}onMouseUp(){}onMouseEnter(){}onMouseOver(){}onMouseOut(){}onUpdate(){}onLateUpdate(){}onPreRender(){}onPostRender(){}onDisable(){}onDestroy(){}}class Lr{constructor(t,e,a,i){this._datas=[];this._w=t;this._h=e;this._minHeight=a;this._maxHeight=i}static creatFromMesh(t,e,a,i){var r=[];var s=[];var n=t.subMeshCount;for(var o=0;o<n;o++){var l=t.getSubMesh(o);var _=l._vertexBuffer;var h=_.getFloat32Data();var x=[];for(var c=0;c<h.length;c+=_.vertexDeclaration.vertexStride/4){var d=new St(h[c+0],h[c+1],h[c+2]);x.push(d)}r.push(x);var u=l._indexBuffer;s.push(u.getData())}var f=t.bounds;var p=f.getMin().x;var m=f.getMin().z;var g=f.getMax().x;var v=f.getMax().z;var y=f.getMin().y;var T=f.getMax().y;var E=g-p;var b=v-m;var S=i.x=E/(e-1);var C=i.y=b/(a-1);var R=new Lr(e,a,y,T);var A=Lr._tempRay;var L=A.direction;L.x=0;L.y=-1;L.z=0;const I=.1;var M=T+I;A.origin.y=M;for(var D=0;D<a;D++){var w=m+D*C;R._datas[D]=[];for(var P=0;P<e;P++){var B=p+P*S;var O=A.origin;O.x=B;O.z=w;var N=Lr._getPosition(A,r,s);R._datas[D][P]=N===Number.MAX_VALUE?NaN:M-N}}return R}static createFromImage(t,e,a){var i=t.width;var r=t.height;var s=new Lr(i,r,e,a);var n=(a-e)/254;var o=t.getPixels();var l=0;for(var _=0;_<r;_++){var h=s._datas[_]=[];for(var x=0;x<i;x++){var c=o[l++];var d=o[l++];var u=o[l++];var f=o[l++];if(c==255&&d==255&&u==255&&f==255)h[x]=NaN;else{h[x]=(c+d+u)/3*n+e}}}return s}static _getPosition(t,e,a){var i=Number.MAX_VALUE;for(var r=0;r<e.length;r++){var s=e[r];var n=a[r];for(var o=0;o<n.length;o+=3){var l=s[n[o+0]];var _=s[n[o+1]];var h=s[n[o+2]];var x=Yt.rayIntersectsTriangle(t,l,_,h);if(!isNaN(x)&&x<i){i=x}}}return i}get width(){return this._w}get height(){return this._h}get maxHeight(){return this._maxHeight}get minHeight(){return this._minHeight}_inBounds(t,e){return t>=0&&t<this._h&&e>=0&&e<this._w}getHeight(t,e){if(this._inBounds(t,e))return this._datas[t][e];else return NaN}}Lr._tempRay=new Ht(new St,new St);class Ir extends Ca{constructor(t,e,a=null){super(t,a);this._heightMap=e;this._cellSize=new Ct}static createFromMesh(t,e,a,i=null){var r=new Ir(t,null,i);r._initCreateFromMesh(e,a);return r}static createFromMeshAndHeightMap(t,e,a,i,r=null){var s=new Ir(t,null,r);s._initCreateFromMeshHeightMap(e,a,i);return s}get minX(){var t=this.transform.worldMatrix;var e=t.elements;return this._minX*this._getScaleX()+e[12]}get minZ(){var t=this.transform.worldMatrix;var e=t.elements;return this._minZ*this._getScaleZ()+e[14]}get width(){return(this._heightMap.width-1)*this._cellSize.x*this._getScaleX()}get depth(){return(this._heightMap.height-1)*this._cellSize.y*this._getScaleZ()}_disableRotation(){var t=this.transform.rotation;t.x=0;t.y=0;t.z=0;t.w=1;this.transform.rotation=t}_getScaleX(){var t=this.transform.worldMatrix;var e=t.elements;var a=e[0];var i=e[1];var r=e[2];return Math.sqrt(a*a+i*i+r*r)}_getScaleZ(){var t=this.transform.worldMatrix;var e=t.elements;var a=e[8];var i=e[9];var r=e[10];return Math.sqrt(a*a+i*i+r*r)}_initCreateFromMesh(t,e){this._heightMap=Lr.creatFromMesh(this.meshFilter.sharedMesh,t,e,this._cellSize);var a=this.meshFilter.sharedMesh.bounds;var i=a.getMin();var r=a.getMax();this._minX=i.x;this._minZ=i.z}_initCreateFromMeshHeightMap(t,e,a){var i=this.meshFilter.sharedMesh.bounds;this._heightMap=Lr.createFromImage(t,e,a);this._computeCellSize(i);var r=i.getMin();var s=i.getMax();this._minX=r.x;this._minZ=r.z}_computeCellSize(t){var e=t.getMin();var a=t.getMax();var i=e.x;var r=e.z;var s=a.x;var n=a.z;var o=s-i;var l=n-r;this._cellSize.x=o/(this._heightMap.width-1);this._cellSize.y=l/(this._heightMap.height-1)}_update(t){this._disableRotation()}getHeight(t,e){Ir._tempVector3.x=t;Ir._tempVector3.y=0;Ir._tempVector3.z=e;this._disableRotation();var a=this.transform.worldMatrix;a.invert(Ir._tempMatrix4x4);St.transformCoordinate(Ir._tempVector3,Ir._tempMatrix4x4,Ir._tempVector3);t=Ir._tempVector3.x;e=Ir._tempVector3.z;var i=(t-this._minX)/this._cellSize.x;var r=(e-this._minZ)/this._cellSize.y;var s=Math.floor(r);var n=Math.floor(i);var o=i-n;var l=r-s;var _;var h;var x=a.elements;var c=x[4];var d=x[5];var u=x[6];var f=Math.sqrt(c*c+d*d+u*u);var p=x[13];var m=this._heightMap.getHeight(s,n+1);var g=this._heightMap.getHeight(s+1,n);if(isNaN(m)||isNaN(g))return NaN;if(o+l<=1){var v=this._heightMap.getHeight(s,n);if(isNaN(v))return NaN;_=m-v;h=g-v;return(v+o*_+l*h)*f+p}else{var y=this._heightMap.getHeight(s+1,n+1);if(isNaN(y))return NaN;_=g-y;h=m-y;return(y+(1-o)*_+(1-l)*h)*f+p}}}Ir._tempVector3=new St;Ir._tempMatrix4x4=new k;class Mr{constructor(){this._currentLength=0;this._elements=new Float32Array(12)}get gradientCount(){return this._currentLength/3}add(t,e){if(this._currentLength<8){if(this._currentLength===6&&t!==1){t=1;console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")}this._elements[this._currentLength++]=t;this._elements[this._currentLength++]=e.x;this._elements[this._currentLength++]=e.y}else{console.log("GradientDataVector2 warning:data count must lessEqual than 4")}}cloneTo(t){var e=t;e._currentLength=this._currentLength;var a=e._elements;for(var i=0,r=this._elements.length;i<r;i++){a[i]=this._elements[i]}}clone(){var t=new Mr;this.cloneTo(t);return t}}class Dr{constructor(){this.startPosition=new St;this.endPosition=new St;this.startColor=new ye;this.endColor=new ye}cloneTo(t){this.startPosition.cloneTo(t.startPosition);this.endPosition.cloneTo(t.endPosition);this.startColor.cloneTo(t.startColor);this.endColor.cloneTo(t.endColor)}}class wr{constructor(){}render(t){}}class Pr extends wr{constructor(){super();this._shader=null;this._shaderData=new yt;this._linearColor=new ye;this._bloomTextureTexelSize=new bt;this._shaderThreshold=new bt;this._shaderParams=new bt;this._pyramid=null;this._intensity=0;this._threshold=1;this._softKnee=.5;this._diffusion=7;this._anamorphicRatio=0;this._dirtIntensity=0;this._shaderSetting=new bt;this._dirtTileOffset=new bt;this.clamp=65472;this.color=new ye(1,1,1,1);this.fastMode=false;this.dirtTexture=null;this._shader=P.find("PostProcessBloom");this._pyramid=new Array(Pr.MAXPYRAMIDSIZE*2)}get intensity(){return this._intensity}set intensity(t){this._intensity=Math.max(t,0)}get threshold(){return this._threshold}set threshold(t){this._threshold=Math.max(t,0)}get softKnee(){return this._softKnee}set softKnee(t){this._softKnee=Math.min(Math.max(t,0),1)}get diffusion(){return this._diffusion}set diffusion(t){this._diffusion=Math.min(Math.max(t,1),10)}get anamorphicRatio(){return this._anamorphicRatio}set anamorphicRatio(t){this._anamorphicRatio=Math.min(Math.max(t,-1),1)}get dirtIntensity(){return this._dirtIntensity}set dirtIntensity(t){this._dirtIntensity=Math.max(t,0)}render(t){var e=t.command;var a=t.camera.viewport;this._shaderData.setTexture(Pr.SHADERVALUE_AUTOEXPOSURETEX,Et.Texture2D.whiteTexture);var i=this._anamorphicRatio;var r=i<0?-i:0;var s=i>0?i:0;var n=Math.floor(a.width/(2-r));var o=Math.floor(a.height/(2-s));var l=Math.max(n,o);var _;_=Math.log2(l)+this._diffusion-10;var h=Math.floor(_);var x=Math.min(Math.max(h,1),Pr.MAXPYRAMIDSIZE);var c=.5+_-h;this._shaderData.setNumber(Pr.SHADERVALUE_SAMPLESCALE,c);var d=ye.gammaToLinearSpace(this.threshold);var u=d*this._softKnee+1e-5;this._shaderThreshold.setValue(d,d-u,u*2,.25/u);this._shaderData.setVector(Pr.SHADERVALUE_THRESHOLD,this._shaderThreshold);var f=ye.gammaToLinearSpace(this.clamp);this._shaderParams.setValue(f,0,0,0);this._shaderData.setVector(Pr.SHADERVALUE_PARAMS,this._shaderParams);var p=this.fastMode?1:0;var m=t.source;for(var g=0;g<x;g++){var v=g*2;var y=v+1;var T=g==0?Pr.SUBSHADER_PREFILTER13+p:Pr.SUBSHADER_DOWNSAMPLE13+p;var E=mt.createFromPool(n,o,Et.RenderTextureFormat.R8G8B8,Et.RenderTextureDepthFormat.DEPTHSTENCIL_NONE);E.filterMode=Et.FilterMode.Bilinear;this._pyramid[v]=E;if(g!==x-1){var b=mt.createFromPool(n,o,Et.RenderTextureFormat.R8G8B8,Et.RenderTextureDepthFormat.DEPTHSTENCIL_NONE);b.filterMode=Et.FilterMode.Bilinear;this._pyramid[y]=b}e.blitScreenTriangle(m,E,null,this._shader,this._shaderData,T);m=E;n=Math.max(Math.floor(n/2),1);o=Math.max(Math.floor(o/2),1)}var S=this._pyramid[(x-1)*2];for(g=x-2;g>=0;g--){v=g*2;y=v+1;E=this._pyramid[v];b=this._pyramid[y];e.setShaderDataTexture(this._shaderData,Pr.SHADERVALUE_BLOOMTEX,E);e.blitScreenTriangle(S,b,null,this._shader,this._shaderData,Pr.SUBSHADER_UPSAMPLETENT+p);S=b}var C=this._linearColor;this.color.toLinear(C);var R=Math.pow(2,this._intensity/10)-1;var A=this._shaderSetting;this._shaderSetting.setValue(c,R,this._dirtIntensity,x);var L=this.dirtTexture?this.dirtTexture:Et.Texture2D.blackTexture;var I=L.width/L.height;var M=a.width/a.height;var D=this._dirtTileOffset;if(I>M)D.setValue(M/I,1,(1-D.x)*.5,0);else if(I<M)D.setValue(1,I/M,0,(1-D.y)*.5);var w=t.compositeShaderData;if(this.fastMode)w.addDefine(le.SHADERDEFINE_BLOOM_LOW);else w.addDefine(le.SHADERDEFINE_BLOOM);this._bloomTextureTexelSize.setValue(1/S.width,1/S.height,S.width,S.height);w.setVector(le.SHADERVALUE_BLOOM_DIRTTILEOFFSET,D);w.setVector(le.SHADERVALUE_BLOOM_SETTINGS,A);w.setVector(le.SHADERVALUE_BLOOM_COLOR,new bt(C.r,C.g,C.b,C.a));w.setTexture(le.SHADERVALUE_BLOOM_DIRTTEX,L);w.setTexture(le.SHADERVALUE_BLOOMTEX,S);w.setVector(le.SHADERVALUE_BLOOMTEX_TEXELSIZE,this._bloomTextureTexelSize);for(g=0;g<x;g++){v=g*2;y=v+1;mt.recoverToPool(this._pyramid[v]);g!==0&&g!==x-1&&mt.recoverToPool(this._pyramid[y])}t.deferredReleaseTextures.push(S)}}Pr.SHADERVALUE_MAINTEX=P.propertyNameToID("u_MainTex");Pr.SHADERVALUE_AUTOEXPOSURETEX=P.propertyNameToID("u_AutoExposureTex");Pr.SHADERVALUE_SAMPLESCALE=P.propertyNameToID("u_SampleScale");Pr.SHADERVALUE_THRESHOLD=P.propertyNameToID("u_Threshold");Pr.SHADERVALUE_PARAMS=P.propertyNameToID("u_Params");Pr.SHADERVALUE_BLOOMTEX=P.propertyNameToID("u_BloomTex");Pr.SUBSHADER_PREFILTER13=0;Pr.SUBSHADER_PREFILTER4=1;Pr.SUBSHADER_DOWNSAMPLE13=2;Pr.SUBSHADER_DOWNSAMPLE4=3;Pr.SUBSHADER_UPSAMPLETENT=4;Pr.SUBSHADER_UPSAMPLEBOX=5;Pr.MAXPYRAMIDSIZE=16;class Or{constructor(){}}class Nr{constructor(t=0,e=0,a=0,i=0){var r=this.elements=new Float32Array(4);r[0]=t;r[1]=e;r[2]=a;r[3]=i}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}get w(){return this.elements[3]}set w(t){this.elements[3]=t}fromArray(t,e=0){this.elements[0]=t[e+0];this.elements[1]=t[e+1];this.elements[2]=t[e+2];this.elements[3]=t[e+3]}cloneTo(t){var e=t;var a=e.elements;var i=this.elements;a[0]=i[0];a[1]=i[1];a[2]=i[2];a[3]=i[3]}clone(){var t=new Nr;this.cloneTo(t);return t}static lerp(t,e,a,i){var r=i.elements;var s=t.elements;var n=e.elements;var o=s[0],l=s[1],_=s[2],h=s[3];r[0]=o+a*(n[0]-o);r[1]=l+a*(n[1]-l);r[2]=_+a*(n[2]-_);r[3]=h+a*(n[3]-h)}static transformByM4x4(t,e,a){var i=t.elements;var r=i[0];var s=i[1];var n=i[2];var o=i[3];var l=e.elements;var _=a.elements;_[0]=r*l[0]+s*l[4]+n*l[8]+o*l[12];_[1]=r*l[1]+s*l[5]+n*l[9]+o*l[13];_[2]=r*l[2]+s*l[6]+n*l[10]+o*l[14];_[3]=r*l[3]+s*l[7]+n*l[11]+o*l[15]}static equals(t,e){var a=t.elements;var i=e.elements;return z.nearEqual(Math.abs(a[0]),Math.abs(i[0]))&&z.nearEqual(Math.abs(a[1]),Math.abs(i[1]))&&z.nearEqual(Math.abs(a[2]),Math.abs(i[2]))&&z.nearEqual(Math.abs(a[3]),Math.abs(i[3]))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}static normalize(t,e){var a=t.elements;var i=e.elements;var r=t.length();if(r>0){i[0]=a[0]*r;i[1]=a[1]*r;i[2]=a[2]*r;i[3]=a[3]*r}}static add(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]+s[0];i[1]=r[1]+s[1];i[2]=r[2]+s[2];i[3]=r[3]+s[3]}static subtract(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]-s[0];i[1]=r[1]-s[1];i[2]=r[2]-s[2];i[3]=r[3]-s[3]}static multiply(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]*s[0];i[1]=r[1]*s[1];i[2]=r[2]*s[2];i[3]=r[3]*s[3]}static scale(t,e,a){var i=a.elements;var r=t.elements;i[0]=r[0]*e;i[1]=r[1]*e;i[2]=r[2]*e;i[3]=r[3]*e}static Clamp(t,e,a,i){var r=t.elements;var s=r[0];var n=r[1];var o=r[2];var l=r[3];var _=e.elements;var h=_[0];var x=_[1];var c=_[2];var d=_[3];var u=a.elements;var f=u[0];var p=u[1];var m=u[2];var g=u[3];var v=i.elements;s=s>f?f:s;s=s<h?h:s;n=n>p?p:n;n=n<x?x:n;o=o>m?m:o;o=o<c?c:o;l=l>g?g:l;l=l<d?d:l;v[0]=s;v[1]=n;v[2]=o;v[3]=l}static distanceSquared(t,e){var a=t.elements;var i=e.elements;var r=a[0]-i[0];var s=a[1]-i[1];var n=a[2]-i[2];var o=a[3]-i[3];return r*r+s*s+n*n+o*o}static distance(t,e){var a=t.elements;var i=e.elements;var r=a[0]-i[0];var s=a[1]-i[1];var n=a[2]-i[2];var o=a[3]-i[3];return Math.sqrt(r*r+s*s+n*n+o*o)}static dot(t,e){var a=t.elements;var i=e.elements;var r=a[0]*i[0]+a[1]*i[1]+a[2]*i[2]+a[3]*i[3];return r}static min(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=Math.min(r[0],s[0]);i[1]=Math.min(r[1],s[1]);i[2]=Math.min(r[2],s[2]);i[3]=Math.min(r[3],s[3])}static max(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=Math.max(r[0],s[0]);i[1]=Math.max(r[1],s[1]);i[2]=Math.max(r[2],s[2]);i[3]=Math.max(r[3],s[3])}}Nr.ZERO=new Nr;Nr.ONE=new Nr(1,1,1,1);Nr.UnitX=new Nr(1,0,0,0);Nr.UnitY=new Nr(0,1,0,0);Nr.UnitZ=new Nr(0,0,1,0);Nr.UnitW=new Nr(0,0,0,1);class Br{constructor(t=0,e=0,a=0,i=null){var r;if(i){r=i}else{r=new Float32Array(3)}this.elements=r;r[0]=t;r[1]=e;r[2]=a}static distanceSquared(t,e){var a=t.elements;var i=e.elements;var r=a[0]-i[0];var s=a[1]-i[1];var n=a[2]-i[2];return r*r+s*s+n*n}static distance(t,e){var a=t.elements;var i=e.elements;var r=a[0]-i[0];var s=a[1]-i[1];var n=a[2]-i[2];return Math.sqrt(r*r+s*s+n*n)}static min(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=Math.min(r[0],s[0]);i[1]=Math.min(r[1],s[1]);i[2]=Math.min(r[2],s[2])}static max(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=Math.max(r[0],s[0]);i[1]=Math.max(r[1],s[1]);i[2]=Math.max(r[2],s[2])}static transformQuat(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;var n=r[0],o=r[1],l=r[2],_=s[0],h=s[1],x=s[2],c=s[3],d=c*n+h*l-x*o,u=c*o+x*n-_*l,f=c*l+_*o-h*n,p=-_*n-h*o-x*l;i[0]=d*c+p*-_+u*-x-f*-h;i[1]=u*c+p*-h+f*-_-d*-x;i[2]=f*c+p*-x+d*-h-u*-_}static scalarLength(t){var e=t.elements;var a=e[0],i=e[1],r=e[2];return Math.sqrt(a*a+i*i+r*r)}static scalarLengthSquared(t){var e=t.elements;var a=e[0],i=e[1],r=e[2];return a*a+i*i+r*r}static normalize(t,e){var a=t.elements;var i=e.elements;var r=a[0],s=a[1],n=a[2];var o=r*r+s*s+n*n;if(o>0){o=1/Math.sqrt(o);i[0]=a[0]*o;i[1]=a[1]*o;i[2]=a[2]*o}}static multiply(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]*s[0];i[1]=r[1]*s[1];i[2]=r[2]*s[2]}static scale(t,e,a){var i=a.elements;var r=t.elements;i[0]=r[0]*e;i[1]=r[1]*e;i[2]=r[2]*e}static lerp(t,e,a,i){var r=i.elements;var s=t.elements;var n=e.elements;var o=s[0],l=s[1],_=s[2];r[0]=o+a*(n[0]-o);r[1]=l+a*(n[1]-l);r[2]=_+a*(n[2]-_)}static transformV3ToV3(t,e,a){var i=Br._tempVector4;Br.transformV3ToV4(t,e,i);var r=i.elements;var s=a.elements;s[0]=r[0];s[1]=r[1];s[2]=r[2]}static transformV3ToV4(t,e,a){var i=t.elements;var r=i[0];var s=i[1];var n=i[2];var o=e.elements;var l=a.elements;l[0]=r*o[0]+s*o[4]+n*o[8]+o[12];l[1]=r*o[1]+s*o[5]+n*o[9]+o[13];l[2]=r*o[2]+s*o[6]+n*o[10]+o[14];l[3]=r*o[3]+s*o[7]+n*o[11]+o[15]}static TransformNormal(t,e,a){var i=t.elements;var r=i[0];var s=i[1];var n=i[2];var o=e.elements;var l=a.elements;l[0]=r*o[0]+s*o[4]+n*o[8];l[1]=r*o[1]+s*o[5]+n*o[9];l[2]=r*o[2]+s*o[6]+n*o[10]}static transformCoordinate(t,e,a){var i=t.elements;var r=i[0];var s=i[1];var n=i[2];var o=e.elements;var l=r*o[3]+s*o[7]+n*o[11]+o[15];var _=a.elements;_[0]=r*o[0]+s*o[4]+n*o[8]+o[12]/l;_[1]=r*o[1]+s*o[5]+n*o[9]+o[13]/l;_[2]=r*o[2]+s*o[6]+n*o[10]+o[14]/l}static Clamp(t,e,a,i){var r=t.elements;var s=r[0];var n=r[1];var o=r[2];var l=e.elements;var _=l[0];var h=l[1];var x=l[2];var c=a.elements;var d=c[0];var u=c[1];var f=c[2];var p=i.elements;s=s>d?d:s;s=s<_?_:s;n=n>u?u:n;n=n<h?h:n;o=o>f?f:o;o=o<x?x:o;p[0]=s;p[1]=n;p[2]=o}static add(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]+s[0];i[1]=r[1]+s[1];i[2]=r[2]+s[2]}static subtract(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]-s[0];i[1]=r[1]-s[1];i[2]=r[2]-s[2]}static cross(t,e,a){var i=t.elements;var r=e.elements;var s=a.elements;var n=i[0],o=i[1],l=i[2],_=r[0],h=r[1],x=r[2];s[0]=o*x-l*h;s[1]=l*_-n*x;s[2]=n*h-o*_}static dot(t,e){var a=t.elements;var i=e.elements;var r=a[0]*i[0]+a[1]*i[1]+a[2]*i[2];return r}static equals(t,e){var a=t.elements;var i=e.elements;return z.nearEqual(a[0],i[0])&&z.nearEqual(a[1],i[1])&&z.nearEqual(a[2],i[2])}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}setValue(t,e,a){this.elements[0]=t;this.elements[1]=e;this.elements[2]=a}fromArray(t,e=0){this.elements[0]=t[e+0];this.elements[1]=t[e+1];this.elements[2]=t[e+2]}cloneTo(t){var e=t;var a=e.elements;var i=this.elements;a[0]=i[0];a[1]=i[1];a[2]=i[2]}clone(){var t=new Br;this.cloneTo(t);return t}toDefault(){this.elements[0]=0;this.elements[1]=0;this.elements[2]=0}}Br._tempVector4=new Nr;Br.ZERO=new Br(0,0,0);Br.ONE=new Br(1,1,1);Br.NegativeUnitX=new Br(-1,0,0);Br.UnitX=new Br(1,0,0);Br.UnitY=new Br(0,1,0);Br.UnitZ=new Br(0,0,1);Br.ForwardRH=new Br(0,0,-1);Br.ForwardLH=new Br(0,0,1);Br.Up=new Br(0,1,0);Br.NAN=new Br(NaN,NaN,NaN);class Fr{constructor(t=0,e=0,a=0,i=1,r=null){var s;if(r){s=r}else{s=new Float32Array(4)}s[0]=t;s[1]=e;s[2]=a;s[3]=i;this.elements=s}static _dotArray(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}static _normalizeArray(t,e){var a=t[0],i=t[1],r=t[2],s=t[3];var n=a*a+i*i+r*r+s*s;if(n>0){n=1/Math.sqrt(n);e[0]=a*n;e[1]=i*n;e[2]=r*n;e[3]=s*n}}static _lerpArray(t,e,a,i){var r=1-a;if(Fr._dotArray(t,e)>=0){i[0]=r*t[0]+a*e[0];i[1]=r*t[1]+a*e[1];i[2]=r*t[2]+a*e[2];i[3]=r*t[3]+a*e[3]}else{i[0]=r*t[0]-a*e[0];i[1]=r*t[1]-a*e[1];i[2]=r*t[2]-a*e[2];i[3]=r*t[3]-a*e[3]}Fr._normalizeArray(i,i)}static createFromYawPitchRoll(t,e,a,i){var r=a*.5;var s=e*.5;var n=t*.5;var o=Math.sin(r);var l=Math.cos(r);var _=Math.sin(s);var h=Math.cos(s);var x=Math.sin(n);var c=Math.cos(n);var d=i.elements;d[0]=c*_*l+x*h*o;d[1]=x*h*l-c*_*o;d[2]=c*h*o-x*_*l;d[3]=c*h*l+x*_*o}static multiply(t,e,a){var i=t.elements;var r=e.elements;var s=a.elements;var n=i[0];var o=i[1];var l=i[2];var _=i[3];var h=r[0];var x=r[1];var c=r[2];var d=r[3];var u=o*c-l*x;var f=l*h-n*c;var p=n*x-o*h;var m=n*h+o*x+l*c;s[0]=n*d+h*_+u;s[1]=o*d+x*_+f;s[2]=l*d+c*_+p;s[3]=_*d-m}static arcTanAngle(t,e){if(t==0){if(e==1)return Math.PI/2;return-Math.PI/2}if(t>0)return Math.atan(e/t);if(t<0){if(e>0)return Math.atan(e/t)+Math.PI;return Math.atan(e/t)-Math.PI}return 0}static angleTo(t,e,a){Br.subtract(e,t,Fr.TEMPVector30);Br.normalize(Fr.TEMPVector30,Fr.TEMPVector30);a.elements[0]=Math.asin(Fr.TEMPVector30.y);a.elements[1]=Fr.arcTanAngle(-Fr.TEMPVector30.z,-Fr.TEMPVector30.x)}static createFromAxisAngle(t,e,a){var i=a.elements;var r=t.elements;e=e*.5;var s=Math.sin(e);i[0]=s*r[0];i[1]=s*r[1];i[2]=s*r[2];i[3]=Math.cos(e)}static createFromMatrix3x3(t,e){var a=e.elements;var i=t.elements;var r=i[0]+i[4]+i[8];var s;if(r>0){s=Math.sqrt(r+1);a[3]=.5*s;s=.5/s;a[0]=(i[5]-i[7])*s;a[1]=(i[6]-i[2])*s;a[2]=(i[1]-i[3])*s}else{var n=0;if(i[4]>i[0])n=1;if(i[8]>i[n*3+n])n=2;var o=(n+1)%3;var l=(n+2)%3;s=Math.sqrt(i[n*3+n]-i[o*3+o]-i[l*3+l]+1);a[n]=.5*s;s=.5/s;a[3]=(i[o*3+l]-i[l*3+o])*s;a[o]=(i[o*3+n]+i[n*3+o])*s;a[l]=(i[l*3+n]+i[n*3+l])*s}return}static createFromMatrix4x4(t,e){var a=t.elements;var i=e.elements;var r;var s;var n=a[0]+a[5]+a[10];if(n>0){r=Math.sqrt(n+1);i[3]=r*.5;r=.5/r;i[0]=(a[6]-a[9])*r;i[1]=(a[8]-a[2])*r;i[2]=(a[1]-a[4])*r}else if(a[0]>=a[5]&&a[0]>=a[10]){r=Math.sqrt(1+a[0]-a[5]-a[10]);s=.5/r;i[0]=.5*r;i[1]=(a[1]+a[4])*s;i[2]=(a[2]+a[8])*s;i[3]=(a[6]-a[9])*s}else if(a[5]>a[10]){r=Math.sqrt(1+a[5]-a[0]-a[10]);s=.5/r;i[0]=(a[4]+a[1])*s;i[1]=.5*r;i[2]=(a[9]+a[6])*s;i[3]=(a[8]-a[2])*s}else{r=Math.sqrt(1+a[10]-a[0]-a[5]);s=.5/r;i[0]=(a[8]+a[2])*s;i[1]=(a[9]+a[6])*s;i[2]=.5*r;i[3]=(a[1]-a[4])*s}}static slerp(t,e,a,i){var r=t.elements;var s=e.elements;var n=i.elements;var o=r[0],l=r[1],_=r[2],h=r[3],x=s[0],c=s[1],d=s[2],u=s[3];var f,p,m,g,v;p=o*x+l*c+_*d+h*u;if(p<0){p=-p;x=-x;c=-c;d=-d;u=-u}if(1-p>1e-6){f=Math.acos(p);m=Math.sin(f);g=Math.sin((1-a)*f)/m;v=Math.sin(a*f)/m}else{g=1-a;v=a}n[0]=g*o+v*x;n[1]=g*l+v*c;n[2]=g*_+v*d;n[3]=g*h+v*u;return n}static lerp(t,e,a,i){Fr._lerpArray(t.elements,e.elements,a,i.elements)}static add(t,e,a){var i=a.elements;var r=t.elements;var s=e.elements;i[0]=r[0]+s[0];i[1]=r[1]+s[1];i[2]=r[2]+s[2];i[3]=r[3]+s[3]}static dot(t,e){return Fr._dotArray(t.elements,e.elements)}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}get w(){return this.elements[3]}set w(t){this.elements[3]=t}scaling(t,e){var a=e.elements;var i=this.elements;a[0]=i[0]*t;a[1]=i[1]*t;a[2]=i[2]*t;a[3]=i[3]*t}normalize(t){Fr._normalizeArray(this.elements,t.elements)}length(){var t=this.elements;var e=t[0],a=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+a*a+i*i+r*r)}rotateX(t,e){var a=e.elements;var i=this.elements;t*=.5;var r=i[0],s=i[1],n=i[2],o=i[3];var l=Math.sin(t),_=Math.cos(t);a[0]=r*_+o*l;a[1]=s*_+n*l;a[2]=n*_-s*l;a[3]=o*_-r*l}rotateY(t,e){var a=e.elements;var i=this.elements;t*=.5;var r=i[0],s=i[1],n=i[2],o=i[3],l=Math.sin(t),_=Math.cos(t);a[0]=r*_-n*l;a[1]=s*_+o*l;a[2]=n*_+r*l;a[3]=o*_-s*l}rotateZ(t,e){var a=e.elements;var i=this.elements;t*=.5;var r=i[0],s=i[1],n=i[2],o=i[3],l=Math.sin(t),_=Math.cos(t);a[0]=r*_+s*l;a[1]=s*_-r*l;a[2]=n*_+o*l;a[3]=o*_-n*l}getYawPitchRoll(t){Br.transformQuat(Br.ForwardRH,this,Fr.TEMPVector31);Br.transformQuat(Br.Up,this,Fr.TEMPVector32);var e=Fr.TEMPVector32.elements;Fr.angleTo(Br.ZERO,Fr.TEMPVector31,Fr.TEMPVector33);var a=Fr.TEMPVector33.elements;if(a[0]==Math.PI/2){a[1]=Fr.arcTanAngle(e[2],e[0]);a[2]=0}else if(a[0]==-Math.PI/2){a[1]=Fr.arcTanAngle(-e[2],-e[0]);a[2]=0}else{k.createRotationY(-a[1],Fr.TEMPMatrix0);k.createRotationX(-a[0],Fr.TEMPMatrix1);Br.transformCoordinate(Fr.TEMPVector32,Fr.TEMPMatrix0,Fr.TEMPVector32);Br.transformCoordinate(Fr.TEMPVector32,Fr.TEMPMatrix1,Fr.TEMPVector32);a[2]=Fr.arcTanAngle(e[1],-e[0])}if(a[1]<=-Math.PI)a[1]=Math.PI;if(a[2]<=-Math.PI)a[2]=Math.PI;if(a[1]>=Math.PI&&a[2]>=Math.PI){a[1]=0;a[2]=0;a[0]=Math.PI-a[0]}var i=t.elements;i[0]=a[1];i[1]=a[0];i[2]=a[2]}invert(t){var e=t.elements;var a=this.elements;var i=a[0],r=a[1],s=a[2],n=a[3];var o=i*i+r*r+s*s+n*n;var l=o?1/o:0;e[0]=-i*l;e[1]=-r*l;e[2]=-s*l;e[3]=n*l}identity(){var t=this.elements;t[0]=0;t[1]=0;t[2]=0;t[3]=1}fromArray(t,e=0){this.elements[0]=t[e+0];this.elements[1]=t[e+1];this.elements[2]=t[e+2];this.elements[3]=t[e+3]}cloneTo(t){var e,a,i;a=this.elements;i=t.elements;if(a===i){return}for(e=0;e<4;++e){i[e]=a[e]}}clone(){var t=new Fr;this.cloneTo(t);return t}equals(t){var e=this.elements;var a=t.elements;return z.nearEqual(e[0],a[0])&&z.nearEqual(e[1],a[1])&&z.nearEqual(e[2],a[2])&&z.nearEqual(e[3],a[3])}static rotationLookAt(t,e,a){Fr.lookAt(Br.ZERO,t,e,a)}static lookAt(t,e,a,i){T.lookAt(t,e,a,Fr._tempMatrix3x3);Fr.rotationMatrix(Fr._tempMatrix3x3,i)}lengthSquared(){var t=this.elements[0];var e=this.elements[1];var a=this.elements[2];var i=this.elements[3];return t*t+e*e+a*a+i*i}static invert(t,e){var a=t.elements;var i=e.elements;var r=t.lengthSquared();if(!z.isZero(r)){r=1/r;i[0]=-a[0]*r;i[1]=-a[1]*r;i[2]=-a[2]*r;i[3]=a[3]*r}}static rotationMatrix(t,e){var a=t.elements;var i=a[0];var r=a[1];var s=a[2];var n=a[3];var o=a[4];var l=a[5];var _=a[6];var h=a[7];var x=a[8];var c=e.elements;var d,u;var f=i+o+x;if(f>0){d=Math.sqrt(f+1);c[3]=d*.5;d=.5/d;c[0]=(l-h)*d;c[1]=(_-s)*d;c[2]=(r-n)*d}else if(i>=o&&i>=x){d=Math.sqrt(1+i-o-x);u=.5/d;c[0]=.5*d;c[1]=(r+n)*u;c[2]=(s+_)*u;c[3]=(l-h)*u}else if(o>x){d=Math.sqrt(1+o-i-x);u=.5/d;c[0]=(n+r)*u;c[1]=.5*d;c[2]=(h+l)*u;c[3]=(_-s)*u}else{d=Math.sqrt(1+x-i-o);u=.5/d;c[0]=(_+s)*u;c[1]=(h+l)*u;c[2]=.5*d;c[3]=(r-n)*u}}}Fr.TEMPVector30=new Br;Fr.TEMPVector31=new Br;Fr.TEMPVector32=new Br;Fr.TEMPVector33=new Br;Fr.TEMPMatrix0=new k;Fr.TEMPMatrix1=new k;Fr._tempMatrix3x3=new T;Fr.DEFAULT=new Fr;Fr.NAN=new Fr(NaN,NaN,NaN,NaN);class Vr{constructor(t){if(!(t instanceof Array)||t.length!==4)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=t[0]|0;this._state0L=t[1]|0;this._state1U=t[2]|0;this._state1L=t[3]|0}randomint(){var t=this._state0U,e=this._state0L;var a=this._state1U,i=this._state1L;var r=(i>>>0)+(e>>>0);var s=a+t+(r/2>>>31)>>>0;var n=r>>>0;this._state0U=a;this._state0L=i;var o=0,l=0;var _=0,h=0;var x=23;var c=4294967295<<32-x;o=t<<x|(e&c)>>>32-x;l=e<<x;t=t^o;e=e^l;o=t^a;l=e^i;var d=18;var u=4294967295>>>32-d;_=t>>>d;h=e>>>d|(t&u)<<32-d;o=o^_;l=l^h;var f=5;var p=4294967295>>>32-f;_=a>>>f;h=i>>>f|(a&p)<<32-f;o=o^_;l=l^h;this._state1U=o;this._state1L=l;return[s,n]}random(){var t=this.randomint();var e=t[0];var a=t[1];var i=1023<<52-32;var r=0;var s=12;var n=4294967295>>>32-s;var o=e>>>s;var l=a>>>s|(e&n)<<32-s;var _=i|o;var h=r|l;Vr._CONVERTION_BUFFER.setUint32(0,_,false);Vr._CONVERTION_BUFFER.setUint32(4,h,false);var x=Vr._CONVERTION_BUFFER.getFloat64(0,false);return x-1}}Vr._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8));Vr.defaultRand=new Vr([0,Date.now()/65536,0,Date.now()%65536]);class Ur{constructor(){}}class kr{constructor(){this._pivotInA=new St;this._pivotInB=new St}get pivotInA(){return this._pivotInA}set pivotInA(t){this._pivotInA=t}get pivotInB(){return this._pivotInB}set pivotInB(t){this._pivotInB=t}get damping(){return this._damping}set damping(t){this._damping=t}get impulseClamp(){return this._impulseClamp}set impulseClamp(t){this._impulseClamp=t}get tau(){return this._tau}set tau(t){this._tau=t}}class Gr{constructor(){}}class Hr{constructor(){}get text(){return this._text}set text(t){this._text=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get color(){return this._color}set color(t){this._color=t}_createVertexBuffer(t){}_resizeVertexBuffer(t){}_addChar(){}}class zr{constructor(t,e){this._width=0;this._height=0;this._width=t;this._height=e}static get fullScreen(){return new zr(-1,-1)}get width(){if(this._width===-1)return pt.clientWidth;return this._width}get height(){if(this._height===-1)return pt.clientHeight;return this._height}}H.AlternateLightQueue=Pe;H.AnimationClip=ht;H.AnimationClipParser03=ot;H.AnimationClipParser04=lt;H.AnimationEvent=at;H.AnimationNode=he;H.AnimationTransform3D=_e;H.Animator=ft;H.AnimatorControllerLayer=ct;H.AnimatorPlayState=xt;H.AnimatorState=dt;H.AnimatorStateScript=Rr;H.Avatar=xe;H.BaseCamera=Qt;H.BaseMaterial=ce;H.BaseRender=qe;H.BaseShape=Va;H.BatchMark=Ge;H.BlinnPhongMaterial=n;H.BlitScreenQuadCMD=Pt;H.BloomEffect=Pr;H.BoundBox=Ne;H.BoundFrustum=Wt;H.BoundSphere=aa;H.Bounds=Be;H.BoundsOctree=ta;H.BoundsOctreeNode=Je;H.BoxColliderShape=b;H.BoxShape=ka;H.BufferState=Rt;H.BulletInteractive=ci;H.Burst=La;H.Camera=ae;H.CameraCullInfo=Te;H.CapsuleColliderShape=S;H.CastShadowList=Cr;H.CharacterController=Z;H.CircleShape=Ga;H.ClearRenderTextureCMD=Vt;H.Cluster=Gt;H.ColliderShape=o;H.Collision=Y;H.CollisionTool=j;H.CollisionUtils=W;H.Color=ye;H.ColorOverLifetime=Ma;H.Command=wt;H.CommandBuffer=ne;H.CompoundColliderShape=E;H.ConchQuaternion=Fr;H.ConchVector3=Br;H.ConchVector4=Nr;H.ConeColliderShape=C;H.ConeShape=Ha;H.Config3D=tt;H.ConfigurableConstraint=y;H.Constraint3D=Ur;H.ConstraintComponent=br;H.ContactPoint=a;H.ContainmentType=zt;H.CylinderColliderShape=A;H.DefineDatas=gt;H.DirectionLight=dr;H.DrawMeshCMD=Ft;H.DrawRenderCMD=re;H.DynamicBatchManager=na;H.EffectMaterial=l;H.Emission=$a;H.ExtendTerrainMaterial=x;H.FixedConstraint=Sr;H.FloatKeyframe=rt;H.FrameOverTime=Da;H.FrustumCulling=be;H.GeometryElement=Fe;H.Gradient=Aa;H.GradientAngularVelocity=wa;H.GradientColor=Ia;H.GradientDataInt=Pa;H.GradientDataNumber=Oa;H.GradientDataVector2=Mr;H.GradientMode=Ra;H.GradientSize=Na;H.GradientVelocity=Ba;H.HeightMap=Lr;H.HeightfieldColliderShape=Gr;H.HemisphereShape=za;H.HitResult=r;H.ILaya3D=D;H.IndexBuffer3D=jt;H.Input3D=Ae;H.Keyframe=it;H.KeyframeNode=et;H.KeyframeNodeList=_t;H.KeyframeNodeOwner=ut;H.Laya3D=X;H.LightQueue=we;H.LightSprite=$t;H.Lightmap=ea;H.LoadModelV04=R;H.LoadModelV05=G;H.Material=s;H.MathUtils3D=z;H.Matrix3x3=T;H.Matrix4x4=k;H.Mesh=pi;H.MeshColliderShape=L;H.MeshFilter=Ea;H.MeshReader=vr;H.MeshRenderDynamicBatchManager=Sa;H.MeshRenderStaticBatchManager=Ye;H.MeshRenderer=Ta;H.MeshSprite3D=Ca;H.MeshSprite3DShaderDeclaration=ya;H.MeshTerrainSprite3D=Ir;H.MouseTouch=Ce;H.OctreeMotionList=$e;H.PBRMaterial=c;H.PBRSpecularMaterial=xa;H.PBRStandardMaterial=pa;H.Physics3D=$;H.Physics3DUtils=B;H.PhysicsCollider=di;H.PhysicsComponent=I;H.PhysicsSettings=Le;H.PhysicsSimulation=w;H.PhysicsTriggerComponent=t;H.PhysicsUpdateList=U;H.Picker=Yt;H.PixelLineData=Dr;H.PixelLineFilter=Ue;H.PixelLineMaterial=Oe;H.PixelLineRenderer=Ze;H.PixelLineSprite3D=Ke;H.PixelLineVertex=Ve;H.Plane=O;H.Point2PointConstraint=kr;H.PointLight=ur;H.PostProcess=le;H.PostProcessEffect=wr;H.PostProcessRenderContext=oe;H.PrimitiveMesh=mi;H.Quaternion=M;H.QuaternionKeyframe=st;H.Rand=Ja;H.RandX=Vr;H.Ray=Ht;H.ReflectionProbe=je;H.ReflectionProbeList=oa;H.ReflectionProbeManager=la;H.RenderContext3D=pt;H.RenderElement=ie;H.RenderQueue=Qe;H.RenderState=p;H.RenderTexture=mt;H.RenderableSprite3D=ke;H.Rigidbody3D=J;H.RotationOverLifetime=Fa;H.Scene3D=N;H.Scene3DShaderDeclaration=Jt;H.Scene3DUtils=gr;H.SceneManager=Or;H.ScreenQuad=At;H.ScreenTriangle=Lt;H.Script3D=Ar;H.SetGlobalShaderDataCMD=se;H.SetRenderTargetCMD=Ot;H.SetShaderDataCMD=Nt;H.Shader3D=P;H.ShaderData=yt;H.ShaderDefine=It;H.ShaderInit3D=cr;H.ShaderInstance=ge;H.ShaderPass=_a;H.ShaderVariable=me;H.ShaderVariant=Mt;H.ShaderVariantCollection=Dt;H.ShadowCasterPass=sa;H.ShadowCullInfo=Ee;H.ShadowSliceData=ia;H.ShadowSpotData=ra;H.ShadowUtils=ee;H.ShapeUtils=Ua;H.ShuriKenParticle3D=ei;H.ShuriKenParticle3DShaderDeclaration=f;H.ShurikenParticleData=Q;H.ShurikenParticleMaterial=m;H.ShurikenParticleRenderer=Za;H.ShurikenParticleSystem=ti;H.SimpleSingletonList=ve;H.SimpleSkinnedMeshRenderer=pr;H.SimpleSkinnedMeshSprite3D=mr;H.SingletonList=e;H.Size=zr;H.SizeOverLifetime=Xa;H.SkinnedMeshRenderer=ii;H.SkinnedMeshSprite3D=ri;H.SkinnedMeshSprite3DShaderDeclaration=ai;H.SkyBox=Zt;H.SkyBoxMaterial=ma;H.SkyDome=Me;H.SkyMesh=qt;H.SkyPanoramicMaterial=Er;H.SkyProceduralMaterial=ga;H.SkyRenderer=Kt;H.SphereColliderShape=V;H.SphereShape=Wa;H.SphericalHarmonicsL2=Se;H.SpotLight=fr;H.Sprite3D=Bt;H.StartFrame=Ya;H.StaticBatchManager=We;H.StaticPlaneColliderShape=i;H.SubMesh=ui;H.SubMeshDynamicBatch=ba;H.SubMeshInstanceBatch=He;H.SubMeshRenderElement=ze;H.SubMeshStaticBatch=Xe;H.SubShader=ha;H.TextMesh=Hr;H.TextureCube=De;H.TextureGenerator=q;H.TextureMode=si;H.TextureSheetAnimation=ja;H.Touch=Re;H.TrailFilter=li;H.TrailGeometry=oi;H.TrailMaterial=v;H.TrailRenderer=_i;H.TrailSprite3D=hi;H.Transform3D=d;H.UnlitMaterial=u;H.Utils3D=F;H.Vector2=Ct;H.Vector3=St;H.Vector3Keyframe=nt;H.Vector4=bt;H.VelocityOverLifetime=qa;H.VertexBuffer3D=vt;H.VertexDeclaration=Tt;H.VertexElement=h;H.VertexElementFormat=_;H.VertexMesh=K;H.VertexPositionTerrain=xi;H.VertexPositionTexture0=Ie;H.VertexShuriKenParticle=g;H.VertexShurikenParticleBillboard=Ka;H.VertexShurikenParticleMesh=Qa;H.VertexTrail=ni;H.Viewport=Xt;H.WaterPrimaryMaterial=va;H.skinnedMatrixCache=fi})(window.Laya=window.Laya||{},Laya);!function(){class t{constructor(){}static getInstance(){if(!this._instance){this._instance=new t;this._instance.loadJson={x:0,type:"View",selectedBox:8,selecteID:12,searchKey:"View",props:{y:0,x:0,width:1280,height:720,centerY:0,centerX:0},nodeParent:-1,maxID:13,loadList3D:[],loadList:[],label:"View",isOpen:true,isDirectory:true,isAniNode:true,hasChild:true,compId:2,child:[{x:15,type:"Box",searchKey:"Box,box",props:{top:0,right:0,name:"box",left:0,bottom:0},nodeParent:2,label:"box",isOpen:true,isDirectory:true,isAniNode:true,hasChild:true,compId:8,child:[{x:30,type:"Label",searchKey:"Label,txt",props:{width:200,valign:"middle",text:"label",name:"txt",fontSize:40,font:"Arial",color:"#ffffff",centerY:0,centerX:0,align:"center"},nodeParent:8,label:"txt",isDirectory:false,isAniNode:true,hasChild:false,compId:11,child:[]},{x:30,type:"Image",searchKey:"Image",props:{skin:"logo.png",centerY:-200,centerX:0},nodeParent:8,label:"Image",isDirectory:false,isAniNode:true,hasChild:false,compId:12,child:[]}]}],animations:[{nodes:[],name:"ani1",id:1,frameRate:24,action:0}]}}return this._instance}init(){}showLoad(){if(this.loadPanel){console.log("进来这里---");this.loadPrefab.visible=true;this.loadPanel.load();return}let t=new Laya.Prefab;t.json=this.loadJson;this.loadPrefab=t.create();this.loadPrefab.addComponent(e);this.loadPrefab&&Laya.stage.addChild(this.loadPrefab,9999);this.loadPrefab.zOrder=9999;this.loadPanel=this.loadPrefab.getComponent(e);this.loadPanel.load()}hideLoad(){this.loadPrefab.visible=false;clearInterval(t.timeId)}}class e extends Laya.Script{constructor(){super()}onAwake(){}load(){console.log("进来这里~");this._panel=this.owner.getChildByName("box");this.txt=this._panel.getChildByName("txt");this._panel.visible=true;this.loadNum=0;t.timeId=setInterval(()=>{this.loadNum+=1;if(this.loadNum<100){this.txt.text="loading…"+this.loadNum+"%"}else{clearInterval(t.timeId)}},100)}onEnable(){}onDisable(){}}t._instance=null;window["loadingManage"]=t.getInstance()}();const a0_0x2468=["specularColorG","Elva Sheridan","battle/skillicon/2005.png","supplementPropList","guide2","albedoIntensity","prefab/battle/enemy/Enemy1021.json","player_1018_baseskill","app/battle/player/PlayerLaser.ts","setData","prefab/battle/enemy/Enemy1024.json","_MainTex_STY","right","signinData","player_1009_baseskill","MESH_COLOR0","ClassUtils","DEPTH_TEST","etype","EnemyLine","Vector3","prefab/battle/effect/PlayerLaserHit3.json","__color__","advData","italic bold 30px Microsoft YaHei","EnemyHPTip","Sabina Dickey","player_4001_robskill","minv","player_2001_bulskill","battle/skillicon/1009.png","randpy","_SpecColorA","prefab/battle/enemySkill/EnemyLine.json","prefab/battle/skill/PlayerSkill2.json","isSameDay","circOut","scene3D","app/battle/effect/EnemyReward.ts","invincible","Additional Attributes","调用appointFaceBookFriend方法,邀请指定玩家id：","STOPPED","number","currDis","getRandomSkill2","skill1053","debug","BulSkill1","Close","blLab","buffNode","End","plaHPPre","start","out","BattleScene","EndlessDialog","Rodney Warner","_SpecColorB","battle/skillicon/1012.png","PlayerWing1b","decBtn","PlayerItemConfig.diamond","getMinEnemy2","DaoDanLiaoJi","level13.json","getID","Completed","PlayerRobot1b","BlurFilterSetter","failNode","item.json","frameOnce","1154365871695610_1164935253972005","桌面快捷方式不可以创建。","limSkiTimLabs","itemIma","setChapter","initCompareData","bounds","app/battle/skill/PlayerSkill10.ts","baseSkill15","battle/enemy/plane/2001/boss01.sk","sendFaceBookFriend","test_esp","bot1","__endless.battle__","EquThunder2","_checkNeedSetRealRankData","_wingskill","prefab/battle/enemy/Enemy1020.json","faceBookAdvertisement","prefab/battle/skill/PlayerSkill4.json","level12.json","geted","moveTime","lobby/equicon/","lastX","skill2001Pre","skill1023","upequip.json","LobbyBgMus","plaBul5Pre","level8.json","RANK","getAtts","player_1007_baseskill","ENABLEVERTEXCOLOR","chapter","nunlock","Are you sure you want to return to the main page? This game will not have any profit!","prefab/battle/enemy/Enemy1023.json","albedoColorR","cirBulPre","diftitle","WingSkill5","player6Bullet","BattleScene.scene","battle/skillicon/3004.png","gameover.item.light","plaBallsV2","limSkiRefTit","eskillCom","HP +&","player.upEquLevel","boomPre","battle/skillsk/1024/cross.sk","maxlv","Gold collected +50%","adgo","skill7","clearBids","hdjqrBtn","Raymond Carroll","RateStart","prefab/battle/bg/GameOverDialog.json","app/battle/robot/PlayerRobot3.ts","bar","paused","stax","app/battle/skill/PlayerSkill5.ts","createChildren","initNode","photo=","Tip","hdljBtn","Dolores Lincoln","hited","prefab/lobby/common/CommonDialog.json","Free remaining times: ","Nicole Harrod","getPassPerson","lobby/planes/Plane3.png","eid","Shader3D","initCoin","getAddV","battle/skillicon/4001.png","lighter1","vec","prefab/lobby/TaskDialog.json","Hilary Martha","Clear\nChapter 7","prefab/battle/skill/Player5Bullet.json","prefab/battle/enemySkill/EnemySmete.json","PlayerSkill3","app/battle/skill/PlayerSkill4.ts","e1002","touched","skill7Pre","trailIma","MESH_WORLDMATRIX_ROW0","BattleSucSou","unlock","enemyCom","app/battle/player/Player.ts","A box of diamonds","FriendPlaneId","trackBox","des","EnemySkill16","difNode","RADAR","scale","app/battle/skill/PlayerSkill3.ts","rotationZ","EquNewAttDialog","5.main","skill6Pre","hScrollBarSkin","EnemyWave","enemyNode","enemyPres","skill16","powtitle","Purple","prefab/lobby/HangarPage.json","getCombatValue","bind","_Shininess","startY","isThreeBar","app/battle/bg/GuidHand.ts","albedoColorB","prefab/lobby/EquipmentPage.json","app/battle/enemy/Enemy2004.ts","scaleY","direxit","EnemySkill18","posv2","enemy_end","已存在引导实例","playerPosV2","battle/skillsk/2006/rainbowguided_a.sk","array","endlessNextEnemy","list","rewList","bgIma","setEndlessAtt","battle/skillsk/1000/ultimate.sk","prefab/battle/enemy/EnemyHPTip.json","cid","powRatio","bosHurtStr","Lindsay Gill,","SwimShell","PlayerWing5b","anonymous","valLab","prefab/battle/enemy/Enemy3002.json","No more Challenges","replace","是否可以与游戏机器人对战err: ","Best Level ","renderMode","battle/skillsk/1033/suckblood.sk","insert","bpjqrBtn","attBox","wing2BPre","radius","setSkill","iniWithData","Short of upgrading materials","cdata","rotate","laser2","MOUSE_OUT","null","MissileWing","baseSkill9","direntry","AchievementDialog","inviteFriends","hit","app/battle/effect/LighterSkeleton.ts","Attack +&","Endless mode","upLevelBtn","进入机库","devY","Texture2D","1.main","BLEND_DISABLE","可以发起支付","Specifications","Crit","prefab/battle/player/PlayerHP.json","getPos","getAttHp","scrollTo","EnemyLaserHide","sound/bosscoming.mp3","ui.LobbySceneUI","tspeed","player_1029_baseskill","effectNode","app/battle/robot/PlayerRobot.ts","itemX","Jacqueline Hugh","mingold","EquMainItem","onLongUpdate","_MainTex_STX","arate","easeOutQuart","modSceneV3","equadds","updateItem","进入无尽模式","HP1","101","skill2012Pre","left","initPlane","NORMALTEXTURE","__bid__","baseSkill5","Bottom","prefab/battle/enemy/Enemy1016.json","PlayerFireBuff","prefab/lobby/AdventurePage.json","denemys3","CommonLoadingDialog","scaleMode","#48ff04","plaWingsV2","unity/plane4/Assets/Plane4.jpg","skill","CoinVideoID","clearBySign","SigninVideoID","EnemySkill2001","assign","removeSelf","skill2","createShortcut","skn","GameOverDialog","types","isRotate","clientWidth","bulBg","PlayerDie","loadingManage","Wingman and 2nd gun attack +10%","LV.","冒险成功","blinkNode","ShuriKenParticle3D","bezierd","retrieve","White","prefab/battle/skill/PlayerSkill10.json","Yvette Spenser","getChildByName","Armament","skill1Tit","prefab/battle/enemySkill/EnemySkill13.json","skill4Icon","blendMode","point","msg_fbRankName","app/lobby/equipment/EquMatDesDialog.ts","Item","app/battle/wing/PlayerWing5.ts","adjustBrightness","skill4Tit","PlayerLaserHit3","concat","RewardedVideo开始加载","getItem","dropgold","graphics","playerPosV3","购买成功,使商品生效并保存玩家信息","appointFaceBookFriendAndUpdateAsync","Pass the pre chapter a few more times to improve your power.","prefab/battle/robot/PlayerRobot2.json","Sandy Wagner","RotateFire","setShopBoxs","Omar Salome","Laser","log","itype","itemIcon","-----------showInterstitialAD------","PlayerRobot2","rewtitle","skill1Desc","setUpequips","Diamond x???","enemys15","split","crit","PlayerSkill6","makeBoom","COMPLETE","endlessThisEnemy","numChildren","Marshall Walton","skill1052","enemys13","endMsg2","starwing001","regClass","model","Arm Ernest","DEBUG","shininess","JSON","schedule","drawCompleteFun","Damage on boss + 15%","app/battle/enemySkill/EnemySkill13.ts","RewardedVideo加载成功回调","BulSkill9","进入困难模式关卡","Ian Hughes","bgBar","font","photoSpriteFrameFun","app/lobby/AchievementDialog.ts","Enaircraft","Equip","udchapter","loadRes","YanHua","squa","CoinInPlayer","reward","thusAttNode","WsFgAtt","BgNode","propNode","setData2","prefab/battle/enemy/Enemy1002.json","lobby","setShopLimsSkill","length","ALBEDOCOLOR","recBtn","onCollisionEnter","player_1033_baseskill","posX","Select:","catch","albedoColorG","app/lobby/common/CommonLoadingDialog.ts","isblink","Speed","Back","battle/skillicon/2002.png","robot3","allBtn","Elvira Tommy","battle/skillsk/3005/burstwingman.sk","REMOVE","bossbox","Hedy Wordsworth","_supply","enemy_return","HPRec1","battle/skillicon/1019.png","PlayerSkill7","returnBtn","spec","Reward:","EneHurt","guide","fbSaveDataKey","type","baseSkill2","coinRate","FuYouPao","baseSkill3","battle/skillicon/1004.png","hanTog","forEach","app/battle/skill/PlayerDieBoom.ts","Chad Ferguson","initItem","EquItemSel","_albedoColor","trail3D","E_Hxb","circle","lobby/adventure/bg_trial_yellow.png","prefab/GuidanceDialog.json","backOut","skill2013","loaded","Sup_HPRec2","shopitems","bossEnemys","Dave Surrey","player_1010_baseskill","trails","guide3","updateChapter","gameSDKName","Zora Buck","PlayerSkill2013","LobbyScene.AdventurePage","alpha","sdkInfo","app/battle/effect/PlayerLaserHit.ts","app/battle/bg/BattleSceneUI.ts","showPay","exp","进入普通模式关卡","Addskill","planeBg","getItemByCreateFun","specularColor","boomPre2","closeBtn","getScore","onReturnClick","prefab/battle/enemySkill/EnemySkill15.json","now","MYShaderMaterial","invBtn","templet","ui.BattleSceneUI","logEventByString","PhysicsDebugDraw","skill5Pre","filter","player_1023_baseskill","prefab/battle/bg/FriendDialog.json","scaleX","battle/player/plane/p","创建桌面快捷方式。","skill15","isLoad","unlockPage","RENDERMODE_TRANSPARENT","Wendell Abraham","playerID","isPauseSelf","blvLab","_ColorB","lastPos","battle/enemy/plane/1014/foe1014.sk","heqArr","cull","EndlessCompare","skill3Desc","initOtherPlayer","EnemySkill9","setSkill2","bsLab","BLENDPARAM_SRC_ALPHA","maxv","materials","HangarItem","norNode","Joy Eve","equip","rewBtn","currH","insUI","冒险失败","loadEnemyPre","coinNum","Once","app/battle/effect/EnemyBoom.ts","Script","battle/skillicon/2009.png","setAdvData","All","shooting","battle/skillicon/2013.png","lobby/equatticon/","addShaderPass","unity/plane1/plane.lh","RENDER_STATE_CULL","btimer","expoOut","PlayerWing2","dailys","EnemyPause","app/lobby/TaskDialog.ts","skill2012","tasks","intertitialAdsIds","add_player","setClick","check","BaseSkill2","size","tabIndex","enemys6","Mary Philemon","route","Maurice Fanny","LevelEnemy","PlayerSkill1","PlayerSkill10","Ternence Emma","Come and play together","app/battle/enemy/Enemy3002.ts","formatNumber","player.killEnemy","hpBar","lassv2","app/lobby/hangar/HangarPlaneItem2.ts","bg2","initPlayerUI","BaseSkill2b","CommonRewardAdDialog","rank","Otis Copper","ClickSou","lim2","app/battle/bg/ChooseAdvSkillDialog.ts","lobby/planes/Plane2.png","gold","shopTog","OpenPage","chaBtn","prefab/lobby/SigninDialog.json","Tips","selid","prefab/battle/skill/PlayerSkill6.json","ShieldWing","LaserTrackTar","onload","playerPre","Loader","newNode","获取好友：","prefab/lobby/equipment/EquMainItem.json","Good","排行榜数据","BLEND","baseSkill7","posY","updateAsyncError","lobby/adventure/ic_zb2_grey.png","setMusicVolume","Seckill","dex","onBoxMoveEnd","level4.json","modeBtn","postSessionScoreAsync","Hyman Pearson","START","Oscar Mark","player_1005_baseskill","getRandomSkill","daiList","skill4Desc","plane3","plane4","purchaseAsync","PlayerSkill2","fileconfig.json","unHit","PlayerRobot3","EnemySkill1011","pauseMsg","PlayerWing2b","Material","GlowFilterSetter","BaseSkill4a","isPlayInterstitialAD","achievement.json","gray","top1","goiNode","goldAdv","prefab/battle/skill/PlayerTimeShield.json","battle/skillicon/3003.png","tan","Payne Anto","Eunice Peggy","Attack","upBtn","endPosV3","buff2Node","play_turn","skill10","tit","FBInstant.startGameAsync回调。玩家 name=","albedoColor","randty","Cherry Morrison","getVec3","event","lightNode","valBar","deltaX","Green","hand","enemy","inflect","DAY ","LobbySceneBgNode","有未消费的订单","plane1","FIRE","subHurt","title","core/utils/RedDot.ts","denemys15","initAchList","app/battle/enemySkill/EnemySkill1022.ts","prefab/battle/wing/PlayerWing5b.json","Crystal Peg","fb api: ","selSkill","Kirk Finn","Jennifer Nahum","onStageMouseDown","_tree","__Adventure__","battle_suit_supply","prefab/lobby/equipment/EquMainTogItem.json","RETURN","battle/skillicon/1016.png","modeNode","skills2","UpCurve","toFixed","diaLab","Reward","battle/skillsk/1030/rage.sk","titleNode","skill9Pre","battle/skillicon/3006.png","Handlers","saveUserData","EquSyn","Basil Moses","level5.json","WingSkill3","denemys13","prefab/battle/skill/Player3Bullet.json","skill3","Aries Bell","BaseSkill3","isend","EnemySkill1","setEnemys","initShowNode","Maud Ferguson","TimeShield","bpljBtn","prefab/lobby/equipment/EquOequDialog.json","app/battle/bg/BattleCompareNode.ts","lobby.equ.syn.item.sel","plaBul3Pre","Benjamin Donne","Rex Burke","HangarDialog","prefab/battle/wing/PlayerWing3.json","Blood","str","prefab/battle/enemySkill/EnemySkill1011.json","PlayerSkill2002","SHIP SELECTION","alignH","app/battle/SkillDialog.ts","Utils","prefab/battle/enemy/Enemy1029.json","plaBul6Pre1","bot2","_AlbedoIntensity","setNumber","RotatePoison","skill1031","MainTrack","PlayerBullet","rewardLab","albedoColorA","Battle","addskill.json","skill2013Pre","loadScene","DownCurve","player_4002_robskill","app/battle/bg/PlayerSkillItem2.ts","player.getPurEqu","Camera","sucNode","getPurchasesAsync","DaoDanGui","denemys12","Henry Katrine","id=","Level ","moveEndHandle","endlessData","wing4","prefab/battle/bg/PlayerRewardNode.json","conPan","friended","BLEND_SRC","Basic Attributes","LocalStorage","checkMark","COMPOSE","initSkill","canvas","visible","freBtn","plaBtn","CUSTOM","strokeStyle","equBtn","clear","battle_rate_end","Mission time:","unity/track/plane.lh","rew2Btn","minbox","sels","battle/skillsk/2011/electric.sk","devX","app/battle/bg/ChooseSkillDialog.ts","Booth Birrell","delta","hpv2","Patricia Yerkes","heqs","skill2Desc","EquOequDialog","Damage reduction + 20%","lobby/planes/Plane6.png","Get a normal, excellent or rare item","Diamond x??","DaoDanFu","tilingOffset","lobby/planes/Plane4.png","Cri","iconIma","Dominic Wood","onConfigLoaded","openDialog","cbulPre","path","player_2003_bulskill","eneQue","att2Box","BulSkill4","Sam Carmen","SHOP","unity/daodanf/plane.lh","lobby/ball/","prefab/battle/enemy/Enemy1004.json","make_level_enemy","lobby.hangar","instance","Task","EndlessScore","shield1","WingSkill4","app/battle/bg/EndlessOverstepDialog.ts","Mike Conrad","MATERIAL","EnemyBoom","bulPre","prefab/battle/wing/PlayerWing5.json","u_Shininess","Upgrade successful","OffEqu","soundTog","unity/daodanliaoji/plane.lh","skill1013","picon","levLab","lvLab","Blue","level","MESH_TEXTURECOORDINATE1","RECOMMEND","level1.json","Selected","player_2009_bulskill","baseSkill4","好友图片加载完成，调用FBInstant.updateAsync方法，邀请好友","sureHandle","battle/skillsk/1028/danmakudeath.sk","Geoffrey Parker","fbSafeScore","prefab/battle/bg/EndlessOverstepDialog.json","BaseSkill7","Material:renderMode value error.","isSignin","fypBtn","assets","Brian Martin","Vito Hobbes","PlayerMaxHP","_Cutoff","difBtn","shareAsync","prefab/battle/enemy/Enemy2003.json","GUN","Sarah Felix","faceBookPayment","onBoxMove","BaseSkill4","buyBtn","player_1019_supply","battle/skillicon/2006.png","playerNode","advDrop","Player1","limRewRefBtn","blend","Sup_Att","player2Node","player_3004_wingskill","Guid","selfCol","prefab/battle/merge.json","enableVertexColor","context","Get rewards","FriendDialog","bestLevel","Remove","pid","lobby.equ.item.sel",".sk","winSke",'#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl"\r\n#include "Shadow.glsl";\r\n\r\n\r\nattribute vec4 a_Position;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\r\n\tattribute vec2 a_Texcoord0;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#if defined(LIGHTMAP)&&defined(UV1)\r\n\tattribute vec2 a_Texcoord1;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tuniform vec4 u_LightmapScaleOffset;\r\n\tvarying vec2 v_LightMapUV;\r\n#endif\r\n\r\n#ifdef COLOR\r\n\tattribute vec4 a_Color;\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\nattribute vec3 a_Normal;\r\nvarying vec3 v_Normal; \r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tuniform vec3 u_CameraPos;\r\n\tvarying vec3 v_ViewDir; \r\n#endif\r\n\r\n#if defined(NORMALMAP)\r\n\tattribute vec4 a_Tangent0;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_WorldMat;\r\n#else\r\n\tuniform mat4 u_WorldMat;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\t\r\n\tmat4 worldMat;\r\n\t#ifdef GPU_INSTANCE\r\n\t\tworldMat = a_WorldMat;\r\n\t#else\r\n\t\tworldMat = u_WorldMat;\r\n\t#endif\r\n\r\n\tmat3 worldInvMat;\r\n\t#ifdef BONE\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\r\n\t#else\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\r\n\t#endif  \r\n\tv_Normal=normalize(a_Normal*worldInvMat);\r\n\t#if defined(NORMALMAP)\r\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\r\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\tvec3 positionWS=(worldMat*position).xyz;\r\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\t\tv_PositionWorld = positionWS;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\t\t#ifdef TILINGOFFSET\r\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t\t#else\r\n\t\t\tv_Texcoord0=a_Texcoord0;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef LIGHTMAP\r\n\t\t#ifdef UV1\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#else\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#endif \r\n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\r\n\t#endif\r\n\r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tv_Color=a_Color;\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\r\n\t#endif\r\n\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}',"playerPre1","PlayerSkill8","height","stageY","battle/skillsk/2010/troublemaker.sk","line","Max level","RebornVideoID","app/lobby/DailyDialog.ts","headIma","getEntriesAsync suc:","DEF_UV","booming","skill9","content","payments","achList","off","Armor","Add","SPECULARMAP","__type__","sdkPort","skill1002","skill11Pre","PlayerBlast","签到第","prefab/battle/enemy/Enemy1018.json","Inviting friends can only help one day","parentNode","Return","#ffffff","renderingOrder","new","_MainTex_STW","join","text","eheight","app/lobby/equipment/EquSymDialog.ts","Rectangle","prefab/battle/effect/PlayerCoin.json","laser","rotBulPre","setShaderName","load3D","suitBtn","_ColorA","SPECULARTEXTURE","app/battle/skill/PlayerSkill12.ts","Aldrich White","denemys","setVector","stuSke","exp.json","player_laser_track","ARMAMENT","test_eat","canBtn","deltaY","attack","adventure.start","prefab/battle/enemy/Enemy1006.json","Unlock New Skills","prefab/battle/bg/ChooseAdvSkillDialog.json","getSupportedAPIs","isClose","Point","hpLab","RANGE","planesUI","faceBookUpdateAsync","BaseSkill4b","EquMainTogItem","recommend","邀请好友。","邀请好友","PlayerShield","Betty Pater","点击左下角待解锁飞机","app/battle/skill/PlayerTimeShield.ts","GetFlyCoinSou","skill18Pre","RENDER_STATE_BLEND","object","#000000","fspeed","Best Level","Alice Zacharias","Friends Assist","rankData","loadGamePre","player4BulletCall","MESH_MVPMATRIX_ROW0","BulSkill1_Start","Glenn Cocker","app/battle/robot/PlayerRobot2.ts","s_BlendDst","__continue.endless__","backIn","Chapter","recNode","startH","anchorX","endMsg","player.watchAd","timerLab","baseWidth","maiNode","code","initPlaneBullet","通过GO进入游戏","time","unity/e_daodan/plane.lh","battle/skillsk/1027/timeshield.sk","addChild","EnemySkill3","interactable","mateNode","rewTimeNode","nodes","initGoodNode","Common","round","bgTopNode","Lv.","player_2010_bulskill_start","atan2","Wade Kit","HangarPage.priBtn","Select Skills","player_laser_cross","showall","LaserTrack","Plane.Mute","supSkill3","Barnett Nick","CubeManiaRank","BaseSkill13","skill4Pre","getConnectedPlayersAsync","skill1003","initSkillNode","startScene","trail","initRewNode","prefab/battle/enemySkill/EnemySkill5.json","BulSkill8","PlayerSkill9","track","Ryan Ellis","touchDown","battle/skillicon/1028.png","currHP","image/jpeg","thuBox","player_laser_track_tar","limSkiRefBtn","app/lobby/equipment/EquNewAttDialog.ts","_components","s_BlendSrc","Wade Peter","battle/skillsk/2004/swimcannon.sk","core/utils/BoxCollision.ts","SoundManager","BulSkill6","app/battle/bg/BattleFriendNode.ts","battle/skillicon/1013.png","timers","xzbqBtn","skill17","CommonRewardDialog","Browser","magnet","NaughtyGhost","updateNode","hide","sort","localRotationEulerZ","cjbBtn","initShader","tipLab","init2","sdljBtn","SHADERDEFINE_NORMALMAP","bulletsp","baseSkill13","skill1011","prefab/battle/bg/SupplySkillDialog.json","lobby/itembg/","pauseBtn","prefab/battle/effect/PlayerIceBuff.json","levelLab","stop","unity/plane1/Assets/Plane_3.jpg","battle/skillsk/1025/rotateshield.sk","prefab/battle/skill/PlayerSkill2013.json","app/lobby/task/ShopBoxItem.ts","then","_enableLighting","AdvRateSupply","Lobby://","MainStr","Hazel Evan","Radar","Zenobia Gunther","RobSkill2","robot2","chaNameLab","Rewards","HangarItemSel","attLab","itemScale","_startGameFun","%s Successfully Removed","clearLasers","LaserWing","app/lobby/equipment/EquDecDialog.ts","battle/skillicon/4002.png","Hard","topNode","battle/skillsk/2009/fireball.sk","desc1","battle/skillicon/1000.png","Sign in reward","level6.json","UnlockPlaneDialog","Supply","SELECT","battle_rate_start","Attributes","Vector4","addComponent","Jo Bruce","RenderState","DieBoom","loadImage","create","fontData","__eid__","skill1033","app/battle/robot/PlayerRobot1.ts","indIma","tar","prefab/battle/effect/PlayerBlast.json","aircraft.json","iswudi2","Sibyl Rhodes","getRewardedVideoAsync","邀请指定好友","enemy_hit","lockList","addgold","lerp","info","BattleCompareBigNode","loadBattlePre","__dif__","normalize","rewNum","timeLab","MESH_TEXTURECOORDINATE0","updateCoin","tilingOffsetY","DEPTH_16","ICE","Ophelia Peter","Simon Wallace","multiTouchEnabled","json/merge.json","battle/skillicon/1027.png","critHurt","_SpecColorG","imgHeight","Damage on enemy +&","planeSpr","sin","Challenge times:","__endValue__","setDailyTasks","rate","config.setter","lobby/adventure/Equipment_Trial.png","cos","%s Successful Equipment","wing2","translate","BattlePage","prefab/battle/wing/PlayerWing2b.json","RebornDialog","_robskill","prefab/battle/skill/PlayerLaser.json","edata","WINGS","scoreLab","wing3BPre","Tabitha Pulit","prefab/battle/enemy/Enemy1012.json","pow","onStageMouseUp","skill1","Anger","LaserHide","parent","random","POWER:","getCombatValueUI","currLight","player_1030_baseskill","instantiate","Sophia Joyce","Ulysses Guy","Mandy Spring","isInit","PlayerLaser","setDataAsync","moveCoin","robotNames","cind","scoreRankArr","depthTest","PlayerHP","BulSkill2012","guidSkill","Each game can be revived once (reduce 50% hp limit)","DieShot","camera","rankNode","setAchieve","lobby/adventure/icon_difficulty.png","makeDieBoom","u_NoiseTex","alphaTestValue","player_speed","plaWing3Pre","player2Bullet","Alvin MacArthur","playBtn","Image","attributeNode","skill4","upLevExps","adv","setItems","baseSkill14","Register","color","canCreateShortcutAsync","denemys2","difficulty","_ColorR","Kerr Reade","player_laser_hide","test","cirMask","resetLimGood","upaircraft.json","skill1041","plaBulPre","Nathan Anthony","Betsy Larkin","consumePurchaseAsync","indLab","click","onVersionLoaded","player1Bullet","descLab","Candice Wild","plaRob2Pre","BaseSkill6b","unity/fuyoupao/plane.lh","battle_advrate_supply","1154365871695610_1164935510638646","hequips","playerV3","normalTexture","The limited-time skills will be invalid after refresh. Do you want to continue?","setSignData","titleLab","prefab/lobby/BattlePage.json","setName","cen1","prefab/battle/enemy/Enemy2004.json","player_2002_bulskill","faceBookSDK","eneHurtStr","FREE","img","PlayerWing5","PlayerTimeShield","mask","Insufficient Gold","start game!!!","photo","ddljBtn","skill6","Phil Harrison","_ColorG","startMove","stepScore","RENDERMODE_CUTOUT","PERIOD_CAMERA","BATTLE","res/lg.png","enemyCols","Pool","__PoolSigns__","_norV3","upPlaGold","max_objects","Nathan Oliver","shield2","string","Yale Julian","进入无尽模式关卡","sdBtn","state","Log in for 7 days in a raw","Buck Daisy","支付并没有准备好","alphaTest","PlayerWing6","propertyNameToID","staBtn","lvBox","player_1006_baseskill","app/battle/skill/PlayerSkill2.ts","equPage","PlayerDieShot","gaLogEvent","keys","CRIT","DebugPanel","__initDefine__","app/lobby/equipment/EquSuitDialog.ts","LobbySceneUI","bg1Ima","physicsDebug","player_1027_baseskill","UnlockChapterDialog","lobby/adventure/icon_infernal.png","test_php","HangarPlaneItem","tips","map","_getfriendsList","s_Cull","interstitialKeyArr","equTog","_Color","Fireworks","startBtn","setEnemys1","findKey","Line","alignV","player_1014_supply","setChatpers","app/battle/effect/HpBarLight.ts","barNums","Ruth Nell","player_die","PlayerWing1","clickHandle","ecolCom","setTask","prefab/battle/enemy/Enemy1025.json","app/battle/bg/EndlessOverDialog.ts","prefab/battle/skill/Player4MainBoom.json","battle/skillicon/1023.png","coins","planes3D","BaseSkill5b","player.expendCoin","skill1001","Plane.Vibrate","lobby.equ.syn","进入章节","limSkiNode","ggmgr","enemy_pause","Fatt","Move","getContext","redDot","PlayerSkillItem","getUserData","cspeed","lvSke","MATERIALSPECULAR","glc","plaWing6Pre","Right","Coral Gus","guidIns","setShopItems","WingSkill6","getMaxidEnemy","rotation","HangarDialog.go","app/battle/enemy/EnemySkill.ts","__bgIma__","app/battle/player/PlayerHP.ts","BulSkill7_Start","lastEnemy","Yale Bob","find","Jenny Quiller","postScoreToFB","dchapter","PlayerIceBuff","Damage on boss","Repeat","laserTrack","item7","conBtn","支付失败:","startLevel","maxbox","topAnim","ColorFilter","blendSrc","splice","setPlanes","BaseSkill9","skill15Pre","battle/skillsk/1005/attack.sk","player.killBoss","showBtn","horNode","compareData","prefab/battle/player/Player.json","souOpenBtn","prefab/battle/wing/PlayerWing3b.json","setLoadingProgress","Unlock by completing the level 20 of chapter $ in the normal mode","RENDERMODE_OPAQUE","prefab/battle/enemy/Enemy1014.json","battle/skillicon/4003.png","Insufficient Diamonds","prefab/battle/enemySkill/EnemySkill1022.json","arrow","app/battle/enemySkill/EnemySkill3.ts","skeNode","onUpdate","handle","getQueryString","getPayList","player_1015_supply","currBsp","suckBlood","currAnimIndex","wing6","Omar Maxwell","PlayerWing3b","reward_num","MESH_BLENDWEIGHT0","skill1Pre","onCollisionExit","getBtn","study_skill","app/battle/enemy/Enemy2005.ts","endlessStartAtt","startColorConstant","shipEnemys","cross","setScoreAsync","app/lobby/LobbySceneUI.ts","coinLab","Nothing","Marina Aldridge","conBox","limRewRefTit","isPausing","pngData","__spicol__","prototype","endx","POISON","dailyTasks","prefab/lobby/equipment/EquMatDesDialog.json","moveState","Templet","initPlane4Bullet","Attack1","height2","clone","plaNameLab","u_DiffuseColor","limRewNumTit","Skill","SHADERDEFINE_DIFFUSEMAP","Restore a certain HP after defeating an enemy","获取游戏isFirstStartGame属性，如果true则调用FBInstant.startGameAsync方法","Max Julia","prefab/battle/enemy/Enemy2005.json","Materials","payid","xzhqBtn","prefab/battle/effect/EnemyBoom2.json","supSkill4","getVector","PlaneTrackModel","Vector2","清除对应的消费信息:","unity/plane2/Assets/Plane_2.jpg","att1","Faithe Rob","showInterstitialAD","保存数据到本地","goBtn","tapos","unity/plane2/plane.lh","Player4MainBoom","WingSkill2","setItem","Upgold","skill13Pre","battle/skillsk/3006/shieldwingman.sk","skill14","plane","startGet","skill5","addAtt","add","GameOver","BulSkill2","ShieldRobot","trackCol","getChildAt","playerMainBullet","baseSkill1","getVec4","Cora Garcia","getConnectedPlayerEntriesAsync","dieShot","handNode","player.unlockplane","stage","setStaEndPos","plaWing5Pre","There Euphemia","prefab/battle/enemySkill/EnemySkill16.json","Agun","specularColorB","denemys14","prefab/lobby/common/CommonLoadingDialog.json","loading","isCanPayment","itemRender","playerHPV2","ppos2","prefab/battle","Gloria Joan","AdventurePage","wudiAnim","drawCircle","Timer","pangle","plane5","Box","shotWing","cloHan","test_rate","lvPro","test_chap","/2.png","skill1021","1154365871695610_1161636604301870","prefab/battle/enemy/Enemy3001.json","abs","Magee","Sound","battle/main/bar/xue_max2.png","hitArea","EventDispatcher","att2","coin_in_player","endless_score","bezier","starwing20210422","RENDER_STATE_DEPTH_TEST","adventuredrop.json","BulSkill5","prefab/lobby/UnlockPlaneDialog.json","fnBtn","u_NormalTexture","BlastRobot","skill2Tit","core/component/HorizontalSelect.ts","onCloseClick","_bulskill","skill12","return","setDrop","friends","prefab/battle/bg/BattleFriendNode.json","getInstance","app/battle/effect/PlayerCoin.ts","Player6Bullet","achievements","setForward","thunders","stageX","specularColorA","LIGHTER","startDrag","width","lobby/rank/num_","1/1","BaseSkill6a","battlePage","PERIOD_SPRITE","eneHPTipPre","Tony Camilla","pauseTime","shield","transform","player5Bullet","battle/skillicon/2011.png","chaFigLab","vibCloBtn","addAtt2","currAtt","prefab/battle/enemy/Enemy1010.json","DirectionLight","enemys10","touchX","enemy_laser_hide","createAsync","Oscar Anderson","Successfully Received","player.shopBox","localScale","worldMatrix","USER_INPUT","MISSION","_MainTex_STZ","animNode","调用FBInstant.context.chooseAsync方法","Upequip","player_reborn","Lobby","LaserCross","RateEnd","MOUSE_DOWN","battle/skillicon/1005.png","dailytask.json","battle/skillsk/1020/","??? ","app/battle/SkillManager.ts","angle","camera3D","Matthew Isaac","bgoods","battle/skillsk/4002/laserrobot.sk","Grace Beerbohm","shopBoxs","swbzBtn","initDia","BLEND_ENABLE_ALL","Stat","top2","Shop","skillLinePre","getPlayer","modCameraV3","PUSH","battle/enemy/plane/1006/foe1006.sk","subscribeBotAsync","1154365871695610_1161637077635156","randnm","battle/skillsk/1032/fearless.sk","title2","timer2","skill8","HANGAR","addDefine","supplyData","open","playerData","PlayerReborn","setAdds","nameLab","hangarPage","Nat Anderson","realRankData","EndlessOverstepDialog","supSkill2","version.json","initList","Handler","BlendMode","startAdv","setSoundVolume","1154365871695610_1164935183972012","Wilbur Dunlop","desc","Ivy Grant","bg2Ima","TIPS","maxgold","enemys","EnemySkill5","1154365871695610_1277377419394454","player_","synBtn","_getRandomBotArr","sqrt","bulletPre1","Attribute","Coin","filters","u_TilingOffset","Ease","SET","Recommended power:","addBannerInfo","boomSke","商品消费掉了：","wing1","battle","获取FB好友：","Player","DailyDialog","BaseSkill11","EquThunder1","EnemyLaser","fnSkill","app/battle/enemy/Enemy2006.ts","clickAnim","onDisable","enemys7","_albedoIntensity","diaBtn","Choose the item you want to compose!\nPlace matched items of the same quality to compose a new item!","Sup_Crit","denemys5","chaLevLab","isEndless","battle/skillicon/1020.png","HpBarLight","plaIma","parcmp","RECEIVE","SigninDialog","head/","player_1011_baseskill","Self","otherEnemys","price","skill1051","RobSkill3","app/battle/enemy/Enemy2003.ts","poison","extragold","skill18","Adair Acheson","player1BulletCall","selectDistance","laserSta","WingSkill1","ClosePauseDialog","quadIn","choBtn","swbzSkill","shortcut","cubicIn","PlaneModel","data","lobby/adventure/icon_ordinary.png",".png","Kay Noel","BACK","RewardedVideo广告显示成功","load model complete...","difChapters","robotbullet","removeDefine","获取用户登录信息调用:FBInstant.initializeAsync函数","Player1Bullet","Ingrid Patience","player_2004_bulskill_start","cen2","playerCols","Wings","困难模式关卡失败","advTog","closeHandle","score","sound/getflycoin.mp3","u_DiffuseTexture","onIOS","Clear\nChapter 13","zzBtn","skills"," 剩余敌机 -> ","unity/daodan/plane.lh","inviteFriend","plaWing4Pre","battle/skillicon/1034.png","good","cubicOut","prefab/battle/skill/PlayerSkill3.json","assets2","gameState","lockNode","Salome Malan","setAchis","rec","Hero","initPlane3Bullet","Alfred Isabel","EnemyBoom2","call","prefab/battle/effect/EnemyWave.json","skill10Pre","level14.json","enemys4","planes","sound/planelv.mp3","GuidSkill","uchapter","space","SHADERDEFINE_ENABLEVERTEXCOLOR","EnemySkill15","timeBar","EnemySkill11","skill1012","autoAddZero","EnemyHit","loadAsync","player.rated","取到缓存数据:","skill1042","player_3002_wingskill","onBoxMoving","battle/bg/","Always","Scene3D","prefab/battle/wing/PlayerWing6b.json","specialSuit","_baseskill","hiting","isEnd","player5BulletCall","app/lobby/SigninDialog.ts","_enableVertexColor","battle/skillsk/3003/laserwingman.sk","BattleFriendNode","staPos","PlayerLaserHit","RENDER_STATE_BLEND_SRC","repeatX","getTask","titleBg","logEvent","app/battle/enemy/Enemy.ts","battle/skillicon/1031.png","Edwiin Becky","tilingOffsetZ","unlockAdv","New Plane","skill1022","prefab/lobby/common/CommonRewardAdDialog.json","Adventuredrop","playSound","Can get a certain amount of diamonds","BaseSkill14","otherPlayer","disx","level11.json","addSpeed","BlinnPhongMaterial","currShipEnemys","index","Achievement","ResourceVersion","play","Diamond","Roberta Dewar","plaWing2Pre","Select %s successfully","bounceOut","skePath","app/battle/wing/PlayerWing3.ts","BulSkill2002","upequips","_gameState","LobbyScene.scene","PlayerWing6b","rewards","邀请好友回调","chaLevTitLab","getInt","Aaron Ramsden","crossOrigin","SHADERDEFINE_TILINGOFFSET","_SpecColor","升级飞机","rewardEnemys","getVec2","toString","makeLevelEnemy","bids","initPlayerModel","Isidore Palmer","developerPayload","planeIma","Wingman Attack","Ira Bell","Texture","Unlock by completing the level 20\n of chapter $ in the normal mode","quadTree","onLateUpdate","scrollBar","speed","app/battle/bg/GamePauseDialog.ts","app/battle/wing/PlayerWing4.ts","battle/skillsk/2001/shot.sk","isIOS","aabb","noiseTex","currHp","eneBulNode","enemys0","goldNode","setItemList","创建桌面快捷方式失败。","EnemyReturn","closeHandler","skill2Icon","SuitSupply","offAllCaller","shopLims","app/battle/skill/PlayerSkill6.ts","PlayerItemConfig.coin","wattack","move","bulletstart","last","adBtn","sound/boom2.mp3","skeCon","destination-out","player_4003_robskill","diff","prefab/battle/wing/PlayerWing1b.json","setInt","DEPTH_WRITE","FILENAME_VERSION","xshdBtn","player_1022_baseskill","circIn","dailyBtn","initDaiList","prefab/battle/skill/PlayerDieBoom.json","warn","robotsp","PlayerWing3","Gold","levelBox","posv3","Howar Louisa","June Margery","battle/skillicon/1032.png","app/battle/skill/PlayerShield.ts","battle/skillsk/4001/blastrobot.sk","BulSkill2013","rankBtn","Pause","MOUSE_MOVE","initPlane2Bullet","bgSke","app/battle/EnemyManager.ts","player3BulletCall","SubHurt","GameStateChange","barPor","endPos","prefab/battle/enemy/Enemy1008.json","level0.json","rebBtn","DECOMPOSE","Diana Hoyle","Main4","lines","fattack","navigator","startAng","PlayerWing4b","icon","Emily Barney","Obtained skills","Brian Rayleign","Alston Sophia","Player6Bullet1","PlaneLevUpSou","distance","Sup_HP","errorLoadInterstitialCount","Sup_HPRec1","onEnActive","denemys1","Player5Bullet","achBtn","swdmBtn","Discount Shop","mainNum","shareGame","Noel Lawrence","PREFAB","SHADERDEFINE_SPECULARMAP","inited","battle/skillsk/2007/poisonball.sk","EquMainStr","I have passed many levels. Can you surpass me?","clearAll","true","prefab/battle/enemy/Enemy1027.json","READY","EndlessOverDialog","maxair","quality","json","app/lobby/UnlockPlaneDialog.ts","unLockNode","Level","push","s3d","shop.json","beil","Aircraft","player.selSkill","chooseBtn","documentElement","battle/main/bar/xue_max.png","planeList","BLEND_DST","困难模式章节成功","Cynthia Noyes","drawTexture","subtract","sound/boom1.mp3","max_levels","appointFaceBookFriend方法回调","battle/skillicon/1001.png","bid","loadBatPre","goToOtherGame","rewNode","EnemySmete","jgBtn","danum","planeData","iswudi","plaRob1Pre","specularTexture","att","zOrder","centerPos","Silver chest","buff3Node","textAlign","powLab","destroy","bestScore","battle/skillsk/2003/laser.sk","exportSceneToJson","BaseSkill5","setTexture","title1","postSessionScoreAsync发送分数给FB ","onCloseBtnClick","initialize","Flame set","buildArmature","Alvis Garcia","baseSkill11","pscale","items","UnlockChapterDialog.close","numLab","show","drop","midNode","Godfery Collins","SolidColor","chaHorSel","PERIOD_MATERIAL","lobby.hangar.item.sel","Devin Theresa","app/battle/skill/PlayerSkill2013.ts","equips","getMinEnemy","denemys4","battle/enemy/plane/1004/foe1004.sk","trackTar","WebGL","isEnding","fillStyle","app/battle/skill/PlayerSkill2012.ts","Player3Bullet","prefab/battle/bg/BattleSceneMidNode.json","battle/skillsk/2002/missile.sk","loadInterstitial","useWebGL2","app/lobby/ShopPage.ts","baseSkill6","SuckBlood","创建桌面快捷方式canCreateShortcut：","app/lobby/equipment/EquipmentPage.ts","BattleBossComSou","shopPage","wing3","localRotationEuler","addHp","font/DIN-BlackItalic.ttf","aspeed","dragRegion","plane2","Prefab","获取创建桌面快捷方式数据失败。","ballsv2","Lim","prefab/lobby/HangarPlaneItem.json","getDefineByName","robot2BPre","ranax","enemys9","wudi2","leaderboard","skillRotatePre","achData2","Event","player_max_hp","Audrey Swin","battle/skillicon/1008.png","指定好友回调！","atan","player.getEqu","bspeed","sound/click.mp3","Aurora set","src","gameSaveDataKey","updateRate","sid","Score ","Emma Ernest","fire","setTasks","going","expandT","equAdv","CULL","closeDialog","prefab/battle/enemySkill/EnemySkill9.json","recd","Galaxy set","prefab/battle/bg/BgNode.json","prefab/battle/wing/PlayerWing1.json","onClick","Node","app/data/LanguageLab.ts","ATTACK","xshdSkill","skill.json","Chad Hewlett","BaseSkill1","nextStep","PlayerRobot1","MAGNET","active","Harold Cover","Shotgun","Brid","initItems","meshRenderer","prefab/lobby/DailyDialog.json","vScrollBarSkin","min","suit","battle/skillsk/3004/rungunwingman.sk","unity/plane6/plane.lh","PERIOD_SCENE","isMakingEnemy","player_1034_baseskill","orthographicVerticalSize","stringValue","CommonDialog","quintOut","bg1","eneMgr","1154365871695610_1164935767305287","prefab/battle/enemy/Enemy1019.json","skill8Pre","objects","Diamond Shop","skill11","app/battle/skill/PlayerSkill7.ts","playerMods","goods","skill1043","limSkiNumTit","PlayerSkill5","ChooseAdvSkillDialog","Elroy MacAdam","Edwiin Eisen","BaseSkill1a","TILINGOFFSET","NEW_CONTEXT_ONLY","initLimNode","app/lobby/common/CommonTipDialog.ts","player_3006_wingskill","getTar","han","diamond","BaseSkill5a","lobby.addbg","LABEL","app/battle/player/PlayerCollision.ts","Broderick Joe","load","fbulPre","Tween","timer","Jamie Lucy","lighter","mbulPre","bulletPre2","Top","end","RenderTextureFormat","reset","Clare Carpenter","Grace Noah","pos","Player4Bullet","Best Score","Hubery Conan","pan","floor","创建桌面快捷方式sdk。","drawImage","level2.json","createElement","tips.clearance","setHours","困难模式章节失败","RankDialog","s_Blend","REWARD","RewardNum","getTrackEnemy","Current level","xsv","imgWidth","Lv ","app/battle/bg/BgNode.ts","wing5","BattleCompareSmallNode","limRewNode","CLICK","icoIma","bgCha","Magnet","addAtt1","__continue.battle__","tit1","gcBtn","Sup_Speed","clearFlag","blendDst","prefab/lobby/HangarDialog.json","00:00:00","prefab/battle/skill/PlayerSkill8.json","lobby/equicon/201.png","box2","EquDecDialog","app/lobby/equipment/EquMainTogItem2.ts","skill3Tit","once","ALBEDOTEXTURE","getPlatform","lineWidth","nattLab","__light__","app/battle/effect/BossComingNode.ts","vibOpenBtn","Dialog","app/lobby/task/TaskItem.ts","clearColor","进入第一章","cloBtn","lobby/planes/Plane5.png","startFriend","enable","levelExps","shaBtn","item","ARMOR","prefab/battle/bg/EndlessOverDialog.json","ske","completeHandler","makeSmete","makeCoin","Sprite","describe","prefab/battle/bg/PlayerSkillItem.json","BlastWing","loadSkillPre","mattsNode","wudi1","playerScore","Sprite3D","battle/skillicon/1026.png","ratio3D","xzdqBtn","name","prefab/battle/enemy/Enemy2001.json","battle/skillsk/2008/iceball.sk","普通模式关卡失败","Normal","hits","chaLab","currSkill","getComponent","error","__$type$__","supUnlock","NOISE_TEX","lastCompareData","plane6","box1","shock","TaskItem","init","prefab/battle/enemySkill/EnemySkill11.json","startGameAsync","robotPhotos","prefab/battle/skill/Player4Bullet.json","CaiHon","getRes","app/battle/enemy/Enemy2002.ts","prefab/battle/wing/PlayerWing4b.json","atttime","isRotSelf","Weapon Attack","playMusic","denemys9","mindiamond","冒险难度","getJSON","_flushRankData","battle/skillicon/1029.png","skill2Pre","#adaeae","Avery Raglan","BattleBgMus","分享失败。","friendRoboted","wing1BPre","getMessengerRobot","Roxanne Eveline","yhSkill","xzhdSkill","indexOf","recover","planeId","cbdcBtn","getGold","PlayerSpeed","BattlePage.achBtn","EnemyDead","Daily","xzhdBtn","getAchieve","initPlaBall","ADVENTURE","MESH_TANGENT0","ppos","Bertram Dewey","quadInOut","Lucien Harper","supSkill1","getName","prefab/battle/enemySkill/EnemySkill10.json","prefab/battle/skill/PlayerSkill9.json","vibrate","unity/plane4/plane.lh","comChapters","Difficulty","HangarPage","EquSuitDialog","prefab/battle/skill/Player1Bullet.json","_MainTex_ST","SHININESS","orthographic","cloneTo","particleSystem","plaWing1Pre","getRobotNames","supSkill5","togList","defense","only","sound/success.mp3","currBaseNum","desLab","http","...","Gold x???","battle/skillsk/1013/lifeback.sk","convertScreenCoordToOrthographicCoord","Play","selfNode","currBarWidth","Abel Smith","lobby/rank/li_r_h.png","All attributes + 35%","prefab/lobby/common/CommonTipDialog.json","Legendary chest","res/fx.png","timeShield","initPlayer","_shaderValues","none","WATCH","head/1.png","app/battle/enemy/EnemyHPTip.ts","achieves","player_1032_baseskill","advPage","BaseSkill2a","stat","#ff0300","Gwend Oliver","get friend fail","wingsv2","playbackRate","update suc,get leadbord","已解锁第","Zoe Kennedy","isNewDay","Engine","onEvent","ALL","player_main_bullet","New attribute:","app/battle/skill/PlayerSkill9.ts","prefab/battle/enemy/Enemy1026.json","titLab","isChecked","MOUSE_UP","getTexture","yhBtn","CameraClearFlags","consumeFbItem","getSkill","Miranda Douglas","touHandle","Lucien Henri","swdmSkill","Damage on boss +&","hitnum","abbdc","Edison Horatio","getRandom","adventurefight.json","coin","BossHurt","laser1","loadPrefab","player_3005_wingskill","rewardtype","max","There's a chance to get high fire speed within 5S","isNewPlayer","getRank","anchorY","Rex Bertha","EquipmentPage","stopScroll","ddBtn","getIndex","LaserRobot","_SpecColorR","initPlayerNode","OnEqu","Jill Wilde","att1Box","BaseSkill1b","load prefab complete...","contBtn","EnemySkill1022","weapon","EnemyEnd","skill1Icon","staPosV3","prefab/battle/enemySkill/EnemySkill2001.json","#fef523","Ruth Harrington","Left","Edwina Theresa","battle/skillicon/1024.png","han1","Dolores Adolph","itemList","prefab/battle/bg/ChooseSkillDialog.json","Coming soon","enemys1","unlockskill","player_2004_bulskill","loader","Dominic Larkin","old","player.endlessed","difLab","Gloria Jim","BattlePage.taskBtn","bottomNode","formatTimer","nextHandle","getPhoto","bgSceneV2","prefab/battle/enemy/Enemy2002.json","跳转其他游戏成功","END","CommonTipDialog","_shuffleArray","PlayerPoisonBuff","clearBattlePool","获取用户登录信息:FBInstant.initializeAsync回调:","player_1001_baseskill","sureBtn","PlayerWing4","steps","ShopData","Bblythe Eveline","SubShader","普通模式章节成功","nid","battle/skillsk/1031/seckill.sk","jgjqrBtn","jgljBtn","Wright Gall","res/sharebg.jpg","isFirstStartGame","prefab/battle/effect/PlayerFireBuff.json","prefab/lobby/common/UnlockChapterDialog.json","shakeEffect","prefab/battle/enemy/Enemy2006.json","Marsh Roland","endless_compare","enemys11","ChooseSkillDialog","upEquMate","StudySkill","prefab/battle/robot/PlayerRobot1.json","shift","core/component/GuidanceDialog.ts","preLoadInterstitialAD","SHARE","app/lobby/EndlessDialog.ts","BulSkill10","prefab/battle/robot/PlayerRobot3.json","getRobotPhotos","ShotWing","取到FB的数据:","stopDrag","wing5BPre","logintime","test_eid","faceBookSDKTest","onCollision","skilltype","CULL_BACK","maskNode","prefab/lobby/equipment/EquDecDialog.json","TaskDialog","zzpljBtn","PlayerSkill4","player_2008_bulskill","fixedwidth","app/lobby/equipment/EquOequDialog.ts","wing4BPre","u_SpecularTexture","Refresh","selectIndex","updateAsync","app/battle/bg/GameOverDialog.ts","getBase64Image","E_DaoDan","EquSynItemSel","ratio","refBtn","renderHandler","plaLassV2","loop","SupplySkillDialog","ShockWave","head","denemys11","battle/enemy/plane/1002/foe1002.sk","IsIOS","#ff0000","isLoadInterstitialAD","app/battle/enemy/Enemy1017.ts","redDotIma","onHangarPage","RobSkill1","prefab/battle/skill/PlayerSkill2012.json","BaseSkill6","robot","bossComNode","battle/skillicon/2008.png","addSubShader","_getRealRank","addnum","Scene","battleUI","Byron Tracy","denemys8","test_ehp","Christian Coco","ani","EnemySkill13","LASER","Script3D","onEnable","battle/skillsk/1001/life.sk","dssNode","prefab/battle/enemySkill/EnemySkill18.json","appointFaceBookFriendOnlyUpdateAsync","battle/skillsk/3001/shotwingman.sk","tdata","Shield","prefab/battle/effect/PlayerPoisonBuff.json","AdventureData","entryPointData","MgAtt","material","BulSkill7","otherNode","laya.effect.GlowFilterSetter","DailyTask","fillText","width2","selNode","AutoWing","itemLvLab","userAgent","New Chapter","getEntryPointData","checkPaymentStatus","GamePauseDialog","renderQueue","currOtherEnemys","battle/skillsk/1009/attackspeed.sk","bulletPre3","AllSkillVideoID","owner","callfun","Fearless","goldLab","ins","skill16Pre","upEquGold","albedoTexture","Laya3D","skill2002Pre","调用FBInstant.context.chooseAsync方法回调","player.upHangarLevel","frameLoop","titIma","boom","getRankData","player_2010_bulskill","RENDER_STATE_BLEND_DST","basChapter","ACHIEVEMENT","Yvonne Wallis","PERIOD_CUSTOM","player4Bullet","Exp","loadInterstitialADOne","Newman Bess","prefab/battle/effect/HpBarLight.json","clientHeight","setGolds","showAsync","_collisions","进入游戏","Wingman and 2nd gun fire rate + 10%","taskBtn","PlayerReward","plaRob3Pre","battle/skillicon/3001.png","cantHandle","LobbyScene.HangarPage","RateSupply","prefab/lobby/RankDialog.json","player.reborn","player","lobby/adventure/Gold_Trial.png","battle/skillsk/3002/missilewingman.sk","getPlayInfo","initLockNode","depthWrite","rateLab","sound/bgbattle.mp3","app/battle/enemySkill/EnemySkill1.ts","DEPTHTEST_LESS","textAnim","prefab/lobby/equipment/EquNewAttDialog.json","_checkStartGameEnd","battle/skillsk/1016/critical.sk","Att","Chapter ","skill3Icon","battle/skillicon/3002.png","equNode","EnemySkill10","value","parseComplete","prefab/battle/skill/PlayerSkill7.json","onHideBanner","AddPlayer","showRewardVideoAd","setJSON","HitArea","screenMode","Alexia Ted","SURE","__sign__","Mgun","robot1","onDestroy","plaBul6Pre","stopMusic","BattleBoom1Sou","setShopLimsGood","initDailys","prefab/battle/skill/PlayerDieShot.json","startGame","getSkill2","NORMALMAP","battle/skillsk/2005/shockwave.sk","plaBul1Pre","AtlasInfoManager","plaBul4Pre","skin","souCloBtn","Thunder suit","enemy_dead","player_1012_supply","EquSymDialog","step","playerName","specularColorR","player3Bullet","apply","robot1BPre","equs","RotateIce","onOpen","nsub","MainCross","s_DepthTest","prefab/battle/effect/EnemyBoom.json","Loading","loadPlayerPre","Irene Fast","adnum","/1.png","prefab/battle/bg/GamePauseDialog.json","WsFgSpe","nor","renderTarget","player_2012_bulskill","%s Upgrade successful","norV3","num","currBossEnemys","app/lobby/common/NodeRotation.ts","battle/skillicon/1025.png","BulSkill3","playImage","__bulType__","PlayerCoin","Ivan Bulwer","BattleSceneMidNode","weight","R16G16B16A16","dialogNode","battle/skillsk/1034/deathexplosion.sk","batTog","touchY","Missile","picon2","prefab/battle/enemy/Enemy1017.json","Teresa Maria","DaoDan","lasers","target","Ralap Milton","randed","sure","rewardedVideoID","u_MaterialSpecular","self","wing6BPre","_buildUnrealRank","Evange Lucius","staBY","position","rateTipLab","hitNode","RenderTextureDepthFormat","setPlane","app/battle/wing/PlayerWingLaser.ts","han2","friendsList","Hell","RainbowMissile","prefab/lobby/task/TaskItem.json","Victor Wilhel","Clear\nChapter 5","Learning success","toDataURL","Short of Armament","Morgan Chris","player_1021_baseskill","lastData","playerV2","addRadius","prefab/battle/effect/PlayerLaserHit.json","__global.data__","bskills","Anna Aldridge","PAUSE","UnlockPlaneDialog.close","MouseManager","setSkill22","PlayerLaserHit2","hideLoad","skill3Pre","sind","prefab/battle/bg/BattleCompareSmallNode.json","dieBoom","Nelly James","普通模式章节失败","drawRect","app/lobby/AdventurePage.ts","loadAni","isRotSelf2","xsi","app/battle/player/Player1.ts","gameSDK","PlayerSkill2012","unity/plane3/plane.lh"];(function(e,t){const a=function(t){while(--t){e["push"](e["shift"]())}};a(++t)})(a0_0x2468,467);const a0_0x5592=function(t,e){t=t-0;let a=a0_0x2468[t];return a};console[a0_0x5592("0xad6")]=console[a0_0x5592("0x2bc")]=console[a0_0x5592("0x5df")]=console[a0_0x5592("0x752")]=function(){};window[a0_0x5592("0x6a3")]=Laya[a0_0x5592("0x87f")];window["utilsE"]=Laya[a0_0x5592("0x54")];window["Laya2"]=Laya[a0_0x5592("0x353")];!function(){"use strict";var e,a;!function(t){t[t[a0_0x5592("0x238")]=1]=a0_0x5592("0x238"),t[t[a0_0x5592("0x299")]=2]=a0_0x5592("0x299"),t[t[a0_0x5592("0x942")]=3]=a0_0x5592("0x942")}(e||(e={}));class U{static[a0_0x5592("0x387")](e){const t=e[1];this[a0_0x5592("0x8b2")]={id:t[0],nameCN:t[1],name:t[2],chapter:t[3],level:t[4],maxair:t[5],fight:t[6],fightatt:t[7],fighthp:t[8],difficulty:t[9],drop:t[10],addgold:t[11],extragold:t[12],maxbox:t[13],bossbox:t[14],levelbox:t[15],map:t[16],unlockskill:[]};for(let t=2;t<e["length"];t+=2){const a=e[t];this[a0_0x5592("0x791")][a0_0x5592("0x626")]({id:a[0],nameCN:a[1],name:a[2],chapter:a[3],level:a[4],maxair:a[5],fight:a[6],fightatt:a[7],fighthp:a[8],difficulty:a[9],drop:a[10],addgold:a[11],extragold:a[12],maxbox:a[13],bossbox:a[14],levelbox:a[15],map:a[16],unlockskill:[]})}for(let t=3;t<e[a0_0x5592("0xb0e")];t+=2){const i=e[t];this[a0_0x5592("0x52a")][a0_0x5592("0x626")]({id:i[0],nameCN:i[1],name:i[2],chapter:i[3],level:i[4],maxair:i[5],fight:i[6],fightatt:i[7],fighthp:i[8],difficulty:i[9],drop:i[10],addgold:i[11],extragold:i[12],maxbox:i[13],bossbox:i[14],levelbox:i[15],map:i[16],unlockskill:[]})}}}U[a0_0x5592("0x8b2")]=null,U[a0_0x5592("0x791")]=[],U["difChapters"]=[];class k{static[a0_0x5592("0x315")](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];this[a0_0x5592("0x906")][a[0]]={id:a[0],nameCN:a[1],name:a[2],type:a[3],suit:a[4],quality:a[5],addnum:a[6],maxlv:a[7],materials:a[8],att:a[9]}}}static[a0_0x5592("0x4cc")](e){for(let t=1;t<e["length"];t++){const a=e[t];this[a0_0x5592("0xa89")][a[0]]={id:a[0],nameCN:a[1],name:a[2],type:a[3],quality:a[4],minv:a[5],maxv:a[6]}}}}k["equs"]={},k[a0_0x5592("0xa89")]={},function(t){t[t["WsFgAtt"]=1]=a0_0x5592("0xb07"),t[t[a0_0x5592("0x913")]=2]=a0_0x5592("0x913"),t[t["MgAtt"]=3]=a0_0x5592("0x88b"),t[t["Coin"]=4]=a0_0x5592("0x4e9"),t[t["Hp"]=5]="Hp",t[t["SubHurt"]=6]=a0_0x5592("0x5f2"),t[t["Back"]=7]=a0_0x5592("0xb1a"),t[t[a0_0x5592("0x113")]=8]=a0_0x5592("0x113"),t[t["Up"]=9]="Up",t[t[a0_0x5592("0xb19")]=10]=a0_0x5592("0xb19"),t[t["BossHurt"]=11]=a0_0x5592("0x7e1"),t[t[a0_0x5592("0xa74")]=12]=a0_0x5592("0xa74"),t[t[a0_0x5592("0x40c")]=13]="Skill"}(a||(a={}));class q{static[a0_0x5592("0xadd")](e){const a=this[a0_0x5592("0x599")];for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const i=e[t],r=i[1];a[r-1]||(a[r-1]=[]);const s=a[r-1];s[0]||(s[0]={}),s[0][i[2]]={qua:0,att1:i[5],att2:0,addAtt1:i[4],addAtt2:0};for(let t=1;t<8;t++){s[t]||(s[t]={});const n=5+4*(t-1);s[t][i[2]]={qua:t,att1:i[n+2],att2:i[n+4],addAtt1:i[n+1],addAtt2:i[n+3]}}}}static[a0_0x5592("0x9d2")](t,e,i){const r=[],a=k[a0_0x5592("0x906")][t],s=a[a0_0x5592("0xb2e")],n=a[a0_0x5592("0x644")],o=this[a0_0x5592("0x599")][s-1][e];let l=null;if(l=a0_0x5592("0x35a")==typeof n?n[a0_0x5592("0xae0")]("|"):n,o){const _=o[i];if(_)a0_0x5592("0x993")==typeof n?r["push"]([l,_[a0_0x5592("0x41c")]]):(r[a0_0x5592("0x626")]([parseInt(l[0]),_[a0_0x5592("0x41c")]]),r[a0_0x5592("0x626")]([parseInt(l[1]),_[a0_0x5592("0x462")]]));else{const h=Object[a0_0x5592("0x36c")](o)[a0_0x5592("0x26f")]((t,e)=>{return parseInt(t)-parseInt(e)});for(let t=0;t<h[a0_0x5592("0xb0e")];t++){const x=parseInt(h[t]),c=t+1>=h[a0_0x5592("0xb0e")]?9999:parseInt(h[t+1]);if(i>x&&i<c){let t=o[x],e=t[a0_0x5592("0x41c")]+(i-x)*t[a0_0x5592("0x715")],a=t[a0_0x5592("0x462")]+(i-x)*t[a0_0x5592("0x490")];"number"==typeof n?r[a0_0x5592("0x626")]([l,e]):(r[a0_0x5592("0x626")]([parseInt(l[0]),e]),r[a0_0x5592("0x626")]([parseInt(l[1]),a]));break}}}}return r}}q[a0_0x5592("0x599")]=[],q["thunders"]={1:{2:[1,.1],4:[2,.1]},2:{2:[3,.2],4:[4,.5]},3:{2:[5,.2],4:[6,.2]},4:{2:[5,.2],4:[6,.2],6:[7,.5]},5:{2:[8,.2],4:[9,.35],6:[10,.5]},6:{2:[11,.15],4:[12,.2],6:[13,1]}};class G{static[a0_0x5592("0x3c9")](e){for(let t=1;t<e["length"];t++){const a=e[t];for(let t=1;t<7;t++){const i=this[a0_0x5592("0x42a")+t];i&&(i[a[1]]={id:t,att:a[3+2*t],hp:a[4+2*t],addAtt:a[3],addHp:a[4]})}}}static[a0_0x5592("0x8bc")](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t],i=a[1];1==i?this["upPlaGold"][a[2]]={gold:a[6],adgo:a[5]}:2==i?this[a0_0x5592("0x8a6")][a[2]]={gold:a[6],adgo:a[5]}:3==i&&(this[a0_0x5592("0x837")][a[2]]={gold:a[7],adgo:a[5]})}}static["getAttHp"](e,t){const a={att:0,hp:0},i=this["plane"+t];if(i){const r=i[e];if(r)a[a0_0x5592("0x644")]=r["att"],a["hp"]=r["hp"];else{const s=Object[a0_0x5592("0x36c")](i)[a0_0x5592("0x26f")]((t,e)=>{return parseInt(t)-parseInt(e)});for(let t=0;t<s["length"];t++){const n=parseInt(s[t]),o=t+1>=s[a0_0x5592("0xb0e")]?9999:parseInt(s[t+1]);if(e>n&&e<o){let t=i[n];a[a0_0x5592("0x644")]=t["att"]+(e-n)*t[a0_0x5592("0x42d")],a["hp"]=t["hp"]+(e-n)*t[a0_0x5592("0x67e")];break}}}}return a}static[a0_0x5592("0x77d")](e,t){let a=0,i=this[a0_0x5592("0x356")];2==t&&(i=this[a0_0x5592("0x8a6")]),3==t&&(i=this[a0_0x5592("0x837")]);const r=i[e];if(r)a=r[a0_0x5592("0x86")];else{const s=Object["keys"](i)[a0_0x5592("0x26f")]((t,e)=>{return parseInt(t)-parseInt(e)});for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const n=parseInt(s[t]),o=t+1>=s[a0_0x5592("0xb0e")]?9999:parseInt(s[t+1]);if(e>n&&e<o){let t=i[n];a=t["gold"]+(e-n)*t[a0_0x5592("0x9ea")];break}}}return a}}G[a0_0x5592("0xda")]={},G["plane2"]={},G[a0_0x5592("0xab")]={},G[a0_0x5592("0xac")]={},G[a0_0x5592("0x451")]={},G[a0_0x5592("0x757")]={},G["upPlaGold"]={},G[a0_0x5592("0x8a6")]={},G[a0_0x5592("0x837")]={};class Z{static[a0_0x5592("0x3c9")](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];this[a0_0x5592("0x555")][a[0]]={id:a[0],nameCN:a[1],name:a[2],att:a[3],hp:a[4],shooting:a[5],crit:a[6],range:a[7],unlocking:a[8],bullettype:a[9],weapon:a[10],sustain:a[11],bulletsp:a[12]}}}}var n;Z[a0_0x5592("0x555")]={},Z[a0_0x5592("0x204")]={1:[2,2,8,1,3],2:[3,4,9,3,4],3:[6,6,4,5,7],4:[10,8,5,5,2],5:[6,6,4,5,5],6:[10,9,8,7,6]},function(t){t[t[a0_0x5592("0x848")]=!![]]=a0_0x5592("0x848"),t[t[a0_0x5592("0x33e")]=0]="faceBookSDK"}(n||(n={}));class C{}C[a0_0x5592("0x10")]=n["faceBookSDKTest"],C[a0_0x5592("0xb2d")]=[a0_0x5592("0x466")],C[a0_0x5592("0x69b")]=a0_0x5592("0xaeb"),C["isNewPlayer"]=!1,C[a0_0x5592("0x933")]=a0_0x5592("0x45a"),C["SigninVideoID"]=a0_0x5592("0x45a"),C[a0_0x5592("0x89f")]="1154365871695610_1164936070638590",C[a0_0x5592("0xa9f")]="1154365871695610_1164935663971964",C["DiamondVideoID"]=a0_0x5592("0x6cc"),C[a0_0x5592("0x1c6")]="1154365871695610_1164935923971938",C["isIOS"]=!1;const R=new Laya[a0_0x5592("0x461")],T=(t,e)=>{C[a0_0x5592("0x10")]!=n[a0_0x5592("0x848")]&&window[a0_0x5592("0x36b")]&&window[a0_0x5592("0x36b")][a0_0x5592("0xad6")]&&window["gaLogEvent"][a0_0x5592("0xad6")](t,e)};class O{static["getRandom"](t,e){return Math[a0_0x5592("0x6fc")](Math[a0_0x5592("0x2ee")]()*(t-e+1)+e)}static[a0_0x5592("0x77")](a){const i=["K","M","B","T"];let r="";if(a<1e3)r=Math[a0_0x5592("0x6fc")](a)+"";else{let t=a,e=0;for(;t/1e3/1e3>=1;){if(++e>=i[a0_0x5592("0xb0e")]){e=i[a0_0x5592("0xb0e")]-1;break}t/=1e3}r=(t/1e3)[a0_0x5592("0xf2")](2)+i[e]}return r}static[a0_0x5592("0x814")](t){const e=Math[a0_0x5592("0x6fc")](t/3600);t-=60*e*60;const a=Math["floor"](t/60);return t-=60*a,[e,a,Math["floor"](t)]}static[a0_0x5592("0x98b")](t,e){return new Date(t)[a0_0x5592("0x702")](0,0,0,0)===new Date(e)[a0_0x5592("0x702")](0,0,0,0)}static[a0_0x5592("0x383")](e,a,i=(t,e)=>t===e){return Object[a0_0x5592("0x36c")](e)[a0_0x5592("0x3b8")](t=>i(e[t],a))}}var A;!function(t){t[t[a0_0x5592("0x5e2")]=101]=a0_0x5592("0x5e2"),t[t[a0_0x5592("0x591")]=201]=a0_0x5592("0x591")}(A||(A={}));class L{static[a0_0x5592("0x315")](e){for(let t=1;t<e["length"];t++){const a=e[t];this[a0_0x5592("0x65a")][a[0]]={id:a[0],nameCN:a[1],name:a[2],type:a[3],desCN:a[4],des:a[5],quality:a[6],equip:a[7]}}}static[a0_0x5592("0x3ad")](e){for(let t=1;t<e["length"];t++){const a=e[t];this[a0_0x5592("0x9")][a0_0x5592("0x626")]({id:a[0],item:a[1],box1:a[2],box2:a[3],lim2:a[4],min:a[5],max:a[6],price:a[7]})}}}L[a0_0x5592("0x65a")]={},L["shopitems"]=[],L[a0_0x5592("0x713")]=null,L[a0_0x5592("0xa1a")]=1;const N={TaskDialog:{1:a0_0x5592("0x49e")},Common:{1:a0_0x5592("0x28f"),2:a0_0x5592("0x1f6"),3:a0_0x5592("0x4c6"),4:a0_0x5592("0x350"),5:a0_0x5592("0x785"),6:a0_0x5592("0x16d"),10:a0_0x5592("0x897"),11:a0_0x5592("0x580"),12:a0_0x5592("0x4de"),13:a0_0x5592("0x8e8"),14:"CANCEL",15:a0_0x5592("0x9d7"),16:a0_0x5592("0xacf"),17:a0_0x5592("0x336"),18:"Congratulations on your clearance！",19:"We're sorry, but there are no available videos to show right now. Please try again! ",20:a0_0x5592("0x3d9"),21:a0_0x5592("0x345"),22:"You already have a record. Do you want to start a new game?"},Tips:{1:a0_0x5592("0x499"),2:"Successful Decomposition",3:a0_0x5592("0x294"),4:a0_0x5592("0x2da"),5:a0_0x5592("0x917"),6:a0_0x5592("0xa5d"),7:a0_0x5592("0x949"),8:"Synthesis Success",9:"No synthetic Armament",10:a0_0x5592("0x17f"),11:a0_0x5592("0x345"),12:a0_0x5592("0x594"),13:a0_0x5592("0x3d9"),14:a0_0x5592("0x5b2"),15:a0_0x5592("0x808"),16:a0_0x5592("0xa50"),17:a0_0x5592("0x947")},TaskItem:{1:a0_0x5592("0x14b"),2:a0_0x5592("0xb2a"),3:a0_0x5592("0x50a"),4:"START"},RankDialog:{1:"RANK",2:a0_0x5592("0x527"),3:"invite friends"},AchievementDialog:{1:a0_0x5592("0x781"),2:a0_0x5592("0x58e")},HangarPage:{1:a0_0x5592("0x2a2"),2:a0_0x5592("0x2ef"),3:a0_0x5592("0x6af"),4:"HP",5:"RATE",6:a0_0x5592("0x36d"),7:a0_0x5592("0x203"),8:"Hangar growth level is valid for all ships.",9:a0_0x5592("0x3d5"),10:a0_0x5592("0x35f"),11:a0_0x5592("0x117")},HangarItem:{2:"Clear\nChapter 2",3:a0_0x5592("0x946"),4:a0_0x5592("0xa0b"),5:a0_0x5592("0x29e"),6:a0_0x5592("0x53b")},SigninDialog:{1:a0_0x5592("0x50a")},EquipmentPage:{1:a0_0x5592("0x1a1"),2:a0_0x5592("0xa1f"),3:a0_0x5592("0x737"),4:a0_0x5592("0x2e3"),5:"2ND GUN",6:"ENGINE",7:a0_0x5592("0x4ed"),8:a0_0x5592("0x140")},EquDecDialog:{1:a0_0x5592("0x5f9"),2:a0_0x5592("0x1b6"),3:"DECOMPOSE"},EquMatDesDialog:{1:a0_0x5592("0x17a")},EquNewAttDialog:{1:a0_0x5592("0x4e8"),2:"Level limit:",3:"Basic attributes:",5:a0_0x5592("0x7cb")},EquSuitDialog:{1:a0_0x5592("0x2a4"),2:a0_0x5592("0xc3"),3:"HP",4:"Damage on enemy",5:a0_0x5592("0x5af"),6:"2nd gun attack",7:a0_0x5592("0x3bd"),8:a0_0x5592("0x2a4")},EquSymDialog:{1:a0_0x5592("0x140"),2:a0_0x5592("0x501"),3:a0_0x5592("0x140"),4:a0_0x5592("0x2a2"),5:"Composing materials",6:a0_0x5592("0x766"),7:"Damage on boss",8:a0_0x5592("0x2a4")},EquOequDialog:{1:a0_0x5592("0x5f9"),2:a0_0x5592("0x13d"),3:a0_0x5592("0x990"),4:"Upgrade Materials",5:a0_0x5592("0x8fc"),6:a0_0x5592("0xaba"),7:"UPGRADE",8:a0_0x5592("0xb20")},EquMainStr:{1:a0_0x5592("0xa6a"),2:a0_0x5592("0x9e4"),3:a0_0x5592("0x2d0"),4:"Wingman attack +&",5:"2nd gun attack +&",6:a0_0x5592("0x7da")},EquThunder1:{1:a0_0x5592("0xaaf"),2:a0_0x5592("0x8c0"),3:a0_0x5592("0x15a"),4:a0_0x5592("0x9e9"),5:"HP +20%",6:a0_0x5592("0x15a"),7:a0_0x5592("0x302"),8:a0_0x5592("0x40e"),9:a0_0x5592("0x7ae"),10:a0_0x5592("0x7e7"),11:a0_0x5592("0xaf4"),12:"Critical rate +20%",13:"The battle begins with a support skill selection"},EquThunder2:{1:"Thunder set",2:"Storm set",3:a0_0x5592("0x699"),4:"Phoenix set",5:a0_0x5592("0x655"),6:a0_0x5592("0x6a9")},BattlePage:{1:a0_0x5592("0xa5"),2:a0_0x5592("0x18a"),3:a0_0x5592("0x1c5"),4:a0_0x5592("0x74d"),5:"Hard",6:a0_0x5592("0x9d1"),7:a0_0x5592("0x49e"),8:a0_0x5592("0x8b3"),9:a0_0x5592("0x54c"),10:"CONTINUE",11:a0_0x5592("0xa6b")},EndlessDialog:{1:a0_0x5592("0xa6b"),2:a0_0x5592("0x6f9"),3:a0_0x5592("0x215"),4:a0_0x5592("0x7a6"),5:a0_0x5592("0xade"),6:a0_0x5592("0xa5"),7:a0_0x5592("0x135"),8:a0_0x5592("0xa53"),9:a0_0x5592("0x69e"),10:a0_0x5592("0x709")},AdventurePage:{1:"ADVENTURE",2:a0_0x5592("0x4ee"),3:a0_0x5592("0x792"),4:a0_0x5592("0xb2a"),5:a0_0x5592("0x2d3"),6:a0_0x5592("0x18c"),7:"Choose 3 skills",8:a0_0x5592("0xb14"),9:"GO",10:a0_0x5592("0x57"),11:a0_0x5592("0xa5"),12:"watch+1"},AdventureData:{1:{id:1,title:a0_0x5592("0x2d8"),pow:[158600,921e3,43e5],diff:[a0_0x5592("0x74d"),"Hard","Hell"],num:5,reward:[[0,"lobby/adventure/ic_cl_grey.png","Material"],[1,a0_0x5592("0x9c"),a0_0x5592("0xaba")],[2,a0_0x5592("0x9c"),a0_0x5592("0xaba")]]},2:{id:2,title:a0_0x5592("0x8cb"),pow:[158600,921e3,43e5],diff:[a0_0x5592("0x74d"),a0_0x5592("0x299"),"Hell"],num:5,reward:[[0,a0_0x5592("0x71f"),a0_0x5592("0x15d")],[0,"lobby/equicon/101.png","Gold x??"]]}},Shop:{1:"Reset Time: ",2:a0_0x5592("0x9fe"),3:a0_0x5592("0x856"),4:a0_0x5592("0x340"),5:a0_0x5592("0x6d0"),6:a0_0x5592("0x611"),7:a0_0x5592("0x340"),8:a0_0x5592("0x7b6")},ShopData:{Box:{1:{title:a0_0x5592("0x647"),desc:a0_0x5592("0x15c"),reset:10800,adnum:5,price:100,num:1},2:{title:a0_0x5592("0xa19"),desc:a0_0x5592("0x585"),reset:10800,adnum:5,price:100,num:150},3:{title:a0_0x5592("0x7b0"),desc:"Get an excellent, rare or epic item",reset:10800,adnum:5,price:300,num:1}},Lim:{Timer:10800,Skill:{timer:3600,adnum:5,price:100},Good:{adnum:5,price:100}}},Battle:{1:a0_0x5592("0x240"),2:"Get Rewards",3:a0_0x5592("0x1fd"),4:a0_0x5592("0x706"),5:a0_0x5592("0x527"),6:a0_0x5592("0x45e"),7:a0_0x5592("0xed"),8:"CONTINUE",9:a0_0x5592("0x953"),10:a0_0x5592("0xa73"),11:a0_0x5592("0x603"),12:"Medical transport ship",13:"Choose a reward!",14:"Resurrection or not",15:"watch",16:"ALL",17:"SHARE",18:"Shock",19:a0_0x5592("0x2a1"),20:a0_0x5592("0x217"),21:a0_0x5592("0x1db")}};const H=new class{constructor(){this[a0_0x5592("0x188")]=1,this[a0_0x5592("0x555")]=[1],this[a0_0x5592("0x57f")]={1:1,2:1},this[a0_0x5592("0x97f")]={},this[a0_0x5592("0xb2c")]=0,this[a0_0x5592("0x96c")]=0,this[a0_0x5592("0xe")]=0,this[a0_0x5592("0x34")]=[],this[a0_0x5592("0x137")]={lastData:null,lastEnemy:null,bestLevel:1,bestScore:0,startLevel:1},this[a0_0x5592("0x975")]={num:0,last:0}}[a0_0x5592("0x337")](){this[a0_0x5592("0x975")][a0_0x5592("0x919")]++,this["signinData"]["last"]=Date[a0_0x5592("0x24")]()}[a0_0x5592("0x56")](t,e){const a=this[a0_0x5592("0x97f")];a[t]||(a[t]=N[a0_0x5592("0x889")][t]["num"]),a[t]+=e}};var r,s,l;!function(t){t[t[a0_0x5592("0x8ea")]=1]="Mgun",t[t[a0_0x5592("0x28a")]=2]=a0_0x5592("0x28a"),t[t[a0_0x5592("0x1d1")]=3]="Armor",t[t[a0_0x5592("0x533")]=4]="Wings",t[t[a0_0x5592("0x441")]=5]=a0_0x5592("0x441"),t[t[a0_0x5592("0x7c7")]=6]=a0_0x5592("0x7c7")}(r||(r={})),function(t){t[t[a0_0x5592("0xab6")]=0]="White",t[t[a0_0x5592("0xd3")]=1]=a0_0x5592("0xd3"),t[t[a0_0x5592("0x187")]=2]="Blue",t[t["Purple"]=3]=a0_0x5592("0xa2c")}(s||(s={})),function(t){t[t[a0_0x5592("0x8d8")]=1]=a0_0x5592("0x8d8"),t[t["Hp"]=2]="Hp",t[t[a0_0x5592("0xb2b")]=3]="EneHurt",t[t["Wings"]=4]=a0_0x5592("0x533"),t[t[a0_0x5592("0x39f")]=5]=a0_0x5592("0x39f"),t[t[a0_0x5592("0x7e1")]=6]=a0_0x5592("0x7e1")}(l||(l={}));const z=new class{constructor(){this[a0_0x5592("0x7e0")]=0,this[a0_0x5592("0x6e3")]=0,this[a0_0x5592("0x65a")]={},this[a0_0x5592("0x9d5")]={},this[a0_0x5592("0x3bb")]={},this["uchapter"]={1:1},this[a0_0x5592("0xb00")]={},this[a0_0x5592("0x667")]={},this[a0_0x5592("0x333")]={}}[a0_0x5592("0xa8a")](t){let i=0;for(const e in t){const r=t[e];if(r[0]==A[a0_0x5592("0x5e2")])this[a0_0x5592("0x7e0")]+=r[1],R[a0_0x5592("0xcf")](a0_0x5592("0x5ca"));else if(r[0]==A["Diamond"])this[a0_0x5592("0x6e3")]+=r[1],R[a0_0x5592("0xcf")]("PlayerItemConfig.diamond");else if(r[0]>=1011&&r[0]<=1016)this["items"][r[0]]?this["items"][r[0]]+=r[1]:this[a0_0x5592("0x65a")][r[0]]=r[1];else{let t=r[0],e=r[1];const s=L[a0_0x5592("0x65a")][t],n=s[a0_0x5592("0x621")],o=s[a0_0x5592("0x4b")];let a=k["equs"][o][a0_0x5592("0x875")];a=a[a0_0x5592("0xae0")]?a["split"]("|")[n-1]:a;for(let t=0;t<e;t++){let e=[];for(let t=0;t<a;t++){const l=O[a0_0x5592("0x7de")](1007,1001),_=k[a0_0x5592("0xa89")][l],h=parseFloat(_["maxv"][a0_0x5592("0xae0")]("|")[n]),x=parseFloat(_["minv"][a0_0x5592("0xae0")]("|")[n]);e[a0_0x5592("0x626")]([l,this[a0_0x5592("0xa05")](h,x)])}this["hequips"][Date[a0_0x5592("0x24")]()+i]=[o,n,1,e],i++}n>=3&&R[a0_0x5592("0xcf")](a0_0x5592("0x12d"))}}}[a0_0x5592("0xa05")](t,e){const a=[];let i=e;for(;i<=t;)a["push"](i),i+=.5;return a[O[a0_0x5592("0x7de")](a["length"]-1,0)]}[a0_0x5592("0x2c4")](t){this[a0_0x5592("0x7e0")]+=t,R[a0_0x5592("0xcf")](a0_0x5592("0x5ca")),t<0&&R["event"]("player.expendCoin",-t)}[a0_0x5592("0xf")](t,e){1==I["diff"]?(this["chapter"][t]?this[a0_0x5592("0x9d5")][t]++:(this[a0_0x5592("0x9d5")][t]=1,3==t?H["unlockPage"]["indexOf"](a0_0x5592("0x7ec"))<0&&H[a0_0x5592("0x34")][a0_0x5592("0x626")](a0_0x5592("0x7ec")):6==t&&H[a0_0x5592("0x34")][a0_0x5592("0x779")]("AdventurePage")<0&&H[a0_0x5592("0x34")]["push"](a0_0x5592("0x44c"))),t<15?this[a0_0x5592("0x558")][t+1]||(window[a0_0x5592("0x950")]=[a0_0x5592("0xa16")],this[a0_0x5592("0x558")][t+1]=1):15==t&&(this[a0_0x5592("0xb00")][1]||(window["__global.data__"]=["unlock"],this[a0_0x5592("0xb00")][1]=1))):(this[a0_0x5592("0x3bb")][t]?this[a0_0x5592("0x3bb")][t]++:this[a0_0x5592("0x3bb")][t]=1,t<15?this[a0_0x5592("0xb00")][t+1]||(window[a0_0x5592("0x950")]=[a0_0x5592("0xa16")],this[a0_0x5592("0xb00")][t+1]=1):15==t&&(this[a0_0x5592("0xb00")][16]||(window[a0_0x5592("0x950")]=a0_0x5592("0x701"),this[a0_0x5592("0xb00")][16]=1))),t>=2&&H[a0_0x5592("0x555")]["indexOf"](2)<0&&(H["planes"][a0_0x5592("0x626")](2),R[a0_0x5592("0xcf")]("player.unlockplane"),H[a0_0x5592("0x34")][a0_0x5592("0x779")]("HangarPage")<0&&H[a0_0x5592("0x34")]["push"](a0_0x5592("0x793")),H[a0_0x5592("0x34")]["indexOf"](a0_0x5592("0x682"))<0&&H["unlockPage"][a0_0x5592("0x626")](a0_0x5592("0x682")),window[a0_0x5592("0x950")]&&window[a0_0x5592("0x950")][a0_0x5592("0x626")]&&window["__global.data__"][a0_0x5592("0x626")](2)),t>=5&&H[a0_0x5592("0x555")][a0_0x5592("0x779")](3)<0&&(H[a0_0x5592("0x555")][a0_0x5592("0x626")](3),R[a0_0x5592("0xcf")](a0_0x5592("0x43b")),H["unlockPage"][a0_0x5592("0x779")](a0_0x5592("0x793"))<0&&H[a0_0x5592("0x34")]["push"](a0_0x5592("0x793")),H["unlockPage"]["indexOf"]("plane3")<0&&H[a0_0x5592("0x34")][a0_0x5592("0x626")](a0_0x5592("0xab")),window[a0_0x5592("0x950")]&&window["__global.data__"][a0_0x5592("0x626")]&&window[a0_0x5592("0x950")]["push"](3)),t>=7&&H[a0_0x5592("0x555")][a0_0x5592("0x779")](4)<0&&(H[a0_0x5592("0x555")][a0_0x5592("0x626")](4),R[a0_0x5592("0xcf")](a0_0x5592("0x43b")),H[a0_0x5592("0x34")]["indexOf"]("HangarPage")<0&&H[a0_0x5592("0x34")][a0_0x5592("0x626")](a0_0x5592("0x793")),H["unlockPage"][a0_0x5592("0x779")]("plane4")<0&&H["unlockPage"][a0_0x5592("0x626")](a0_0x5592("0xac")),window[a0_0x5592("0x950")]&&window[a0_0x5592("0x950")][a0_0x5592("0x626")]&&window[a0_0x5592("0x950")][a0_0x5592("0x626")](4)),t>=13&&H["planes"]["indexOf"](6)<0&&(H[a0_0x5592("0x555")][a0_0x5592("0x626")](6),R["event"](a0_0x5592("0x43b")),H["unlockPage"][a0_0x5592("0x779")](a0_0x5592("0x793"))<0&&H["unlockPage"][a0_0x5592("0x626")](a0_0x5592("0x793")),H[a0_0x5592("0x34")][a0_0x5592("0x779")](a0_0x5592("0x757"))<0&&H[a0_0x5592("0x34")][a0_0x5592("0x626")](a0_0x5592("0x757")),window[a0_0x5592("0x950")]&&window["__global.data__"][a0_0x5592("0x626")]&&window[a0_0x5592("0x950")][a0_0x5592("0x626")](6))}[a0_0x5592("0x69c")](t,e){1==I[a0_0x5592("0x5d4")]?this[a0_0x5592("0x558")][t]&&this[a0_0x5592("0x558")][t]<e&&(this[a0_0x5592("0x558")][t]=e):this[a0_0x5592("0xb00")][t]&&this[a0_0x5592("0xb00")][t]<e&&(this[a0_0x5592("0xb00")][t]=e)}};const I=new class{constructor(){this[a0_0x5592("0x94c")]=null,this[a0_0x5592("0x1fa")]=0,this[a0_0x5592("0xae1")]=0,this["critHurt"]=0,this["speed"]=0,this[a0_0x5592("0x214")]=0,this["eneHurtStr"]=0,this[a0_0x5592("0xa49")]=0,this[a0_0x5592("0x5fd")]=0,this[a0_0x5592("0x5cb")]=0,this["hp"]=0,this["currHP"]=0,this["defense"]=0,this[a0_0x5592("0xdc")]=0,this["id"]=1,this[a0_0x5592("0x9d5")]=1,this[a0_0x5592("0x5d4")]=1,this[a0_0x5592("0x2d6")]=1,this[a0_0x5592("0x19")]=0,this[a0_0x5592("0x188")]=1,this[a0_0x5592("0x53d")]={},this[a0_0x5592("0x59d")]={},this[a0_0x5592("0x56b")]=[],this["unlock"]=[],this[a0_0x5592("0x9d6")]=[],this[a0_0x5592("0x7e0")]=0,this[a0_0x5592("0xb05")]=0}[a0_0x5592("0x9b6")](){let t=this[a0_0x5592("0x9d5")];const e=this[a0_0x5592("0x5d4")];let a;z[a0_0x5592("0xf")](t),t<15?this["chapter"]++:15==t&&1==e&&(this["chapter"]=1,this[a0_0x5592("0x5d4")]=2),this[a0_0x5592("0x2d6")]=1;const i=(a=t<1?U["basChapter"]:1==e?U["comChapters"][t-1]:U[a0_0x5592("0x52a")][t-1])[a0_0x5592("0x80a")];for(let t=0;t<i["length"];t++){const r=i[t];this[a0_0x5592("0xa16")][a0_0x5592("0x779")](r)<0&&this[a0_0x5592("0xa16")]["push"](r),this["nunlock"]["indexOf"](r)<0&&this["nunlock"][a0_0x5592("0x626")](r)}}[a0_0x5592("0x7b3")](t){let e=this["id"],B=H[a0_0x5592("0x188")];const a=G[a0_0x5592("0xa77")](B,e);!t&&this["chapter"]<1&&(this["chapter"]=1),this[a0_0x5592("0x2d6")]=1,this["specialSuit"]=[];const i=z["equips"],F=k["equs"],r={};let s=0,n=0,o=0,l=0,_=0,h=0;for(const g in i){const v=i[g];if(v){const y=q[a0_0x5592("0x9d2")](v[0],v[1],v[2]);for(let t=0;t<y["length"];t++){const E=y[t],b=E[0],S=E[1];1==b?s+=S:2==b?n+=S:3==b?o+=S:4==b?l+=S:5==b?_+=S:6==b&&(h+=S)}const T=F[v[0]];r[T[a0_0x5592("0x6c0")]]?r[T[a0_0x5592("0x6c0")]]++:r[T[a0_0x5592("0x6c0")]]=1}}const x=Z[a0_0x5592("0x555")][e];let c=a[a0_0x5592("0x644")]+s,d=a["hp"]+n,u=100*x[a0_0x5592("0xae1")],f=1.5,p=.001,V=o,m=h;for(const C in i){const R=i[C];if(R){const A=R[3];for(let t=0;t<A[a0_0x5592("0xb0e")];t++){const L=A[t],I=L[0],M=L[1];1001==I?c*=1+M/100:1004==I?d*=1+M/100:1002==I?u*=1+M/100:1003==I?f*=1+M/100:1005==I?p*=1+M/100:1006==I?_*=1+M/100:1007==I&&(l*=1+M/100)}}}for(const D in r){const w=q[a0_0x5592("0x47c")][D];if(w){const P=r[D];for(let e=0;e<Math[a0_0x5592("0x6fc")](P/2);e++){let t=2*e+2;if(w[t]){const O=w[t][0],N=w[t][1];1==O?(_*=1+N,l*=1+N):2==O||(3==O?c*=1+N:4==O?this[a0_0x5592("0x56b")][a0_0x5592("0x779")](4)<0&&this["specialSuit"][a0_0x5592("0x626")](4):5==O?d*=1+N:6==O?p*=1+N:7==O?this[a0_0x5592("0x56b")]["indexOf"](7)<0&&this[a0_0x5592("0x56b")][a0_0x5592("0x626")](7):8==O?this[a0_0x5592("0x56b")][a0_0x5592("0x779")](8)<0&&this[a0_0x5592("0x56b")][a0_0x5592("0x626")](8):9==O?(c*=1+N,d*=1+N):10==O||(11==O?m*=1+N:12==O||13==O&&this[a0_0x5592("0x56b")][a0_0x5592("0x779")](13)<0&&this["specialSuit"][a0_0x5592("0x626")](13)))}}}}this["hp"]=d,this[a0_0x5592("0x1fa")]=c,this[a0_0x5592("0xae1")]=u,this["critHurt"]=f,this[a0_0x5592("0x33f")]=V,this[a0_0x5592("0xa49")]=m,this[a0_0x5592("0xdc")]=p,this["speed"]=x[a0_0x5592("0x58")],this[a0_0x5592("0x214")]=x[a0_0x5592("0x277")],this[a0_0x5592("0x5fd")]=_,this[a0_0x5592("0x5cb")]=l,this[a0_0x5592("0xa16")][a0_0x5592("0xb0e")]||(this[a0_0x5592("0xa16")]=U[a0_0x5592("0x8b2")][a0_0x5592("0x80a")])}[a0_0x5592("0x7d")](t){let e=t,a=H[a0_0x5592("0x188")];const i=G[a0_0x5592("0xa77")](a,e),r=z[a0_0x5592("0x667")],s=k[a0_0x5592("0x906")],n={};let o=0,l=0,_=0,h=0,x=0,c=0;for(const g in r){const v=r[g];if(v){const y=q[a0_0x5592("0x9d2")](v[0],v[1],v[2]);for(let t=0;t<y[a0_0x5592("0xb0e")];t++){const E=y[t],b=E[0],S=E[1];1==b?o+=S:2==b?l+=S:3==b?_+=S:4==b?h+=S:5==b?x+=S:6==b&&(c+=S)}const T=s[v[0]];n[T[a0_0x5592("0x6c0")]]?n[T[a0_0x5592("0x6c0")]]++:n[T[a0_0x5592("0x6c0")]]=1}}const d=Z["planes"][e];let u=i["att"]+o,f=i["hp"]+l,p=100*d[a0_0x5592("0xae1")],B=1.5,m=.001,F=c;for(const C in r){const R=r[C];if(R){const A=R[3];for(let t=0;t<A[a0_0x5592("0xb0e")];t++){const L=A[t],I=L[0],M=L[1];1001==I?u*=1+M/100:1004==I?f*=1+M/100:1002==I?p*=1+M/100:1003==I?B*=1+M/100:1005==I?m*=1+M/100:1006==I?x*=1+M/100:1007==I&&(h*=1+M/100)}}}for(const D in n){const w=q[a0_0x5592("0x47c")][D];if(w){const P=n[D];for(let e=0;e<Math[a0_0x5592("0x6fc")](P/2);e++){let t=2*e+2;if(w[t]){const O=w[t][0],N=w[t][1];1==O?(x*=1+N,h*=1+N):2==O||(3==O?u*=1+N:4==O||(5==O?f*=1+N:6==O?m*=1+N:7==O||8==O||(9==O?(u*=1+N,f*=1+N):10==O||11==O&&(F*=1+N))))}}}}return{hp:f,attack:u}}["getCombatValue"](){let t=8*this[a0_0x5592("0x1fa")]+1*this["hp"]+2*this[a0_0x5592("0x5fd")]+2*this[a0_0x5592("0x5cb")]+500*this[a0_0x5592("0x33f")]+500*this["bosHurtStr"];return t=Math[a0_0x5592("0x239")](t)}[a0_0x5592("0x2f0")](t,e){let a=8*t+1*e+2*this[a0_0x5592("0x5fd")]+2*this[a0_0x5592("0x5cb")]+500*this[a0_0x5592("0x33f")]+500*this[a0_0x5592("0xa49")];return a=Math[a0_0x5592("0x239")](a)}};class K{static[a0_0x5592("0x6a1")](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];this[a0_0x5592("0x65")][a[0]]={id:a[0],titleCN:a[1],desCN:a[2],title:a[3],des:a[4],rewardtype:a[5],reward:a[6],time:a[7],probability:a[8],drop:a[9]}}}static[a0_0x5592("0x2d5")](e){for(let t=1;t<e["length"];t++){const a=e[t];a[5];this[a0_0x5592("0x401")][a[0]]={id:a[0],desCN:a[1],des:a[2],rewardtype:a[3],reward:a[4],type:a[5],num:a[6]}}M["initDailys"]()}static[a0_0x5592("0x54a")](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];a[6];this["achievements"][a[0]]={id:a[0],desCN:a[1],des:a[2],rewardtype:a[3],reward:a[4],index:a[5],type:a[6],num:a[7]}}}}K[a0_0x5592("0x65")]={},K[a0_0x5592("0x401")]={},K[a0_0x5592("0x47a")]={},K[a0_0x5592("0x197")]=!1;const M=new class{constructor(){this[a0_0x5592("0x65")]={},this[a0_0x5592("0x61")]={},this[a0_0x5592("0x7b9")]={},this[a0_0x5592("0x5c8")]={},this["shopBoxs"]={},this["friendRoboted"]=0,this[a0_0x5592("0x13b")]={},this[a0_0x5592("0x846")]=0,R["on"]("config.setter",this,()=>{const t=Date[a0_0x5592("0x24")]();this[a0_0x5592("0x846")]&&this[a0_0x5592("0x98b")](this[a0_0x5592("0x846")],t)||this[a0_0x5592("0x7c6")](!0),this[a0_0x5592("0x846")]=t}),R["on"](a0_0x5592("0x8ab"),this,()=>{this[a0_0x5592("0x61")][1]&&this["dailys"][1][a0_0x5592("0x919")]++,this[a0_0x5592("0x61")][2]&&this["dailys"][2][a0_0x5592("0x919")]++,this["setAchieve"](1,0,0,H[a0_0x5592("0x188")])}),R["on"](a0_0x5592("0x43b"),this,()=>{this["setAchieve"](2,0,0,H[a0_0x5592("0x555")][a0_0x5592("0xb0e")])}),R["on"](a0_0x5592("0x227"),this,()=>{this["dailys"][19]&&this[a0_0x5592("0x61")][19][a0_0x5592("0x919")]++,this[a0_0x5592("0x306")](3,0,1)}),R["on"](a0_0x5592("0x49a"),this,()=>{this[a0_0x5592("0x61")][7]&&this["dailys"][7][a0_0x5592("0x919")]++,this[a0_0x5592("0x61")][8]&&this[a0_0x5592("0x61")][8][a0_0x5592("0x919")]++,this[a0_0x5592("0x61")][9]&&this[a0_0x5592("0x61")][9][a0_0x5592("0x919")]++,this[a0_0x5592("0x306")](4,0,1)}),R["on"](a0_0x5592("0x397"),this,t=>{this[a0_0x5592("0x306")](5,0,t)}),R["on"](a0_0x5592("0x8c9"),this,()=>{this[a0_0x5592("0x61")][10]&&this[a0_0x5592("0x61")][10][a0_0x5592("0x919")]++,this[a0_0x5592("0x61")][11]&&this[a0_0x5592("0x61")][11][a0_0x5592("0x919")]++,this[a0_0x5592("0x306")](6,0,1)}),R["on"](a0_0x5592("0x12d"),this,()=>{this["setAchieve"](7,0,1)}),R["on"]("player.selSkill",this,()=>{this[a0_0x5592("0x61")][17]&&this[a0_0x5592("0x61")][17][a0_0x5592("0x919")]++,this["dailys"][18]&&this[a0_0x5592("0x61")][18]["num"]++,this[a0_0x5592("0x306")](8,0,1)}),R["on"](a0_0x5592("0x696"),this,()=>{this["setAchieve"](9,0,1)}),R["on"](a0_0x5592("0x3cd"),this,()=>{this[a0_0x5592("0x61")][3]&&this[a0_0x5592("0x61")][3][a0_0x5592("0x919")]++,this["dailys"][4]&&this[a0_0x5592("0x61")][4]["num"]++,this[a0_0x5592("0x306")](10,0,1)}),R["on"](a0_0x5592("0x80f"),this,()=>{this[a0_0x5592("0x61")][20]&&this["dailys"][20][a0_0x5592("0x919")]++,this["setAchieve"](11,0,1)}),R["on"](a0_0x5592("0x562"),this,()=>{this["dailys"][5]&&this[a0_0x5592("0x61")][5]["num"]++,this[a0_0x5592("0x61")][6]&&this[a0_0x5592("0x61")][6]["num"]++}),R["on"](a0_0x5592("0x9e5"),this,()=>{this["dailys"][12]&&this[a0_0x5592("0x61")][12][a0_0x5592("0x919")]++,this[a0_0x5592("0x61")][13]&&this["dailys"][13]["num"]++,this[a0_0x5592("0x61")][14]&&this["dailys"][14]["num"]++}),R["on"](a0_0x5592("0x78"),this,()=>{this[a0_0x5592("0x61")][15]&&this[a0_0x5592("0x61")][15][a0_0x5592("0x919")]++,this[a0_0x5592("0x61")][16]&&this[a0_0x5592("0x61")][16][a0_0x5592("0x919")]++})}["setShopLimsGood"](t){this[a0_0x5592("0x5c8")][a0_0x5592("0x543")]&&(this[a0_0x5592("0x5c8")][a0_0x5592("0x543")][a0_0x5592("0x4b0")]||(this["shopLims"][a0_0x5592("0x543")]["bgoods"]={}),this[a0_0x5592("0x5c8")]["good"][a0_0x5592("0x4b0")][t]||(this[a0_0x5592("0x5c8")]["good"][a0_0x5592("0x4b0")][t]=0),this[a0_0x5592("0x5c8")][a0_0x5592("0x543")][a0_0x5592("0x4b0")][t]++)}[a0_0x5592("0xb0d")](t){this["shopLims"][a0_0x5592("0xa9e")]&&(this["shopLims"][a0_0x5592("0xa9e")][a0_0x5592("0x951")]||(this[a0_0x5592("0x5c8")][a0_0x5592("0xa9e")][a0_0x5592("0x951")]={}),this["shopLims"][a0_0x5592("0xa9e")][a0_0x5592("0x951")][t]||(this[a0_0x5592("0x5c8")][a0_0x5592("0xa9e")][a0_0x5592("0x951")][t]={id:t,reset:Date[a0_0x5592("0x24")]()+1e3*N["ShopData"][a0_0x5592("0x686")][a0_0x5592("0x40c")]["timer"]}))}[a0_0x5592("0xad3")](t){const e=this[a0_0x5592("0x4b3")];e[t]||(e[t]={adnum:N[a0_0x5592("0x824")][a0_0x5592("0x452")][t][a0_0x5592("0x910")],reset:null,danum:0}),e[t][a0_0x5592("0x910")]>0?(e[t]["adnum"]--,e[t]["reset"]||(e[t][a0_0x5592("0x6f4")]=Date[a0_0x5592("0x24")]()+1e3*N[a0_0x5592("0x824")][a0_0x5592("0x452")][t][a0_0x5592("0x6f4")])):e[t][a0_0x5592("0x63f")]++}[a0_0x5592("0x98b")](t,e){return new Date(t)[a0_0x5592("0x702")](0,0,0,0)===new Date(e)[a0_0x5592("0x702")](0,0,0,0)}[a0_0x5592("0x7c6")](t){t&&(this[a0_0x5592("0x773")]=0,this[a0_0x5592("0x13b")]={},this["dailys"]={},this[a0_0x5592("0x8f1")](),H["advData"]={})}[a0_0x5592("0x8f1")](){if(this[a0_0x5592("0x306")](1,0,0,H["level"]),this[a0_0x5592("0x306")](2,0,0,H[a0_0x5592("0x555")]["length"]),Object[a0_0x5592("0x36c")](this[a0_0x5592("0x61")])[a0_0x5592("0xb0e")]>0)return;const e=K[a0_0x5592("0x401")];if(!Object[a0_0x5592("0x36c")](e)[a0_0x5592("0xb0e")])return;const a=[];for(;a["length"]<4;){const t=O["getRandom"](10,1);a[a0_0x5592("0x779")](t)<0&&a[a0_0x5592("0x626")](t)}a[a0_0x5592("0x626")](11);for(let t=0;t<a["length"];t++){const i=a[t],r=[];for(const n in e){const o=e[n];o["type"]==i&&r["push"](o["id"])}const s=r[O["getRandom"](r[a0_0x5592("0xb0e")]-1,0)];this["dailys"][s]={num:0,recd:!1}}}["setTask"](t,e){const a=this[a0_0x5592("0x65")][t];let i=0;a&&(i=a["num"]),e[a0_0x5592("0x919")]=i,this["tasks"][t]=e}[a0_0x5592("0x578")](t){const e=this[a0_0x5592("0x65")][t];e&&(e[a0_0x5592("0x919")]++,e["num"]>=4?(e[a0_0x5592("0x6a8")]=!0,e["reset"]=Date[a0_0x5592("0x24")]()+144e5):e[a0_0x5592("0x99e")]=e["end"]=null)}[a0_0x5592("0x306")](t,e,a,i){this["achieves"][t]||(this[a0_0x5592("0x7b9")][t]={num:0,index:1}),this[a0_0x5592("0x7b9")][t][a0_0x5592("0x58d")]+=e,a&&(this[a0_0x5592("0x7b9")][t]["num"]+=a),i&&(this[a0_0x5592("0x7b9")][t][a0_0x5592("0x919")]=i)}[a0_0x5592("0x783")](t){return this["achieves"][t]||(this[a0_0x5592("0x7b9")][t]={num:0,index:1}),this[a0_0x5592("0x7b9")][t]}};var h,x,c;!function(t){t[t[a0_0x5592("0x384")]=1]="Line",t[t["DownCurve"]=2]="DownCurve",t[t[a0_0x5592("0xf1")]=3]="UpCurve"}(h||(h={})),function(t){t[t[a0_0x5592("0x1dd")]=1]="Return",t[t[a0_0x5592("0x3be")]=2]=a0_0x5592("0x3be"),t[t[a0_0x5592("0x1b9")]=3]=a0_0x5592("0x1b9")}(x||(x={})),function(t){t[t[a0_0x5592("0x6f1")]=1]="Top",t[t[a0_0x5592("0x801")]=2]="Left",t[t["Right"]=3]=a0_0x5592("0x3aa"),t[t["Bottom"]=4]=a0_0x5592("0xa94")}(c||(c={}));class E{static[a0_0x5592("0x382")](a,i){const r=this["enemys"+i],s=this[a0_0x5592("0x1f1")+i],n=this[a0_0x5592("0x199")],o=this[a0_0x5592("0x546")],l=[],_=[];for(let e=1;e<a[a0_0x5592("0xb0e")];e++){const h=a[e],x=h[3];if(a0_0x5592("0x993")!=typeof x)continue;let t=1==x?r[h[2]]:s[h[2]];const c=1==x?l:_;t||(1==x?(r[h[2]]=[],t=r[h[2]]):(s[h[2]]=[],t=s[h[2]])),t[a0_0x5592("0x626")]({id:h[0],chapter:h[1],level:h[2],difficulty:h[3],type:h[4],direntry:h[5],entry:h[6],direxit:h[7],exit:h[8],distance:h[9],time:h[10],return:h[11],route:h[12],speed:h[13],att:h[14],hp:h[15],def:h[16],shooting:h[17],atttime:h[18],bulletsp:h[19],bulletstart:h[20],disx:h[21],inflect:h[22],in:this[a0_0x5592("0xa76")](h[5],h[6]),out:this[a0_0x5592("0xa76")](h[7],h[8])}),n[i+""+x]||(n[i+""+x]={}),n[i+""+x][h[2]]||(n[i+""+x][h[2]]=[]);const d=n[i+""+x][h[2]];c[a0_0x5592("0x779")](h[4])<0&&(c[a0_0x5592("0x626")](h[4]),d[a0_0x5592("0x626")](h[4])),o[i+""+x]||(o[i+""+x]={}),o[i+""+x][h[2]]||(o[i+""+x][h[2]]=[]);const u=o[i+""+x][h[2]];u["indexOf"](h[4])<0&&u[a0_0x5592("0x626")](h[4])}}static[a0_0x5592("0xa76")](t,e){if(a0_0x5592("0x993")!=typeof t||a0_0x5592("0x993")!=typeof e)return null;const a=new Laya[a0_0x5592("0x419")];return t==c[a0_0x5592("0x6f1")]?(a["x"]=e,a["y"]=0):t==c[a0_0x5592("0x801")]?(a["x"]=0,a["y"]=e):t==c[a0_0x5592("0x3aa")]?(a["x"]=720,a["y"]=e):t==c[a0_0x5592("0xa94")]&&(a["x"]=e,a["y"]=1280),a}}E[a0_0x5592("0x5bf")]={},E[a0_0x5592("0x809")]={},E[a0_0x5592("0x60d")]={},E["enemys2"]={},E[a0_0x5592("0x31a")]={},E["enemys3"]={},E[a0_0x5592("0xa98")]={},E[a0_0x5592("0x554")]={},E[a0_0x5592("0x669")]={},E["enemys5"]={},E[a0_0x5592("0x503")]={},E[a0_0x5592("0x6d")]={},E["denemys6"]={},E[a0_0x5592("0x4fe")]={},E["denemys7"]={},E["enemys8"]={},E[a0_0x5592("0x879")]={},E[a0_0x5592("0x68b")]={},E[a0_0x5592("0x768")]={},E[a0_0x5592("0x494")]={},E["denemys10"]={},E[a0_0x5592("0x835")]={},E[a0_0x5592("0x865")]={},E["enemys12"]={},E[a0_0x5592("0x132")]={},E[a0_0x5592("0xae9")]={},E[a0_0x5592("0xff")]={},E["enemys14"]={},E[a0_0x5592("0x443")]={},E[a0_0x5592("0xadf")]={},E[a0_0x5592("0xdf")]={},E["assets"]={},E["assets2"]={};class Q{static[a0_0x5592("0x474")](e){const a=this[a0_0x5592("0x1aa")];for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const i=e[t],r=i[1],s=i[2];a[r]||(a[r]={}),a[r][s]={id:i[0],model:i[1],diff:i[2],drop:i[3],minbox:i[4],maxbox:i[5],mingold:i[6],maxgold:i[7],mindiamond:i[8],maxdiamond:i[9]}}}static["setData"](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t],i=a[1];if(a0_0x5592("0x993")!=typeof i)continue;const r=a[3],s=a[2],n=1==i?this["equAdv"]:this[a0_0x5592("0xbd")];n[r]||(n[r]={}),n[r][s]||(n[r][s]=[]),n[r][s][a0_0x5592("0x626")]({adv:{id:a[0],model:a[1],level:a[2],diff:a[3]},edata:{id:a[0],chapter:0,level:1,difficulty:r,type:a[4],direntry:a[5],entry:a[6],direxit:a[7],exit:a[8],distance:a[9],time:a[10],return:a[11],route:a[12],speed:a[13],att:a[14],hp:a[15],def:a[16],shooting:a[17],atttime:a[18],bulletsp:a[19],bulletstart:a[20],disx:a[21],inflect:a[22],in:this["getPos"](a[5],a[6]),out:this[a0_0x5592("0xa76")](a[7],a[8])}})}}static[a0_0x5592("0xa76")](t,e){if(a0_0x5592("0x993")!=typeof t||a0_0x5592("0x993")!=typeof e)return null;const a=new Laya["Vector2"];return t==c["Top"]?(a["x"]=e,a["y"]=0):t==c["Left"]?(a["x"]=0,a["y"]=e):t==c[a0_0x5592("0x3aa")]?(a["x"]=720,a["y"]=e):t==c[a0_0x5592("0xa94")]&&(a["x"]=e,a["y"]=1280),a}}Q[a0_0x5592("0x6a4")]={},Q[a0_0x5592("0xbd")]={},Q["advDrop"]={};class J{static["setExps"](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];1==a[1]?this["upLevExps"][a[2]]=a[4]:2==a[1]&&(this[a0_0x5592("0x734")][a[3]]=a[4])}}}J[a0_0x5592("0x734")]={},J[a0_0x5592("0x313")]={};class ${static[a0_0x5592("0x106")](e){const a=this["enemys"];for(let t=1;t<e["length"];t++){const i=e[t];a[i[0]]={id:i[0],nameCN:i[1],icon:i[2],shooting:i[3],bullettype:i[4],skill:i[5],dropgold:i[6],shock:i[7]}}}}var m;$["enemys"]={},function(t){t[t[a0_0x5592("0x52")]=1]="Once",t[t[a0_0x5592("0x1d2")]=2]=a0_0x5592("0x1d2"),t[t[a0_0x5592("0x568")]=3]="Always",t[t[a0_0x5592("0x2a1")]=4]=a0_0x5592("0x2a1")}(m||(m={}));class D{static["setSkills"](e){for(let t=1;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];this[a0_0x5592("0x53d")][a[0]]={id:a[0],nameCN:a[1],name:a[2],describeCN:a[3],describe:a[4],skilltype:a[5],fightadd:a[6],value:a[7],bullettype:a[8],buff:a[9],bufftime:a[10],add:a[11],speed:a0_0x5592("0x993")==typeof a[13]?a[13]:0,fspeed:a0_0x5592("0x993")==typeof a[14]?a[14]:0,robotsp:a0_0x5592("0x993")==typeof a[15]?a[15]:0,robotbullet:a0_0x5592("0x993")==typeof a[16]?a[16]:0,weight:a[17],recommend:a[18]};const i=(a[12]+"")[a0_0x5592("0xae0")]("|"),r=i[0]?parseInt(i[0]):0,s=i[1]?parseInt(i[1]):0;r?1==r?U[a0_0x5592("0x791")][s-1][a0_0x5592("0x80a")][a0_0x5592("0x626")](a[0]):U[a0_0x5592("0x52a")][s-1][a0_0x5592("0x80a")]["push"](a[0]):a[11]!=m[a0_0x5592("0x1d2")]&&1e3!=a[0]&&U[a0_0x5592("0x8b2")][a0_0x5592("0x80a")][a0_0x5592("0x626")](a[0])}U["basChapter"][a0_0x5592("0x80a")][a0_0x5592("0x626")](1020)}}D[a0_0x5592("0x53d")]={};const w={lobby:{LobbySceneBgNode:"prefab/lobby/LobbySceneBgNode.json",BattlePage:a0_0x5592("0x339"),AdventurePage:a0_0x5592("0xa97"),HangarPage:a0_0x5592("0xa2d"),HangarDialog:a0_0x5592("0x71c"),HangarPlaneItem:a0_0x5592("0x687"),RankDialog:a0_0x5592("0x8c8"),SigninDialog:a0_0x5592("0x8a"),TaskDialog:a0_0x5592("0xa09"),TaskItem:a0_0x5592("0x944"),AchievementDialog:"prefab/lobby/AchievementDialog.json",DailyDialog:a0_0x5592("0x6bd"),EndlessDialog:"prefab/lobby/EndlessDialog.json",UnlockPlaneDialog:a0_0x5592("0x46a"),EquipmentPage:a0_0x5592("0xa35"),ShopPage:"prefab/lobby/ShopPage.json",EquMainItem:a0_0x5592("0x95"),EquMainTogItem:a0_0x5592("0xec"),EquSuitDialog:"prefab/lobby/equipment/EquSuitDialog.json",EquSymDialog:"prefab/lobby/equipment/EquSymDialog.json",EquNewAttDialog:a0_0x5592("0x8d5"),EquOequDialog:a0_0x5592("0x10b"),EquDecDialog:a0_0x5592("0x84d"),EquMatDesDialog:a0_0x5592("0x402"),CommonDialog:a0_0x5592("0x9fd"),CommonLoadingDialog:a0_0x5592("0x444"),CommonTipDialog:a0_0x5592("0x7af"),CommonRewardDialog:"prefab/lobby/common/CommonRewardDialog.json",CommonRewardAdDialog:a0_0x5592("0x582"),UnlockChapterDialog:a0_0x5592("0x830")},battle:{BgNode:a0_0x5592("0x6aa"),PlayerReward:a0_0x5592("0x139"),Player:a0_0x5592("0x3d1"),Player1:"prefab/battle/player/Player1.json",PlayerHP:a0_0x5592("0xa75"),Player1Bullet:a0_0x5592("0x795"),Player3Bullet:a0_0x5592("0x100"),Player4Bullet:a0_0x5592("0x75f"),Player4MainBoom:a0_0x5592("0x392"),Player5Bullet:a0_0x5592("0xa0c"),Player6Bullet:"prefab/battle/skill/Player6Bullet.json",Player6Bullet1:"prefab/battle/skill/Player6Bullet1.json",PlayerLaser:a0_0x5592("0x2e1"),PlayerShield:"prefab/battle/skill/PlayerShield.json",PlayerTimeShield:a0_0x5592("0xbe"),PlayerDieShot:a0_0x5592("0x8f2"),PlayerDieBoom:a0_0x5592("0x5de"),PlayerSkill1:"prefab/battle/skill/PlayerSkill1.json",PlayerSkill2:a0_0x5592("0x98a"),PlayerSkill3:a0_0x5592("0x545"),PlayerSkill4:a0_0x5592("0x9c5"),PlayerSkill5:"prefab/battle/skill/PlayerSkill5.json",PlayerSkill6:a0_0x5592("0x8d"),PlayerSkill7:a0_0x5592("0x8e0"),PlayerSkill8:a0_0x5592("0x71e"),PlayerSkill9:a0_0x5592("0x78e"),PlayerSkill10:a0_0x5592("0xab7"),PlayerSkill2002:"prefab/battle/skill/PlayerSkill2002.json",PlayerSkill2012:a0_0x5592("0x86e"),PlayerSkill2013:a0_0x5592("0x282"),PlayerWing1:a0_0x5592("0x6ab"),PlayerWing1b:a0_0x5592("0x5d5"),PlayerWing2:"prefab/battle/wing/PlayerWing2.json",PlayerWing2b:a0_0x5592("0x2de"),PlayerWing3:a0_0x5592("0x112"),PlayerWing3b:a0_0x5592("0x3d3"),PlayerWing4:"prefab/battle/wing/PlayerWing4.json",PlayerWing4b:a0_0x5592("0x763"),PlayerWing5:a0_0x5592("0x17d"),PlayerWing5b:a0_0x5592("0xe2"),PlayerWing6:"prefab/battle/wing/PlayerWing6.json",PlayerWing6b:a0_0x5592("0x56a"),PlayerRobot1:a0_0x5592("0x839"),PlayerRobot1b:"prefab/battle/robot/PlayerRobot1b.json",PlayerRobot2:a0_0x5592("0xad0"),PlayerRobot3:a0_0x5592("0x840"),Enemy1001:"prefab/battle/enemy/Enemy1001.json",Enemy1002:a0_0x5592("0xb0b"),Enemy1004:a0_0x5592("0x170"),Enemy1006:"prefab/battle/enemy/Enemy1006.json",Enemy1008:a0_0x5592("0x5f6"),Enemy1010:a0_0x5592("0x492"),Enemy1012:"prefab/battle/enemy/Enemy1012.json",Enemy1014:a0_0x5592("0x3d7"),Enemy1016:"prefab/battle/enemy/Enemy1016.json",Enemy1017:a0_0x5592("0x92b"),Enemy1018:a0_0x5592("0x1da"),Enemy1019:a0_0x5592("0x6cd"),Enemy1020:a0_0x5592("0x9c3"),Enemy1021:a0_0x5592("0x96e"),Enemy1023:a0_0x5592("0x9d8"),Enemy1024:a0_0x5592("0x972"),Enemy1025:"prefab/battle/enemy/Enemy1025.json",Enemy1026:"prefab/battle/enemy/Enemy1026.json",Enemy1027:a0_0x5592("0x61d"),Enemy1029:a0_0x5592("0x11b"),Enemy2001:"prefab/battle/enemy/Enemy2001.json",Enemy2002:a0_0x5592("0x818"),Enemy2003:a0_0x5592("0x1a0"),Enemy2004:a0_0x5592("0x33c"),Enemy2005:a0_0x5592("0x411"),Enemy2006:a0_0x5592("0x832"),Enemy3001:a0_0x5592("0x45b"),Enemy3002:a0_0x5592("0xa4f"),EnemyHPTip:a0_0x5592("0xa46"),EnemyLine:a0_0x5592("0x989"),EnemyLaser:"prefab/battle/enemySkill/EnemyLaser.json",EnemySkill1:"prefab/battle/enemySkill/EnemySkill1.json",EnemySkill3:"prefab/battle/enemySkill/EnemySkill3.json",EnemySkill5:a0_0x5592("0x250"),EnemySkill9:a0_0x5592("0x6a7"),EnemySkill10:a0_0x5592("0x78d"),EnemySkill11:a0_0x5592("0x75c"),EnemySkill13:a0_0x5592("0xabc"),EnemySkill15:a0_0x5592("0x23"),EnemySkill16:a0_0x5592("0x440"),EnemySkill18:a0_0x5592("0x883"),EnemySkill2001:a0_0x5592("0x7fe"),EnemySkill1011:a0_0x5592("0x115"),EnemySkill1022:a0_0x5592("0x3da"),EnemySmete:a0_0x5592("0xa0d"),EnemyBoom:a0_0x5592("0x90c"),EnemyBoom2:a0_0x5592("0x415"),EnemyWave:a0_0x5592("0x551"),PlayerLaserHit:a0_0x5592("0x94f"),PlayerLaserHit2:"prefab/battle/effect/PlayerLaserHit2.json",PlayerLaserHit3:a0_0x5592("0x97d"),PlayerBlast:a0_0x5592("0x2b2"),PlayerFireBuff:a0_0x5592("0x82f"),PlayerPoisonBuff:a0_0x5592("0x888"),PlayerIceBuff:a0_0x5592("0x27d"),HpBarLight:a0_0x5592("0x8ba"),PlayerCoin:a0_0x5592("0x1e7")},battleUI:{BattleSceneMidNode:a0_0x5592("0x671"),BattleFriendNode:a0_0x5592("0x476"),BattleCompareBigNode:"prefab/battle/bg/BattleCompareBigNode.json",BattleCompareSmallNode:a0_0x5592("0x95b"),FriendDialog:a0_0x5592("0x2e"),ChooseSkillDialog:a0_0x5592("0x807"),ChooseAdvSkillDialog:a0_0x5592("0x1fe"),SupplySkillDialog:a0_0x5592("0x27a"),GamePauseDialog:a0_0x5592("0x912"),GameOverDialog:a0_0x5592("0x9f0"),EndlessOverDialog:a0_0x5592("0x738"),EndlessOverstepDialog:a0_0x5592("0x194"),RebornDialog:"prefab/battle/bg/RebornDialog.json",PlayerSkillItem:a0_0x5592("0x73f")}},b={PlaneModel1:a0_0x5592("0x5c"),PlaneModel2:a0_0x5592("0x422"),PlaneModel3:a0_0x5592("0x967"),PlaneModel4:a0_0x5592("0x790"),PlaneModel5:"unity/plane5/plane.lh",PlaneModel6:a0_0x5592("0x6c2"),PlaneTrackModel:a0_0x5592("0x14c"),Coin:"unity/coin/plane.lh",DaoDan:a0_0x5592("0x53f"),Main4:"unity/plane4main/plane.lh",CaiHon:"unity/caihon/plane.lh",DaoDanLiaoJi:a0_0x5592("0x182"),DaoDanGui:"unity/daodangui/plane.lh",FuYouPao:a0_0x5592("0x330"),DaoDanFu:a0_0x5592("0x16e"),YanHua:"unity/yanhua/plane.lh",E_DaoDan:a0_0x5592("0x22f"),E_Hxb:"unity/e_hxb/plane.lh"},d={2001:a0_0x5592("0x9bb"),3001:"battle/enemy/plane/3001/foe3001.sk",3002:"battle/enemy/plane/3002/BuJi.sk",1002:a0_0x5592("0x866"),1004:a0_0x5592("0x66a"),1006:a0_0x5592("0x4be"),1014:a0_0x5592("0x3c")},u={1001:"prefab/battle/enemy/Enemy1001.json",1002:"prefab/battle/enemy/Enemy1002.json",1003:a0_0x5592("0xb0b"),1004:a0_0x5592("0x170"),1005:a0_0x5592("0x170"),1006:a0_0x5592("0x1fc"),1007:a0_0x5592("0x1fc"),1008:a0_0x5592("0x5f6"),1009:a0_0x5592("0x5f6"),1010:a0_0x5592("0x492"),1011:a0_0x5592("0x492"),1012:a0_0x5592("0x2e7"),1013:a0_0x5592("0x2e7"),1014:a0_0x5592("0x3d7"),1015:a0_0x5592("0x3d7"),1016:a0_0x5592("0xa95"),1017:a0_0x5592("0x92b"),1018:a0_0x5592("0x1da"),1019:a0_0x5592("0x6cd"),1020:a0_0x5592("0x9c3"),1021:a0_0x5592("0x96e"),1022:a0_0x5592("0x96e"),1023:a0_0x5592("0x9d8"),1024:a0_0x5592("0x972"),1025:a0_0x5592("0x390"),1026:a0_0x5592("0x7cd"),1027:a0_0x5592("0x61d"),1028:"prefab/battle/enemy/Enemy1004.json",1029:a0_0x5592("0x11b"),2001:a0_0x5592("0x74a"),2002:a0_0x5592("0x818"),2003:a0_0x5592("0x1a0"),2004:"prefab/battle/enemy/Enemy2004.json",2005:"prefab/battle/enemy/Enemy2005.json",2006:a0_0x5592("0x832"),3001:"prefab/battle/enemy/Enemy3001.json",3002:a0_0x5592("0xa4f"),3003:a0_0x5592("0xa4f")},y={1:a0_0x5592("0x5c"),2:"unity/plane2/plane.lh",3:a0_0x5592("0x967"),4:a0_0x5592("0x790"),5:"unity/plane5/plane.lh",6:a0_0x5592("0x6c2")},tt={BlackItalic:a0_0x5592("0x67f")},et={Chapter:"chapter.json",Skill:a0_0x5592("0x6b1"),Level0:a0_0x5592("0x5f7"),Level1:a0_0x5592("0x18b"),Level2:a0_0x5592("0x6ff"),Level3:"level3.json",Level4:a0_0x5592("0xa1"),Level5:a0_0x5592("0xfd"),Level6:a0_0x5592("0x29f"),Level7:"level7.json",Level8:a0_0x5592("0x9d0"),Level9:"level9.json",Level10:"level10.json",Level11:a0_0x5592("0x589"),Level12:a0_0x5592("0x9c6"),Level13:a0_0x5592("0x9aa"),Level14:a0_0x5592("0x553"),Level15:"level15.json",Enaircraft:"enaircraft.json",Exp:a0_0x5592("0x1f4"),Upaircraft:a0_0x5592("0x322"),Upgold:"upgold.json",Aircraft:a0_0x5592("0x2b3"),Item:a0_0x5592("0x9b0"),Shop:a0_0x5592("0x628"),Equip:"equip.json",Addskill:a0_0x5592("0x127"),Upequip:a0_0x5592("0x9cd"),Task:"task.json",DailyTask:a0_0x5592("0x4a9"),Achievement:a0_0x5592("0xb9"),Adventurefight:a0_0x5592("0x7df"),Adventuredrop:a0_0x5592("0x468")},at={BattleBgMus:a0_0x5592("0x8d1"),BattleBoom1Sou:a0_0x5592("0x635"),BattleBoom2Sou:a0_0x5592("0x5d0"),BattleBossComSou:a0_0x5592("0xa7a"),BattleSucSou:a0_0x5592("0x7a1"),LobbyBgMus:"sound/bglobby.mp3",ClickSou:a0_0x5592("0x698"),GetFlyCoinSou:a0_0x5592("0x538"),PlaneLevUpSou:a0_0x5592("0x556")},it={1:a0_0x5592("0x280"),2:a0_0x5592("0x41b"),3:"unity/plane3/Assets/Plane_1.jpg",4:a0_0x5592("0xa9d"),5:"unity/plane5/Assets/Plane5.jpg",6:"unity/plane6/Assets/Plane6.jpg"},rt={1:"lobby/planes/Plane1.png",2:a0_0x5592("0x85"),3:a0_0x5592("0xa01"),4:a0_0x5592("0x160"),5:a0_0x5592("0x731"),6:a0_0x5592("0x15b")},st={1007:[b[a0_0x5592("0x85b")]],1009:[b[a0_0x5592("0x85b")]],1027:[b["E_Hxb"]],1029:[b[a0_0x5592("0x85b")]],2003:[b["E_DaoDan"]],2005:[b[a0_0x5592("0x85b")]]},nt={1003:[w["battle"][a0_0x5592("0x105")]],1004:[w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]],1005:[w["battle"]["EnemySkill5"]],1007:[w[a0_0x5592("0x4f3")][a0_0x5592("0x232")]],1009:[w[a0_0x5592("0x4f3")]["EnemySkill3"]],1011:[w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]],1013:[w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]],1015:[w["battle"][a0_0x5592("0x97b")],w["battle"][a0_0x5592("0x105")]],1016:[w[a0_0x5592("0x4f3")]["EnemySkill10"]],1017:[w[a0_0x5592("0x4f3")]["EnemySkill1"]],1019:[w[a0_0x5592("0x4f3")][a0_0x5592("0x63d")]],1022:[w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]],1023:[w[a0_0x5592("0x4f3")][a0_0x5592("0x42")],w["battle"][a0_0x5592("0x105")]],1024:[w[a0_0x5592("0x4f3")][a0_0x5592("0x8dd")]],1025:[w[a0_0x5592("0x4f3")][a0_0x5592("0x97b")],w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]],1026:[w[a0_0x5592("0x4f3")][a0_0x5592("0x87d")]],1027:[w[a0_0x5592("0x4f3")][a0_0x5592("0x55b")]],1028:[w["battle"]["EnemySkill16"]],1029:[w[a0_0x5592("0x4f3")][a0_0x5592("0xa39")]],2001:[w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")]],2002:[w["battle"][a0_0x5592("0x105")],w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")],w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],w[a0_0x5592("0x4f3")]["EnemySkill1011"]],2003:[w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],w[a0_0x5592("0x4f3")][a0_0x5592("0xb2")],w[a0_0x5592("0x4f3")][a0_0x5592("0x7f9")],w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")]],2004:[w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],w[a0_0x5592("0x4f3")][a0_0x5592("0x42")],w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")]],2005:[w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],w[a0_0x5592("0x4f3")]["EnemySkill9"],w["battle"][a0_0x5592("0x232")]],2006:[w["battle"][a0_0x5592("0xaa2")],w[a0_0x5592("0x4f3")][a0_0x5592("0x42")]],3002:[w[a0_0x5592("0x877")]["SupplySkillDialog"]]},ot={2002:[b["DaoDanFu"]],2004:[b[a0_0x5592("0xb31")]],2006:[b[a0_0x5592("0x760")]],2010:[b[a0_0x5592("0x131")]],2012:[b["YanHua"]],3002:[b["DaoDanLiaoJi"]]},lt={1e3:[w[a0_0x5592("0x4f3")]["PlayerWing3"],w[a0_0x5592("0x4f3")]["PlayerWing3b"],w["battle"][a0_0x5592("0xae")],w[a0_0x5592("0x4f3")][a0_0x5592("0x116")],w[a0_0x5592("0x4f3")][a0_0x5592("0x12")],w[a0_0x5592("0x4f3")]["PlayerSkill2012"],w[a0_0x5592("0x4f3")][a0_0x5592("0x36a")],w[a0_0x5592("0x4f3")][a0_0x5592("0x20b")]],1025:[w[a0_0x5592("0x4f3")]["PlayerShield"]],1027:[w[a0_0x5592("0x4f3")][a0_0x5592("0x343")]],1028:[w[a0_0x5592("0x4f3")][a0_0x5592("0x36a")]],1034:[w[a0_0x5592("0x4f3")]["PlayerDieBoom"]],2001:[w[a0_0x5592("0x4f3")][a0_0x5592("0x850")]],2002:[w[a0_0x5592("0x4f3")][a0_0x5592("0x116")]],2003:[w["battle"][a0_0x5592("0xa0e")],w[a0_0x5592("0x4f3")][a0_0x5592("0xac6")]],2004:[w[a0_0x5592("0x4f3")]["PlayerSkill1"]],2005:[w[a0_0x5592("0x4f3")][a0_0x5592("0xae")]],2006:[w["battle"]["PlayerSkill5"]],2007:[w[a0_0x5592("0x4f3")][a0_0x5592("0xae2")],w[a0_0x5592("0x4f3")]["PlayerPoisonBuff"]],2008:[w[a0_0x5592("0x4f3")][a0_0x5592("0x73")],w[a0_0x5592("0x4f3")][a0_0x5592("0x3bc")]],2009:[w[a0_0x5592("0x4f3")][a0_0x5592("0x1c0")],w["battle"][a0_0x5592("0xa96")]],2010:[w[a0_0x5592("0x4f3")][a0_0x5592("0xb27")]],2011:[w["battle"][a0_0x5592("0x252")]],2012:[w[a0_0x5592("0x4f3")][a0_0x5592("0x966")]],2013:[w[a0_0x5592("0x4f3")]["PlayerSkill2013"]],3001:[w[a0_0x5592("0x4f3")][a0_0x5592("0x342")],w["battle"][a0_0x5592("0xa4c")]],3002:[w[a0_0x5592("0x4f3")]["PlayerWing2"],w[a0_0x5592("0x4f3")][a0_0x5592("0xb4")]],3003:[w["battle"][a0_0x5592("0x5e1")],w[a0_0x5592("0x4f3")][a0_0x5592("0x3e8")],w[a0_0x5592("0x4f3")]["PlayerLaserHit2"]],3004:[w[a0_0x5592("0x4f3")][a0_0x5592("0x822")],w["battle"][a0_0x5592("0x600")]],3005:[w[a0_0x5592("0x4f3")][a0_0x5592("0x38c")],w[a0_0x5592("0x4f3")][a0_0x5592("0x9a5")],w[a0_0x5592("0x4f3")][a0_0x5592("0x1d8")]],3006:[w[a0_0x5592("0x4f3")][a0_0x5592("0x363")],w[a0_0x5592("0x4f3")][a0_0x5592("0x59c")]],4001:[w[a0_0x5592("0x4f3")][a0_0x5592("0x6b5")],w[a0_0x5592("0x4f3")]["PlayerRobot1b"]],4002:[w[a0_0x5592("0x4f3")][a0_0x5592("0xb1")]],4003:[w[a0_0x5592("0x4f3")]["PlayerRobot2"],w[a0_0x5592("0x4f3")]["PlayerWing6b"]]},_t={1:[w["battle"][a0_0x5592("0x52e")]],2:[w[a0_0x5592("0x4f3")][a0_0x5592("0x2f8")],w[a0_0x5592("0x4f3")]["PlayerLaserHit"]],3:[w[a0_0x5592("0x4f3")]["Player3Bullet"]],4:[w[a0_0x5592("0x4f3")]["Player4Bullet"],w[a0_0x5592("0x4f3")][a0_0x5592("0x423")]],5:[w[a0_0x5592("0x4f3")][a0_0x5592("0x60e")]],6:[w[a0_0x5592("0x4f3")][a0_0x5592("0x479")],w[a0_0x5592("0x4f3")][a0_0x5592("0x606")]]};const S=new class{constructor(){this[a0_0x5592("0x7")]={}}["load3D"](r){return new Promise((t,e)=>{if(!r||!r["length"])return void t();const a=[];for(let t=0;t<r[a0_0x5592("0xb0e")];t++){const i=r[t];this[a0_0x5592("0x7")][i]||a["push"](i)}a["length"]?Laya[a0_0x5592("0x80c")]["create"](a[a0_0x5592("0xac7")](),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{for(let t=0;t<a[a0_0x5592("0xb0e")];t++)a[t];t()})):t()})}[a0_0x5592("0x219")](){const t=[];t[a0_0x5592("0x626")](w["lobby"][a0_0x5592("0x6c8")],w["lobby"][a0_0x5592("0xa99")],a0_0x5592("0x4")),Laya[a0_0x5592("0x80c")]["create"](t["concat"](),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0x6e9")](t)}),null,Laya[a0_0x5592("0x92")][a0_0x5592("0x615")])}["loadPlayerPre"](t){const e=[];e[a0_0x5592("0x626")](w[a0_0x5592("0x4f3")][a0_0x5592("0x17b")],w[a0_0x5592("0x4f3")]["EnemyBoom2"],w["battle"][a0_0x5592("0xa27")]);const a=_t[t];if(a)for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const i=a[t];this["loaded"][i]||e[a0_0x5592("0x626")](i)}this[a0_0x5592("0x6e9")](e)}[a0_0x5592("0x2be")](t){if(t){const a=["prefab/GuidanceDialog.json"];Laya[a0_0x5592("0x80c")][a0_0x5592("0x2ab")](a[a0_0x5592("0xac7")](),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this["load"](a)}),null,Laya[a0_0x5592("0x92")][a0_0x5592("0x615")])}const e=[];e[a0_0x5592("0x626")](w[a0_0x5592("0x877")]["ChooseSkillDialog"],w[a0_0x5592("0x877")][a0_0x5592("0x89a")],w[a0_0x5592("0x877")][a0_0x5592("0xaa8")],w[a0_0x5592("0x877")][a0_0x5592("0x2df")]),this[a0_0x5592("0x6e9")](e)}[a0_0x5592("0x741")](e){if(!e||!e[a0_0x5592("0xb0e")])return;const a=[],i=[];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const r=e[t],s=lt[r];if(s)for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const o=s[t];this[a0_0x5592("0x7")][o]||a[a0_0x5592("0x626")](o)}const n=ot[r];if(n)for(let t=0;t<n["length"];t++){const l=n[t];this[a0_0x5592("0x7")][l]||i[a0_0x5592("0x626")](l)}}this["load"](a),this[a0_0x5592("0x1eb")](i)}[a0_0x5592("0x50")](e){if(!e||!e[a0_0x5592("0xb0e")])return;const a=[],i=[];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const r=e[t],s=u[r];s&&!this[a0_0x5592("0x7")][s]&&a[a0_0x5592("0x626")](s);const n=nt[r];if(n)for(let t=0;t<n[a0_0x5592("0xb0e")];t++){const l=n[t];this[a0_0x5592("0x7")][l]||a[a0_0x5592("0x626")](l)}const o=st[r];if(o)for(let t=0;t<o[a0_0x5592("0xb0e")];t++){const _=o[t];this["loaded"][_]||i[a0_0x5592("0x626")](_)}}this["load"](a),this[a0_0x5592("0x1eb")](i)}[a0_0x5592("0x6e9")](a){const i=new Laya["Sprite"];i[a0_0x5592("0x143")]=!1,Laya[a0_0x5592("0x43c")]["addChild"](i);for(let e=0;e<a[a0_0x5592("0xb0e")];e++){const r=a[e];this[a0_0x5592("0x7")][r]=1;let t=null;if(r[a0_0x5592("0x779")](a0_0x5592("0x44a"))>-1){const n=r["split"]("/"),o=n[n[a0_0x5592("0xb0e")]-1],l=Laya["loader"]["getRes"]("prefab/battle/merge.json")[o];(t=new Laya[a0_0x5592("0x683")])[a0_0x5592("0x622")]=l}else{t=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](r)}const s=Laya[a0_0x5592("0x353")][a0_0x5592("0x1d")](r,t["create"],t);s[a0_0x5592("0x25d")]=null,i[a0_0x5592("0x231")](s)}i[a0_0x5592("0xaa4")]()}},ht={DEBUG:!1};class xt{static[a0_0x5592("0x4c9")](t,e){const a=Laya[a0_0x5592("0x353")][a0_0x5592("0x1d")](t,e[a0_0x5592("0x2ab")],e);return a[a0_0x5592("0x8e9")]=t,a}static[a0_0x5592("0x68")](t,e,a,i,r,s){t["on"](Laya[a0_0x5592("0x690")]["MOUSE_DOWN"],a,()=>{r||Laya["Tween"]["to"](t,{scaleX:.9,scaleY:.9},100)});const n=()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{scaleX:1,scaleY:1},100)};{const o=e;e=()=>{r||n(),s||Laya[a0_0x5592("0x262")]["playSound"](at[a0_0x5592("0x82")]),o[a0_0x5592("0x550")](a,i)}}t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0xa61")],a,n),t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x711")],a,e,i)}static["openDialog"](i,r,s,n,o){this[a0_0x5592("0x7e3")](i)["then"](t=>{const e=this[a0_0x5592("0x4c9")](i,t);e[a0_0x5592("0x6f7")](360,640);const a=e[a0_0x5592("0xab9")](a0_0x5592("0x84c"));a&&(a["offAllCaller"](a),this[a0_0x5592("0x68")](a,()=>{o&&this[a0_0x5592("0x6a6")](e)},a,null,!0,!0)),n||e[a0_0x5592("0xa20")](0,0),n||(e[a0_0x5592("0x14")]=0),r[a0_0x5592("0x231")](e),s&&s(e),n||Laya["Tween"]["to"](e,{scaleX:1,scaleY:1,alpha:1},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x789")])})}static[a0_0x5592("0x6a6")](t,e){let a=t["owner"];t instanceof Laya[a0_0x5592("0x6ad")]&&(a=t),a&&Laya[a0_0x5592("0x6eb")]["to"](a,{scaleX:0,scaleY:0,alpha:0},100,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{a[a0_0x5592("0xaa4")](),e&&e()}))}static[a0_0x5592("0x7e3")](n){return new Promise((e,t)=>{const a=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](n);if(a)e(a);else{let t=null;if(!ht[a0_0x5592("0xaef")]&&n[a0_0x5592("0x779")](a0_0x5592("0x44a"))>-1){const i=n[a0_0x5592("0xae0")]("/"),r=i[i[a0_0x5592("0xb0e")]-1],s=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](a0_0x5592("0x1b3"))[r];(t=new Laya[a0_0x5592("0x683")])["json"]=s,e(t)}else Laya[a0_0x5592("0x80c")][a0_0x5592("0x2ab")](n,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,t=>{t&&e(t)}),null,Laya["Loader"][a0_0x5592("0x615")])}})}static[a0_0x5592("0xb01")](i){return new Promise((e,t)=>{const a=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](i);a?e(a):Laya["loader"][a0_0x5592("0x2ab")](i,Laya[a0_0x5592("0x4d5")]["create"](this,t=>{t&&e(t)}))})}}let ct=0;class t extends Laya[a0_0x5592("0x54")]{constructor(){super()}[a0_0x5592("0x880")](){}["onDisable"](){R[a0_0x5592("0x5c7")](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this)}[a0_0x5592("0x7e3")](n){return new Promise((e,t)=>{const a=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](n);if(a)e(a);else{let t=null;if(!ht[a0_0x5592("0xaef")]&&n["indexOf"]("prefab/battle")>-1){const i=n[a0_0x5592("0xae0")]("/"),r=i[i[a0_0x5592("0xb0e")]-1],s=Laya["loader"][a0_0x5592("0x761")](a0_0x5592("0x1b3"))[r];(t=new Laya[a0_0x5592("0x683")])[a0_0x5592("0x622")]=s,e(t)}else Laya[a0_0x5592("0x80c")][a0_0x5592("0x2ab")](n,Laya["Handler"][a0_0x5592("0x2ab")](this,t=>{t&&e(t)}),null,Laya[a0_0x5592("0x92")][a0_0x5592("0x615")])}})}[a0_0x5592("0xb01")](i){return new Promise((e,t)=>{const a=Laya[a0_0x5592("0x80c")]["getRes"](i);a?e(a):Laya[a0_0x5592("0x80c")][a0_0x5592("0x2ab")](i,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,t=>{t&&e(t)}))})}[a0_0x5592("0x761")](t){let e=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](t);if(!ht[a0_0x5592("0xaef")]&&t["indexOf"](a0_0x5592("0x44a"))>-1){const a=t[a0_0x5592("0xae0")]("/"),i=a[a[a0_0x5592("0xb0e")]-1],r=Laya["loader"][a0_0x5592("0x761")]("prefab/battle/merge.json")[i];(e=new Laya["Prefab"])[a0_0x5592("0x622")]=r}return e}[a0_0x5592("0x4c9")](t,e){const a=Laya[a0_0x5592("0x353")][a0_0x5592("0x1d")](t,e[a0_0x5592("0x2ab")],e);return a[a0_0x5592("0x8e9")]=t,a}[a0_0x5592("0x77a")](t){let e=t[a0_0x5592("0x8e9")];e&&Laya[a0_0x5592("0x353")]["recover"](e,t);let a=window[a0_0x5592("0x354")];a&&a[a0_0x5592("0x779")]&&a[a0_0x5592("0x779")](e)<0&&a[a0_0x5592("0x626")](e)}[a0_0x5592("0x165")](i,r,s,n,o){let l=++ct,_=null,h=null;xt[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0xa99")],Laya[a0_0x5592("0x43c")],t=>{_=t,h&&t["removeSelf"](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](5e3,this,()=>{_&&(_[a0_0x5592("0xaa4")](),_=null,ct++)})},!1),this[a0_0x5592("0x7e3")](i)[a0_0x5592("0x284")](t=>{if(_&&(_[a0_0x5592("0xaa4")](),_=null),l!=ct)return;const e=this["open"](i,t);h=e,e[a0_0x5592("0x6f7")](360,640);const a=e[a0_0x5592("0xab9")](a0_0x5592("0x84c"));a&&(a[a0_0x5592("0x5c7")](a),this[a0_0x5592("0x68")](a,()=>{o&&this[a0_0x5592("0x6a6")](e)},a,null,!0,!0)),n||e[a0_0x5592("0xa20")](0,0),n||(e["alpha"]=0),r[a0_0x5592("0x231")](e),s&&s(e),n||Laya[a0_0x5592("0x6eb")]["to"](e,{scaleX:1,scaleY:1,alpha:1},200,Laya["Ease"][a0_0x5592("0x789")])})}[a0_0x5592("0x6a6")](t,e){let a=t[a0_0x5592("0x8a0")];t instanceof Laya["Node"]&&(a=t),a&&Laya["Tween"]["to"](a,{scaleX:0,scaleY:0,alpha:0},100,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{a[a0_0x5592("0xaa4")](),e&&e()}))}[a0_0x5592("0x68")](t,e,a,i,r,s){t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x4a7")],a,()=>{r||Laya["Tween"]["to"](t,{scaleX:.9,scaleY:.9},100)});const n=()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{scaleX:1,scaleY:1},100)};{const o=e;e=()=>{r||n(),s||Laya[a0_0x5592("0x262")][a0_0x5592("0x584")](at["ClickSou"]),o["call"](a,i)}}t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0xa61")],a,n),t["on"](Laya["Event"]["CLICK"],a,e,i)}[a0_0x5592("0xaf2")](t,e,a,i,r,s,n){const o=e;let l=0;e=()=>{if(l>=i)return Laya[a0_0x5592("0x6ec")][a0_0x5592("0x149")](a,e),void(n&&n["call"](a));l++,o[a0_0x5592("0x550")](a,r)},s&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x149")](a,e),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](t,a,e,r)}[a0_0x5592("0x5a7")](t=0,e=0){return new Laya[a0_0x5592("0x419")](t,e)}["getVec3"](t=0,e=0,a=0){return t instanceof Laya[a0_0x5592("0x419")]&&(e=t["y"],t=t["x"]),new Laya[a0_0x5592("0x97c")](t,e,a)}["getVec4"](t=0,e=0,a=0,i=0){return new Laya["Vector4"](t,e,a,i)}[a0_0x5592("0x831")](t){Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](t),Laya["timer"]["clearAll"](t);Laya[a0_0x5592("0x6eb")]["to"](t,{x:5,y:-7},20),Laya[a0_0x5592("0x6ec")]["once"](20,t,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:-6,y:-7},20)}),Laya[a0_0x5592("0x6ec")]["once"](40,t,()=>{Laya["Tween"]["to"](t,{x:-13,y:-3},20)}),Laya["timer"][a0_0x5592("0x724")](60,t,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:3,y:6},20)}),Laya["timer"][a0_0x5592("0x724")](80,t,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:-5,y:-5},20)}),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](100,t,()=>{Laya["Tween"]["to"](t,{x:2,y:8},20)}),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](120,t,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:-8,y:10},20)}),Laya["timer"][a0_0x5592("0x724")](140,t,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:3,y:-10},20)}),Laya[a0_0x5592("0x6ec")]["once"](160,t,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:0,y:0},20)}),Laya["timer"][a0_0x5592("0x724")](180,t,()=>{Laya["Tween"]["clearAll"](t),Laya[a0_0x5592("0x6ec")]["clearAll"](t),t["x"]=0,t["y"]=0})}}class dt extends t{constructor(){super(),this[a0_0x5592("0x730")]=null,this[a0_0x5592("0x821")]=null,this[a0_0x5592("0x1f8")]=null,this["titLab"]=null,this[a0_0x5592("0x32c")]=null,this[a0_0x5592("0x190")]=null,this[a0_0x5592("0x536")]=null}static["Tip"](e,t){xt[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x6c8")],t,t=>{t["getComponent"](dt)[a0_0x5592("0x971")](e)},!1,!0)}[a0_0x5592("0x971")](t){this["titLab"][a0_0x5592("0x1e3")]=t[a0_0x5592("0xdd")],this[a0_0x5592("0x32c")][a0_0x5592("0x1e3")]=t["desc"],this[a0_0x5592("0x190")]=t[a0_0x5592("0x932")],this[a0_0x5592("0x536")]=t["close"],t[a0_0x5592("0x7a0")]&&(this["canBtn"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x821")]["x"]=353)}[a0_0x5592("0x880")](){this["setClick"](this[a0_0x5592("0x730")],()=>{this[a0_0x5592("0x536")]&&this[a0_0x5592("0x536")](),this["closeDialog"](this)},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x1f8")],()=>{this[a0_0x5592("0x536")]&&this[a0_0x5592("0x536")](),this[a0_0x5592("0x6a6")](this)},this),this["setClick"](this[a0_0x5592("0x821")],()=>{this[a0_0x5592("0x190")]&&this[a0_0x5592("0x190")](),this[a0_0x5592("0x6a6")](this)},this)}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),Laya["timer"][a0_0x5592("0x61b")](this)}}class ut extends t{constructor(){super()}static[a0_0x5592("0x90d")](){this["loading"]||xt[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0xa99")],Laya[a0_0x5592("0x43c")],t=>{this["loading"]=t},!1)}static[a0_0x5592("0x999")](t){this["loading"]&&(xt[a0_0x5592("0x6a6")](this["loading"],t),this[a0_0x5592("0x445")]=null)}["onEnable"](){}["onDisable"](){}}ut[a0_0x5592("0x445")]=null;class ft{constructor(){}[a0_0x5592("0x654")](){1!=this["isInit"]&&(this[a0_0x5592("0x2f7")]=!0,this[a0_0x5592("0x869")]=!1,this[a0_0x5592("0x8b8")]=!1,this[a0_0x5592("0xb8")]=!1,this[a0_0x5592("0x60a")]=0,this[a0_0x5592("0x66")]=[a0_0x5592("0x4c0"),a0_0x5592("0x4d9"),a0_0x5592("0x9b2"),"1154365871695610_1164935357305328",a0_0x5592("0x332")],this[a0_0x5592("0x37d")]=[],Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](33,this,this[a0_0x5592("0x673")]),this[a0_0x5592("0x4ef")]())}[a0_0x5592("0x4ef")](){}[a0_0x5592("0x673")](){}[a0_0x5592("0x83c")](){}[a0_0x5592("0x41e")](t,e){console[a0_0x5592("0xad6")](a0_0x5592("0xad9"));t&&t();try{window[a0_0x5592("0x39d")]["xsi"]()}catch(t){}}[a0_0x5592("0x8e3")](t,e,a){try{window[a0_0x5592("0x39d")][a0_0x5592("0x70a")](function(t){L[a0_0x5592("0x713")]&&Laya[a0_0x5592("0x262")][a0_0x5592("0x767")](L[a0_0x5592("0x713")],0);ut["Close"](()=>{});if(t){e&&e()}else{a&&a()}})}catch(t){}return;switch(C[a0_0x5592("0x5ba")]&&(t=a0_0x5592("0x4e2")),console[a0_0x5592("0xad6")](t),C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:var i=null;Laya[a0_0x5592("0x262")][a0_0x5592("0x8ee")](),ut[a0_0x5592("0x90d")](),FBInstant[a0_0x5592("0x2b6")](t)[a0_0x5592("0x284")](function(t){return console[a0_0x5592("0xad6")](a0_0x5592("0xac8")),(i=t)[a0_0x5592("0x561")]()})[a0_0x5592("0x284")](function(){return console[a0_0x5592("0xad6")](a0_0x5592("0xaf6")),i[a0_0x5592("0x8bd")]()})[a0_0x5592("0x284")](function(){R[a0_0x5592("0xcf")](a0_0x5592("0x227")),console[a0_0x5592("0xad6")](a0_0x5592("0x528")),L[a0_0x5592("0x713")]&&Laya[a0_0x5592("0x262")][a0_0x5592("0x767")](L[a0_0x5592("0x713")],0),ut[a0_0x5592("0x999")](()=>{}),null!=e&&e()})[a0_0x5592("0xb15")](function(t){L["bgCha"]&&Laya[a0_0x5592("0x262")][a0_0x5592("0x767")](L[a0_0x5592("0x713")],0),ut[a0_0x5592("0x999")](()=>{}),dt["Tip"]({title:N[a0_0x5592("0x238")][12],desc:N["Common"][19],sure:a,close:a,only:!0},Laya["stage"]),console[a0_0x5592("0xad6")]("RewardedVideo广告显示失败",t)});break;case n[a0_0x5592("0x848")]:ut[a0_0x5592("0x90d")](),setTimeout(()=>{ut[a0_0x5592("0x999")](()=>{}),R[a0_0x5592("0xcf")](a0_0x5592("0x227")),dt[a0_0x5592("0x9f9")]({title:N[a0_0x5592("0x238")][12],desc:N["Common"][19],sure:a,close:a,only:!0},Laya[a0_0x5592("0x43c")])},2e3)}}}class pt{constructor(){this["friendsList"]=null,this["rankData"]=[],this["playerScore"]=0,this[a0_0x5592("0x4d0")]=null,this["scoreRankArr"]=[22e5,18e5,13e5,95e4,5e5,25e4,1e5,55e3,3e4,15e3],this["stepScore"]=[1e3,5e4],this[a0_0x5592("0xac0")]=a0_0x5592("0x247"),this[a0_0x5592("0x193")]=8e6}[a0_0x5592("0x8af")](t){let e=0;if(this[a0_0x5592("0x218")][a0_0x5592("0xb0e")]>0){if(this[a0_0x5592("0x4d0")]){for(e=0;e<this[a0_0x5592("0x218")][a0_0x5592("0xb0e")];e++)this["realRankData"][this[a0_0x5592("0x218")][e]["playerID"]]&&(this["rankData"][e][a0_0x5592("0x537")]=this["realRankData"][this["rankData"][e]["playerID"]]);this[a0_0x5592("0x218")][a0_0x5592("0x26f")]((t,e)=>e[a0_0x5592("0x537")]-t[a0_0x5592("0x537")])}for(e=0;e<this[a0_0x5592("0x218")][a0_0x5592("0xb0e")];e++)this[a0_0x5592("0x218")][e][a0_0x5592("0x80")]=e+1;t(this[a0_0x5592("0x218")])}else setTimeout(()=>{this[a0_0x5592("0x8af")](t)},200)}[a0_0x5592("0x3f4")](t){this[a0_0x5592("0x744")]=Math["max"](this[a0_0x5592("0x744")],t),this["rankData"]["length"]>0&&this[a0_0x5592("0x76c")](),this["realRankData"]={},this[a0_0x5592("0x37b")](),this[a0_0x5592("0x9c1")]()}[a0_0x5592("0xa00")](){let e=this[a0_0x5592("0x941")]||[];if(e["length"]<5){let t=this[a0_0x5592("0x4e5")]();e=e[a0_0x5592("0xac7")](t)}return e=this["_shuffleArray"](e)}["_checkNeedSetRealRankData"](){C[a0_0x5592("0x10")]==n[a0_0x5592("0x33e")]&&null!=FBInstant[a0_0x5592("0x1b5")][a0_0x5592("0x9ab")]()&&FBInstant["getLeaderboardAsync"](this[a0_0x5592("0xac0")]+"."+FBInstant["context"][a0_0x5592("0x9ab")]())[a0_0x5592("0x284")](t=>t["setScoreAsync"](this[a0_0x5592("0x744")],""))[a0_0x5592("0x284")](()=>{console[a0_0x5592("0xad6")](a0_0x5592("0x7c3")),this[a0_0x5592("0x874")]()})["catch"](t=>{console[a0_0x5592("0xad6")]("update leaderbord fail"),console[a0_0x5592("0xad6")](t)})}[a0_0x5592("0x874")](){C["gameSDKName"]==n[a0_0x5592("0x33e")]&&null!=FBInstant[a0_0x5592("0x1b5")][a0_0x5592("0x9ab")]()&&FBInstant["getLeaderboardAsync"](this["msg_fbRankName"]+"."+FBInstant[a0_0x5592("0x1b5")][a0_0x5592("0x9ab")]())[a0_0x5592("0x284")](t=>t[a0_0x5592("0x438")](0,10))[a0_0x5592("0x284")](a=>{if(console[a0_0x5592("0xad6")](a0_0x5592("0x1c9")),this[a0_0x5592("0x4d0")]={},null!=a&&a["length"]>0)for(let e=0;e<a[a0_0x5592("0xb0e")];e++){let t={};t["playerID"]=a[e][a0_0x5592("0x4bb")]()[a0_0x5592("0x9ab")](),t[a0_0x5592("0x347")]=a[e]["getPlayer"]()["getPhoto"](),t[a0_0x5592("0x749")]=a[e][a0_0x5592("0x4bb")]()["getName"](),t[a0_0x5592("0x537")]=a[e][a0_0x5592("0x21")](),t[a0_0x5592("0x80")]=a[e][a0_0x5592("0x7e9")](),console[a0_0x5592("0xad6")](t[a0_0x5592("0x749")]),Number(t["score"])>=this[a0_0x5592("0x193")]||(this[a0_0x5592("0x4d0")][a0_0x5592("0x37")]=t[a0_0x5592("0x537")])}console[a0_0x5592("0xad6")]("真实rank数据:",this[a0_0x5592("0x4d0")])})[a0_0x5592("0xb15")](t=>{console["log"]("update leaderbord fail"),console[a0_0x5592("0xad6")](t)})}[a0_0x5592("0x37b")](){switch(this[a0_0x5592("0x37b")]=()=>{},C[a0_0x5592("0x10")]){case n["faceBookSDK"]:FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x24a")]()[a0_0x5592("0x284")](i=>{console[a0_0x5592("0xad6")](a0_0x5592("0x4f4"),i),this[a0_0x5592("0x941")]=[];for(let a=0;a<i[a0_0x5592("0xb0e")];a++){let t=i[a],e={};e[a0_0x5592("0x749")]=t[a0_0x5592("0x78c")](),e[a0_0x5592("0x37")]=t["getID"](),e[a0_0x5592("0x347")]=t["getPhoto"](),this[a0_0x5592("0x941")][a0_0x5592("0x626")](e)}this[a0_0x5592("0x937")](),console[a0_0x5592("0xad6")](a0_0x5592("0x94"),this[a0_0x5592("0x941")])})[a0_0x5592("0xb15")](t=>{console["log"](a0_0x5592("0x7c0")),console[a0_0x5592("0xad6")](t)});break;case n[a0_0x5592("0x848")]:setTimeout(()=>{this[a0_0x5592("0x941")]=this[a0_0x5592("0x4e5")](),this["_buildUnrealRank"]()},2e3)}}[a0_0x5592("0x937")](){let t=[],e=[],a=this["playerScore"],i=this[a0_0x5592("0x744")],r=0,s=0;for(s=0;s<this[a0_0x5592("0x2fd")][a0_0x5592("0xb0e")]&&!(this[a0_0x5592("0x744")]>=this[a0_0x5592("0x2fd")][s]);s++);const n=()=>a+=parseInt(this[a0_0x5592("0x34d")][0]+this[a0_0x5592("0x34d")][1]*Math["random"]()+""),o=()=>(i-=parseInt(this[a0_0x5592("0x34d")][0]+this["stepScore"][1]*Math["random"]()+""),i=Math[a0_0x5592("0x7e6")](0,i));for((r=s)===this["scoreRankArr"]["length"]&&(r=100),s=r-1;s>=0;s--)t[a0_0x5592("0x626")](n());for(s=0;s<100;s++)e[a0_0x5592("0x626")](o());this[a0_0x5592("0x941")]=this[a0_0x5592("0x81c")](this[a0_0x5592("0x941")]);let l=this[a0_0x5592("0x941")];this[a0_0x5592("0x218")][a0_0x5592("0x626")]({playerID:C[a0_0x5592("0x965")]["sdkInfo"][a0_0x5592("0x37")],name:C[a0_0x5592("0x965")][a0_0x5592("0x15")][a0_0x5592("0x901")],photo:C[a0_0x5592("0x965")][a0_0x5592("0x15")]["photo"],score:this[a0_0x5592("0x744")]});let _,h=Math[a0_0x5592("0x6bf")](l[a0_0x5592("0xb0e")],r);for(s=0;s<h;s++)(_=l[a0_0x5592("0x83a")]())[a0_0x5592("0x537")]=t[a0_0x5592("0x83a")](),this["rankData"]["push"](_);this["rankData"]["reverse"]();let x=l["length"];for(s=0;s<x;s++)(_=l["shift"]())[a0_0x5592("0x537")]=e[a0_0x5592("0x83a")](),this[a0_0x5592("0x218")]["push"](_);console[a0_0x5592("0xad6")](a0_0x5592("0x97"),this["rankData"])}["_flushRankData"](){for(let t=0;t<this["rankData"][a0_0x5592("0xb0e")];t++)if(this["rankData"][t][a0_0x5592("0x37")]===C[a0_0x5592("0x965")][a0_0x5592("0x15")][a0_0x5592("0x37")]){this[a0_0x5592("0x218")][t][a0_0x5592("0x537")]=this["playerScore"];break}this["rankData"][a0_0x5592("0x26f")]((t,e)=>e[a0_0x5592("0x537")]-t[a0_0x5592("0x537")])}["getRobotNames"](){return[a0_0x5592("0x410"),a0_0x5592("0x325"),"Asa Webb",a0_0x5592("0x34a"),a0_0x5592("0x5fa"),"Gloria Nelly",a0_0x5592("0x9a2"),a0_0x5592("0xc2"),a0_0x5592("0x133"),a0_0x5592("0x498"),a0_0x5592("0x21d"),a0_0x5592("0x31d"),a0_0x5592("0xa4a"),a0_0x5592("0x19b"),"Andy Hugh",a0_0x5592("0x6d9"),a0_0x5592("0x74"),a0_0x5592("0x800"),a0_0x5592("0x16c"),a0_0x5592("0xab8"),a0_0x5592("0x4a"),"Erin Christ",a0_0x5592("0x3e7"),a0_0x5592("0x665"),a0_0x5592("0x660"),a0_0x5592("0x57d"),"Christopher Pop",a0_0x5592("0x1f0"),a0_0x5592("0x5e6"),a0_0x5592("0x80d"),"Jason Carllyle","Armand Flower",a0_0x5592("0xaf9"),a0_0x5592("0x110"),a0_0x5592("0xe3"),"Quintina Petty","Myron Yule",a0_0x5592("0x526"),"Linda Felix",a0_0x5592("0x7ac"),a0_0x5592("0x90f"),a0_0x5592("0x38a"),a0_0x5592("0x23e"),a0_0x5592("0x4dc"),"Tom Pope",a0_0x5592("0x2b5"),a0_0x5592("0x614"),"Charles Edward",a0_0x5592("0xe6"),a0_0x5592("0x2c8"),a0_0x5592("0x32d"),a0_0x5592("0x825"),a0_0x5592("0x6e"),a0_0x5592("0x4b2"),a0_0x5592("0x604"),a0_0x5592("0xa6"),"Will Carroll",a0_0x5592("0x437"),"Truman Kennedy",a0_0x5592("0x70"),a0_0x5592("0x153"),"Eve DuBois",a0_0x5592("0x802"),a0_0x5592("0x833"),a0_0x5592("0x549"),a0_0x5592("0x254"),a0_0x5592("0x94a"),a0_0x5592("0x878"),"Eric Bertie",a0_0x5592("0x289"),a0_0x5592("0xb37"),a0_0x5592("0x805"),a0_0x5592("0x5b0"),a0_0x5592("0xfc"),"Eartha Lawson",a0_0x5592("0x78a"),a0_0x5592("0x921"),a0_0x5592("0x811"),a0_0x5592("0x952"),a0_0x5592("0x4da"),a0_0x5592("0x3b7"),a0_0x5592("0x592"),a0_0x5592("0x2a7"),a0_0x5592("0x2c9"),"Abel Christy",a0_0x5592("0x81"),a0_0x5592("0x969"),a0_0x5592("0x7dd"),a0_0x5592("0x87b"),a0_0x5592("0x20c"),"Janet Beaufort","Norma Matthew",a0_0x5592("0xc1"),a0_0x5592("0x788"),"Vera Ingersoll","Vincent Holmes",a0_0x5592("0x6ed"),a0_0x5592("0x5a1"),a0_0x5592("0x360"),a0_0x5592("0x5e5"),a0_0x5592("0x8b4"),a0_0x5592("0x358"),"Ada Clara","Caesar Henry",a0_0x5592("0x632"),"Nathaniel Leo","Griffith Marcus",a0_0x5592("0x2e6"),a0_0x5592("0x6b2"),a0_0x5592("0x156"),a0_0x5592("0xe7"),a0_0x5592("0x605"),a0_0x5592("0x19a"),"Leif Hamilton",a0_0x5592("0x179"),a0_0x5592("0x3ab"),a0_0x5592("0x4af"),a0_0x5592("0x6e8"),a0_0x5592("0x6b8"),"Orville McCar","Lena Giles","Giles Anna",a0_0x5592("0x2f4"),a0_0x5592("0x6f5"),"Tab Yeates","Jacqueline Cra",a0_0x5592("0x30e"),a0_0x5592("0x657"),a0_0x5592("0xad4"),a0_0x5592("0x108"),"Eudora Cotton","Lennon Dickens","Robin Toby",a0_0x5592("0x11"),a0_0x5592("0x488"),a0_0x5592("0xb22"),"Lesley Morgan","Devin Maud",a0_0x5592("0x5ac"),"Benson Scripps","Phil Webster",a0_0x5592("0xa4"),a0_0x5592("0x45d"),a0_0x5592("0xa0a"),a0_0x5592("0x6f6"),a0_0x5592("0xaee"),a0_0x5592("0x36"),a0_0x5592("0x517"),a0_0x5592("0x326"),a0_0x5592("0xae7"),a0_0x5592("0x7eb"),a0_0x5592("0x9ff"),"Arm Elinor",a0_0x5592("0x692"),a0_0x5592("0xb1e"),a0_0x5592("0x776"),a0_0x5592("0x8b9"),a0_0x5592("0x163"),a0_0x5592("0x4cf"),a0_0x5592("0x95d"),"Gabriel Grote","Joseph Darwin",a0_0x5592("0x44b"),a0_0x5592("0x6fa"),"Tyrone Marion",a0_0x5592("0x982"),a0_0x5592("0x69f"),a0_0x5592("0x770"),"Maxine Sharp",a0_0x5592("0x1a2"),a0_0x5592("0x54e"),a0_0x5592("0x82c"),a0_0x5592("0x938"),"Burnell Gal",a0_0x5592("0x7c5"),a0_0x5592("0x7bf"),a0_0x5592("0x8e7"),"Blanche Chaplin",a0_0x5592("0x102"),a0_0x5592("0x9fb"),a0_0x5592("0x2f5"),a0_0x5592("0x246"),a0_0x5592("0x35b"),a0_0x5592("0x25f"),a0_0x5592("0x10f"),a0_0x5592("0x7d6"),"Jim Marshall","Richard Van","Saxon Leopold",a0_0x5592("0x930"),a0_0x5592("0xb"),a0_0x5592("0x602"),"Thomas Christ","Cliff Thoreau",a0_0x5592("0x3b9"),a0_0x5592("0x3f8"),"Augus Abe","Quinn Irving",a0_0x5592("0x216"),"Winifred Troll",a0_0x5592("0x43f"),a0_0x5592("0x2f6"),"Ida Dewar",a0_0x5592("0x192"),a0_0x5592("0x28b"),a0_0x5592("0x9ee"),a0_0x5592("0x7f4"),a0_0x5592("0xa81"),a0_0x5592("0x6da"),a0_0x5592("0x7d8"),a0_0x5592("0x52f"),a0_0x5592("0x945"),"Marvin Jennings",a0_0x5592("0x92c"),a0_0x5592("0x41d"),a0_0x5592("0xcd"),a0_0x5592("0xad1")]}[a0_0x5592("0x841")](){const e=[];for(let t=1;t<21;t++)e["push"](t);return e}[a0_0x5592("0x4e5")](){let e=this[a0_0x5592("0x79c")](),a=[];for(;a[a0_0x5592("0xb0e")]<7;){let t=~~(Math[a0_0x5592("0x2ee")]()*e["length"]);-1===a["indexOf"](e[t])&&a[a0_0x5592("0x626")](e[t])}let t,i=[];for(t=0;t<7;t++)i["push"](t);i=this[a0_0x5592("0x81c")](i);let r=[];for(t=0;t<i[a0_0x5592("0xb0e")];t++)r[a0_0x5592("0x626")]({playerID:t+100,name:a[t],photo:"robot"+i[t],score:1e3*t+50});return r}[a0_0x5592("0x81c")](t){let e,a,i=t[a0_0x5592("0xb0e")];for(;i;)a=Math["floor"](Math["random"]()*i--),e=t[i],t[i]=t[a],t[a]=e;return t}}class mt{constructor(){this[a0_0x5592("0x96b")]=[],this[a0_0x5592("0x446")]=!0}[a0_0x5592("0x3e1")](){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:return;case n["faceBookSDKTest"]:this["isCanPayment"]=!0,console[a0_0x5592("0xad6")](a0_0x5592("0xa72")),this[a0_0x5592("0x899")]()}}[a0_0x5592("0x899")](){switch(C["gameSDKName"]){case n[a0_0x5592("0x848")]:break;case n["faceBookSDK"]:if(0==this[a0_0x5592("0x446")])return void console[a0_0x5592("0xad6")](a0_0x5592("0x361"));FBInstant[a0_0x5592("0x1ce")][a0_0x5592("0x130")]()[a0_0x5592("0x284")](t=>{t["length"]>0&&(console["log"](a0_0x5592("0xd9")),this[a0_0x5592("0x96b")]=t)})}}[a0_0x5592("0x18")](t,e,a,i){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x848")]:if(0==this[a0_0x5592("0x446")])return console[a0_0x5592("0xad6")]("支付并没有准备好"),void(null!=a&&a());break;case n[a0_0x5592("0x33e")]:if(0==this[a0_0x5592("0x446")])return console[a0_0x5592("0xad6")](a0_0x5592("0x361")),void(null!=a&&a());FBInstant[a0_0x5592("0x1ce")][a0_0x5592("0xad")]({productID:t[a0_0x5592("0x413")],developerPayload:t[a0_0x5592("0x5ad")]})[a0_0x5592("0x284")](function(t){console[a0_0x5592("0xad6")](a0_0x5592("0xacd")),null!=e&&(e(t),console["log"](t))})[a0_0x5592("0xb15")](function(t){console[a0_0x5592("0xad6")](a0_0x5592("0x3c2")),console[a0_0x5592("0xad6")](t),a0_0x5592("0x49d")==t[a0_0x5592("0x22b")]?null!=i&&i():null!=a&&a()})}}[a0_0x5592("0x7d4")](t){switch(C["gameSDKName"]){case n["faceBookSDKTest"]:console[a0_0x5592("0xad6")](a0_0x5592("0x41a")+t);break;case n[a0_0x5592("0x33e")]:FBInstant[a0_0x5592("0x1ce")][a0_0x5592("0x327")](t)[a0_0x5592("0x284")](function(){console[a0_0x5592("0xad6")](a0_0x5592("0x4f1")+t)})}}["isCanPay"](){return 1!=Laya[a0_0x5592("0x26a")][a0_0x5592("0x53a")]}}class gt{constructor(){}[a0_0x5592("0x9bc")](e,a,i,r){switch(C[a0_0x5592("0x10")]){case n["faceBookSDK"]:console["log"](a0_0x5592("0x4a1")),FBInstant["context"]["chooseAsync"]({filter:[a0_0x5592("0x6dd")]})["then"](()=>{console[a0_0x5592("0xad6")](a0_0x5592("0x8aa"));var t=new vt;t[a0_0x5592("0xaf3")]=t=>{console[a0_0x5592("0xad6")](a0_0x5592("0x18f")),FBInstant["updateAsync"]({action:a0_0x5592("0x146"),cta:a0_0x5592("0x7a9"),template:a0_0x5592("0xc7"),image:t,text:a0_0x5592("0x75"),data:{},strategy:"LAST",notification:"PUSH"})["then"](function(){null!=a&&(console[a0_0x5592("0xad6")](a0_0x5592("0x59e")),a())})[a0_0x5592("0xb15")](t=>{this[a0_0x5592("0x9b")](i,r,t,"邀请好友")})},t[a0_0x5592("0x654")](e)})[a0_0x5592("0xb15")](t=>{this[a0_0x5592("0x9b")](i,r,t,a0_0x5592("0x20a"))});break;case n[a0_0x5592("0x848")]:console[a0_0x5592("0xad6")](a0_0x5592("0x209")),null!=a&&a();var t=new vt;t[a0_0x5592("0xaf3")]=function(t){console[a0_0x5592("0xad6")](t)},t["initialize"](e)}}[a0_0x5592("0x613")](a,i){switch(C[a0_0x5592("0x10")]){case n["faceBookSDK"]:(r=document[a0_0x5592("0x700")](a0_0x5592("0x341")))[a0_0x5592("0x5a2")]=a0_0x5592("0xa4d"),r[a0_0x5592("0x69a")]=a0_0x5592("0x82d"),r["onload"]=function(){var t=document[a0_0x5592("0x700")](a0_0x5592("0x142"));t[a0_0x5592("0x481")]=r[a0_0x5592("0x481")],t[a0_0x5592("0x1c1")]=r["height"],t["getContext"]("2d")[a0_0x5592("0x6fe")](r,0,0,r["width"],r[a0_0x5592("0x1c1")]);var e=t["toDataURL"](a0_0x5592("0x258"));FBInstant[a0_0x5592("0x19f")]({intent:a0_0x5592("0x83d"),image:e,text:a0_0x5592("0x61a"),data:{myReplayData:a0_0x5592("0x7a5")}})["then"](function(){null!=a&&a()})[a0_0x5592("0xb15")](function(t){console[a0_0x5592("0xad6")](a0_0x5592("0x772")),console[a0_0x5592("0xad6")](t),null!=i&&i()})};break;case n[a0_0x5592("0x848")]:var r;(r=document[a0_0x5592("0x700")](a0_0x5592("0x341")))[a0_0x5592("0x5a2")]=a0_0x5592("0xa4d"),r[a0_0x5592("0x69a")]=a0_0x5592("0x82d"),r[a0_0x5592("0x90")]=function(){var t=document[a0_0x5592("0x700")](a0_0x5592("0x142"));t[a0_0x5592("0x481")]=r[a0_0x5592("0x481")],t[a0_0x5592("0x1c1")]=r[a0_0x5592("0x1c1")],t[a0_0x5592("0x3a1")]("2d")[a0_0x5592("0x6fe")](r,0,0,r[a0_0x5592("0x481")],r[a0_0x5592("0x1c1")]);t[a0_0x5592("0x948")](a0_0x5592("0x258"));null!=a&&a()}}}[a0_0x5592("0x884")](t,e,a,i){switch(C["gameSDKName"]){case n[a0_0x5592("0x33e")]:if(null==FBInstant[a0_0x5592("0x1b5")]["getID"]())return void(null!=i&&i());console[a0_0x5592("0xad6")](a0_0x5592("0x637")),(r=new vt)[a0_0x5592("0x654")](t),r[a0_0x5592("0xaf3")]=function(t){console[a0_0x5592("0xad6")]("邀请指定玩家图片加载完成，调用FBInstant.updateAsync方法"),FBInstant[a0_0x5592("0x858")]({action:a0_0x5592("0x146"),cta:a0_0x5592("0x7a9"),template:a0_0x5592("0xc7"),image:t,text:a0_0x5592("0x75"),data:{},strategy:"LAST",notification:a0_0x5592("0x4bd")})[a0_0x5592("0x284")](function(){null!=e&&(console[a0_0x5592("0xad6")](a0_0x5592("0x694")),e())})[a0_0x5592("0xb15")](t=>{this[a0_0x5592("0x9b")](a,i,t,a0_0x5592("0x2b7"))})};break;case n[a0_0x5592("0x848")]:var r;null!=e&&e(),(r=new vt)[a0_0x5592("0x654")](t),r[a0_0x5592("0xaf3")]=function(t){var e=new Image;e[a0_0x5592("0x5a2")]="anonymous",e["src"]=t,e["onload"]=function(){console[a0_0x5592("0xad6")](t)}}}}["appointFaceBookFriendAndUpdateAsync"](t,e,a,i){switch(C[a0_0x5592("0x10")]){case n["faceBookSDK"]:console[a0_0x5592("0xad6")](a0_0x5592("0x991")+t[a0_0x5592("0x37")]),FBInstant[a0_0x5592("0x1b5")][a0_0x5592("0x497")](t[a0_0x5592("0x37")])[a0_0x5592("0x284")](()=>{this["appointFaceBookFriendOnlyUpdateAsync"](t,e,a,i)})[a0_0x5592("0xb15")](t=>{this[a0_0x5592("0x9b")](a,i,t,"邀请指定好友")});break;case n[a0_0x5592("0x848")]:null!=e&&e();var r=new vt;r[a0_0x5592("0x654")](t),r["drawCompleteFun"]=function(t){var e=new Image;e["crossOrigin"]=a0_0x5592("0xa4d"),e[a0_0x5592("0x69a")]=t,e[a0_0x5592("0x90")]=function(){console[a0_0x5592("0xad6")](t)}}}}[a0_0x5592("0x9b")](t,e,a,i){console[a0_0x5592("0xad6")](a),null!=a?(console["log"](i+"失败"),a0_0x5592("0x49d")==a[a0_0x5592("0x22b")]?null!=t&&t():null!=e&&e()):(console[a0_0x5592("0xad6")](i+"失败"),null!=e&&e())}}class vt{[a0_0x5592("0x85a")](e){const a=e["pngData"];for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const i=a[t],r=new Image;i[a0_0x5592("0x91e")]=r,r[a0_0x5592("0x5a2")]=a0_0x5592("0xa4d"),r["imgHeight"]=i[a0_0x5592("0x2cf")],r[a0_0x5592("0x70b")]=i[a0_0x5592("0x70b")],r[a0_0x5592("0x69a")]=i["url"],r[a0_0x5592("0x33")]=!1,r[a0_0x5592("0x90")]=()=>{r["width"]=r["imgWidth"],r[a0_0x5592("0x1c1")]=r["imgHeight"],r[a0_0x5592("0x33")]=!0,this[a0_0x5592("0x6fe")](e)}}}["drawImage"](e){for(let t=0;t<e[a0_0x5592("0x3fc")]["length"];t++){if(0==e[a0_0x5592("0x3fc")][t][a0_0x5592("0x91e")][a0_0x5592("0x33")])return}const t=document[a0_0x5592("0x700")](a0_0x5592("0x142"));t[a0_0x5592("0x481")]=e[a0_0x5592("0x481")],t[a0_0x5592("0x1c1")]=e[a0_0x5592("0x1c1")];const a=t["getContext"]("2d");for(let t=0;t<e[a0_0x5592("0x3fc")]["length"];t++){const r=e["pngData"][t];a[a0_0x5592("0x6fe")](r[a0_0x5592("0x91e")],r[a0_0x5592("0xb13")],r[a0_0x5592("0x9a")],r[a0_0x5592("0x91e")][a0_0x5592("0x481")],r[a0_0x5592("0x91e")][a0_0x5592("0x1c1")])}for(let t=0;t<e[a0_0x5592("0x2ac")][a0_0x5592("0xb0e")];t++){const s=e["fontData"][t];a[a0_0x5592("0xafb")]=s[a0_0x5592("0xafb")],a["lineWidth"]=s[a0_0x5592("0x727")],a[a0_0x5592("0x66e")]=s[a0_0x5592("0x66e")],a[a0_0x5592("0x649")]=s[a0_0x5592("0x649")],a[a0_0x5592("0x147")]=s[a0_0x5592("0x147")],a["strokeText"](s[a0_0x5592("0xa1c")][a0_0x5592("0x5a8")](),s[a0_0x5592("0xb13")],s[a0_0x5592("0x9a")]),a[a0_0x5592("0x891")](s[a0_0x5592("0xa1c")]["toString"](),s["posX"],s[a0_0x5592("0x9a")])}const i=t["toDataURL"]("image/png");null!=this[a0_0x5592("0xaf3")]&&this[a0_0x5592("0xaf3")](i)}[a0_0x5592("0x654")](t){this[a0_0x5592("0x85a")](t)}[a0_0x5592("0xaf3")](t){}}class yt{constructor(){this[a0_0x5592("0x37")]="0",this[a0_0x5592("0x901")]="",this[a0_0x5592("0x347")]=a0_0x5592("0x8eb")}}class Tt{constructor(){this[a0_0x5592("0x475")]=null,this[a0_0x5592("0x654")]()}[a0_0x5592("0x654")](){1!=this[a0_0x5592("0x2f7")]&&(this[a0_0x5592("0x2f7")]=!0,this[a0_0x5592("0x82e")]=!0,this[a0_0x5592("0x1d5")]=new Object,this[a0_0x5592("0x15")]=new yt,this[a0_0x5592("0x68d")]=new pt,this[a0_0x5592("0x205")]=new gt,this["faceBookAdvertisement"]=new ft,this[a0_0x5592("0x9c4")]["initialize"](),this["faceBookPayment"]=new mt)}[a0_0x5592("0x867")](){return 1==Laya[a0_0x5592("0x26a")][a0_0x5592("0x53a")]}[a0_0x5592("0x8cd")](t){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:console[a0_0x5592("0xad6")](a0_0x5592("0x52d")),this[a0_0x5592("0x15")]["playerID"]=FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x9ab")](),this[a0_0x5592("0x15")][a0_0x5592("0xafc")]=function(){return null},console[a0_0x5592("0xad6")](a0_0x5592("0x81f")+this["sdkInfo"][a0_0x5592("0x37")]),this[a0_0x5592("0x3a4")](t);break;case n[a0_0x5592("0x848")]:this[a0_0x5592("0x3a4")](t)}}[a0_0x5592("0x3a4")](s){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:FBInstant[a0_0x5592("0x8ca")]["getDataAsync"](C[a0_0x5592("0xb2d")])[a0_0x5592("0x284")](function(t){if(console[a0_0x5592("0xad6")](a0_0x5592("0x843")),console[a0_0x5592("0xad6")](t),null!=t){var e=0;for(var a in t)e++;0==e&&(t=null)}if(null==t)C[a0_0x5592("0x7e8")]=!0,s(null);else if(1==C[a0_0x5592("0xb2d")][a0_0x5592("0xb0e")])s(t[C[a0_0x5592("0xb2d")][0]]);else{for(var i=new Object,r=0;r<C[a0_0x5592("0xb2d")]["length"];r++)i[C[a0_0x5592("0xb2d")][r]]=t[C[a0_0x5592("0xb2d")][r]];s(i)}});break;case n[a0_0x5592("0x848")]:var t=Laya[a0_0x5592("0x13e")][a0_0x5592("0x76b")](C[a0_0x5592("0x69b")]);t&&(t=t[C[a0_0x5592("0xb2d")][0]]),console[a0_0x5592("0xad6")](a0_0x5592("0x563")),console["log"](t),s(null==t?null:t)}}[a0_0x5592("0x4bf")](){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:FBInstant["player"]["canSubscribeBotAsync"]()["then"](function(t){t&&FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x4bf")]()[a0_0x5592("0x284")](function(){})[a0_0x5592("0xb15")](function(t){console[a0_0x5592("0xad6")]("请求玩家订阅游戏机器人err: ",t)})})[a0_0x5592("0xb15")](t=>{console[a0_0x5592("0xad6")](a0_0x5592("0xa52"),t)})}}["saveUserData"](t,e){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x2f9")](t)["then"](function(){console[a0_0x5592("0xad6")]("游戏存档成功！"),console["log"](t),null!=e&&e()});break;case n["faceBookSDKTest"]:try{Laya["LocalStorage"][a0_0x5592("0x8e4")](C[a0_0x5592("0x69b")],t),console[a0_0x5592("0xad6")](a0_0x5592("0x41f"))}catch(t){}null!=e&&e()}}[a0_0x5592("0x8f3")](e){console[a0_0x5592("0xad6")]("--startGame--",e);try{window["ggmgr"][a0_0x5592("0x3a8")]()}catch(t){}window[a0_0x5592("0xaae")][a0_0x5592("0x958")]();switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:var a=this;console[a0_0x5592("0xad6")](a0_0x5592("0x40f")+this[a0_0x5592("0x82e")]),this["getFriendsList"](),1==this[a0_0x5592("0x82e")]?(this[a0_0x5592("0x82e")]=!1,FBInstant[a0_0x5592("0x75d")]()["then"](function(){const t=FBInstant[a0_0x5592("0x1ff")]()[a0_0x5592("0x1e2")]("|");console[a0_0x5592("0xad6")](a0_0x5592("0xe4"),t),a[a0_0x5592("0x15")][a0_0x5592("0x37")]=FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x9ab")](),a[a0_0x5592("0x15")][a0_0x5592("0x901")]=FBInstant[a0_0x5592("0x8ca")]["getName"](),a["sdkInfo"]["photo"]=FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x816")](),a["sdkInfo"]["entryPointData"]=FBInstant[a0_0x5592("0x898")](),console[a0_0x5592("0xad6")](a0_0x5592("0xca")+a["sdkInfo"]["playerName"]+a0_0x5592("0x9f8")+a[a0_0x5592("0x15")][a0_0x5592("0x347")]+a0_0x5592("0x134")+a[a0_0x5592("0x15")][a0_0x5592("0x37")]),a[a0_0x5592("0x1d5")]=FBInstant[a0_0x5592("0x726")](),console[a0_0x5592("0xad6")](a["sdkPort"]),a["faceBookPayment"][a0_0x5592("0x3e1")](),null!=e&&e()}),this[a0_0x5592("0x293")]=e,setTimeout(this[a0_0x5592("0x8d6")]["bind"](this),100)):null!=e&&(console[a0_0x5592("0xad6")](a0_0x5592("0x8a1")),e());break;case n[a0_0x5592("0x848")]:1==this[a0_0x5592("0x82e")]?(this[a0_0x5592("0x1a3")][a0_0x5592("0x3e1")](),this[a0_0x5592("0x82e")]=!1,this["sdkInfo"][a0_0x5592("0x347")]="",null!=e&&e()):(null!=e&&e(),ADManageLaya[a0_0x5592("0x477")]()[a0_0x5592("0x963")](!![]))}}["_checkStartGameEnd"](){null!=FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x78c")]()?(this["sdkInfo"][a0_0x5592("0x37")]=FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x9ab")](),this[a0_0x5592("0x15")][a0_0x5592("0x901")]=FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x78c")](),this[a0_0x5592("0x15")][a0_0x5592("0x347")]=FBInstant[a0_0x5592("0x8ca")]["getPhoto"](),this["sdkInfo"][a0_0x5592("0x88a")]=FBInstant["getEntryPointData"](),console[a0_0x5592("0xad6")]("FBInstant.startGameAsync回调。玩家 name="+this["sdkInfo"]["playerName"]+a0_0x5592("0x9f8")+this["sdkInfo"][a0_0x5592("0x347")]),this[a0_0x5592("0x1d5")]=FBInstant[a0_0x5592("0x726")](),console[a0_0x5592("0xad6")](this["sdkPort"]),this["faceBookPayment"][a0_0x5592("0x3e1")](),null!=this[a0_0x5592("0x293")]&&this[a0_0x5592("0x293")]()):setTimeout(this[a0_0x5592("0x8d6")],100)}["getFriendsList"](){if(this["friends"])return this[a0_0x5592("0x475")]["concat"]();switch(this[a0_0x5592("0x475")]=[],C[a0_0x5592("0x10")]){case n["faceBookSDK"]:FBInstant["player"]["getConnectedPlayersAsync"]()["then"](i=>{for(let a=0;a<i["length"];a++){let t=i[a],e={};e[a0_0x5592("0x749")]=t[a0_0x5592("0x78c")](),e[a0_0x5592("0x37")]=t[a0_0x5592("0x9ab")](),e[a0_0x5592("0x347")]=t[a0_0x5592("0x816")](),this[a0_0x5592("0x475")][a0_0x5592("0x626")](e)}})[a0_0x5592("0xb15")](t=>{console[a0_0x5592("0xad6")](a0_0x5592("0x7c0")),console[a0_0x5592("0xad6")](t)});break;case n[a0_0x5592("0x848")]:}}[a0_0x5592("0x3d4")](t){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:FBInstant[a0_0x5592("0x3d4")](t);break;case n[a0_0x5592("0x848")]:}}["logEvent"](t,e,a){switch(console[a0_0x5592("0xad6")]("打点"+t),C[a0_0x5592("0x10")]){case n["faceBookSDK"]:FBInstant[a0_0x5592("0x57a")](t,e,a);break;case n[a0_0x5592("0x848")]:}}[a0_0x5592("0x29")](t){console["log"]("打点"+t);var e=new Object;switch(e[t]=t,C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:FBInstant[a0_0x5592("0x57a")](t,1,e);break;case n[a0_0x5592("0x848")]:}}[a0_0x5592("0x63b")](t){switch(C[a0_0x5592("0x10")]){case n["faceBookSDK"]:FBInstant["switchGameAsync"](t)["then"](function(){console[a0_0x5592("0xad6")](a0_0x5592("0x819"))})[a0_0x5592("0xb15")](function(t){null!=t&&(console[a0_0x5592("0xad6")]("跳转其他游戏失败，失败编码为:"),console[a0_0x5592("0xad6")](t))});break;case n[a0_0x5592("0x848")]:console[a0_0x5592("0xad6")]("跳转成功。")}}[a0_0x5592("0x775")](t){switch(C[a0_0x5592("0x10")]){case n[a0_0x5592("0x33e")]:return null!=t&&t(null),null;case n[a0_0x5592("0x33e")]:var e=FBInstant[a0_0x5592("0x898")]();return null!=t&&t(e),e}}[a0_0x5592("0xaa6")](e){switch(C["gameSDKName"]){case n[a0_0x5592("0x848")]:console[a0_0x5592("0xad6")](a0_0x5592("0x31")),null!=e&&e(null);break;case n[a0_0x5592("0x33e")]:console[a0_0x5592("0xad6")](a0_0x5592("0x6fd")),FBInstant[a0_0x5592("0x8ca")]["getDataAsync"]([a0_0x5592("0x520")])["then"](function(t){console["log"]("获取到的data:"),console[a0_0x5592("0xad6")](t),null!=t&&null!=t[a0_0x5592("0x520")]&&1==t[a0_0x5592("0x520")]||FBInstant[a0_0x5592("0x319")]()[a0_0x5592("0x284")](function(t){console[a0_0x5592("0xad6")](a0_0x5592("0x678")+t),t&&FBInstant["createShortcutAsync"]()[a0_0x5592("0x284")](function(){FBInstant[a0_0x5592("0x8ca")][a0_0x5592("0x2f9")]({shortcut:1})[a0_0x5592("0x284")](function(){}),console[a0_0x5592("0xad6")]("创建桌面快捷方式成功。"),null!=e&&e(null)})[a0_0x5592("0xb15")](function(t){console[a0_0x5592("0xad6")](a0_0x5592("0x5c2")),console[a0_0x5592("0xad6")](t)})})["catch"](function(t){console[a0_0x5592("0xad6")](a0_0x5592("0x9b3")),console[a0_0x5592("0xad6")](t)})})[a0_0x5592("0xb15")](function(t){console["log"](a0_0x5592("0x684")),console[a0_0x5592("0xad6")](t)})}}[a0_0x5592("0x3ba")](t){console[a0_0x5592("0xad6")](a0_0x5592("0x652"),t),C[a0_0x5592("0x10")]==n[a0_0x5592("0x33e")]&&FBInstant[a0_0x5592("0xa3")](t)}}var P,B,F;!function(t){t[t["READY"]=0]=a0_0x5592("0x61e"),t[t[a0_0x5592("0xa5")]=1]=a0_0x5592("0xa5"),t[t["PAUSE"]=2]=a0_0x5592("0x953"),t[t["END"]=3]=a0_0x5592("0x81a")}(P||(P={})),function(t){t[a0_0x5592("0x87e")]=a0_0x5592("0x1e8"),t[a0_0x5592("0x400")]=a0_0x5592("0x514"),t["FIRE"]=a0_0x5592("0x6a0"),t[a0_0x5592("0x2c7")]="ice",t[a0_0x5592("0x6b6")]=a0_0x5592("0x26b")}(B||(B={})),function(t){t[a0_0x5592("0x51c")]="close_pause_dialog",t["GameStateChange"]="gamestate_change",t[a0_0x5592("0x8c7")]="battle_rate_supply",t[a0_0x5592("0x5c6")]=a0_0x5592("0xeb"),t[a0_0x5592("0x286")]=a0_0x5592("0x331"),t[a0_0x5592("0x9ef")]=a0_0x5592("0x2a3"),t[a0_0x5592("0x4a6")]=a0_0x5592("0x14a"),t["CoinInPlayer"]=a0_0x5592("0x463"),t[a0_0x5592("0x42f")]="game_over",t[a0_0x5592("0x8e2")]=a0_0x5592("0x67"),t[a0_0x5592("0xaad")]=a0_0x5592("0x38b"),t[a0_0x5592("0x4cb")]=a0_0x5592("0x4a3"),t[a0_0x5592("0x838")]=a0_0x5592("0x3ee"),t[a0_0x5592("0x707")]=a0_0x5592("0x3e9"),t[a0_0x5592("0x3f")]=a0_0x5592("0x834"),t[a0_0x5592("0x175")]=a0_0x5592("0x464"),t[a0_0x5592("0x71")]=a0_0x5592("0x171"),t["LevelEnemyEnd"]="make_level_enemy_end",t[a0_0x5592("0x123")]=a0_0x5592("0x7ca"),t["PlayerHP"]="player_hp",t[a0_0x5592("0x19c")]=a0_0x5592("0x691"),t[a0_0x5592("0x77e")]=a0_0x5592("0x30b"),t[a0_0x5592("0x2ec")]=a0_0x5592("0x31e"),t[a0_0x5592("0x4a5")]=a0_0x5592("0x241"),t[a0_0x5592("0x243")]=a0_0x5592("0x1f5"),t[a0_0x5592("0x8f")]=a0_0x5592("0x25a"),t[a0_0x5592("0xa79")]=a0_0x5592("0x496"),t[a0_0x5592("0x557")]="player_1000_baseskill",t[a0_0x5592("0x6b3")]=a0_0x5592("0x820"),t["BaseSkill1a"]="player_1002_baseskill",t[a0_0x5592("0x7f6")]="player_1003_baseskill",t[a0_0x5592("0x6a")]=a0_0x5592("0xa7"),t[a0_0x5592("0x7bc")]=a0_0x5592("0x367"),t[a0_0x5592("0x7e")]=a0_0x5592("0x9d3"),t["BaseSkill3"]="player_1013_baseskill",t[a0_0x5592("0x1a5")]=a0_0x5592("0x976"),t[a0_0x5592("0xb7")]=a0_0x5592("0xc"),t[a0_0x5592("0x206")]=a0_0x5592("0x50d"),t[a0_0x5592("0x64f")]="player_1016_baseskill",t[a0_0x5592("0x6e4")]="player_1017_baseskill",t[a0_0x5592("0x396")]=a0_0x5592("0x96f"),t[a0_0x5592("0x86f")]="player_1020_baseskill",t[a0_0x5592("0x484")]=a0_0x5592("0x94b"),t[a0_0x5592("0x32f")]=a0_0x5592("0x5da"),t["BaseSkill7"]="player_1024_baseskill",t[a0_0x5592("0x3ca")]=a0_0x5592("0x2d"),t["Shield"]="player_1025_baseskill",t["TimeShield"]=a0_0x5592("0x374"),t["DieShot"]="player_1028_baseskill",t[a0_0x5592("0x4f7")]=a0_0x5592("0xa7d"),t["BaseSkill13"]=a0_0x5592("0x2f2"),t["BaseSkill14"]="player_1031_baseskill",t["BaseSkill15"]=a0_0x5592("0x7ba"),t[a0_0x5592("0x677")]=a0_0x5592("0xb12"),t[a0_0x5592("0x2a9")]=a0_0x5592("0x6c5"),t["BulSkill1"]=a0_0x5592("0x80b"),t[a0_0x5592("0x21c")]=a0_0x5592("0x530"),t[a0_0x5592("0x430")]="player_2005_bulskill",t[a0_0x5592("0x91d")]=a0_0x5592("0x168"),t["BulSkill4"]=a0_0x5592("0x985"),t[a0_0x5592("0x598")]=a0_0x5592("0x33d"),t[a0_0x5592("0x469")]="player_2006_bulskill",t["BulSkill6"]="player_2007_bulskill",t[a0_0x5592("0x88d")]=a0_0x5592("0x8b0"),t[a0_0x5592("0x3b5")]=a0_0x5592("0x23c"),t[a0_0x5592("0x251")]=a0_0x5592("0x18d"),t["BulSkill9"]="player_2011_bulskill",t[a0_0x5592("0x83f")]=a0_0x5592("0x851"),t[a0_0x5592("0x300")]=a0_0x5592("0x916"),t[a0_0x5592("0x5ea")]="player_2013_bulskill",t["WingSkill1"]=a0_0x5592("0x7e4"),t["WingSkill2"]=a0_0x5592("0x565"),t[a0_0x5592("0xfe")]="player_3003_wingskill",t[a0_0x5592("0x177")]=a0_0x5592("0x1b0"),t[a0_0x5592("0x9dc")]="player_3001_wingskill",t["WingSkill6"]=a0_0x5592("0x6e0"),t["RobSkill1"]=a0_0x5592("0x983"),t[a0_0x5592("0x28c")]=a0_0x5592("0x5d3"),t["RobSkill3"]=a0_0x5592("0x12b"),t["Sup_HP"]="player_1004_supply",t["Sup_Att"]="player_1008_supply",t[a0_0x5592("0x719")]=a0_0x5592("0x8fe"),t[a0_0x5592("0x60b")]=a0_0x5592("0x386"),t[a0_0x5592("0x8")]=a0_0x5592("0x3e2"),t["Sup_Crit"]=a0_0x5592("0x1a7"),t[a0_0x5592("0x780")]=a0_0x5592("0x8fd"),t[a0_0x5592("0x62")]=a0_0x5592("0x39e"),t[a0_0x5592("0x5c3")]=a0_0x5592("0xb24"),t[a0_0x5592("0x560")]=a0_0x5592("0x2b8"),t[a0_0x5592("0x7fb")]=a0_0x5592("0xa3b")}(F||(F={}));const Et=[];var V;window["__PoolSigns__"]=Et,function(t){t[t["HP1"]=1001]=a0_0x5592("0xa8c"),t[t[a0_0x5592("0x406")]=1005]=a0_0x5592("0x406"),t[t[a0_0x5592("0xb25")]=1013]=a0_0x5592("0xb25"),t[t["Speed"]=1009]=a0_0x5592("0xb19"),t[t[a0_0x5592("0xa74")]=1016]="Crit",t[t[a0_0x5592("0x288")]=1020]=a0_0x5592("0x288"),t[t[a0_0x5592("0x90a")]=1024]="MainCross",t[t[a0_0x5592("0x122")]=1023]=a0_0x5592("0x122"),t[t[a0_0x5592("0x887")]=1025]=a0_0x5592("0x887"),t[t[a0_0x5592("0x109")]=1027]="TimeShield",t[t[a0_0x5592("0x303")]=1028]=a0_0x5592("0x303"),t[t["Back"]=1029]=a0_0x5592("0xb1a"),t[t[a0_0x5592("0x2eb")]=1030]=a0_0x5592("0x2eb"),t[t[a0_0x5592("0x161")]=1031]=a0_0x5592("0x161"),t[t[a0_0x5592("0x8a2")]=1032]=a0_0x5592("0x8a2"),t[t["SuckBlood"]=1033]=a0_0x5592("0x677"),t[t[a0_0x5592("0x2a9")]=1034]=a0_0x5592("0x2a9"),t[t["Shotgun"]=2001]=a0_0x5592("0x6b9"),t[t[a0_0x5592("0x929")]=2002]=a0_0x5592("0x929"),t[t["Laser"]=2003]=a0_0x5592("0xad5"),t[t["SwimShell"]=2004]=a0_0x5592("0xa4b"),t[t[a0_0x5592("0x863")]=2005]="ShockWave",t[t[a0_0x5592("0x943")]=2006]=a0_0x5592("0x943"),t[t[a0_0x5592("0x120")]=2007]="RotatePoison",t[t[a0_0x5592("0x907")]=2008]=a0_0x5592("0x907"),t[t["RotateFire"]=2009]="RotateFire",t[t[a0_0x5592("0x26c")]=2010]=a0_0x5592("0x26c"),t[t[a0_0x5592("0x714")]=2011]="Magnet",t[t[a0_0x5592("0x380")]=2012]=a0_0x5592("0x380"),t[t["Brid"]=2013]=a0_0x5592("0x6ba"),t[t["ShotWing"]=3001]=a0_0x5592("0x842"),t[t[a0_0x5592("0xa63")]=3002]=a0_0x5592("0xa63"),t[t[a0_0x5592("0x296")]=3003]=a0_0x5592("0x296"),t[t[a0_0x5592("0x894")]=3004]=a0_0x5592("0x894"),t[t[a0_0x5592("0x740")]=3005]=a0_0x5592("0x740"),t[t[a0_0x5592("0x8e")]=3006]=a0_0x5592("0x8e"),t[t[a0_0x5592("0x46d")]=4001]=a0_0x5592("0x46d"),t[t[a0_0x5592("0x7f0")]=4002]="LaserRobot",t[t[a0_0x5592("0x431")]=4003]=a0_0x5592("0x431"),t[t["Sup_HP"]=1004]=a0_0x5592("0x609"),t[t[a0_0x5592("0x1ae")]=1008]=a0_0x5592("0x1ae"),t[t["Sup_Speed"]=1012]=a0_0x5592("0x719"),t[t["Sup_HPRec1"]=1014]=a0_0x5592("0x60b"),t[t[a0_0x5592("0x8")]=1015]=a0_0x5592("0x8"),t[t[a0_0x5592("0x502")]=1019]=a0_0x5592("0x502")}(V||(V={}));const bt={1e3:a0_0x5592("0x29d"),1001:"battle/skillicon/1001.png",1002:a0_0x5592("0x638"),1003:a0_0x5592("0x638"),1004:a0_0x5592("0xb33"),1005:"battle/skillicon/1005.png",1006:a0_0x5592("0x4a8"),1007:a0_0x5592("0x4a8"),1008:a0_0x5592("0x693"),1009:"battle/skillicon/1009.png",1010:a0_0x5592("0x986"),1011:"battle/skillicon/1009.png",1012:a0_0x5592("0x9a4"),1013:a0_0x5592("0x265"),1014:"battle/skillicon/1013.png",1015:a0_0x5592("0x265"),1016:a0_0x5592("0xee"),1017:a0_0x5592("0xee"),1018:a0_0x5592("0xee"),1019:a0_0x5592("0xb26"),1020:a0_0x5592("0x506"),1021:"battle/skillicon/1020.png",1022:a0_0x5592("0x506"),1023:a0_0x5592("0x393"),1024:a0_0x5592("0x803"),1025:a0_0x5592("0x91c"),1026:a0_0x5592("0x746"),1027:a0_0x5592("0x2cc"),1028:a0_0x5592("0x256"),1029:a0_0x5592("0x76d"),1030:"battle/skillicon/1030.png",1031:a0_0x5592("0x57c"),1032:a0_0x5592("0x5e7"),1033:"battle/skillicon/1033.png",1034:a0_0x5592("0x542"),2001:"battle/skillicon/2001.png",2002:a0_0x5592("0xb1b"),2003:"battle/skillicon/2003.png",2004:"battle/skillicon/2004.png",2005:a0_0x5592("0x96a"),2006:a0_0x5592("0x1a8"),2007:"battle/skillicon/2007.png",2008:a0_0x5592("0x872"),2009:a0_0x5592("0x55"),2010:"battle/skillicon/2010.png",2011:a0_0x5592("0x48d"),2012:"battle/skillicon/2012.png",2013:a0_0x5592("0x59"),3001:a0_0x5592("0x8c4"),3002:a0_0x5592("0x8db"),3003:a0_0x5592("0xbf"),3004:a0_0x5592("0x9df"),3005:"battle/skillicon/3005.png",3006:a0_0x5592("0xf8"),4001:a0_0x5592("0xa06"),4002:a0_0x5592("0x298"),4003:a0_0x5592("0x3d8")},St={1e3:{path:a0_0x5592("0xa45"),ppos:[73,139],pscale:.25},1001:{path:a0_0x5592("0x881"),ppos:[73,120],pscale:.25},1002:{path:a0_0x5592("0x881"),ppos:[73,120],pscale:.25},1003:{path:a0_0x5592("0x881"),ppos:[73,120],pscale:.25},1004:{path:a0_0x5592("0x881"),ppos:[73,120],pscale:.25},1005:{path:a0_0x5592("0x3cc"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1006:{path:a0_0x5592("0x3cc"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1007:{path:a0_0x5592("0x3cc"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1008:{path:a0_0x5592("0x3cc"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1009:{path:"battle/skillsk/1009/attackspeed.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1010:{path:"battle/skillsk/1009/attackspeed.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1011:{path:a0_0x5592("0x89d"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1012:{path:a0_0x5592("0x89d"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1013:{path:"battle/skillsk/1013/lifeback.sk",ppos:[73,113],pscale:.25},1014:{path:a0_0x5592("0x7a7"),ppos:[73,113],pscale:.25},1015:{path:a0_0x5592("0x7a7"),ppos:[73,113],pscale:.25},1016:{path:a0_0x5592("0x8d7"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1017:{path:a0_0x5592("0x8d7"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1018:{path:a0_0x5592("0x8d7"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1019:{path:a0_0x5592("0x8d7"),ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1020:{path:a0_0x5592("0x4aa"),ani:0},1021:{path:a0_0x5592("0x4aa"),ani:1},1022:{path:"battle/skillsk/1020/",ani:2},1024:{path:a0_0x5592("0x9e7"),ppos:[73,166],pscale:.25},1025:{path:a0_0x5592("0x281"),ppos:[73,141],pscale:.25},1027:{path:a0_0x5592("0x230"),ppos:[73,139],pscale:.25},1028:{path:a0_0x5592("0x191"),ppos:[73,166],pscale:.25},1029:{path:"battle/skillsk/1029/nirvana.sk"},1030:{path:a0_0x5592("0xf5"),ppos:[73,166],pscale:.25},1031:{path:a0_0x5592("0x829"),ppos:[73,166],pscale:.25},1032:{path:a0_0x5592("0x4c2"),ppos:[73,166],pscale:.25},1033:{path:a0_0x5592("0xa55"),ppos:[73,166],pscale:.25},1034:{path:a0_0x5592("0x926"),ppos:[73,166],pscale:.25},2001:{path:a0_0x5592("0x5b9"),ppos:[73,147],pscale:.25},2002:{path:a0_0x5592("0x672"),ppos:[73,155],pscale:.25},2003:{path:a0_0x5592("0x64d"),ppos:[73,153],pscale:.25},2004:{path:a0_0x5592("0x260"),ppos:[73,93],pscale:.25},2005:{path:a0_0x5592("0x8f6"),ppos:[75,141],pscale:.25},2006:{path:a0_0x5592("0xa3e"),ppos:[75,136],pscale:.25},2007:{path:a0_0x5592("0x618"),ppos:[73,97],pscale:.2},2008:{path:a0_0x5592("0x74b"),ppos:[73,97],pscale:.2},2009:{path:a0_0x5592("0x29b"),ppos:[73,97],pscale:.2},2010:{path:a0_0x5592("0x1c3"),ppos:[73,143],pscale:.25},2011:{path:a0_0x5592("0x150"),ppos:[73,97],pscale:.25},2012:{path:"battle/skillsk/2012/fireworkguided.sk",ppos:[73,140],pscale:.25},2013:{path:"battle/skillsk/2013/flyerguided.sk",ppos:[73,138],pscale:.25},3001:{path:a0_0x5592("0x885"),ppos:[73,138],pscale:.25},3002:{path:a0_0x5592("0x8cc"),ppos:[73,138],pscale:.25},3003:{path:a0_0x5592("0x572"),ppos:[73,138],pscale:.25},3004:{path:a0_0x5592("0x6c1"),ppos:[73,138],pscale:.25},3005:{path:a0_0x5592("0xb1f"),ppos:[73,138],pscale:.25},3006:{path:a0_0x5592("0x428"),ppos:[73,138],pscale:.25},4001:{path:a0_0x5592("0x5e9"),ppos:[73,166],pscale:.25},4002:{path:a0_0x5592("0x4b1"),ppos:[73,166],pscale:.25},4003:{path:"battle/skillsk/4003/shieldrobot.sk",ppos:[73,166],pscale:.25}},Ct={1:[[-20,0,20],[-50,-30,-10,10,30,50],[-80,-60,-40,-20,0,20,40,60,80],[-110,-90,-70,-50,-30,-10,10,30,50,70,90,110]],2:[[0],[-15,15],[-50,0,50],[-50,-15,15,50]],3:[[45,135,-135,-45],[40,50,130,140,-140,-130,-50,-40],[35,45,55,125,135,145,-145,-135,-125,-55,-45,-35],[30,40,50,60,120,130,140,150,-150,-140,-130,-120,-60,-50,-40,-30]],4:[[0],[-20,20],[-40,0,40],[-60,-20,20,60]],5:[[-10,10],[-30,30,-10,10],[-50,50,-30,30,-10,10],[-70,70,-50,50,-30,30,-10,10]],6:[[43,-43,65,-65,23,-23,0],[86,-86,110,-110,43,-43,65,-65,23,-23,0],[131,-131,156,-156,86,-86,110,-110,43,-43,65,-65,23,-23,0],[176,-176,201,-201,131,-131,156,-156,86,-86,110,-110,43,-43,65,-65,23,-23,0]]},Rt=[[{dx:-80,dy:60,v:-1},{dx:80,dy:60,v:1}],[{dx:-160,dy:60,v:-1},{dx:160,dy:60,v:1}],[{dx:-240,dy:60,v:-1},{dx:240,dy:60,v:1}]],p={2001:{self:{x:50,y:75},b1:[{x:-221,y:261},{x:221,y:261}],b2:[{x:-130,y:240},{x:130,y:240}],b3:[{x:-83,y:195},{x:83,y:195}]},2002:{b1:[{x:-178,y:181},{x:178,y:181}],b2:[{x:-100,y:141},{x:100,y:141}],b3:[{x:0,y:181}]},2003:{b1:[{x:-137,y:-148},{x:137,y:-148},{x:-197,y:151},{x:197,y:151}],b2:[{x:-137,y:-148},{x:137,y:-148},{x:-197,y:151},{x:197,y:151}],b3:[{x:-137,y:-148},{x:137,y:-148},{x:-197,y:151},{x:197,y:151}]},2004:{b3:[{x:-150,y:145},{x:150,y:145}]},2005:{b1:[{x:-91,y:51},{x:91,y:51}],b2:[{x:-164,y:90},{x:144,y:90}],b3:[{x:-50,y:91},{x:50,y:91}]},2006:{b3:[{x:-75,y:60},{x:75,y:60}]},3002:{self:{x:312,y:908}},1002:{self:{x:43.5,y:81},b1:[{x:0,y:0}]},1003:{b1:[{x:0,y:40}]},1004:{self:{x:65,y:70},b1:[{x:0,y:35}]},1005:{b1:[{x:0,y:0}]},1006:{self:{x:51.5,y:80},b1:[{x:0,y:0}]},1007:{b1:[{x:0,y:-50}]},1008:{b1:[{x:0,y:0}]},1009:{b1:[{x:0,y:20}]},1010:{b1:[{x:0,y:0}]},1011:{b1:[{x:-5,y:10}]},1012:{b1:[{x:0,y:0}]},1013:{b1:[{x:0,y:75}]},1014:{self:{x:43.5,y:83},b1:[{x:0,y:0}]},1015:{b1:[{x:0,y:0}]},1016:{b1:[{x:0,y:0}]},1017:{b1:[{x:0,y:0}]},1018:{b1:[{x:0,y:0}]},1019:{b1:[{x:0,y:0}]},1020:{b1:[{x:0,y:0}]},1021:{b1:[{x:0,y:0}]},1022:{b1:[{x:0,y:35}]},1023:{b1:[{x:0,y:110}]},1024:{b1:[{x:0,y:50}]},1025:{b1:[{x:0,y:0}]},1026:{b1:[{x:0,y:0}]},1027:{b1:[{x:0,y:0}]},1028:{b1:[{x:0,y:35}]},1029:{b1:[{x:0,y:55}]}};class W extends t{constructor(){super(),this[a0_0x5592("0x892")]=50,this[a0_0x5592("0x407")]=50,this[a0_0x5592("0x1f9")]=0,this["aabb"]=null,this["bid"]=null,this[a0_0x5592("0x5aa")]=[],W[a0_0x5592("0xa92")]++,this[a0_0x5592("0x639")]=W[a0_0x5592("0xa92")]}[a0_0x5592("0x880")](){this[a0_0x5592("0x5bb")]={x:0,y:0,width:this["width2"],height:this[a0_0x5592("0x407")]}}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x5aa")][a0_0x5592("0xb0e")]=0}[a0_0x5592("0x5b4")](){const t=this["owner"];t&&(this[a0_0x5592("0x5bb")]["x"]=t["x"]-this[a0_0x5592("0x892")]/2,this["aabb"]["y"]=t["y"]-this[a0_0x5592("0x407")]/2+this[a0_0x5592("0x1f9")])}}W[a0_0x5592("0xa92")]=0;class At extends t{constructor(){super(),this[a0_0x5592("0x5b6")]=.1,this[a0_0x5592("0x3ff")]=.1,this[a0_0x5592("0x9f4")]=.1,this[a0_0x5592("0xbb")]=null,this[a0_0x5592("0x4b8")]=null,this["bot1"]=null,this[a0_0x5592("0x11d")]=null,this[a0_0x5592("0xab2")]=null}[a0_0x5592("0x880")](){}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x3de")](){let t=Laya["timer"][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")];this[a0_0x5592("0xbb")]&&this["top2"]&&(this[a0_0x5592("0xbb")]["x"]>=this[a0_0x5592("0x3ff")]&&(this["top1"]["x"]=this["stax"]+(this["top1"]["x"]-this[a0_0x5592("0x3ff")])),this[a0_0x5592("0x4b8")]["x"]>=this["endx"]&&(this["top2"]["x"]=this[a0_0x5592("0x9f4")]+(this[a0_0x5592("0x4b8")]["x"]-this["endx"])),this[a0_0x5592("0xbb")]["x"]+=t,this["top2"]["x"]+=t),this[a0_0x5592("0x9be")]&&this[a0_0x5592("0x11d")]&&(this[a0_0x5592("0x9be")]["x"]<=this["stax"]&&(this[a0_0x5592("0x9be")]["x"]=this[a0_0x5592("0x3ff")]+(this[a0_0x5592("0x9be")]["x"]-this[a0_0x5592("0x9f4")])),this["bot2"]["x"]<=this[a0_0x5592("0x9f4")]&&(this[a0_0x5592("0x11d")]["x"]=this[a0_0x5592("0x3ff")]+(this[a0_0x5592("0x11d")]["x"]-this[a0_0x5592("0x9f4")])),this[a0_0x5592("0x9be")]["x"]-=t,this[a0_0x5592("0x11d")]["x"]-=t)}}class Lt extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x8a4")]=null,this["han1"]=null,this["han2"]=null,this[a0_0x5592("0x454")]=null,this[a0_0x5592("0x2b1")]=null,this[a0_0x5592("0x6ec")]=1e3,this[a0_0x5592("0x200")]=!1}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this["isClose"]=!1;const t=this["owner"],e=this["ins"];this[a0_0x5592("0x20")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x470")]()},this);const a=t[a0_0x5592("0xab9")]("s1"),i=t[a0_0x5592("0xab9")]("s2"),r=t[a0_0x5592("0xab9")](a0_0x5592("0x29a"));let s=e[a0_0x5592("0x4ca")]["supUnlock"]["concat"]();const n=e[a0_0x5592("0x4ca")];if(n[a0_0x5592("0x257")]>=n["hp"]){const x=s[a0_0x5592("0x779")](1014);x>-1&&s[a0_0x5592("0x3c8")](x,1);const c=s[a0_0x5592("0x779")](1015);c>-1&&s[a0_0x5592("0x3c8")](c,1)}const o=s[a0_0x5592("0xb0e")]-1,l=[];for(;l["length"]<2;){let t=Math["floor"](Math[a0_0x5592("0x2ee")]()*(o-0+1)+0);l[a0_0x5592("0x779")](t)<0&&l[a0_0x5592("0x626")](t)}let _=s[l[0]],h=s[l[1]];this[a0_0x5592("0xa5b")](a,_,0),this[a0_0x5592("0xa5b")](i,h,1),this[a0_0x5592("0x68")](a,()=>{this[a0_0x5592("0x804")]&&this[a0_0x5592("0x804")](),this["onCloseClick"]()},this),this["setClick"](i,()=>{this["han2"]&&this[a0_0x5592("0x940")](),this["onCloseClick"]()},this),a[a0_0x5592("0xa20")](0,0),i[a0_0x5592("0xa20")](0,0),r["y"]=-600,r["visible"]=!1,Laya["timer"][a0_0x5592("0x724")](200,this,()=>{r[a0_0x5592("0x143")]=!0,Laya[a0_0x5592("0x6eb")]["to"](r,{y:84},500,Laya["Ease"][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](a,{scaleX:1,scaleY:1},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")]),Laya["Tween"]["to"](i,{scaleX:1,scaleY:1},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")])})),C[a0_0x5592("0x965")][a0_0x5592("0x9c4")][a0_0x5592("0x41e")](()=>{},()=>{})})}[a0_0x5592("0xa5b")](t,e,a){const i=rt,r=t[a0_0x5592("0xab9")](a0_0x5592("0x749")),s=t[a0_0x5592("0xab9")](a0_0x5592("0x4db")),n=t["getChildByName"](a0_0x5592("0x601")),o=D[a0_0x5592("0x53d")][e];r[a0_0x5592("0x1e3")]=o[a0_0x5592("0x749")],s["text"]=o[a0_0x5592("0x73e")],n["skin"]=bt[o["id"]],a?this[a0_0x5592("0x940")]=()=>{R["event"](a0_0x5592("0x4e3")+o["id"]+a0_0x5592("0xb23"))}:this[a0_0x5592("0x804")]=()=>{R[a0_0x5592("0xcf")](a0_0x5592("0x4e3")+o["id"]+a0_0x5592("0xb23"))};const l=t[a0_0x5592("0x433")](0)[a0_0x5592("0xab9")](a0_0x5592("0x739")),_=t["getChildAt"](0)[a0_0x5592("0xab9")](a0_0x5592("0x184")),h=t["getChildAt"](0)[a0_0x5592("0xab9")](a0_0x5592("0x92a")),x=St[e];x?(_["visible"]=h["visible"]=!1,l[a0_0x5592("0x6e9")](x[a0_0x5592("0x167")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{n[a0_0x5592("0x143")]=!1,l[a0_0x5592("0x27")]&&(l[a0_0x5592("0x7c2")](x[a0_0x5592("0xa86")]||.85),l[a0_0x5592("0x590")](x[a0_0x5592("0x87c")]||0,!0)),_["visible"]=h[a0_0x5592("0x143")]=!0})),l[a0_0x5592("0x143")]=!0,x[a0_0x5592("0x6f7")]?l[a0_0x5592("0x6f7")](x["pos"][0],x[a0_0x5592("0x6f7")][1]):l[a0_0x5592("0x6f7")](73,190),x["ppos"]&&(_[a0_0x5592("0x8fa")]=i[this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")]["id"]],_[a0_0x5592("0x6f7")](x[a0_0x5592("0x787")][0],x["ppos"][1]),_["scale"](x[a0_0x5592("0x659")],x[a0_0x5592("0x659")])),x[a0_0x5592("0x449")]&&(h["skin"]=i[this["ins"]["playerData"]["id"]],h[a0_0x5592("0x6f7")](x[a0_0x5592("0x449")][0],x[a0_0x5592("0x449")][1]),h["scale"](x[a0_0x5592("0x659")],x["pscale"]))):(l["visible"]=!1,_[a0_0x5592("0x143")]=!1,h[a0_0x5592("0x143")]=!1,n["visible"]=!0)}[a0_0x5592("0x470")](){this[a0_0x5592("0x8a0")];this[a0_0x5592("0x6a6")](this,()=>{const t=this[a0_0x5592("0x8a4")],a=this[a0_0x5592("0x2b1")];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](a,{y:0-a["height"]},this[a0_0x5592("0x6ec")],Laya["Ease"][a0_0x5592("0x221")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0x454")]&&!this[a0_0x5592("0x200")]&&(this[a0_0x5592("0x200")]=!0,this[a0_0x5592("0x454")]()),t["eneBulNode"]["alpha"]=1,t[a0_0x5592("0x1af")]["alpha"]=1,t[a0_0x5592("0x1a9")][a0_0x5592("0x14")]=1,t[a0_0x5592("0xa7e")][a0_0x5592("0x14")]=1,t[a0_0x5592("0x23a")][a0_0x5592("0x14")]=1,t[a0_0x5592("0xa88")][a0_0x5592("0xab9")]("coins")["active"]=!0;const e=t[a0_0x5592("0x587")];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){e[t]["v3"][a0_0x5592("0x6b7")]=!0}a[a0_0x5592("0xaa4")]()}))})})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),Laya["timer"]["clearAll"](this)}["onUpdate"](){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")],P[a0_0x5592("0xa5")]}}class It extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x739")]=null,this[a0_0x5592("0x454")]=null,this[a0_0x5592("0x2e2")]=null,this[a0_0x5592("0x617")]=!1}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const a=this[a0_0x5592("0x8a0")],t=this["ins"];this[a0_0x5592("0x617")]=!1;const i=1e3*(this[a0_0x5592("0x2e2")][a0_0x5592("0x5b6")]||1);Laya[a0_0x5592("0x6eb")]["to"](a,{y:640},i,Laya["Ease"]["backOut"],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0x877")][a0_0x5592("0x862")],t[a0_0x5592("0x925")],t=>{const e=t[a0_0x5592("0x751")](Lt);e["cloHan"]=this[a0_0x5592("0x454")],e[a0_0x5592("0x2b1")]=a,e["timer"]=i})})}))}[a0_0x5592("0x8df")](){const t=this[a0_0x5592("0x739")];t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,this[a0_0x5592("0x73a")]),this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&t[a0_0x5592("0x590")](0,!1)}[a0_0x5592("0x73a")](){this[a0_0x5592("0x739")][a0_0x5592("0x590")](1,!0)}[a0_0x5592("0x4fd")](){this["ske"]&&(this[a0_0x5592("0x739")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")]["stop"]()),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x3de")](){const t=this["ske"];!this[a0_0x5592("0x617")]&&t&&t["templet"]&&(this[a0_0x5592("0x617")]=!0,this[a0_0x5592("0x8df")]())}}class Mt extends t{constructor(){super(),this[a0_0x5592("0x1c8")]=null,this["nameLab"]=null,this[a0_0x5592("0x2e4")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x9f7")]()}[a0_0x5592("0x9f7")](){const t=Y["instance"][a0_0x5592("0x3d0")],e=t[a0_0x5592("0x347")],a=this[a0_0x5592("0x1c8")];e["indexOf"](a0_0x5592("0x7a4"))>-1?a["loadImage"](e):a["skin"]=e,this[a0_0x5592("0x4cd")]["text"]=t[a0_0x5592("0x749")],this[a0_0x5592("0x2e4")][a0_0x5592("0x1e3")]=O["formatNumber"](t["score"])}["updateNode"](){const t=this[a0_0x5592("0x8a0")];Laya[a0_0x5592("0x6eb")]["to"](t,{x:-180},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x221")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{this[a0_0x5592("0x9f7")](),Laya[a0_0x5592("0x6eb")]["to"](t,{x:0},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5")])}))}[a0_0x5592("0x4fd")](){super[a0_0x5592("0x4fd")]()}[a0_0x5592("0x3de")](){}}class Dt extends Laya[a0_0x5592("0x54")]{constructor(){super()}["onEnable"](){}[a0_0x5592("0x4fd")](){}}class wt extends Laya[a0_0x5592("0x54")]{constructor(){super(),this[a0_0x5592("0x233")]=!0,this["isChecked"]=!0,this[a0_0x5592("0x13f")]=null,this[a0_0x5592("0x38d")]=null,this[a0_0x5592("0x8c5")]=null}[a0_0x5592("0x6ac")](){if(this[a0_0x5592("0x233")]){if(this[a0_0x5592("0x7cf")]=!this[a0_0x5592("0x7cf")],this[a0_0x5592("0x13f")]&&(this[a0_0x5592("0x13f")]["visible"]=this[a0_0x5592("0x7cf")]),this["clickHandle"]&&this[a0_0x5592("0x38d")](this["isChecked"]),Laya[a0_0x5592("0x262")]["playSound"](at[a0_0x5592("0x82")]),this[a0_0x5592("0x8a0")]&&this["owner"][a0_0x5592("0x2ed")]&&this[a0_0x5592("0x8a0")][a0_0x5592("0x2ed")][a0_0x5592("0x751")](Dt)){let e=this[a0_0x5592("0x8a0")][a0_0x5592("0x2ed")]["numChildren"],a=this[a0_0x5592("0x8a0")][a0_0x5592("0x2ed")]["getChildIndex"](this[a0_0x5592("0x8a0")]);for(let t=0;t<e;t++){const i=this[a0_0x5592("0x8a0")][a0_0x5592("0x2ed")]["getChildAt"](t)[a0_0x5592("0x751")](wt);if(!i)return;t==a?i["isChecked"]||(i[a0_0x5592("0x7cf")]=!0):i[a0_0x5592("0x7cf")]=!1,i[a0_0x5592("0x13f")]&&(i[a0_0x5592("0x13f")]["visible"]=i[a0_0x5592("0x7cf")])}}}else this[a0_0x5592("0x8c5")]&&this[a0_0x5592("0x8c5")]()}["onEnable"](){this[a0_0x5592("0x13f")]&&(this["checkMark"]["visible"]=this[a0_0x5592("0x7cf")]),this[a0_0x5592("0x8ce")]()}[a0_0x5592("0x8ce")](){const t=this[a0_0x5592("0x8a0")][a0_0x5592("0xab9")](a0_0x5592("0x548"));t&&(t["visible"]=!this[a0_0x5592("0x233")])}["onDisable"](){}}class Pt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x821")]=null,this[a0_0x5592("0xb1d")]=null,this[a0_0x5592("0x84c")]=null,this[a0_0x5592("0x1dc")]=null,this[a0_0x5592("0x5ef")]=null,this[a0_0x5592("0x53d")]=[]}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")],this["bgSke"][a0_0x5592("0x14")]=0,this[a0_0x5592("0x1dc")][a0_0x5592("0x14")]=0;const r=[],s=[],n=this["sureBtn"][a0_0x5592("0xab9")]("title");this["setClick"](this["maskNode"],()=>{},this,null,!0),this[a0_0x5592("0x68")](this[a0_0x5592("0x821")],()=>{if(3==r["length"]){for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const e=s[t],a=this[a0_0x5592("0x53d")][e]["han"];a&&a()}this["hide"]()}},this),this[a0_0x5592("0x68")](this[a0_0x5592("0xb1d")],()=>{C[a0_0x5592("0x965")][a0_0x5592("0x9c4")]["showRewardVideoAd"](C[a0_0x5592("0x933")],()=>{const e=this[a0_0x5592("0x53d")];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const a=e[t][a0_0x5592("0x6e2")];a&&a()}this["hide"]()})},this);for(let i=0;i<4;i++){const t=this[a0_0x5592("0x1dc")][a0_0x5592("0x433")](i),e=t[a0_0x5592("0xab9")](a0_0x5592("0x717")),a=t[a0_0x5592("0xab9")](a0_0x5592("0x601")),o=t["getChildByName"](a0_0x5592("0x739")),l=t["getChildByName"](a0_0x5592("0x184")),_=t["getChildByName"]("picon2"),h=t[a0_0x5592("0xab9")](a0_0x5592("0x29c"));this[a0_0x5592("0x53d")][a0_0x5592("0x626")]({title:e,icon:a,desc:h,han:null,id:null,ske:o,picon:l,picon2:_}),t[a0_0x5592("0x751")](wt)[a0_0x5592("0x38d")]=t=>{const e=this[a0_0x5592("0x53d")][i]["id"];if(e){if(t){r[a0_0x5592("0x779")](e)<0&&r[a0_0x5592("0xb0e")]<3&&(r[a0_0x5592("0x626")](e),s[a0_0x5592("0x626")](i))}else{const a=r[a0_0x5592("0x779")](e);a>=0&&(r[a0_0x5592("0x3c8")](a,1),s["splice"](s["indexOf"](i),1))}n[a0_0x5592("0x1e3")]=N["AdventurePage"][8]+" "+r[a0_0x5592("0xb0e")]+"/3",3==r[a0_0x5592("0xb0e")]&&(n["text"]=N["AdventurePage"][9]),this[a0_0x5592("0x821")][a0_0x5592("0xba")]=3!=r[a0_0x5592("0xb0e")],this[a0_0x5592("0xb38")](r,s)}}}Laya["timer"][a0_0x5592("0x724")](200,this,()=>{this[a0_0x5592("0x5ef")]["templet"]&&(this["bgSke"][a0_0x5592("0x590")](0,!1),this[a0_0x5592("0x5ef")]["alpha"]=1,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](2e3,this,()=>{this["bgSke"][a0_0x5592("0x14")]=0}))}),Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x1dc")],{alpha:1},500,Laya["Ease"][a0_0x5592("0x5db")])}[a0_0x5592("0xb38")](t,e){if(3==t[a0_0x5592("0xb0e")])for(let t=0;t<4;t++){const a=this[a0_0x5592("0x1dc")][a0_0x5592("0x433")](t)[a0_0x5592("0x751")](wt);e[a0_0x5592("0x779")](t)<0&&(a["interactable"]=!1)}else for(let t=0;t<4;t++){this[a0_0x5592("0x1dc")][a0_0x5592("0x433")](t)["getComponent"](wt)[a0_0x5592("0x233")]=!0}}[a0_0x5592("0x971")](e){const a=this[a0_0x5592("0x53d")],i=rt;for(let t=0;t<e["length"];t++){const r=e[t],s=a[t];if(!s)continue;const n=D["skills"][r];s["title"]["text"]=n[a0_0x5592("0x749")],s[a0_0x5592("0x4db")][a0_0x5592("0x1e3")]=n[a0_0x5592("0x73e")]["replace"]("$",Y[a0_0x5592("0x173")]["playerData"][a0_0x5592("0x640")]["weapon"]+""),s[a0_0x5592("0x601")][a0_0x5592("0x8fa")]=bt[n["id"]],s[a0_0x5592("0x6e2")]=()=>{let t="";r<2e3?t=a0_0x5592("0x4e3")+r+a0_0x5592("0x56c"):r>2e3&&r<3e3?t=a0_0x5592("0x4e3")+r+a0_0x5592("0x471"):r>3e3&&r<4e3?t=a0_0x5592("0x4e3")+r+a0_0x5592("0x9c2"):r>4e3&&(t=a0_0x5592("0x4e3")+r+a0_0x5592("0x2e0")),R[a0_0x5592("0xcf")](t)},s["id"]=r;const o=s[a0_0x5592("0x739")],l=s["picon"],_=s[a0_0x5592("0x92a")],h=St[r];if(h){let t=h[a0_0x5592("0x167")];if(null!=h[a0_0x5592("0x87c")]){const x=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")]["id"];t+=x+"/intensify"+(1==x?"":"_"+x)+a0_0x5592("0x1bc")}l[a0_0x5592("0x143")]=_[a0_0x5592("0x143")]=!1,o[a0_0x5592("0x6e9")](t,Laya["Handler"]["create"](this,()=>{s[a0_0x5592("0x601")][a0_0x5592("0x143")]=!1,o["templet"]&&(o[a0_0x5592("0x7c2")](h[a0_0x5592("0xa86")]||.85),o[a0_0x5592("0x590")](h[a0_0x5592("0x87c")]||0,!0)),l[a0_0x5592("0x143")]=_["visible"]=!0})),o[a0_0x5592("0x143")]=!0,h[a0_0x5592("0x6f7")]?o[a0_0x5592("0x6f7")](h["pos"][0],h[a0_0x5592("0x6f7")][1]):o[a0_0x5592("0x6f7")](73,190),h[a0_0x5592("0x787")]&&(l[a0_0x5592("0x8fa")]=i[this[a0_0x5592("0x8a4")]["playerData"]["id"]],l[a0_0x5592("0x6f7")](h[a0_0x5592("0x787")][0],h[a0_0x5592("0x787")][1]),l["scale"](h["pscale"],h[a0_0x5592("0x659")]),l[a0_0x5592("0x143")]=!0),h[a0_0x5592("0x449")]&&(_[a0_0x5592("0x8fa")]=i[this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")]["id"]],_[a0_0x5592("0x6f7")](h[a0_0x5592("0x449")][0],h["ppos2"][1]),_["scale"](h[a0_0x5592("0x659")],h[a0_0x5592("0x659")]),_[a0_0x5592("0x143")]=!0)}else o["visible"]=!1,l[a0_0x5592("0x143")]=!1,_["visible"]=!1,s[a0_0x5592("0x601")][a0_0x5592("0x143")]=!0}S[a0_0x5592("0x741")](e)}[a0_0x5592("0x26e")](){R[a0_0x5592("0xcf")]("player.selSkill");(()=>{Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x8a0")],{scaleX:0,scaleY:0,alpha:0},100,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0x838")]),this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}))})()}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x5ef")][a0_0x5592("0x5c7")](this)}}class Ot extends t{constructor(){super(),this[a0_0x5592("0x739")]=null,this["jt"]=null,this[a0_0x5592("0x460")]=null,this[a0_0x5592("0x320")]=null,this["inited"]=!1}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t[a0_0x5592("0x27")]&&(this[a0_0x5592("0x617")]=!0,t&&t[a0_0x5592("0x27")]&&t[a0_0x5592("0x7c2")](.8))}[a0_0x5592("0x880")](){const t=Laya[a0_0x5592("0x43c")][a0_0x5592("0x481")],e=Laya["stage"][a0_0x5592("0x1c1")];this[a0_0x5592("0x617")]=!1;const a=this["owner"];a[a0_0x5592("0x6b")](t,e),a["cacheAs"]="bitmap",a["on"](a0_0x5592("0x329"),this,()=>{});const i=a[a0_0x5592("0xab9")]("bg");this["jt"]=a[a0_0x5592("0xab9")]("jt");const r=new Laya[a0_0x5592("0x73d")];r[a0_0x5592("0x14")]=.5,r[a0_0x5592("0xacb")][a0_0x5592("0x95f")](0,0,t,e,a0_0x5592("0x213")),i[a0_0x5592("0x231")](r);const s=new Laya[a0_0x5592("0x73d")];s["blendMode"]=a0_0x5592("0x5d2"),i["addChild"](s),this[a0_0x5592("0x320")]=s;const n=new Laya[a0_0x5592("0x8e5")];n[a0_0x5592("0xa68")]["drawRect"](0,0,t,e,a0_0x5592("0x213")),a[a0_0x5592("0x460")]=n,a["mouseEnabled"]=!0,this[a0_0x5592("0x460")]=n}[a0_0x5592("0x971")](t){if(this[a0_0x5592("0x460")]&&this["cirMask"]){const e=this[a0_0x5592("0x460")],a=this[a0_0x5592("0x320")];if(e[a0_0x5592("0xb0")][a0_0x5592("0x149")](),e[a0_0x5592("0xb0")][a0_0x5592("0x44e")](t["x"],t["y"],t["radius"],"#000000"),a["graphics"][a0_0x5592("0x149")](),a["graphics"][a0_0x5592("0x44e")](t["x"],t["y"],t[a0_0x5592("0xa5a")],a0_0x5592("0x213")),this[a0_0x5592("0x739")]){this[a0_0x5592("0x739")][a0_0x5592("0x6f7")](t["x"],t["y"]);const i=t[a0_0x5592("0xa5a")]/40;this[a0_0x5592("0x739")][a0_0x5592("0xa20")](i,i)}if(this["jt"]){const r=t["radius"]/40||1,s=this["jt"];if(Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](s),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](s),1==(t[a0_0x5592("0x3db")]||1)){s[a0_0x5592("0x6f7")](t["x"],t["y"]+100*r),s[a0_0x5592("0xa37")]=1;const n=()=>{Laya["Tween"]["to"](s,{y:t["y"]+50*r},1e3,Laya["Ease"][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](s,()=>{Laya[a0_0x5592("0x6eb")]["to"](s,{y:t["y"]+100*r},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5db")])}))};n(),Laya[a0_0x5592("0x6ec")]["loop"](2e3,s,n)}else{s[a0_0x5592("0x6f7")](t["x"],t["y"]-100*r),s[a0_0x5592("0xa37")]=-1;const o=()=>{Laya[a0_0x5592("0x6eb")]["to"](s,{y:t["y"]-50*r},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya["Handler"]["create"](s,()=>{Laya[a0_0x5592("0x6eb")]["to"](s,{y:t["y"]-100*r},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5db")])}))};o(),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](2e3,s,o)}}}}[a0_0x5592("0x4fd")](){}}const Nt=new class{constructor(){this[a0_0x5592("0x3ac")]=null,this[a0_0x5592("0x823")]=null,this[a0_0x5592("0x900")]=0}[a0_0x5592("0x75b")](t,e){if(this["guidIns"])return console[a0_0x5592("0x5df")](a0_0x5592("0xa3c")),void t["removeSelf"]();this[a0_0x5592("0x3ac")]=t,this[a0_0x5592("0x823")]=e,this[a0_0x5592("0x6b4")]()}[a0_0x5592("0x6b4")](){if(this[a0_0x5592("0x823")]&&this[a0_0x5592("0x3ac")])if(this[a0_0x5592("0x900")]==this["steps"][a0_0x5592("0xb0e")])this[a0_0x5592("0x3ac")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x3ac")]=null,this[a0_0x5592("0x900")]=0;else{const t=this[a0_0x5592("0x823")][this[a0_0x5592("0x900")]++];this["guidIns"][a0_0x5592("0x751")](Ot)[a0_0x5592("0x971")](t)}}};class Bt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["maskNode"]=null,this[a0_0x5592("0x89")]=null,this[a0_0x5592("0x1dc")]=null,this[a0_0x5592("0x5ef")]=null,this[a0_0x5592("0x338")]=null,this["skill1Tit"]=null,this[a0_0x5592("0x7fc")]=null,this[a0_0x5592("0xadc")]=null,this[a0_0x5592("0x46e")]=null,this[a0_0x5592("0x5c5")]=null,this[a0_0x5592("0x158")]=null,this["skill3Tit"]=null,this[a0_0x5592("0x8da")]=null,this[a0_0x5592("0x40")]=null,this[a0_0x5592("0xac5")]=null,this[a0_0x5592("0xabd")]=null,this["skill4Desc"]=null,this["skills"]=[],this[a0_0x5592("0x3df")]=null}["onEnable"](){this["ins"]=Y[a0_0x5592("0x173")];this[a0_0x5592("0x8a0")];this[a0_0x5592("0x5ef")]["alpha"]=0,this[a0_0x5592("0x1dc")][a0_0x5592("0x14")]=0,this[a0_0x5592("0x68")](this[a0_0x5592("0x89")],()=>{C[a0_0x5592("0x965")]["faceBookAdvertisement"][a0_0x5592("0x8e3")](C["AllSkillVideoID"],()=>{Laya[a0_0x5592("0x6ec")]["once"](0,this,()=>{const e=this["skills"];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const a=e[t],i=a[a0_0x5592("0x6e2")];i&&i();const r=a["id"];this[a0_0x5592("0x3df")]&&r&&this["handle"](r)}this[a0_0x5592("0x26e")]()})})},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x7fc")],()=>{const t=this["skills"][0][a0_0x5592("0x6e2")];t&&t(),this[a0_0x5592("0x26e")](this[a0_0x5592("0x53d")][0]["id"])},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x5c5")],()=>{const t=this["skills"][1][a0_0x5592("0x6e2")];t&&t(),this[a0_0x5592("0x26e")](this[a0_0x5592("0x53d")][1]["id"])},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x8da")],()=>{const t=this[a0_0x5592("0x53d")][2][a0_0x5592("0x6e2")];t&&t(),this[a0_0x5592("0x26e")](this[a0_0x5592("0x53d")][2]["id"])},this),this["setClick"](this[a0_0x5592("0xabd")],()=>{const t=this[a0_0x5592("0x53d")][3][a0_0x5592("0x6e2")];t&&t(),this[a0_0x5592("0x26e")](this[a0_0x5592("0x53d")][3]["id"])},this),this[a0_0x5592("0x68")](this["maskNode"],()=>{},this,null,!0),this[a0_0x5592("0x53d")][a0_0x5592("0xb0e")]||(this[a0_0x5592("0x53d")][a0_0x5592("0x626")]({title:this[a0_0x5592("0xabb")],icon:this["skill1Icon"],desc:this["skill1Desc"],han:null,id:null}),this[a0_0x5592("0x53d")][a0_0x5592("0x626")]({title:this[a0_0x5592("0x46e")],icon:this[a0_0x5592("0x5c5")],desc:this[a0_0x5592("0x158")],han:null,id:null}),this[a0_0x5592("0x53d")][a0_0x5592("0x626")]({title:this[a0_0x5592("0x723")],icon:this[a0_0x5592("0x8da")],desc:this[a0_0x5592("0x40")],han:null,id:null}),this["skills"][a0_0x5592("0x626")]({title:this[a0_0x5592("0xac5")],icon:this[a0_0x5592("0xabd")],desc:this[a0_0x5592("0xaa")],han:null,id:null})),Laya[a0_0x5592("0x6ec")]["once"](200,this,()=>{this[a0_0x5592("0x5ef")][a0_0x5592("0x27")]&&(this[a0_0x5592("0x5ef")][a0_0x5592("0x590")](0,!1),this[a0_0x5592("0x5ef")][a0_0x5592("0x14")]=1,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](2e3,this,()=>{this[a0_0x5592("0x5ef")][a0_0x5592("0x14")]=0})),this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")][a0_0x5592("0x9d5")]<1&&this["loadPrefab"]("prefab/GuidanceDialog.json")[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](a0_0x5592("0x4"),t);this[a0_0x5592("0x8a4")]["guidNode"]["addChild"](e),Nt[a0_0x5592("0x75b")](e,[{x:217,y:374,radius:80}]),T("新手引导","选择技能")})}),Laya[a0_0x5592("0x6eb")]["to"](this["parentNode"],{alpha:1},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5db")])}[a0_0x5592("0x971")](e,a){const i=this["skills"],r=rt;let s=0,n=null;for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const o=e[t],l=D["skills"][o][a0_0x5592("0x208")];l&&(!s||l&&l<s)&&(s=l,n=t)}for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const _=e[t],h=i[t];if(!h)continue;const x=D[a0_0x5592("0x53d")][_];h[a0_0x5592("0xdd")][a0_0x5592("0x1e3")]=x[a0_0x5592("0x749")],h[a0_0x5592("0x4db")]["text"]=x[a0_0x5592("0x73e")]["replace"]("$",Y["instance"][a0_0x5592("0x4ca")]["planeData"]["weapon"]+"");const c=h[a0_0x5592("0x601")][a0_0x5592("0x433")](0),d=c["getChildByName"]("icon");if(d[a0_0x5592("0x143")]=!0,d[a0_0x5592("0x8fa")]=bt[x["id"]],h["han"]=()=>{let t="";_<2e3?t="player_"+_+a0_0x5592("0x56c"):_>2e3&&_<3e3?t=a0_0x5592("0x4e3")+_+"_bulskill":_>3e3&&_<4e3?t="player_"+_+a0_0x5592("0x9c2"):_>4e3&&(t=a0_0x5592("0x4e3")+_+"_robskill"),R[a0_0x5592("0xcf")](t)},h["id"]=_,a&&t<2||!a){const u=c[a0_0x5592("0xab9")]("ske"),f=c[a0_0x5592("0xab9")](a0_0x5592("0x184")),p=c[a0_0x5592("0xab9")](a0_0x5592("0x92a")),m=St[_];if(m){let t=m[a0_0x5592("0x167")];if(null!=m["ani"]){const T=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")]["id"];t+=T+"/intensify"+(1==T?"":"_"+T)+".sk"}f[a0_0x5592("0x143")]=p["visible"]=!1,u[a0_0x5592("0x6e9")](t,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{d["visible"]=!1,u[a0_0x5592("0x27")]&&(u[a0_0x5592("0x7c2")](m[a0_0x5592("0xa86")]||.85),u["play"](m[a0_0x5592("0x87c")]||0,!0)),f[a0_0x5592("0x143")]=p[a0_0x5592("0x143")]=!0})),u["visible"]=!0,m[a0_0x5592("0x6f7")]?u[a0_0x5592("0x6f7")](m["pos"][0],m["pos"][1]):u[a0_0x5592("0x6f7")](73,190),m["ppos"]&&(f[a0_0x5592("0x8fa")]=r[this[a0_0x5592("0x8a4")]["playerData"]["id"]],f[a0_0x5592("0x6f7")](m[a0_0x5592("0x787")][0],m["ppos"][1]),f[a0_0x5592("0xa20")](m[a0_0x5592("0x659")],m["pscale"])),m[a0_0x5592("0x449")]&&(p[a0_0x5592("0x8fa")]=r[this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")]["id"]],p["pos"](m[a0_0x5592("0x449")][0],m[a0_0x5592("0x449")][1]),p[a0_0x5592("0xa20")](m["pscale"],m[a0_0x5592("0x659")]))}else u[a0_0x5592("0x143")]=!1,f[a0_0x5592("0x143")]=!1,p["visible"]=!1,d["visible"]=!0;const g=c[a0_0x5592("0xab9")](a0_0x5592("0x54b"));if(g["visible"]=!1,this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")][a0_0x5592("0x188")]<=3&&null!=n&&t==n){g["visible"]=!0;const E=g[a0_0x5592("0x433")](0);E&&E[a0_0x5592("0x27")]?E[a0_0x5592("0x590")](0,!0):Laya[a0_0x5592("0x6ec")]["once"](200,this,()=>{E&&E[a0_0x5592("0x27")]&&E[a0_0x5592("0x590")](0,!0)})}const v=c[a0_0x5592("0xab9")]("new");v[a0_0x5592("0x143")]=!1;const y=I[a0_0x5592("0x9d6")][a0_0x5592("0x779")](_);y>-1&&(v["visible"]=!0,a?t<2&&I[a0_0x5592("0x9d6")][a0_0x5592("0x3c8")](y,1):I["nunlock"]["splice"](y,1))}a&&(t<2||(h[a0_0x5592("0xdd")][a0_0x5592("0x143")]=h[a0_0x5592("0x4db")][a0_0x5592("0x143")]=h[a0_0x5592("0x601")][a0_0x5592("0x143")]=!1))}if(a){this[a0_0x5592("0x338")][a0_0x5592("0x1e3")]=a;const t=this["parentNode"][a0_0x5592("0x2ed")];t["height"]=600,t["y"]=200,this[a0_0x5592("0x5ef")][a0_0x5592("0xa37")]=2.1,this[a0_0x5592("0x5ef")]["y"]=607}this["chaBtn"]["visible"]=!a&&this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")]["rate"]>2,S["loadSkillPre"](a?[e[0],e[1]]:e)}[a0_0x5592("0x26e")](t){R["event"](a0_0x5592("0x62b")),this[a0_0x5592("0x3df")]&&t&&this[a0_0x5592("0x3df")](t);(()=>{Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x8a0")],{scaleX:0,scaleY:0,alpha:0},100,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{R[a0_0x5592("0xcf")](F["StudySkill"]),this["owner"][a0_0x5592("0xaa4")]()}))})()}[a0_0x5592("0x4fd")](){this["bgSke"][a0_0x5592("0x5c7")](this)}}class Ft extends t{constructor(){super(),this["conBtn"]=null,this[a0_0x5592("0x735")]=null,this[a0_0x5592("0x305")]=null,this[a0_0x5592("0xd0")]=null,this[a0_0x5592("0x7aa")]=null,this[a0_0x5592("0x88e")]=null,this[a0_0x5592("0x5c4")]=null}["onEnable"](){const t=Y[a0_0x5592("0x173")];let e=t[a0_0x5592("0x756")];if(!e){const h=C["gameSDK"][a0_0x5592("0x68d")][a0_0x5592("0x79c")](),x=C["gameSDK"]["leaderboard"]["getRobotPhotos"]();e={name:h[O[a0_0x5592("0x7de")](h["length"]-1,0)],photo:a0_0x5592("0x50c")+x[O[a0_0x5592("0x7de")](x[a0_0x5592("0xb0e")]-1,0)]+a0_0x5592("0x525"),score:t["playerData"][a0_0x5592("0x537")]-O["getRandom"](200,100)}}let a=C[a0_0x5592("0x965")]["sdkInfo"]["photo"];a[a0_0x5592("0x779")](a0_0x5592("0x7a4"))<0&&(a["indexOf"](a0_0x5592("0x870"))>-1&&(a=a[a0_0x5592("0xa51")](a0_0x5592("0x870"),"")),a||(a="1"),a=a0_0x5592("0x50c")+a+a0_0x5592("0x525"));const i={name:C["gameSDK"][a0_0x5592("0x15")]["playerName"]||a0_0x5592("0x50e"),photo:a,score:t[a0_0x5592("0x4ca")][a0_0x5592("0x537")]},r=this[a0_0x5592("0x7aa")],s=this["otherNode"],n=this[a0_0x5592("0x305")],o=this["lightNode"],l=this[a0_0x5592("0x3c1")],_=this[a0_0x5592("0x735")];this["initPlayerNode"](r,i),this[a0_0x5592("0x7f2")](s,e),l[a0_0x5592("0x143")]=_[a0_0x5592("0x143")]=o[a0_0x5592("0x143")]=n[a0_0x5592("0x143")]=!1,this[a0_0x5592("0x68")](_,()=>{C[a0_0x5592("0x965")][a0_0x5592("0x205")][a0_0x5592("0x613")]()},this),this["setClick"](l,()=>{this["closeDialog"](this,()=>{this[a0_0x5592("0x5c4")]&&this["closeHandler"]()})},this);Laya["timer"][a0_0x5592("0x724")](1e3,this,()=>{Laya["Tween"]["to"](r,{y:154},500,Laya[a0_0x5592("0x4ec")]["backIn"]),Laya[a0_0x5592("0x6eb")]["to"](s,{y:546},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x221")]),Laya["timer"][a0_0x5592("0x724")](1e3,this,()=>{n[a0_0x5592("0xa20")](3,3),n[a0_0x5592("0x143")]=!0,Laya[a0_0x5592("0x6eb")]["to"](n,{scaleX:1,scaleY:1},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x221")]),Laya[a0_0x5592("0x6ec")]["once"](500,this,()=>{l[a0_0x5592("0x143")]=_[a0_0x5592("0x143")]=o[a0_0x5592("0x143")]=!0})})})}["initPlayerNode"](t,e){const a=t[a0_0x5592("0xab9")](a0_0x5592("0x864")),i=t[a0_0x5592("0xab9")](a0_0x5592("0x4cd")),r=t[a0_0x5592("0xab9")](a0_0x5592("0x64a")),s=e[a0_0x5592("0x347")];s["indexOf"]("http")>-1?a[a0_0x5592("0x2aa")](s):a[a0_0x5592("0x8fa")]=s,i[a0_0x5592("0x1e3")]=e["name"],r[a0_0x5592("0x1e3")]=O["formatNumber"](e[a0_0x5592("0x537")])}[a0_0x5592("0x4fd")](){super["onDisable"]()}[a0_0x5592("0x3de")](){}}class Vt extends t{constructor(){super(),this[a0_0x5592("0x5f8")]=null,this[a0_0x5592("0x2c2")]=null,this[a0_0x5592("0xf3")]=null,this[a0_0x5592("0x8a4")]=null,this["closeHandler"]=null}[a0_0x5592("0x880")](){this["ins"]=Y["instance"];this[a0_0x5592("0x8a0")],this[a0_0x5592("0x8a4")];let t=5;this["timeLab"][a0_0x5592("0x1e3")]=t+"",this[a0_0x5592("0xf3")][a0_0x5592("0x1e3")]=N[a0_0x5592("0x126")][15];const e=()=>{t--,this[a0_0x5592("0x2c2")][a0_0x5592("0x1e3")]=t+""},a=()=>{this[a0_0x5592("0xaf2")](1e3,e,this,t,null,!0,()=>{this[a0_0x5592("0x5c4")]&&this[a0_0x5592("0x5c4")](),this[a0_0x5592("0x6a6")](this)})};a(),this[a0_0x5592("0x68")](this[a0_0x5592("0x5f8")],()=>{Laya[a0_0x5592("0x6ec")]["clearAll"](this),C[a0_0x5592("0x965")][a0_0x5592("0x9c4")][a0_0x5592("0x8e3")](C[a0_0x5592("0x1c6")],()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0x4cb")]),this[a0_0x5592("0x6a6")](this)},()=>{a()})},this)}[a0_0x5592("0x4fd")](){Laya["timer"][a0_0x5592("0x61b")](this)}["onUpdate"](){}}class Ut extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x65f")]=null,this["hitNode"]=null,this[a0_0x5592("0x27c")]=null,this["lvPro"]=null,this["lvSke"]=null,this["lvLab"]=null,this[a0_0x5592("0x8d0")]=null,this[a0_0x5592("0x3f6")]=null,this[a0_0x5592("0x124")]=null,this[a0_0x5592("0x2e4")]=null,this[a0_0x5592("0x1bd")]=null,this[a0_0x5592("0x93b")]=null,this[a0_0x5592("0x871")]=null,this[a0_0x5592("0x235")]=null,this[a0_0x5592("0x4c8")]=null,this[a0_0x5592("0x51")]=0,this["rewNum"]=0,this[a0_0x5592("0x56e")]=!1,this[a0_0x5592("0x66d")]=!1,this[a0_0x5592("0x3fb")]=!1,Ut["insUI"]=this}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")];Laya["SoundManager"][a0_0x5592("0x767")](at["BattleBgMus"],0);L[a0_0x5592("0x713")]=at[a0_0x5592("0x771")];const t=this[a0_0x5592("0x761")](w["battleUI"][a0_0x5592("0x922")]),e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x877")]["BattleSceneMidNode"],t);this[a0_0x5592("0x65f")][a0_0x5592("0x231")](e),this[a0_0x5592("0x1bd")]=e["getChildByName"](a0_0x5592("0x1bd")),this[a0_0x5592("0x93b")]=e[a0_0x5592("0xab9")]("rateTipLab"),this["bossComNode"]=e[a0_0x5592("0xab9")](a0_0x5592("0x871")),this[a0_0x5592("0x235")]=e["getChildByName"](a0_0x5592("0x235"));const f=this["ins"],p=f[a0_0x5592("0x4ca")];let m;p["chapter"]<1?m=U[a0_0x5592("0x8b2")]:(m=U[a0_0x5592("0x791")][p["chapter"]-1],2==I[a0_0x5592("0x5d4")]&&(m=U[a0_0x5592("0x52a")][p[a0_0x5592("0x9d5")]-1])),this[a0_0x5592("0x8d0")][a0_0x5592("0x1e3")]=p[a0_0x5592("0x2d6")]+"/"+m[a0_0x5592("0x188")],f[a0_0x5592("0x505")]&&(this[a0_0x5592("0x8d0")]["text"]=N["EndlessDialog"][7]+p[a0_0x5592("0x2d6")]);const g=window[a0_0x5592("0xea")];let v=0;if(g){this["rateLab"][a0_0x5592("0x1e3")]=a0_0x5592("0x483");const a=g[0][a0_0x5592("0x314")][a0_0x5592("0xaed")],_=g[0]["adv"][a0_0x5592("0x5d4")];let t=Q[a0_0x5592("0x1aa")][a][_];v=O[a0_0x5592("0x7de")](t[a0_0x5592("0x4df")],t[a0_0x5592("0xa82")])}else f[a0_0x5592("0x505")]?T(a0_0x5592("0xa8b"),p[a0_0x5592("0x2d6")]):T(a0_0x5592("0x39b"),p[a0_0x5592("0x9d5")]);this[a0_0x5592("0x3f6")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](p[a0_0x5592("0x7e0")]),this["rewardLab"][a0_0x5592("0x1e3")]=p[a0_0x5592("0xb05")]+"",this[a0_0x5592("0x2e4")][a0_0x5592("0x1e3")]=N[a0_0x5592("0x9a1")][9]+O["formatNumber"](p[a0_0x5592("0x537")]),this["rewardLab"][a0_0x5592("0x143")]=!f["isEndless"],this[a0_0x5592("0x2e4")][a0_0x5592("0x143")]=!!f["isEndless"],this[a0_0x5592("0x3a6")][a0_0x5592("0x14")]=0,this["winSke"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x93c")][a0_0x5592("0x481")]=Laya["stage"][a0_0x5592("0x481")],this[a0_0x5592("0x93c")][a0_0x5592("0x1c1")]=Laya["stage"][a0_0x5592("0x1c1")],this[a0_0x5592("0x93c")][a0_0x5592("0x143")]=!1,(new Laya["Sprite"])[a0_0x5592("0xacb")]["drawRect"](0,0,720,186,""),(new Laya[a0_0x5592("0x73d")])[a0_0x5592("0xacb")][a0_0x5592("0x95f")](0,0,720,292,""),this[a0_0x5592("0x3a6")]["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{Laya["timer"][a0_0x5592("0x724")](200,this,()=>{this["lvSke"]["alpha"]=0,this[a0_0x5592("0x456")][a0_0x5592("0x14")]=1,this[a0_0x5592("0x456")][a0_0x5592("0x8de")]=1,this[a0_0x5592("0xa8")]()})}),p["chapter"]<1&&(this[a0_0x5592("0x27c")][a0_0x5592("0x143")]=!1),this["setClick"](this[a0_0x5592("0x27c")],()=>{f[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")]||this[a0_0x5592("0x66d")]||(f["gameState"]=P["PAUSE"],this[a0_0x5592("0x3fb")]=!0,this[a0_0x5592("0x7e3")](w[a0_0x5592("0x877")]["PlayerSkillItem"])["then"](()=>{this["openDialog"](w[a0_0x5592("0x877")]["GamePauseDialog"],f[a0_0x5592("0x925")])}))},this),R["on"](F["RewardNum"],this,()=>{this[a0_0x5592("0x124")]["text"]=p[a0_0x5592("0xb05")]+""});let i=!1;R["on"](F[a0_0x5592("0xb04")],this,t=>{if(a0_0x5592("0x7e0")==t){if(this[a0_0x5592("0x51")]>0&&(this[a0_0x5592("0x51")]--,p[a0_0x5592("0x7e0")]+=1*f["coinRate"],this[a0_0x5592("0x3f6")]["text"]=O[a0_0x5592("0x77")](Math[a0_0x5592("0x6fc")](p[a0_0x5592("0x7e0")])),!i)){i=!0,Laya[a0_0x5592("0x262")][a0_0x5592("0x584")](at[a0_0x5592("0x20f")]),Laya[a0_0x5592("0x6ec")]["once"](100,this,()=>{i=!1});const e=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x920")]),a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x920")],e);a["pos"](f[a0_0x5592("0xa3d")]["x"],f[a0_0x5592("0xa3d")]["y"]),f[a0_0x5592("0xa7e")]["addChild"](a)}}else"rew"==t&&this[a0_0x5592("0x2c1")]>0&&this[a0_0x5592("0x2c1")]--;this[a0_0x5592("0x51")]<=0&&this["rewNum"]<=0&&this["isEnd"]&&R[a0_0x5592("0xcf")](F[a0_0x5592("0x4a6")])}),R["on"](F[a0_0x5592("0x51c")],this,()=>{this[a0_0x5592("0x3fb")]=!1,this["coinNum"]<=0&&this[a0_0x5592("0x2c1")]<=0&&this["isEnd"]&&R[a0_0x5592("0xcf")](F["RateEnd"])}),R["on"](F["RateSupply"],this,()=>{this[a0_0x5592("0xa8")](N[a0_0x5592("0x126")][19])}),R["on"](F[a0_0x5592("0x5c6")],this,()=>{this["getRandomSkill"](N[a0_0x5592("0x9c0")][6])}),R["on"](F[a0_0x5592("0x286")],this,()=>{this[a0_0x5592("0x995")]()});let r=null,s=null;R["on"](F[a0_0x5592("0x3f")],this,()=>{if(f["initCompareData"](),!r){const t=this[a0_0x5592("0x761")](w[a0_0x5592("0x877")][a0_0x5592("0x2bd")]),a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x877")][a0_0x5592("0x2bd")],t);r=a,a[a0_0x5592("0x6f7")](360,640),a["scale"](.2,.2),this["midNode"][a0_0x5592("0x231")](a),Laya[a0_0x5592("0x6eb")]["to"](a,{scaleX:1,scaleY:1},300,Laya["Ease"][a0_0x5592("0x5")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya["timer"]["once"](1e3,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](a,{y:-a[a0_0x5592("0x1c1")]/2},700,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x221")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{a[a0_0x5592("0x143")]=!1;const t=this[a0_0x5592("0x761")](w["battleUI"]["BattleCompareSmallNode"]),e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x877")][a0_0x5592("0x70f")],t);s=e,e["x"]=-180,this[a0_0x5592("0x65f")][a0_0x5592("0x231")](e),Laya["Tween"]["to"](e,{x:0},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5")]),f[a0_0x5592("0xe5")]&&1==f[a0_0x5592("0x4ca")]["rate"]?(f[a0_0x5592("0xe5")]--,R[a0_0x5592("0xcf")](F[a0_0x5592("0x5c6")])):R["event"](F[a0_0x5592("0x9ef")])}))})}))}}),R["on"](F[a0_0x5592("0x175")],this,()=>{if(this[a0_0x5592("0x2e4")]["text"]=N[a0_0x5592("0x9a1")][9]+O[a0_0x5592("0x77")](p[a0_0x5592("0x537")]),f[a0_0x5592("0x3d0")]){const t=f["compareData"]["score"];p[a0_0x5592("0x537")]>t&&(f[a0_0x5592("0x756")]=Object[a0_0x5592("0xaa3")]({},f[a0_0x5592("0x3d0")]),f["initCompareData"](),s&&s[a0_0x5592("0x751")](Mt)[a0_0x5592("0x26d")]())}});let d=null;R["on"](F[a0_0x5592("0x8e2")],this,()=>{d&&Laya["Tween"]["to"](d,{x:750},1e3,Laya["Ease"]["backIn"],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{d["visible"]=!1}))}),R["on"](F[a0_0x5592("0x9ef")],this,()=>{if(!d&&z[a0_0x5592("0x558")][3]&&p[a0_0x5592("0x9d5")]>0){const l=this["getRes"](w[a0_0x5592("0x877")][a0_0x5592("0x573")]),_=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x877")][a0_0x5592("0x573")],l);d=_,_[a0_0x5592("0x6f7")](750,1186),this["midNode"][a0_0x5592("0x231")](_),Laya[a0_0x5592("0x6eb")]["to"](_,{x:619},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5")])}this[a0_0x5592("0x56e")]=!1,this[a0_0x5592("0x66d")]=!1,f["gameState"]=P[a0_0x5592("0xa5")],f["levelBox"]=0;let t=J[a0_0x5592("0x734")][p[a0_0x5592("0x188")]],e=p[a0_0x5592("0x19")]/t,a=p[a0_0x5592("0x188")],i=m[a0_0x5592("0x620")];if(f["isEndless"]&&(i=15),p[a0_0x5592("0x188")]>=i+1&&(e=1,a=i),this["lvPro"][a0_0x5592("0x8de")]=e,this["lvLab"][a0_0x5592("0x1e3")]=""+a,this[a0_0x5592("0x8d0")]["text"]=p[a0_0x5592("0x2d6")]+"/"+m[a0_0x5592("0x188")],f[a0_0x5592("0x505")]&&(this["rateLab"]["text"]=N[a0_0x5592("0x9a1")][7]+p[a0_0x5592("0x2d6")]),g){this[a0_0x5592("0x8d0")]["text"]=a0_0x5592("0x483");const h=g[0]["adv"][a0_0x5592("0xaed")],x=g[0][a0_0x5592("0x314")][a0_0x5592("0x5d4")];T("进入"+(1==h?"装备":"钻石")+"冒险",h),T("进入"+(1==h?"装备":"钻石")+a0_0x5592("0x76a")+x,x)}else f["isEndless"]?T(a0_0x5592("0x35c"),p[a0_0x5592("0x2d6")]):1==I[a0_0x5592("0x5d4")]?T(a0_0x5592("0x1a"),100*p[a0_0x5592("0x9d5")]+p[a0_0x5592("0x2d6")]):T(a0_0x5592("0xaf8"),100*p[a0_0x5592("0x9d5")]+p[a0_0x5592("0x2d6")]);const r=()=>{if(f[a0_0x5592("0x505")]&&p["rate"]>1&&(H["endlessData"]["lastData"]=Object[a0_0x5592("0xaa3")]({},p),H["endlessData"]["lastEnemy"]=f[a0_0x5592("0xae5")]),f[a0_0x5592("0x505")]&&f[a0_0x5592("0xa40")]){const t=E[a0_0x5592("0x546")][f[a0_0x5592("0xa40")][0]+""+f[a0_0x5592("0xa40")][1]];t&&S[a0_0x5592("0x50")](t[f[a0_0x5592("0xa40")][2]])}},s=()=>{let t=this[a0_0x5592("0x235")];t[a0_0x5592("0x143")]=!0,t["x"]=1080;const e=t["getComponent"](At)["blinkNode"];Laya[a0_0x5592("0x6eb")]["to"](t,{x:360},300,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x51d")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0xaf2")](400,()=>{Laya[a0_0x5592("0x6eb")]["to"](e,{alpha:0},200,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](e,{alpha:1},200)}))},this,3,null,!0,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:-360},300,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x51d")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{t[a0_0x5592("0x143")]=!1,R["event"](F["LevelEnemy"]),r()}))})}))},n=()=>{let t=this[a0_0x5592("0x871")];t["visible"]=!0,t["x"]=1080;const e=t[a0_0x5592("0x751")](At)[a0_0x5592("0xab2")];Laya[a0_0x5592("0x6eb")]["to"](t,{x:360},300,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x51d")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0xaf2")](400,()=>{Laya[a0_0x5592("0x6eb")]["to"](e,{alpha:0},200,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](e,{alpha:1},200)}))},this,3,null,!0,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:-360},300,Laya["Ease"][a0_0x5592("0x51d")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{t[a0_0x5592("0x143")]=!1,R[a0_0x5592("0xcf")](F[a0_0x5592("0x71")]),r()}))})})),Laya[a0_0x5592("0x262")][a0_0x5592("0x584")](at[a0_0x5592("0x67a")])},o=()=>{let t=this[a0_0x5592("0x93b")];t["text"]=a0_0x5592("0x135")+p[a0_0x5592("0x2d6")],t["x"]=1080,Laya["Tween"]["to"](t,{x:380},300,Laya["Ease"]["quadIn"],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:340},1e3,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{Laya["Tween"]["to"](t,{x:-360},150,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x51d")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0x71")]),r()}))}))}))};if(f[a0_0x5592("0x505")]?p["rate"]>=16&&p["rate"]%10==6?s():p["rate"]%5==0?n():o():p[a0_0x5592("0x2d6")]%5==0&&p[a0_0x5592("0x2d6")]%10!=0&&p["chapter"]>0?s():p["rate"]%10==0||p[a0_0x5592("0x2d6")]%5==0&&p[a0_0x5592("0x9d5")]<1?n():o(),f[a0_0x5592("0x505")]||p["rate"]>1&&p[a0_0x5592("0x9d5")]>0&&(I[a0_0x5592("0x94c")]=p),!f[a0_0x5592("0x505")]){const c=E[a0_0x5592("0x199")][p["chapter"]+""+I[a0_0x5592("0x5d4")]];c&&S[a0_0x5592("0x50")](c[p[a0_0x5592("0x2d6")]+1])}}),R["on"](F[a0_0x5592("0x4a6")],this,()=>{if(this[a0_0x5592("0x56e")]=!0,this["rewNum"]>0||this[a0_0x5592("0x51")]>0||this["isPausing"])return;const t=()=>{this[a0_0x5592("0x66d")]=!0;const t=p[a0_0x5592("0x9d5")];let e=p[a0_0x5592("0x2d6")];const a=p[a0_0x5592("0x2d6")]+1;let i=E[a0_0x5592("0x4e0")+t];2==I[a0_0x5592("0x5d4")]&&(i=E[a0_0x5592("0x1f1")+t]);let r=i[a],s=m;if(g){r=null;const d=g[0][a0_0x5592("0x314")]["model"],u=g[0][a0_0x5592("0x314")][a0_0x5592("0x5d4")];T((1==d?"装备":"钻石")+a0_0x5592("0xab1"),d),T((1==d?"装备":"钻石")+"冒险难度"+u+"成功",u)}else f[a0_0x5592("0x505")]||(1==I[a0_0x5592("0x5d4")]?T("普通模式关卡成功",100*p[a0_0x5592("0x9d5")]+p[a0_0x5592("0x2d6")]):T("困难模式关卡成功",100*p[a0_0x5592("0x9d5")]+p["rate"]));let n=p["coin"],o=0;g?(p[a0_0x5592("0x7e0")]+=v*f[a0_0x5592("0xb30")],o=v*f[a0_0x5592("0xb30")]):f[a0_0x5592("0x505")]?e%10==0?(p[a0_0x5592("0x7e0")]+=300*f["coinRate"],o=300*f[a0_0x5592("0xb30")]):(p[a0_0x5592("0x7e0")]+=100*f["coinRate"],o=100*f["coinRate"]):e%5==0?(p[a0_0x5592("0x7e0")]+=s[a0_0x5592("0x515")]*f[a0_0x5592("0xb30")],o=s[a0_0x5592("0x515")]*f[a0_0x5592("0xb30")]):(p[a0_0x5592("0x7e0")]+=s["addgold"]*f[a0_0x5592("0xb30")],o=s[a0_0x5592("0x2ba")]*f[a0_0x5592("0xb30")]);const l=this[a0_0x5592("0x3f6")];if(Laya[a0_0x5592("0x6eb")]["to"](l,{scaleX:1.3,scaleY:1.3},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{let t=o/20;this[a0_0x5592("0xaf2")](50,()=>{n+=t,l[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](Math["floor"](n))},this,20,null,!0,()=>{l[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](p["coin"]),Laya[a0_0x5592("0x6eb")]["to"](l,{scaleX:1,scaleY:1},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")])})})),!r&&!f["isEndless"])return void Laya["timer"][a0_0x5592("0x724")](1e3,this,()=>{f[a0_0x5592("0x1a9")][a0_0x5592("0x14")]=0,f["player2Node"][a0_0x5592("0x14")]=0,f[a0_0x5592("0x5be")][a0_0x5592("0x14")]=0,f[a0_0x5592("0xa7e")][a0_0x5592("0x14")]=0,f["bgTopNode"][a0_0x5592("0x14")]=0,f[a0_0x5592("0x547")]=P["END"],f[a0_0x5592("0xa88")][a0_0x5592("0xab9")](a0_0x5592("0xd"))[a0_0x5592("0x6b7")]=!1});p[a0_0x5592("0x2d6")]=a;let _=J[a0_0x5592("0x313")][e]||1,h=J[a0_0x5592("0x734")][p[a0_0x5592("0x188")]];p[a0_0x5592("0x19")]+=_;let x=p[a0_0x5592("0x19")]/h,c=s[a0_0x5592("0x620")];f[a0_0x5592("0x505")]&&(c=15),p[a0_0x5592("0x188")]>=c+1&&(x=1),Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x456")],{value:x},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x521")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{p["level"]<c+1&&p["exp"]>=h?(p[a0_0x5592("0x188")]+=1,p[a0_0x5592("0x19")]=0,this[a0_0x5592("0x3a6")]["templet"]?(this["lvPro"]["value"]=0,this["lvSke"][a0_0x5592("0x590")](0,!1),this[a0_0x5592("0x3a6")][a0_0x5592("0x14")]=1):(this["lvPro"]["alpha"]=1,this[a0_0x5592("0xa8")]())):R[a0_0x5592("0xcf")](F[a0_0x5592("0x838")],!0)}))};t()}),R["on"](F[a0_0x5592("0x838")],this,()=>{if(this[a0_0x5592("0x4c8")]){f[a0_0x5592("0x547")]=P[a0_0x5592("0x953")],f[a0_0x5592("0x1a9")][a0_0x5592("0x14")]=0,f["eneBulNode"][a0_0x5592("0x14")]=0;const e=f[a0_0x5592("0x1af")];for(let t=e["numChildren"]-1;t>=0;t--){e["getChildAt"](t)["removeSelf"]()}f[a0_0x5592("0x1af")][a0_0x5592("0x14")]=0,f[a0_0x5592("0xa7e")][a0_0x5592("0x14")]=0,f["bgTopNode"][a0_0x5592("0x14")]=0,f[a0_0x5592("0x334")]["transform"][a0_0x5592("0x67d")]=this[a0_0x5592("0xce")]();const a=f[a0_0x5592("0x587")];for(let t=0;t<a[a0_0x5592("0xb0e")];t++){a[t]["v3"][a0_0x5592("0x6b7")]=!1}const i=124,r=f[a0_0x5592("0x334")];let t=this[a0_0x5592("0xce")]();f[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](360,640+i),t),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](0,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](r["transform"],{localPositionX:t["x"],localPositionZ:t["z"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{f[a0_0x5592("0xacc")]=t,f[a0_0x5592("0xa3d")]=this["getVec3"](360,640+i),f[a0_0x5592("0x94d")]["pos"](360,640+i),Laya[a0_0x5592("0x6ec")]["once"](500,this,()=>{const t=this["supplyData"];this[a0_0x5592("0x4c8")]=null;const e=this[a0_0x5592("0x4c9")](u[t["type"]],f[a0_0x5592("0x6cb")]["enemyPres"][t["type"]]),a=e["getComponent"](It);e[a0_0x5592("0x6f7")](360,1280+e[a0_0x5592("0x1c1")]/2),a[a0_0x5592("0x2e2")]=t,a["cloHan"]=()=>{f[a0_0x5592("0x547")]=P[a0_0x5592("0xa5")],Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{R[a0_0x5592("0xcf")](F["RateStart"])})},this[a0_0x5592("0x8a4")][a0_0x5592("0x817")]["addChild"](e)})}))})}else f["selSkill"]&&1==p["rate"]?(f[a0_0x5592("0xe5")]--,R[a0_0x5592("0xcf")](F[a0_0x5592("0x5c6")])):(f[a0_0x5592("0x547")]=P[a0_0x5592("0xa5")],Laya[a0_0x5592("0x6ec")]["once"](1e3,this,()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0x9ef")])}))}),this["winSke"]["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{this["winSke"][a0_0x5592("0x27")]&&this[a0_0x5592("0x1bd")][a0_0x5592("0x590")](0,!0)});let n=!1,o=!1,l=!1;R["on"](F[a0_0x5592("0x5f3")],this,()=>{if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0x81a")]&&!n){f[a0_0x5592("0x505")]?(H["endlessData"][a0_0x5592("0x94c")]=null,H["endlessData"][a0_0x5592("0x3b6")]=null):I[a0_0x5592("0x94c")]=null;const e=f[a0_0x5592("0x587")];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){e[t];R[a0_0x5592("0xcf")](F[a0_0x5592("0xaad")],t+1)}if(n=!0,p["currHP"]>0)Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{const t=f[a0_0x5592("0x334")];let e=this[a0_0x5592("0xce")](),a=f[a0_0x5592("0xa3d")]["y"]>1e3?1e3:840;f["modCameraV3"][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](360,a),e),Laya[a0_0x5592("0x6eb")]["to"](t[a0_0x5592("0x48b")],{localPositionX:e["x"],localPositionZ:e["z"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{this[a0_0x5592("0x1bd")][a0_0x5592("0x27")]&&(this[a0_0x5592("0x1bd")]["visible"]=!0,this[a0_0x5592("0x1bd")][a0_0x5592("0x590")](1,!1),Laya[a0_0x5592("0x262")][a0_0x5592("0x584")](at[a0_0x5592("0xa15")])),Laya[a0_0x5592("0x6eb")]["to"](t[a0_0x5592("0x48b")],{localPositionZ:e["z"]-10},500,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{f[a0_0x5592("0x505")]||this[a0_0x5592("0x7e3")](w[a0_0x5592("0x877")][a0_0x5592("0x3a3")])[a0_0x5592("0x284")](()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0x877")][a0_0x5592("0xaa8")],f[a0_0x5592("0x925")])})})}))})}))}),g||f[a0_0x5592("0x505")]||I["setChapter"](),g||f[a0_0x5592("0x505")]||(1==I[a0_0x5592("0x5d4")]?T(a0_0x5592("0x827"),p[a0_0x5592("0x9d5")]):T(a0_0x5592("0x631"),p["chapter"]));else{let t=p[a0_0x5592("0x53d")][V[a0_0x5592("0xb1a")]],e=!!(I[a0_0x5592("0x56b")]["indexOf"](7)>-1);if(Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{e&&!l?(l=!0,R[a0_0x5592("0xcf")](F["PlayerReborn"])):t&&!o?(o=!0,R["event"](F[a0_0x5592("0x4cb")])):this[a0_0x5592("0x165")](w[a0_0x5592("0x877")]["RebornDialog"],f[a0_0x5592("0x925")],t=>{t[a0_0x5592("0x751")](Vt)[a0_0x5592("0x5c4")]=()=>{if(f["isEndless"]){const e=()=>{this[a0_0x5592("0x7e3")](w[a0_0x5592("0x877")][a0_0x5592("0x3a3")])[a0_0x5592("0x284")](()=>{this[a0_0x5592("0x165")](w["battleUI"][a0_0x5592("0x61f")],f[a0_0x5592("0x925")])})};p[a0_0x5592("0x537")]<=200?e():this[a0_0x5592("0x165")](w[a0_0x5592("0x877")][a0_0x5592("0x4d1")],f[a0_0x5592("0x925")],t=>{t[a0_0x5592("0x751")](Ft)[a0_0x5592("0x5c4")]=e})}else this[a0_0x5592("0x7e3")](w[a0_0x5592("0x877")]["PlayerSkillItem"])[a0_0x5592("0x284")](()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0x877")][a0_0x5592("0xaa8")],f[a0_0x5592("0x925")])}),g||z["updateRate"](p[a0_0x5592("0x9d5")],p["rate"])}})}),g){const a=g[0][a0_0x5592("0x314")][a0_0x5592("0xaed")],i=g[0][a0_0x5592("0x314")][a0_0x5592("0x5d4")];T((1==a?"装备":"钻石")+a0_0x5592("0x4f"),a),T((1==a?"装备":"钻石")+a0_0x5592("0x76a")+i+"失败",i)}else f[a0_0x5592("0x505")]?T("无尽模式关卡失败",p[a0_0x5592("0x2d6")]):1==I[a0_0x5592("0x5d4")]?(T(a0_0x5592("0x74c"),100*p[a0_0x5592("0x9d5")]+p["rate"]),T(a0_0x5592("0x95e"),p["chapter"])):(T(a0_0x5592("0x534"),100*p[a0_0x5592("0x9d5")]+p[a0_0x5592("0x2d6")]),T(a0_0x5592("0x703"),p["chapter"]))}}}),R["on"](F[a0_0x5592("0x4cb")],this,()=>{R[a0_0x5592("0xcf")](a0_0x5592("0x8c9")),n=!1,f[a0_0x5592("0x94d")]["visible"]=!0,f["playerV2"][a0_0x5592("0x3b3")][a0_0x5592("0x143")]=!0,f[a0_0x5592("0x448")]["visible"]=!0;for(let t=0;t<f[a0_0x5592("0x860")][a0_0x5592("0xb0e")];t++)f[a0_0x5592("0x860")][t]["visible"]=!0;for(let t=0;t<f[a0_0x5592("0xa9c")][a0_0x5592("0xb0e")];t++)f["plaWingsV2"][t]["visible"]=!0;f["playerNode"][a0_0x5592("0x14")]=1,f[a0_0x5592("0xa88")]["active"]=!0,p["hp"]/=2,p["hp"]=Math[a0_0x5592("0x6fc")](p["hp"]),p[a0_0x5592("0x257")]=p["hp"],R["event"](F[a0_0x5592("0x2ff")]),f[a0_0x5592("0x547")]=P[a0_0x5592("0xa5")],f[a0_0x5592("0x6c4")]||f["enemyCols"][a0_0x5592("0xb0e")]||Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0x4a6")])})}),R["on"](F["GameOver"],this,()=>{f[a0_0x5592("0x547")]=P[a0_0x5592("0x81a")]}),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{S["loadBattlePre"](!!(p["chapter"]<1))})}[a0_0x5592("0xa8")](a){const o=this[a0_0x5592("0x8a4")],l=o[a0_0x5592("0x4ca")];o["gameState"]=P[a0_0x5592("0x953")];const _=l[a0_0x5592("0xa16")],h=D["skills"],e=(()=>{let a=_["concat"]();for(let t=a[a0_0x5592("0xb0e")]-1;t>=0;t--){const i=a[t];h[i][a0_0x5592("0x923")]<=0&&a["splice"](t,1)}const t=a["indexOf"](1013);l["currHP"]/l["hp"]>.7&&t>=0&&a[a0_0x5592("0x3c8")](t,1);const e=a[a0_0x5592("0x779")](1023);if(3==l["id"]&&e>-1&&a[a0_0x5592("0x3c8")](e,1),o[a0_0x5592("0xa9c")][a0_0x5592("0xb0e")]>=4)for(let t=a["length"]-1;t>=0;t--){const r=a[t];3==h[r][a0_0x5592("0x84a")]&&a[a0_0x5592("0x3c8")](t,1)}else{let e=null;for(const s in l[a0_0x5592("0x53d")])3==h[s][a0_0x5592("0x84a")]&&(e=parseInt(s));if(e)for(let t=a[a0_0x5592("0xb0e")]-1;t>=0;t--){const n=a[t];3==h[n][a0_0x5592("0x84a")]&&n!=e&&a[a0_0x5592("0x3c8")](t,1)}}return a})();if(e[a0_0x5592("0xb0e")]<4)return void R[a0_0x5592("0xcf")](F[a0_0x5592("0x9ef")]);const i=[];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const f=e[t],p=h[f];if(i[a0_0x5592("0x626")](f),a0_0x5592("0x993")==typeof p[a0_0x5592("0x923")])for(let t=1;t<p[a0_0x5592("0x923")]/1e3;t++)i[a0_0x5592("0x626")](f)}const r=[],s=[],n=i[a0_0x5592("0xb0e")]-1;for(;r[a0_0x5592("0xb0e")]<4;){let t=Math[a0_0x5592("0x6fc")](Math[a0_0x5592("0x2ee")]()*(n-0+1)+0);r[a0_0x5592("0x779")](t)<0&&s[a0_0x5592("0x779")](i[t])<0&&(r[a0_0x5592("0x626")](t),s["push"](i[t]))}let x=s[0],c=s[1],d=s[2],u=s[3];l["chapter"]<1&&(x=1e3,c=1005,d=1001,u=1009),this[a0_0x5592("0x165")](w[a0_0x5592("0x877")][a0_0x5592("0x836")],o[a0_0x5592("0x925")],t=>{const e=t[a0_0x5592("0x751")](Bt);e[a0_0x5592("0x3df")]=(t=>{const e=h[t],a=_[a0_0x5592("0x779")](t);e[a0_0x5592("0x42e")]==m[a0_0x5592("0x52")]&&_["splice"](a,1),e[a0_0x5592("0x42e")]==m["Add"]&&(h[t+1]&&h[t+1][a0_0x5592("0x42e")]==m["Add"]?_[a]=t+1:_[a0_0x5592("0x3c8")](a,1))})[a0_0x5592("0xa2f")](this),e[a0_0x5592("0x971")]([x,c,d,u],a)})}[a0_0x5592("0x995")](){const t=this[a0_0x5592("0x8a4")],o=t[a0_0x5592("0x4ca")];t[a0_0x5592("0x547")]=P["PAUSE"];const l=o[a0_0x5592("0xa16")],_=D[a0_0x5592("0x53d")],e=[1020];let h=null,a=[],i=null,r=[];for(let t=0;t<l[a0_0x5592("0xb0e")];t++){const f=l[t];2==_[f][a0_0x5592("0x84a")]&&a[a0_0x5592("0x626")](f),3==_[f][a0_0x5592("0x84a")]&&r[a0_0x5592("0x626")](f)}h=a[O["getRandom"](a[a0_0x5592("0xb0e")]-1,0)],i=r[O["getRandom"](r[a0_0x5592("0xb0e")]-1,0)],e[a0_0x5592("0x626")](h,i);const s=(()=>{let e=l[a0_0x5592("0xac7")]();for(let t=e[a0_0x5592("0xb0e")]-1;t>=0;t--){const s=e[t];_[s][a0_0x5592("0x923")]<=0&&e[a0_0x5592("0x3c8")](t,1)}const t=e[a0_0x5592("0x779")](1020);t>=0&&e[a0_0x5592("0x3c8")](t,1);const a=e[a0_0x5592("0x779")](h);a>=0&&e["splice"](a,1);const i=e["indexOf"](1013);i>=0&&e[a0_0x5592("0x3c8")](i,1);const r=e[a0_0x5592("0x779")](1023);3==o["id"]&&r>-1&&e[a0_0x5592("0x3c8")](r,1);for(let t=e["length"]-1;t>=0;t--){const n=e[t];3==_[n][a0_0x5592("0x84a")]&&e[a0_0x5592("0x3c8")](t,1)}return e})();if(s[a0_0x5592("0xb0e")]<1)return void R[a0_0x5592("0xcf")](F["RateStart"]);const n=[];for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const p=s[t],m=_[p];if(n[a0_0x5592("0x626")](p),a0_0x5592("0x993")==typeof m[a0_0x5592("0x923")])for(let t=1;t<m[a0_0x5592("0x923")]/1e3;t++)n[a0_0x5592("0x626")](p)}const x=[],c=[],d=n[a0_0x5592("0xb0e")]-1;for(;x[a0_0x5592("0xb0e")]<1;){let t=Math["floor"](Math[a0_0x5592("0x2ee")]()*(d-0+1)+0);x[a0_0x5592("0x779")](t)<0&&c[a0_0x5592("0x779")](n[t])<0&&(x[a0_0x5592("0x626")](t),c[a0_0x5592("0x626")](n[t]))}let u=c[0];e[a0_0x5592("0x626")](u),e[a0_0x5592("0x26f")]((t,e)=>.5-Math["random"]()),this["openDialog"](w[a0_0x5592("0x877")][a0_0x5592("0x6d8")],t[a0_0x5592("0x925")],t=>{t["getComponent"](Pt)[a0_0x5592("0x971")](e)})}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),Laya[a0_0x5592("0x6ec")]["clearAll"](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x262")][a0_0x5592("0x8ee")](),L[a0_0x5592("0x713")]=null,this[a0_0x5592("0x1bd")]&&(this[a0_0x5592("0x1bd")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x1bd")]["stop"]()),this["lvSke"]&&(this[a0_0x5592("0x3a6")][a0_0x5592("0x5c7")](this),this["lvSke"]["stop"]())}}Ut[a0_0x5592("0x4e")]=null;class kt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x5cc")]=!0,this["nor"]=null,this["spec"]=!1,this[a0_0x5592("0x5b6")]=.3}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x5cc")]=!0;const t=this["owner"];t[a0_0x5592("0xa20")](1,1),t[a0_0x5592("0x14")]=1,(t["x"]<=0||t["y"]>=720||t["y"]<=0||t["y"]>=1280)&&(this[a0_0x5592("0x5cc")]=!1,this["moveCoin"]())}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}["moveCoin"](){const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x8a4")][a0_0x5592("0xa3d")];Laya[a0_0x5592("0x6eb")]["to"](t,{x:e["x"],y:e["y"],alpha:0},300,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0xb29")]||R[a0_0x5592("0xcf")](F[a0_0x5592("0x707")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0xb04")],"rew"),t["removeSelf"]()}))}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x8a4")];if(t[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;let e=Laya["timer"][a0_0x5592("0x154")]*this["speed"];const a=this[a0_0x5592("0x8a0")];this[a0_0x5592("0x5cc")]&&((a["x"]<=0||a["x"]>=720)&&(this[a0_0x5592("0x914")]["x"]*=-1),(a["y"]<=0||a["y"]>=1280)&&(this["nor"]["y"]*=-1),Math[a0_0x5592("0x45c")](a["y"]-t["playerV2"]["y"])<=400&&(this[a0_0x5592("0x5cc")]=!1,this[a0_0x5592("0x2fa")]()),a["x"]+=e*this[a0_0x5592("0x914")]["x"],a["y"]+=e*this[a0_0x5592("0x914")]["y"])}}class Gt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x2b1")]=null,this["dex"]=this[a0_0x5592("0x5a7")]()}[a0_0x5592("0x880")](){this["ins"]=Y["instance"]}[a0_0x5592("0x4fd")](){const t=this[a0_0x5592("0x8a0")];t[a0_0x5592("0x1c1")]=0,t[a0_0x5592("0x3b0")]=0,this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x2b1")],a=-e["rotation"]/180*Math["PI"],i=this[a0_0x5592("0x9f")],r=i["x"]*Math[a0_0x5592("0x2d9")](a)+i["y"]*Math[a0_0x5592("0x2d2")](a),s=i["y"]*Math[a0_0x5592("0x2d9")](a)-i["x"]*Math[a0_0x5592("0x2d2")](a),n=e["x"]+r,o=e["y"]+s;t[a0_0x5592("0x6f7")](n,o);let l=this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")],_=n-(l["x"]+this[a0_0x5592("0x9f")]["x"]),h=o-l["y"];t[a0_0x5592("0x1c1")]=Math["sqrt"](_*_+h*h),t[a0_0x5592("0x3b0")]=Math["atan2"](_,-h)/Math["PI"]*180}}class _{constructor(t){this[a0_0x5592("0xe9")]=new Ht(t)}[a0_0x5592("0x69")](a,i){let e=[];if(this[a0_0x5592("0xe9")]){this[a0_0x5592("0xe9")][a0_0x5592("0x149")]();for(let t=0,e=a["length"];t<e;t++){const r=a[t],s=r[a0_0x5592("0x5bb")],n={x:s["x"],y:s["y"],height:s["height"],width:s[a0_0x5592("0x481")],collider:r};this[a0_0x5592("0xe9")]["insert"](n)}if(this[a0_0x5592("0xe9")][a0_0x5592("0xab5")](i[a0_0x5592("0x5bb")])[a0_0x5592("0xb35")](t=>{(function(t,e){const a=t[a0_0x5592("0x8a0")],i=e[a0_0x5592("0x8a0")],r=a["y"]+t[a0_0x5592("0x1f9")],s=i["y"]+e[a0_0x5592("0x1f9")];return Math[a0_0x5592("0x45c")](a["x"]-i["x"])<=(t[a0_0x5592("0x892")]+e["width2"])/2&&Math[a0_0x5592("0x45c")](r-s)<=(t[a0_0x5592("0x407")]+e[a0_0x5592("0x407")])/2})(t["collider"],i)&&e["push"](t["collider"])}),this[a0_0x5592("0x8be")])for(let t=0;t<this["_collisions"][a0_0x5592("0xb0e")];t++){const o=this[a0_0x5592("0x8be")][t];if(e[a0_0x5592("0x779")](o)<0){let t=o[a0_0x5592("0x5aa")][a0_0x5592("0x779")](i["bid"]);if(t>-1&&(o[a0_0x5592("0x5aa")]["splice"](t,1),o[a0_0x5592("0x8a0")])){const l=o[a0_0x5592("0x8a0")][a0_0x5592("0x25d")]||[];for(let t=0;t<l[a0_0x5592("0xb0e")];t++){const _=l[t];if(_&&_[a0_0x5592("0x3ec")]){_[a0_0x5592("0x3ec")](i,o);break}}}let e=i["bids"][a0_0x5592("0x779")](o[a0_0x5592("0x639")]);if(e>-1&&(i[a0_0x5592("0x5aa")][a0_0x5592("0x3c8")](e,1),i["owner"])){const h=i[a0_0x5592("0x8a0")][a0_0x5592("0x25d")]||[];for(let t=0;t<h[a0_0x5592("0xb0e")];t++){const x=h[t];if(x&&x["onCollisionExit"]){x[a0_0x5592("0x3ec")](o,i);break}}}}}for(let t=0;t<e["length"];t++){const c=e[t];if(c[a0_0x5592("0x5aa")]["indexOf"](i[a0_0x5592("0x639")])<0&&(c["bids"]["push"](i[a0_0x5592("0x639")]),c[a0_0x5592("0x8a0")])){const d=c["owner"][a0_0x5592("0x25d")]||[];for(let t=0;t<d[a0_0x5592("0xb0e")];t++){const u=d[t];if(u&&u[a0_0x5592("0xb11")]){u["onCollisionEnter"](i,c);break}}}if(i[a0_0x5592("0x5aa")]["indexOf"](c["bid"])<0&&(i[a0_0x5592("0x5aa")]["push"](c[a0_0x5592("0x639")]),i[a0_0x5592("0x8a0")])){const f=i["owner"][a0_0x5592("0x25d")]||[];for(let t=0;t<f[a0_0x5592("0xb0e")];t++){const p=f[t];if(p&&p[a0_0x5592("0xb11")]){p[a0_0x5592("0xb11")](c,i);break}}}}this[a0_0x5592("0x8be")]=e}}}function Ht(t,e,a,i){this[a0_0x5592("0x357")]=e||10,this[a0_0x5592("0x636")]=a||4,this[a0_0x5592("0x188")]=i||0,this[a0_0x5592("0x9b8")]=t,this[a0_0x5592("0x6cf")]=[],this["nodes"]=[]}Ht[a0_0x5592("0x3fe")]["split"]=function(){var t=this[a0_0x5592("0x188")]+1,e=this[a0_0x5592("0x9b8")][a0_0x5592("0x481")]/2,a=this[a0_0x5592("0x9b8")][a0_0x5592("0x1c1")]/2,i=this["bounds"]["x"],r=this[a0_0x5592("0x9b8")]["y"];this["nodes"][0]=new Ht({x:i+e,y:r,width:e,height:a},this[a0_0x5592("0x357")],this[a0_0x5592("0x636")],t),this[a0_0x5592("0x236")][1]=new Ht({x:i,y:r,width:e,height:a},this[a0_0x5592("0x357")],this[a0_0x5592("0x636")],t),this[a0_0x5592("0x236")][2]=new Ht({x:i,y:r+a,width:e,height:a},this[a0_0x5592("0x357")],this[a0_0x5592("0x636")],t),this[a0_0x5592("0x236")][3]=new Ht({x:i+e,y:r+a,width:e,height:a},this[a0_0x5592("0x357")],this[a0_0x5592("0x636")],t)},Ht[a0_0x5592("0x3fe")][a0_0x5592("0x7ef")]=function(t){var e=[],a=this[a0_0x5592("0x9b8")]["x"]+this[a0_0x5592("0x9b8")]["width"]/2,i=this[a0_0x5592("0x9b8")]["y"]+this[a0_0x5592("0x9b8")][a0_0x5592("0x1c1")]/2,r=t["y"]<i,s=t["x"]<a,n=t["x"]+t["width"]>a,o=t["y"]+t[a0_0x5592("0x1c1")]>i;return r&&n&&e["push"](0),s&&r&&e[a0_0x5592("0x626")](1),s&&o&&e[a0_0x5592("0x626")](2),n&&o&&e[a0_0x5592("0x626")](3),e},Ht[a0_0x5592("0x3fe")][a0_0x5592("0xa56")]=function(t){var e,a=0;if(this[a0_0x5592("0x236")][a0_0x5592("0xb0e")])for(e=this["getIndex"](t),a=0;a<e[a0_0x5592("0xb0e")];a++)this[a0_0x5592("0x236")][e[a]][a0_0x5592("0xa56")](t);else if(this["objects"][a0_0x5592("0x626")](t),this[a0_0x5592("0x6cf")][a0_0x5592("0xb0e")]>this["max_objects"]&&this["level"]<this[a0_0x5592("0x636")]){for(this[a0_0x5592("0x236")][a0_0x5592("0xb0e")]||this[a0_0x5592("0xae0")](),a=0;a<this[a0_0x5592("0x6cf")][a0_0x5592("0xb0e")];a++){e=this[a0_0x5592("0x7ef")](this["objects"][a]);for(var i=0;i<e[a0_0x5592("0xb0e")];i++)this[a0_0x5592("0x236")][e[i]][a0_0x5592("0xa56")](this[a0_0x5592("0x6cf")][a])}this[a0_0x5592("0x6cf")]=[]}},Ht["prototype"]["retrieve"]=function(t){var e=this[a0_0x5592("0x7ef")](t),a=this[a0_0x5592("0x6cf")];if(this[a0_0x5592("0x236")][a0_0x5592("0xb0e")])for(var i=0;i<e[a0_0x5592("0xb0e")];i++)a=a["concat"](this[a0_0x5592("0x236")][e[i]][a0_0x5592("0xab5")](t));return a=a[a0_0x5592("0x2c")](function(t,e){return a[a0_0x5592("0x779")](t)>=e})},Ht[a0_0x5592("0x3fe")][a0_0x5592("0x149")]=function(){this[a0_0x5592("0x6cf")]=[];for(var t=0;t<this[a0_0x5592("0x236")][a0_0x5592("0xb0e")];t++)this[a0_0x5592("0x236")][a0_0x5592("0xb0e")]&&this[a0_0x5592("0x236")][t][a0_0x5592("0x149")]();this[a0_0x5592("0x236")]=[]};class f extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this["quadTree"]=null,this["_norV3"]=null,this[a0_0x5592("0x85d")]=2,this[a0_0x5592("0x35e")]=P["READY"],this["speed"]=.5,this[a0_0x5592("0xa13")]=null}get["norV3"](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this["_norV3"]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280}));const t=this[a0_0x5592("0xa13")];t&&(t[a0_0x5592("0xa37")]=0,t["y"]=26,Laya[a0_0x5592("0x6eb")]["to"](t,{scaleY:1,y:79},100))}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){this["owner"][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P[a0_0x5592("0xa5")])return;const t=this["owner"];let e=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")];t[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),t["x"]+=e*this[a0_0x5592("0x918")]["x"],t["y"]+=e*this[a0_0x5592("0x918")]["y"],(t["x"]<=-360||t["x"]>=1080||t["y"]<=-640||t["y"]>=1920)&&this["owner"]["removeSelf"](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")][a0_0x5592("0x532")],this[a0_0x5592("0x1b2")])}}class zt extends t{constructor(){super(),this["ins"]=null,this["selfCol"]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this["going"]=!0,this["currDis"]=0,this[a0_0x5592("0x35e")]=P["START"],this[a0_0x5592("0x5b6")]=.5,this[a0_0x5592("0x608")]=500,this[a0_0x5592("0x2b1")]=null}get[a0_0x5592("0x918")](){return this["_norV3"]}set[a0_0x5592("0x918")](t){this["_norV3"]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")]["getComponent"](W),this["quadTree"]||(this["quadTree"]=new _({x:0,y:0,width:720,height:1280})),this["currDis"]=0,this["going"]=!0}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this["state"]!=P[a0_0x5592("0xa5")])return;const e=this[a0_0x5592("0x8a0")];let t=Laya[a0_0x5592("0x6ec")]["delta"]*this[a0_0x5592("0x5b6")],a=this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")];if(this[a0_0x5592("0x6a2")]&&a&&a[a0_0x5592("0x2ed")]){let t=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")]["subtract"](this["getVec3"](a["x"],a["y"]),this["getVec3"](e["x"],e["y"]),t),Laya["Vector3"][a0_0x5592("0x2c0")](t,this[a0_0x5592("0x918")])}if(!this[a0_0x5592("0x6a2")]&&this["tar"]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]){let t=this["getVec3"]();Laya["Vector3"][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this[a0_0x5592("0x2b1")]["x"],this["tar"]["y"]),this[a0_0x5592("0xce")](e["x"],e["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,this[a0_0x5592("0x918")])}if(this[a0_0x5592("0x994")]>=this["distance"]&&this["going"])if(this[a0_0x5592("0x6a2")]=!1,this["tar"]&&this["tar"][a0_0x5592("0x2ed")]){let t=this["getVec3"]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](this[a0_0x5592("0x2b1")]["x"],this[a0_0x5592("0x2b1")]["y"]),this["getVec3"](e["x"],e["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,this["norV3"])}else this[a0_0x5592("0x2b1")]=null,this[a0_0x5592("0x918")]["x"]*=-1,this["norV3"]["y"]*=-1;!this[a0_0x5592("0x6a2")]&&this["tar"]&&this["tar"][a0_0x5592("0x2ed")]&&Math[a0_0x5592("0x45c")](this[a0_0x5592("0x2b1")]["x"]-e["x"])<=3*t&&Math["abs"](this[a0_0x5592("0x2b1")]["y"]-e["y"])<=3*t&&e[a0_0x5592("0xaa4")](),e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180);let i=t*this[a0_0x5592("0x918")]["x"],r=t*this[a0_0x5592("0x918")]["y"];e["x"]+=i,e["y"]+=r,this[a0_0x5592("0x6a2")]&&(this["currDis"]+=Math["sqrt"](i*i+r*r)),(e["x"]<=-360||e["x"]>=1080||e["y"]<=-640||e["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")][a0_0x5592("0x532")],this[a0_0x5592("0x1b2")])}}class Wt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x4ad")]=0,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this["js"]=!1,this[a0_0x5592("0x2b1")]=null,this[a0_0x5592("0x450")]=0,this[a0_0x5592("0x5b6")]=.4,this["xv"]=1,this["s3d"]=null}get[a0_0x5592("0x918")](){return this["_norV3"]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}["onEnable"](){this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0x1b2")]=this["owner"][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x4ad")]=0,this["js"]=!1,this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")];const t=this["ins"],e=this[a0_0x5592("0x8a0")],a=new Laya[a0_0x5592("0x745")],i=this[a0_0x5592("0x761")](b[a0_0x5592("0x85b")]),r=Laya[a0_0x5592("0x745")]["instantiate"](i);a["addChild"](r),t[a0_0x5592("0xa88")][a0_0x5592("0xab9")]("trails")[a0_0x5592("0x231")](a);let s=this[a0_0x5592("0xce")]();t[a0_0x5592("0x4bc")]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](e["x"],e["y"]),s),a["transform"][a0_0x5592("0x93a")]=s,this[a0_0x5592("0x627")]=a}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x627")]&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0xb11")](t,e){this["owner"][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P[a0_0x5592("0xa5")])return;const n=this[a0_0x5592("0x8a0")];let o=Laya[a0_0x5592("0x6ec")]["delta"]*this[a0_0x5592("0x5b6")],t=this["ins"]["ratio3D"];if(this["js"]){if(this["tar"]){let t=this[a0_0x5592("0xce")](),e=this["getVec3"](),a=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this[a0_0x5592("0x2b1")]["x"],this["tar"]["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,e),Laya["Vector3"][a0_0x5592("0x2bb")](this[a0_0x5592("0x918")],e,o/50,a),this[a0_0x5592("0x918")]=a,o*=2}}else{if(this[a0_0x5592("0x2b1")]){let t=this[a0_0x5592("0xce")](),e=this["getVec3"](),a=this[a0_0x5592("0xce")]();Laya["Vector3"][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this["tar"]["x"],this[a0_0x5592("0x2b1")]["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),t),Laya["Vector3"]["normalize"](t,e);let i=Math[a0_0x5592("0x23d")](-e["y"],e["x"]);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](this[a0_0x5592("0xce")](this[a0_0x5592("0x450")]),this[a0_0x5592("0xce")](i),o/100,a),this[a0_0x5592("0x450")]=a["x"]}this[a0_0x5592("0x4ad")]+=6;let t=-Math[a0_0x5592("0x2d2")](this[a0_0x5592("0x4ad")]/180*Math["PI"]),e=.4*Math[a0_0x5592("0xc0")](t),a=new Laya[a0_0x5592("0x97c")](0,0,0),i=this["pangle"],r=1*Math["cos"](i)+e*Math[a0_0x5592("0x2d2")](i);r*=this["xv"];let s=e*Math[a0_0x5592("0x2d9")](i)-1*Math[a0_0x5592("0x2d2")](i);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](this[a0_0x5592("0xce")](r,s),a),this[a0_0x5592("0x918")]=a}n[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),n["x"]+=o*this["norV3"]["x"],n["y"]+=o*this[a0_0x5592("0x918")]["y"],this["s3d"]["transform"]["translate"](this["getVec3"](this[a0_0x5592("0x918")]["x"]/t*o,0,this[a0_0x5592("0x918")]["y"]/t*o)),(n["x"]<=-360||n["x"]>=1080||n["y"]<=-640||n["y"]>=1920)&&this["owner"][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")][a0_0x5592("0x532")],this[a0_0x5592("0x1b2")])}}class Xt extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this["circle"]=!0,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x68a")]=1,this["tar"]=null,this[a0_0x5592("0x4ad")]=0,this["xv"]=1,this[a0_0x5592("0x5b6")]=.5,this[a0_0x5592("0x24e")]=b[a0_0x5592("0x85b")],this[a0_0x5592("0x680")]=1,this[a0_0x5592("0x627")]=null}get["norV3"](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this["owner"];e&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this[a0_0x5592("0x2")]=!0;const e=this["ins"],a=this["owner"];if(1==this[a0_0x5592("0x680")]?this["ranax"]=Math[a0_0x5592("0x6fc")](3*Math[a0_0x5592("0x2ee")]()+8)/10:this[a0_0x5592("0x68a")]=1,this[a0_0x5592("0x24e")]&&e[a0_0x5592("0x4bc")]["transform"]){const i=new Laya[a0_0x5592("0x745")],r=this[a0_0x5592("0x761")](this[a0_0x5592("0x24e")]),s=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](r);i[a0_0x5592("0x231")](s),e["modSceneV3"][a0_0x5592("0xab9")](a0_0x5592("0xd"))[a0_0x5592("0x231")](i);let t=this["getVec3"]();e["modCameraV3"][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](a["x"],a["y"]),t),i[a0_0x5592("0x48b")]["position"]=t,this[a0_0x5592("0x627")]=i}}["onDisable"](){this["s3d"]&&Laya["timer"]["once"](200,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this["recover"](this[a0_0x5592("0x8a0")])}),R["offAllCaller"](this)}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}["onCollisionExit"](t,e){}["onLateUpdate"](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this["state"]!=P[a0_0x5592("0xa5")])return;const i=this[a0_0x5592("0x8a0")];let r=Laya["timer"]["delta"]*this[a0_0x5592("0x5b6")],t=this[a0_0x5592("0x8a4")]["ratio3D"];if(this[a0_0x5592("0x2b1")]&&this[a0_0x5592("0x2")]){let t=this[a0_0x5592("0xce")](),e=this[a0_0x5592("0xce")]();Laya["Vector3"][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this["tar"]["x"],this[a0_0x5592("0x2b1")]["y"]),this[a0_0x5592("0xce")](i["x"],i["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,e);let a=Math[a0_0x5592("0x23d")](-e["y"],e["x"])-Math[a0_0x5592("0x23d")](-this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x918")]["x"]);if(a<0&&(a+=2*Math["PI"]),a<=.2){this["circle"]=!1;let t=this["getVec3"]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this[a0_0x5592("0x2b1")]["x"],this[a0_0x5592("0x2b1")]["y"]),this[a0_0x5592("0xce")](i["x"],i["y"]),t),Laya[a0_0x5592("0x97c")]["normalize"](t,this["norV3"]),this[a0_0x5592("0x2b1")]=null}else{this["angle"]-=this["xv"]*r/2*this["ranax"]*this[a0_0x5592("0x680")],this[a0_0x5592("0x4ad")]%=360;let t=Math[a0_0x5592("0xc0")](this[a0_0x5592("0x4ad")]/180*Math["PI"]),e=new Laya[a0_0x5592("0x97c")](0,0,0);Laya["Vector3"][a0_0x5592("0x2c0")](new Laya[a0_0x5592("0x97c")](1,-t,0),e),(this[a0_0x5592("0x4ad")]>90&&this[a0_0x5592("0x4ad")]<270||this[a0_0x5592("0x4ad")]<-90&&this["angle"]>-270)&&(e["x"]=-e["x"],e["y"]=-e["y"]),this[a0_0x5592("0x918")]["x"]=e["x"],this[a0_0x5592("0x918")]["y"]=e["y"]}}i["rotation"]=-(180-Math["atan2"](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),i["x"]+=r*this[a0_0x5592("0x918")]["x"],i["y"]+=r*this["norV3"]["y"],this[a0_0x5592("0x627")]&&this["s3d"]["transform"]["translate"](this["getVec3"](this[a0_0x5592("0x918")]["x"]/t*r,0,this[a0_0x5592("0x918")]["y"]/t*r)),(i["x"]<=-360||i["x"]>=1080||i["y"]<=-640||i["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")][a0_0x5592("0x532")],this[a0_0x5592("0x1b2")])}}class Yt{constructor(){this[a0_0x5592("0x1fa")]=0,this["crit"]=0,this[a0_0x5592("0x2cd")]=0,this[a0_0x5592("0x33f")]=0,this[a0_0x5592("0xa49")]=0}}class X extends t{constructor(){super(),this[a0_0x5592("0x523")]=new Yt}[a0_0x5592("0x880")](){}[a0_0x5592("0x4fd")](){}["setData"](t,e,a,i,r){this[a0_0x5592("0x523")]["attack"]=t,this[a0_0x5592("0x523")]["crit"]=e,this[a0_0x5592("0x523")][a0_0x5592("0x2cd")]=a,this["data"][a0_0x5592("0x33f")]=i,this[a0_0x5592("0x523")][a0_0x5592("0xa49")]=r}}class jt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["enemyCom"]=null,this["inited"]=!1,this[a0_0x5592("0x3eb")]=null,this["skill3Pre"]=null,this[a0_0x5592("0x2b")]=null,this["skillLinePre"]=null,this[a0_0x5592("0x68e")]=null,this[a0_0x5592("0x552")]=null,this[a0_0x5592("0x1d7")]=null,this["skill13Pre"]=null,this[a0_0x5592("0x3cb")]=null,this[a0_0x5592("0x8a5")]=null,this[a0_0x5592("0x210")]=null,this[a0_0x5592("0x5fc")]=[],this[a0_0x5592("0x3eb")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x105")]),this["skill3Pre"]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x232")]),this["skill5Pre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["EnemySkill5"]),this[a0_0x5592("0x4ba")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x97b")]),this["skillRotatePre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")]),this[a0_0x5592("0x552")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x8dd")]),this["skill11Pre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["EnemySkill11"]),this[a0_0x5592("0x427")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x87d")]),this[a0_0x5592("0x3cb")]=this["getRes"](w["battle"]["EnemySkill15"]),this[a0_0x5592("0x8a5")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0xa1d")]),this[a0_0x5592("0x210")]=this[a0_0x5592("0x761")](w["battle"]["EnemySkill18"])}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),!this[a0_0x5592("0xa17")]||!this["enemyCom"]["edata"])return;1026==this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")][a0_0x5592("0xb2e")]&&this[a0_0x5592("0x141")]()}["initSkill"](){if(this[a0_0x5592("0x617")])return;this["inited"]=!0;const a=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],t=$[a0_0x5592("0x4e0")][a[a0_0x5592("0xb2e")]];if(t[a0_0x5592("0xa9e")]){const i=t[a0_0x5592("0xa9e")],e=a[a0_0x5592("0x58")],r=a[a0_0x5592("0x5cd")];if(a0_0x5592("0x993")==typeof i)if(7!=i&&14!=i&&16!=i||(this[a0_0x5592("0xa17")]["isRotate"]=!0),12==i)this["enemyCom"]["isRotSelf"]=!0,this[a0_0x5592("0xa17")]["isPauseSelf"]=!0,R["on"](F[a0_0x5592("0x62")],this,this[a0_0x5592("0x472")]);else if(17==i)this["enemyCom"][a0_0x5592("0x765")]=!0,R["on"](F[a0_0x5592("0x5c3")],this,this["skill17"]);else{const s=()=>{if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0xa9e")+i];R[a0_0x5592("0xcf")](F[a0_0x5592("0x560")],[a[a0_0x5592("0xb2e")],this[a0_0x5592("0xa17")][a0_0x5592("0xa02")],i,t?t[a0_0x5592("0xa2f")](this):null]),a[a0_0x5592("0xb2e")]};r&&a0_0x5592("0x993")==typeof r?(Laya["timer"][a0_0x5592("0x724")](1e3*r,this,s),Laya["timer"][a0_0x5592("0x724")](1e3*r,this,()=>{Laya["timer"][a0_0x5592("0x861")](1e3*e,this,()=>{s()})})):Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e,this,()=>{s()})}else if(a0_0x5592("0x35a")==typeof i){const n=i[a0_0x5592("0xae0")]("|"),o=a[a0_0x5592("0x58")][a0_0x5592("0xae0")]("|"),l=a[a0_0x5592("0x644")][a0_0x5592("0xae0")]("|"),_=a["bulletsp"][a0_0x5592("0xae0")]("|");let e=0;const h=()=>{if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0xa9e")+n[e]];R[a0_0x5592("0xcf")](F["EnemyHit"],[a[a0_0x5592("0xb2e")],this[a0_0x5592("0xa17")]["eid"],n[e],t?t["bind"](this,parseFloat(l[e]),parseFloat(_[e])):null]),a[a0_0x5592("0xb2e")],++e>=n[a0_0x5592("0xb0e")]&&(e=0)},x=()=>{Laya["timer"][a0_0x5592("0x724")](1e3*parseFloat(o[e]),this,()=>{h(),x()})};r&&"number"==typeof r?(Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3*r,this,h),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3*r,this,()=>{x()})):x()}}}[a0_0x5592("0x4fd")](){for(let t=0;t<this[a0_0x5592("0x5fc")][a0_0x5592("0xb0e")];t++){this[a0_0x5592("0x5fc")][t][a0_0x5592("0xaa4")]()}this[a0_0x5592("0x5fc")][a0_0x5592("0xb0e")]=0,Laya[a0_0x5592("0x6ec")]["clearAll"](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R["offAllCaller"](this)}[a0_0x5592("0x2ea")](i,r){const s=this["owner"],n=this[a0_0x5592("0xa17")]["edata"],o=[-10,10],t=n[a0_0x5592("0x764")]||1,l=p[n["type"]]["b1"];for(let a=0;a<t;a++)for(let e=0;e<o[a0_0x5592("0xb0e")];e++){const _=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["EnemySkill1"],this[a0_0x5592("0x3eb")]);let t=_["getComponent"](X);t||(t=_[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](i||n[a0_0x5592("0x644")],0,0,0,0);const h=_["getComponent"](f);h[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1),h[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],h["speed"]=r||n["bulletsp"],_["pos"](s["x"]+l[0]["x"]+o[e],s["y"]+l[0]["y"]+20*a),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")]["addChild"](_)}}[a0_0x5592("0xaa5")](i,r){this[a0_0x5592("0x8a4")];const s=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],n=this[a0_0x5592("0x8a0")],o=[-20,20],l=p[s[a0_0x5592("0xb2e")]]["b1"];let _=0;this[a0_0x5592("0xaf2")](50,()=>{const t=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],this[a0_0x5592("0x3eb")]);let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X)),e["setData"](i||s[a0_0x5592("0x644")],0,0,0,0);const a=t[a0_0x5592("0x751")](f);a[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1),a[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],a[a0_0x5592("0x5b6")]=r||s[a0_0x5592("0x277")],t[a0_0x5592("0x6f7")](n["x"]+l[0]["x"]+o[_],n["y"]+l[0]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](t),++_>1&&(_=0)},this,10)}[a0_0x5592("0x101")](i,r){const s=this[a0_0x5592("0x8a4")],n=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],o=this[a0_0x5592("0x8a0")],l=[110,70,100,80],_=p[n[a0_0x5592("0xb2e")]]["b1"];let h=0;this["schedule"](200,()=>{if(!this[a0_0x5592("0x761")](b[a0_0x5592("0x85b")]))return void S[a0_0x5592("0x1eb")]([b[a0_0x5592("0x85b")]]);const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["EnemySkill3"],this[a0_0x5592("0x959")]);let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X)),e[a0_0x5592("0x971")](i||n[a0_0x5592("0x644")],0,0,0,0);const a=t["getComponent"](Xt);a[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1),a[a0_0x5592("0x4ad")]=l[h],a["xv"]=l[h]>90?-1:1,a[a0_0x5592("0x2b1")]=this[a0_0x5592("0x5a7")](s[a0_0x5592("0x94d")]["x"],s[a0_0x5592("0x94d")]["y"]),a[a0_0x5592("0x5b6")]=r||n["bulletsp"],t[a0_0x5592("0x6f7")](o["x"]+_[0]["x"],o["y"]+_[0]["y"]),this["ins"]["eneBulNode"][a0_0x5592("0x231")](t),h++},this,4)}["skill4"](a,i){this[a0_0x5592("0x8a4")];const r=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],s=this[a0_0x5592("0x8a0")],n=[this[a0_0x5592("0xce")](-.34,.94),this[a0_0x5592("0xce")](-.17,.98),this["getVec3"](.17,.98),this[a0_0x5592("0xce")](.34,.94)],o=p[r["type"]]["b1"];for(let e=0;e<4;e++){if(!this[a0_0x5592("0x761")](b[a0_0x5592("0x85b")]))return void S[a0_0x5592("0x1eb")]([b[a0_0x5592("0x85b")]]);const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x232")],this["skill3Pre"]);let t=l["getComponent"](X);t||(t=l[a0_0x5592("0x2a6")](X)),t["setData"](a||r["att"],0,0,0,0);const _=l[a0_0x5592("0x751")](Xt);_[a0_0x5592("0x918")]=n[e][a0_0x5592("0x408")](),_["angle"]=0,_["xv"]=1,_[a0_0x5592("0x2b1")]=null,_[a0_0x5592("0x5b6")]=i||r[a0_0x5592("0x277")],l[a0_0x5592("0x6f7")](s["x"]+o[0]["x"],s["y"]+10+o[0]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](l)}}[a0_0x5592("0x42c")](i,r){const s=this[a0_0x5592("0x8a0")],n=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],o=[-40,-20,20,40],t=n[a0_0x5592("0x764")]||1,l=p[n[a0_0x5592("0xb2e")]]["b1"];for(let e=0;e<t;e++)for(let a=0;a<o[a0_0x5592("0xb0e")];a++){const _=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")],this[a0_0x5592("0x2b")]);let t=_[a0_0x5592("0x751")](X);t||(t=_["addComponent"](X)),t[a0_0x5592("0x971")](i||n[a0_0x5592("0x644")],0,0,0,0);const h=_["getComponent"](f);h[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1),h[a0_0x5592("0x35e")]=P["READY"],h[a0_0x5592("0x5b6")]=r||n[a0_0x5592("0x277")],_[a0_0x5592("0x6f7")](s["x"]+o[a]+l[0]["x"],s["y"]+l[0]["y"]+20*e),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](_),Laya["Tween"]["to"](_,{y:s["y"]+l[0]["y"]+100+20*e},500,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{const e=this["ins"][a0_0x5592("0x94d")];Laya["timer"][a0_0x5592("0x724")](1e3,this[a0_0x5592("0x8a4")],()=>{let t=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](e["x"]+o[a],e["y"]),this["getVec3"](_["x"],_["y"]),t),Laya[a0_0x5592("0x97c")]["normalize"](t,h[a0_0x5592("0x918")]),h[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]})}))}}[a0_0x5592("0x349")](r,s){const n=this[a0_0x5592("0x8a0")],o=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],l=[this["getVec3"](-.17,.98),this[a0_0x5592("0xce")](0,1),this["getVec3"](.17,.98)],_=p[o[a0_0x5592("0xb2e")]]["b1"];this[a0_0x5592("0xaf2")](100,()=>{for(let e=0;e<l[a0_0x5592("0xb0e")];e++){const a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["EnemySkill1"],this[a0_0x5592("0x3eb")]);let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](r||o[a0_0x5592("0x644")],0,0,0,0);const i=a[a0_0x5592("0x751")](f);i[a0_0x5592("0x918")]=l[e][a0_0x5592("0x408")](),i["state"]=P[a0_0x5592("0xa5")],i[a0_0x5592("0x5b6")]=s||o[a0_0x5592("0x277")],a["pos"](n["x"]+_[0]["x"],n["y"]+_[0]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](a)}},this,5)}["skill7"](l,_){const h=this["owner"],x=this["enemyCom"]["edata"],c=[[0,0],[-1,1],[1,1],[-2,2],[0,2],[2,2]],d=p[x[a0_0x5592("0xb2e")]]["b1"],t=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x97b")],this[a0_0x5592("0x4ba")]),e=t[a0_0x5592("0x751")](Gt);e["dex"]=this[a0_0x5592("0x5a7")](),e[a0_0x5592("0x2b1")]=h,t[a0_0x5592("0x6f7")](h["x"],h["y"]),this[a0_0x5592("0x8a4")]["bgTopNode"][a0_0x5592("0x231")](t),this[a0_0x5592("0x5fc")]["push"](t),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1500,this,()=>{if(t[a0_0x5592("0xaa4")](),this[a0_0x5592("0x5fc")][a0_0x5592("0x3c8")](this[a0_0x5592("0x5fc")]["indexOf"](t),1),this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")])for(let r=0;r<c[a0_0x5592("0xb0e")];r++){const s=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x105")],this["skill1Pre"]);let t=s[a0_0x5592("0x751")](X);t||(t=s[a0_0x5592("0x2a6")](X)),t["setData"](l||x[a0_0x5592("0x644")],0,0,0,0);const n=s[a0_0x5592("0x751")](f);n[a0_0x5592("0x5b6")]=_||x[a0_0x5592("0x277")],n["norV3"]=this[a0_0x5592("0xce")](0,1);let e=this["getVec3"]();const o=this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")];let a=10*c[r][0],i=20*c[r][1];s[a0_0x5592("0x6f7")](h["x"]+a+d[0]["x"],h["y"]+i+d[0]["y"]),Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](o["x"]+a,o["y"]+i),this["getVec3"](s["x"],s["y"]),e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](e,n[a0_0x5592("0x918")]),n["state"]=P["START"],this[a0_0x5592("0x8a4")]["eneBulNode"]["addChild"](s)}})}[a0_0x5592("0x4c5")](s,n){const o=this[a0_0x5592("0x8a0")],l=this[a0_0x5592("0xa17")]["edata"],_=[[0,0],[-1,1],[1,1],[-2,2],[2,2],[-3,3],[3,3],[-2,4],[2,4],[-1,5],[1,5],[0,6]],t=l[a0_0x5592("0x764")]||1,h=p[l["type"]]["b1"];for(let r=0;r<t;r++)for(let i=0;i<_[a0_0x5592("0xb0e")];i++){const x=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],this[a0_0x5592("0x3eb")]);let t=x[a0_0x5592("0x751")](X);t||(t=x[a0_0x5592("0x2a6")](X)),t["setData"](s||l[a0_0x5592("0x644")],0,0,0,0);const c=x[a0_0x5592("0x751")](f);c[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1),c[a0_0x5592("0x5b6")]=n||l["bulletsp"];let e=20*_[i][0],a=20*_[i][1];x[a0_0x5592("0x6f7")](o["x"]+e+h[0]["x"],o["y"]+a+h[0]["y"]+140*r),c[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](x)}}["skill9"](n,o){const t=this[a0_0x5592("0x8a0")],l=this[a0_0x5592("0xa17")]["edata"],_=[this[a0_0x5592("0xce")](0,-1),this[a0_0x5592("0xce")](.03,-1),this["getVec3"](.07,-1),this[a0_0x5592("0xce")](.1,-.99),this[a0_0x5592("0xce")](.14,-.99),this["getVec3"](.17,-.98),this[a0_0x5592("0xce")](.98,-.17),this["getVec3"](.99,-.14),this[a0_0x5592("0xce")](.99,-.1),this["getVec3"](.99,-.07),this[a0_0x5592("0xce")](1,-.03),this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](.5,.87),this[a0_0x5592("0xce")](.47,.88),this[a0_0x5592("0xce")](.44,.9),this[a0_0x5592("0xce")](.41,.91),this[a0_0x5592("0xce")](.37,.93),this["getVec3"](.34,.94),this["getVec3"](-.5,.87),this[a0_0x5592("0xce")](-.53,.85),this["getVec3"](-.56,.83),this[a0_0x5592("0xce")](-.59,.81),this[a0_0x5592("0xce")](-.62,.79),this["getVec3"](-.64,.77),this[a0_0x5592("0xce")](-.98,-.17),this["getVec3"](-.98,-.21),this[a0_0x5592("0xce")](-.97,-.24),this[a0_0x5592("0xce")](-.96,-.28),this[a0_0x5592("0xce")](-.95,-.31),this["getVec3"](-.94,-.34)],e=p[l["type"]]["b1"],h=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")],this["skillRotatePre"]);h["pos"](t["x"]+e[0]["x"],t["y"]+e[0]["y"]),this["ins"][a0_0x5592("0x5be")]["addChild"](h),Laya[a0_0x5592("0x6eb")]["to"](h,{y:t["y"]+200+e[0]["y"]},1e3),Laya[a0_0x5592("0x6ec")]["once"](2e3,this[a0_0x5592("0x8a4")],()=>{if(h[a0_0x5592("0xaa4")](),this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")])for(let r=0;r<_["length"];r++){const e=this["open"](w["battle"][a0_0x5592("0x105")],this["skill1Pre"]);let t=e[a0_0x5592("0x751")](X);t||(t=e[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](n||l[a0_0x5592("0x644")],0,0,0,0);const s=e["getComponent"](f);let a,i;if(s[a0_0x5592("0x5b6")]=o||l[a0_0x5592("0x277")],s[a0_0x5592("0x918")]=_[r],r<=5){let t=25*_[0]["x"],e=25*_[0]["y"];a=t+=10*(r-0),i=e-=10*(r-0)}else if(r>5&&r<=11){let t=25*_[6]["x"],e=25*_[6]["y"];a=t+=10*(r-6),i=e+=5*(r-6)}else if(r>11&&r<=17){let t=25*_[12]["x"],e=25*_[12]["y"];a=t-=5*(r-12),i=e+=10*(r-12)}else if(r>17&&r<=23){let t=25*_[18]["x"],e=25*_[18]["y"];a=t-=10*(r-18),i=e-=2*(r-18)}else if(r>23&&r<=29){let t=25*_[24]["x"],e=25*_[24]["y"];a=t-=5*(r-24),i=e-=10*(r-24)}e[a0_0x5592("0x6f7")](h["x"]+a,h["y"]+i),s[a0_0x5592("0x35e")]=P["START"],this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](e)}})}[a0_0x5592("0xc8")](i,r){const s=this[a0_0x5592("0x8a0")],n=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],o=[[-110,100],[-60,115],[0,130],[60,115],[110,100]],l=[.65,.8,1,.8,.65],t=n[a0_0x5592("0x764")]||1,_=p[n[a0_0x5592("0xb2e")]]["b1"];for(let a=0;a<t;a++)for(let e=0;e<o[a0_0x5592("0xb0e")];e++){const h=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x8dd")],this[a0_0x5592("0x552")]);let t=h[a0_0x5592("0x751")](X);t||(t=h[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](i||n[a0_0x5592("0x644")],0,0,0,0);const x=h[a0_0x5592("0x751")](f);x[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1),x["state"]=P[a0_0x5592("0x61e")],x[a0_0x5592("0x5b6")]=r||n[a0_0x5592("0x277")],h[a0_0x5592("0x14")]=l[e],h[a0_0x5592("0xa20")](l[e],l[e]),h["pos"](s["x"]+o[e][0]+_[0]["x"],s["y"]+_[0]["y"]+50*a),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")]["addChild"](h),Laya[a0_0x5592("0x6eb")]["to"](h,{y:s["y"]+o[e][1]+50*a+_[0]["y"]},200,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")];Laya["timer"][a0_0x5592("0x724")](1e3,this[a0_0x5592("0x8a4")],()=>{let t=this["getVec3"](),e=this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")];Laya[a0_0x5592("0x97c")]["subtract"](this[a0_0x5592("0xce")](e["x"],e["y"]),this[a0_0x5592("0xce")](h["x"],h["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,x[a0_0x5592("0x918")]),x[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]})}))}}[a0_0x5592("0x6d1")](s,n){const t=this["owner"],o=this[a0_0x5592("0xa17")]["edata"],l=[this[a0_0x5592("0xce")](.87,-.5),this[a0_0x5592("0xce")](-.5,-.87),this["getVec3"](-.87,.5),this["getVec3"](.5,.87)],e=[-150,150],a=p[o[a0_0x5592("0xb2e")]]["b1"];for(let r=0;r<e[a0_0x5592("0xb0e")];r++){const _=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],this[a0_0x5592("0x1d7")]);_["pos"](t["x"]+a[0]["x"],t["y"]+a[0]["y"]),this["ins"][a0_0x5592("0x5be")][a0_0x5592("0x231")](_),Laya[a0_0x5592("0x6eb")]["to"](_,{x:t["x"]+e[r]+a[0]["x"],y:t["y"]+200+a[0]["y"]},1e3),Laya[a0_0x5592("0x6ec")]["once"](6e3,this["ins"],()=>{_[a0_0x5592("0xaa4")]()}),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](2e3,this[a0_0x5592("0x8a4")],()=>{let i=0;this["schedule"](250,()=>{if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],this[a0_0x5592("0x3eb")]);let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X)),e[a0_0x5592("0x971")](s||o[a0_0x5592("0x644")],0,0,0,0);const a=t["getComponent"](f);a[a0_0x5592("0x5b6")]=n||o["bulletsp"],a[a0_0x5592("0x918")]=l[i][a0_0x5592("0x408")](),r&&(a[a0_0x5592("0x918")]["x"]*=-1),t[a0_0x5592("0x6f7")](_["x"],_["y"]),a["state"]=P["START"],this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")]["addChild"](t),++i>=l[a0_0x5592("0xb0e")]&&(i=0)},this,12)})}}[a0_0x5592("0x472")](t){if(t!=this[a0_0x5592("0xa17")][a0_0x5592("0xa02")])return;const s=this["owner"],n=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],e=this[a0_0x5592("0xa17")]["norV3"];let o=Math[a0_0x5592("0x23d")](-e["y"],e["x"]);for(let r=0;r<2;r++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x87d")],this[a0_0x5592("0x427")]);let t=l[a0_0x5592("0x751")](X);t||(t=l[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](n[a0_0x5592("0x644")],0,0,0,0);let e=o+(r?Math["PI"]/2:-Math["PI"]/2),a=s["x"]+100*Math[a0_0x5592("0x2d9")](e),i=s["y"]-100*Math[a0_0x5592("0x2d2")](e);l[a0_0x5592("0x6f7")](a,i),this["ins"]["eneBulNode"]["addChild"](l)}}[a0_0x5592("0x429")](h,t){const x=this[a0_0x5592("0x8a0")],c=this["enemyCom"]["edata"],d=[-25,25],u=[this[a0_0x5592("0x5a7")](-25,100),this["getVec2"](25,100)],r=[];for(let t=0;t<2;t++){const e=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x97b")],this[a0_0x5592("0x4ba")]),a=e[a0_0x5592("0x751")](Gt);a[a0_0x5592("0x9f")]=u[t],a[a0_0x5592("0x2b1")]=x,e[a0_0x5592("0x6f7")](x["x"]+d[t],x["y"]),this["ins"][a0_0x5592("0x23a")]["addChild"](e),r["push"](e),this["lines"][a0_0x5592("0x626")](e)}Laya["timer"]["once"](1e3,this,()=>{for(let t=0;t<r[a0_0x5592("0xb0e")];t++){const i=r[t];i[a0_0x5592("0xaa4")](),this["lines"][a0_0x5592("0x3c8")](this["lines"][a0_0x5592("0x779")](i),1)}if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;let t=500,e=0;const a=()=>{for(let i=0;i<d[a0_0x5592("0xb0e")];i++){const r=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],this[a0_0x5592("0x3eb")]);let t=r["getComponent"](X);t||(t=r[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](h||c["att"],0,0,0,0);const s=r["getComponent"](f);s[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1);let e=this[a0_0x5592("0xce")](),a=this[a0_0x5592("0xce")]();const n=this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")],o=-x[a0_0x5592("0x3b0")]/180*Math["PI"],l=u[i]["x"]*Math[a0_0x5592("0x2d9")](o)+u[i]["y"]*Math[a0_0x5592("0x2d2")](o),_=u[i]["y"]*Math[a0_0x5592("0x2d9")](o)-u[i]["x"]*Math[a0_0x5592("0x2d2")](o);r[a0_0x5592("0x6f7")](x["x"]+l,x["y"]+_),Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](n["x"]+d[i],n["y"]),this["getVec3"](r["x"],r["y"]),e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](e,a),s[a0_0x5592("0x918")]=a,s["state"]=P["START"],this["ins"]["eneBulNode"][a0_0x5592("0x231")](r)}t>100&&(t-=50),t<=100&&e++,e>15?Laya["timer"][a0_0x5592("0x149")](this,a):Laya["timer"][a0_0x5592("0x724")](t,this,a)};a()})}[a0_0x5592("0x32")](n,o){const l=this["owner"],_=this[a0_0x5592("0x8a4")],h=this["enemyCom"][a0_0x5592("0x2e2")],x=[[-40,-10],[40,-10],[-40,55],[40,55]],c=[135,45,-135,-45];this[a0_0x5592("0xaf2")](100,()=>{if(this["ins"]["gameState"]!=P[a0_0x5592("0xa5")])return;if(this["getRes"](b[a0_0x5592("0x1")]))for(let i=0;i<x[a0_0x5592("0xb0e")];i++){const r=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x55b")],this[a0_0x5592("0x3cb")]);let t=r["getComponent"](X);t||(t=r[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](n||h[a0_0x5592("0x644")],0,0,0,0);const s=r[a0_0x5592("0x751")](Xt);s[a0_0x5592("0x24e")]=b["E_Hxb"],s["xv"]=Math[a0_0x5592("0x45c")](c[i])>90?-1:1;let e=Math[a0_0x5592("0xc0")](c[i]/180*Math["PI"]),a=new Laya[a0_0x5592("0x97c")](0,0,0);Laya["Vector3"][a0_0x5592("0x2c0")](new Laya[a0_0x5592("0x97c")](1,-e,0),a),a["x"]*=s["xv"],s[a0_0x5592("0x918")]=a,s[a0_0x5592("0x4ad")]=c[i],s[a0_0x5592("0x2b1")]=this[a0_0x5592("0x5a7")](_[a0_0x5592("0x94d")]["x"],_[a0_0x5592("0x94d")]["y"]),s[a0_0x5592("0x5b6")]=o||h["bulletsp"],r[a0_0x5592("0x6f7")](l["x"]+x[i][0],l["y"]+x[i][1]),this[a0_0x5592("0x8a4")]["eneBulNode"][a0_0x5592("0x231")](r)}else S[a0_0x5592("0x1eb")]([b[a0_0x5592("0x1")]])},this,3)}[a0_0x5592("0xa2a")](a,i){const r=this["owner"],s=this["ins"],n=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],o=p[n["type"]]["b1"];if(this["ins"][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")])for(let t=0;t<1;t++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xa1d")],this[a0_0x5592("0x8a5")]);let t=l[a0_0x5592("0x751")](X);t||(t=l[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](a||n[a0_0x5592("0x644")],0,0,0,0);const _=l["getComponent"](zt);_[a0_0x5592("0x2b1")]=r,_["norV3"]=this[a0_0x5592("0xce")](0,1);let e=this[a0_0x5592("0xce")]();_[a0_0x5592("0x5b6")]=i||n["bulletsp"],l[a0_0x5592("0x6f7")](r["x"]+o[0]["x"],r["y"]+o[0]["y"]),Laya[a0_0x5592("0x97c")]["subtract"](this[a0_0x5592("0xce")](s[a0_0x5592("0x94d")]["x"],s[a0_0x5592("0x94d")]["y"]),this["getVec3"](l["x"],l["y"]),e),Laya["Vector3"][a0_0x5592("0x2c0")](e,_["norV3"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](l)}}[a0_0x5592("0x268")](t){if(!t)return;const i=this[a0_0x5592("0x8a0")],r=this["enemyCom"][a0_0x5592("0x2e2")],s=p[r[a0_0x5592("0xb2e")]]["b1"];for(let t=0;t<1;t++){const n=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x8dd")],this[a0_0x5592("0x552")]);let t=n["getComponent"](X);t||(t=n[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](r[a0_0x5592("0x644")],0,0,0,0);const o=n["getComponent"](f);n[a0_0x5592("0x6f7")](i["x"]+s[0]["x"],i["y"]+s[0]["y"]),o[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1);let e=this[a0_0x5592("0xce")](),a=this["ins"]["playerV2"];Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](a["x"],a["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](e,o["norV3"]),o[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],o[a0_0x5592("0x5b6")]=r[a0_0x5592("0x277")],this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")]["addChild"](n)}}[a0_0x5592("0x516")](r,s){const t=this[a0_0x5592("0x8a0")],n=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],o=[-10,10],l=[1,-1,-1,1],e=n[a0_0x5592("0x764")]||1;let _=null,h=0;const x=p[n["type"]]["b1"];this[a0_0x5592("0xaf2")](300,()=>{if(this[a0_0x5592("0x761")](b[a0_0x5592("0x85b")])){_||(_=this[a0_0x5592("0xce")](t["x"],t["y"]));for(let e=0;e<o[a0_0x5592("0xb0e")];e++){const a=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0xa39")],this[a0_0x5592("0x210")]);let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](r||n[a0_0x5592("0x644")],0,0,0,0);const i=a["getComponent"](Wt);i[a0_0x5592("0x5b6")]=s||n[a0_0x5592("0x277")],i["xv"]=l[h],i[a0_0x5592("0x450")]=-Math["PI"]/2,i[a0_0x5592("0x2b1")]=null,a["pos"](_["x"]+o[e]+x[0]["x"],_["y"]+x[0]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](a),++h>=l[a0_0x5592("0xb0e")]&&(h=0)}}else S[a0_0x5592("0x1eb")]([b["E_DaoDan"]])},this,2*e)}}var qt;!function(t){t[t[a0_0x5592("0x3a0")]=0]=a0_0x5592("0x3a0"),t[t[a0_0x5592("0x5ec")]=1]=a0_0x5592("0x5ec"),t[t[a0_0x5592("0x99c")]=2]=a0_0x5592("0x99c")}(qt||(qt={}));class Zt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x5e")]=0,this[a0_0x5592("0x99e")]=null,this["end"]=null,this["pt"]=null,this[a0_0x5592("0x697")]=.02,this["endMsg"]=!1,this[a0_0x5592("0xaea")]=!1,this[a0_0x5592("0x6a2")]=!0,this[a0_0x5592("0x9c8")]=0,this[a0_0x5592("0x489")]=0,this[a0_0x5592("0xb3")]=!1,this["eskillCom"]=null,this[a0_0x5592("0x931")]=!1,this[a0_0x5592("0x4c1")]=0,this[a0_0x5592("0xcc")]=0,this[a0_0x5592("0x987")]=0,this["ske"]=null,this[a0_0x5592("0xa02")]=null,this[a0_0x5592("0x79")]=null,this[a0_0x5592("0x389")]=3,this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this[a0_0x5592("0x403")]=qt[a0_0x5592("0x3a0")],this[a0_0x5592("0x2e2")]=null,this["isRotate"]=!1,this[a0_0x5592("0x765")]=!1,this[a0_0x5592("0x962")]=!1,this[a0_0x5592("0x5ff")]=0,this["isPauseSelf"]=!1,Zt[a0_0x5592("0x2ad")]++,this[a0_0x5592("0xa02")]=Zt[a0_0x5592("0x2ad")]}get[a0_0x5592("0x918")](){return this["_norV3"]}set[a0_0x5592("0x918")](t){this["_norV3"]=t;const e=this[a0_0x5592("0x8a0")];e&&this[a0_0x5592("0x765")]&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this["state"]=P["START"],this["moveState"]=qt[a0_0x5592("0x3a0")],this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x5e")]=0,this[a0_0x5592("0x9c8")]=0,this[a0_0x5592("0x489")]=0,this[a0_0x5592("0xb3")]=!1,this[a0_0x5592("0x226")]=!1,this[a0_0x5592("0xaea")]=!1,this[a0_0x5592("0x6a2")]=!0,this["barNums"]=3,this[a0_0x5592("0x962")]=!1,this[a0_0x5592("0x739")]&&(this[a0_0x5592("0x739")][a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]]),!this[a0_0x5592("0x2e2")])return;this["eskillCom"]=this[a0_0x5592("0x8a0")]["getComponent"](jt);const r=this[a0_0x5592("0x2e2")],e=this[a0_0x5592("0x8a0")];e[a0_0x5592("0x3b0")]=0,this[a0_0x5592("0x79")]=e[a0_0x5592("0xab9")](a0_0x5592("0x79")),1017==r[a0_0x5592("0xb2e")]&&(this[a0_0x5592("0x35e")]=P[a0_0x5592("0x953")],Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](2e3,this,()=>{this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]}));const t=$[a0_0x5592("0x4e0")][r[a0_0x5592("0xb2e")]];if(t[a0_0x5592("0xa9e")]){const s=t["skill"];12==s&&(this[a0_0x5592("0x765")]=!0,this[a0_0x5592("0x38")]=!0),17==s&&(this[a0_0x5592("0x765")]=!0)}this[a0_0x5592("0x99e")]=r["in"]["clone"](),r[a0_0x5592("0xa65")]==c[a0_0x5592("0x6f1")]?this[a0_0x5592("0x99e")]["y"]-=e[a0_0x5592("0x1c1")]:r["direntry"]==c[a0_0x5592("0x801")]?this[a0_0x5592("0x99e")]["x"]-=e[a0_0x5592("0x481")]:r[a0_0x5592("0xa65")]==c[a0_0x5592("0x3aa")]?this[a0_0x5592("0x99e")]["x"]+=e[a0_0x5592("0x481")]:r[a0_0x5592("0xa65")]==c[a0_0x5592("0xa94")]&&(this[a0_0x5592("0x99e")]["y"]+=e[a0_0x5592("0x1c1")]);const o=this[a0_0x5592("0x99e")];if(e[a0_0x5592("0x6f7")](o["x"],o["y"]),r[a0_0x5592("0x99f")]){this[a0_0x5592("0x6f2")]=r[a0_0x5592("0x99f")][a0_0x5592("0x408")](),r[a0_0x5592("0x473")]!=x["Repeat"]&&r[a0_0x5592("0x473")]!=x["Remove"]||(r[a0_0x5592("0xa38")]==c["Top"]?this[a0_0x5592("0x6f2")]["y"]-=e["height"]:r[a0_0x5592("0xa38")]==c[a0_0x5592("0x801")]?this[a0_0x5592("0x6f2")]["x"]-=e["width"]:r[a0_0x5592("0xa38")]==c[a0_0x5592("0x3aa")]?this[a0_0x5592("0x6f2")]["x"]+=e["width"]:r[a0_0x5592("0xa38")]==c[a0_0x5592("0xa94")]&&(this["end"]["y"]+=e[a0_0x5592("0x1c1")]));const l=this["end"];if(r[a0_0x5592("0x6f")]==h["Line"]){let t=this[a0_0x5592("0xce")](),e=this["getVec3"]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](l["x"],l["y"]),this["getVec3"](o["x"],o["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,e),this[a0_0x5592("0x918")]=e}else if(r[a0_0x5592("0x6f")]==h[a0_0x5592("0x12a")]){let t=this[a0_0x5592("0x5a7")](l["x"]-o["x"],l["y"]-o["y"]),e=this[a0_0x5592("0x5a7")](o["x"]+t["x"]/2,o["y"]+t["y"]/2),a=this[a0_0x5592("0x5a7")](-t["y"],t["x"]);t["x"]<0&&(a=this["getVec2"](t["y"],-t["x"]));let i=this[a0_0x5592("0x5a7")](e["x"]+a["x"]/4,e["y"]+a["y"]/4),r=2*i["x"]-(o["x"]+l["x"])/2,s=2*i["y"]-(o["y"]+l["y"])/2,n=this["getVec2"](r,s);this["pt"]=n}else if(r[a0_0x5592("0x6f")]==h[a0_0x5592("0xf1")]){let t=this["getVec2"](l["x"]-o["x"],l["y"]-o["y"]),e=this[a0_0x5592("0x5a7")](o["x"]+t["x"]/2,o["y"]+t["y"]/2),a=this[a0_0x5592("0x5a7")](t["y"],-t["x"]);t["x"]<0&&(a=this[a0_0x5592("0x5a7")](-t["y"],t["x"]));let i=this["getVec2"](e["x"]+a["x"]/4,e["y"]+a["y"]/4),r=2*i["x"]-(o["x"]+l["x"])/2,s=2*i["y"]-(o["y"]+l["y"])/2,n=this[a0_0x5592("0x5a7")](r,s);this["pt"]=n}}else{let t=a0_0x5592("0x993")==typeof r[a0_0x5592("0x588")]&&r[a0_0x5592("0x588")]?r[a0_0x5592("0x588")]:0;this["end"]=this[a0_0x5592("0x5a7")](r["in"]["x"]+t,r["in"]["y"]+r[a0_0x5592("0x608")]);let e=this["end"],a=this[a0_0x5592("0xce")](),i=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")]["subtract"](this[a0_0x5592("0xce")](e["x"],e["y"]),this[a0_0x5592("0xce")](o["x"],o["y"]),a),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](a,i),this[a0_0x5592("0x918")]=i}let a=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](this[a0_0x5592("0x6f2")]["x"],this[a0_0x5592("0x6f2")]["y"]),this["getVec3"](o["x"],o["y"]),a);let i=Math[a0_0x5592("0x4e6")](a["x"]*a["x"]+a["y"]*a["y"]);if(this["bspeed"]=300/i*.02*(r[a0_0x5592("0x5b6")]||1),this[a0_0x5592("0x931")]=!1,this["randty"]=0,this[a0_0x5592("0xcc")]=0,this[a0_0x5592("0x4c1")]=0,r["type"]>2e3&&r["type"]<3e3&&this[a0_0x5592("0xa32")](),a0_0x5592("0x993")==typeof r[a0_0x5592("0xd6")]&&r[a0_0x5592("0xd6")]){this[a0_0x5592("0x962")]=!0,e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this["norV3"]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180);let t=e["rotation"];t%=360,Math[a0_0x5592("0x45c")](t)>180&&(t<0?t=360+t:t-=360),this[a0_0x5592("0x5ff")]=t}}[a0_0x5592("0xa32")](e){const a=[a0_0x5592("0x62e"),"battle/main/bar/xue_max1.png",a0_0x5592("0x45f")];if(null==e)this["hpBar"]["skin"]=a[0];else{const i=this[a0_0x5592("0x2e2")]["hp"];let t=0;e>i/3*1&&e<=i/3*2?(3==this[a0_0x5592("0x389")]&&(this["barNums"]--,this[a0_0x5592("0x79")]["value"]=1),t=1):e<=i/3&&(2==this["barNums"]&&(this[a0_0x5592("0x389")]--,this[a0_0x5592("0x79")]["value"]=1),t=2),this[a0_0x5592("0x79")][a0_0x5592("0x8fa")]=a[t]}}[a0_0x5592("0x4fd")](){Laya["timer"][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x77a")](this["owner"])}[a0_0x5592("0x465")](t,e,a,i,r){r?(t["x"]=(1-e)*(1-e)*a["x"]+2*e*(1-e)*r["x"]+e*e*i["x"],t["y"]=(1-e)*(1-e)*a["y"]+2*e*(1-e)*r["y"]+e*e*i["y"]):(t["x"]=a["x"]+(i["x"]-a["x"])*e,t["y"]=a["y"]+(i["y"]-a["y"])*e)}[a0_0x5592("0xa87")](t){return-((t-=1)*t*t*t-1)}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P["START"])return;if(!this["edata"])return;const s=this["owner"],a=this[a0_0x5592("0x2e2")];let n=Laya[a0_0x5592("0x6ec")]["delta"];if(this["moveState"]==qt[a0_0x5592("0x3a0")]){if(this[a0_0x5592("0x5e")]>=.2&&(this[a0_0x5592("0xaea")]||(this[a0_0x5592("0xaea")]=!0,R[a0_0x5592("0xcf")](F[a0_0x5592("0x7fb")]))),this[a0_0x5592("0x5e")]>=1){if(this[a0_0x5592("0x226")]||(this[a0_0x5592("0x226")]=!0,this[a0_0x5592("0x9e3")]&&1026!=a[a0_0x5592("0xb2e")]&&(a["type"]<2e3||a[a0_0x5592("0xb2e")]>3e3)&&this["eskillCom"][a0_0x5592("0x141")](),this[a0_0x5592("0x2e2")][a0_0x5592("0x473")]==x[a0_0x5592("0x1b9")]&&(R[a0_0x5592("0xcf")](F["EnemyDead"],[s[a0_0x5592("0x751")](W),!0]),s["removeSelf"]())),a0_0x5592("0x993")==typeof a[a0_0x5592("0x473")]){const t=a[a0_0x5592("0x473")];if(t==x[a0_0x5592("0x1dd")]){const e=this[a0_0x5592("0x99e")][a0_0x5592("0x408")]();this[a0_0x5592("0x99e")]=this["end"][a0_0x5592("0x408")](),this[a0_0x5592("0x6f2")]=e,this[a0_0x5592("0x918")]&&(this[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](-this["norV3"]["x"],-this[a0_0x5592("0x918")]["y"])),this[a0_0x5592("0x6a2")]&&R[a0_0x5592("0xcf")](F[a0_0x5592("0x5c3")],this["going"]),this["going"]=!this[a0_0x5592("0x6a2")]}else x[a0_0x5592("0x3be")];this[a0_0x5592("0x5e")]=0}else this[a0_0x5592("0x403")]=qt[a0_0x5592("0x99c")];return}if(this[a0_0x5592("0x9c8")]>=1e3)return this["moveState"]=qt["Pause"],void(this["moveTime"]=0);const i=this[a0_0x5592("0x99e")],r=this[a0_0x5592("0x6f2")];if(a[a0_0x5592("0x6f")]==h[a0_0x5592("0x384")]){let t=this["bspeed"];this[a0_0x5592("0x6a2")]||(t*=2),this["btimer"]+=t;let e=this[a0_0x5592("0x5e")];"null"===a[a0_0x5592("0x473")]&&(e=this[a0_0x5592("0xa87")](e)),s["x"]=i["x"]+(r["x"]-i["x"])*e,s["y"]=i["y"]+(r["y"]-i["y"])*e,this[a0_0x5592("0x38")]&&(this[a0_0x5592("0x9c8")]+=n),this[a0_0x5592("0x962")]&&(s[a0_0x5592("0x3b0")]=this[a0_0x5592("0x5ff")]+(0-this[a0_0x5592("0x5ff")])*e)}else this[a0_0x5592("0x5e")]+=this[a0_0x5592("0x697")],this["bezier"](s,this[a0_0x5592("0x5e")],this[a0_0x5592("0x99e")],this[a0_0x5592("0x6f2")],this["pt"]),this[a0_0x5592("0x962")]&&(s[a0_0x5592("0x3b0")]=this[a0_0x5592("0x5ff")]+(0-this[a0_0x5592("0x5ff")])*this["btimer"])}if(this[a0_0x5592("0x403")]==qt["Pause"]){if(this["pauseTime"]>=500)return this[a0_0x5592("0x403")]=qt[a0_0x5592("0x3a0")],this[a0_0x5592("0x489")]=0,void(this[a0_0x5592("0xb3")]=!1);this[a0_0x5592("0xb3")]||(this[a0_0x5592("0xb3")]=!0,R["event"](F["EnemyPause"],this["eid"])),this["pauseTime"]+=n}if(this[a0_0x5592("0x403")]==qt[a0_0x5592("0x99c")]){this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]/1e3;let t=Math[a0_0x5592("0x2d9")](this["timer"]);if(Math[a0_0x5592("0x45c")](t)>=.999){if(!this[a0_0x5592("0x931")])if(this[a0_0x5592("0x931")]=!0,this[a0_0x5592("0x4c1")]>=0){let t=[-1,0,1],e=O["getRandom"](2,0);this["randty"]=t[e],this["randpy"]=O[a0_0x5592("0x7de")](4,2)/10,this[a0_0x5592("0x4c1")]=0}else this[a0_0x5592("0x4c1")]++}else this[a0_0x5592("0x931")]=!1;2003!=a[a0_0x5592("0xb2e")]&&(s["x"]+=t);const o=2003==a["type"]?5:1;s["y"]+=t*this[a0_0x5592("0x987")]*this[a0_0x5592("0xcc")]*o}if(this[a0_0x5592("0xaaa")]){let t=this[a0_0x5592("0x8a4")][a0_0x5592("0x94d")],e=s["x"]-t["x"],a=s["y"]-t["y"],i=Math[a0_0x5592("0x23d")](e,-a)/Math["PI"]*180,r=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](this[a0_0x5592("0xce")](s[a0_0x5592("0x3b0")]),this[a0_0x5592("0xce")](i),n/500,r),s["rotation"]=r["x"]}}}Zt[a0_0x5592("0x2ad")]=0;class Kt extends t{constructor(){super(),this[a0_0x5592("0x154")]=250}[a0_0x5592("0x880")](){const t=this["owner"][a0_0x5592("0x753")];let e={1001:1,1002:1,1003:1,1004:1,1005:1,1006:1,1007:1,1008:1,1009:1,1010:1,1011:1,1012:1,1013:1,1014:1,1015:1,1016:1,2001:10,2002:10,2003:10,3001:1,3002:1,hit:1.2}[t]||1;const a=this[a0_0x5592("0x8a0")]["getChildByName"](a0_0x5592("0x8ae"));a[a0_0x5592("0xa20")](e,e),a[a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")],a["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}),a["templet"]?(a["playbackRate"](1),t>2e3&&t<3e3&&a[a0_0x5592("0x7c2")](.3),a[a0_0x5592("0x590")](0,!1)):Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](this[a0_0x5592("0x154")],this,()=>{this["owner"][a0_0x5592("0xaa4")]()})}[a0_0x5592("0x4fd")](){const t=this[a0_0x5592("0x8a0")][a0_0x5592("0xab9")]("boom");t[a0_0x5592("0x5c7")](this),t["stop"](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}}class Qt extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["move"]=!1,this[a0_0x5592("0x3a5")]=0,this[a0_0x5592("0x909")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"];const t=this["owner"][a0_0x5592("0x433")](0)[a0_0x5592("0x6bc")]["material"];t[a0_0x5592("0xa54")]=Laya[a0_0x5592("0x58b")][a0_0x5592("0x35")],t[a0_0x5592("0x125")]=1,this[a0_0x5592("0x3a5")]=0}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x34c")](t){const e=this[a0_0x5592("0x8a0")],a=(this[a0_0x5592("0xce")](),this[a0_0x5592("0xce")]());Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](t,e[a0_0x5592("0x48b")][a0_0x5592("0x93a")],a),this[a0_0x5592("0x909")]=this["getVec3"](a["x"]/2,a["y"]/2,a["z"]/1),this[a0_0x5592("0x5cc")]=!0,Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x909")],{x:0,y:0,z:.04},300,Laya[a0_0x5592("0x4ec")]["circOut"],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{}))}[a0_0x5592("0x2fa")](){const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x8a4")][a0_0x5592("0xacc")],a=(Ut[a0_0x5592("0x4e")],t[a0_0x5592("0x433")](0)[a0_0x5592("0x6bc")]["material"]);a["renderMode"]=Laya["BlinnPhongMaterial"][a0_0x5592("0x35")],a[a0_0x5592("0x125")]=1,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{Laya["Tween"]["to"](a,{albedoColorA:0},200)}),Laya[a0_0x5592("0x6eb")]["to"](t["transform"],{localPositionX:e["x"],localPositionY:e["y"],localPositionZ:e["z"]},400,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0xb04")],a0_0x5592("0x7e0")),t[a0_0x5592("0xaa4")]()}))}["onUpdate"](){const t=this[a0_0x5592("0x8a4")];if(t[a0_0x5592("0x547")]!=P["START"])return;const e=this[a0_0x5592("0x8a0")];e["transform"][a0_0x5592("0xa5f")](this[a0_0x5592("0xce")](0,.08,0)),this[a0_0x5592("0x5cc")]&&(e[a0_0x5592("0x48b")][a0_0x5592("0x93a")]["z"]>=t[a0_0x5592("0xacc")]["z"]&&(this[a0_0x5592("0x5cc")]=!1,this["moveCoin"]()),e[a0_0x5592("0x48b")][a0_0x5592("0x2dc")](this[a0_0x5592("0x909")],!1),Math[a0_0x5592("0x45c")](e[a0_0x5592("0x48b")][a0_0x5592("0x93a")]["z"]-t[a0_0x5592("0xacc")]["z"])<=3&&(this[a0_0x5592("0x5cc")]=!1,this[a0_0x5592("0x2fa")]()))}}class Jt extends t{constructor(){super(),this["xp"]=null,this["yp"]=null}[a0_0x5592("0x880")](){const t=this["owner"];t[a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")]["LIGHTER"],Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](100,this,()=>{t[a0_0x5592("0x27")]&&t[a0_0x5592("0x590")](1,!0)})}[a0_0x5592("0x4fd")](){this["xp"]=null,this["yp"]=null,this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}["onLateUpdate"](){if(this["xp"]&&this["yp"]){const t=this["owner"];t["x"]=this["xp"]["x"],t["y"]=this["yp"]["y"]}}}class $t extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["selfCol"]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x2b1")]=null,this[a0_0x5592("0x5b6")]=1.5,this["cross"]=!1,this[a0_0x5592("0x58a")]=1,this[a0_0x5592("0x627")]=null}get["norV3"](){return this[a0_0x5592("0x355")]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e["rotation"]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),R["on"](F[a0_0x5592("0x21c")],this,()=>{this[a0_0x5592("0x35e")]=P["START"]});const a=this[a0_0x5592("0x8a4")],i=this[a0_0x5592("0x8a0")];if(i[a0_0x5592("0x1d4")]){const r=new Laya[a0_0x5592("0x745")],s=this["getRes"](b[a0_0x5592("0xb31")]),n=Laya["Sprite3D"][a0_0x5592("0x2f3")](s);r["addChild"](n),a["modSceneV3"][a0_0x5592("0xab9")](a0_0x5592("0xd"))["addChild"](r);let t=this[a0_0x5592("0xce")]();a[a0_0x5592("0x4bc")]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](i["x"],i["y"]),t),r[a0_0x5592("0x48b")]["position"]=t,this["s3d"]=r;let e=this[a0_0x5592("0xce")]();a[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this["getVec3"](i["x"]+150*this[a0_0x5592("0x918")]["x"],i["y"]+150*this["norV3"]["y"]),e),Laya[a0_0x5592("0x6eb")]["to"](r[a0_0x5592("0x48b")],{localPositionX:e["x"],localPositionZ:e["z"]},100),"fyp"==i[a0_0x5592("0x1d4")]&&Laya[a0_0x5592("0x6ec")]["loop"](50,this,()=>{n&&n[a0_0x5592("0x48b")]&&Laya[a0_0x5592("0x6eb")]["to"](n[a0_0x5592("0x48b")],{localPositionX:.05},25,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{n&&n[a0_0x5592("0x48b")]&&Laya[a0_0x5592("0x6eb")]["to"](n[a0_0x5592("0x48b")],{localPositionX:-.05},25)}))})}}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x627")]&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}),this[a0_0x5592("0x627")]=null,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x3f3")]||this["owner"][a0_0x5592("0xaa4")]()}["onCollisionExit"](t,e){}["onLateUpdate"](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P["START"])return;if(this["state"]!=P[a0_0x5592("0xa5")])return;const e=this[a0_0x5592("0x8a0")];let t=Laya["timer"][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")]*this["addSpeed"],a=this[a0_0x5592("0x8a4")][a0_0x5592("0x747")];if(this[a0_0x5592("0x2b1")]&&!this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]&&(this[a0_0x5592("0x2b1")]=null),this[a0_0x5592("0x2b1")]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")])if(e["y"]<=this[a0_0x5592("0x2b1")]["y"]||this["tar"]["x"]<=0||this["tar"]["x"]>=720||this[a0_0x5592("0x2b1")]["y"]<=0||this["tar"]["y"]>=1280)this[a0_0x5592("0x2b1")]=null;else{let t=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this["tar"]["x"],this[a0_0x5592("0x2b1")]["y"]),this["getVec3"](e["x"],e["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,this[a0_0x5592("0x918")])}e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),e["x"]+=t*this[a0_0x5592("0x918")]["x"],e["y"]+=t*this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x627")]&&this[a0_0x5592("0x627")]["transform"]["translate"](this[a0_0x5592("0xce")](this[a0_0x5592("0x918")]["x"]/a*t,0,this[a0_0x5592("0x918")]["y"]/a*t)),(e["x"]<=-360||e["x"]>=1080||e["y"]<=-640||e["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this["quadTree"][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")]["enemyCols"],this[a0_0x5592("0x1b2")])}}class te extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0xa17")]=null,this[a0_0x5592("0x9e3")]=null,this[a0_0x5592("0x596")]="",this[a0_0x5592("0x5d1")]=null,this["templet"]=null,this["ske"]=null,this["skn"]=null,this[a0_0x5592("0xb29")]=!1}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0xaa7")]=null,this[a0_0x5592("0xb29")]=!1,this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),this[a0_0x5592("0x9e3")]=this[a0_0x5592("0x8a0")]["getComponent"](jt),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")]["edata"])return;const s=this["enemyCom"][a0_0x5592("0x2e2")],t=new Laya[a0_0x5592("0x404")];this[a0_0x5592("0x27")]=t,t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0xae4")],this,this[a0_0x5592("0x8df")]),t[a0_0x5592("0x961")](d[this[a0_0x5592("0x596")]]),R["on"](F[a0_0x5592("0x560")],this,(t,e,a,i)=>{if(e!=this[a0_0x5592("0xa17")][a0_0x5592("0xa02")])return;if(t!=s[a0_0x5592("0xb2e")])return;this[a0_0x5592("0xaa7")]=i,this["spec"]=!1;let r=0;7==a&&(r=1500,this[a0_0x5592("0xb29")]=!0),14==a&&(r=1e3,this[a0_0x5592("0xb29")]=!0),this[a0_0x5592("0x739")]&&(this["spec"]&&i(),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](r,this,()=>{this[a0_0x5592("0x739")][a0_0x5592("0x590")](0,!1)}))})}["onDisable"](){this[a0_0x5592("0x739")]&&(this["ske"][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")]["stop"](),this[a0_0x5592("0x739")]["removeSelf"]()),this[a0_0x5592("0x27")]&&(this[a0_0x5592("0x27")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x27")][a0_0x5592("0x64b")]())}[a0_0x5592("0x8df")](){this[a0_0x5592("0x739")]=this[a0_0x5592("0x27")][a0_0x5592("0x656")](0);const t=this[a0_0x5592("0x739")],e=p[this[a0_0x5592("0x596")]];t["pos"](e["self"]["x"],e[a0_0x5592("0x935")]["y"]),t["on"](Laya[a0_0x5592("0x690")]["LABEL"],this,this[a0_0x5592("0x7c8")]),t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,this[a0_0x5592("0x73a")]),t["play"](1,!0),t[a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]],this[a0_0x5592("0x5d1")][a0_0x5592("0x231")](t)}["completeHandler"](){this[a0_0x5592("0x739")][a0_0x5592("0x590")](1,!0)}["onEvent"](t){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&!this["spec"]&&this[a0_0x5592("0xaa7")]&&this[a0_0x5592("0xaa7")]()}[a0_0x5592("0x3de")](){}}class ee extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["enemyCom"]=null,this[a0_0x5592("0x9e3")]=null,this[a0_0x5592("0x739")]=null,this["skn"]=null,this[a0_0x5592("0xb29")]=!1,this[a0_0x5592("0x617")]=!1}[a0_0x5592("0x880")](){if(this["ins"]=Y[a0_0x5592("0x173")],this[a0_0x5592("0xaa7")]=null,this[a0_0x5592("0xb29")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),this["eskillCom"]=this["owner"][a0_0x5592("0x751")](jt),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")])return;const s=this[a0_0x5592("0xa17")]["edata"];this[a0_0x5592("0x739")]["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x6e6")],this,this[a0_0x5592("0x7c8")]),this[a0_0x5592("0x739")]["on"](Laya["Event"][a0_0x5592("0x992")],this,this[a0_0x5592("0x73a")]),R["on"](F[a0_0x5592("0x560")],this,(t,e,a,i)=>{if(e!=this[a0_0x5592("0xa17")][a0_0x5592("0xa02")])return;if(t!=s[a0_0x5592("0xb2e")])return;this[a0_0x5592("0xaa7")]=i,this["spec"]=!1;let r=0;7==a&&(r=1500,this[a0_0x5592("0xb29")]=!0),14==a&&(r=1e3,this[a0_0x5592("0xb29")]=!0),this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&(this[a0_0x5592("0xb29")]&&i(),Laya[a0_0x5592("0x6ec")]["once"](r,this,()=>{this[a0_0x5592("0x739")][a0_0x5592("0x590")](0,!1)}))}),this["ske"][a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]]}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x739")]&&(this[a0_0x5592("0x739")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")]["stop"]())}["parseComplete"](){this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&this[a0_0x5592("0x739")][a0_0x5592("0x590")](1,!0)}[a0_0x5592("0x73a")](){this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&this[a0_0x5592("0x739")]["play"](1,!0)}[a0_0x5592("0x7c8")](t){this["ins"][a0_0x5592("0x547")]==P["START"]&&!this[a0_0x5592("0xb29")]&&this[a0_0x5592("0xaa7")]&&this["skn"]()}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t[a0_0x5592("0x27")]&&(this["inited"]=!0,this[a0_0x5592("0x8df")]())}}class ae extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0xa17")]=null,this["buffNode"]=null,this[a0_0x5592("0xc6")]=null,this[a0_0x5592("0x648")]=null,this[a0_0x5592("0x9e6")]=null,this[a0_0x5592("0x1f")]=null,this[a0_0x5592("0x74e")]={},this[a0_0x5592("0x56d")]=!1,this["e1002"]=null,this[a0_0x5592("0x7db")]=0,this[a0_0x5592("0x42e")]=!0,this[a0_0x5592("0x98f")]=!1,this[a0_0x5592("0x79")]=null,this[a0_0x5592("0x5f4")]=1,this["hp"]=0,this[a0_0x5592("0x266")]={},this[a0_0x5592("0x9e6")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x17b")]),this["boomPre2"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x54f")])}["onEnable"](){this[a0_0x5592("0x8a4")]=Y["instance"];const t=this[a0_0x5592("0x8a0")];this[a0_0x5592("0x79")]=t["getChildByName"](a0_0x5592("0x79")),this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this["enemyCom"]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),this["hp"]=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")]["hp"],this[a0_0x5592("0x79")]["value"]=1,this[a0_0x5592("0x79")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x5f4")]=1,this[a0_0x5592("0x74e")]={},this[a0_0x5592("0x56d")]=!1,this[a0_0x5592("0x7db")]=0,this[a0_0x5592("0x42e")]=!0,this[a0_0x5592("0xa10")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](te),this["e1002"]||(this["e1002"]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](ee)),this[a0_0x5592("0xa10")]||(this[a0_0x5592("0xa10")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt)),R["on"](F[a0_0x5592("0x2ec")],this,t=>{let e=this[a0_0x5592("0x1b2")]["bids"]["indexOf"](t[a0_0x5592("0x639")]);e>-1&&(this["selfCol"][a0_0x5592("0x5aa")]["splice"](e,1),this[a0_0x5592("0x3ec")](t,this["selfCol"]))}),R["on"](F[a0_0x5592("0x5f3")],this,()=>{if(this[a0_0x5592("0x8a4")]["gameState"]==P[a0_0x5592("0x953")])for(const t in this[a0_0x5592("0x266")]){const e=this[a0_0x5592("0x266")][t];e&&e[a0_0x5592("0xa68")]&&e["hit"][a0_0x5592("0xaa4")]()}}),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e4,this,()=>{this["invincible"]=!1})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R["offAllCaller"](this),this[a0_0x5592("0x99b")]&&this[a0_0x5592("0x99b")][a0_0x5592("0xaa4")](),this["buffNode"]=null,this["buff2Node"]&&this[a0_0x5592("0xc6")]["removeSelf"](),this[a0_0x5592("0xc6")]=null,this[a0_0x5592("0x648")]&&this["buff3Node"]["removeSelf"](),this[a0_0x5592("0x648")]=null;for(const t in this["timers"]){const e=this["timers"][t];e&&e[a0_0x5592("0x6ec")]&&clearInterval(e[a0_0x5592("0x6ec")]),e&&e[a0_0x5592("0xa68")]&&e["hit"][a0_0x5592("0xaa4")]()}this[a0_0x5592("0x266")]={}}[a0_0x5592("0x3de")](){if(this[a0_0x5592("0x56d")]){const t=this[a0_0x5592("0xa10")];if(t){const e=t[a0_0x5592("0x739")];if(e){const a=e["filters"][0];if(this[a0_0x5592("0x42e")])a[a0_0x5592("0xac4")](10),this[a0_0x5592("0x7db")]+=10;else if(a[a0_0x5592("0xac4")](-10),this[a0_0x5592("0x7db")]-=10,this["hitnum"]<=0)return this[a0_0x5592("0x56d")]=!1,this[a0_0x5592("0x7db")]=0,void(this[a0_0x5592("0x42e")]=!0);this[a0_0x5592("0x7db")]>=50&&this["add"]&&(this["add"]=!1),this["hitnum"]<=0&&!this[a0_0x5592("0x42e")]&&(this[a0_0x5592("0x42e")]=!0)}}}}[a0_0x5592("0x849")](t,e,a){const i=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")],r=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")];if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const s=this[a0_0x5592("0x8a0")];if(!s||!s[a0_0x5592("0x2ed")])return void this[a0_0x5592("0x4fd")]();if(s["x"]<=-10||s["x"]>=730||s["y"]<=-10||s["y"]>=1290)return;if(!e||!e[a0_0x5592("0x8a0")]||!e["owner"][a0_0x5592("0x751")](X))return;const n=e["owner"][a0_0x5592("0x751")](X)["data"],o=this["ins"]["playerData"][a0_0x5592("0x53d")];let l=!1;if(o[V["Cri"]]&&r[a0_0x5592("0xb2e")]<2e3){let t=100*D[a0_0x5592("0x53d")][V[a0_0x5592("0x161")]][a0_0x5592("0x8de")]||0;O[a0_0x5592("0x7de")](100,1)<=t&&(l=!0,this["hp"]=0)}let _=n[a0_0x5592("0x1fa")],h=!1;const x=i[a0_0x5592("0xae1")];O[a0_0x5592("0x7de")](100,1)<=x&&(_*=i["critHurt"],h=!0),(_=Math[a0_0x5592("0x6fc")](_))<=0&&(_=1),this[a0_0x5592("0x56d")]||(this[a0_0x5592("0x56d")]=!0),a&&this["makeBoom"](a0_0x5592("0xa68"),e[a0_0x5592("0x8a0")]);const c=e["owner"][a0_0x5592("0x91f")];if(!this[a0_0x5592("0x98f")]&&(!c||c&&!this[a0_0x5592("0x74e")][c])){this["hp"]-=_,c&&!this["hits"][c]&&(this["hits"][c]=1,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](100,this,()=>{this[a0_0x5592("0x74e")][c]=0}));let a=this["hp"]>=0?this["hp"]:0;if(r[a0_0x5592("0xb2e")]>2e3&&r[a0_0x5592("0xb2e")]<3e3){this["enemyCom"]["isThreeBar"](this["hp"]);let t=this["enemyCom"]["edata"]["hp"]/3,e=a-(this[a0_0x5592("0xa17")][a0_0x5592("0x389")]-1)*t;this[a0_0x5592("0x5f4")]=e/t}else this[a0_0x5592("0x5f4")]=a/this[a0_0x5592("0xa17")]["edata"]["hp"];const d=this[a0_0x5592("0x79")]["value"],u=this["getRes"](w[a0_0x5592("0x4f3")]["HpBarLight"]),f=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x507")],u),p=275,m=22+275*this["barPor"],g=44+d*p-m;f[a0_0x5592("0x481")]=g<44?44:g,f["x"]=m,this[a0_0x5592("0x79")]["addChild"](f),this["hpBar"][a0_0x5592("0x143")]||1017==r["type"]||(this[a0_0x5592("0x79")][a0_0x5592("0x143")]=!0);const v=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["EnemyHPTip"],this[a0_0x5592("0x8a4")]["eneHPTipPre"]);l?(v[a0_0x5592("0x97e")]=l,v[a0_0x5592("0x1e3")]=a0_0x5592("0x9e")):(v[a0_0x5592("0x97e")]=h,v["text"]="-"+O["formatNumber"](Math[a0_0x5592("0x6fc")](_))),v["pos"](t["x"],this[a0_0x5592("0x8a0")]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0xa7e")][a0_0x5592("0x231")](v)}if(this["hp"]<=0){1019==r["type"]&&this[a0_0x5592("0x73b")](),this["onDisable"](),this["owner"][a0_0x5592("0xaa4")]();const y=$[a0_0x5592("0x4e0")][r[a0_0x5592("0xb2e")]][a0_0x5592("0x759")];if(y&&1==y&&(this[a0_0x5592("0x831")](this["ins"][a0_0x5592("0x8a0")]),this[a0_0x5592("0x831")](this[a0_0x5592("0x8a4")]["bgSceneV2"])),R[a0_0x5592("0xcf")](F["EnemyDead"],this["selfCol"]),this["makeBoom"](this["enemyCom"][a0_0x5592("0x2e2")][a0_0x5592("0xb2e")]),this[a0_0x5592("0x73c")](),o[V["DieBoom"]]&&this[a0_0x5592("0x308")](),o[V[a0_0x5592("0x303")]]&&this["makeDieShot"](),this[a0_0x5592("0x8a4")][a0_0x5592("0x3e4")]){let t=r["hp"]*this[a0_0x5592("0x8a4")]["suckBlood"];i[a0_0x5592("0x257")]+t<i["hp"]?i["currHP"]+=t:i[a0_0x5592("0x257")]=i["hp"],R["event"](F[a0_0x5592("0x2ff")])}if(o[V["SuckBlood"]]){let t=100*D[a0_0x5592("0x53d")][V[a0_0x5592("0x677")]][a0_0x5592("0x8de")]||0,e=r["hp"]*t;i[a0_0x5592("0x257")]+e<i["hp"]?i[a0_0x5592("0x257")]+=e:i[a0_0x5592("0x257")]=i["hp"],R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ff")])}if(this[a0_0x5592("0x8a4")][a0_0x5592("0x505")]){const T=[1002,1003,1014,1015,1018,1019],E=[1004,1005,1006,1007,1008,1009,1010,1011,1016,1017,1020,1021,1022,1024,1026,1028,1029],b=[1012,1013,1023,1025,1027],S=[2001,2002,2003];let t=0;[1001,3001][a0_0x5592("0x779")](r[a0_0x5592("0xb2e")])>-1?t=1:S["indexOf"](r["type"])>-1?t=150:b[a0_0x5592("0x779")](r[a0_0x5592("0xb2e")])>-1?t=50:E[a0_0x5592("0x779")](r["type"])>-1?t=30:T[a0_0x5592("0x779")](r[a0_0x5592("0xb2e")])>-1&&(t=15),i[a0_0x5592("0x537")]+=t,R[a0_0x5592("0xcf")](F[a0_0x5592("0x175")])}}}[a0_0x5592("0xae3")](t,e){const a=e?this[a0_0x5592("0x9e6")]:this[a0_0x5592("0x1f")],i=e?w[a0_0x5592("0x4f3")]["EnemyBoom"]:w[a0_0x5592("0x4f3")][a0_0x5592("0x54f")],r=this[a0_0x5592("0x4c9")](i,a);r["__$type$__"]=t;let s=this[a0_0x5592("0x8a0")];if(e)r["x"]=e["x"],r["y"]=e["y"],r[a0_0x5592("0x751")](Kt)[a0_0x5592("0x154")]=250,this["ins"][a0_0x5592("0xa7e")][a0_0x5592("0x231")](r);else{r["x"]=s["x"],r["y"]=s["y"],ae[a0_0x5592("0x1cb")]||(ae["booming"]=!0,Laya["SoundManager"][a0_0x5592("0x584")](at[a0_0x5592("0x8ef")]),setTimeout(()=>{ae[a0_0x5592("0x1cb")]=!1},300));const n=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0xa27")]),o=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0xa27")],n);o[a0_0x5592("0x6f7")](s["x"],s["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x23a")][a0_0x5592("0x231")](r),this[a0_0x5592("0x8a4")][a0_0x5592("0xa7e")]["addChild"](o)}}[a0_0x5592("0x73c")](t){const i=this["ins"],e=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],a=$[a0_0x5592("0x4e0")][e["type"]],r=i[a0_0x5592("0xa88")][a0_0x5592("0xab9")]("coins"),s=this[a0_0x5592("0x8a0")],n=this["getRes"](b["Coin"]);let o=a[a0_0x5592("0xaca")]||1;const l=[];let _=s[a0_0x5592("0x481")]/2;_>250&&(_=100);let h=Math["PI"]/180*Math[a0_0x5592("0x239")](360/o);if(1==o){const x=Math[a0_0x5592("0x2ee")](),c=Math[a0_0x5592("0x2ee")]();h=Math["PI"]/180*O["getRandom"](135,45);let t=s["x"]+_*Math[a0_0x5592("0x2d9")](h)*x,e=s["y"]-_*Math[a0_0x5592("0x2d2")](h)*c;l["push"](this[a0_0x5592("0xce")](t,e))}else if(2==o)for(let a=0;a<2;a++){const d=Math[a0_0x5592("0x2ee")](),u=Math[a0_0x5592("0x2ee")]();h=Math["PI"]/180*(a?135:45);let t=s["x"]+_*Math[a0_0x5592("0x2d9")](h)*d,e=s["y"]-_*Math[a0_0x5592("0x2d2")](h)*u;l[a0_0x5592("0x626")](this["getVec3"](t,e))}else for(let a=0;a<o;a++){const f=Math[a0_0x5592("0x2ee")]()*_,p=Math[a0_0x5592("0x2ee")]()*_;let t=s["x"]+Math["cos"](h*a)*f,e=s["y"]-Math[a0_0x5592("0x2d2")](h*a)*p;l[a0_0x5592("0x626")](this[a0_0x5592("0xce")](t,e))}for(let a=0;a<o;a++){const m=Laya[a0_0x5592("0x745")]["instantiate"](n);let t=this[a0_0x5592("0xce")](),e=this["getVec3"]();i[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this["getVec3"](l[a]["x"],l[a]["y"]),t),i[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](s["x"],s["y"]),e),m[a0_0x5592("0x48b")]["position"]=e,m[a0_0x5592("0x48b")][a0_0x5592("0x49b")]=this[a0_0x5592("0xce")](9,9,15),m[a0_0x5592("0x48b")]["rotationEuler"]=this[a0_0x5592("0xce")](-90,0,0),m[a0_0x5592("0x2a6")](Qt);const g=m[a0_0x5592("0x751")](Qt);r[a0_0x5592("0x231")](m),g["startMove"](t),Ut[a0_0x5592("0x4e")][a0_0x5592("0x51")]++}}[a0_0x5592("0x308")](){const t=this["ins"][a0_0x5592("0x4ca")],e=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["PlayerDieBoom"]),a=this[a0_0x5592("0x4c9")](w["battle"]["PlayerDieBoom"],e),i=this[a0_0x5592("0x8a0")];a["x"]=i["x"],a["y"]=i["y"];let r=a["getComponent"](X);r||(r=a[a0_0x5592("0x2a6")](X));const s=D[a0_0x5592("0x53d")][V[a0_0x5592("0x2a9")]][a0_0x5592("0x8de")]||1;r[a0_0x5592("0x971")](Math["floor"](t[a0_0x5592("0x1fa")]*s),t[a0_0x5592("0xae1")],t[a0_0x5592("0x2cd")],t[a0_0x5592("0x33f")],t[a0_0x5592("0xa49")]),this[a0_0x5592("0x8a4")]["effectNode"][a0_0x5592("0x231")](a)}[a0_0x5592("0x73b")](){const a=this[a0_0x5592("0x8a0")],i=this[a0_0x5592("0xa17")]["edata"],r=[];let t=O[a0_0x5592("0x7de")](90,30),e=-O[a0_0x5592("0x7de")](90,30),s=O[a0_0x5592("0x7de")](60,0)-30,n=s+10;const o=(t,e)=>{let a=Math[a0_0x5592("0xc0")](t/180*Math["PI"]),i=new Laya["Vector3"](0,0,0);return Laya["Vector3"][a0_0x5592("0x2c0")](new Laya[a0_0x5592("0x97c")](1,-a,0),i),e&&(i["x"]*=-1),i};let l=o(t),_=o(e),h=o(s),x=o(n);r["push"](l,_,h,x,o(t,!0),o(e,!0),o(s,!0),o(n,!0));const c=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x63d")]);for(let e=0;e<8;e++){const d=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x63d")],c),u=d[a0_0x5592("0x751")](f);let t=d[a0_0x5592("0x751")](X);t||(t=d[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](i["att"]||1,0,0,0,0),u[a0_0x5592("0x5b6")]=i["bulletsp"]||1.2,u["norV3"]=r[e][a0_0x5592("0x408")](),u[a0_0x5592("0x35e")]=P["START"],d[a0_0x5592("0x6f7")](a["x"],a["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")]["addChild"](d)}}["makeDieShot"](){const a=this[a0_0x5592("0x8a0")],i=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")],r=[this[a0_0x5592("0xce")](0,-1),this["getVec3"](.71,-.71),this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](.71,.71),this[a0_0x5592("0xce")](0,1),this[a0_0x5592("0xce")](-.71,.71),this[a0_0x5592("0xce")](-1,0),this[a0_0x5592("0xce")](-.71,-.71)],s=this["getRes"](w["battle"][a0_0x5592("0x36a")]),n=D[a0_0x5592("0x53d")][V[a0_0x5592("0x303")]];for(let e=0;e<8;e++){const o=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x36a")],s),l=o[a0_0x5592("0x751")]($t);let t=o[a0_0x5592("0x751")](X);t||(t=o[a0_0x5592("0x2a6")](X));const _=D[a0_0x5592("0x53d")][V[a0_0x5592("0x303")]][a0_0x5592("0x8de")]||1;t["setData"](Math[a0_0x5592("0x6fc")](i[a0_0x5592("0x1fa")]*_),i["crit"],i["critHurt"],i[a0_0x5592("0x33f")],i[a0_0x5592("0xa49")]),l["speed"]=n[a0_0x5592("0x214")],l[a0_0x5592("0x918")]=r[e][a0_0x5592("0x408")](),l[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],l[a0_0x5592("0x2b1")]=null,o[a0_0x5592("0x6f7")](a["x"],a["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x1a9")][a0_0x5592("0x231")](o)}}["onCollisionEnter"](s,t,e){if(!(s["owner"]&&s[a0_0x5592("0x8a0")][a0_0x5592("0x2ed")]&&t["owner"]&&t["owner"][a0_0x5592("0x2ed")]))return;let n=s[a0_0x5592("0x8a0")];const a=this["owner"];let i=s["owner"][a0_0x5592("0x1d4")],r=!0;if((e||i&&i==B[a0_0x5592("0x6b6")])&&(n=t["owner"],r=!1),i&&(i==B[a0_0x5592("0x400")]||i==B["FIRE"])){if(r=!1,this[a0_0x5592("0xaf2")](1e3,()=>{this["onCollision"](t[a0_0x5592("0x8a0")],s)},this,4,null,!0),i==B[a0_0x5592("0x400")]&&!this[a0_0x5592("0x99b")]){const o=w[a0_0x5592("0x4f3")][a0_0x5592("0x81d")],l=this[a0_0x5592("0x761")](o),_=this[a0_0x5592("0x4c9")](o,l),h=a[a0_0x5592("0x433")](0);_[a0_0x5592("0x6f7")](h["x"],h["y"]),this[a0_0x5592("0x8a0")][a0_0x5592("0x231")](_),this[a0_0x5592("0x99b")]=_,Laya[a0_0x5592("0x6ec")]["once"](4e3,this,()=>{_[a0_0x5592("0xaa4")](),this[a0_0x5592("0x99b")]=null})}if(i==B[a0_0x5592("0xdb")]&&!this["buff2Node"]){const x=w[a0_0x5592("0x4f3")][a0_0x5592("0xa96")],c=this[a0_0x5592("0x761")](x),d=this[a0_0x5592("0x4c9")](x,c),u=a[a0_0x5592("0x433")](0);d[a0_0x5592("0x6f7")](u["x"],u["y"]),this[a0_0x5592("0x8a0")][a0_0x5592("0x231")](d),this["buff2Node"]=d,Laya[a0_0x5592("0x6ec")]["once"](4e3,this,()=>{d[a0_0x5592("0xaa4")](),this[a0_0x5592("0xc6")]=null})}}if(i&&i==B["ICE"]&&(r=!1,this[a0_0x5592("0xa17")]["state"]=P["PAUSE"],!this[a0_0x5592("0x648")])){const f=w["battle"][a0_0x5592("0x3bc")],p=this["getRes"](f),m=this[a0_0x5592("0x4c9")](f,p),g=a["getChildAt"](0);m[a0_0x5592("0x6f7")](g["x"],g["y"]),this["owner"][a0_0x5592("0x231")](m),this[a0_0x5592("0x648")]=m,Laya["timer"]["once"](3e3,this,()=>{m["removeSelf"](),this[a0_0x5592("0x648")]=null,this[a0_0x5592("0xa17")][a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]})}if(i&&i==B["LASER"]&&(r=!1),this[a0_0x5592("0x849")](n,s,r),this["timers"]&&i&&i==B[a0_0x5592("0x87e")]){let t=setInterval(()=>{this["onCollision"](n,s)},100);const v=()=>{if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=s[a0_0x5592("0x8a0")][a0_0x5592("0x3fd")];let e=w[a0_0x5592("0x4f3")][a0_0x5592("0x575")];1==t&&(e=w[a0_0x5592("0x4f3")][a0_0x5592("0xac6")]),2==t&&(e=w[a0_0x5592("0x4f3")][a0_0x5592("0x957")]);const a=this[a0_0x5592("0x761")](e),i=this[a0_0x5592("0x4c9")](e,a);i["x"]=n["x"],i["y"]=this[a0_0x5592("0x8a0")]["y"];const r=i["getComponent"](Jt);return r["xp"]=n,r["yp"]=this[a0_0x5592("0x8a0")],this[a0_0x5592("0x8a4")][a0_0x5592("0xa7e")][a0_0x5592("0x231")](i),i},y=this[a0_0x5592("0x266")][s["bid"]];if(y)if(y[a0_0x5592("0x6ec")]&&clearInterval(y["timer"]),this[a0_0x5592("0x266")][s[a0_0x5592("0x639")]][a0_0x5592("0x6ec")]=t,y[a0_0x5592("0xa68")]){const T=y[a0_0x5592("0xa68")][a0_0x5592("0x751")](Jt);T["xp"]=n,T["yp"]=this[a0_0x5592("0x8a0")]}else{const E=v();this[a0_0x5592("0x266")][s[a0_0x5592("0x639")]][a0_0x5592("0xa68")]=E}else{const b=v();this[a0_0x5592("0x266")][s["bid"]]={timer:t,hit:b}}}}[a0_0x5592("0x3ec")](t,e){if(!(t[a0_0x5592("0x8a0")]&&t[a0_0x5592("0x8a0")][a0_0x5592("0x2ed")]&&e[a0_0x5592("0x8a0")]&&e["owner"][a0_0x5592("0x2ed")]))return;let a=t[a0_0x5592("0x8a0")][a0_0x5592("0x1d4")];if(a&&a==B[a0_0x5592("0x87e")]){if(!this[a0_0x5592("0x266")])return;const i=this[a0_0x5592("0x266")][t[a0_0x5592("0x639")]];i&&(i[a0_0x5592("0x6ec")]&&clearInterval(i[a0_0x5592("0x6ec")]),i&&i[a0_0x5592("0xa68")]&&i[a0_0x5592("0xa68")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x266")][t["bid"]]=null)}}[a0_0x5592("0x5b4")](){let t=this["getVec3"]();Laya["Vector3"][a0_0x5592("0x2bb")](this[a0_0x5592("0xce")](this[a0_0x5592("0x79")]["value"]),this["getVec3"](this[a0_0x5592("0x5f4")]),.01*Laya[a0_0x5592("0x6ec")]["delta"],t),this[a0_0x5592("0x79")][a0_0x5592("0x8de")]=t["x"]}}ae[a0_0x5592("0x1cb")]=!1;class ie extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x6ec")]=0,this["eneQue"]={},this["start"]=!1,this[a0_0x5592("0x4e")]=null,this["enemyPres"]={},this["shipEnemys"]=[],this[a0_0x5592("0x58c")]=[],this[a0_0x5592("0xa")]=[],this["currBossEnemys"]=[],this[a0_0x5592("0x50f")]=[],this[a0_0x5592("0x89c")]=[],this[a0_0x5592("0x5a6")]=[],this[a0_0x5592("0x3f0")]={},this[a0_0x5592("0xa48")]=0;for(const t in u){const e=u[t];this["enemyPres"][t]=this["getRes"](e)}}["onEnable"](){if(this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x4e")]=this[a0_0x5592("0x8a4")][a0_0x5592("0x8a0")]["getComponent"](Ut),R["on"](F[a0_0x5592("0x71")],this,this[a0_0x5592("0x5a9")]),this[a0_0x5592("0x8a4")][a0_0x5592("0x505")]){for(let a=1;a<16;a++){let t=E[a0_0x5592("0x4e0")+a],e=E["denemys"+a];for(const i in t){const r=t[i],s=parseInt(i);s%10==0?this[a0_0x5592("0xa")][a0_0x5592("0x626")](r):s%5==0&&s%10!=0?this[a0_0x5592("0x5a6")][a0_0x5592("0x626")](r):s%10==3||s%10==8?this[a0_0x5592("0x3f2")][a0_0x5592("0x626")](r):this["otherEnemys"]["push"](r)}for(const n in e){const o=e[n],l=parseInt(n);l%10==0?this[a0_0x5592("0xa")][a0_0x5592("0x626")](o):l%5==0&&l%10!=0?this[a0_0x5592("0x5a6")][a0_0x5592("0x626")](o):l%10==3||l%10==8?this[a0_0x5592("0x3f2")]["push"](o):this[a0_0x5592("0x50f")][a0_0x5592("0x626")](o)}}this["powRatio"]=1.18;const e=[[[1001],[100,50]],[[3001],[0,200]],[[1002,1003,1014,1015,1018,1019],[100,250]],[[1004,1005,1006,1007,1008,1009,1010,1011,1016,1017,1020,1021,1022,1024,1026,1028,1029],[100,550]],[[1012,1013,1023,1025,1027],[100,750]],[[2001,2002,2003],[300,8500]]];for(let t=0;t<e["length"];t++){const a=e[t][0],_=e[t][1];for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const h=a[t];this[a0_0x5592("0x3f0")][h]=_[a0_0x5592("0xac7")]()}}}}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x5a9")](){const e=this[a0_0x5592("0x8a4")],t=e[a0_0x5592("0x4ca")],a=t[a0_0x5592("0x9d5")],i=t[a0_0x5592("0x2d6")];e[a0_0x5592("0x6c4")]=!0;let r=null;const s=window[a0_0x5592("0xea")];if(s){r=[];for(let t=0;t<s["length"];t++){const n=s[t];r[a0_0x5592("0x626")](n["edata"])}}else if(e["isEndless"]){r=[],e[a0_0x5592("0xa40")]||(e[a0_0x5592("0xa40")]=e[a0_0x5592("0x505")][a0_0x5592("0xac7")]());const o=e["endlessNextEnemy"][0],l=e[a0_0x5592("0xa40")][1];let t=E[a0_0x5592("0x4e0")+o];2==l&&(t=E[a0_0x5592("0x1f1")+o]);const _=t[e[a0_0x5592("0xa40")][2]];for(let t=0;t<_["length"];t++){const h=_[t];r["push"](Object["assign"]({},h))}this[a0_0x5592("0xa44")](r)}else{let t=E[a0_0x5592("0x4e0")+a];2==I["diff"]&&(t=E[a0_0x5592("0x1f1")+a]),r=t[i]}if(r){for(let t=0;t<r["length"];t++){const x=r[t];if(this[a0_0x5592("0xa29")][x[a0_0x5592("0xb2e")]])if(3002==x["type"]||3003==x["type"])this["insUI"][a0_0x5592("0x4c8")]=x;else if(1001==x[a0_0x5592("0xb2e")]){const c=6,d=x["time"];for(let t=0;t<c;t++){let e=d+.2*t;if(this["eneQue"][1e3*e]){let t=.2;for(;this["eneQue"][1e3*e+t];)t+=.2;this[a0_0x5592("0x169")][1e3*e+t]=x}else this["eneQue"][1e3*e]=x}}else if(this[a0_0x5592("0x169")][1e3*x["time"]]){let t=1;for(;this["eneQue"][1e3*x[a0_0x5592("0x22e")]+t];)t++;this[a0_0x5592("0x169")][1e3*x["time"]+t]=x}else this[a0_0x5592("0x169")][1e3*x[a0_0x5592("0x22e")]]=x}if(this[a0_0x5592("0x99e")]=!0,this[a0_0x5592("0x6ec")]=0,e[a0_0x5592("0x505")]){e[a0_0x5592("0xae5")]=e[a0_0x5592("0xa40")][a0_0x5592("0xac7")]();const u=t[a0_0x5592("0x2d6")]+1;if(u%5==0){this[a0_0x5592("0x91a")]["length"]||(this[a0_0x5592("0x91a")]=this["bossEnemys"]["concat"]()),this[a0_0x5592("0x91a")][a0_0x5592("0x26f")]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5);const f=this[a0_0x5592("0x91a")][a0_0x5592("0x83a")]();e[a0_0x5592("0xa40")]=[f[0][a0_0x5592("0x9d5")],f[0]["difficulty"],f[0]["level"]]}else if(u>=16&&u%10==6){this[a0_0x5592("0x5a6")][a0_0x5592("0x26f")]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5);const p=this[a0_0x5592("0x5a6")][0];e[a0_0x5592("0xa40")]=[p[0][a0_0x5592("0x9d5")],p[0]["difficulty"],p[0]["level"]]}else if(u>=13&&(u%10==3||u%10==8)){this["currShipEnemys"][a0_0x5592("0xb0e")]||(this["currShipEnemys"]=this["shipEnemys"][a0_0x5592("0xac7")]()),this["currShipEnemys"][a0_0x5592("0x26f")]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5);const m=this[a0_0x5592("0x58c")][a0_0x5592("0x83a")]();e[a0_0x5592("0xa40")]=[m[0][a0_0x5592("0x9d5")],m[0][a0_0x5592("0x31b")],m[0][a0_0x5592("0x188")]]}else{this[a0_0x5592("0x89c")][a0_0x5592("0xb0e")]||(this[a0_0x5592("0x89c")]=this["otherEnemys"][a0_0x5592("0xac7")]()),this[a0_0x5592("0x89c")]["sort"]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5);const g=this[a0_0x5592("0x89c")][a0_0x5592("0x83a")]();e[a0_0x5592("0xa40")]=[g[0][a0_0x5592("0x9d5")],g[0]["difficulty"],g[0][a0_0x5592("0x188")]]}}}}[a0_0x5592("0xa44")](e){const a=this["ins"]["playerData"],i=this["powRatio"]||1.08;for(let t=0;t<e["length"];t++){const r=e[t],s=this[a0_0x5592("0x3f0")][r[a0_0x5592("0xb2e")]]||[350,8e3],n=s[0],o=s[1];if(r[a0_0x5592("0xb2e")]<3e3&&r["type"]>2e3){const l=a[a0_0x5592("0x2d6")]>135?130:a["rate"]-5,_=Math[a0_0x5592("0x6fc")](n*Math[a0_0x5592("0x2e8")](i,l));r[a0_0x5592("0x644")]=a0_0x5592("0x993")==typeof r[a0_0x5592("0x644")]?_:_+"|"+_+"|"+_,r["hp"]=Math["floor"](o*Math[a0_0x5592("0x2e8")](i,l))}else{const h=a[a0_0x5592("0x2d6")]>131?130:a[a0_0x5592("0x2d6")]-1,x=Math[a0_0x5592("0x6fc")](n*Math[a0_0x5592("0x2e8")](i,h));r[a0_0x5592("0x644")]="number"==typeof r[a0_0x5592("0x644")]?x:x+"|"+x+"|"+x,r["hp"]=Math[a0_0x5592("0x6fc")](o*Math[a0_0x5592("0x2e8")](i,h))}}}[a0_0x5592("0xd5")](t){const e=this[a0_0x5592("0x4c9")](u[t[a0_0x5592("0xb2e")]],this[a0_0x5592("0xa29")][t[a0_0x5592("0xb2e")]]),a=e["getComponent"](Zt);a["edata"]=t,a[a0_0x5592("0xaaa")]=!1,a["isRotSelf"]=!1,a[a0_0x5592("0x38")]=!1,e[a0_0x5592("0x6f7")](0,-1e3),this[a0_0x5592("0x8a4")][a0_0x5592("0xa28")][a0_0x5592("0x231")](e);const i=e[a0_0x5592("0x751")](W);this["ins"][a0_0x5592("0x352")][a0_0x5592("0x626")](i),Object[a0_0x5592("0x36c")](this[a0_0x5592("0x169")])[a0_0x5592("0xb0e")]||(R[a0_0x5592("0xcf")](F["LevelEnemyEnd"]),this[a0_0x5592("0x8a4")]["isMakingEnemy"]=!1)}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")]["gameState"]==P[a0_0x5592("0xa5")]&&this[a0_0x5592("0x99e")]){this[a0_0x5592("0x6ec")]+=Laya["timer"][a0_0x5592("0x154")];for(const t in this[a0_0x5592("0x169")])if(this[a0_0x5592("0x6ec")]>=parseInt(t)){const e=this[a0_0x5592("0x169")][t];delete this[a0_0x5592("0x169")][t],this["enemy"](e)}Object[a0_0x5592("0x36c")](this[a0_0x5592("0x169")])[a0_0x5592("0xb0e")]||(this[a0_0x5592("0x99e")]=!1,this["timer"]=0)}}}class re{constructor(){this["attack"]=0,this[a0_0x5592("0xae1")]=0,this[a0_0x5592("0x2cd")]=0,this[a0_0x5592("0x5b6")]=0,this["fspeed"]=0,this[a0_0x5592("0x33f")]=0,this[a0_0x5592("0xa49")]=0,this[a0_0x5592("0x640")]=null,this["hp"]=0,this[a0_0x5592("0x257")]=0,this[a0_0x5592("0x79f")]=0,this[a0_0x5592("0xdc")]=0,this["id"]=0,this["chapter"]=1,this[a0_0x5592("0x2d6")]=1,this["exp"]=0,this[a0_0x5592("0x188")]=1,this[a0_0x5592("0x53d")]={},this["skills2"]={},this["rewards"]={},this[a0_0x5592("0x253")]=!1,this[a0_0x5592("0x3f3")]=!1,this[a0_0x5592("0xa16")]=[],this["supUnlock"]=[],this[a0_0x5592("0x7e0")]=0,this[a0_0x5592("0xb05")]=0,this[a0_0x5592("0x537")]=0,this["laserSta"]=0,this[a0_0x5592("0x66b")]=null,this[a0_0x5592("0xa1b")]=null,this[a0_0x5592("0x432")]=null,this[a0_0x5592("0x612")]=0,this[a0_0x5592("0x5d4")]=1}[a0_0x5592("0x75b")](){this["id"]=I["id"],this[a0_0x5592("0x5d4")]=I[a0_0x5592("0x5d4")],I[a0_0x5592("0x9d5")]<1&&(this["id"]=2),this[a0_0x5592("0x640")]=Z[a0_0x5592("0x555")][this["id"]],this["attack"]=1*I[a0_0x5592("0x1fa")],this[a0_0x5592("0xae1")]=I[a0_0x5592("0xae1")],this["critHurt"]=I[a0_0x5592("0x2cd")],this[a0_0x5592("0x5b6")]=I["speed"],this[a0_0x5592("0x214")]=I[a0_0x5592("0x214")],this[a0_0x5592("0x33f")]=I[a0_0x5592("0x33f")],this[a0_0x5592("0xa49")]=I[a0_0x5592("0xa49")],this["hp"]=I["hp"],this[a0_0x5592("0x257")]=1*I["hp"],this[a0_0x5592("0x79f")]=I[a0_0x5592("0x79f")],this[a0_0x5592("0xdc")]=I["subHurt"],this[a0_0x5592("0x9d5")]=I[a0_0x5592("0x9d5")],this["rate"]=I["rate"],this["coin"]=I[a0_0x5592("0x7e0")],this[a0_0x5592("0xb05")]=I["reward"],this[a0_0x5592("0x19")]=0,this[a0_0x5592("0x188")]=1,this[a0_0x5592("0x53d")]={},this[a0_0x5592("0xf0")]={},this[a0_0x5592("0x59d")]={},2==this["id"]&&(this[a0_0x5592("0x1fa")]*=1.3),3==this["id"]&&(this[a0_0x5592("0x53d")][1023]=1);const e=I[a0_0x5592("0xa16")];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){if(1026==e[t]||1023==e[t])continue;D[a0_0x5592("0x53d")][e[t]]["add"]!=m[a0_0x5592("0x2a1")]?this[a0_0x5592("0xa16")]["push"](e[t]):this["supUnlock"]["push"](e[t])}const t=window[a0_0x5592("0x716")],a=I[a0_0x5592("0x94c")];t&&a&&this[a0_0x5592("0x9d5")]==a[a0_0x5592("0x9d5")]&&(window[a0_0x5592("0x716")]=null,this[a0_0x5592("0x257")]*=a[a0_0x5592("0x257")]/a["hp"],this[a0_0x5592("0x2d6")]=a[a0_0x5592("0x2d6")],this[a0_0x5592("0x19")]=a[a0_0x5592("0x19")],this[a0_0x5592("0x188")]=a[a0_0x5592("0x188")],this[a0_0x5592("0x53d")]=a["skills"],this[a0_0x5592("0xf0")]=a["skills2"],this["unlock"]=a["unlock"],this["supUnlock"]=a[a0_0x5592("0x754")],this[a0_0x5592("0x7e0")]=a["coin"],this[a0_0x5592("0xb05")]=a[a0_0x5592("0xb05")]),window[a0_0x5592("0x9bf")]&&(this[a0_0x5592("0x2d6")]=H["endlessData"][a0_0x5592("0x3c3")]);const i=window[a0_0x5592("0x220")],r=H[a0_0x5592("0x137")]["lastData"];i&&r&&(window[a0_0x5592("0x220")]=null,this[a0_0x5592("0x257")]*=r["currHP"]/r["hp"],this[a0_0x5592("0x2d6")]=r[a0_0x5592("0x2d6")],this[a0_0x5592("0x19")]=r["exp"],this["level"]=r[a0_0x5592("0x188")],this[a0_0x5592("0x53d")]=r[a0_0x5592("0x53d")],this[a0_0x5592("0xf0")]=r[a0_0x5592("0xf0")]||{},this["unlock"]=r[a0_0x5592("0xa16")],this["supUnlock"]=r[a0_0x5592("0x754")],this["coin"]=r[a0_0x5592("0x7e0")],this[a0_0x5592("0xb05")]=r[a0_0x5592("0xb05")],this[a0_0x5592("0x537")]=r[a0_0x5592("0x537")])}[a0_0x5592("0x274")](t,e){this["id"]=e,this[a0_0x5592("0x5d4")]=t[a0_0x5592("0x5d4")],this["planeData"]=Z[a0_0x5592("0x555")][this["id"]];const a=this[a0_0x5592("0x640")];this["attack"]=.5*t[a0_0x5592("0x1fa")],this[a0_0x5592("0xae1")]=t[a0_0x5592("0xae1")],this[a0_0x5592("0x2cd")]=t[a0_0x5592("0x2cd")],this["speed"]=a[a0_0x5592("0x58")],this[a0_0x5592("0x214")]=a[a0_0x5592("0x277")],this[a0_0x5592("0x33f")]=t[a0_0x5592("0x33f")],this[a0_0x5592("0xa49")]=t["bosHurtStr"],this["hp"]=.5*t["hp"],this[a0_0x5592("0x257")]=.5*t["hp"],this["defense"]=t[a0_0x5592("0x79f")],this[a0_0x5592("0xdc")]=t["subHurt"],this["chapter"]=t[a0_0x5592("0x9d5")],this[a0_0x5592("0x2d6")]=t[a0_0x5592("0x2d6")],this[a0_0x5592("0x7e0")]=0,this[a0_0x5592("0xb05")]=0,this[a0_0x5592("0x19")]=0,this[a0_0x5592("0x188")]=1,this["skills"]={},this[a0_0x5592("0xf0")]={},this[a0_0x5592("0x59d")]={};const i=I[a0_0x5592("0xa16")];for(let t=0;t<i[a0_0x5592("0xb0e")];t++){if(1026==i[t]||1023==i[t])continue;D[a0_0x5592("0x53d")][i[t]]["add"]!=m[a0_0x5592("0x2a1")]?this[a0_0x5592("0xa16")][a0_0x5592("0x626")](i[t]):this["supUnlock"][a0_0x5592("0x626")](i[t])}}[a0_0x5592("0xa5b")](t){this["skills"][t]?this["skills"][t]++:this["skills"][t]=1}[a0_0x5592("0x956")](t){this[a0_0x5592("0xf0")][t]?this[a0_0x5592("0xf0")][t]++:this[a0_0x5592("0xf0")][t]=1}["setSkill2"](e){const a=this[a0_0x5592("0x53d")];let i=null;for(let t=0;t<3;t++){const r=e+t;if(a[r]){i=r;break}}i?(a[i+1]=a[i]+1,delete a[i]):a[e]=1}}class se extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1f3")]=null,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x421")]=null}[a0_0x5592("0x880")](){if(this["ins"]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1f3")][a0_0x5592("0x14")]=0,this["stuSke"][a0_0x5592("0xabe")]=Laya["BlendMode"][a0_0x5592("0x47f")],this[a0_0x5592("0x1f3")]["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{this["stuSke"][a0_0x5592("0x14")]=0}),R["on"](F[a0_0x5592("0x838")],this,t=>{t||(this[a0_0x5592("0x1f3")]["templet"]&&(this[a0_0x5592("0x1f3")][a0_0x5592("0x590")](0,!1),this["stuSke"][a0_0x5592("0x14")]=1),this[a0_0x5592("0x1ba")]||Laya[a0_0x5592("0x262")]["playSound"](at[a0_0x5592("0x607")]))}),this["pid"]){let s=0,n=!1,o=!1;const l=()=>{const t=O["getRandom"](200,500),e=O[a0_0x5592("0x7de")](700,1100);this["tapos"]=this["getVec3"](t,e)};Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](2e3,this,()=>{o||l()}),R["on"](a0_0x5592("0x78"),this,t=>{const e=t[a0_0x5592("0x639")];if(!(n||s&&e!=s)){const a=this["ins"][a0_0x5592("0x3af")]();if(a){o=!0,s=a[a0_0x5592("0x751")](W)[a0_0x5592("0x639")];const i=(a["y"]<640?640:a["y"])+O["getRandom"](450,50),r=i>1200?1200:i;let t=a["x"]-20+O[a0_0x5592("0x7de")](40,0);t>700&&(t=700),t<20&&(t=20),this["tapos"]=this["getVec3"](t,r)}else s=0,o=!1,l()}})}}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x1f3")][a0_0x5592("0x5c7")](this),Laya["timer"]["clearAll"](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x8a4")],a=this[a0_0x5592("0x1ba")];let i=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]/1e3,r=this[a0_0x5592("0xce")](t["x"],t["y"]),s=this[a0_0x5592("0xce")]();const n=a?e[a0_0x5592("0x587")][a-1][a0_0x5592("0xa3a")]:e[a0_0x5592("0xa3d")];if(Laya[a0_0x5592("0x97c")]["lerp"](r,n,15*i,s),t["pos"](s["x"],s["y"]),a){const o=e[a0_0x5592("0x587")][a-1];if(this[a0_0x5592("0x421")]){const l=o[a0_0x5592("0xa3a")];Laya["Vector3"]["lerp"](l,this[a0_0x5592("0x421")],5*i,o[a0_0x5592("0xa3a")])}e[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](o[a0_0x5592("0xa3a")],o[a0_0x5592("0x5e4")])}}}class Y extends t{constructor(){super(),this[a0_0x5592("0x255")]=!1,this["bgPre"]=null,this["eneHPTipPre"]=null,this["enemyNode"]=null,this[a0_0x5592("0x23a")]=null,this[a0_0x5592("0x5be")]=null,this[a0_0x5592("0x1a9")]=null,this["player2Node"]=null,this[a0_0x5592("0xa7e")]=null,this["dialogNode"]=null,this["guidNode"]=null,this["handNode"]=null,this[a0_0x5592("0x817")]=null,this[a0_0x5592("0xa88")]=null,this[a0_0x5592("0x4bc")]=null,this[a0_0x5592("0x334")]=null,this[a0_0x5592("0x94d")]=null,this[a0_0x5592("0x448")]=null,this[a0_0x5592("0x860")]=[],this[a0_0x5592("0xa9c")]=[],this["playerPosV3"]=new Laya[a0_0x5592("0x97c")](0,0,0),this["playerPosV2"]=new Laya[a0_0x5592("0x97c")](360,1e3,0),this[a0_0x5592("0x9e1")]=[],this[a0_0x5592("0x495")]=0,this["touchY"]=0,this[a0_0x5592("0xa22")]=0,this[a0_0x5592("0x9ca")]=0,this[a0_0x5592("0x747")]=128,this[a0_0x5592("0x6c4")]=!1,this[a0_0x5592("0x78f")]=!0,this[a0_0x5592("0x505")]=null,this[a0_0x5592("0xa40")]=null,this[a0_0x5592("0xae5")]=null,this[a0_0x5592("0xb30")]=1,this[a0_0x5592("0x3e4")]=0,this[a0_0x5592("0xe5")]=0,this[a0_0x5592("0x4ca")]=null,this["_gameState"]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x6cb")]=null,this[a0_0x5592("0x5e3")]=0,this["enemyCols"]=[],this["playerCols"]=[],this[a0_0x5592("0x587")]=[],this[a0_0x5592("0x475")]=[],this["robotNames"]=[],this[a0_0x5592("0x75e")]=[],this["lastCompareData"]=null,this[a0_0x5592("0x3d0")]=null,Y[a0_0x5592("0x173")]=this;const t=Laya[a0_0x5592("0x43c")][a0_0x5592("0x231")](new Laya[a0_0x5592("0x876")]);t["zOrder"]=-2,this[a0_0x5592("0x817")]=t;const e=Laya[a0_0x5592("0x43c")]["addChild"](new Laya[a0_0x5592("0x569")]);e["zOrder"]=-1,this[a0_0x5592("0xa88")]=e;const a=new Laya["Camera"](0,.1,1e3);e[a0_0x5592("0x231")](a),this["modCameraV3"]=a,a[a0_0x5592("0x71a")]=Laya["CameraClearFlags"][a0_0x5592("0x3f7")],a["clearColor"]=new Laya[a0_0x5592("0x2a5")](0,0,0,0),a[a0_0x5592("0x48b")][a0_0x5592("0xa5f")](new Laya["Vector3"](-90,0,0),!1,!1),a[a0_0x5592("0x798")]=!0,a[a0_0x5592("0x6c6")]=10;const i=e[a0_0x5592("0x231")](new Laya[a0_0x5592("0x493")]);i[a0_0x5592("0x318")]=new Laya[a0_0x5592("0x97c")](1,1,1),i[a0_0x5592("0x48b")][a0_0x5592("0x49c")][a0_0x5592("0x47b")](new Laya[a0_0x5592("0x97c")](1,-1,0)),this["bgPre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0xb08")]),this[a0_0x5592("0x487")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x981")])}set[a0_0x5592("0x547")](t){this[a0_0x5592("0x59a")]=t,R["event"](F[a0_0x5592("0x5f3")])}get[a0_0x5592("0x547")](){return this[a0_0x5592("0x59a")]}["onEnable"](){C[a0_0x5592("0x965")][a0_0x5592("0x8f3")](()=>{C[a0_0x5592("0x965")][a0_0x5592("0x4bf")](),C[a0_0x5592("0x965")][a0_0x5592("0xaa6")](()=>{})});const t=this["open"](w["battle"]["BgNode"],this["bgPre"]);this["bgSceneV2"]["addChild"](t);const e=new Laya[a0_0x5592("0x745")];e[a0_0x5592("0x749")]=a0_0x5592("0x394"),this["modSceneV3"][a0_0x5592("0x231")](e);const a=new Laya[a0_0x5592("0x745")];a["name"]=a0_0x5592("0xd"),this["modSceneV3"][a0_0x5592("0x231")](a),this["enemyNode"]=this[a0_0x5592("0x817")]["addChild"](new Laya["Sprite"]),this[a0_0x5592("0x23a")]=this["bgSceneV2"]["addChild"](new Laya["Sprite"]),this[a0_0x5592("0x1af")]=this[a0_0x5592("0x817")][a0_0x5592("0x231")](new Laya[a0_0x5592("0x73d")]),this[a0_0x5592("0x6cb")]=this[a0_0x5592("0x8a0")][a0_0x5592("0xab9")]("enemyManager")[a0_0x5592("0x751")](ie),this[a0_0x5592("0x505")]=window["__endless.battle__"],this["endlessNextEnemy"]=null,this["endlessThisEnemy"]=null,this[a0_0x5592("0x475")]=C[a0_0x5592("0x965")]["getFriendsList"](),this[a0_0x5592("0x547")]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x4ca")]=new re,this[a0_0x5592("0x4ca")][a0_0x5592("0x75b")]();const r=this[a0_0x5592("0x4ca")],s=window["__Adventure__"];let n=0;if(s){const d=s[0][a0_0x5592("0x314")][a0_0x5592("0xaed")],u=s[0]["adv"][a0_0x5592("0x5d4")];let t=Q["advDrop"][d][u];n=O[a0_0x5592("0x7de")](t["maxbox"],t[a0_0x5592("0x14e")])}let i,o=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")](a0_0x5592("0x399"));o||(o="1"),o=parseInt(o),this[a0_0x5592("0x78f")]=!!o,this[a0_0x5592("0x43a")][a0_0x5592("0x143")]=!(r["chapter"]>0),this[a0_0x5592("0xb30")]=I[a0_0x5592("0x56b")][a0_0x5592("0x779")](4)>-1?1.5:1,this[a0_0x5592("0x3e4")]=I[a0_0x5592("0x56b")][a0_0x5592("0x779")](8)>-1?.3:0,this[a0_0x5592("0xe5")]=I["specialSuit"][a0_0x5592("0x779")](13)>-1?1:0,R["on"](F[a0_0x5592("0x243")],this,this[a0_0x5592("0x708")]),I[a0_0x5592("0x9d5")]<1?i=U[a0_0x5592("0x8b2")]:(i=U[a0_0x5592("0x791")][r[a0_0x5592("0x9d5")]-1],2==I[a0_0x5592("0x5d4")]&&(i=U[a0_0x5592("0x52a")][r[a0_0x5592("0x9d5")]-1]));const l=i[a0_0x5592("0x3c4")],_=i["levelbox"],h=i[a0_0x5592("0xb21")],x=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x8c2")]),c=Ut[a0_0x5592("0x4e")];R["on"](F[a0_0x5592("0x780")],this,(t,e)=>{const o=t[a0_0x5592("0x8a0")];this[a0_0x5592("0x352")][a0_0x5592("0x3c8")](this[a0_0x5592("0x352")]["indexOf"](t),1),R[a0_0x5592("0xcf")](a0_0x5592("0x78"),t);const a=t=>{c[a0_0x5592("0x2c1")]++,this["levelBox"]++;const e=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x8c2")],x),a=e[a0_0x5592("0x751")](kt),i=O[a0_0x5592("0x7de")](80,45),r=O[a0_0x5592("0x7de")](1,0),s=Math[a0_0x5592("0xc0")](i/180*Math["PI"]);let n=new Laya[a0_0x5592("0x97c")](0,0,0);Laya["Vector3"]["normalize"](new Laya[a0_0x5592("0x97c")](1,-s,0),n),r&&(n["x"]*=-1),a[a0_0x5592("0x914")]=n,a[a0_0x5592("0xb29")]=t,a[a0_0x5592("0x5b6")]=t?.6:.3,e[a0_0x5592("0x6f7")](o["x"],o["y"]),this[a0_0x5592("0x1a9")]["addChild"](e)};if(s){const i=s[0][a0_0x5592("0x314")][a0_0x5592("0xaed")];if(1==i){r["reward"]+=n;for(let t=0;t<n;t++)a(!1)}else 2==i&&this[a0_0x5592("0x5e3")]<n&&(r[a0_0x5592("0xb05")]++,a(!1))}else if(this["isEndless"]);else{if(r[a0_0x5592("0x2d6")]%5!=0&&!e&&r[a0_0x5592("0xb05")]<l&&this["levelBox"]<_){O[a0_0x5592("0x7de")](100,1)<=10&&(r[a0_0x5592("0xb05")]++,a(!1))}if(r[a0_0x5592("0x2d6")]%10==0){r[a0_0x5592("0xb05")]+=h,R["event"](F[a0_0x5592("0x707")]);for(let t=0;t<h;t++)a(!0)}}console[a0_0x5592("0xad6")]("%c"+(r[a0_0x5592("0x9d5")]+"."+r[a0_0x5592("0x188")])+a0_0x5592("0x53e")+this[a0_0x5592("0x352")][a0_0x5592("0xb0e")],"color: green"),this[a0_0x5592("0x6c4")]||this[a0_0x5592("0x352")][a0_0x5592("0xb0e")]||(Laya["timer"][a0_0x5592("0x724")](2e3,this,()=>{R[a0_0x5592("0xcf")](F[a0_0x5592("0x4a6")])}),r[a0_0x5592("0x2d6")]%10==0&&(this[a0_0x5592("0x505")]||R[a0_0x5592("0xcf")]("player.killBoss")),this[a0_0x5592("0x505")]||R[a0_0x5592("0xcf")]("player.rated")),2==this["playerData"][a0_0x5592("0x51a")]&&this[a0_0x5592("0x4ca")][a0_0x5592("0xa1b")]&&t[a0_0x5592("0x639")]==this[a0_0x5592("0x4ca")]["trackBox"][a0_0x5592("0x639")]&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](150,this,()=>{this[a0_0x5592("0x4ca")][a0_0x5592("0x66b")]=null,this["playerData"]["trackBox"]=null,this["playerData"][a0_0x5592("0x432")]=null})}),R["on"](F["GameOver"],this,()=>{this[a0_0x5592("0x94d")]["visible"]=!1,this[a0_0x5592("0x94d")][a0_0x5592("0x3b3")]["visible"]=!1,this[a0_0x5592("0x448")][a0_0x5592("0x143")]=!1;for(let t=0;t<this[a0_0x5592("0x860")][a0_0x5592("0xb0e")];t++)this[a0_0x5592("0x860")][t][a0_0x5592("0x143")]=!1;for(let t=0;t<this[a0_0x5592("0xa9c")][a0_0x5592("0xb0e")];t++)this[a0_0x5592("0xa9c")][t][a0_0x5592("0x143")]=!1;this[a0_0x5592("0x1a9")]["alpha"]=0;const e=this["player2Node"];for(let t=e[a0_0x5592("0xae6")]-1;t>=0;t--){e[a0_0x5592("0x433")](t)["removeSelf"]()}this[a0_0x5592("0xa88")][a0_0x5592("0x6b7")]=!1}),R["on"](F[a0_0x5592("0xaad")],this,t=>{const e=this[a0_0x5592("0x587")][t-1];if(e){e["v2"]["pos"](1e4,1e4),e[a0_0x5592("0xa3a")]=this[a0_0x5592("0xce")](1e4,1e4,1e4),this[a0_0x5592("0x532")][a0_0x5592("0x3c8")](this["playerCols"]["indexOf"](e["v2"][a0_0x5592("0x751")](W)),1),e["v3"][a0_0x5592("0x6b7")]=!1,e["v2"][a0_0x5592("0x3b3")][a0_0x5592("0xaa4")](),e["v2"]["removeSelf"](),e[a0_0x5592("0x155")][a0_0x5592("0xaa4")]();for(let t=0;t<e[a0_0x5592("0x7a")]["length"];t++)e[a0_0x5592("0x7a")][t][a0_0x5592("0xaa4")]();for(let t=0;t<e[a0_0x5592("0x7c1")][a0_0x5592("0xb0e")];t++)e[a0_0x5592("0x7c1")][t][a0_0x5592("0xaa4")]();for(let t=0;t<e[a0_0x5592("0x685")][a0_0x5592("0xb0e")];t++)e["ballsv2"][t]["removeSelf"]();this[a0_0x5592("0x587")][a0_0x5592("0x3c8")](t-1,1)}})}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x817")][a0_0x5592("0x64b")](!0),this["modSceneV3"][a0_0x5592("0x64b")](!0),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x9b7")](){this[a0_0x5592("0x3d0")]||(this[a0_0x5592("0x3d0")]={});const t=this[a0_0x5592("0x3d0")],e=this[a0_0x5592("0x475")];e&&e[a0_0x5592("0xb0e")]?(e["sort"]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5),t[a0_0x5592("0x749")]=e[0][a0_0x5592("0x749")],t["photo"]=e[0][a0_0x5592("0x347")],e[a0_0x5592("0x3c8")](0,1)):(this[a0_0x5592("0x2fb")]["length"]||(this[a0_0x5592("0x2fb")]=C[a0_0x5592("0x965")][a0_0x5592("0x68d")]["getRobotNames"]()),this[a0_0x5592("0x75e")][a0_0x5592("0xb0e")]||(this[a0_0x5592("0x75e")]=C["gameSDK"][a0_0x5592("0x68d")]["getRobotPhotos"]()),this[a0_0x5592("0x2fb")][a0_0x5592("0x26f")]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5),this[a0_0x5592("0x75e")][a0_0x5592("0x26f")]((t,e)=>Math[a0_0x5592("0x2ee")]()-.5),t[a0_0x5592("0x749")]=this[a0_0x5592("0x2fb")][0],t["photo"]=a0_0x5592("0x50c")+this[a0_0x5592("0x75e")][0]+a0_0x5592("0x525"),this[a0_0x5592("0x2fb")][a0_0x5592("0x3c8")](0,1),this[a0_0x5592("0x75e")]["splice"](0,1)),t[a0_0x5592("0x537")]?t[a0_0x5592("0x537")]=t["score"]+O[a0_0x5592("0x7de")](2e3,800):t[a0_0x5592("0x537")]=this[a0_0x5592("0x4ca")][a0_0x5592("0x537")]+O[a0_0x5592("0x7de")](1e3,500)}[a0_0x5592("0x708")](){let t=this[a0_0x5592("0x668")](this[a0_0x5592("0x94d")]);t?(this[a0_0x5592("0x4ca")][a0_0x5592("0x66b")]=t,this["playerData"][a0_0x5592("0xa1b")]=t["getComponent"](W),this["playerData"][a0_0x5592("0x432")]=t[a0_0x5592("0x751")](ae)):(this["playerData"][a0_0x5592("0x66b")]=null,this[a0_0x5592("0x4ca")][a0_0x5592("0xa1b")]=null,this[a0_0x5592("0x4ca")][a0_0x5592("0x432")]=null)}[a0_0x5592("0x3af")](){let e=null,a=null;for(let t=0;t<this[a0_0x5592("0x352")][a0_0x5592("0xb0e")];t++){const i=this[a0_0x5592("0x352")][t][a0_0x5592("0x8a0")];if(!i||!i[a0_0x5592("0x2ed")])continue;const r=i[a0_0x5592("0x751")](Zt)[a0_0x5592("0x2e2")][a0_0x5592("0xb2e")];(!e||r>e)&&(e=r,a=i)}return a}["getMinEnemy"](r){let s=null,n=null;for(let i=0;i<this[a0_0x5592("0x352")]["length"];i++){const o=this[a0_0x5592("0x352")][i][a0_0x5592("0x8a0")];if(!o||!o[a0_0x5592("0x2ed")])continue;o[a0_0x5592("0x751")](Zt);let t=o["x"]-r["x"],e=o["y"]-r["y"],a=t*t+e*e;(!s||a<s)&&(s=a,n=o)}return n}[a0_0x5592("0x9a8")](r,s){let n=null,o=null,l=null;for(let i=0;i<this[a0_0x5592("0x352")]["length"];i++){const _=this["enemyCols"][i][a0_0x5592("0x8a0")];if(!_||!_[a0_0x5592("0x2ed")])continue;let t=_["x"]-r["x"],e=_["y"]-r["y"],a=t*t+e*e;s[i]&&s[i]>=2||(!n||a<n)&&(n=a,o=_,l=i)}if(a0_0x5592("0x993")==typeof l&&(s[l]||(s[l]=0),s[l]++),!o&&this[a0_0x5592("0x352")][a0_0x5592("0xb0e")])for(let i=0;i<this["enemyCols"][a0_0x5592("0xb0e")];i++){const h=this["enemyCols"][i][a0_0x5592("0x8a0")];if(!h||!h[a0_0x5592("0x2ed")])continue;let t=h["x"]-r["x"],e=h["y"]-r["y"],a=t*t+e*e;(!n||a<n)&&(n=a,o=h,l=i)}return o}[a0_0x5592("0xe8")](t){this["touchDown"]=!0,this["handNode"][a0_0x5592("0x143")]&&(this[a0_0x5592("0x43a")][a0_0x5592("0x143")]=!1,ADManageLaya["getInstance"]()["xsi"](!![]),R[a0_0x5592("0xcf")](F[a0_0x5592("0x9ef")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0x123")],this[a0_0x5592("0x4ca")]["id"])),this[a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&(this[a0_0x5592("0x495")]=t["stageX"],this[a0_0x5592("0x928")]=t["stageY"])}["onStageMouseMove"](t){if(!this["touchDown"])return;if(this[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;let e=t[a0_0x5592("0x47d")]-this[a0_0x5592("0x495")],a=t["stageY"]-this[a0_0x5592("0x928")];this[a0_0x5592("0xa22")]-=e/8,Math["abs"](this[a0_0x5592("0xa22")])>45&&(this[a0_0x5592("0xa22")]*=.7),this[a0_0x5592("0x495")]=t["stageX"],this[a0_0x5592("0x928")]=t[a0_0x5592("0x1c2")];let i=this[a0_0x5592("0xa3d")]["x"]+e,r=this[a0_0x5592("0xa3d")]["y"]+a;i>=0&&i<=720&&(this[a0_0x5592("0xa3d")]["x"]=i),r>=0&&r<=1280&&(this["playerPosV2"]["y"]=r),this[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xa3d")],this["playerPosV3"])}[a0_0x5592("0x2e9")](t){this[a0_0x5592("0x255")]=!1,this[a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&(this[a0_0x5592("0x495")]=0,this[a0_0x5592("0x928")]=0,this["rotationZ"]=0,this[a0_0x5592("0x334")][a0_0x5592("0x48b")][a0_0x5592("0x270")]=0)}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;let i=Laya[a0_0x5592("0x6ec")]["delta"]/1e3;if(this[a0_0x5592("0x334")]){let t=this[a0_0x5592("0x334")][a0_0x5592("0x48b")][a0_0x5592("0x93a")],e=new Laya["Vector3"](0,0,0);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](t,this["playerPosV3"],15*i,e),this[a0_0x5592("0x334")][a0_0x5592("0x48b")]["position"]=e,Math[a0_0x5592("0x45c")](this["playerV3"][a0_0x5592("0x48b")][a0_0x5592("0x93a")]["x"]-this[a0_0x5592("0x9ca")])<=.02&&(this["rotationZ"]=0);let a=new Laya[a0_0x5592("0x97c")](0,0,0);Laya[a0_0x5592("0x97c")]["lerp"](this[a0_0x5592("0x334")]["transform"]["localRotationEuler"],this[a0_0x5592("0xce")](0,0,this[a0_0x5592("0xa22")]),15*i,a),this[a0_0x5592("0x334")]["transform"][a0_0x5592("0x67d")]=a,this[a0_0x5592("0x9ca")]=this["playerV3"][a0_0x5592("0x48b")][a0_0x5592("0x93a")]["x"]}for(let a=0;a<this[a0_0x5592("0x587")][a0_0x5592("0xb0e")];a++){const r=this[a0_0x5592("0x587")][a];let t=r["v3"][a0_0x5592("0x48b")][a0_0x5592("0x93a")],e=new Laya["Vector3"](0,0,0);Laya["Vector3"][a0_0x5592("0x2bb")](t,r[a0_0x5592("0x5e4")],15*i,e),r["v3"][a0_0x5592("0x48b")][a0_0x5592("0x93a")]=e}}}class ne extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1e8")]=null,this["laser2"]=null,this[a0_0x5592("0xd2")]=0,this[a0_0x5592("0x1f9")]=0,this[a0_0x5592("0x1ba")]=0}[a0_0x5592("0x880")](){this["ins"]=Y["instance"],this["laser"]&&(this[a0_0x5592("0x1e8")][a0_0x5592("0xabe")]=Laya["BlendMode"][a0_0x5592("0x47f")]),this[a0_0x5592("0xa60")]&&(this[a0_0x5592("0xa60")]["blendMode"]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")]);const t=this[a0_0x5592("0x8a0")];R["on"](F[a0_0x5592("0x9ef")],this,()=>{t[a0_0x5592("0x143")]||(t[a0_0x5592("0x143")]=!0)})}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x5b4")](){const t=this[a0_0x5592("0x8a4")],e=this["pid"];if(t[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const a=this[a0_0x5592("0x8a0")];let i=e?t[a0_0x5592("0x587")][e-1]["v2"]:t[a0_0x5592("0x94d")];a[a0_0x5592("0x6f7")](i["x"]+this[a0_0x5592("0xd2")],i["y"]+this["deltaY"])}}class oe extends t{constructor(){super(),this[a0_0x5592("0x1e8")]=null,this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this["quadTree"]=null,this["target"]=null,this[a0_0x5592("0x224")]=1500,this[a0_0x5592("0x1ba")]=0}set[a0_0x5592("0x4d")](t){this[a0_0x5592("0x1e8")]["scaleY"]=t/1e3}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const t=this["ins"],e=this["pid"],a=this[a0_0x5592("0x8a0")];a[a0_0x5592("0x1d4")]=B[a0_0x5592("0x87e")],Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this["selfCol"][a0_0x5592("0x407")]=this["startH"],this["selfCol"][a0_0x5592("0x1f9")]=-this["startH"]/2,this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x92f")]=null,this[a0_0x5592("0x4d")]=this[a0_0x5592("0x224")],a[a0_0x5592("0x14")]=1;const i=this[a0_0x5592("0x1e8")],r=a[a0_0x5592("0xab9")](a0_0x5592("0xa60"));let s=e?t["otherPlayer"][e-1][a0_0x5592("0x4ca")]:t[a0_0x5592("0x4ca")];const n=()=>{if(R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ec")],this[a0_0x5592("0x1b2")]),s[a0_0x5592("0x66b")]&&s["trackBox"]&&s["trackCol"]&&a[a0_0x5592("0x143")]){const t=s[a0_0x5592("0xa1b")];t[a0_0x5592("0x5aa")][a0_0x5592("0x779")](this[a0_0x5592("0x1b2")]["bid"])<0&&(t[a0_0x5592("0x5aa")][a0_0x5592("0x626")](this["selfCol"][a0_0x5592("0x639")]),s[a0_0x5592("0x432")][a0_0x5592("0xb11")](this["selfCol"],s[a0_0x5592("0xa1b")],!0))}};let o=1e3*(s["fspeed"]+s[a0_0x5592("0x5b6")]+1),l=1e3*s[a0_0x5592("0x5b6")]+500;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](o,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](i,{alpha:0},500,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0x9ec")](),Laya[a0_0x5592("0x6eb")]["to"](r,{alpha:0},100)})),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](l,this,()=>{2==s[a0_0x5592("0x51a")]&&(t[a0_0x5592("0x708")](),n()),Laya[a0_0x5592("0x6eb")]["to"](i,{alpha:1},500,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{})),Laya[a0_0x5592("0x6eb")]["to"](r,{alpha:1},200)})}),R["on"](F[a0_0x5592("0x5f3")],this,()=>{t[a0_0x5592("0x547")]==P["START"]?a[a0_0x5592("0x143")]=!0:a[a0_0x5592("0x143")]=!1}),R["on"](F[a0_0x5592("0x4a5")],this,()=>{this["target"]=null,this[a0_0x5592("0x4d")]=this[a0_0x5592("0x224")],this[a0_0x5592("0x1b2")][a0_0x5592("0x407")]=this[a0_0x5592("0x224")],this["selfCol"][a0_0x5592("0x1f9")]=-this[a0_0x5592("0x224")]/2}),R["on"](F[a0_0x5592("0x243")],this,()=>{this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")]=[],this[a0_0x5592("0x92f")]=null}),R["on"](F[a0_0x5592("0x8f")],this,n)}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x9ec")](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R["offAllCaller"](this)}[a0_0x5592("0x9ec")](){this[a0_0x5592("0x8a0")];this["selfCol"]["bids"]=[],this[a0_0x5592("0x1b2")][a0_0x5592("0x407")]=this[a0_0x5592("0x224")],this[a0_0x5592("0x1b2")][a0_0x5592("0x1f9")]=-this[a0_0x5592("0x224")]/2,this[a0_0x5592("0x92f")]=null,this[a0_0x5592("0x4d")]=this[a0_0x5592("0x224")],R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ec")],this[a0_0x5592("0x1b2")])}[a0_0x5592("0xb11")](t,e){const a=t[a0_0x5592("0x8a0")],i=e["owner"],r=this["ins"],s=this[a0_0x5592("0x1ba")],n=s?r[a0_0x5592("0x587")][s-1][a0_0x5592("0x4ca")]:r["playerData"];if(a&&i&&!n[a0_0x5592("0x51a")]){let t=Math[a0_0x5592("0x45c")](a["y"]-i["y"]);this["selfCol"]["height2"]>t&&(this[a0_0x5592("0x4d")]=t,this[a0_0x5592("0x1b2")][a0_0x5592("0x407")]=t,this[a0_0x5592("0x1b2")][a0_0x5592("0x1f9")]=-t/2,this[a0_0x5592("0x92f")]=a)}}[a0_0x5592("0x3ec")](t,e){const a=t[a0_0x5592("0x8a0")],i=e["owner"],r=this[a0_0x5592("0x8a4")],s=this[a0_0x5592("0x1ba")],n=s?r[a0_0x5592("0x587")][s-1][a0_0x5592("0x4ca")]:r["playerData"];a&&i&&!n[a0_0x5592("0x51a")]&&(this[a0_0x5592("0x1b2")]["bids"][a0_0x5592("0xb0e")]||(this[a0_0x5592("0x4d")]=this["startH"],this["selfCol"][a0_0x5592("0x407")]=this["startH"],this[a0_0x5592("0x1b2")][a0_0x5592("0x1f9")]=-this[a0_0x5592("0x224")]/2,this[a0_0x5592("0x92f")]=null))}[a0_0x5592("0x3bf")](){const i=this[a0_0x5592("0x8a0")],t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x1ba")],r=e?t[a0_0x5592("0x587")][e-1][a0_0x5592("0x4ca")]:t[a0_0x5592("0x4ca")];if(2==r["laserSta"])if(r[a0_0x5592("0x66b")]){const a=r[a0_0x5592("0x66b")];if(a["x"]>=0&&a["x"]<=720&&a["y"]>=0&&a["y"]<=1280){let t=r[a0_0x5592("0x66b")]["x"]-i["x"],e=r[a0_0x5592("0x66b")]["y"]-i["y"],a=Math[a0_0x5592("0x4e6")](t*t+e*e);this["currH"]=a,i["rotation"]=Math[a0_0x5592("0x23d")](t,-e)/Math["PI"]*180}}else i[a0_0x5592("0x3b0")]=0,this[a0_0x5592("0x4d")]=this["startH"],this[a0_0x5592("0x1b2")][a0_0x5592("0x407")]=this[a0_0x5592("0x224")],this[a0_0x5592("0x1b2")][a0_0x5592("0x1f9")]=-this[a0_0x5592("0x224")]/2}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x8a4")],a=this[a0_0x5592("0x1ba")],i=a?e["otherPlayer"][a-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];if(e[a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]){if(t[a0_0x5592("0x143")]=!0,this[a0_0x5592("0x3bf")](),(2!=i[a0_0x5592("0x51a")]||!i["trackTar"])&&t[a0_0x5592("0x143")]&&this[a0_0x5592("0x1e8")]["alpha"]>=.1&&this["quadTree"]["check"](Y["instance"]["enemyCols"],this[a0_0x5592("0x1b2")]),!i[a0_0x5592("0x51a")]&&this["target"]){const r=this[a0_0x5592("0x8a0")];let t=Math[a0_0x5592("0x45c")](this[a0_0x5592("0x92f")]["y"]-r["y"]);this["currH"]=t,this[a0_0x5592("0x1b2")][a0_0x5592("0x407")]=t,this[a0_0x5592("0x1b2")][a0_0x5592("0x1f9")]=-t/2}}else t[a0_0x5592("0x143")]=!1}}class le extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["_norV3"]=null,this[a0_0x5592("0x5b6")]=.1}get["norV3"](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")]}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")];let e=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this["speed"];t["x"]+=e*this[a0_0x5592("0x918")]["x"],t["y"]+=e*this[a0_0x5592("0x918")]["y"],(t["x"]<=-360||t["x"]>=1080||t["y"]<=0||t["y"]>=1280)&&this[a0_0x5592("0x8a0")]["removeSelf"]()}}class _e extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["selfCol"]=null,this["quadTree"]=null,this[a0_0x5592("0x355")]=null,this["speed"]=2.5,this[a0_0x5592("0x35e")]=P["READY"],this[a0_0x5592("0x154")]=0}get[a0_0x5592("0x918")](){return this["_norV3"]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this["owner"];e&&(e[a0_0x5592("0x3b0")]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x35e")]=P["START"]}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P["START"])return;const t=this[a0_0x5592("0x8a0")];let e=Laya["timer"]["delta"]*this["speed"];t["x"]+=e*this[a0_0x5592("0x918")]["x"],t["y"]+=e*this[a0_0x5592("0x918")]["y"],(t["x"]<=-360||t["x"]>=1080||t["y"]<=-640||t["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")]["check"](this[a0_0x5592("0x8a4")][a0_0x5592("0x352")],this[a0_0x5592("0x1b2")])}}class he extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x905")]=null,this["pid"]=0,this["robot1BPre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x9ad")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const n=this["ins"],t=this["pid"],o=this[a0_0x5592("0x8a0")],l=t?n[a0_0x5592("0x587")][t-1]["playerData"]:n["playerData"],_=[this[a0_0x5592("0xce")](.87,-.5),this[a0_0x5592("0xce")](.98,-.17),this[a0_0x5592("0xce")](.98,.17),this["getVec3"](.87,.5),this[a0_0x5592("0xce")](-.87,-.5),this[a0_0x5592("0xce")](-.98,-.17),this[a0_0x5592("0xce")](-.98,.17),this[a0_0x5592("0xce")](-.87,.5)],h=D[a0_0x5592("0x53d")][V[a0_0x5592("0x46d")]],e=h["robotbullet"]||5,x=h["fspeed"]||.2;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e,this,()=>{if(n["gameState"]==P[a0_0x5592("0xa5")])for(let a=0;a<8;a++){const i=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x9ad")],this[a0_0x5592("0x905")]);let t=i[a0_0x5592("0x751")](X);t||(t=i[a0_0x5592("0x2a6")](X));const r=h["value"]||1;t[a0_0x5592("0x971")](l[a0_0x5592("0x1fa")]*r,l["crit"],l["critHurt"],l["eneHurtStr"],l["bosHurtStr"]);let e=i[a0_0x5592("0x751")](_e);e||(e=i[a0_0x5592("0x2a6")](_e)),e[a0_0x5592("0x5b6")]=x,e[a0_0x5592("0x154")]=294,e[a0_0x5592("0x918")]=_[a][a0_0x5592("0x408")](),i[a0_0x5592("0x6f7")](o["x"],o["y"]),n[a0_0x5592("0x1af")][a0_0x5592("0x231")](i);const s=i[a0_0x5592("0xab9")]("bi");s[a0_0x5592("0x1c1")]=0,Laya[a0_0x5592("0x6eb")]["clearAll"](s),Laya[a0_0x5592("0x6eb")]["to"](s,{height:294},300)}})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R["offAllCaller"](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x5b4")](){}}class xe extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this["state"]=P["READY"],this["_norV3"]=null,this["speed"]=.2}get[a0_0x5592("0x918")](){return this["_norV3"]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this["owner"];e&&(e["rotation"]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];this[a0_0x5592("0x8a0")];this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this[a0_0x5592("0x1b2")]=this["owner"][a0_0x5592("0x751")](W),this[a0_0x5592("0x8a4")][a0_0x5592("0x532")][a0_0x5592("0x779")](this["selfCol"])<0&&this[a0_0x5592("0x8a4")]["playerCols"][a0_0x5592("0x626")](this[a0_0x5592("0x1b2")])}[a0_0x5592("0x4fd")](){Laya["timer"]["clearAll"](this),Laya["Tween"][a0_0x5592("0x61b")](this),R["offAllCaller"](this);const t=this[a0_0x5592("0x8a4")]["playerCols"];let e=t[a0_0x5592("0x779")](this[a0_0x5592("0x1b2")]);e>-1&&t[a0_0x5592("0x3c8")](e,1),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){}[a0_0x5592("0x3ec")](t,e){}["onLateUpdate"](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")];let e=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this["speed"];t["x"]+=e*this[a0_0x5592("0x918")]["x"],t["y"]+=e*this[a0_0x5592("0x918")]["y"],(t["x"]<=-360||t["x"]>=1080||t["y"]<=-640||t["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}}class ce extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["robot2BPre"]=null,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0x689")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x59c")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const i=this[a0_0x5592("0x8a0")],r=this["ins"],t=this[a0_0x5592("0x1ba")],s=(t?r[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:r[a0_0x5592("0x4ca")],[this["getVec3"](.87,-.5),this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](.87,.5),this[a0_0x5592("0xce")](-.87,-.5),this["getVec3"](-1,0),this[a0_0x5592("0xce")](-.87,.5)]),e=D[a0_0x5592("0x53d")][V["ShieldRobot"]],a=e[a0_0x5592("0x52b")]||5,n=e[a0_0x5592("0x214")]||.2;Laya[a0_0x5592("0x6ec")]["loop"](1e3*a,this,()=>{if(r[a0_0x5592("0x547")]==P["START"])for(let t=0;t<6;t++){const e=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x59c")],this[a0_0x5592("0x689")]),a=e[a0_0x5592("0x751")](xe);a[a0_0x5592("0x5b6")]=n,a[a0_0x5592("0x918")]=s[t][a0_0x5592("0x408")](),e[a0_0x5592("0x6f7")](i["x"],i["y"]),r["player2Node"]["addChild"](e)}})}[a0_0x5592("0x4fd")](){Laya["timer"][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x5b4")](){}}class de extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x35e")]=P["READY"],this[a0_0x5592("0xa5a")]=50,this[a0_0x5592("0x4ad")]=0,this[a0_0x5592("0x5b6")]=1,this[a0_0x5592("0x1ba")]=0}get["norV3"](){return this[a0_0x5592("0x355")]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e["rotation"]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const t=this["ins"];this["owner"];this[a0_0x5592("0x1b2")]=this["owner"][a0_0x5592("0x751")](W),t[a0_0x5592("0x532")]["indexOf"](this[a0_0x5592("0x1b2")])<0&&this["ins"][a0_0x5592("0x532")]["push"](this[a0_0x5592("0x1b2")]),this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya["Tween"]["clearAll"](this),R[a0_0x5592("0x5c7")](this);const t=this[a0_0x5592("0x8a4")][a0_0x5592("0x532")];let e=t[a0_0x5592("0x779")](this[a0_0x5592("0x1b2")]);e>-1&&t["splice"](e,1),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){}["onCollisionExit"](t,e){}[a0_0x5592("0x5b4")](){const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x1ba")],a=this[a0_0x5592("0x8a0")];let i=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]/200*this["speed"];this[a0_0x5592("0x4ad")]+=i,a["rotation"]=-180-this[a0_0x5592("0x4ad")]/Math["PI"]*180;let r=e?t[a0_0x5592("0x587")][e-1]["v2"]:t[a0_0x5592("0x94d")];a["x"]=r["x"]+this[a0_0x5592("0xa5a")]*Math[a0_0x5592("0x2d9")](this["angle"]),a["y"]=r["y"]-this[a0_0x5592("0xa5a")]*Math[a0_0x5592("0x2d2")](this["angle"])}}class ue extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x2")]=!0,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this["tar"]=null,this[a0_0x5592("0x4ad")]=0,this["xv"]=1,this[a0_0x5592("0x5b6")]=1,this["trail"]=null,this["cross"]=!1,this[a0_0x5592("0x627")]=null}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this["ins"]=Y["instance"],this["selfCol"]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this["quadTree"]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this[a0_0x5592("0x2")]=!0;const t=this["ins"],e=this["owner"],a=new Laya[a0_0x5592("0x745")],i=this["getRes"](this["trail"]||b[a0_0x5592("0x9a9")]),r=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](i);a["addChild"](r),t[a0_0x5592("0xa88")]["getChildByName"](a0_0x5592("0xd"))[a0_0x5592("0x231")](a);let s=this[a0_0x5592("0xce")]();t["modCameraV3"]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](e["x"],e["y"]),s),a[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=s,this[a0_0x5592("0x627")]=a}["onDisable"](){this["s3d"]&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0xb11")](t,e){this["cross"]?this["tar"]=null:this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this["ins"]["gameState"]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P[a0_0x5592("0xa5")])return;const i=this["owner"];let r=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")],t=this[a0_0x5592("0x8a4")]["ratio3D"];if(this["tar"]&&this[a0_0x5592("0x2b1")]["parent"])if(i["y"]<=this["tar"]["y"]||this[a0_0x5592("0x2b1")]["x"]<=0||this["tar"]["x"]>=720||this[a0_0x5592("0x2b1")]["y"]<=0||this[a0_0x5592("0x2b1")]["y"]>=1280)this[a0_0x5592("0x2b1")]=null;else if(this["circle"]){let t=this[a0_0x5592("0xce")](),e=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this[a0_0x5592("0x2b1")]["x"],this["tar"]["y"]),this[a0_0x5592("0xce")](i["x"],i["y"]),t),Laya["Vector3"][a0_0x5592("0x2c0")](t,e);let a=Math[a0_0x5592("0x23d")](-e["y"],e["x"])-Math[a0_0x5592("0x23d")](-this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x918")]["x"]);if(a<0&&(a+=2*Math["PI"]),a<=.3)this["circle"]=!1;else{this["angle"]+=this["xv"]*r/2;let t=Math[a0_0x5592("0xc0")](this["angle"]/180*Math["PI"]),e=new Laya[a0_0x5592("0x97c")](0,0,0);Laya[a0_0x5592("0x97c")]["normalize"](new Laya[a0_0x5592("0x97c")](1,-t,0),e),(this[a0_0x5592("0x4ad")]>90&&this[a0_0x5592("0x4ad")]<270||this[a0_0x5592("0x4ad")]<-90&&this[a0_0x5592("0x4ad")]>-270)&&(e["x"]=-e["x"],e["y"]=-e["y"]),this["norV3"]["x"]=e["x"],this[a0_0x5592("0x918")]["y"]=e["y"]}}else{let t=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this["tar"]["x"],this["tar"]["y"]),this["getVec3"](i["x"],i["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,this[a0_0x5592("0x918")])}i[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this["norV3"]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),i["x"]+=r*this[a0_0x5592("0x918")]["x"],i["y"]+=r*this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x627")][a0_0x5592("0x48b")][a0_0x5592("0x2dc")](this[a0_0x5592("0xce")](this["norV3"]["x"]/t*r,0,this[a0_0x5592("0x918")]["y"]/t*r)),(i["x"]<=-360||i["x"]>=1080||i["y"]<=-640||i["y"]>=1920)&&this["owner"][a0_0x5592("0xaa4")](),this["quadTree"]["check"](this[a0_0x5592("0x8a4")][a0_0x5592("0x352")],this[a0_0x5592("0x1b2")])}}class fe extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this["beil"]=2,this["state"]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x5b6")]=.8}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this["selfCol"]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this["beil"]=2}["onDisable"](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this["owner"])}[a0_0x5592("0xb11")](t,e){}[a0_0x5592("0x3ec")](t,e){}["onLateUpdate"](){if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;if(this["state"]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")];this[a0_0x5592("0x629")]>1&&(this["beil"]-=.06);let e=this[a0_0x5592("0x5b6")]*this["beil"],a=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*e;t["x"]+=a*this["norV3"]["x"],t["y"]+=a*this[a0_0x5592("0x918")]["y"],(t["x"]<=-360||t["x"]>=1080||t["y"]<=-640||t["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](Y[a0_0x5592("0x173")][a0_0x5592("0x352")],this["selfCol"])}}class pe extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this["_norV3"]=null,this[a0_0x5592("0x4ad")]=0,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this["js"]=!1,this[a0_0x5592("0x2b1")]=null,this["pangle"]=0,this[a0_0x5592("0x5b6")]=.5,this[a0_0x5592("0x627")]=null}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this["quadTree"]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x4ad")]=0,this["js"]=!1,this[a0_0x5592("0x35e")]=P["START"];const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x8a0")],a=new Laya[a0_0x5592("0x745")],i=this[a0_0x5592("0x761")](b["YanHua"]),r=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](i);a["addChild"](r),t[a0_0x5592("0xa88")][a0_0x5592("0xab9")]("trails")[a0_0x5592("0x231")](a);let s=this["getVec3"]();t[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this["getVec3"](e["x"],e["y"]),s),a[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=s,this[a0_0x5592("0x627")]=a}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x627")]&&Laya[a0_0x5592("0x6ec")]["once"](200,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this["recover"](this["owner"])}),R["offAllCaller"](this)}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}["onCollisionExit"](t,e){}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P["START"])return;const n=this[a0_0x5592("0x8a0")];let o=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")],t=this[a0_0x5592("0x8a4")]["ratio3D"];if(this["js"]){if(this[a0_0x5592("0x2b1")]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]&&n["y"]-this[a0_0x5592("0x2b1")]["y"]>=50){let t=this[a0_0x5592("0xce")](),e=this[a0_0x5592("0xce")](),a=this[a0_0x5592("0xce")]();Laya["Vector3"][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this["tar"]["x"],this[a0_0x5592("0x2b1")]["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](this[a0_0x5592("0x918")],e,o/50,a),this["norV3"]=a}}else{if(this["tar"]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]&&n["y"]-this[a0_0x5592("0x2b1")]["y"]>=50){let t=this["getVec3"](),e=this[a0_0x5592("0xce")](),a=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this[a0_0x5592("0xce")](this[a0_0x5592("0x2b1")]["x"],this[a0_0x5592("0x2b1")]["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,e);let i=Math["atan2"](-e["y"],e["x"]);Laya[a0_0x5592("0x97c")]["lerp"](this[a0_0x5592("0xce")](this[a0_0x5592("0x450")]),this[a0_0x5592("0xce")](i),o/200,a),this[a0_0x5592("0x450")]=a["x"];let r=this[a0_0x5592("0x2b1")]["x"]-n["x"],s=this["tar"]["y"]-n["y"];r*r+s*s<=9e4&&(this["js"]=!0)}this[a0_0x5592("0x4ad")]+=20;let t=Math[a0_0x5592("0x695")](Math["cos"](this[a0_0x5592("0x4ad")]/180*Math["PI"])),e=.4*Math[a0_0x5592("0xc0")](t),a=new Laya[a0_0x5592("0x97c")](0,0,0),i=this["pangle"],r=1*Math[a0_0x5592("0x2d9")](i)+e*Math["sin"](i),s=e*Math["cos"](i)-1*Math[a0_0x5592("0x2d2")](i);Laya[a0_0x5592("0x97c")]["normalize"](this["getVec3"](r,s),a),this["norV3"]=a}n["rotation"]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),n["x"]+=o*this[a0_0x5592("0x918")]["x"],n["y"]+=o*this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x627")][a0_0x5592("0x48b")][a0_0x5592("0x2dc")](this[a0_0x5592("0xce")](this[a0_0x5592("0x918")]["x"]/t*o,0,this[a0_0x5592("0x918")]["y"]/t*o)),(n["x"]<=-360||n["x"]>=1080||n["y"]<=-640||n["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")]["check"](this["ins"]["enemyCols"],this["selfCol"])}}class me extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this["_norV3"]=null,this[a0_0x5592("0x4ad")]=0,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this["js"]=!1,this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x2b1")]=null,this[a0_0x5592("0x450")]=0,this[a0_0x5592("0x5b6")]=.5,this[a0_0x5592("0x627")]=null}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this["owner"][a0_0x5592("0x751")](W),this["quadTree"]||(this["quadTree"]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x4ad")]=0,this["js"]=!1,this[a0_0x5592("0x6ec")]=0,this["state"]=P[a0_0x5592("0xa5")];const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x8a0")],a=new Laya[a0_0x5592("0x745")],i=this[a0_0x5592("0x761")](b["CaiHon"]),r=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](i);a[a0_0x5592("0x231")](r),t[a0_0x5592("0xa88")][a0_0x5592("0xab9")](a0_0x5592("0xd"))["addChild"](a);let s=this[a0_0x5592("0xce")]();t[a0_0x5592("0x4bc")]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](e["x"],e["y"]-30),s),a[a0_0x5592("0x48b")]["position"]=s,this["s3d"]=a}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x627")]&&Laya[a0_0x5592("0x6ec")]["once"](0,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this["recover"](this[a0_0x5592("0x8a0")])}),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P["START"])return;const n=this[a0_0x5592("0x8a0")];let o=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")],t=this[a0_0x5592("0x8a4")][a0_0x5592("0x747")];if(this["js"]){if(this["tar"]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]&&n["y"]-this[a0_0x5592("0x2b1")]["y"]>=50){let t=this[a0_0x5592("0xce")](),e=this[a0_0x5592("0xce")](),a=this[a0_0x5592("0xce")]();Laya["Vector3"]["subtract"](this[a0_0x5592("0xce")](this[a0_0x5592("0x2b1")]["x"],this["tar"]["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),t),Laya["Vector3"][a0_0x5592("0x2c0")](t,e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](this[a0_0x5592("0x918")],e,o/50,a),this[a0_0x5592("0x918")]=a}o*=2}else{if(this["tar"]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]&&n["y"]-this[a0_0x5592("0x2b1")]["y"]>=200){let t=this[a0_0x5592("0xce")](),e=this[a0_0x5592("0xce")](),a=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](this[a0_0x5592("0x2b1")]["x"],this[a0_0x5592("0x2b1")]["y"]),this[a0_0x5592("0xce")](n["x"],n["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,e);let i=Math[a0_0x5592("0x23d")](-e["y"],e["x"]);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](this[a0_0x5592("0xce")](this[a0_0x5592("0x450")]),this["getVec3"](i),o/100,a),this[a0_0x5592("0x450")]=a["x"];let r=this["tar"]["x"]-n["x"],s=this[a0_0x5592("0x2b1")]["y"]-n["y"];r*r+s*s<=9e4&&(this["js"]=!0)}this[a0_0x5592("0x6ec")]>=1500&&(this["js"]=!0),this[a0_0x5592("0x6ec")]+=Laya["timer"][a0_0x5592("0x154")],this["angle"]+=5;let t=Math[a0_0x5592("0x695")](Math[a0_0x5592("0x2d9")](this[a0_0x5592("0x4ad")]/180*Math["PI"])),e=.7*Math["tan"](t),a=new Laya["Vector3"](0,0,0),i=this[a0_0x5592("0x450")],r=1*Math[a0_0x5592("0x2d9")](i)+e*Math[a0_0x5592("0x2d2")](i),s=e*Math["cos"](i)-1*Math[a0_0x5592("0x2d2")](i);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](this[a0_0x5592("0xce")](r,s),a),this[a0_0x5592("0x918")]=a}n[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),n["x"]+=o*this[a0_0x5592("0x918")]["x"],n["y"]+=o*this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x627")][a0_0x5592("0x48b")][a0_0x5592("0x2dc")](this[a0_0x5592("0xce")](this[a0_0x5592("0x918")]["x"]/t*o,0,this[a0_0x5592("0x918")]["y"]/t*o)),(n["x"]<=-360||n["x"]>=1080||n["y"]<=-640||n["y"]>=1920)&&this["owner"][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")]["enemyCols"],this[a0_0x5592("0x1b2")])}}class ge extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this["state"]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x4ad")]=0,this[a0_0x5592("0xb2e")]=null,this["speed"]=1,this["pid"]=0}get[a0_0x5592("0x918")](){return this["_norV3"]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e["rotation"]=-180-Math[a0_0x5592("0x23d")](-t["y"],t["x"])/Math["PI"]*180)}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x8a0")][a0_0x5592("0x1d4")]=this["type"]?this[a0_0x5592("0xb2e")]:B[a0_0x5592("0x400")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this["state"]=P["START"]}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0xb11")](t,e){}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){const t=this[a0_0x5592("0x8a4")];if(t[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P[a0_0x5592("0xa5")])return;const e=this["pid"],a=this[a0_0x5592("0x8a0")];let i=e?t[a0_0x5592("0x587")][e-1]["v2"]:t[a0_0x5592("0x94d")],r=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]/200*this[a0_0x5592("0x5b6")];this[a0_0x5592("0x4ad")]+=r,a[a0_0x5592("0x3b0")]=-180-this[a0_0x5592("0x4ad")]/Math["PI"]*180,a["x"]=i["x"]+200*Math[a0_0x5592("0x2d9")](this[a0_0x5592("0x4ad")]),a["y"]=i["y"]-200*Math[a0_0x5592("0x2d2")](this["angle"]),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](Y[a0_0x5592("0x173")][a0_0x5592("0x352")],this[a0_0x5592("0x1b2")])}}class ve extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x35e")]=P["READY"],this[a0_0x5592("0x5cc")]=!0,this[a0_0x5592("0x6e1")]=!1,this[a0_0x5592("0x6ec")]=0,this["startGet"]=0,this[a0_0x5592("0x4c4")]=0,this["staPos"]=this["getVec3"](),this[a0_0x5592("0x7fd")]=this[a0_0x5592("0xce")](),this[a0_0x5592("0x5f5")]=this[a0_0x5592("0xce")](),this[a0_0x5592("0xc5")]=this[a0_0x5592("0xce")](),this[a0_0x5592("0x5b6")]=.5,this[a0_0x5592("0x627")]=null}get["norV3"](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this["_norV3"]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this["quadTree"]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x5cc")]=!0,this[a0_0x5592("0x6e1")]=!1,this[a0_0x5592("0x6ec")]=0,this["startGet"]=0,this["state"]=P[a0_0x5592("0x61e")],R["on"](F[a0_0x5592("0x3b5")],this,()=>{this[a0_0x5592("0x35e")]=P["START"]});const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x8a0")],a=new Laya[a0_0x5592("0x745")],i=this[a0_0x5592("0x761")](b[a0_0x5592("0x131")]),r=Laya[a0_0x5592("0x745")]["instantiate"](i);a[a0_0x5592("0x231")](r),t["modSceneV3"][a0_0x5592("0xab9")]("trails")["addChild"](a);let s=this[a0_0x5592("0xce")]();t[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](e["x"],e["y"]),s),a["transform"][a0_0x5592("0x93a")]=s,this[a0_0x5592("0x627")]=a,this[a0_0x5592("0x4c4")]=0,this["setStaEndPos"]()}[a0_0x5592("0x43d")](){const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x8a4")];this[a0_0x5592("0x574")]=this["getVec3"](t["x"],t["y"]),this["endPos"]=this[a0_0x5592("0xce")](t["x"]+200*this[a0_0x5592("0x918")]["x"],t["y"]+200*this[a0_0x5592("0x918")]["y"]),e[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0x574")],this[a0_0x5592("0x7fd")]),e[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0x5f5")],this[a0_0x5592("0xc5")]),this[a0_0x5592("0x574")]=this[a0_0x5592("0x918")][a0_0x5592("0x408")]()}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x627")]&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this["s3d"][a0_0x5592("0xaa4")](),this["recover"](this[a0_0x5592("0x8a0")])}),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")]["removeSelf"]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0xa87")](t){return-((t-=1)*t*t*t-1)}[a0_0x5592("0x5b4")](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P["START"])return;const a=this[a0_0x5592("0x8a0")];let i=Laya["timer"][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")]*2,t=this[a0_0x5592("0x8a4")][a0_0x5592("0x747")];if(this[a0_0x5592("0x5cc")])if(this["timer2"]>=1)this[a0_0x5592("0x5cc")]=!1,this[a0_0x5592("0x4c4")]=0,this[a0_0x5592("0x42b")]++;else{let t=this[a0_0x5592("0x574")];this[a0_0x5592("0x7fd")],this[a0_0x5592("0x5f5")],this[a0_0x5592("0xc5")],this[a0_0x5592("0x627")];this[a0_0x5592("0x4c4")]+=.003*i/2;let e=this[a0_0x5592("0xa87")](this[a0_0x5592("0x4c4")]);this["norV3"]["x"]=t["x"]+(.2*t["x"]-t["x"])*e,this[a0_0x5592("0x918")]["y"]=t["y"]+(.2*t["y"]-t["y"])*e}else if(this[a0_0x5592("0x6ec")]>=1)this[a0_0x5592("0x5cc")]=!0,this[a0_0x5592("0x6e1")]=!1,this[a0_0x5592("0x6ec")]=0;else{if(!this[a0_0x5592("0x6e1")]){this["getTar"]=!0;let e=this["ins"]["getMinEnemy"](this[a0_0x5592("0x8a0")]);if(this["startGet"]>=2&&e&&e[a0_0x5592("0x2ed")]){let t=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")]["subtract"](this[a0_0x5592("0xce")](e["x"],e["y"]),this[a0_0x5592("0xce")](a["x"],a["y"]),t),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](t,this[a0_0x5592("0x918")])}else 1!=this[a0_0x5592("0x42b")]?(this[a0_0x5592("0x918")]["x"]=-this[a0_0x5592("0x574")]["x"],this["norV3"]["y"]=this["staPos"]["y"]):(this["norV3"]["x"]=this[a0_0x5592("0x574")]["x"],this[a0_0x5592("0x918")]["y"]=this[a0_0x5592("0x574")]["y"]);this[a0_0x5592("0x43d")]()}this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")]["delta"]}a["rotation"]=-(180-Math[a0_0x5592("0x23d")](this["norV3"]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),a["x"]+=i*this[a0_0x5592("0x918")]["x"],a["y"]+=i*this[a0_0x5592("0x918")]["y"],this[a0_0x5592("0x627")]&&this[a0_0x5592("0x627")]["transform"]["translate"](this[a0_0x5592("0xce")](this[a0_0x5592("0x918")]["x"]/t*i,0,this[a0_0x5592("0x918")]["y"]/t*i)),(a["x"]<=-360||a["x"]>=1080||a["y"]<=-640||a["y"]>=1920)&&this[a0_0x5592("0x8a0")]["removeSelf"](),this["quadTree"][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")][a0_0x5592("0x352")],this[a0_0x5592("0x1b2")])}}class ye extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this["skeNode"]=null,this[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x1ba")]=0}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const t=this[a0_0x5592("0x8a0")];t[a0_0x5592("0x1d4")]=B[a0_0x5592("0x6b6")],this[a0_0x5592("0x1b2")]=this["owner"][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this["quadTree"]=new _({x:0,y:0,width:720,height:1280})),t[a0_0x5592("0x143")]=!1,this["skeNode"]&&(this["skeNode"][a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")]),this["state"]=P[a0_0x5592("0xa5")];const e=D[a0_0x5592("0x53d")][V[a0_0x5592("0x714")]];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e["speed"],this,()=>{this[a0_0x5592("0x8a4")]["gameState"]==P["START"]&&(this[a0_0x5592("0x3dd")][a0_0x5592("0x27")]&&(this["skeNode"]["play"](0,!0),this[a0_0x5592("0x3dd")][a0_0x5592("0x7c2")](.8)),t["visible"]=!0,this[a0_0x5592("0xaf2")](250,()=>{this["quadTree"]["check"](Y[a0_0x5592("0x173")][a0_0x5592("0x352")],this["selfCol"]),this["selfCol"][a0_0x5592("0x5aa")]=[],R["event"](F["LaserHide"],this[a0_0x5592("0x1b2")])},this,2,null,!0,()=>{t[a0_0x5592("0x143")]=!1}))})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R["offAllCaller"](this)}[a0_0x5592("0xb11")](t,e){}["onCollisionExit"](t,e){}["onLateUpdate"](){const t=this[a0_0x5592("0x8a4")];if(t[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this["state"]!=P[a0_0x5592("0xa5")])return;const e=this[a0_0x5592("0x1ba")],a=this["owner"];let i=e?t["otherPlayer"][e-1]["v2"]:t[a0_0x5592("0x94d")];a["x"]=i["x"],a["y"]=i["y"]}}class Te extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this["t"]=0,this[a0_0x5592("0x2")]=!1,this[a0_0x5592("0xab4")]=!1,this[a0_0x5592("0x99e")]=null,this["pt"]=null,this["lastPos"]=null,this["state"]=P[a0_0x5592("0xa5")],this[a0_0x5592("0x2b1")]=null,this[a0_0x5592("0x5b6")]=1,this[a0_0x5592("0x3f3")]=!1,this[a0_0x5592("0x1f9")]=0,this[a0_0x5592("0xa7c")]=.05,this[a0_0x5592("0x24e")]=null,this[a0_0x5592("0x644")]=0,this[a0_0x5592("0x627")]=null}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e["rotation"]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this["selfCol"]=this[a0_0x5592("0x8a0")]["getComponent"](W),this[a0_0x5592("0x5b3")]||(this["quadTree"]=new _({x:0,y:0,width:720,height:1280})),this["t"]=0,this[a0_0x5592("0x2")]=!1,this[a0_0x5592("0xab4")]=!1;const e=this[a0_0x5592("0x8a0")];if(this[a0_0x5592("0x3b")]=this[a0_0x5592("0xce")](e["x"],e["y"]),this[a0_0x5592("0x24e")]){const a=new Laya[a0_0x5592("0x745")],i=this["getRes"](this[a0_0x5592("0x24e")]),r=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](i);a["addChild"](r),this[a0_0x5592("0x8a4")][a0_0x5592("0xa88")][a0_0x5592("0xab9")](a0_0x5592("0xd"))["addChild"](a);let t=this["getVec3"]();this["ins"][a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](e["x"],e["y"]),t),a[a0_0x5592("0x48b")]["position"]=t,this[a0_0x5592("0x627")]=a}}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x627")]?Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this[a0_0x5592("0x627")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}):this[a0_0x5592("0x77a")](this["owner"])}["bezier"](t,e,a,i,r){t["x"]=(1-e)*(1-e)*a["x"]+2*e*(1-e)*r["x"]+e*e*i["x"],t["y"]=(1-e)*(1-e)*a["y"]+2*e*(1-e)*r["y"]+e*e*i["y"];const s=this["getVec3"]();let n=this[a0_0x5592("0x8a4")]["ratio3D"];Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](t["x"],t["y"]),this[a0_0x5592("0x3b")],s),this[a0_0x5592("0x3b")]=this[a0_0x5592("0xce")](t["x"],t["y"]),this[a0_0x5592("0x627")]&&this[a0_0x5592("0x627")]["transform"]&&this[a0_0x5592("0x627")][a0_0x5592("0x48b")][a0_0x5592("0x2dc")](this[a0_0x5592("0xce")](s["x"]/n,0,s["y"]/n));let o=2*((1-e)*(r["x"]-a["x"])+e*(i["x"]-r["x"])),l=2*((1-e)*(r["y"]-a["y"])+e*(i["y"]-r["y"])),_=this[a0_0x5592("0xce")]();Laya["Vector3"][a0_0x5592("0x2c0")](this[a0_0x5592("0xce")](o,l,0),_),l<=0&&(this[a0_0x5592("0x918")]=_)}[a0_0x5592("0xb11")](t,e){if(this[a0_0x5592("0x3f3")]||this["owner"][a0_0x5592("0xaa4")](),this["trail"]==b[a0_0x5592("0x5fb")]){const a=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")],i=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x423")]),r=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x423")],i),s=this[a0_0x5592("0x8a0")];r["x"]=s["x"],r["y"]=s["y"];let t=r[a0_0x5592("0x751")](X);t||(t=r[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](Math[a0_0x5592("0x6fc")](this["att"]),a[a0_0x5592("0xae1")],a[a0_0x5592("0x2cd")],a[a0_0x5592("0x33f")],a["bosHurtStr"]),this["ins"][a0_0x5592("0xa7e")][a0_0x5592("0x231")](r)}}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this["state"]!=P[a0_0x5592("0xa5")])return;let t=this[a0_0x5592("0x8a4")][a0_0x5592("0x747")];this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")]["enemyCols"],this[a0_0x5592("0x1b2")]);const r=this[a0_0x5592("0x8a0")];let e=Laya["timer"]["delta"]*this[a0_0x5592("0x5b6")];if(this[a0_0x5592("0x2b1")]&&this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")])if(this[a0_0x5592("0x2b1")]["x"]<=0||this["tar"]["x"]>=720||this[a0_0x5592("0x2b1")]["y"]<=0||this["tar"]["y"]>=1280)this["t"]=1,this[a0_0x5592("0x2b1")]=null;else if(Math["abs"](r["y"]-this[a0_0x5592("0x2b1")]["y"])<=500&&!this["bezierd"]){this[a0_0x5592("0xab4")]=!0,this[a0_0x5592("0x99e")]=this["getVec3"](r["x"],r["y"]);let t=this["start"];const s=r["x"]>=this[a0_0x5592("0x2b1")]["x"]?-1:1;let e=this[a0_0x5592("0xce")](this["tar"]["x"],this[a0_0x5592("0x2b1")]["y"]+this[a0_0x5592("0x1f9")]*s),a=2*(t["x"]+(e["x"]-t["x"])/4)-(t["x"]+e["x"])/2,i=2*(t["y"]+(e["y"]-t["y"])/4*3)-(t["y"]+e["y"])/2;this["pt"]=this[a0_0x5592("0xce")](a,i),this["circle"]=!0}if(this["circle"]&&this[a0_0x5592("0x2b1")]&&this["tar"][a0_0x5592("0x2ed")]){if(this["t"]>=1)return void(this[a0_0x5592("0x2")]=!1);this["t"]+=this["tspeed"];const a=r["x"]>=this[a0_0x5592("0x2b1")]["x"]?-1:1;this[a0_0x5592("0x465")](r,this["t"],this[a0_0x5592("0x99e")],this["getVec3"](this[a0_0x5592("0x2b1")]["x"],this[a0_0x5592("0x2b1")]["y"]+this[a0_0x5592("0x1f9")]*a),this["pt"])}if(!this["circle"]||!this[a0_0x5592("0x2b1")]||!this[a0_0x5592("0x2b1")][a0_0x5592("0x2ed")]){r[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180);const i=e*this[a0_0x5592("0x918")]["x"],n=e*this["norV3"]["y"];r["x"]+=i,r["y"]+=n,this[a0_0x5592("0x627")]&&this[a0_0x5592("0x627")][a0_0x5592("0x48b")]&&this[a0_0x5592("0x627")][a0_0x5592("0x48b")]["translate"](this["getVec3"](i/t,0,n/t))}(r["x"]<=-360||r["x"]>=1080||r["y"]<=-640||r["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}}class Ee extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x1b2")]=null,this["state"]=P[a0_0x5592("0x61e")],this[a0_0x5592("0x176")]=null,this["shield2"]=null,this[a0_0x5592("0x1ba")]=0}["onEnable"](){this["ins"]=Y[a0_0x5592("0x173")];this[a0_0x5592("0x8a0")];this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],this["selfCol"]=this[a0_0x5592("0x8a0")]["getComponent"](W);const e=this[a0_0x5592("0x8a4")]["playerCols"];this[a0_0x5592("0x176")]["blendMode"]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")],this[a0_0x5592("0x359")]["blendMode"]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")],this[a0_0x5592("0x176")][a0_0x5592("0x7c2")](.2);const t=D["skills"][V[a0_0x5592("0x109")]];let a=1e3*(t["fspeed"]+t[a0_0x5592("0x5b6")]+1),i=1e3*t[a0_0x5592("0x214")];this[a0_0x5592("0x359")][a0_0x5592("0x14")]=0,this[a0_0x5592("0x176")]["alpha"]=0,Laya[a0_0x5592("0x6ec")]["loop"](a,this,()=>{this[a0_0x5592("0x176")][a0_0x5592("0x27")]&&(this[a0_0x5592("0x176")]["playbackRate"](.5),this["shield1"][a0_0x5592("0x590")](0,!1)),this["shield2"]["templet"]&&this[a0_0x5592("0x359")][a0_0x5592("0x7c2")](.5),this[a0_0x5592("0x176")][a0_0x5592("0x14")]=1,Laya["timer"]["once"](600,this,()=>{this[a0_0x5592("0x176")][a0_0x5592("0x14")]=0}),this[a0_0x5592("0x359")][a0_0x5592("0x2f")]=this[a0_0x5592("0x359")]["scaleY"]=0,Laya["Tween"]["to"](this[a0_0x5592("0x359")],{alpha:1,scaleX:1,scaleY:1},600,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{e[a0_0x5592("0x779")](this[a0_0x5592("0x1b2")])<0&&this[a0_0x5592("0x8a4")][a0_0x5592("0x532")][a0_0x5592("0x626")](this[a0_0x5592("0x1b2")])})),Laya[a0_0x5592("0x6ec")]["once"](i,this,()=>{let t=e["indexOf"](this[a0_0x5592("0x1b2")]);t>-1&&e[a0_0x5592("0x3c8")](t,1),Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x359")],{alpha:0},500)})})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")]["clearAll"](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R["offAllCaller"](this);const t=this[a0_0x5592("0x8a4")][a0_0x5592("0x532")];let e=t["indexOf"](this[a0_0x5592("0x1b2")]);e>-1&&t["splice"](e,1),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}["onCollisionEnter"](t,e){}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){const t=this["ins"],e=this[a0_0x5592("0x1ba")];let a=e?t[a0_0x5592("0x587")][e-1]["v2"]:t["playerV2"];this[a0_0x5592("0x8a0")][a0_0x5592("0x6f7")](a["x"],a["y"])}}class be extends t{constructor(){super(),this["ins"]=null,this["deltaX"]=0,this[a0_0x5592("0x1f9")]=0,this["pid"]=0}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")]}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x5b4")](){const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x1ba")];if(t[a0_0x5592("0x547")]!=P["START"])return;const a=this["owner"];let i=e?t["otherPlayer"][e-1][a0_0x5592("0xa3a")]:t[a0_0x5592("0xa3d")],r=Laya["timer"]["delta"]/1e3,s=this[a0_0x5592("0xce")](a["x"],a["y"]),n=this[a0_0x5592("0xce")](i["x"]+this["deltaX"],i["y"]+this["deltaY"]),o=this["getVec3"]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](s,n,8*r,o),a[a0_0x5592("0x6f7")](o["x"],o["y"])}}class Se extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["selfCol"]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x35e")]=P["READY"],this["_norV3"]=null,this[a0_0x5592("0x5b6")]=.6}get[a0_0x5592("0x918")](){return this["_norV3"]}set[a0_0x5592("0x918")](t){this["_norV3"]=t;const e=this[a0_0x5592("0x8a0")];e&&(e["rotation"]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")];const e=this[a0_0x5592("0x8a0")],a=this[a0_0x5592("0x8a4")];e["__type__"]=B[a0_0x5592("0x6b6")],this["selfCol"]=this["owner"][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")];const i=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x1d8")]);Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](100,this,()=>{if(a[a0_0x5592("0x547")]!=P["START"])return;this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](a[a0_0x5592("0x352")],this[a0_0x5592("0x1b2")]);const t=this["open"](w["battle"][a0_0x5592("0x1d8")],i);t[a0_0x5592("0x6f7")](e["x"],e["y"]),a[a0_0x5592("0xa7e")][a0_0x5592("0x231")](t),this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")]=[],R["event"](F[a0_0x5592("0x2ec")],this[a0_0x5592("0x1b2")])})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){}[a0_0x5592("0x3ec")](t,e){}["onLateUpdate"](){if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;if(this["state"]!=P["START"])return;const t=this[a0_0x5592("0x8a0")];let e=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]*this[a0_0x5592("0x5b6")];t[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180),t["x"]+=e*this[a0_0x5592("0x918")]["x"],t["y"]+=e*this["norV3"]["y"],(t["x"]<=-360||t["x"]>=1080||t["y"]<=-640||t["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}}class Ce extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x774")]=null,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0x774")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x9a5")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"];const s=this[a0_0x5592("0x8a4")],t=this[a0_0x5592("0x1ba")],n=this[a0_0x5592("0x8a0")],o=t?s[a0_0x5592("0x587")][t-1]["playerData"]:s[a0_0x5592("0x4ca")],l=D[a0_0x5592("0x53d")][V[a0_0x5592("0x740")]],e=l[a0_0x5592("0x5b6")]||5,_=l["fspeed"]||.2;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e,this,()=>{if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x9a5")],this[a0_0x5592("0x774")]);let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X));const a=l[a0_0x5592("0x8de")]||1;let i=o[a0_0x5592("0x1fa")]*a;o[a0_0x5592("0x53d")][V[a0_0x5592("0x740")]]&&(i+=o["attack"]*a*(o[a0_0x5592("0x53d")][V[a0_0x5592("0x740")]]-1)*2.4),e["setData"](i,o["crit"],o[a0_0x5592("0x2cd")],o["eneHurtStr"],o[a0_0x5592("0xa49")]);const r=t[a0_0x5592("0x751")](Se);r[a0_0x5592("0x5b6")]=_,r[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1),t[a0_0x5592("0x6f7")](n["x"],n["y"]),s["player2Node"][a0_0x5592("0x231")](t)})}[a0_0x5592("0x4fd")](){Laya["timer"][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R[a0_0x5592("0x5c7")](this)}["onLateUpdate"](){}}class Re extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["wing2BPre"]=null,this["xv"]=1,this[a0_0x5592("0x1ba")]=0,this["wing2BPre"]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0xb4")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"];const l=this[a0_0x5592("0x8a4")],t=this[a0_0x5592("0x1ba")],_=this[a0_0x5592("0x8a0")],h=t?l[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:l[a0_0x5592("0x4ca")],x=D[a0_0x5592("0x53d")][V[a0_0x5592("0xa63")]],e=x[a0_0x5592("0x5b6")]||5,c=x[a0_0x5592("0x214")]||.2;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e,this,()=>{if(l[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(!this[a0_0x5592("0x761")](b[a0_0x5592("0x9a9")]))return void S[a0_0x5592("0x1eb")]([b[a0_0x5592("0x9a9")]]);let e=0;const o={};for(let t=0;t<6;t++){let s=Math["floor"](89*Math[a0_0x5592("0x2ee")]()+1),t=Math[a0_0x5592("0xc0")](s/180*Math["PI"]),n=new Laya[a0_0x5592("0x97c")](0,0,0);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](new Laya[a0_0x5592("0x97c")](1,t,0),n),n["x"]*=this["xv"],e+=Math[a0_0x5592("0x6fc")](251*Math[a0_0x5592("0x2ee")]()+50),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](e,this,()=>{const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerWing2b"],this[a0_0x5592("0xa59")]);let e=t[a0_0x5592("0x751")](X);e||(e=t["addComponent"](X));const a=x[a0_0x5592("0x8de")]||1;let i=h["attack"]*a;h[a0_0x5592("0x53d")][V["MissileWing"]]&&(i+=h[a0_0x5592("0x1fa")]*a*(h[a0_0x5592("0x53d")][V["MissileWing"]]-1)*2.4),e[a0_0x5592("0x971")](i,h["crit"],h[a0_0x5592("0x2cd")],h["eneHurtStr"],h[a0_0x5592("0xa49")]);const r=t[a0_0x5592("0x751")](ue);r["speed"]=c,r[a0_0x5592("0x918")]=n,r[a0_0x5592("0x4ad")]=this["xv"]>0?-s:s+180,r["xv"]=this["xv"],r[a0_0x5592("0x2b1")]=l[a0_0x5592("0x9a8")](_,o),t[a0_0x5592("0x6f7")](_["x"],_["y"]+20),l[a0_0x5592("0x1af")][a0_0x5592("0x231")](t)})}})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")]["clearAll"](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R[a0_0x5592("0x5c7")](this)}["onLateUpdate"](){}}class Ae extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this["animNode"]=null,this[a0_0x5592("0x639")]=V["Laser"]}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")];const t=this["owner"];t["__type__"]=B[a0_0x5592("0x87e")],t[a0_0x5592("0x3fd")]=this["bid"]==V[a0_0x5592("0xad5")]?1:2,Laya["timer"][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),t[a0_0x5592("0x14")]=1;const e=D["skills"][this[a0_0x5592("0x639")]];let a=1e3*(e["fspeed"]+e[a0_0x5592("0x5b6")]+1),i=1e3*e[a0_0x5592("0x5b6")]+500;Laya[a0_0x5592("0x6ec")]["loop"](a,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{alpha:0},500,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{this[a0_0x5592("0x9ec")]()})),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](i,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{alpha:1},500)})}),R["on"](F[a0_0x5592("0x5f3")],this,()=>{this[a0_0x5592("0x8a4")]["gameState"]==P[a0_0x5592("0xa5")]?t[a0_0x5592("0x143")]=!0:t["visible"]=!1});const r=this[a0_0x5592("0x4a0")];r&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](300,this,()=>{r&&Laya[a0_0x5592("0x6eb")]["to"](r,{scaleX:1.5},150,null,Laya["Handler"]["create"](this,()=>{r&&Laya["Tween"]["to"](r,{scaleX:1},150,null)}))})}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x9ec")](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya["Tween"]["clearAll"](this),R["offAllCaller"](this)}[a0_0x5592("0x9ec")](){this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")][a0_0x5592("0xb0e")]=0,R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ec")],this[a0_0x5592("0x1b2")])}[a0_0x5592("0xb11")](t,e){}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")];t[a0_0x5592("0x143")]&&t[a0_0x5592("0x14")]>=.1&&this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this["ins"]["enemyCols"],this["selfCol"])}}class Le extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1e8")]=null,this["tar"]=null,this[a0_0x5592("0xd2")]=0,this["deltaY"]=0}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1e8")]&&(this[a0_0x5592("0x1e8")]["blendMode"]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")])}[a0_0x5592("0x4fd")](){}["onLateUpdate"](){if(this[a0_0x5592("0x8a4")]["gameState"]!=P[a0_0x5592("0xa5")])return;if(!this[a0_0x5592("0x2b1")])return;const t=this[a0_0x5592("0x8a0")];let e=this["tar"];t["pos"](e["x"]+this["deltaX"],e["y"]+this[a0_0x5592("0x1f9")])}}class Ie extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x2e5")]=null,this["xv"]=1,this[a0_0x5592("0x1ba")]=0,this["wing3BPre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x3e8")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const r=this[a0_0x5592("0x8a4")],t=this[a0_0x5592("0x1ba")],s=(this[a0_0x5592("0x8a0")],t?r[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:r[a0_0x5592("0x4ca")]),n=t?r[a0_0x5592("0x587")][t-1][a0_0x5592("0x685")]:r["plaBallsV2"],o=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x3e8")],this[a0_0x5592("0x2e5")]);Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{let t=o[a0_0x5592("0x751")](X);t||(t=o[a0_0x5592("0x2a6")](X));const e=D["skills"][V[a0_0x5592("0x296")]][a0_0x5592("0x8de")]||1;let a=s[a0_0x5592("0x1fa")]*e;s[a0_0x5592("0x53d")][V[a0_0x5592("0x296")]]&&(a+=s[a0_0x5592("0x1fa")]*e*(s[a0_0x5592("0x53d")][V[a0_0x5592("0x296")]]-1)*2.4),t[a0_0x5592("0x971")](a,s[a0_0x5592("0xae1")],s["critHurt"],s[a0_0x5592("0x33f")],s[a0_0x5592("0xa49")]);let i=this[a0_0x5592("0x8a0")];o[a0_0x5592("0x751")](Le)[a0_0x5592("0x2b1")]=i,o[a0_0x5592("0x751")](Ae)["bid"]=V[a0_0x5592("0x296")],o[a0_0x5592("0x6f7")](i["x"],i["y"]),r["playerNode"][a0_0x5592("0x231")](o),n[a0_0x5592("0x626")](o)})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x5b4")](){}}class Me extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["wing4BPre"]=null,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0x854")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["PlayerWing4b"])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"];const l=this[a0_0x5592("0x8a4")],t=this[a0_0x5592("0x1ba")],_=this[a0_0x5592("0x8a0")],h=t?l[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:l["playerData"],x=D[a0_0x5592("0x53d")][V["AutoWing"]],e=x[a0_0x5592("0x5b6")]||.2,c=x[a0_0x5592("0x214")]||.2;Laya[a0_0x5592("0x6ec")]["once"](500,this,()=>{Laya["timer"][a0_0x5592("0x861")](1e3*e,this,()=>{if(l[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const a=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x600")],this[a0_0x5592("0x854")]);let t=a["getComponent"](X);t||(t=a[a0_0x5592("0x2a6")](X));const e=x["value"]||1;let i=h[a0_0x5592("0x1fa")]*e;h[a0_0x5592("0x53d")][V[a0_0x5592("0x894")]]&&(i+=h[a0_0x5592("0x1fa")]*e*(h[a0_0x5592("0x53d")][V[a0_0x5592("0x894")]]-1)*2.4),t[a0_0x5592("0x971")](i,h[a0_0x5592("0xae1")],h[a0_0x5592("0x2cd")],h["eneHurtStr"],h[a0_0x5592("0xa49")]);const r=a[a0_0x5592("0x751")]($t);r[a0_0x5592("0x5b6")]=c,r["state"]=P[a0_0x5592("0xa5")],r[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1);let s=l[a0_0x5592("0x668")](_),n=180;if(s&&s["parent"]){r[a0_0x5592("0x2b1")]=s;let t=this[a0_0x5592("0xce")](0,-1),e=this["getVec3"]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](s["x"],s["y"]),this["getVec3"](_["x"],_["y"]),e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](e,t),r["norV3"]=t,n=a[a0_0x5592("0x3b0")]}const o=(90-a[a0_0x5592("0x3b0")])/180*Math["PI"];_[a0_0x5592("0x3b0")]=n,a["pos"](_["x"]-30*Math[a0_0x5592("0x2d9")](o),_["y"]+30*Math["sin"](o)),l[a0_0x5592("0x1af")][a0_0x5592("0x231")](a)})})}["onDisable"](){Laya["timer"][a0_0x5592("0x61b")](this),Laya["Tween"][a0_0x5592("0x61b")](this),R["offAllCaller"](this)}[a0_0x5592("0x5b4")](){}}class De extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x845")]=null,this["xv"]=1,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0x845")]=this["getRes"](w[a0_0x5592("0x4f3")]["PlayerWing5b"])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const o=this[a0_0x5592("0x8a4")],t=this[a0_0x5592("0x1ba")],l=this[a0_0x5592("0x8a0")],_=t?o["otherPlayer"][t-1][a0_0x5592("0x4ca")]:o[a0_0x5592("0x4ca")],h=D[a0_0x5592("0x53d")][V[a0_0x5592("0x842")]],e=h[a0_0x5592("0x5b6")]||.2,x=h[a0_0x5592("0x214")]||.2,c=[this[a0_0x5592("0xce")](.03,-1),this[a0_0x5592("0xce")](.07,-1),this[a0_0x5592("0xce")](.1,-.99),this[a0_0x5592("0xce")](.14,-.99),this["getVec3"](.17,-.98),this[a0_0x5592("0xce")](.21,-.98)];let d=0;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{Laya["timer"][a0_0x5592("0x861")](1e3*e,this,()=>{if(o[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;d>=6&&(d=0);const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xa4c")],this[a0_0x5592("0x845")]);t[a0_0x5592("0x91f")]=a0_0x5592("0x453");let e=t["getComponent"](X);e||(e=t[a0_0x5592("0x2a6")](X));const a=h[a0_0x5592("0x8de")]||1;let i=_[a0_0x5592("0x1fa")]*a;_[a0_0x5592("0x53d")][V[a0_0x5592("0x842")]]&&(i+=_[a0_0x5592("0x1fa")]*a*(_["skills"][V[a0_0x5592("0x842")]]-1)*2.4),e[a0_0x5592("0x971")](i,_["crit"],_["critHurt"],_[a0_0x5592("0x33f")],_[a0_0x5592("0xa49")]);const r=t[a0_0x5592("0x751")](_e);let s=c[d];r["norV3"]=this["getVec3"](s["x"]*this["xv"],s["y"]),r["speed"]=x,t[a0_0x5592("0x6f7")](l["x"],l["y"]),o[a0_0x5592("0x1af")][a0_0x5592("0x231")](t);const n=t[a0_0x5592("0xab9")]("bi");n[a0_0x5592("0x1c1")]=0,Laya[a0_0x5592("0x6eb")]["clearAll"](n),Laya[a0_0x5592("0x6eb")]["to"](n,{height:66},100),d++})})}["onDisable"](){Laya["timer"][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x5b4")](){}}class we extends t{constructor(){super(),this["ins"]=null,this["wing6BPre"]=null,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0x936")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x59c")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const a=this[a0_0x5592("0x8a4")],t=this[a0_0x5592("0x1ba")],i=this[a0_0x5592("0x8a0")],e=(t?a[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:a[a0_0x5592("0x4ca")],D[a0_0x5592("0x53d")][V[a0_0x5592("0x8e")]]),r=e[a0_0x5592("0x5b6")]||5,s=e[a0_0x5592("0x214")]||.2;Laya["timer"][a0_0x5592("0x861")](1e3*r,this,()=>{if(a[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x59c")],this[a0_0x5592("0x936")]),e=t["getComponent"](xe);e[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1),e[a0_0x5592("0x5b6")]=s,t[a0_0x5592("0x6f7")](i["x"],i["y"]-30),a[a0_0x5592("0x1af")][a0_0x5592("0x231")](t)})}["onDisable"](){Laya["timer"]["clearAll"](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R["offAllCaller"](this)}[a0_0x5592("0x5b4")](){}}class Pe extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x8f7")]=null,this["plaBul3Pre"]=null,this[a0_0x5592("0x8f9")]=null,this["plaBul5Pre"]=null,this[a0_0x5592("0x8ed")]=null,this[a0_0x5592("0x11c")]=null,this[a0_0x5592("0x324")]=null,this[a0_0x5592("0x3eb")]=null,this[a0_0x5592("0x76e")]=null,this["skill3Pre"]=null,this[a0_0x5592("0x249")]=null,this[a0_0x5592("0x2b")]=null,this[a0_0x5592("0xa25")]=null,this[a0_0x5592("0xa12")]=null,this[a0_0x5592("0x6ce")]=null,this[a0_0x5592("0xf7")]=null,this[a0_0x5592("0x552")]=null,this["skill2012Pre"]=null,this[a0_0x5592("0x128")]=null,this[a0_0x5592("0x8a9")]=null,this[a0_0x5592("0x79b")]=null,this[a0_0x5592("0x593")]=null,this["plaWing3Pre"]=null,this[a0_0x5592("0x541")]=null,this["plaWing5Pre"]=null,this[a0_0x5592("0x3a9")]=null,this[a0_0x5592("0x642")]=null,this["plaRob2Pre"]=null,this[a0_0x5592("0x8c3")]=null,this["plaBul1Pre"]=this["getRes"](w[a0_0x5592("0x4f3")]["Player1Bullet"]),this[a0_0x5592("0x10e")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x670")]),this["plaBul4Pre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x6f8")]),this[a0_0x5592("0x9cf")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["Player5Bullet"]),this["plaBul6Pre"]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x479")]),this[a0_0x5592("0x11c")]=this[a0_0x5592("0x761")](w["battle"]["Player6Bullet1"]),this[a0_0x5592("0x324")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x2f8")]),this[a0_0x5592("0x3eb")]=this["getRes"](w["battle"][a0_0x5592("0x72")]),this["skill2Pre"]=this["getRes"](w["battle"]["PlayerSkill2"]),this[a0_0x5592("0x959")]=this[a0_0x5592("0x761")](w["battle"]["PlayerSkill3"]),this[a0_0x5592("0x249")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x850")]),this[a0_0x5592("0x2b")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x6d7")]),this[a0_0x5592("0xa25")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0xae2")]),this[a0_0x5592("0xa12")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0xb27")]),this[a0_0x5592("0x6ce")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x1c0")]),this[a0_0x5592("0xf7")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x252")]),this[a0_0x5592("0x552")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x73")]),this["skill2002Pre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x116")]),this[a0_0x5592("0xa8e")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["PlayerSkill2012"]),this[a0_0x5592("0x128")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x12")]),this[a0_0x5592("0x79b")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x38c")]),this[a0_0x5592("0x593")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x60")]),this["plaWing3Pre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x5e1")]),this[a0_0x5592("0x541")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x822")]),this[a0_0x5592("0x43e")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x342")]),this[a0_0x5592("0x3a9")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0x363")]),this[a0_0x5592("0x642")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x6b5")]),this[a0_0x5592("0x32e")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0xada")]),this[a0_0x5592("0x8c3")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0xb1")])}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],R["on"](F["PlayerBullet"],this,this[a0_0x5592("0x434")]),R["on"](F[a0_0x5592("0x557")],this,this[a0_0x5592("0x301")]),R["on"](F[a0_0x5592("0x6b3")],this,this[a0_0x5592("0x435")]),R["on"](F[a0_0x5592("0x6db")],this,this[a0_0x5592("0x435")]),R["on"](F[a0_0x5592("0x7f6")],this,this["baseSkill1"]),R["on"](F[a0_0x5592("0x6a")],this,this[a0_0x5592("0xb2f")]),R["on"](F[a0_0x5592("0x7bc")],this,this["baseSkill2"]),R["on"](F[a0_0x5592("0x7e")],this,this[a0_0x5592("0xb2f")]),R["on"](F[a0_0x5592("0x103")],this,this[a0_0x5592("0xb32")]),R["on"](F[a0_0x5592("0x1a5")],this,this[a0_0x5592("0x18e")]),R["on"](F[a0_0x5592("0xb7")],this,this[a0_0x5592("0x18e")]),R["on"](F["BaseSkill4b"],this,this[a0_0x5592("0x18e")]),R["on"](F["BaseSkill5"],this,this[a0_0x5592("0xa93")]),R["on"](F[a0_0x5592("0x6e4")],this,this["baseSkill5"]),R["on"](F[a0_0x5592("0x396")],this,this[a0_0x5592("0xa93")]),R["on"](F["BaseSkill6"],this,this[a0_0x5592("0x676")]),R["on"](F[a0_0x5592("0x484")],this,this[a0_0x5592("0x676")]),R["on"](F[a0_0x5592("0x32f")],this,this["baseSkill6"]),R["on"](F[a0_0x5592("0x195")],this,this[a0_0x5592("0x99")]),R["on"](F[a0_0x5592("0x3ca")],this,this[a0_0x5592("0xa64")]),R["on"](F[a0_0x5592("0x4f7")],this,this[a0_0x5592("0x658")]),R["on"](F[a0_0x5592("0x248")],this,this[a0_0x5592("0x278")]),R["on"](F[a0_0x5592("0x586")],this,this["baseSkill14"]),R["on"](F["BaseSkill15"],this,this[a0_0x5592("0x9ba")]),R["on"](F[a0_0x5592("0x887")],this,this[a0_0x5592("0x48a")]),R["on"](F[a0_0x5592("0x109")],this,this[a0_0x5592("0x7b2")]),R["on"](F[a0_0x5592("0x303")],this,this["dieShot"]),R["on"](F["SuckBlood"],this,this[a0_0x5592("0x3e4")]),R["on"](F[a0_0x5592("0x2a9")],this,this[a0_0x5592("0x95c")]),R["on"](F["BulSkill1"],this,this["skill"]),R["on"](F[a0_0x5592("0x430")],this,this[a0_0x5592("0xaa5")]),R["on"](F[a0_0x5592("0x91d")],this,this[a0_0x5592("0x101")]),R["on"](F[a0_0x5592("0x16b")],this,this[a0_0x5592("0x312")]),R["on"](F["BulSkill5"],this,this["skill5"]),R["on"](F["BulSkill6"],this,this[a0_0x5592("0x349")]),R["on"](F["BulSkill7"],this,this[a0_0x5592("0x9eb")]),R["on"](F[a0_0x5592("0x251")],this,this[a0_0x5592("0x4c5")]),R["on"](F[a0_0x5592("0xaf7")],this,this[a0_0x5592("0x1cc")]),R["on"](F[a0_0x5592("0x83f")],this,this["skill10"]),R["on"](F[a0_0x5592("0x300")],this,this[a0_0x5592("0x64")]),R["on"](F[a0_0x5592("0x5ea")],this,this["skill2013"]),R["on"](F[a0_0x5592("0x598")],this,this["skill2002"]),R["on"](F[a0_0x5592("0x51b")],this,this[a0_0x5592("0x4f2")]),R["on"](F[a0_0x5592("0x424")],this,this[a0_0x5592("0x2db")]),R["on"](F["WingSkill3"],this,this["wing3"]),R["on"](F[a0_0x5592("0x177")],this,this[a0_0x5592("0x138")]),R["on"](F[a0_0x5592("0x9dc")],this,this[a0_0x5592("0x70e")]),R["on"](F[a0_0x5592("0x3ae")],this,this["wing6"]),R["on"](F[a0_0x5592("0x86d")],this,this[a0_0x5592("0x8eb")]),R["on"](F["RobSkill2"],this,this[a0_0x5592("0x28d")]),R["on"](F[a0_0x5592("0x512")],this,this["robot3"]),R["on"](F[a0_0x5592("0x609")],this,this[a0_0x5592("0x78b")]),R["on"](F["Sup_Att"],this,this["supSkill2"]),R["on"](F[a0_0x5592("0x60b")],this,this[a0_0x5592("0x245")]),R["on"](F[a0_0x5592("0x8")],this,this[a0_0x5592("0x416")]),R["on"](F[a0_0x5592("0x502")],this,this[a0_0x5592("0x79d")])}[a0_0x5592("0x4fd")](){Laya["timer"]["clearAll"](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x301")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0xfe")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0xfe")]),R[a0_0x5592("0xcf")](F["BulSkill2"]),R[a0_0x5592("0xcf")](F["BulSkill2002"]),R["event"](F[a0_0x5592("0x5ea")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0x300")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0x303")]),R["event"](F["Shield"]),R[a0_0x5592("0xcf")](F["BaseSkill6"]),R["event"](F[a0_0x5592("0x86f")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0x86f")])}[a0_0x5592("0x434")](t,e){switch(e||(e=0),t){case 1:this[a0_0x5592("0x32b")](e);break;case 2:this[a0_0x5592("0x30d")](e);break;case 3:this[a0_0x5592("0x903")](e);break;case 4:this[a0_0x5592("0x8b6")](e);break;case 5:this[a0_0x5592("0x48c")](e);break;case 6:this[a0_0x5592("0x9dd")](e)}}["player1Bullet"](t){const e=this[a0_0x5592("0x8a4")],a=t?1e3*e["otherPlayer"][t-1][a0_0x5592("0x4ca")][a0_0x5592("0x5b6")]:1e3*e["playerData"][a0_0x5592("0x5b6")],i=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x149")](i,this["player1BulletCall"]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](a,i,this["player1BulletCall"],[t,this])}[a0_0x5592("0x518")](t,r){const s=r[a0_0x5592("0x8a4")],n=t?s["otherPlayer"][t-1]["v2"]:s[a0_0x5592("0x94d")];if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const o=t?s[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:s[a0_0x5592("0x4ca")];let e=3,l=o["mainNum"]*o[a0_0x5592("0x640")][a0_0x5592("0x7fa")],_=Ct[o["id"]][o[a0_0x5592("0x612")]];l&&(e+=l);for(let i=0;i<e;i++){const h=r[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["Player1Bullet"],r[a0_0x5592("0x8f7")]);h[a0_0x5592("0x91f")]=a0_0x5592("0xa70");let t=h["getComponent"](X);t||(t=h[a0_0x5592("0x2a6")](X));let e=o["attack"]*o[a0_0x5592("0x640")][a0_0x5592("0x644")]/(l+1);t["setData"](Math[a0_0x5592("0x6fc")](e),o["crit"],o[a0_0x5592("0x2cd")],o[a0_0x5592("0x33f")],o["bosHurtStr"]);let a=h[a0_0x5592("0x751")](Te);a||(a=h[a0_0x5592("0x2a6")](Te)),a[a0_0x5592("0x918")]=r[a0_0x5592("0xce")](0,-1),a[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],a[a0_0x5592("0x2b1")]=null,a["speed"]=o[a0_0x5592("0x214")],a["cross"]=o[a0_0x5592("0x3f3")],a[a0_0x5592("0x1f9")]=_[i],h["pos"](n["x"]+_[i],n["y"]-30),o["track"]&&(a[a0_0x5592("0x3f3")]=!1,a[a0_0x5592("0x2b1")]=s[a0_0x5592("0x668")](h)),s["player2Node"][a0_0x5592("0x231")](h)}}[a0_0x5592("0x30d")](t){const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")],i=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x2f8")],this["plaBulPre"]),r=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")];let s=i[a0_0x5592("0x751")](X);s||(s=i[a0_0x5592("0x2a6")](X));let n=a[a0_0x5592("0x1fa")]*a[a0_0x5592("0x640")][a0_0x5592("0x644")]/(a[a0_0x5592("0x612")]+1)/9;s[a0_0x5592("0x971")](Math[a0_0x5592("0x6fc")](n),a["crit"],a[a0_0x5592("0x2cd")],a[a0_0x5592("0x33f")],a[a0_0x5592("0xa49")]),i[a0_0x5592("0x751")](oe)["pid"]=t;const o=i[a0_0x5592("0x751")](ne);o[a0_0x5592("0x1f9")]=-40,o[a0_0x5592("0x1ba")]=t,i[a0_0x5592("0x6f7")](r["x"],r["y"]-40),e["playerNode"][a0_0x5592("0x231")](i),(t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x7a")]:e[a0_0x5592("0x860")])[a0_0x5592("0x626")](i)}["player3Bullet"](t){const e=this["ins"],a=t?1e3*e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")][a0_0x5592("0x5b6")]:1e3*e[a0_0x5592("0x4ca")][a0_0x5592("0x5b6")],i=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x149")](i,this["player3BulletCall"]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](a,i,this[a0_0x5592("0x5f1")],[t,this])}["player3BulletCall"](t,n){const o=n[a0_0x5592("0x8a4")],l=t?o[a0_0x5592("0x587")][t-1]["v2"]:o[a0_0x5592("0x94d")];if(o[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const _=t?o[a0_0x5592("0x587")][t-1]["playerData"]:o[a0_0x5592("0x4ca")],h=Ct[3][_[a0_0x5592("0x612")]],x=1+_["mainNum"]*_[a0_0x5592("0x640")]["weapon"],c={};for(let s=0;s<h[a0_0x5592("0xb0e")];s++){const d=n[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x670")],n[a0_0x5592("0x10e")]);let t=d[a0_0x5592("0x751")](X);t||(t=d[a0_0x5592("0x2a6")](X));let e=_[a0_0x5592("0x1fa")]*_[a0_0x5592("0x640")][a0_0x5592("0x644")]/x;t["setData"](Math[a0_0x5592("0x6fc")](e),_[a0_0x5592("0xae1")],_[a0_0x5592("0x2cd")],_[a0_0x5592("0x33f")],_[a0_0x5592("0xa49")]);let a=d[a0_0x5592("0x751")](ue);a[a0_0x5592("0x24e")]=b["DaoDan"],a[a0_0x5592("0x4ad")]=h[s],a["xv"]=Math["abs"](h[s])>90?-1:1,a[a0_0x5592("0x2b1")]=n[a0_0x5592("0x8a4")]["getMinEnemy2"](l,c),a["cross"]=_[a0_0x5592("0x3f3")];let i=Math["tan"](h[s]/180*Math["PI"]),r=new Laya["Vector3"](0,0,0);Laya[a0_0x5592("0x97c")]["normalize"](new Laya[a0_0x5592("0x97c")](1,-i,0),r),r["x"]*=a["xv"],a[a0_0x5592("0x918")]=r,d["pos"](l["x"],l["y"]),o[a0_0x5592("0x1af")][a0_0x5592("0x231")](d)}}["player4Bullet"](t){const e=this["ins"],a=t?1e3*e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")][a0_0x5592("0x5b6")]:1e3*e[a0_0x5592("0x4ca")][a0_0x5592("0x5b6")],i=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")];Laya["timer"][a0_0x5592("0x149")](i,this["player4BulletCall"]),Laya["timer"][a0_0x5592("0x861")](a,i,this["player4BulletCall"],[t,this])}[a0_0x5592("0x21a")](t,r){const s=r[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1]["v2"]:s["playerV2"];if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const o=t?s["otherPlayer"][t-1][a0_0x5592("0x4ca")]:s[a0_0x5592("0x4ca")],e=[[r[a0_0x5592("0xce")](0,-1)],[r[a0_0x5592("0xce")](-.09,-1),r["getVec3"](.09,-1)],[r[a0_0x5592("0xce")](-.17,-.98),r[a0_0x5592("0xce")](0,-1),r[a0_0x5592("0xce")](.17,-.98)],[r[a0_0x5592("0xce")](-.26,-.97),r["getVec3"](-.09,-1),r[a0_0x5592("0xce")](.09,-1),r["getVec3"](.26,-.97)]];let a=1,i=o[a0_0x5592("0x612")]*o[a0_0x5592("0x640")][a0_0x5592("0x7fa")],l=Ct[o["id"]][o["mainNum"]],_=e[o[a0_0x5592("0x612")]];i&&(a+=i);for(let i=0;i<a;i++){const h=r["open"](w[a0_0x5592("0x4f3")]["Player4Bullet"],r[a0_0x5592("0x8f9")]);let t=h["getComponent"](X);t||(t=h[a0_0x5592("0x2a6")](X));let e=o[a0_0x5592("0x1fa")]*o["planeData"][a0_0x5592("0x644")];t["setData"](Math["floor"](e),o["crit"],o[a0_0x5592("0x2cd")],o[a0_0x5592("0x33f")],o[a0_0x5592("0xa49")]);let a=h[a0_0x5592("0x751")](Te);a||(a=h[a0_0x5592("0x2a6")](Te)),a["att"]=e,a[a0_0x5592("0x24e")]=b["Main4"],a[a0_0x5592("0x918")]=_[i],a[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],a[a0_0x5592("0x2b1")]=null,a[a0_0x5592("0x5b6")]=o[a0_0x5592("0x214")],a[a0_0x5592("0xa7c")]=.02,a[a0_0x5592("0x3f3")]=o[a0_0x5592("0x3f3")],a["deltaY"]=l[i],h[a0_0x5592("0x6f7")](n["x"]+l[i],n["y"]+0),o[a0_0x5592("0x253")]&&(a[a0_0x5592("0x3f3")]=!1,a["tar"]=s[a0_0x5592("0x668")](h)),s[a0_0x5592("0x1af")][a0_0x5592("0x231")](h)}}[a0_0x5592("0x48c")](t){const e=this[a0_0x5592("0x8a4")],a=t?1e3*e["otherPlayer"][t-1][a0_0x5592("0x4ca")][a0_0x5592("0x5b6")]:1e3*e[a0_0x5592("0x4ca")][a0_0x5592("0x5b6")],i=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x149")](i,this[a0_0x5592("0x56f")]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](a,i,this["player5BulletCall"],[t,this])}[a0_0x5592("0x56f")](t,r){const s=r[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1]["v2"]:s["playerV2"];if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const o=t?s[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:s[a0_0x5592("0x4ca")],e=[[r["getVec3"](.0039,-1),r["getVec3"](-.0039,-1)],[r[a0_0x5592("0xce")](.0117,-.9999),r["getVec3"](-.0117,-.9999),r["getVec3"](.0039,-1),r[a0_0x5592("0xce")](-.0039,-1)],[r[a0_0x5592("0xce")](.0195,-.9998),r[a0_0x5592("0xce")](-.0195,-.9998),r[a0_0x5592("0xce")](.0117,-.9999),r["getVec3"](-.0117,-.9999),r[a0_0x5592("0xce")](.0039,-1),r[a0_0x5592("0xce")](-.0039,-1)],[r[a0_0x5592("0xce")](.0273,-.9996),r[a0_0x5592("0xce")](-.0273,-.9996),r[a0_0x5592("0xce")](.0195,-.9998),r[a0_0x5592("0xce")](-.0195,-.9998),r[a0_0x5592("0xce")](.0117,-.9999),r[a0_0x5592("0xce")](-.0117,-.9999),r[a0_0x5592("0xce")](.0039,-1),r[a0_0x5592("0xce")](-.0039,-1)]];let a=2,l=o[a0_0x5592("0x612")]*o[a0_0x5592("0x640")]["weapon"],_=Ct[o["id"]][o[a0_0x5592("0x612")]],h=e[o[a0_0x5592("0x612")]];l&&(a+=l);for(let i=0;i<a;i++){const x=r[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x60e")],r[a0_0x5592("0x9cf")]);x[a0_0x5592("0x91f")]=a0_0x5592("0xa24");let t=x["getComponent"](X);t||(t=x[a0_0x5592("0x2a6")](X));let e=o[a0_0x5592("0x1fa")]*o[a0_0x5592("0x640")][a0_0x5592("0x644")]/(l+1);t["setData"](Math[a0_0x5592("0x6fc")](e),o[a0_0x5592("0xae1")],o["critHurt"],o["eneHurtStr"],o["bosHurtStr"]);let a=x[a0_0x5592("0x751")](Te);a||(a=x[a0_0x5592("0x2a6")](Te)),a[a0_0x5592("0x918")]=h[i],a["state"]=P[a0_0x5592("0xa5")],a[a0_0x5592("0x2b1")]=null,a[a0_0x5592("0x5b6")]=o["fspeed"],a[a0_0x5592("0xa7c")]=.05,a["cross"]=o[a0_0x5592("0x3f3")],a[a0_0x5592("0x1f9")]=_[i],x[a0_0x5592("0x6f7")](n["x"]+_[i],n["y"]-40),o["track"]&&(a[a0_0x5592("0x3f3")]=!1,a["tar"]=s[a0_0x5592("0x668")](x)),s["player2Node"][a0_0x5592("0x231")](x)}}[a0_0x5592("0x9dd")](t){const e=this[a0_0x5592("0x8a4")],a=t?1e3*e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")][a0_0x5592("0x5b6")]:1e3*e[a0_0x5592("0x4ca")]["speed"],i=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")];Laya[a0_0x5592("0x6ec")]["clear"](i,this["player6BulletCall"]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](a,i,this["player6BulletCall"],[t,this])}["player6BulletCall"](t,s){const n=s[a0_0x5592("0x8a4")],o=t?n[a0_0x5592("0x587")][t-1]["v2"]:n["playerV2"];if(n["gameState"]!=P[a0_0x5592("0xa5")])return;const l=t?n[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:n[a0_0x5592("0x4ca")];let e=7,_=4*l["mainNum"],h=Ct[l["id"]][l[a0_0x5592("0x612")]],x=[[16,16,20,20,-13,-13,-40],[76,76,74,74,16,16,20,20,-13,-13,-40],[127,127,126,126,76,76,74,74,16,16,20,20,-13,-13,-40],[181,181,180,180,127,127,126,126,76,76,74,74,16,16,20,20,-13,-13,-40]][l[a0_0x5592("0x612")]],c=[[0,0,1,1,0,0,1],[0,0,1,1,0,0,1,1,0,0,1],[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1],[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1]][l[a0_0x5592("0x612")]];_&&(e+=_);for(let r=0;r<e;r++){let t=null;if(!(t=c[r]?s[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x606")],s[a0_0x5592("0x11c")]):s[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x479")],s[a0_0x5592("0x8ed")])))return;let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X));let a=l[a0_0x5592("0x1fa")]*l[a0_0x5592("0x640")]["att"]/(_+1);e["setData"](Math[a0_0x5592("0x6fc")](a),l[a0_0x5592("0xae1")],l["critHurt"],l[a0_0x5592("0x33f")],l[a0_0x5592("0xa49")]);let i=t["getComponent"](Te);i||(i=t[a0_0x5592("0x2a6")](Te)),i[a0_0x5592("0x918")]=s[a0_0x5592("0xce")](0,-1),i[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],i["tar"]=null,i[a0_0x5592("0x5b6")]=l["fspeed"],i["tspeed"]=.05,i[a0_0x5592("0x3f3")]=l[a0_0x5592("0x3f3")],i[a0_0x5592("0x1f9")]=h[r],t[a0_0x5592("0x6f7")](o["x"]+h[r],o["y"]+x[r]),l["track"]&&(i[a0_0x5592("0x3f3")]=!1,i[a0_0x5592("0x2b1")]=n[a0_0x5592("0x668")](t)),n["player2Node"]["addChild"](t)}}[a0_0x5592("0x435")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];let i=D["skills"][V[a0_0x5592("0xa8c")]][a0_0x5592("0x8de")]+1;a["hp"]=Math[a0_0x5592("0x6fc")](a["hp"]*i),a[a0_0x5592("0x257")]=Math[a0_0x5592("0x6fc")](a[a0_0x5592("0x257")]*i),a[a0_0x5592("0xa5b")](V[a0_0x5592("0xa8c")]),R["event"](F[a0_0x5592("0x19c")],t)}["supSkill1"](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e["playerData"];let i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x609")]][a0_0x5592("0x8de")]+1;a["hp"]=Math[a0_0x5592("0x6fc")](a["hp"]*i),a[a0_0x5592("0x257")]=Math[a0_0x5592("0x6fc")](a["currHP"]*i),a[a0_0x5592("0x956")](V[a0_0x5592("0x609")]),R[a0_0x5592("0xcf")](F["PlayerMaxHP"],t)}[a0_0x5592("0xb2f")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];let i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x406")]]["value"]+1;a[a0_0x5592("0x1fa")]*=i,a[a0_0x5592("0x1fa")]=Math[a0_0x5592("0x6fc")](a[a0_0x5592("0x1fa")]),a[a0_0x5592("0xa5b")](V["Attack1"])}[a0_0x5592("0x4d2")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];let i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x1ae")]][a0_0x5592("0x8de")]+1;a[a0_0x5592("0x1fa")]*=i,a[a0_0x5592("0x1fa")]=Math["floor"](a[a0_0x5592("0x1fa")]),a[a0_0x5592("0x956")](V["Sup_Att"])}[a0_0x5592("0xb32")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1]["playerData"]:e[a0_0x5592("0x4ca")];let i=D["skills"][V[a0_0x5592("0xb25")]]["value"]||.1,r=Math[a0_0x5592("0x6fc")](a["hp"]*i);a[a0_0x5592("0x257")]+r>a["hp"]?a[a0_0x5592("0x257")]=a["hp"]:a[a0_0x5592("0x257")]+=r,a[a0_0x5592("0xa5b")](V[a0_0x5592("0xb25")]),R["event"](F["PlayerHP"],t)}[a0_0x5592("0x245")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e["playerData"];let i=D["skills"][V[a0_0x5592("0x60b")]][a0_0x5592("0x8de")]||.1,r=Math[a0_0x5592("0x6fc")](a["hp"]*i);a[a0_0x5592("0x257")]+r>a["hp"]?a[a0_0x5592("0x257")]=a["hp"]:a[a0_0x5592("0x257")]+=r,a["setSkill22"](V[a0_0x5592("0x60b")]),R[a0_0x5592("0xcf")](F["PlayerHP"],t)}[a0_0x5592("0x416")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];let i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x8")]][a0_0x5592("0x8de")]||.1,r=Math[a0_0x5592("0x6fc")](a["hp"]*i);a["currHP"]+r>a["hp"]?a["currHP"]=a["hp"]:a[a0_0x5592("0x257")]+=r,a[a0_0x5592("0x956")](V[a0_0x5592("0x8")]),R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ff")],t)}[a0_0x5592("0x18e")](n){n||(n=0);const o=this[a0_0x5592("0x8a4")],l=n?o[a0_0x5592("0x587")][n-1][a0_0x5592("0x4ca")]:o[a0_0x5592("0x4ca")];let t=D["skills"][V[a0_0x5592("0xb19")]][a0_0x5592("0x8de")]+1;if(l[a0_0x5592("0x5b6")]/=t,l[a0_0x5592("0xa5b")](V[a0_0x5592("0xb19")]),1!=l["id"]&&3!=l["id"]&&4!=l["id"]&&5!=l["id"]&&6!=l["id"]||this[a0_0x5592("0x434")](l["id"],n),2==l["id"]){const _=n?o[a0_0x5592("0x587")][n-1][a0_0x5592("0x7a")]:o[a0_0x5592("0x860")];let t=_["length"];const e=[[-40],[-40,-40],[10,-40,10],[10,-40,-40,10]];let i=n?o["otherPlayer"][n-1][a0_0x5592("0xa3a")]:o[a0_0x5592("0xa3d")];for(let t=0;t<_["length"];t++){_[t][a0_0x5592("0xaa4")]()}_[a0_0x5592("0xb0e")]=0;let r=Ct[2][t-1],s=e[t-1];for(let a=0;a<t;a++){const h=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x2f8")],this[a0_0x5592("0x324")]);let t=h[a0_0x5592("0x751")](X);t||(t=h["addComponent"](X));let e=l[a0_0x5592("0x1fa")]*l["planeData"][a0_0x5592("0x644")]/(l[a0_0x5592("0x612")]+1)/9;t["setData"](Math[a0_0x5592("0x6fc")](e),l["crit"],l[a0_0x5592("0x2cd")],l[a0_0x5592("0x33f")],l["bosHurtStr"]),h["getComponent"](oe)[a0_0x5592("0x1ba")]=n;const x=h["getComponent"](ne);x[a0_0x5592("0xd2")]=r[a],x[a0_0x5592("0x1f9")]=s[a],x[a0_0x5592("0x1ba")]=n,h["pos"](i["x"]+r[a],i["y"]+s[a]),o["playerNode"][a0_0x5592("0x231")](h),_[a0_0x5592("0x626")](h)}}}[a0_0x5592("0xa93")](t){t||(t=0);const e=this["ins"],a=t?e["otherPlayer"][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];let i=D["skills"][V[a0_0x5592("0xa74")]][a0_0x5592("0x8de")]+1;a[a0_0x5592("0xae1")]*=i,a[a0_0x5592("0x2cd")]*=i,a[a0_0x5592("0xa5b")](V["Crit"])}[a0_0x5592("0x79d")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e["playerData"];let i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x502")]]["value"]+1;a[a0_0x5592("0xae1")]*=i,a[a0_0x5592("0x2cd")]*=i,a[a0_0x5592("0x956")](V[a0_0x5592("0x502")])}["baseSkill6"](n){n||(n=0);const o=this[a0_0x5592("0x8a4")],l=n?o[a0_0x5592("0x587")][n-1][a0_0x5592("0x4ca")]:o[a0_0x5592("0x4ca")];if(!(l["mainNum"]>=3))switch(l[a0_0x5592("0x612")]++,l["attack"]*=1.4,l["attack"]=Math[a0_0x5592("0x6fc")](l[a0_0x5592("0x1fa")]),l[a0_0x5592("0x43")](V[a0_0x5592("0x288")]),l["id"]){case 1:break;case 2:const _=n?o[a0_0x5592("0x587")][n-1][a0_0x5592("0x7a")]:o["plaLassV2"];let t=l[a0_0x5592("0x612")];const e=[[-40],[-40,-40],[10,-40,10],[10,-40,-40,10]];if(t>=4)return;let i=n?o[a0_0x5592("0x587")][n-1][a0_0x5592("0xa3a")]:o[a0_0x5592("0xa3d")];for(let t=0;t<_["length"];t++){_[t]["removeSelf"]()}_[a0_0x5592("0xb0e")]=0;let r=Ct[2][t],s=e[t];for(let a=0;a<t+1;a++){const h=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x2f8")],this[a0_0x5592("0x324")]);let t=h[a0_0x5592("0x751")](X);t||(t=h[a0_0x5592("0x2a6")](X));let e=l[a0_0x5592("0x1fa")]*l["planeData"][a0_0x5592("0x644")]/(l[a0_0x5592("0x612")]+1)/9;t[a0_0x5592("0x971")](Math["floor"](e),l[a0_0x5592("0xae1")],l[a0_0x5592("0x2cd")],l[a0_0x5592("0x33f")],l[a0_0x5592("0xa49")]),h["getComponent"](oe)[a0_0x5592("0x1ba")]=n;const x=h[a0_0x5592("0x751")](ne);x["deltaX"]=r[a],x[a0_0x5592("0x1f9")]=s[a],x[a0_0x5592("0x1ba")]=n,h[a0_0x5592("0x6f7")](i["x"]+r[a],i["y"]+s[a]),o[a0_0x5592("0x1a9")][a0_0x5592("0x231")](h),_[a0_0x5592("0x626")](h)}}}["baseSkill7"](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e["otherPlayer"][t-1]["playerData"]:e[a0_0x5592("0x4ca")];switch(a["id"]){case 1:a[a0_0x5592("0x3f3")]=!0;break;case 2:a["laserSta"]||(a["laserSta"]=1,R[a0_0x5592("0xcf")](F[a0_0x5592("0x4a5")]));break;case 3:case 4:case 5:case 6:a[a0_0x5592("0x3f3")]=!0}a[a0_0x5592("0xa5b")](V[a0_0x5592("0x90a")])}[a0_0x5592("0xa64")](t){t||(t=0);const e=this["ins"];(t?e[a0_0x5592("0x587")][t-1]["playerData"]:e[a0_0x5592("0x4ca")])[a0_0x5592("0xa5b")](V["MainTrack"])}["shield"](i){i||(i=0);const r=this[a0_0x5592("0x8a4")],s=i?r[a0_0x5592("0x587")][i-1]["v2"]:r[a0_0x5592("0x94d")],t=i?r[a0_0x5592("0x587")][i-1][a0_0x5592("0x4ca")]:r["playerData"],n=i?r[a0_0x5592("0x587")][i-1][a0_0x5592("0x685")]:r[a0_0x5592("0x9e1")],o=[this[a0_0x5592("0xce")](1,0),this["getVec3"](-1,0)],l=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x20b")]),_=D["skills"][V[a0_0x5592("0x887")]];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3*_[a0_0x5592("0x5b6")],s,()=>{for(let t=0;t<2;t++){const e=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x20b")],l),a=e[a0_0x5592("0x751")](de);a[a0_0x5592("0x1ba")]=i,a[a0_0x5592("0x918")]=o[t]["clone"](),a[a0_0x5592("0x4ad")]=t*Math["PI"],a[a0_0x5592("0x5b6")]=_[a0_0x5592("0x214")],e["rotation"]=-180-a[a0_0x5592("0x4ad")]/Math["PI"]*180,e[a0_0x5592("0x6f7")](s["x"]+50*o[t]["x"],s["y"]+50*o[t]["y"]),r[a0_0x5592("0x1a9")][a0_0x5592("0x231")](e),n[a0_0x5592("0x626")](e)}}),t[a0_0x5592("0xa5b")](V[a0_0x5592("0x887")])}[a0_0x5592("0x7b2")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e["playerData"];if(a["skills"][V[a0_0x5592("0x109")]])return;const i=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["PlayerTimeShield"]),r=this[a0_0x5592("0x4c9")](w["battle"]["PlayerTimeShield"],i);r["getComponent"](Ee)[a0_0x5592("0x1ba")]=t;let s=t?e["otherPlayer"][t-1]["v2"]:e["playerV2"];r[a0_0x5592("0x6f7")](s["x"],s["y"]),e["playerNode"]["addChild"](r),a[a0_0x5592("0xa5b")](V[a0_0x5592("0x109")]),(t?e["otherPlayer"][t-1][a0_0x5592("0x685")]:e[a0_0x5592("0x9e1")])["push"](r)}[a0_0x5592("0x439")](t){if(t||(t=0),t)return;this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")][a0_0x5592("0xa5b")](V[a0_0x5592("0x303")])}[a0_0x5592("0x658")](t){if(t||(t=0),t)return;this["ins"]["playerData"][a0_0x5592("0xa5b")](V[a0_0x5592("0xb1a")])}[a0_0x5592("0x278")](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];D["skills"][V[a0_0x5592("0x2eb")]][a0_0x5592("0x8de")];let i=a["hp"]/a[a0_0x5592("0x257")];i>1.5&&(i=1.5),a[a0_0x5592("0x1fa")]*=i,a["attack"]=Math[a0_0x5592("0x6fc")](a[a0_0x5592("0x1fa")]),a[a0_0x5592("0xa5b")](V[a0_0x5592("0x2eb")])}[a0_0x5592("0x316")](t){if(t||(t=0),t)return;this[a0_0x5592("0x8a4")]["playerData"]["setSkill"](V[a0_0x5592("0x161")])}[a0_0x5592("0x9ba")](t){t||(t=0);const e=this["ins"],a=t?e["otherPlayer"][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")];let i=a["hp"]/a[a0_0x5592("0x257")];i>1.5&&(i=1.5),a[a0_0x5592("0xae1")]*=i,a[a0_0x5592("0x2cd")]*=i,a[a0_0x5592("0xa5b")](V[a0_0x5592("0x8a2")])}[a0_0x5592("0x3e4")](t){if(t||(t=0),t)return;this["ins"]["playerData"][a0_0x5592("0xa5b")](V[a0_0x5592("0x677")])}[a0_0x5592("0x95c")](t){if(t||(t=0),t)return;this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")][a0_0x5592("0xa5b")](V[a0_0x5592("0x2a9")])}[a0_0x5592("0xa9e")](t){t||(t=0);const s=this[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:s["playerData"],o=t?s[a0_0x5592("0x587")][t-1]["v2"]:s[a0_0x5592("0x94d")],l=[this[a0_0x5592("0xce")](0,-1),this["getVec3"](.71,-.71),this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](.71,.71),this[a0_0x5592("0xce")](0,1),this[a0_0x5592("0xce")](-.71,.71),this[a0_0x5592("0xce")](-1,0),this[a0_0x5592("0xce")](-.71,-.71)],_=D[a0_0x5592("0x53d")][V["SwimShell"]];Laya["timer"][a0_0x5592("0x861")](1e3*_[a0_0x5592("0x5b6")],o,()=>{if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x761")](b["FuYouPao"]))for(let e=0;e<8;e++){const a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerSkill1"],this[a0_0x5592("0x3eb")]);let t=a["getComponent"](X);t||(t=a["addComponent"](X));const i=D[a0_0x5592("0x53d")][V[a0_0x5592("0xa4b")]][a0_0x5592("0x8de")]||1;t["setData"](Math[a0_0x5592("0x6fc")](n[a0_0x5592("0x1fa")]*i),n["crit"],n[a0_0x5592("0x2cd")],n[a0_0x5592("0x33f")],n[a0_0x5592("0xa49")]);const r=a["getComponent"]($t);a[a0_0x5592("0x1d4")]="fyp",r[a0_0x5592("0x5b6")]=_[a0_0x5592("0x214")],r[a0_0x5592("0x918")]=l[e]["clone"](),r[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],r[a0_0x5592("0x2b1")]=null,a[a0_0x5592("0x6f7")](o["x"],o["y"]),s[a0_0x5592("0x1af")][a0_0x5592("0x231")](a),Laya["Tween"]["to"](a,{x:o["x"]+150*l[e]["x"],y:o["y"]+150*l[e]["y"]},80,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{const t=s["getMinEnemy"](a);r["tar"]=t,7==e&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{R[a0_0x5592("0xcf")](F["BulSkill1_Start"])})}))}else S[a0_0x5592("0x1eb")]([b[a0_0x5592("0xb31")]])}),n[a0_0x5592("0xa5b")](V[a0_0x5592("0xa4b")])}[a0_0x5592("0xaa5")](t){t||(t=0);const s=this[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1]["playerData"]:s[a0_0x5592("0x4ca")],o=t?s[a0_0x5592("0x587")][t-1]["v2"]:s[a0_0x5592("0x94d")],l=[this[a0_0x5592("0xce")](-.53,-.85),this[a0_0x5592("0xce")](.53,-.85),this[a0_0x5592("0xce")](-.41,-.91),this[a0_0x5592("0xce")](.41,-.91),this[a0_0x5592("0xce")](-.28,-.96),this["getVec3"](.28,-.96),this[a0_0x5592("0xce")](-.14,-.99),this[a0_0x5592("0xce")](.14,-.99),this[a0_0x5592("0xce")](0,-1)],_=[.8,.8,.9,.9,1,.9,.9,.8,.8],h=D[a0_0x5592("0x53d")][V["ShockWave"]];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*h[a0_0x5592("0x5b6")],o,()=>{if(s[a0_0x5592("0x547")]==P[a0_0x5592("0xa5")])for(let e=0;e<9;e++){const a=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0xae")],this[a0_0x5592("0x76e")]);a[a0_0x5592("0x14")]=_[e];let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X));const i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x863")]]["value"]||1;t["setData"](Math["floor"](n[a0_0x5592("0x1fa")]*i),n[a0_0x5592("0xae1")],n[a0_0x5592("0x2cd")],n["eneHurtStr"],n[a0_0x5592("0xa49")]);const r=a[a0_0x5592("0x751")](fe);r[a0_0x5592("0x5b6")]=h[a0_0x5592("0x214")],r[a0_0x5592("0x918")]=l[e]["clone"](),a[a0_0x5592("0x6f7")](o["x"]+100*l[e]["x"],o["y"]+100*l[e]["y"]),s[a0_0x5592("0x1af")][a0_0x5592("0x231")](a)}}),n["setSkill"](V[a0_0x5592("0x863")])}["skill3"](t){t||(t=0);const e=this["ins"],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")],i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerSkill3"],this[a0_0x5592("0x959")]);let r=i["getComponent"](X);r||(r=i[a0_0x5592("0x2a6")](X));const s=D[a0_0x5592("0x53d")][V[a0_0x5592("0xad5")]][a0_0x5592("0x8de")]||1;r[a0_0x5592("0x971")](a[a0_0x5592("0x1fa")]*s,a["crit"],a["critHurt"],a[a0_0x5592("0x33f")],a["bosHurtStr"]),i["getComponent"](ne)["pid"]=t;let n=t?e[a0_0x5592("0x587")][t-1]["v2"]:e["playerV2"];i[a0_0x5592("0x6f7")](n["x"],n["y"]),e[a0_0x5592("0x1a9")][a0_0x5592("0x231")](i),a[a0_0x5592("0xa5b")](V["Laser"]),(t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x685")]:e[a0_0x5592("0x9e1")])["push"](i)}[a0_0x5592("0x312")](t){t||(t=0);const s=this[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:s["playerData"],o=t?s["otherPlayer"][t-1]["v2"]:s[a0_0x5592("0x94d")],l=[this[a0_0x5592("0xce")](.1,-.99),this[a0_0x5592("0xce")](-.1,-.99),this[a0_0x5592("0xce")](.31,-.95),this[a0_0x5592("0xce")](-.31,-.95),this[a0_0x5592("0xce")](.5,-.87),this[a0_0x5592("0xce")](-.5,-.87)],_=D[a0_0x5592("0x53d")][V["Shotgun"]];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*_["speed"],o,()=>{s[a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&this[a0_0x5592("0xaf2")](200,()=>{for(let e=0;e<6;e++){const a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x850")],this[a0_0x5592("0x249")]);let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X));const i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x6b9")]][a0_0x5592("0x8de")]||1;t[a0_0x5592("0x971")](n[a0_0x5592("0x1fa")]*i,n["crit"],n[a0_0x5592("0x2cd")],n[a0_0x5592("0x33f")],n[a0_0x5592("0xa49")]);const r=a[a0_0x5592("0x751")](_e);r["speed"]=_["fspeed"],r["norV3"]=l[e]["clone"](),a[a0_0x5592("0x6f7")](o["x"],o["y"]-30),s[a0_0x5592("0x1af")][a0_0x5592("0x231")](a)}},o,3)}),n[a0_0x5592("0xa5b")](V[a0_0x5592("0x6b9")])}[a0_0x5592("0x42c")](t){t||(t=0);const n=this["ins"],o=t?n[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:n["playerData"],l=t?n[a0_0x5592("0x587")][t-1]["v2"]:n[a0_0x5592("0x94d")],_=D["skills"][V[a0_0x5592("0x943")]];Laya["timer"]["loop"](1e3*_[a0_0x5592("0x5b6")],l,()=>{if(n["gameState"]!=P["START"])return;if(!this[a0_0x5592("0x761")](b[a0_0x5592("0x760")]))return void S[a0_0x5592("0x1eb")]([b["CaiHon"]]);let t=Math[a0_0x5592("0x6fc")](2*Math[a0_0x5592("0x2ee")]()+3),r=[];r[a0_0x5592("0x626")](Math[a0_0x5592("0x6fc")](26*Math["random"]()+20)/180*Math["PI"]),r[a0_0x5592("0x626")](Math[a0_0x5592("0x6fc")](91*Math[a0_0x5592("0x2ee")]()+45)/180*Math["PI"]),4==t&&r[a0_0x5592("0x626")](Math[a0_0x5592("0x6fc")](91*Math[a0_0x5592("0x2ee")]()+45)/180*Math["PI"]),r["push"](Math["floor"](26*Math["random"]()+135)/180*Math["PI"]);let s=0;this["schedule"](500,()=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerSkill5"],this[a0_0x5592("0x2b")]);let t=e["getComponent"](X);t||(t=e[a0_0x5592("0x2a6")](X));const a=D[a0_0x5592("0x53d")][V[a0_0x5592("0x943")]][a0_0x5592("0x8de")]||1;t["setData"](o[a0_0x5592("0x1fa")]*a,o["crit"],o[a0_0x5592("0x2cd")],o[a0_0x5592("0x33f")],o[a0_0x5592("0xa49")]);const i=e[a0_0x5592("0x751")](me);e[a0_0x5592("0x6f7")](l["x"],l["y"]),i[a0_0x5592("0x5b6")]=_[a0_0x5592("0x214")],i[a0_0x5592("0x450")]=r[s],i[a0_0x5592("0x2b1")]=null,n[a0_0x5592("0x1af")][a0_0x5592("0x231")](e),Laya["timer"][a0_0x5592("0x724")](500,l,()=>{const t=n[a0_0x5592("0x668")](e);i["tar"]=t}),s++},l,t)}),o[a0_0x5592("0xa5b")](V[a0_0x5592("0x943")])}[a0_0x5592("0x349")](s){s||(s=0);const n=this[a0_0x5592("0x8a4")],o=s?n[a0_0x5592("0x587")][s-1]["playerData"]:n[a0_0x5592("0x4ca")],l=s?n[a0_0x5592("0x587")][s-1]["v2"]:n[a0_0x5592("0x94d")],_=s?n["otherPlayer"][s-1][a0_0x5592("0x685")]:n[a0_0x5592("0x9e1")],h=[this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](-1,0)],x=D[a0_0x5592("0x53d")][V["RotatePoison"]];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3*x[a0_0x5592("0x5b6")],l,()=>{for(let e=0;e<2;e++){const a=this["open"](w["battle"][a0_0x5592("0xae2")],this[a0_0x5592("0xa25")]);let t=a[a0_0x5592("0x751")](X);t||(t=a["addComponent"](X));const i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x120")]][a0_0x5592("0x8de")]||1;t[a0_0x5592("0x971")](o["attack"]*i,o[a0_0x5592("0xae1")],o[a0_0x5592("0x2cd")],o[a0_0x5592("0x33f")],o[a0_0x5592("0xa49")]);const r=a["getComponent"](ge);r["pid"]=s,r[a0_0x5592("0x5b6")]=x[a0_0x5592("0x214")],r[a0_0x5592("0x918")]=h[e][a0_0x5592("0x408")](),r[a0_0x5592("0x4ad")]=e*Math["PI"],r[a0_0x5592("0xb2e")]=B["POISON"],a["pos"](l["x"]+200*h[e]["x"],l["y"]+200*h[e]["y"]),_[a0_0x5592("0x626")](a),n[a0_0x5592("0x1a9")]["addChild"](a)}this[a0_0x5592("0x784")](s)}),o[a0_0x5592("0xa5b")](V[a0_0x5592("0x120")])}[a0_0x5592("0x9eb")](t){t||(t=0);const s=this[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1]["playerData"]:s[a0_0x5592("0x4ca")],o=t?s[a0_0x5592("0x587")][t-1]["v2"]:s[a0_0x5592("0x94d")],l=[this[a0_0x5592("0xce")](0,-1),this[a0_0x5592("0xce")](-.71,-.71),this[a0_0x5592("0xce")](.71,-.71)],_=D["skills"][V[a0_0x5592("0x26c")]];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*_[a0_0x5592("0x5b6")],o,()=>{if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x761")](b["DaoDanGui"]))for(let e=0;e<3;e++){const a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xb27")],this[a0_0x5592("0xa12")]);let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X));const i=D["skills"][V[a0_0x5592("0x26c")]][a0_0x5592("0x8de")]||1;t["setData"](n[a0_0x5592("0x1fa")]*i,n[a0_0x5592("0xae1")],n["critHurt"],n[a0_0x5592("0x33f")],n[a0_0x5592("0xa49")]);const r=a[a0_0x5592("0x751")](ve);r[a0_0x5592("0x5b6")]=_["fspeed"],r[a0_0x5592("0x918")]=l[e][a0_0x5592("0x408")](),a[a0_0x5592("0x6f7")](o["x"],o["y"]),s[a0_0x5592("0x1af")][a0_0x5592("0x231")](a),R[a0_0x5592("0xcf")](F[a0_0x5592("0x3b5")])}else S["load3D"]([b[a0_0x5592("0x131")]])}),n[a0_0x5592("0xa5b")](V[a0_0x5592("0x26c")])}[a0_0x5592("0x4c5")](s){s||(s=0);const n=this[a0_0x5592("0x8a4")],o=s?n[a0_0x5592("0x587")][s-1]["playerData"]:n["playerData"],l=s?n[a0_0x5592("0x587")][s-1]["v2"]:n["playerV2"],_=s?n["otherPlayer"][s-1]["ballsv2"]:n[a0_0x5592("0x9e1")],h=[this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](-1,0)],x=D["skills"][V[a0_0x5592("0xad2")]];Laya["timer"][a0_0x5592("0x724")](1e3*x[a0_0x5592("0x5b6")],l,()=>{for(let e=0;e<2;e++){const a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x1c0")],this[a0_0x5592("0x6ce")]);let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X));const i=D[a0_0x5592("0x53d")][V[a0_0x5592("0xad2")]][a0_0x5592("0x8de")]||1;t[a0_0x5592("0x971")](o[a0_0x5592("0x1fa")]*i,o[a0_0x5592("0xae1")],o[a0_0x5592("0x2cd")],o[a0_0x5592("0x33f")],o[a0_0x5592("0xa49")]);const r=a[a0_0x5592("0x751")](ge);r[a0_0x5592("0x1ba")]=s,r[a0_0x5592("0x5b6")]=x[a0_0x5592("0x214")],r[a0_0x5592("0x918")]=h[e][a0_0x5592("0x408")](),r["angle"]=e*Math["PI"],r[a0_0x5592("0xb2e")]=B[a0_0x5592("0xdb")],a["pos"](l["x"]+200*h[e]["x"],l["y"]+200*h[e]["y"]),_[a0_0x5592("0x626")](a),n[a0_0x5592("0x1a9")][a0_0x5592("0x231")](a)}this["initPlaBall"](s)}),o["setSkill"](V[a0_0x5592("0xad2")])}["skill9"](t){t||(t=0);const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:e[a0_0x5592("0x4ca")],i=t?e[a0_0x5592("0x587")][t-1]["v2"]:e["playerV2"],r=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x252")],this["skill9Pre"]);let s=r[a0_0x5592("0x751")](X);s||(s=r["addComponent"](X));const n=D["skills"][V[a0_0x5592("0x714")]]["value"]||1;s[a0_0x5592("0x971")](a[a0_0x5592("0x1fa")]*n,a["crit"],a["critHurt"],a[a0_0x5592("0x33f")],a["bosHurtStr"]),r[a0_0x5592("0x751")](ye)[a0_0x5592("0x1ba")]=t,r[a0_0x5592("0x6f7")](i["x"],i["y"]),e[a0_0x5592("0x23a")]["addChild"](r),a[a0_0x5592("0xa5b")](V[a0_0x5592("0x714")]),(t?e[a0_0x5592("0x587")][t-1][a0_0x5592("0x685")]:e["plaBallsV2"])[a0_0x5592("0x626")](r)}["skill10"](s){s||(s=0);const n=this["ins"],o=s?n[a0_0x5592("0x587")][s-1][a0_0x5592("0x4ca")]:n[a0_0x5592("0x4ca")],l=s?n[a0_0x5592("0x587")][s-1]["v2"]:n["playerV2"],_=s?n[a0_0x5592("0x587")][s-1][a0_0x5592("0x685")]:n[a0_0x5592("0x9e1")],h=[this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](-1,0)],x=D[a0_0x5592("0x53d")][V[a0_0x5592("0x907")]];Laya[a0_0x5592("0x6ec")]["once"](1e3*x[a0_0x5592("0x5b6")],l,()=>{for(let e=0;e<2;e++){const a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x73")],this[a0_0x5592("0x552")]);let t=a[a0_0x5592("0x751")](X);t||(t=a[a0_0x5592("0x2a6")](X));const i=D[a0_0x5592("0x53d")][V[a0_0x5592("0x907")]][a0_0x5592("0x8de")]||1;t[a0_0x5592("0x971")](o["attack"]*i,o[a0_0x5592("0xae1")],o[a0_0x5592("0x2cd")],o[a0_0x5592("0x33f")],o["bosHurtStr"]);const r=a[a0_0x5592("0x751")](ge);r["pid"]=s,r["speed"]=x["fspeed"],r[a0_0x5592("0x918")]=h[e][a0_0x5592("0x408")](),r["angle"]=e*Math["PI"],r[a0_0x5592("0xb2e")]=B["ICE"],a["pos"](l["x"]+200*h[e]["x"],l["y"]+200*h[e]["y"]),_[a0_0x5592("0x626")](a),n[a0_0x5592("0x1a9")][a0_0x5592("0x231")](a)}this[a0_0x5592("0x784")](s)}),o[a0_0x5592("0xa5b")](V[a0_0x5592("0x907")])}[a0_0x5592("0x784")](t){const e=this[a0_0x5592("0x8a4")],a=t?e[a0_0x5592("0x587")][t-1]["v2"]:e[a0_0x5592("0x94d")],i=t?e["otherPlayer"][t-1]["ballsv2"]:e[a0_0x5592("0x9e1")],r={2:[0,Math["PI"]],4:[0,Math["PI"],Math["PI"]/2,Math["PI"]/2*3],6:[0,Math["PI"],Math["PI"]/3,Math["PI"]/3*4,Math["PI"]/3*2,Math["PI"]/3*5]}[i["length"]];if(r)for(let t=0;t<i[a0_0x5592("0xb0e")];t++){const s=i[t],n=s[a0_0x5592("0x751")](ge);n[a0_0x5592("0x4ad")]=r[t],s[a0_0x5592("0x3b0")]=-180-n[a0_0x5592("0x4ad")]/Math["PI"]*180,s["x"]=a["x"]+200*Math[a0_0x5592("0x2d9")](n["angle"]),s["y"]=a["y"]-200*Math[a0_0x5592("0x2d2")](n["angle"])}}["skill2012"](t){t||(t=0);const s=this[a0_0x5592("0x8a4")],n=t?s[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:s["playerData"],o=t?s[a0_0x5592("0x587")][t-1]["v2"]:s["playerV2"],l=[150,120,90,60,30],_=(this[a0_0x5592("0xce")](-.71,-.71),this["getVec3"](-.34,-.94),this["getVec3"](0,-1),this[a0_0x5592("0xce")](.34,-.94),this["getVec3"](.71,-.71),D["skills"][V[a0_0x5592("0x380")]]);Laya[a0_0x5592("0x6ec")]["loop"](1e3*_[a0_0x5592("0x5b6")],o,()=>{if(s[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x761")](b["YanHua"]))for(let a=0;a<l["length"];a++){const i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x966")],this["skill2012Pre"]);let t=i[a0_0x5592("0x751")](X);t||(t=i["addComponent"](X));const r=D["skills"][V[a0_0x5592("0x380")]]["value"]||1;t[a0_0x5592("0x971")](n["attack"]*r,n["crit"],n[a0_0x5592("0x2cd")],n[a0_0x5592("0x33f")],n[a0_0x5592("0xa49")]);let e=i[a0_0x5592("0x751")](pe);e[a0_0x5592("0x5b6")]=_[a0_0x5592("0x214")],e["pangle"]=l[a]/180*Math["PI"],e[a0_0x5592("0x2b1")]=null,i[a0_0x5592("0x6f7")](o["x"],o["y"]),s[a0_0x5592("0x1af")]["addChild"](i),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,o,()=>{const t=s["getMinEnemy"](i);e[a0_0x5592("0x2b1")]=t})}else S["load3D"]([b[a0_0x5592("0xb02")]])}),n[a0_0x5592("0xa5b")](V[a0_0x5592("0x380")])}["skill2002"](t){t||(t=0);const l=this[a0_0x5592("0x8a4")],_=t?l[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:l[a0_0x5592("0x4ca")],h=t?l[a0_0x5592("0x587")][t-1]["v2"]:l["playerV2"],x=D[a0_0x5592("0x53d")][V[a0_0x5592("0x929")]];Laya["timer"][a0_0x5592("0x861")](1e3*x[a0_0x5592("0x5b6")],h,()=>{if(l[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(!this[a0_0x5592("0x761")](b["DaoDanFu"]))return void S[a0_0x5592("0x1eb")]([b[a0_0x5592("0x15e")]]);const o={};for(let t=0;t<2;t++){let n=t?1:-1,a=0;const i=[60,45,30];for(let e=0;e<3;e++){let r=i[e],t=Math[a0_0x5592("0xc0")](r/180*Math["PI"]),s=new Laya["Vector3"](0,0,0);Laya[a0_0x5592("0x97c")]["normalize"](new Laya[a0_0x5592("0x97c")](1,t,0),s),s["x"]*=n,a+=Math[a0_0x5592("0x6fc")](251*Math["random"]()+50),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1,this,()=>{const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x116")],this[a0_0x5592("0x8a9")]);let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X));const a=x["value"]||1;e[a0_0x5592("0x971")](_[a0_0x5592("0x1fa")]*a,_[a0_0x5592("0xae1")],_["critHurt"],_[a0_0x5592("0x33f")],_[a0_0x5592("0xa49")]);const i=t[a0_0x5592("0x751")](ue);i[a0_0x5592("0x24e")]=b[a0_0x5592("0x15e")],i["speed"]=x[a0_0x5592("0x214")],i["norV3"]=s,i[a0_0x5592("0x4ad")]=n>0?-r:-(r+90),i["xv"]=n,i["tar"]=l[a0_0x5592("0x9a8")](h,o),t[a0_0x5592("0x6f7")](h["x"],h["y"]),l[a0_0x5592("0x1af")][a0_0x5592("0x231")](t)})}}}),_[a0_0x5592("0xa5b")](V[a0_0x5592("0x929")])}[a0_0x5592("0x6")](t){t||(t=0);const r=this[a0_0x5592("0x8a4")],s=t?r[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:r["playerData"],n=t?r[a0_0x5592("0x587")][t-1]["v2"]:r[a0_0x5592("0x94d")],o=[this[a0_0x5592("0xce")](-.87,-.5),this[a0_0x5592("0xce")](-.77,-.64),this[a0_0x5592("0xce")](-.64,-.77),this["getVec3"](-.5,-.87),this[a0_0x5592("0xce")](-.34,-.94),this[a0_0x5592("0xce")](-.17,-.98),this[a0_0x5592("0xce")](0,-1),this[a0_0x5592("0xce")](.17,-.98),this["getVec3"](.34,-.94),this[a0_0x5592("0xce")](.5,-.87),this[a0_0x5592("0xce")](.64,-.77),this[a0_0x5592("0xce")](.77,-.64),this["getVec3"](.87,-.5)],l=D[a0_0x5592("0x53d")][V[a0_0x5592("0x6ba")]];let _=0,h=!0;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*l["speed"],n,()=>{if(r[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;_<=0&&!h&&(h=!0),_>=o["length"]-1&&h&&(h=!1);const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x12")],this[a0_0x5592("0x128")]);let e=t[a0_0x5592("0x751")](X);e||(e=t[a0_0x5592("0x2a6")](X));const a=l[a0_0x5592("0x8de")]||1;e[a0_0x5592("0x971")](s[a0_0x5592("0x1fa")]*a,s[a0_0x5592("0xae1")],s[a0_0x5592("0x2cd")],s[a0_0x5592("0x33f")],s[a0_0x5592("0xa49")]);const i=t["getComponent"]($t);i[a0_0x5592("0x5b6")]=l[a0_0x5592("0x214")],i[a0_0x5592("0x918")]=o[_][a0_0x5592("0x408")](),i[a0_0x5592("0x3f3")]=!1,i["tar"]=null,i["state"]=P[a0_0x5592("0xa5")],i[a0_0x5592("0x58a")]=1.3,t[a0_0x5592("0x6f7")](n["x"]+150*o[_]["x"],n["y"]+150*o[_]["y"]),r[a0_0x5592("0x1af")]["addChild"](t),h?_++:_--}),s["setSkill"](V["Brid"])}["wing1"](e){e||(e=0);const a=this[a0_0x5592("0x8a4")],t=e?a["otherPlayer"][e-1][a0_0x5592("0x4ca")]:a[a0_0x5592("0x4ca")],i=e?a[a0_0x5592("0x587")][e-1]["v2"]:a[a0_0x5592("0x94d")],r=e?a[a0_0x5592("0x587")][e-1][a0_0x5592("0x7c1")]:a[a0_0x5592("0xa9c")];let s=r[a0_0x5592("0xb0e")];if(s>=4)return;let n=i,o=Rt[s/2];for(let t=0;t<2;t++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x38c")],this[a0_0x5592("0x79b")]),_=l[a0_0x5592("0x751")](be);l[a0_0x5592("0x751")](Ce)["pid"]=e,_[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0xd2")]=o[t]["dx"],_["deltaY"]=o[t]["dy"],l[a0_0x5592("0x6f7")](n["x"]+o[t]["dx"],n["y"]+o[t]["dy"]+1e3),r["push"](l),a[a0_0x5592("0x23a")][a0_0x5592("0x231")](l)}t["setSkill"](V[a0_0x5592("0x740")])}[a0_0x5592("0x2db")](e){e||(e=0);const a=this[a0_0x5592("0x8a4")],t=e?a["otherPlayer"][e-1][a0_0x5592("0x4ca")]:a[a0_0x5592("0x4ca")],i=e?a["otherPlayer"][e-1]["v2"]:a["playerV2"],r=e?a[a0_0x5592("0x587")][e-1]["wingsv2"]:a[a0_0x5592("0xa9c")];let s=r[a0_0x5592("0xb0e")];if(s>=4)return;let n=i,o=Rt[s/2];for(let t=0;t<2;t++){const l=this["open"](w["battle"][a0_0x5592("0x60")],this[a0_0x5592("0x593")]),_=l[a0_0x5592("0x751")](be),h=l[a0_0x5592("0x751")](Re);h["pid"]=e,_[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0xd2")]=o[t]["dx"],_[a0_0x5592("0x1f9")]=o[t]["dy"],h["xv"]=o[t]["v"],l["pos"](n["x"]+o[t]["dx"],n["y"]+o[t]["dy"]+1e3),r[a0_0x5592("0x626")](l),a[a0_0x5592("0x23a")][a0_0x5592("0x231")](l)}t[a0_0x5592("0xa5b")](V["MissileWing"])}[a0_0x5592("0x67c")](e){e||(e=0);const a=this[a0_0x5592("0x8a4")],t=e?a[a0_0x5592("0x587")][e-1][a0_0x5592("0x4ca")]:a[a0_0x5592("0x4ca")],i=e?a[a0_0x5592("0x587")][e-1]["v2"]:a[a0_0x5592("0x94d")],r=e?a["otherPlayer"][e-1][a0_0x5592("0x7c1")]:a["plaWingsV2"];let s=r["length"];if(s>=6)return;let n=i,o=Rt[s/2];for(let t=0;t<2;t++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x5e1")],this[a0_0x5592("0x30c")]),_=l[a0_0x5592("0x751")](be),h=l["getComponent"](Ie);h[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0xd2")]=o[t]["dx"],_["deltaY"]=o[t]["dy"],h["xv"]=o[t]["v"],l[a0_0x5592("0x6f7")](n["x"]+o[t]["dx"],n["y"]+o[t]["dy"]+1e3),r[a0_0x5592("0x626")](l),a[a0_0x5592("0x23a")][a0_0x5592("0x231")](l)}t[a0_0x5592("0xa5b")](V[a0_0x5592("0x296")])}[a0_0x5592("0x138")](e){e||(e=0);const a=this[a0_0x5592("0x8a4")],t=e?a[a0_0x5592("0x587")][e-1][a0_0x5592("0x4ca")]:a[a0_0x5592("0x4ca")],i=e?a["otherPlayer"][e-1]["v2"]:a[a0_0x5592("0x94d")],r=e?a[a0_0x5592("0x587")][e-1]["wingsv2"]:a["plaWingsV2"];let s=r[a0_0x5592("0xb0e")];if(s>=4)return;let n=i,o=Rt[s/2];for(let t=0;t<2;t++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x822")],this["plaWing4Pre"]),_=l[a0_0x5592("0x751")](be);l[a0_0x5592("0x751")](Me)[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0x1ba")]=e,_["deltaX"]=o[t]["dx"],_[a0_0x5592("0x1f9")]=o[t]["dy"],l["pos"](n["x"]+o[t]["dx"],n["y"]+o[t]["dy"]+1e3),r["push"](l),a[a0_0x5592("0x23a")]["addChild"](l)}t[a0_0x5592("0xa5b")](V[a0_0x5592("0x894")])}["wing5"](e){e||(e=0);const a=this[a0_0x5592("0x8a4")],t=e?a[a0_0x5592("0x587")][e-1][a0_0x5592("0x4ca")]:a["playerData"],i=e?a["otherPlayer"][e-1]["v2"]:a[a0_0x5592("0x94d")],r=e?a[a0_0x5592("0x587")][e-1][a0_0x5592("0x7c1")]:a[a0_0x5592("0xa9c")];let s=r[a0_0x5592("0xb0e")];if(s>=4)return;let n=i,o=Rt[s/2];for(let t=0;t<2;t++){const l=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x342")],this[a0_0x5592("0x43e")]),_=l[a0_0x5592("0x751")](be),h=l[a0_0x5592("0x751")](De);h[a0_0x5592("0x1ba")]=e,_["pid"]=e,_[a0_0x5592("0xd2")]=o[t]["dx"],_[a0_0x5592("0x1f9")]=o[t]["dy"],h["xv"]=o[t]["v"],l["pos"](n["x"]+o[t]["dx"],n["y"]+o[t]["dy"]+1e3),r["push"](l),a[a0_0x5592("0x23a")][a0_0x5592("0x231")](l)}t[a0_0x5592("0xa5b")](V[a0_0x5592("0x842")])}[a0_0x5592("0x3e6")](e){e||(e=0);const a=this[a0_0x5592("0x8a4")],t=e?a[a0_0x5592("0x587")][e-1]["playerData"]:a[a0_0x5592("0x4ca")],i=e?a[a0_0x5592("0x587")][e-1]["v2"]:a[a0_0x5592("0x94d")],r=e?a["otherPlayer"][e-1][a0_0x5592("0x7c1")]:a[a0_0x5592("0xa9c")];let s=r["length"];if(s>=4)return;let n=i,o=Rt[s/2];for(let t=0;t<2;t++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x363")],this[a0_0x5592("0x3a9")]),_=l[a0_0x5592("0x751")](be);l[a0_0x5592("0x751")](we)[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0x1ba")]=e,_[a0_0x5592("0xd2")]=o[t]["dx"],_[a0_0x5592("0x1f9")]=o[t]["dy"],l["pos"](n["x"]+o[t]["dx"],n["y"]+o[t]["dy"]+1e3),r[a0_0x5592("0x626")](l),a[a0_0x5592("0x23a")][a0_0x5592("0x231")](l)}t[a0_0x5592("0xa5b")](V[a0_0x5592("0x8e")])}[a0_0x5592("0x8eb")](a){a||(a=0);const i=this[a0_0x5592("0x8a4")],t=a?i[a0_0x5592("0x587")][a-1][a0_0x5592("0x4ca")]:i["playerData"],r=a?i[a0_0x5592("0x587")][a-1]["v2"]:i[a0_0x5592("0x94d")],e=D[a0_0x5592("0x53d")][V["BlastRobot"]],s=e[a0_0x5592("0x5b6")]||5,n=e["robotsp"]||.2;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*s,r,()=>{if(i["gameState"]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerRobot1"],this[a0_0x5592("0x642")]),e=t[a0_0x5592("0x751")](le);t["getComponent"](he)[a0_0x5592("0x1ba")]=a,e[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1),e[a0_0x5592("0x5b6")]=n,t[a0_0x5592("0x6f7")](r["x"],r["y"]-100),i["bgTopNode"][a0_0x5592("0x231")](t)}),t[a0_0x5592("0xa5b")](V[a0_0x5592("0x46d")])}[a0_0x5592("0x28d")](a){a||(a=0);const i=this["ins"],t=a?i[a0_0x5592("0x587")][a-1][a0_0x5592("0x4ca")]:i[a0_0x5592("0x4ca")],r=a?i["otherPlayer"][a-1]["v2"]:i["playerV2"],e=D["skills"][V[a0_0x5592("0x431")]],s=e[a0_0x5592("0x5b6")]||5,n=e[a0_0x5592("0x5e0")]||.2;Laya["timer"][a0_0x5592("0x861")](1e3*s,r,()=>{if(i[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0xada")],this[a0_0x5592("0x32e")]),e=t[a0_0x5592("0x751")](le);t[a0_0x5592("0x751")](ce)[a0_0x5592("0x1ba")]=a,e["norV3"]=this[a0_0x5592("0xce")](0,-1),e[a0_0x5592("0x5b6")]=n,t["pos"](r["x"],r["y"]-100),i[a0_0x5592("0x23a")][a0_0x5592("0x231")](t)}),t[a0_0x5592("0xa5b")](V[a0_0x5592("0x431")])}[a0_0x5592("0xb1c")](t){t||(t=0);const r=this[a0_0x5592("0x8a4")],s=t?r[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")]:r[a0_0x5592("0x4ca")],n=t?r["otherPlayer"][t-1]["v2"]:r[a0_0x5592("0x94d")],o=D[a0_0x5592("0x53d")][V[a0_0x5592("0x7f0")]],e=o[a0_0x5592("0x5b6")]||5,l=o[a0_0x5592("0x5e0")]||.2;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e,n,()=>{if(r[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerRobot3"],this[a0_0x5592("0x8c3")]);let e=t[a0_0x5592("0x751")](X);e||(e=t["addComponent"](X));const a=o["value"]||1;e[a0_0x5592("0x971")](s[a0_0x5592("0x1fa")]*a,s[a0_0x5592("0xae1")],s[a0_0x5592("0x2cd")],s[a0_0x5592("0x33f")],s[a0_0x5592("0xa49")]);const i=t[a0_0x5592("0x751")](le);i[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1),i[a0_0x5592("0x5b6")]=l,t[a0_0x5592("0x6f7")](n["x"],n["y"]-100),r[a0_0x5592("0x23a")][a0_0x5592("0x231")](t)}),s[a0_0x5592("0xa5b")](V[a0_0x5592("0x7f0")])}}var Oe=a0_0x5592("0x1be"),Ne='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n#include "Shadow.glsl"\r\n\r\nuniform sampler2D u_NoiseTex;\r\nuniform float u_Time;\r\nuniform vec4 u_DiffuseColor;\r\n\r\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n\tuniform float u_AlphaTestValue;\r\n#endif\r\n\r\n#ifdef DIFFUSEMAP\r\n\tuniform sampler2D u_DiffuseTexture;\r\n#endif\r\n\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tvarying vec2 v_LightMapUV;\r\n\tuniform sampler2D u_LightMap;\r\n#endif\r\n\r\nvarying vec3 v_Normal;\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tvarying vec3 v_ViewDir; \r\n\r\n\tuniform vec3 u_MaterialSpecular;\r\n\tuniform float u_Shininess;\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tuniform DirectionLight u_DirectionLight;\r\n\t\t#endif\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tuniform PointLight u_PointLight;\r\n\t\t#endif\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tuniform SpotLight u_SpotLight;\r\n\t\t#endif\r\n\t#else\r\n\t\tuniform mat4 u_View;\r\n\t\tuniform vec4 u_ProjectionParams;\r\n\t\tuniform vec4 u_Viewport;\r\n\t\tuniform int u_DirationLightCount;\r\n\t\tuniform sampler2D u_LightBuffer;\r\n\t\tuniform sampler2D u_LightClusterBuffer;\r\n\t#endif\r\n\r\n\t#ifdef SPECULARMAP \r\n\t\tuniform sampler2D u_SpecularTexture;\r\n\t#endif\r\n#endif\r\n\r\n#ifdef NORMALMAP \r\n\tuniform sampler2D u_NormalTexture;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\tuniform vec3 u_FogColor;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n\r\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec3 normal;//light and SH maybe use normal\r\n\t#if defined(NORMALMAP)\r\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\r\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\r\n\t#else\r\n\t\tnormal = normalize(v_Normal);\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 viewDir= normalize(v_ViewDir);\r\n\t#endif\r\n\r\n\tLayaGIInput giInput;\r\n\t#ifdef LIGHTMAP\t\r\n\t\tgiInput.lightmapUV=v_LightMapUV;\r\n\t#endif\r\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\r\n\t\r\n\tvec4 mainColor=u_DiffuseColor;\r\n\t#ifdef DIFFUSEMAP\r\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\r\n\t\tmainColor=mainColor*difTexColor;\r\n\t#endif \r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tmainColor=mainColor*v_Color;\r\n\t#endif \r\n    \r\n\t#ifdef ALPHATEST\r\n\t\tif(mainColor.a<u_AlphaTestValue)\r\n\t\t\tdiscard;\r\n\t#endif\r\n  \r\n\t\r\n\tvec3 diffuse = vec3(0.0);\r\n\tvec3 specular= vec3(0.0);\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 dif,spe;\r\n\t\t#ifdef SPECULARMAP\r\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\r\n\t\t#else\r\n\t\t\t#ifdef DIFFUSEMAP\r\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\r\n\t\t\t#else\r\n\t\t\t\tvec3 gloss=vec3(1.0);\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t\r\n\t\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t#else\r\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t#endif\r\n\t\t\t\tfloat shadowAttenuation=sampleShadowmap(shadowCoord);\r\n\t\t\t\tdif *= shadowAttenuation;\r\n\t\t\t\tspe *= shadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\tfloat spotShadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\tdif *= spotShadowAttenuation;\r\n\t\t\t\tspe *= spotShadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t{\r\n\t\t\t\tif(i >= u_DirationLightCount)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\r\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t\t\t#endif\r\n\t\t\t\t\t\tdirectionLight.color *= sampleShadowmap(shadowCoord);\r\n\t\t\t\t\t}\r\n\t\t\t\t#endif\r\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,dif,spe);\r\n\t\t\t\tdiffuse+=dif;\r\n\t\t\t\tspecular+=spe;\r\n\t\t\t}\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\r\n\t\t\t#ifdef POINTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\t#ifdef SPOTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\t\t\t\tspotLight.color *= sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t#endif\r\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tgl_FragColor.rgb+=specular;\r\n\t#endif\r\n\t  \r\n\t#ifdef FOG\r\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\r\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\r\n\t#endif\r\n\r\n\tvec3 nor = texture2D(u_NoiseTex, vec2(v_Texcoord0.x - u_Time * 0.5, v_Texcoord0.y)).rgb;\r\n\tvec4 fra = gl_FragColor;\r\n\tgl_FragColor = vec4(nor.r + fra.r * 0.8, nor.g + fra.g * 0.8, nor.b + fra.b * 0.8, gl_FragColor.a);\r\n}\r\n\r\n';const o=Laya[a0_0x5592("0xa03")],Be=Laya[a0_0x5592("0xb5")],Fe=Laya[a0_0x5592("0x2a8")];class j extends Be{constructor(){super(),this[a0_0x5592("0x755")]=o[a0_0x5592("0x364")](a0_0x5592("0x309")),this[a0_0x5592("0x571")]=!1,this[a0_0x5592("0x1ea")](a0_0x5592("0x25")),this[a0_0x5592("0x4ff")]=1,this[a0_0x5592("0xb3a")]=new Laya[a0_0x5592("0x2a5")](1,1,1,1);var t=this[a0_0x5592("0x7b4")];t[a0_0x5592("0x1f2")](j[a0_0x5592("0xb0f")],new Laya[a0_0x5592("0x2a5")](1,1,1,1)),t[a0_0x5592("0x1f2")](j[a0_0x5592("0x3a7")],new Laya["Vector4"](1,1,1,1)),t[a0_0x5592("0x11f")](j[a0_0x5592("0x797")],.078125),t["setNumber"](Be["ALPHATESTVALUE"],.5),t["setVector"](j["TILINGOFFSET"],new Laya[a0_0x5592("0x2a5")](1,1,0,0)),this[a0_0x5592("0x285")]=!0,this["renderMode"]=j[a0_0x5592("0x3d6")]}static[a0_0x5592("0x36f")](){j[a0_0x5592("0x40d")]=o["getDefineByName"]("DIFFUSEMAP"),j["SHADERDEFINE_NORMALMAP"]=o["getDefineByName"](a0_0x5592("0x8f5")),j[a0_0x5592("0x616")]=o[a0_0x5592("0x688")](a0_0x5592("0x1d3")),j[a0_0x5592("0x5a3")]=o[a0_0x5592("0x688")](a0_0x5592("0x6dc")),j[a0_0x5592("0x55a")]=o[a0_0x5592("0x688")](a0_0x5592("0x9d4"))}get["_ColorR"](){return this[a0_0x5592("0xb3a")]["x"]}set[a0_0x5592("0x31c")](t){this[a0_0x5592("0xb3a")]["x"]=t,this[a0_0x5592("0xcb")]=this[a0_0x5592("0xb3a")]}get[a0_0x5592("0x34b")](){return this[a0_0x5592("0xb3a")]["y"]}set["_ColorG"](t){this[a0_0x5592("0xb3a")]["y"]=t,this[a0_0x5592("0xcb")]=this[a0_0x5592("0xb3a")]}get[a0_0x5592("0x3a")](){return this["_albedoColor"]["z"]}set[a0_0x5592("0x3a")](t){this[a0_0x5592("0xb3a")]["z"]=t,this[a0_0x5592("0xcb")]=this[a0_0x5592("0xb3a")]}get[a0_0x5592("0x1ed")](){return this[a0_0x5592("0xb3a")]["w"]}set[a0_0x5592("0x1ed")](t){this["_albedoColor"]["w"]=t,this[a0_0x5592("0xcb")]=this[a0_0x5592("0xb3a")]}get[a0_0x5592("0x37f")](){return this["_shaderValues"]["getVector"](j[a0_0x5592("0xb0f")])}set[a0_0x5592("0x37f")](t){this[a0_0x5592("0xcb")]=t}get[a0_0x5592("0x7f1")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])["x"]}set[a0_0x5592("0x7f1")](t){this["_shaderValues"][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])["x"]=t}get[a0_0x5592("0x2ce")](){return this["_shaderValues"][a0_0x5592("0x417")](j["MATERIALSPECULAR"])["y"]}set[a0_0x5592("0x2ce")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])["y"]=t}get[a0_0x5592("0x9a3")](){return this["_shaderValues"][a0_0x5592("0x417")](j["MATERIALSPECULAR"])["z"]}set["_SpecColorB"](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])["z"]=t}get[a0_0x5592("0x988")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])["w"]}set["_SpecColorA"](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])["w"]=t}get[a0_0x5592("0x5a4")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x3a7")])}set[a0_0x5592("0x5a4")](t){this[a0_0x5592("0x1e")]=t}get[a0_0x5592("0x11e")](){return this[a0_0x5592("0x4ff")]}set[a0_0x5592("0x11e")](t){if(this["_albedoIntensity"]!==t){var e=this[a0_0x5592("0x7b4")]["getVector"](j["ALBEDOCOLOR"]);Laya[a0_0x5592("0x2a5")]["scale"](this[a0_0x5592("0xb3a")],t,e),this[a0_0x5592("0x4ff")]=t,this[a0_0x5592("0x7b4")][a0_0x5592("0x1f2")](j[a0_0x5592("0xb0f")],e)}}get["_Shininess"](){return this[a0_0x5592("0x7b4")]["getNumber"](j["SHININESS"])}set[a0_0x5592("0xa30")](t){t=Math["max"](0,Math[a0_0x5592("0x6bf")](1,t)),this[a0_0x5592("0x7b4")][a0_0x5592("0x11f")](j[a0_0x5592("0x797")],t)}get[a0_0x5592("0xa85")](){return this[a0_0x5592("0x7b4")]["getVector"](j[a0_0x5592("0x6dc")])["x"]}set[a0_0x5592("0xa85")](t){var e=this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")]);e["x"]=t,this[a0_0x5592("0x15f")]=e}get[a0_0x5592("0x973")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")])["y"]}set[a0_0x5592("0x973")](t){var e=this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")]);e["y"]=t,this[a0_0x5592("0x15f")]=e}get[a0_0x5592("0x49f")](){return this[a0_0x5592("0x7b4")]["getVector"](j[a0_0x5592("0x6dc")])["z"]}set[a0_0x5592("0x49f")](t){var e=this["_shaderValues"][a0_0x5592("0x417")](j["TILINGOFFSET"]);e["z"]=t,this["tilingOffset"]=e}get[a0_0x5592("0x1e1")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")])["w"]}set[a0_0x5592("0x1e1")](t){var e=this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")]);e["w"]=t,this[a0_0x5592("0x15f")]=e}get[a0_0x5592("0x796")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")])}set[a0_0x5592("0x796")](t){this[a0_0x5592("0x15f")]=t}get[a0_0x5592("0x19d")](){return this[a0_0x5592("0x30a")]}set[a0_0x5592("0x19d")](t){this[a0_0x5592("0x30a")]=t}set[a0_0x5592("0xa54")](t){switch(t){case j[a0_0x5592("0x3d6")]:this[a0_0x5592("0x362")]=!1,this[a0_0x5592("0x89b")]=Be["RENDERQUEUE_OPAQUE"],this[a0_0x5592("0x8cf")]=!0,this[a0_0x5592("0x3e")]=Fe[a0_0x5592("0x84b")],this[a0_0x5592("0x1ad")]=Fe[a0_0x5592("0xa71")],this[a0_0x5592("0x2fe")]=Fe[a0_0x5592("0x8d3")];break;case j["RENDERMODE_CUTOUT"]:this[a0_0x5592("0x89b")]=Be["RENDERQUEUE_ALPHATEST"],this[a0_0x5592("0x362")]=!0,this[a0_0x5592("0x8cf")]=!0,this[a0_0x5592("0x3e")]=Fe[a0_0x5592("0x84b")],this["blend"]=Fe[a0_0x5592("0xa71")],this[a0_0x5592("0x2fe")]=Fe[a0_0x5592("0x8d3")];break;case j[a0_0x5592("0x35")]:this["renderQueue"]=Be["RENDERQUEUE_TRANSPARENT"],this["alphaTest"]=!1,this[a0_0x5592("0x8cf")]=!1,this["cull"]=Fe[a0_0x5592("0x84b")],this[a0_0x5592("0x1ad")]=Fe[a0_0x5592("0x4b6")],this[a0_0x5592("0x3c7")]=Fe[a0_0x5592("0x45")],this["blendDst"]=Fe["BLENDPARAM_ONE_MINUS_SRC_ALPHA"],this[a0_0x5592("0x2fe")]=Fe[a0_0x5592("0x8d3")];break;default:throw new Error(a0_0x5592("0x196"))}}get[a0_0x5592("0x1b4")](){return this[a0_0x5592("0x571")]}set["enableVertexColor"](t){this[a0_0x5592("0x571")]=t,t?this[a0_0x5592("0x7b4")][a0_0x5592("0x4c7")](j["SHADERDEFINE_ENABLEVERTEXCOLOR"]):this[a0_0x5592("0x7b4")]["removeDefine"](j["SHADERDEFINE_ENABLEVERTEXCOLOR"])}get["tilingOffsetX"](){return this[a0_0x5592("0xa85")]}set["tilingOffsetX"](t){this[a0_0x5592("0xa85")]=t}get[a0_0x5592("0x2c5")](){return this[a0_0x5592("0x973")]}set[a0_0x5592("0x2c5")](t){this[a0_0x5592("0x973")]=t}get[a0_0x5592("0x57e")](){return this[a0_0x5592("0x49f")]}set[a0_0x5592("0x57e")](t){this[a0_0x5592("0x49f")]=t}get["tilingOffsetW"](){return this["_MainTex_STW"]}set["tilingOffsetW"](t){this["_MainTex_STW"]=t}get["tilingOffset"](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j[a0_0x5592("0x6dc")])}set[a0_0x5592("0x15f")](t){t&&(1!=t["x"]||1!=t["y"]||0!=t["z"]||0!=t["w"])?this[a0_0x5592("0x7b4")][a0_0x5592("0x4c7")](j[a0_0x5592("0x5a3")]):this[a0_0x5592("0x7b4")]["removeDefine"](j[a0_0x5592("0x5a3")]),this[a0_0x5592("0x7b4")][a0_0x5592("0x1f2")](j["TILINGOFFSET"],t)}get[a0_0x5592("0x9d9")](){return this["_ColorR"]}set[a0_0x5592("0x9d9")](t){this["_ColorR"]=t}get[a0_0x5592("0xb16")](){return this[a0_0x5592("0x34b")]}set["albedoColorG"](t){this[a0_0x5592("0x34b")]=t}get[a0_0x5592("0xa34")](){return this[a0_0x5592("0x3a")]}set["albedoColorB"](t){this[a0_0x5592("0x3a")]=t}get["albedoColorA"](){return this[a0_0x5592("0x1ed")]}set["albedoColorA"](t){this["_ColorA"]=t}get[a0_0x5592("0xcb")](){return this[a0_0x5592("0xb3a")]}set["albedoColor"](t){var e=this[a0_0x5592("0x7b4")]["getVector"](j[a0_0x5592("0xb0f")]);Laya["Vector4"][a0_0x5592("0xa20")](t,this[a0_0x5592("0x4ff")],e),this[a0_0x5592("0xb3a")]=t,this[a0_0x5592("0x7b4")][a0_0x5592("0x1f2")](j[a0_0x5592("0xb0f")],e)}get[a0_0x5592("0x96d")](){return this[a0_0x5592("0x4ff")]}set[a0_0x5592("0x96d")](t){this[a0_0x5592("0x11e")]=t}get[a0_0x5592("0x902")](){return this[a0_0x5592("0x7f1")]}set[a0_0x5592("0x902")](t){this[a0_0x5592("0x7f1")]=t}get[a0_0x5592("0x968")](){return this[a0_0x5592("0x2ce")]}set["specularColorG"](t){this[a0_0x5592("0x2ce")]=t}get[a0_0x5592("0x442")](){return this[a0_0x5592("0x9a3")]}set[a0_0x5592("0x442")](t){this["_SpecColorB"]=t}get[a0_0x5592("0x47e")](){return this["_SpecColorA"]}set[a0_0x5592("0x47e")](t){this[a0_0x5592("0x988")]=t}get[a0_0x5592("0x1e")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x417")](j["MATERIALSPECULAR"])}set[a0_0x5592("0x1e")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x1f2")](j[a0_0x5592("0x3a7")],t)}get[a0_0x5592("0xaf0")](){return this[a0_0x5592("0xa30")]}set[a0_0x5592("0xaf0")](t){this[a0_0x5592("0xa30")]=t}get[a0_0x5592("0x8a7")](){return this[a0_0x5592("0x7b4")]["getTexture"](j[a0_0x5592("0x725")])}set[a0_0x5592("0x8a7")](t){t?this["_shaderValues"][a0_0x5592("0x4c7")](j["SHADERDEFINE_DIFFUSEMAP"]):this[a0_0x5592("0x7b4")][a0_0x5592("0x52c")](j["SHADERDEFINE_DIFFUSEMAP"]),this["_shaderValues"][a0_0x5592("0x650")](j[a0_0x5592("0x725")],t)}get[a0_0x5592("0x335")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x7d1")](j[a0_0x5592("0xa91")])}set["normalTexture"](t){t?this[a0_0x5592("0x7b4")][a0_0x5592("0x4c7")](j[a0_0x5592("0x276")]):this[a0_0x5592("0x7b4")]["removeDefine"](j["SHADERDEFINE_NORMALMAP"]),this["_shaderValues"][a0_0x5592("0x650")](j[a0_0x5592("0xa91")],t)}get[a0_0x5592("0x643")](){return this["_shaderValues"][a0_0x5592("0x7d1")](j[a0_0x5592("0x1ee")])}set[a0_0x5592("0x643")](t){t?this[a0_0x5592("0x7b4")][a0_0x5592("0x4c7")](j[a0_0x5592("0x616")]):this["_shaderValues"][a0_0x5592("0x52c")](j[a0_0x5592("0x616")]),this[a0_0x5592("0x7b4")]["setTexture"](j[a0_0x5592("0x1ee")],t)}get[a0_0x5592("0x8cf")](){return this["_shaderValues"]["getBool"](j["DEPTH_WRITE"])}set[a0_0x5592("0x8cf")](t){this[a0_0x5592("0x7b4")]["setBool"](j[a0_0x5592("0x5d7")],t)}get["cull"](){return this["_shaderValues"]["getInt"](j[a0_0x5592("0x6a5")])}set[a0_0x5592("0x3e")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x5d6")](j[a0_0x5592("0x6a5")],t)}get[a0_0x5592("0x1ad")](){return this["_shaderValues"]["getInt"](j[a0_0x5592("0x98")])}set[a0_0x5592("0x1ad")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x5d6")](j["BLEND"],t)}get[a0_0x5592("0x3c7")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x5a0")](j[a0_0x5592("0x13c")])}set[a0_0x5592("0x3c7")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x5d6")](j[a0_0x5592("0x13c")],t)}get[a0_0x5592("0x71b")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x5a0")](j[a0_0x5592("0x630")])}set[a0_0x5592("0x71b")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x5d6")](j[a0_0x5592("0x630")],t)}get[a0_0x5592("0x2fe")](){return this[a0_0x5592("0x7b4")][a0_0x5592("0x5a0")](j[a0_0x5592("0x979")])}set[a0_0x5592("0x2fe")](t){this["_shaderValues"][a0_0x5592("0x5d6")](j[a0_0x5592("0x979")],t)}static[a0_0x5592("0x272")](){const t=Laya["VertexMesh"];var e={a_Position:t["MESH_POSITION0"],a_Color:t[a0_0x5592("0x977")],a_Normal:t["MESH_NORMAL0"],a_Texcoord0:t[a0_0x5592("0x2c3")],a_Texcoord1:t[a0_0x5592("0x189")],a_BoneWeights:t[a0_0x5592("0x3ea")],a_BoneIndices:t["MESH_BLENDINDICES0"],a_Tangent0:t[a0_0x5592("0x786")],a_MvpMatrix:t[a0_0x5592("0x21b")],a_WorldMat:t[a0_0x5592("0xa14")]},a={u_Bones:o[a0_0x5592("0x8b5")],u_DiffuseTexture:o[a0_0x5592("0x663")],u_NoiseTex:o[a0_0x5592("0x663")],u_SpecularTexture:o[a0_0x5592("0x663")],u_NormalTexture:o[a0_0x5592("0x663")],u_AlphaTestValue:o[a0_0x5592("0x663")],u_DiffuseColor:o[a0_0x5592("0x663")],u_MaterialSpecular:o["PERIOD_MATERIAL"],u_Shininess:o["PERIOD_MATERIAL"],u_WaterScale:o[a0_0x5592("0x663")],u_TilingOffset:o[a0_0x5592("0x663")],u_WorldMat:o[a0_0x5592("0x486")],u_MvpMatrix:o[a0_0x5592("0x486")],u_LightmapScaleOffset:o[a0_0x5592("0x486")],u_LightMap:o[a0_0x5592("0x486")],u_LightMapDirection:o[a0_0x5592("0x486")],u_SimpleAnimatorTexture:o[a0_0x5592("0x486")],u_SimpleAnimatorParams:o[a0_0x5592("0x486")],u_SimpleAnimatorTextureSize:o[a0_0x5592("0x486")],u_CameraPos:o[a0_0x5592("0x34f")],u_Viewport:o[a0_0x5592("0x34f")],u_ProjectionParams:o[a0_0x5592("0x34f")],u_View:o["PERIOD_CAMERA"],u_ViewProjection:o[a0_0x5592("0x34f")],u_ReflectTexture:o[a0_0x5592("0x6c3")],u_ReflectIntensity:o[a0_0x5592("0x6c3")],u_FogStart:o[a0_0x5592("0x6c3")],u_FogRange:o[a0_0x5592("0x6c3")],u_FogColor:o[a0_0x5592("0x6c3")],u_DirationLightCount:o[a0_0x5592("0x6c3")],u_LightBuffer:o[a0_0x5592("0x6c3")],u_LightClusterBuffer:o[a0_0x5592("0x6c3")],u_AmbientColor:o[a0_0x5592("0x6c3")],u_ShadowBias:o[a0_0x5592("0x6c3")],u_ShadowLightDirection:o[a0_0x5592("0x6c3")],u_ShadowMap:o[a0_0x5592("0x6c3")],u_ShadowParams:o[a0_0x5592("0x6c3")],u_ShadowSplitSpheres:o[a0_0x5592("0x6c3")],u_ShadowMatrices:o[a0_0x5592("0x6c3")],u_ShadowMapSize:o["PERIOD_SCENE"],u_SpotShadowMap:o["PERIOD_SCENE"],u_SpotViewProjectMatrix:o[a0_0x5592("0x6c3")],u_ShadowLightPosition:o["PERIOD_SCENE"],u_AmbientSHAr:o[a0_0x5592("0x6c3")],u_AmbientSHAg:o["PERIOD_SCENE"],u_AmbientSHAb:o[a0_0x5592("0x6c3")],u_AmbientSHBr:o[a0_0x5592("0x6c3")],u_AmbientSHBg:o[a0_0x5592("0x6c3")],u_AmbientSHBb:o["PERIOD_SCENE"],u_AmbientSHC:o["PERIOD_SCENE"],"u_DirectionLight.color":o["PERIOD_SCENE"],"u_DirectionLight.direction":o[a0_0x5592("0x6c3")],"u_PointLight.position":o[a0_0x5592("0x6c3")],"u_PointLight.range":o["PERIOD_SCENE"],"u_PointLight.color":o["PERIOD_SCENE"],"u_SpotLight.position":o["PERIOD_SCENE"],"u_SpotLight.direction":o[a0_0x5592("0x6c3")],"u_SpotLight.range":o[a0_0x5592("0x6c3")],"u_SpotLight.spot":o[a0_0x5592("0x6c3")],"u_SpotLight.color":o[a0_0x5592("0x6c3")],u_Time:o[a0_0x5592("0x6c3")]},i={s_Cull:o[a0_0x5592("0x5d")],s_Blend:o[a0_0x5592("0x211")],s_BlendSrc:o[a0_0x5592("0x576")],s_BlendDst:o[a0_0x5592("0x8b1")],s_DepthTest:o[a0_0x5592("0x467")],s_DepthWrite:o["RENDER_STATE_DEPTH_WRITE"]},r=o[a0_0x5592("0x42e")](a0_0x5592("0x25"),null,null,!0),s=new Laya[a0_0x5592("0x826")](e,a);r[a0_0x5592("0x873")](s),s[a0_0x5592("0x5b")](Oe,Ne,i)}["clone"](){var t=new j;return this[a0_0x5592("0x799")](t),t}["cloneTo"](t){super["cloneTo"](t);var e=t;e[a0_0x5592("0x285")]=this[a0_0x5592("0x285")],e["_albedoIntensity"]=this["_albedoIntensity"],e[a0_0x5592("0x571")]=this[a0_0x5592("0x571")],this[a0_0x5592("0xb3a")][a0_0x5592("0x799")](e[a0_0x5592("0xb3a")])}set[a0_0x5592("0x5bc")](t){this[a0_0x5592("0x7b4")][a0_0x5592("0x650")](this[a0_0x5592("0x755")],t)}}j[a0_0x5592("0x3d6")]=0,j[a0_0x5592("0x34e")]=1,j[a0_0x5592("0x35")]=2,j[a0_0x5592("0x725")]=o[a0_0x5592("0x364")](a0_0x5592("0x539")),j[a0_0x5592("0xa91")]=o[a0_0x5592("0x364")](a0_0x5592("0x46c")),j["SPECULARTEXTURE"]=o[a0_0x5592("0x364")](a0_0x5592("0x855")),j[a0_0x5592("0xb0f")]=o[a0_0x5592("0x364")](a0_0x5592("0x40a")),j["MATERIALSPECULAR"]=o[a0_0x5592("0x364")](a0_0x5592("0x934")),j[a0_0x5592("0x797")]=o["propertyNameToID"](a0_0x5592("0x17e")),j[a0_0x5592("0x6dc")]=o[a0_0x5592("0x364")](a0_0x5592("0x4eb")),j[a0_0x5592("0x6a5")]=o[a0_0x5592("0x364")](a0_0x5592("0x37c")),j[a0_0x5592("0x98")]=o["propertyNameToID"](a0_0x5592("0x705")),j[a0_0x5592("0x13c")]=o[a0_0x5592("0x364")](a0_0x5592("0x25e")),j[a0_0x5592("0x630")]=o["propertyNameToID"](a0_0x5592("0x21f")),j[a0_0x5592("0x979")]=o["propertyNameToID"](a0_0x5592("0x90b")),j["DEPTH_WRITE"]=o[a0_0x5592("0x364")]("s_DepthWrite");class Ve extends t{constructor(){super(),this["bgIma"]=null,this[a0_0x5592("0x4cd")]=null,this["pid"]=0,this["ins"]=null}[a0_0x5592("0x880")](){this["ins"]=Y["instance"];const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x1ba")],a=e?t[a0_0x5592("0x587")][e-1]["playerData"]:t[a0_0x5592("0x4ca")];this[a0_0x5592("0xa43")][a0_0x5592("0x8fa")]="battle/player/plane/p"+a["id"]+a0_0x5592("0x525"),this[a0_0x5592("0x4cd")][a0_0x5592("0x143")]=!1}[a0_0x5592("0x33a")](t){this[a0_0x5592("0x4cd")][a0_0x5592("0x1e3")]=t,this[a0_0x5592("0x4cd")]["visible"]=!0}[a0_0x5592("0x4fd")](){}["onLateUpdate"](){const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x1ba")];if(t[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const a=this[a0_0x5592("0x8a0")];let i=e?t[a0_0x5592("0x587")][e-1]["v2"]:t[a0_0x5592("0x94d")];a[a0_0x5592("0x6f7")](i["x"],i["y"])}}class Ue extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["selfCol"]=null,this[a0_0x5592("0x5b3")]=null,this["pid"]=0,this[a0_0x5592("0x743")]=null,this[a0_0x5592("0x68c")]=null,this[a0_0x5592("0x641")]=!1,this[a0_0x5592("0x2b4")]=!1,this[a0_0x5592("0xb18")]=!1}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y["instance"],this["selfCol"]=this["owner"][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this["iswudi"]=!1,this["iswudi2"]=!1,this["isblink"]=!1,this["wudi1"][a0_0x5592("0x14")]=0,this["wudi2"][a0_0x5592("0x14")]=0,R["on"](F[a0_0x5592("0x4cb")],this,()=>{if(this[a0_0x5592("0x1ba")])return;this[a0_0x5592("0x2b4")]=!0,this[a0_0x5592("0x44d")](2700),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](3e3,this,()=>{this[a0_0x5592("0x2b4")]=!1}),this["isblink"]=!1,Ut[a0_0x5592("0x4e")][a0_0x5592("0x93c")][a0_0x5592("0x143")]=!1}),R["on"](F[a0_0x5592("0xa79")],this,t=>{let e=this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")][a0_0x5592("0x779")](t[a0_0x5592("0x639")]);e>-1&&this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")][a0_0x5592("0x3c8")](e,1)})}[a0_0x5592("0x44d")](t){this[a0_0x5592("0x641")]=!0,!this[a0_0x5592("0x1ba")]&&this[a0_0x5592("0x8a4")][a0_0x5592("0x78f")]&&window[a0_0x5592("0x5fe")]&&window[a0_0x5592("0x5fe")]["vibrate"]&&window["navigator"][a0_0x5592("0x78f")](100),this["wudi1"][a0_0x5592("0x27")]&&(this["wudi1"][a0_0x5592("0x7c2")](.5),this[a0_0x5592("0x743")][a0_0x5592("0x590")](0,!1)),this[a0_0x5592("0x68c")][a0_0x5592("0x27")]&&this[a0_0x5592("0x68c")][a0_0x5592("0x7c2")](.5),this["wudi1"][a0_0x5592("0x14")]=1,Laya["timer"][a0_0x5592("0x724")](600,this,()=>{this[a0_0x5592("0x743")]["alpha"]=0}),this[a0_0x5592("0x68c")][a0_0x5592("0x14")]=1,this[a0_0x5592("0x68c")]["scaleX"]=this[a0_0x5592("0x68c")][a0_0x5592("0xa37")]=0,Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x68c")],{alpha:1,scaleX:1,scaleY:1},600),Laya[a0_0x5592("0x6ec")]["once"](t,this,()=>{this["iswudi"]=!1,Laya["Tween"]["to"](this["wudi2"],{alpha:0},300)})}[a0_0x5592("0xb11")](t,e){const a=t[a0_0x5592("0x8a0")];if(!a||!a["parent"])return;const i=this[a0_0x5592("0x8a4")],r=this[a0_0x5592("0x1ba")],s=a["getComponent"](X),n=a["getComponent"](Zt),o=r?i[a0_0x5592("0x587")][r-1]["playerData"]:i[a0_0x5592("0x4ca")];if(this[a0_0x5592("0x641")]||this[a0_0x5592("0x2b4")]||o[a0_0x5592("0x257")]<=0)return;let l=null;n&&n[a0_0x5592("0x2e2")]&&(l="number"==typeof n["edata"]["att"]?n[a0_0x5592("0x2e2")][a0_0x5592("0x644")]:n["edata"][a0_0x5592("0x644")][a0_0x5592("0xae0")]("|")[0]||0),s&&s[a0_0x5592("0x523")]&&(l=s[a0_0x5592("0x523")][a0_0x5592("0x1fa")]),o[a0_0x5592("0x257")]-=l,R[a0_0x5592("0xcf")](F["PlayerHP"],r);const _=Ut["insUI"][a0_0x5592("0x93c")],h=t=>{Laya[a0_0x5592("0x6eb")]["to"](_,{alpha:1},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")]["once"](100,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](_,{alpha:0},500,Laya["Ease"][a0_0x5592("0x5db")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{t||(_["visible"]=!1)}))})}))};r||(o[a0_0x5592("0x257")]/o["hp"]<=.1?this["isblink"]||(this["isblink"]=!0,Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](_),_[a0_0x5592("0x14")]=0,_[a0_0x5592("0x143")]=!0,h(!0),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1100,this,()=>{h(!0)})):_&&!_["visible"]&&(_[a0_0x5592("0x14")]=0,_["visible"]=!0,Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](_),h())),this[a0_0x5592("0x641")]||this[a0_0x5592("0x44d")](1700),o[a0_0x5592("0x257")]<=0&&(this[a0_0x5592("0xae3")](2001),r?R[a0_0x5592("0xcf")](F[a0_0x5592("0xaad")],r):R[a0_0x5592("0xcf")](F[a0_0x5592("0x42f")]))}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x4fd")](){Laya["timer"][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R["offAllCaller"](this)}[a0_0x5592("0xae3")](t){const e=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x54f")]),a=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x54f")],e);a[a0_0x5592("0x753")]=t;const i=this["owner"];a["x"]=i["x"],a["y"]=i["y"],this[a0_0x5592("0x8a4")][a0_0x5592("0xa7e")]["addChild"](a)}[a0_0x5592("0x5b4")](){this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this["ins"]["enemyCols"],this[a0_0x5592("0x1b2")])}}class ke extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1ba")]=0,this["line"]=null,this[a0_0x5592("0xafa")]=null,this[a0_0x5592("0x9f2")]=null,this[a0_0x5592("0x202")]=null,this[a0_0x5592("0x229")]=12,this[a0_0x5592("0x7ab")]=60,this[a0_0x5592("0x7a2")]=5}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const a=this[a0_0x5592("0x1ba")],t=this[a0_0x5592("0x8a4")],i=a?t[a0_0x5592("0x587")][a-1][a0_0x5592("0x4ca")]:t["playerData"];let r=this[a0_0x5592("0x7a2")]*this[a0_0x5592("0x229")];this[a0_0x5592("0xafa")]["width"]=r,this["currBarWidth"]=r,R["on"](F[a0_0x5592("0x2ff")],this,t=>{if(t||(t=0),t!=a)return;let e=i[a0_0x5592("0x257")]/i["hp"]*r;this[a0_0x5592("0x7ab")]=e,this[a0_0x5592("0x202")][a0_0x5592("0x1e3")]=(Math[a0_0x5592("0x6fc")](i[a0_0x5592("0x257")]/i["hp"]*100)||1)+"%"}),R["on"](F["PlayerMaxHP"],this,t=>{if(t||(t=0),t!=a)return;this[a0_0x5592("0x7a2")]++,r=this[a0_0x5592("0x7a2")]*this[a0_0x5592("0x229")],this["bgBar"][a0_0x5592("0x481")]=r;let e=i["currHP"]/i["hp"]*r;this["currBarWidth"]=e,this[a0_0x5592("0x202")][a0_0x5592("0x1e3")]=(Math[a0_0x5592("0x6fc")](i["currHP"]/i["hp"]*100)||1)+"%"}),R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ff")])}["onDisable"](){R[a0_0x5592("0x5c7")](this)}["onLateUpdate"](){const t=this[a0_0x5592("0x8a4")],e=this[a0_0x5592("0x1ba")];if(t[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const a=this[a0_0x5592("0x8a0")];let i=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")]/1e3,r=this[a0_0x5592("0xce")](a["x"],a["y"]);const s=e?t[a0_0x5592("0x587")][e-1][a0_0x5592("0xa3a")]:t["playerPosV2"];let n=this[a0_0x5592("0xce")](s["x"]+40,s["y"]-40),o=this["getVec3"]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x2bb")](r,n,8*i,o),a[a0_0x5592("0x6f7")](o["x"],o["y"]);let l=e?t["otherPlayer"][e-1]["v2"]:t[a0_0x5592("0x94d")],_=o["x"]-l["x"],h=o["y"]-l["y"];this["line"][a0_0x5592("0x1c1")]=Math["sqrt"](_*_+h*h),this[a0_0x5592("0x1c4")][a0_0x5592("0x3b0")]=Math[a0_0x5592("0x23d")](_,-h)/Math["PI"]*180;let x=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")]["lerp"](this[a0_0x5592("0xce")](this["bar"][a0_0x5592("0x481")]),this[a0_0x5592("0xce")](this["currBarWidth"]),.01*Laya[a0_0x5592("0x6ec")]["delta"],x),this[a0_0x5592("0x9f2")][a0_0x5592("0x481")]=x["x"]}}class Ge extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x91")]=null,this["playerPre1"]=null,this[a0_0x5592("0x99d")]=null,this[a0_0x5592("0x6d3")]={},this["playerPre"]=this["getRes"](w["battle"][a0_0x5592("0x4f5")]),this["playerPre1"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x1ab")]),this[a0_0x5592("0x99d")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x2ff")]);for(const t in y){const e=y[t];this["playerMods"][t]=this[a0_0x5592("0x761")](e)}}["onEnable"](){this["ins"]=Y["instance"],R["on"](a0_0x5592("0x62b"),this,()=>{this[a0_0x5592("0x8a4")][a0_0x5592("0x587")][a0_0x5592("0xb0e")]&&this[a0_0x5592("0xa8")](1)}),R["on"](F[a0_0x5592("0x8e2")],this,(t,e)=>{e&&this["initOtherPlayer"](e,t)}),this[a0_0x5592("0x5ab")]()}["initPlayerModel"](){const d=this[a0_0x5592("0x8a4")],u=d["playerData"]["id"],t=it;let e=this[a0_0x5592("0xce")]();d["modCameraV3"]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](360,1280),e);const a=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](this["playerMods"][u]);a[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=e,a[a0_0x5592("0x48b")][a0_0x5592("0x49b")]=this[a0_0x5592("0xce")](1.55,1.55,1.55);const i=new j;i[a0_0x5592("0x96d")]=1.4,i[a0_0x5592("0xaf0")]=.25;const r=a[a0_0x5592("0x433")](0),s=this["getRes"](t[u]);i[a0_0x5592("0x8a7")]=s,Laya["Texture2D"]["load"](a0_0x5592("0x351"),Laya["Handler"][a0_0x5592("0x2ab")](null,function(t){i[a0_0x5592("0x5bc")]=t,r[a0_0x5592("0x6bc")][a0_0x5592("0x88c")]=i})),d[a0_0x5592("0x334")]=a,d[a0_0x5592("0xa88")][a0_0x5592("0x231")](a);const n=this[a0_0x5592("0x761")](b[a0_0x5592("0x418")]),o=Laya["ShuriKenParticle3D"][a0_0x5592("0x2f3")](n);o[a0_0x5592("0x48b")]["position"]=this["getVec3"](0,0,.1),a[a0_0x5592("0x231")](o);const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x4f5")],this["playerPre"]);l["pos"](360,1280),d[a0_0x5592("0x1a9")]["addChild"](l),d[a0_0x5592("0x94d")]=l,d[a0_0x5592("0x532")][a0_0x5592("0x626")](l[a0_0x5592("0x751")](W));const _=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x1ab")],this[a0_0x5592("0x1bf")]);_["pos"](360,1280),d[a0_0x5592("0x23a")]["addChild"](_),l[a0_0x5592("0x3b3")]=_;const h=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x2ff")],this[a0_0x5592("0x99d")]);h[a0_0x5592("0x6f7")](400,1240),d[a0_0x5592("0xa7e")][a0_0x5592("0x231")](h),d[a0_0x5592("0x448")]=h;const f=window[a0_0x5592("0xea")];d[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](d[a0_0x5592("0xa3d")],e),d[a0_0x5592("0xacc")]=e,Laya[a0_0x5592("0x6eb")]["to"](l,{y:d["playerPosV2"]["y"]},500,Laya["Ease"][a0_0x5592("0x544")]),Laya[a0_0x5592("0x6eb")]["to"](_,{y:d[a0_0x5592("0xa3d")]["y"]},500,Laya[a0_0x5592("0x4ec")]["cubicOut"]),Laya["Tween"]["to"](h,{y:d["playerPosV2"]["y"]-40},500,Laya[a0_0x5592("0x4ec")]["cubicOut"]),Laya[a0_0x5592("0x6eb")]["to"](a[a0_0x5592("0x48b")],{localPositionZ:e["z"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{if(f)R[a0_0x5592("0xcf")](F["AdvRateSupply"]);else{const t=d["playerData"][a0_0x5592("0xa16")];if(M[a0_0x5592("0x5c8")]&&M[a0_0x5592("0x5c8")][a0_0x5592("0xa9e")]){const i=M[a0_0x5592("0x5c8")][a0_0x5592("0xa9e")]["bskills"];if(i)for(const r in i){const s=i[r]["id"];this[a0_0x5592("0x7d5")](s);const n=t[a0_0x5592("0x779")](s);n>-1&&t[a0_0x5592("0x3c8")](n,1)}}const e=d[a0_0x5592("0x4ca")][a0_0x5592("0x53d")];d[a0_0x5592("0x4ca")][a0_0x5592("0x53d")]={};for(const o in e){const l=e[o],_=parseInt(o);if(1023!=_||3==d[a0_0x5592("0x4ca")]["id"])for(let t=0;t<l;t++)this[a0_0x5592("0x7d5")](_)}const a=d[a0_0x5592("0x4ca")][a0_0x5592("0xf0")];d[a0_0x5592("0x4ca")][a0_0x5592("0xf0")]={};for(const h in a){const x=a[h],c=parseInt(h);for(let t=0;t<x;t++)this[a0_0x5592("0x8f4")](c)}d[a0_0x5592("0x4ca")][a0_0x5592("0x9d5")]>1&&1==d["playerData"][a0_0x5592("0x2d6")]&&!d["isEndless"]?R[a0_0x5592("0xcf")](F[a0_0x5592("0x8c7")]):d[a0_0x5592("0x505")]?R[a0_0x5592("0xcf")](F[a0_0x5592("0x3f")]):d[a0_0x5592("0x4ca")][a0_0x5592("0x9d5")]<1||(d[a0_0x5592("0xe5")]&&1==d["playerData"][a0_0x5592("0x2d6")]?(d["selSkill"]--,R[a0_0x5592("0xcf")](F[a0_0x5592("0x5c6")])):R[a0_0x5592("0xcf")](F[a0_0x5592("0x9ef")]))}d["playerData"][a0_0x5592("0x9d5")]>0&&R[a0_0x5592("0xcf")](F["PlayerBullet"],u)}));let x=this[a0_0x5592("0xce")](),c=this["getVec3"]();d[a0_0x5592("0x4bc")]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](360,640),x),d[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](360,641),c),d[a0_0x5592("0x747")]=1/(c["z"]-x["z"])}[a0_0x5592("0x41")](t,e){const a=this[a0_0x5592("0x8a4")],i=it,r=a["playerPosV2"]["x"],s=r+200<=670?r+200:r-200;let n=this[a0_0x5592("0xce")]();a[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this["getVec3"](s,1280),n);const o=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](this[a0_0x5592("0x6d3")][t]);o[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=n,o[a0_0x5592("0x48b")][a0_0x5592("0x49b")]=this[a0_0x5592("0xce")](1.55,1.55,1.55);const l=new j;l[a0_0x5592("0xa54")]=Laya[a0_0x5592("0x58b")][a0_0x5592("0x35")],l["albedoColorA"]=.4,l[a0_0x5592("0x96d")]=1.4,l[a0_0x5592("0xaf0")]=.25;const _=o[a0_0x5592("0x433")](0),h=this[a0_0x5592("0x761")](i[t]);l[a0_0x5592("0x8a7")]=h,Laya[a0_0x5592("0xa6f")][a0_0x5592("0x6e9")](a0_0x5592("0x351"),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](null,function(t){l[a0_0x5592("0x5bc")]=t,_["meshRenderer"][a0_0x5592("0x88c")]=l})),a[a0_0x5592("0xa88")][a0_0x5592("0x231")](o);const x=this["getRes"](b[a0_0x5592("0x418")]),c=Laya[a0_0x5592("0xab3")]["instantiate"](x);c[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=this["getVec3"](0,0,.1),c["getChildAt"](0)[a0_0x5592("0x79a")][a0_0x5592("0x3f1")]=this[a0_0x5592("0x436")](1,1,1,.2),o["addChild"](c);const d=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x4f5")],this[a0_0x5592("0x91")]);d[a0_0x5592("0x6f7")](s,1280),a[a0_0x5592("0x532")][a0_0x5592("0x626")](d[a0_0x5592("0x751")](W));const u=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x1ab")],this[a0_0x5592("0x1bf")]);u[a0_0x5592("0x6f7")](s,1280),d["__bgIma__"]=u;const f=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["PlayerHP"],this[a0_0x5592("0x99d")]);f[a0_0x5592("0x6f7")](s+40,1240);const p=this[a0_0x5592("0xce")](s,1e3);a[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](p,n);const m=a[a0_0x5592("0x587")][a0_0x5592("0xb0e")]+1;d[a0_0x5592("0x751")](se)["pid"]=m,d[a0_0x5592("0x751")](Ue)[a0_0x5592("0x1ba")]=m;const g=u[a0_0x5592("0x751")](Ve);g["pid"]=m,f["getComponent"](ke)[a0_0x5592("0x1ba")]=m;const v={v2:d,v3:o,hpv2:f,posv2:this["getVec3"](s,1e3),posv3:n,lassv2:[],wingsv2:[],ballsv2:[],playerData:new re};v[a0_0x5592("0x4ca")][a0_0x5592("0x274")](a[a0_0x5592("0x4ca")],t),a[a0_0x5592("0x587")]["push"](v),a["playerNode"][a0_0x5592("0x231")](d),a[a0_0x5592("0x23a")][a0_0x5592("0x231")](u),a["effectNode"][a0_0x5592("0x231")](f),g[a0_0x5592("0x33a")](e),Laya[a0_0x5592("0x6eb")]["to"](d,{y:p["y"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")]),Laya[a0_0x5592("0x6eb")]["to"](u,{y:p["y"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")]),Laya["Tween"]["to"](f,{y:p["y"]-40},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")]);const y=()=>{Laya[a0_0x5592("0x6eb")]["to"](l,{albedoColorA:.1},250),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](250,this,()=>{Laya["Tween"]["to"](l,{albedoColorA:.4},250)})};Laya[a0_0x5592("0x6eb")]["to"](o[a0_0x5592("0x48b")],{localPositionZ:n["z"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{y(),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,y),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{if(!a["otherPlayer"][m-1])return;R[a0_0x5592("0xcf")](F["PlayerBullet"],[t,m]);let e=Object[a0_0x5592("0x36c")](a[a0_0x5592("0x4ca")][a0_0x5592("0x53d")])["length"];3==a[a0_0x5592("0x4ca")]["id"]&&e>=1&&e--;for(let t=0;t<e;t++)this["getRandomSkill"](m)})}))}["getRandomSkill"](t){if(!t)return;const e=this[a0_0x5592("0x8a4")],o=e[a0_0x5592("0x587")][t-1][a0_0x5592("0x4ca")],l=e["otherPlayer"][t-1],_=o[a0_0x5592("0xa16")],h=D[a0_0x5592("0x53d")],a=(()=>{let a=_[a0_0x5592("0xac7")]();for(let t=a[a0_0x5592("0xb0e")]-1;t>=0;t--){const i=a[t];h[i][a0_0x5592("0x923")]<=0&&a[a0_0x5592("0x3c8")](t,1)}const t=a["indexOf"](1013);o[a0_0x5592("0x257")]/o["hp"]>.7&&t>=0&&a["splice"](t,1);const e=a[a0_0x5592("0x779")](1023);if(3==o["id"]&&e>-1&&a[a0_0x5592("0x3c8")](e,1),l["wingsv2"][a0_0x5592("0xb0e")]>=4)for(let t=a["length"]-1;t>=0;t--){const r=a[t];3==h[r]["skilltype"]&&a["splice"](t,1)}else{let e=null;for(const s in o[a0_0x5592("0x53d")])3==h[s][a0_0x5592("0x84a")]&&(e=parseInt(s));if(e)for(let t=a["length"]-1;t>=0;t--){const n=a[t];3==h[n]["skilltype"]&&n!=e&&a[a0_0x5592("0x3c8")](t,1)}}return a})();if(a[a0_0x5592("0xb0e")]<4)return;const i=[];for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const c=a[t],d=h[c];if(i[a0_0x5592("0x626")](c),"number"==typeof d[a0_0x5592("0x923")])for(let t=1;t<d["weight"]/1e3;t++)i["push"](c)}const r=[],s=[],n=i[a0_0x5592("0xb0e")]-1;for(;r["length"]<1;){let t=Math["floor"](Math["random"]()*(n-0+1)+0);r[a0_0x5592("0x779")](t)<0&&s[a0_0x5592("0x779")](i[t])<0&&(r["push"](t),s[a0_0x5592("0x626")](i[t]))}let x=s[0];o[a0_0x5592("0x9d5")]<1||((t=>{const e=h[t],a=_[a0_0x5592("0x779")](t);e["add"]==m[a0_0x5592("0x52")]&&_[a0_0x5592("0x3c8")](a,1),e[a0_0x5592("0x42e")]==m[a0_0x5592("0x1d2")]&&(h[t+1]&&h[t+1][a0_0x5592("0x42e")]==m[a0_0x5592("0x1d2")]?_[a]=t+1:_[a0_0x5592("0x3c8")](a,1))})(x),this[a0_0x5592("0x7d5")](x,t))}[a0_0x5592("0x7d5")](t,e){e||(e=0);let a="";t<2e3?a=a0_0x5592("0x4e3")+t+"_baseskill":t>2e3&&t<3e3?a=a0_0x5592("0x4e3")+t+a0_0x5592("0x471"):t>3e3&&t<4e3?a=a0_0x5592("0x4e3")+t+"_wingskill":t>4e3&&(a=a0_0x5592("0x4e3")+t+a0_0x5592("0x2e0")),R["event"](a,e)}["getSkill2"](t){R[a0_0x5592("0xcf")]("player_"+t+"_supply")}[a0_0x5592("0x4fd")](){R["offAllCaller"](this),Laya["timer"]["clearAll"](this)}}class He extends t{constructor(){super(),this["qhBtn"]=null,this[a0_0x5592("0x718")]=null,this[a0_0x5592("0x53c")]=null,this[a0_0x5592("0x198")]=null,this[a0_0x5592("0x271")]=null,this["jgBtn"]=null,this[a0_0x5592("0x35d")]=null,this["chddBtn"]=null,this["ddgBtn"]=null,this["xzdqBtn"]=null,this[a0_0x5592("0x414")]=null,this[a0_0x5592("0x77c")]=null,this[a0_0x5592("0x267")]=null,this[a0_0x5592("0x275")]=null,this["ddljBtn"]=null,this[a0_0x5592("0x82b")]=null,this[a0_0x5592("0x10a")]=null,this[a0_0x5592("0x9fa")]=null,this["zzpljBtn"]=null,this[a0_0x5592("0xa57")]=null,this[a0_0x5592("0x9ed")]=null,this[a0_0x5592("0x82a")]=null,this[a0_0x5592("0x46b")]=null,this[a0_0x5592("0x7d2")]=null,this[a0_0x5592("0x7ee")]=null,this[a0_0x5592("0x5d9")]=null,this["xzhdBtn"]=null,this[a0_0x5592("0x610")]=null,this["swbzBtn"]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this["qhBtn"],this[a0_0x5592("0x676")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x718")],this["baseSkill7"][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x53c")],this["baseSkill9"][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x198")],this[a0_0x5592("0x2ea")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this["cjbBtn"],this[a0_0x5592("0xaa5")]["bind"](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x63e")],this["skill3"][a0_0x5592("0xa2f")](this),this),this["setClick"](this[a0_0x5592("0x35d")],this[a0_0x5592("0x312")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this["chddBtn"],this[a0_0x5592("0x42c")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x748")],this[a0_0x5592("0x349")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this["ddgBtn"],this[a0_0x5592("0x9eb")][a0_0x5592("0xa2f")](this),this),this["setClick"](this[a0_0x5592("0x414")],this[a0_0x5592("0x4c5")]["bind"](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x77c")],this[a0_0x5592("0x1cc")]["bind"](this),this),this["setClick"](this[a0_0x5592("0x267")],this[a0_0x5592("0xc8")][a0_0x5592("0xa2f")](this),this),this["setClick"](this["sdljBtn"],this[a0_0x5592("0x70e")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x348")],this[a0_0x5592("0x2db")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this["jgljBtn"],this[a0_0x5592("0x67c")]["bind"](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x10a")],this["wing1"][a0_0x5592("0xa2f")](this),this),this["setClick"](this[a0_0x5592("0x9fa")],this[a0_0x5592("0x3e6")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x84f")],this["wing4"]["bind"](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0xa57")],this[a0_0x5592("0x8eb")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x9ed")],this[a0_0x5592("0x28d")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x82a")],this[a0_0x5592("0xb1c")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this["fnBtn"],this[a0_0x5592("0x4fa")][a0_0x5592("0xa2f")](this),this),this["setClick"](this[a0_0x5592("0x7d2")],this[a0_0x5592("0x777")]["bind"](this),this),this[a0_0x5592("0x68")](this["ddBtn"],this["ddSkill"][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x5d9")],this[a0_0x5592("0x6b0")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x782")],this["xzhdSkill"][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x610")],this[a0_0x5592("0x7d9")][a0_0x5592("0xa2f")](this),this),this[a0_0x5592("0x68")](this[a0_0x5592("0x4b4")],this[a0_0x5592("0x51f")][a0_0x5592("0xa2f")](this),this)}[a0_0x5592("0x7d9")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x303")])}[a0_0x5592("0x51f")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x2a9")])}[a0_0x5592("0x6b0")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x109")])}[a0_0x5592("0x778")](){R["event"](F[a0_0x5592("0x887")])}[a0_0x5592("0x4fa")](){R[a0_0x5592("0xcf")](F["BulSkill2013"])}[a0_0x5592("0x777")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x300")])}["ddSkill"](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x598")])}["baseSkill6"](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x86f")])}["baseSkill7"](){R["event"](F["BaseSkill7"])}[a0_0x5592("0xa64")](){R["event"](F[a0_0x5592("0x3ca")])}[a0_0x5592("0x2ea")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x998")])}[a0_0x5592("0xaa5")](){R["event"](F[a0_0x5592("0x430")])}["skill3"](){R[a0_0x5592("0xcf")](F["BulSkill3"])}[a0_0x5592("0x312")](){R[a0_0x5592("0xcf")](F["BulSkill4"])}[a0_0x5592("0x42c")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x469")])}["skill6"](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x263")])}[a0_0x5592("0x9eb")](){R["event"](F["BulSkill7"])}[a0_0x5592("0x4c5")](){R["event"](F["BulSkill8"])}["skill9"](){R[a0_0x5592("0xcf")](F[a0_0x5592("0xaf7")])}[a0_0x5592("0xc8")](){R["event"](F[a0_0x5592("0x83f")])}[a0_0x5592("0x4f2")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x51b")])}[a0_0x5592("0x2db")](){R["event"](F[a0_0x5592("0x424")])}["wing3"](){R["event"](F[a0_0x5592("0xfe")])}["wing4"](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x177")])}["wing5"](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x9dc")])}[a0_0x5592("0x3e6")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x3ae")])}[a0_0x5592("0x8eb")](){R["event"](F[a0_0x5592("0x86d")])}[a0_0x5592("0x28d")](){R[a0_0x5592("0xcf")](F[a0_0x5592("0x28c")])}["robot3"](){R[a0_0x5592("0xcf")](F["RobSkill3"])}[a0_0x5592("0x4fd")](){R["offAllCaller"](this)}}class ze extends t{constructor(){super(),this["hand"]=null,this[a0_0x5592("0x33b")]=this["getVec2"](295,326),this[a0_0x5592("0x531")]=this["getVec2"](425,326),this[a0_0x5592("0xa08")]=1,this[a0_0x5592("0x4ad")]=0}[a0_0x5592("0x880")](){this[a0_0x5592("0xd4")][a0_0x5592("0x6f7")](360,326),this["vec"]=1,this[a0_0x5592("0x4ad")]=0}["onUpdate"](){if(this[a0_0x5592("0x8a0")][a0_0x5592("0x143")]){const t=this["hand"];if(1==this[a0_0x5592("0xa08")]&&this["angle"]>=360&&(this["angle"]=180,this[a0_0x5592("0xa08")]=2),2==this["vec"]&&this[a0_0x5592("0x4ad")]<=-180&&(this[a0_0x5592("0x4ad")]=0,this[a0_0x5592("0xa08")]=1),1==this[a0_0x5592("0xa08")]){const e=this["cen1"];this[a0_0x5592("0x4ad")]+=2;const a=this[a0_0x5592("0x4ad")]/180*Math["PI"];t["x"]=e["x"]+65*Math[a0_0x5592("0x2d9")](a),t["y"]=e["y"]-65*Math[a0_0x5592("0x2d2")](a)}else{const i=this[a0_0x5592("0x531")];this[a0_0x5592("0x4ad")]-=2;const r=this["angle"]/180*Math["PI"];t["x"]=i["x"]+65*Math[a0_0x5592("0x2d9")](r),t["y"]=i["y"]-65*Math[a0_0x5592("0x2d2")](r)}}}}var We,Xe=Laya["View"],Ye=Laya["Scene"],je=Laya[a0_0x5592("0x978")][a0_0x5592("0xaec")];!function(t){class e extends Ye{constructor(){super()}["createChildren"](){super[a0_0x5592("0x9f6")](),this["loadScene"](a0_0x5592("0x9a0"))}}t["BattleSceneUI"]=e,je(a0_0x5592("0x28"),e);class a extends Xe{constructor(){super()}[a0_0x5592("0x9f6")](){super["createChildren"](),this[a0_0x5592("0x129")]("LobbyScene")}}t[a0_0x5592("0x371")]=a,je(a0_0x5592("0xa7b"),a)}(We||(We={}));class g extends We[a0_0x5592("0x371")]{constructor(){super(),g[a0_0x5592("0x173")]=this}[a0_0x5592("0x880")](){Laya["SoundManager"][a0_0x5592("0x767")](at[a0_0x5592("0x9ce")],0);L[a0_0x5592("0x713")]=at[a0_0x5592("0x9ce")]}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x262")][a0_0x5592("0x8ee")](),L["bgCha"]=null}}g[a0_0x5592("0x173")]=null;class qe extends t{constructor(){super(),this[a0_0x5592("0x114")]=null}["onEnable"](){const t=this[a0_0x5592("0x114")];if(t){const e=t[a0_0x5592("0xae0")](".");this[a0_0x5592("0x8a0")]["text"]=N[e[0]][e[1]]}}[a0_0x5592("0x4fd")](){}}class Ze{static[a0_0x5592("0x317")](t,e){this[a0_0x5592("0xf9")][t]||(this[a0_0x5592("0xf9")][t]=e)}}Ze[a0_0x5592("0xf9")]={};class Ke extends t{constructor(){super(),this[a0_0x5592("0x6ec")]=0,this["str"]=null,this["redDotIma"]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x86b")]||(this[a0_0x5592("0x86b")]=this["owner"]["getChildByName"]("red.dot")),this[a0_0x5592("0xa84")]()}[a0_0x5592("0x4fd")](){}["onLongUpdate"](){if(this[a0_0x5592("0x86b")]&&Ze[a0_0x5592("0xf9")][this[a0_0x5592("0x114")]]){const t=Ze[a0_0x5592("0xf9")][this[a0_0x5592("0x114")]]();this[a0_0x5592("0x86b")]["visible"]=t}}[a0_0x5592("0x3de")](){this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")],this[a0_0x5592("0x6ec")]>=1e3&&(this["timer"]=0,this[a0_0x5592("0xa84")]())}}class Qe extends t{constructor(){super()}["onEnable"](){this[a0_0x5592("0x8a0")]["on"](a0_0x5592("0x329"),this,this[a0_0x5592("0x6b4")])}[a0_0x5592("0x6b4")](){Nt&&Nt[a0_0x5592("0x6b4")]()}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x8a0")][a0_0x5592("0x1d0")](a0_0x5592("0x329"),this,this["nextStep"])}}class Je extends t{constructor(){super(),this[a0_0x5592("0xa41")]=null,this[a0_0x5592("0x6c")]=0}[a0_0x5592("0x880")](){R["on"](v[a0_0x5592("0x88")],this,this[a0_0x5592("0x908")]);const a=[N[a0_0x5592("0x889")][1],N[a0_0x5592("0x889")][2]],t=this[a0_0x5592("0xa41")];t[a0_0x5592("0x6be")]="",t[a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{this["setData"](t,a[e])},null,!1),t[a0_0x5592("0xa3f")]=a}["initPage"](){const t=[N[a0_0x5592("0x889")][1],N[a0_0x5592("0x889")][2]];this["list"][a0_0x5592("0xa3f")]=t}[a0_0x5592("0x971")](e,a){e["skin"]=1==a["id"]?a0_0x5592("0x3"):"lobby/adventure/bg_trial_green.png",e[a0_0x5592("0xab9")](a0_0x5592("0x8ad"))["skin"]=a[a0_0x5592("0xdd")];const t=e[a0_0x5592("0xab9")](a0_0x5592("0x19e")),i=t[a0_0x5592("0x433")](0),r=e[a0_0x5592("0xab9")](a0_0x5592("0x810")),s=r[a0_0x5592("0x433")](1),n=e[a0_0x5592("0xab9")](a0_0x5592("0xa1e")),o=n[a0_0x5592("0x433")](1),l=n[a0_0x5592("0x433")](2),_=n["getChildAt"](3);n[a0_0x5592("0x143")]=!1,t["offAllCaller"](t),o["offAllCaller"](t),l[a0_0x5592("0x5c7")](t),_[a0_0x5592("0x5c7")](t);const h=t=>{r[a0_0x5592("0x1e3")]=a[a0_0x5592("0x5d4")][t-1],i[a0_0x5592("0x1e3")]=a[a0_0x5592("0x5d4")][t-1];s[a0_0x5592("0x8fa")]=[a0_0x5592("0x524"),a0_0x5592("0x307"),a0_0x5592("0x376")][t-1],e[a0_0x5592("0x2bf")]=t,e[a0_0x5592("0xab9")]("powLab")[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](a[a0_0x5592("0x2e8")][t-1])},x=H[a0_0x5592("0x57f")][a["id"]];h(e[a0_0x5592("0x2bf")]||x),this[a0_0x5592("0x68")](t,()=>{n[a0_0x5592("0x143")]=!n[a0_0x5592("0x143")]},t),o["text"]=a["diff"][0],this["setClick"](o,()=>{n[a0_0x5592("0x143")]=!1,h(1)},o),l[a0_0x5592("0x1e3")]=a[a0_0x5592("0x5d4")][1],this[a0_0x5592("0x68")](l,()=>{n[a0_0x5592("0x143")]=!1,h(2)},l),_[a0_0x5592("0x1e3")]=a[a0_0x5592("0x5d4")][2],this[a0_0x5592("0x68")](_,()=>{n[a0_0x5592("0x143")]=!1,h(3)},_);const c=e[a0_0x5592("0xab9")](a0_0x5592("0x63c"));for(let t=0;t<3;t++){const m=c[a0_0x5592("0x433")](t),g=a[a0_0x5592("0xb05")][t];if(g){const v=g[0],y=m["getChildAt"](0);y["visible"]=!!v,v&&(y["skin"]="lobby/itembg/"+(v-1)+a0_0x5592("0x525")),m["getChildAt"](1)["skin"]=g[1],m[a0_0x5592("0x433")](2)[a0_0x5592("0x143")]=1==a["id"],m[a0_0x5592("0x433")](3)[a0_0x5592("0x1e3")]=g[2]}else m["visible"]=!1}const d=e[a0_0x5592("0xab9")](a0_0x5592("0x365"));d["offAllCaller"](d),this[a0_0x5592("0x68")](d,()=>{this[a0_0x5592("0x4d7")](a["id"],e[a0_0x5592("0x2bf")]||1)},d);const u=d[a0_0x5592("0xab9")](a0_0x5592("0xdd"));e[a0_0x5592("0xab9")](a0_0x5592("0xa2b"))["text"]=N["AdventurePage"][2],e["getChildByName"](a0_0x5592("0x64a"))[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](a[a0_0x5592("0x2e8")][e[a0_0x5592("0x2bf")]-1]),e[a0_0x5592("0xab9")](a0_0x5592("0x9db"))[a0_0x5592("0x1e3")]=N["AdventurePage"][3],e["getChildByName"](a0_0x5592("0xadb"))["text"]=N["AdventurePage"][4];const f=e["getChildByName"]("numLab");let p=H[a0_0x5592("0x97f")][a["id"]];"number"!=typeof p&&(p=a[a0_0x5592("0x919")]),f[a0_0x5592("0x1e3")]=N[a0_0x5592("0x44c")][5]+" "+p+"/"+a[a0_0x5592("0x919")],u[a0_0x5592("0x1e3")]=p>0?N[a0_0x5592("0x44c")][11]:N[a0_0x5592("0x44c")][12]}[a0_0x5592("0x4d7")](t,e){const a=1==t?Q[a0_0x5592("0x6a4")]:Q["goldAdv"];if(H["advData"][t]<=0)return void C["gameSDK"][a0_0x5592("0x9c4")][a0_0x5592("0x8e3")](C[a0_0x5592("0x933")],()=>{"number"!=typeof H["advData"][t]&&(H[a0_0x5592("0x97f")][t]=0),H[a0_0x5592("0x97f")][t]++,this["initPage"]()});const i=a[e];if(i){const r=O[a0_0x5592("0x7de")](Object[a0_0x5592("0x36c")](i)["length"]-1,0),s=i[Object[a0_0x5592("0x36c")](i)[r]];window[a0_0x5592("0xea")]=s,R[a0_0x5592("0xcf")](a0_0x5592("0x1fb"))}}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x908")](t){const e=this[a0_0x5592("0x8a0")];t==this["tabIndex"]?(e[a0_0x5592("0x143")]=!0,this[a0_0x5592("0x60c")]()):e[a0_0x5592("0x143")]=!1}[a0_0x5592("0x60c")](){}["onDestroy"](){}}class $e extends Laya["Script"]{constructor(){super(),this[a0_0x5592("0x857")]=0,this["itemScale"]=1,this["space"]=25,this[a0_0x5592("0x136")]=null,this[a0_0x5592("0xa31")]=0,this[a0_0x5592("0x519")]=0,this[a0_0x5592("0xa80")]=[],this[a0_0x5592("0x681")]=null}[a0_0x5592("0x880")](){const i=this[a0_0x5592("0x8a0")];this[a0_0x5592("0xa31")]=i["y"];const t=i[a0_0x5592("0x433")](0),r=i["x"],s=this[a0_0x5592("0x559")],n=t[a0_0x5592("0x481")],o=t["x"];this["selectDistance"]=(n+s)/2;let e=this[a0_0x5592("0x8a0")][a0_0x5592("0xae6")];const a=n*e+s*(e-1);i["width"]=a;for(let a=0;a<e;a++){let t=-a*(n+s)+r;this["itemX"][a]=t;const l=i[a0_0x5592("0x433")](a);l["x"]=o+a*(n+s);let e=a==this[a0_0x5592("0x857")]?1:this[a0_0x5592("0x292")];l["scaleX"]=e,l[a0_0x5592("0xa37")]=e}this[a0_0x5592("0x681")]=new Laya[a0_0x5592("0x1e6")](i["x"]-a+n,i["y"],a-n,0),i["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x4a7")],this,this[a0_0x5592("0x1a4")]),i["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x5ed")],this,this[a0_0x5592("0x566")]),i["on"](Laya["Event"]["MOUSE_UP"],this,this["onBoxMoveEnd"]),i["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0xa61")],this,this[a0_0x5592("0xa0")]),i["x"]=this[a0_0x5592("0xa80")][this[a0_0x5592("0x857")]]}[a0_0x5592("0x1a4")](){console[a0_0x5592("0xad6")]("插屏");this[a0_0x5592("0x8a0")][a0_0x5592("0x480")](this[a0_0x5592("0x681")],!1,100)}[a0_0x5592("0x566")](){const o=this[a0_0x5592("0x8a0")];if(o["x"]>=this["itemX"][0]){const e=o[a0_0x5592("0x433")](0);let t=1-Math["abs"](o["x"]-this[a0_0x5592("0xa80")][0])/100*.15;return e["scaleX"]=t,e[a0_0x5592("0xa37")]=t,void(e[a0_0x5592("0x433")](0)["getChildAt"](0)[a0_0x5592("0x14")]=(t-this["itemScale"])/(1-this["itemScale"]))}if(o["x"]<=this[a0_0x5592("0xa80")][this[a0_0x5592("0xa80")][a0_0x5592("0xb0e")]-1]){const a=o[a0_0x5592("0x433")](this[a0_0x5592("0xa80")][a0_0x5592("0xb0e")]-1);let t=1-Math[a0_0x5592("0x45c")](this[a0_0x5592("0xa80")][this["itemX"]["length"]-1]-o["x"])/100*.15;return a[a0_0x5592("0x2f")]=t,a["scaleY"]=t,void(a[a0_0x5592("0x433")](0)[a0_0x5592("0x433")](0)["alpha"]=(t-this[a0_0x5592("0x292")])/(1-this[a0_0x5592("0x292")]))}for(let n=0;n<this[a0_0x5592("0xa80")][a0_0x5592("0xb0e")];n++){let a=o["getChildAt"](n),i=o["getChildAt"](n+1),r=this[a0_0x5592("0xa80")][n],s=this["itemX"][n+1];if(o["x"]>=s&&o["x"]<=r){let t=1-Math[a0_0x5592("0x45c")](o["x"]-r)/Math[a0_0x5592("0x45c")](r-s)*(1-this["itemScale"]),e=this[a0_0x5592("0x292")]+1-t;a["scaleX"]=t,a[a0_0x5592("0xa37")]=t,i[a0_0x5592("0x2f")]=e,i[a0_0x5592("0xa37")]=e;const l=a["getChildAt"](0)[a0_0x5592("0x433")](0),_=i[a0_0x5592("0x433")](0)[a0_0x5592("0x433")](0);l[a0_0x5592("0x14")]=(t-this[a0_0x5592("0x292")])/(1-this[a0_0x5592("0x292")]),_["alpha"]=(e-this[a0_0x5592("0x292")])/(1-this[a0_0x5592("0x292")]),n++}else{a[a0_0x5592("0x2f")]=this[a0_0x5592("0x292")],a[a0_0x5592("0xa37")]=this["itemScale"],a[a0_0x5592("0x433")](0)[a0_0x5592("0x433")](0)[a0_0x5592("0x14")]=0}}}["onBoxMoveEnd"](){const a=this[a0_0x5592("0x8a0")];if(a["x"]>=this[a0_0x5592("0xa80")][0]){const e=a[a0_0x5592("0x433")](0);Laya[a0_0x5592("0x6eb")]["to"](e,{scaleX:1,scaleY:1},100);const i=e["getChildAt"](0)[a0_0x5592("0x433")](0);return Laya[a0_0x5592("0x6eb")]["to"](i,{alpha:1},100),this[a0_0x5592("0x857")]=0,void(this["moveEndHandle"]&&this["moveEndHandle"](this["selectIndex"]))}if(a["x"]<=this[a0_0x5592("0xa80")][this[a0_0x5592("0xa80")][a0_0x5592("0xb0e")]-1]){const r=a[a0_0x5592("0x433")](this["itemX"][a0_0x5592("0xb0e")]-1);Laya[a0_0x5592("0x6eb")]["to"](r,{scaleX:1,scaleY:1},100);const s=r[a0_0x5592("0x433")](0)["getChildAt"](0);return Laya[a0_0x5592("0x6eb")]["to"](s,{alpha:1},100),this[a0_0x5592("0x857")]=this["itemX"][a0_0x5592("0xb0e")]-1,void(this[a0_0x5592("0x136")]&&this["moveEndHandle"](this[a0_0x5592("0x857")]))}Laya["SoundManager"]["playSound"](at["ClickSou"]),a[a0_0x5592("0x844")]();for(let t=0;t<this[a0_0x5592("0xa80")]["length"];t++){const n=this[a0_0x5592("0xa80")][t];if(a["x"]!=n&&Math["abs"](a["x"]-n)<=this[a0_0x5592("0x519")]){Laya[a0_0x5592("0x6eb")]["to"](a,{x:n},100),this[a0_0x5592("0x857")]=t;break}}let t=this[a0_0x5592("0x8a0")][a0_0x5592("0xae6")];for(let e=0;e<t;e++){const o=a["getChildAt"](e);let t=e==this["selectIndex"]?1:this["itemScale"];Laya[a0_0x5592("0x6eb")]["to"](o,{scaleX:t,scaleY:t},100);const l=o[a0_0x5592("0x433")](0)["getChildAt"](0);Laya["Tween"]["to"](l,{alpha:(t-this[a0_0x5592("0x292")])/(1-this[a0_0x5592("0x292")])},100)}this[a0_0x5592("0x136")]&&this[a0_0x5592("0x136")](this[a0_0x5592("0x857")])}[a0_0x5592("0x4fd")](){const t=this["owner"];t[a0_0x5592("0x1d0")](Laya[a0_0x5592("0x690")][a0_0x5592("0x4a7")],this,this[a0_0x5592("0x1a4")]),t[a0_0x5592("0x1d0")](Laya[a0_0x5592("0x690")]["MOUSE_MOVE"],this,this[a0_0x5592("0x566")]),t[a0_0x5592("0x1d0")](Laya["Event"][a0_0x5592("0x7d0")],this,this[a0_0x5592("0xa0")]),t[a0_0x5592("0x1d0")](Laya[a0_0x5592("0x690")][a0_0x5592("0xa61")],this,this[a0_0x5592("0xa0")])}["onUpdate"](){const t=this[a0_0x5592("0x8a0")];t["y"]!=this[a0_0x5592("0xa31")]&&(t["y"]=this[a0_0x5592("0xa31")])}}class ta extends t{constructor(){super(),this[a0_0x5592("0x355")]=null,this[a0_0x5592("0x0")]=null,this[a0_0x5592("0x92f")]=null,this["speed"]=1,this["trail"]=null,this[a0_0x5592("0x1f9")]=100}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set["norV3"](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e["rotation"]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){const a=this[a0_0x5592("0x8a0")];if(this[a0_0x5592("0x24e")]){const i=new Laya["Sprite3D"],r=this[a0_0x5592("0x761")](this["trail"]),s=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](r);i[a0_0x5592("0x231")](s);let t=this[a0_0x5592("0xce")](),e=a["localToGlobal"](new Laya["Point"](a[a0_0x5592("0x481")]/2,a[a0_0x5592("0x1c1")]/2));this[a0_0x5592("0x92f")][a0_0x5592("0x4ae")]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](e["x"],e["y"]),t),i[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=t,this["trail3D"]=i,this["target"][a0_0x5592("0x98d")][a0_0x5592("0x231")](i)}R["on"](a0_0x5592("0x954"),this,()=>{this["owner"]["removeSelf"]()})}[a0_0x5592("0x4fd")](){super[a0_0x5592("0x4fd")](),this["trail3D"]&&this["trail3D"]["removeSelf"](),this[a0_0x5592("0x77a")](this["owner"])}[a0_0x5592("0x5b4")](){let t=this[a0_0x5592("0x92f")][a0_0x5592("0x747")];const e=this["owner"];let a=Laya[a0_0x5592("0x6ec")]["delta"]*this["speed"];e[a0_0x5592("0x3b0")]=-(180-Math[a0_0x5592("0x23d")](this[a0_0x5592("0x918")]["x"],-this[a0_0x5592("0x918")]["y"])/Math["PI"]*180);const i=a*this["norV3"]["x"],r=a*this[a0_0x5592("0x918")]["y"];e["x"]+=i,e["y"]+=r,this[a0_0x5592("0x0")]&&this[a0_0x5592("0x0")]["transform"]&&this[a0_0x5592("0x0")][a0_0x5592("0x48b")][a0_0x5592("0x2dc")](this["getVec3"](i/t,0,r/t)),(e["x"]<=0-this[a0_0x5592("0x1f9")]||e["x"]>=667+this[a0_0x5592("0x1f9")]||e["y"]<=0-this["deltaY"]||e["y"]>=700+this[a0_0x5592("0x1f9")])&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}}class ea extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this["titleLab"]=null,this[a0_0x5592("0x32c")]=null,this[a0_0x5592("0x1c")]=null,this[a0_0x5592("0x311")]=null,this["scene3D"]=null,this[a0_0x5592("0x4ae")]=null,this[a0_0x5592("0x747")]=null}[a0_0x5592("0x880")](){const t=this[a0_0x5592("0x8a0")][a0_0x5592("0x231")](new Laya[a0_0x5592("0x569")]);this["scene3D"]=t;const e=new Laya[a0_0x5592("0x12e")](0,.1,100);this[a0_0x5592("0x4ae")]=e,t[a0_0x5592("0x231")](e),e["clearFlag"]=Laya[a0_0x5592("0x7d3")][a0_0x5592("0x3f7")],e[a0_0x5592("0x72e")]=new Laya[a0_0x5592("0x2a5")](0,0,0,0),e[a0_0x5592("0x48b")][a0_0x5592("0xa5f")](new Laya[a0_0x5592("0x97c")](-90,0,0),!1,!1),e[a0_0x5592("0x798")]=!0,e["orthographicVerticalSize"]=10;const a=t[a0_0x5592("0x231")](new Laya["DirectionLight"]);a[a0_0x5592("0x318")]=new Laya[a0_0x5592("0x97c")](1,1,1),a[a0_0x5592("0x48b")][a0_0x5592("0x49c")]["setForward"](new Laya[a0_0x5592("0x97c")](1,-1,0)),this[a0_0x5592("0x68")](this["closeBtn"],()=>{super["onDisable"](),R[a0_0x5592("0xcf")](a0_0x5592("0x954")),this[a0_0x5592("0x98d")][a0_0x5592("0x64b")](!0),this[a0_0x5592("0x98d")]=null,this["closeDialog"](this)},this);const i=new Laya[a0_0x5592("0x73d")];i["graphics"][a0_0x5592("0x95f")](0,50,667,650,""),this[a0_0x5592("0x1c")][a0_0x5592("0x2ed")][a0_0x5592("0x344")]=i}[a0_0x5592("0x971")](t){let e=this["getVec3"](),a=this[a0_0x5592("0xce")]();this[a0_0x5592("0x4ae")][a0_0x5592("0x7a8")](this["getVec3"](360,640),e),this[a0_0x5592("0x4ae")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](360,641),a),this[a0_0x5592("0x747")]=1/(a["z"]-e["z"]),Laya[a0_0x5592("0x6ec")]["once"](200,this,()=>{this[a0_0x5592("0xa90")](t)})}[a0_0x5592("0xa90")](t){3==t&&(this[a0_0x5592("0x1c")]["y"]-=110);const e=3==t?690:800,a=Z[a0_0x5592("0x555")][t],i=Z[a0_0x5592("0x204")][t];this[a0_0x5592("0x338")][a0_0x5592("0x1e3")]=a["name"],this[a0_0x5592("0x32c")][a0_0x5592("0x1e3")]=N["HangarItem"][t]["replace"]("\n"," "),this[a0_0x5592("0x1c")][a0_0x5592("0x8fa")]=a0_0x5592("0x30")+t+a0_0x5592("0x525");const r=this[a0_0x5592("0x311")];let s=r[a0_0x5592("0xae6")];for(let a=0;a<s;a++){const u=r[a0_0x5592("0x433")](a),f=u[a0_0x5592("0x433")](2);let t=i[a]/10,e=27+203*t;Laya[a0_0x5592("0x6eb")]["to"](u,{value:t},200),Laya[a0_0x5592("0x6eb")]["to"](f,{x:e},200)}const n=it;let o=this[a0_0x5592("0xce")]();this["camera3D"]["convertScreenCoordToOrthographicCoord"](this[a0_0x5592("0xce")](360,e),o);const l=Laya[a0_0x5592("0x745")][a0_0x5592("0x2f3")](this["getRes"](y[t]));l[a0_0x5592("0x48b")][a0_0x5592("0x93a")]=o,l["transform"][a0_0x5592("0x49b")]=this[a0_0x5592("0xce")](1.55,1.55,1.55);const _=new j;_[a0_0x5592("0x96d")]=1.4,_[a0_0x5592("0xaf0")]=.25;const h=l[a0_0x5592("0x433")](0),x=this["getRes"](n[t]);_[a0_0x5592("0x8a7")]=x,Laya[a0_0x5592("0xa6f")][a0_0x5592("0x6e9")](a0_0x5592("0x351"),Laya[a0_0x5592("0x4d5")]["create"](null,function(t){_[a0_0x5592("0x5bc")]=t,h[a0_0x5592("0x6bc")][a0_0x5592("0x88c")]=_})),this["scene3D"]["addChild"](l);const c=this[a0_0x5592("0x761")](b["PlaneTrackModel"]),d=Laya[a0_0x5592("0xab3")][a0_0x5592("0x2f3")](c);d[a0_0x5592("0x48b")]["position"]=this[a0_0x5592("0xce")](0,0,.1),l[a0_0x5592("0x231")](d),this["initPlaneBullet"](t)}[a0_0x5592("0x4fd")](){super["onDisable"](),ba["Lobby"][a0_0x5592("0x81e")](),this[a0_0x5592("0x98d")]&&this[a0_0x5592("0x98d")][a0_0x5592("0x64b")](!0)}[a0_0x5592("0x22c")](t){switch(t){case 2:this[a0_0x5592("0x5ee")]();break;case 3:this["initPlane3Bullet"]();break;case 4:this[a0_0x5592("0x405")]();break;case 6:this["initPlane6Bullet"]()}}[a0_0x5592("0x5ee")](){Z[a0_0x5592("0x555")][2][a0_0x5592("0x58")];const e=[10,-40,-40,10],a=[-50,-15,15,50],i=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x2f8")]),r=this[a0_0x5592("0xce")](this[a0_0x5592("0x1c")]["x"],this[a0_0x5592("0x1c")]["y"]);for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const s=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x2f8")],i);if(!s)return;s[a0_0x5592("0x25d")]=null,s[a0_0x5592("0xab9")](a0_0x5592("0x7e2"))[a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")]["LIGHTER"],s[a0_0x5592("0xab9")](a0_0x5592("0xa60"))[a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")],s[a0_0x5592("0x6f7")](r["x"]+a[t],r["y"]+e[t]),this["planeBg"][a0_0x5592("0x2ed")][a0_0x5592("0x231")](s)}}[a0_0x5592("0x54d")](){const s=Z[a0_0x5592("0x555")][3],n=(s[a0_0x5592("0x58")],[30,40,50,60,120,130,140,150,-150,-140,-130,-120,-60,-50,-40,-30]),o=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["Player3Bullet"]),l=this[a0_0x5592("0xce")](this[a0_0x5592("0x1c")]["x"],this["planeBg"]["y"]);Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](400,this,()=>{for(let a=0;a<n[a0_0x5592("0xb0e")];a++){const i=this[a0_0x5592("0x4c9")](a0_0x5592("0x287")+w[a0_0x5592("0x4f3")][a0_0x5592("0x670")],o);if(!i)return;i["_components"]=null;let t=i[a0_0x5592("0x751")](ta);t||(t=i["addComponent"](ta));const r=Math[a0_0x5592("0xc0")](n[a]/180*Math["PI"]);let e=new Laya["Vector3"](0,0,0);Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](new Laya[a0_0x5592("0x97c")](1,-r,0),e),e["x"]*=Math["abs"](n[a])>90?-1:1,t[a0_0x5592("0x918")]=e,t[a0_0x5592("0x92f")]=this,t["speed"]=.5*s["bulletsp"],t["trail"]=b[a0_0x5592("0x92d")],t[a0_0x5592("0x1f9")]=-70,i[a0_0x5592("0x225")]=i[a0_0x5592("0x7ea")]=0,i["pos"](l["x"]+0,l["y"]+0),this[a0_0x5592("0x1c")][a0_0x5592("0x2ed")][a0_0x5592("0x231")](i)}})}[a0_0x5592("0x405")](){const i=Z["planes"][4],r=(i["shooting"],[this[a0_0x5592("0xce")](-.26,-.97),this[a0_0x5592("0xce")](-.09,-1),this[a0_0x5592("0xce")](.09,-1),this[a0_0x5592("0xce")](.26,-.97)]),s=Ct[4][3],n=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x6f8")]),o=this[a0_0x5592("0xce")](this["planeBg"]["x"],this["planeBg"]["y"]);Laya["timer"][a0_0x5592("0x861")](400,this,()=>{for(let e=0;e<s[a0_0x5592("0xb0e")];e++){const a=this[a0_0x5592("0x4c9")]("Lobby://"+w[a0_0x5592("0x4f3")][a0_0x5592("0x6f8")],n);if(!a)return;a[a0_0x5592("0x25d")]=null;let t=a[a0_0x5592("0x751")](ta);t||(t=a[a0_0x5592("0x2a6")](ta)),t[a0_0x5592("0x918")]=r[e],t["target"]=this,t[a0_0x5592("0x5b6")]=.8*i[a0_0x5592("0x277")],t["trail"]=b[a0_0x5592("0x5fb")],t[a0_0x5592("0x1f9")]=-50,a["size"](0,0),a[a0_0x5592("0x6f7")](o["x"]+s[e],o["y"]+30),this["planeBg"]["parent"][a0_0x5592("0x231")](a)}})}["initPlane6Bullet"](){const i=Z[a0_0x5592("0x555")][6],r=(i[a0_0x5592("0x58")],[181,181,180,180,127,127,126,126,76,76,74,74,16,16,20,20,-13,-13,-40]),s=[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1],n=Ct[6][3],o=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["Player6Bullet"]),l=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["Player6Bullet1"]),_=this["getVec3"](this[a0_0x5592("0x1c")]["x"],this[a0_0x5592("0x1c")]["y"]);Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](400,this,()=>{for(let a=0;a<n["length"];a++){let t=null;if(!(t=s[a]?this["open"]("Lobby://"+w[a0_0x5592("0x4f3")]["Player6Bullet1"],l):this[a0_0x5592("0x4c9")](a0_0x5592("0x287")+w[a0_0x5592("0x4f3")][a0_0x5592("0x479")],o)))return;t[a0_0x5592("0x25d")]=null;let e=t[a0_0x5592("0x751")](ta);e||(e=t[a0_0x5592("0x2a6")](ta)),e["norV3"]=this[a0_0x5592("0xce")](0,-1),e[a0_0x5592("0x5b6")]=.5*i[a0_0x5592("0x277")],e[a0_0x5592("0x24e")]=null,e[a0_0x5592("0x92f")]=this,e[a0_0x5592("0x1f9")]=100,t["pos"](_["x"]+n[a],_["y"]+r[a]),this[a0_0x5592("0x1c")][a0_0x5592("0x2ed")][a0_0x5592("0x231")](t)}})}}class aa extends t{constructor(){super(),this[a0_0x5592("0x381")]=null,this[a0_0x5592("0x7f8")]=null,this[a0_0x5592("0x5eb")]=null,this[a0_0x5592("0x8c1")]=null,this[a0_0x5592("0x60f")]=null,this[a0_0x5592("0x5dc")]=null,this["endBtn"]=null,this[a0_0x5592("0x3ce")]=null,this[a0_0x5592("0x662")]=null,this[a0_0x5592("0x65f")]=null,this[a0_0x5592("0x3cf")]=null,this[a0_0x5592("0xef")]=null,this[a0_0x5592("0xa2")]=null,this["nomBtn"]=null,this[a0_0x5592("0x19e")]=null,this[a0_0x5592("0x74f")]=null,this[a0_0x5592("0x28e")]=null,this[a0_0x5592("0x48e")]=null,this[a0_0x5592("0x504")]=null,this[a0_0x5592("0x59f")]=null,this[a0_0x5592("0x828")]=null,this[a0_0x5592("0x6c")]=0}[a0_0x5592("0x880")](){const i=this["horNode"][a0_0x5592("0xae6")],r=()=>{const e=I[a0_0x5592("0x9d5")]-1+15*(I[a0_0x5592("0x5d4")]-1);for(let t=0;t<i;t++){const a=t<15?z[a0_0x5592("0x558")][t+1]:z["udchapter"][t-15+1];this[a0_0x5592("0x3cf")][a0_0x5592("0x433")](t)[a0_0x5592("0x433")](0)[a0_0x5592("0x433")](1)[a0_0x5592("0x143")]=!a,this[a0_0x5592("0x3cf")][a0_0x5592("0x433")](t)["getChildAt"](0)["getChildAt"](0)["alpha"]=e==t?1:0}},s=this[a0_0x5592("0x3cf")][a0_0x5592("0x751")]($e);s[a0_0x5592("0x857")]=I[a0_0x5592("0x9d5")]-1+15*(I[a0_0x5592("0x5d4")]-1);const h=U[a0_0x5592("0x791")],x=U["difChapters"];s[a0_0x5592("0x136")]=t=>{const e=t>14?t-15+1:t+1,a=t>14?2:1;this[a0_0x5592("0x74f")]["text"]=e+"";const i=a,r=1==i?h[e-1]:x[e-1],s=1==a?"":"("+N[a0_0x5592("0x2dd")][9]+")";if(this[a0_0x5592("0x28e")][a0_0x5592("0x1e3")]=r["name"]+s,this[a0_0x5592("0x48e")]["text"]=r["fight"]+" ",this[a0_0x5592("0x7f8")][a0_0x5592("0x143")]=!(!I[a0_0x5592("0x94c")]||I[a0_0x5592("0x94c")][a0_0x5592("0x9d5")]!=e||I[a0_0x5592("0x94c")][a0_0x5592("0x5d4")]!=i),1==i){this["chaLevLab"][a0_0x5592("0x1e3")]=z["uchapter"][e]+"/"+r["level"];const n=!!z[a0_0x5592("0x9d5")][e],o=!!z[a0_0x5592("0x558")][e];this[a0_0x5592("0x48e")][a0_0x5592("0x2ed")][a0_0x5592("0x2ed")][a0_0x5592("0x143")]=o,this[a0_0x5592("0x504")]["parent"][a0_0x5592("0x143")]=o,this[a0_0x5592("0x381")]["visible"]=o,this[a0_0x5592("0x28e")]["visible"]=o,n?(this[a0_0x5592("0x59f")][a0_0x5592("0x1e3")]=a0_0x5592("0x9ac"),this[a0_0x5592("0x504")][a0_0x5592("0x143")]=!1):(this[a0_0x5592("0x59f")][a0_0x5592("0x1e3")]=N[a0_0x5592("0x2dd")][3],this[a0_0x5592("0x504")][a0_0x5592("0x143")]=!0)}else if(2==i){this[a0_0x5592("0x504")][a0_0x5592("0x1e3")]=z[a0_0x5592("0xb00")][e]+"/"+r[a0_0x5592("0x188")];const l=!!z[a0_0x5592("0x3bb")][e],_=!!z[a0_0x5592("0xb00")][e];this[a0_0x5592("0x48e")][a0_0x5592("0x2ed")]["parent"][a0_0x5592("0x143")]=_,this[a0_0x5592("0x504")][a0_0x5592("0x2ed")][a0_0x5592("0x143")]=_,this[a0_0x5592("0x381")][a0_0x5592("0x143")]=_,this[a0_0x5592("0x28e")][a0_0x5592("0x143")]=_,l?(this["chaLevTitLab"][a0_0x5592("0x1e3")]=a0_0x5592("0x9ac"),this[a0_0x5592("0x504")][a0_0x5592("0x143")]=!1):(this["chaLevTitLab"][a0_0x5592("0x1e3")]=N[a0_0x5592("0x2dd")][3],this[a0_0x5592("0x504")][a0_0x5592("0x143")]=!0)}I[a0_0x5592("0x9d5")]=e,I["diff"]=i,c(!0)};let e=!1;const t=()=>{if(e)return;e=!0;const t=()=>{this[a0_0x5592("0x63a")]()[a0_0x5592("0x284")](()=>{I[a0_0x5592("0x94c")]=null,Laya[a0_0x5592("0x876")]["open"](a0_0x5592("0x9de"))})};I[a0_0x5592("0x94c")]?dt[a0_0x5592("0x9f9")]({title:N[a0_0x5592("0x238")][12],desc:N[a0_0x5592("0x238")][22],sure:t,close:()=>{e=!1}},g["instance"]["Dialog"]):t()};this[a0_0x5592("0x68")](this[a0_0x5592("0x381")],()=>{z[a0_0x5592("0x9d5")][2]?(this["showBtn"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x111")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")])):t()},this),R["on"](a0_0x5592("0x3b1"),this,()=>{t()}),this[a0_0x5592("0x68")](this[a0_0x5592("0x7f8")],()=>{e||(e=!0,this[a0_0x5592("0x63a")]()[a0_0x5592("0x284")](()=>{window[a0_0x5592("0x716")]=!0,Laya["Scene"][a0_0x5592("0x4c9")](a0_0x5592("0x9de"))}))},this),R["on"](v[a0_0x5592("0x88")],this,this[a0_0x5592("0x908")]),R["on"](a0_0x5592("0x1fb"),this,()=>{e||(e=!0,this[a0_0x5592("0x63a")]()[a0_0x5592("0x284")](()=>{Laya["Scene"][a0_0x5592("0x4c9")](a0_0x5592("0x9de"))}))}),this["setClick"](this[a0_0x5592("0x5eb")],()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x704")],g[a0_0x5592("0x173")]["Dialog"])},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x8c1")],()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x84e")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")])},this),this[a0_0x5592("0x68")](this["achBtn"],()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0xa66")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")])},this),this["setClick"](this[a0_0x5592("0x5dc")],()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x4f6")],g["instance"][a0_0x5592("0x72c")])},this),this[a0_0x5592("0x68")](this["endBtn"],()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")]["EndlessDialog"],g[a0_0x5592("0x173")][a0_0x5592("0x72c")])},this),this[a0_0x5592("0x68")](this["showBtn"],()=>{T(a0_0x5592("0x20d"),"");const e=this["nid"];if(!e)return;const t=[];t[a0_0x5592("0x626")](b[a0_0x5592("0x418")]),t[a0_0x5592("0x626")](y[e]),3==e&&t[a0_0x5592("0x779")](b["DaoDan"])<0&&t[a0_0x5592("0x626")](b[a0_0x5592("0x92d")]),4==e&&t[a0_0x5592("0x779")](b["Main4"])<0&&t["push"](b["Main4"]);let a=0;const i=()=>{this[a0_0x5592("0x165")](w["lobby"][a0_0x5592("0x2a0")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t[a0_0x5592("0x751")](ea)["setData"](e)})};S[a0_0x5592("0x1eb")](t)[a0_0x5592("0x284")](()=>{console[a0_0x5592("0xad6")](a0_0x5592("0x529")),2==++a&&i()}),Laya[a0_0x5592("0x80c")]["create"](a0_0x5592("0x1b3"),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{console["log"]("load prefab complete..."),2==++a&&i()}),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,t=>{}))},this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1e3,this,()=>{this[a0_0x5592("0x63a")]()}),this[a0_0x5592("0xef")][a0_0x5592("0x143")]=!1;const c=t=>{const e=I["diff"];this["modeBtn"][a0_0x5592("0x1e3")]=1==e?N[a0_0x5592("0x2dd")][4]:N["BattlePage"][9];const a=g[a0_0x5592("0x173")];a["norNode"]&&(a[a0_0x5592("0x49")][a0_0x5592("0x143")]=1==e),a[a0_0x5592("0xa1e")]&&(a[a0_0x5592("0xa1e")]["visible"]=1!=e),t||r(),t||s[a0_0x5592("0x136")](s[a0_0x5592("0x857")])};c(),R["on"]("lobby.addbg",this,c);const a=K["achievements"],n={};for(const o in a){const l=a[o];n[l["type"]]||(n[l[a0_0x5592("0xb2e")]]=[]),n[l["type"]][a0_0x5592("0x626")](l)}if(Ze[a0_0x5592("0x317")](a0_0x5592("0x77f"),()=>{let e=!1;for(const a in n){const i=n[a];let t=M[a0_0x5592("0x783")](a);const r=i[t[a0_0x5592("0x58d")]-1]?i[t[a0_0x5592("0x58d")]-1]:i[i[a0_0x5592("0xb0e")]-1];if(t[a0_0x5592("0x919")]>=r[a0_0x5592("0x919")]&&t[a0_0x5592("0x58d")]<=r["index"])return e=!0}return e}),Ze[a0_0x5592("0x317")]("BattlePage.dailyBtn",()=>{let t=!1;const e=M["dailys"];for(const a in e){const i=e[a],r=K["dailyTasks"][a];if(i[a0_0x5592("0x919")]>=r[a0_0x5592("0x919")]&&!i[a0_0x5592("0x6a8")])return t=!0}return t}),Ze[a0_0x5592("0x317")](a0_0x5592("0x812"),()=>{let t=!1;const e=Date["now"](),a=M[a0_0x5592("0x65")];for(const i in a){const r=a[i];if(r&&r[a0_0x5592("0x6f2")]<=e&&!r[a0_0x5592("0x6a8")]&&r[a0_0x5592("0x99e")])return t=!0}return t}),H[a0_0x5592("0x96c")]){if(!window[a0_0x5592("0x950")]){const _=H["signinData"];!K[a0_0x5592("0x197")]&&_["num"]<7&&!O[a0_0x5592("0x98b")](_[a0_0x5592("0x5ce")],Date[a0_0x5592("0x24")]())&&(K["isSignin"]=!0,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x50b")],g["instance"][a0_0x5592("0x72c")])}))}}else H["guide2"]=1,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this[a0_0x5592("0x7e3")](a0_0x5592("0x4"))[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")]("prefab/GuidanceDialog.json",t);g[a0_0x5592("0x173")][a0_0x5592("0x1b1")]["addChild"](e),Nt["init"](e,[{x:360,y:910,radius:60}]),T("新手引导",a0_0x5592("0x72f"))})});window["__global.data__"]=null,R["on"]("UnlockChapterDialog.close",this,this[a0_0x5592("0x107")][a0_0x5592("0xa2f")](this)),this[a0_0x5592("0x107")]()}[a0_0x5592("0x107")](){const t=this[a0_0x5592("0x3ce")],e=H[a0_0x5592("0x555")];if(z[a0_0x5592("0x9d5")][13]||e["indexOf"](6)>-1)t["visible"]=!1;else{t["visible"]=!0;const a=[1,2,3,4,6],i=[];for(let t=0;t<e["length"];t++){const n=e[t];5!=n&&i[a0_0x5592("0x626")](n)}const r=Math[a0_0x5592("0x7e6")](...i),s=a[a[a0_0x5592("0x779")](r)+1];R["event"](v[a0_0x5592("0x793")],[s,t[a0_0x5592("0xab9")](a0_0x5592("0x8fa"))]),t[a0_0x5592("0xab9")]("bg")[a0_0x5592("0x433")](0)[a0_0x5592("0x1e3")]=N[a0_0x5592("0x48")][s]||"",this[a0_0x5592("0x828")]=s}}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this)}[a0_0x5592("0x908")](t){const e=this[a0_0x5592("0x8a0")];t==this[a0_0x5592("0x6c")]?(e[a0_0x5592("0x143")]=!0,this["onEnActive"](),this["midNode"]["x"]=-360,Laya[a0_0x5592("0x6eb")]["to"](this[a0_0x5592("0x65f")],{x:360},300)):e[a0_0x5592("0x143")]=!1}["onEnActive"](){this["initShowNode"]()}[a0_0x5592("0x63a")](){const r=[],t=w["battle"];for(const e in t){const a=t[e];r[a0_0x5592("0x626")](a)}const s=[];s[a0_0x5592("0x626")](b[a0_0x5592("0x418")]),s[a0_0x5592("0x626")](b[a0_0x5592("0x4e9")]),s[a0_0x5592("0x626")](y[I["id"]]),3==I["id"]&&s[a0_0x5592("0x779")](b[a0_0x5592("0x92d")])<0&&s[a0_0x5592("0x626")](b[a0_0x5592("0x92d")]),4==I["id"]&&s[a0_0x5592("0x779")](b[a0_0x5592("0x5fb")])<0&&s[a0_0x5592("0x626")](b[a0_0x5592("0x5fb")]);let n=null;if(z["uchapter"][3]&&I[a0_0x5592("0x9d5")]>0){const i=[1,2,3,4,5,6],o=I["id"];i[a0_0x5592("0x3c8")](i["indexOf"](o),1),n=i[O["getRandom"](4,0)],L[a0_0x5592("0xa1a")]=n,s[a0_0x5592("0x626")](y[n]),3==n&&s[a0_0x5592("0x779")](b[a0_0x5592("0x92d")])<0&&s[a0_0x5592("0x626")](b[a0_0x5592("0x92d")]),4==n&&s[a0_0x5592("0x779")](b[a0_0x5592("0x5fb")])<0&&s["push"](b[a0_0x5592("0x5fb")])}return new Promise((e,t)=>{let a=0,i=0;s["length"]&&i++,r[a0_0x5592("0xb0e")]&&i++,S[a0_0x5592("0x1eb")](s)["then"](()=>{console[a0_0x5592("0xad6")]("load model complete..."),++a==i&&e()}),Laya["loader"][a0_0x5592("0x2ab")]("prefab/battle/merge.json",Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{window[a0_0x5592("0xaae")]["hideLoad"]();console["log"](a0_0x5592("0x7f7")),S[a0_0x5592("0x90e")](I["id"]),n&&S[a0_0x5592("0x90e")](n);const t=E[a0_0x5592("0x199")][I["chapter"]+""+I[a0_0x5592("0x5d4")]];t&&S[a0_0x5592("0x50")](t[1]),++a==i&&e()}),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,t=>{}))})}[a0_0x5592("0x8ec")](){}}class ia extends t{constructor(){super(),this[a0_0x5592("0x730")]=null,this[a0_0x5592("0x806")]=null}static[a0_0x5592("0xf4")](e){xt[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x269")],g["instance"][a0_0x5592("0x72c")],t=>{t[a0_0x5592("0x751")](ia)[a0_0x5592("0x971")](e)},!1,!0)}[a0_0x5592("0x971")](d){if(d["length"]>=5)this["itemList"]["width"]=562,this["itemList"][a0_0x5592("0x577")]=5;else{const t=d[a0_0x5592("0xb0e")];this[a0_0x5592("0x806")][a0_0x5592("0x481")]=106*t+8*(t-1),this[a0_0x5592("0x806")][a0_0x5592("0x577")]=t}this["itemList"][a0_0x5592("0xa26")]="",this[a0_0x5592("0x806")][a0_0x5592("0x85f")]=Laya["Handler"][a0_0x5592("0x2ab")](this,(t,c)=>{(t=>{const e=t[a0_0x5592("0xab9")](a0_0x5592("0x6ca")),a=t[a0_0x5592("0xab9")](a0_0x5592("0x7c")),i=t[a0_0x5592("0xab9")]("icon"),r=t[a0_0x5592("0xab9")](a0_0x5592("0x919")),s=t[a0_0x5592("0xab9")](a0_0x5592("0x749")),n=d[c],o=n[2],l=n[0],_=n[1],h=!!(l>=1011&&l<=1016);null!=o?(e[a0_0x5592("0x143")]=!0,e[a0_0x5592("0x8fa")]="lobby/itembg/"+(o>3?3:o)+a0_0x5592("0x525")):e[a0_0x5592("0x143")]=!1,a["visible"]=h,i[a0_0x5592("0x8fa")]="lobby/equicon/"+l+a0_0x5592("0x525"),r[a0_0x5592("0x1e3")]=O["formatNumber"](_),r[a0_0x5592("0x143")]=!(_<=1);const x=L[a0_0x5592("0x65a")][l];s[a0_0x5592("0x1e3")]=x?x[a0_0x5592("0xa1c")]:""})(t)},null,!1),this[a0_0x5592("0x806")][a0_0x5592("0xa3f")]=d}[a0_0x5592("0x880")](){this["setClick"](this[a0_0x5592("0x730")],()=>{this[a0_0x5592("0x6a6")](this)},this)}["onDisable"](){Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this)}}class ra extends t{constructor(){super(),this[a0_0x5592("0x338")]=null,this[a0_0x5592("0x730")]=null,this["adBtn"]=null,this[a0_0x5592("0x806")]=null}static[a0_0x5592("0xf4")](e,a){xt[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")]["CommonRewardAdDialog"],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t[a0_0x5592("0x751")](ra)[a0_0x5592("0x971")](e,a)},!1,!0)}[a0_0x5592("0x971")](x,t,e){if(x[a0_0x5592("0xb0e")]>=5)this["itemList"]["width"]=562;else{const i=x["length"];this[a0_0x5592("0x806")]["width"]=106*i+8*(i-1)}this[a0_0x5592("0x338")][a0_0x5592("0x1e3")]=t||N[a0_0x5592("0x4b9")][8],this[a0_0x5592("0x806")][a0_0x5592("0xa26")]="",this[a0_0x5592("0x806")]["renderHandler"]=Laya["Handler"][a0_0x5592("0x2ab")](this,(t,h)=>{(t=>{const e=t[a0_0x5592("0xab9")](a0_0x5592("0x6ca")),a=t[a0_0x5592("0xab9")](a0_0x5592("0x7c")),i=t["getChildByName"](a0_0x5592("0x601")),r=t["getChildByName"](a0_0x5592("0x919")),s=x[h],n=s[2],o=s[0],l=s[1],_=!!(o>=1011&&o<=1016);null!=n?(e[a0_0x5592("0x143")]=!0,e[a0_0x5592("0x8fa")]="lobby/itembg/"+(n>3?3:n)+a0_0x5592("0x525")):e[a0_0x5592("0x143")]=!1,a[a0_0x5592("0x143")]=_,i[a0_0x5592("0x8fa")]="lobby/equicon/"+o+a0_0x5592("0x525"),r[a0_0x5592("0x1e3")]="x"+O[a0_0x5592("0x77")](l),r[a0_0x5592("0x143")]=!(l<=1)})(t)},null,!1),this[a0_0x5592("0x806")]["array"]=x;const a=this[a0_0x5592("0x5cf")];a[a0_0x5592("0x5c7")](a),this[a0_0x5592("0x68")](a,()=>{C["gameSDK"][a0_0x5592("0x9c4")]["showRewardVideoAd"](e||C[a0_0x5592("0x933")],()=>{this[a0_0x5592("0x6a6")](this),z[a0_0x5592("0xa8a")](x),ia[a0_0x5592("0xf4")](x)})},a)}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this[a0_0x5592("0x730")],()=>{this[a0_0x5592("0x6a6")](this)},this)}["onDisable"](){Laya["Tween"][a0_0x5592("0x61b")](this),Laya["timer"][a0_0x5592("0x61b")](this)}}class sa extends t{constructor(){super(),this[a0_0x5592("0x273")]=null}static["Tips"](e,t){xt[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x81b")],t||g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t["getComponent"](sa)[a0_0x5592("0x971")](e)},!0)}[a0_0x5592("0x971")](t){const e=this["owner"];this["tipLab"][a0_0x5592("0x1e3")]=t,Laya["timer"][a0_0x5592("0x9b1")](1,this,()=>{e["width"]=this[a0_0x5592("0x273")][a0_0x5592("0x481")]+30,e["height"]=this["tipLab"]["height"]+25})}[a0_0x5592("0x880")](){const t=this["owner"];t[a0_0x5592("0x14")]=0;const e=t["y"]-200;Laya["Tween"]["to"](t,{alpha:1},300,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](1200,this,()=>{Laya["Tween"]["to"](t,{alpha:0,y:e},300,Laya[a0_0x5592("0x4ec")]["circIn"],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{t[a0_0x5592("0xaa4")]()}))})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6ec")]["clearAll"](this)}}class na extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x338")]=null,this[a0_0x5592("0x4cd")]=null,this[a0_0x5592("0x712")]=null,this[a0_0x5592("0x5ae")]=null,this[a0_0x5592("0x815")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this["closeBtn"],()=>{this["closeDialog"](this),this[a0_0x5592("0x815")]?this[a0_0x5592("0x815")]():(R[a0_0x5592("0xcf")](a0_0x5592("0x65b")),!H["guide3"]&&z["chapter"][1]&&(H[a0_0x5592("0xe")]=1,Laya[a0_0x5592("0x6ec")]["once"](200,this,()=>{this[a0_0x5592("0x7e3")]("prefab/GuidanceDialog.json")[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")]("prefab/GuidanceDialog.json",t);g[a0_0x5592("0x173")][a0_0x5592("0x1b1")][a0_0x5592("0x231")](e);const a=Laya[a0_0x5592("0x43c")]["height"]-52;Nt[a0_0x5592("0x75b")](e,[{x:217,y:a,radius:40,arrow:2},{x:623,y:752,radius:40},{x:362,y:a,radius:40,arrow:2},{x:360,y:910,radius:60}]),T("新手引导",a0_0x5592("0xa6d"))})})))},this)}[a0_0x5592("0x971")](e,t){if(a0_0x5592("0x9d5")==t){this["titleLab"]["text"]=N[a0_0x5592("0x238")][10];const a=e[0];this[a0_0x5592("0x5ae")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x712")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x712")][a0_0x5592("0x8fa")]=a0_0x5592("0x16f")+a+a0_0x5592("0x525");const i=2==I[a0_0x5592("0x5d4")]?"["+N[a0_0x5592("0x2dd")][9]+"]":"";this[a0_0x5592("0x4cd")][a0_0x5592("0x1e3")]=U[a0_0x5592("0x791")][a-1][a0_0x5592("0x749")]+i,e[1]&&(this[a0_0x5592("0x815")]=()=>{this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x375")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t[a0_0x5592("0x751")](na)["setData"](e,a0_0x5592("0x42a"))})})}else if(a0_0x5592("0x42a")==t){this[a0_0x5592("0x338")][a0_0x5592("0x1e3")]=N[a0_0x5592("0x238")][11];const r=e[1];this["icoIma"]["visible"]=!1,this[a0_0x5592("0x5ae")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x5ae")][a0_0x5592("0xacb")]["clear"](),R[a0_0x5592("0xcf")](v[a0_0x5592("0x793")],[r,this[a0_0x5592("0x5ae")]]);const s=Z["planes"][r];this[a0_0x5592("0x4cd")][a0_0x5592("0x1e3")]=s[a0_0x5592("0x749")]}}[a0_0x5592("0x4fd")](){}}class oa extends t{constructor(){super(),this[a0_0x5592("0x1cd")]=null,this[a0_0x5592("0x4db")]=null,this[a0_0x5592("0x20")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this)}["setData"](i){const t=i[0],e=L[a0_0x5592("0x65a")][t];this["desc"]["text"]=e[a0_0x5592("0xa1c")],this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")][a0_0x5592("0xa83")])["then"](t=>{const e=this["open"](w["lobby"][a0_0x5592("0xa83")],t),a=e[a0_0x5592("0x751")](la);a["touched"]=!1,a[a0_0x5592("0xb38")](i),e["pos"](53,53),this[a0_0x5592("0x1cd")][a0_0x5592("0x231")](e)})}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}}class la extends t{constructor(){super(),this[a0_0x5592("0x372")]=null,this[a0_0x5592("0x4dd")]=null,this["iconIma"]=null,this[a0_0x5592("0x7ce")]=null,this[a0_0x5592("0x65c")]=null,this[a0_0x5592("0x185")]=null,this[a0_0x5592("0x893")]=null,this["lockNode"]=null,this[a0_0x5592("0x2fc")]=null,this[a0_0x5592("0x95a")]=[],this[a0_0x5592("0xb03")]=-1,this["sid"]=-1,this["types"]=null,this[a0_0x5592("0xa5e")]=null,this[a0_0x5592("0xa11")]=!0,this["touHandle"]=null}[a0_0x5592("0x880")](){const e=g[a0_0x5592("0x173")];this[a0_0x5592("0x8a0")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x68")](this[a0_0x5592("0x8a0")],()=>{if(this[a0_0x5592("0xa5e")]&&this[a0_0x5592("0xa11")]){const t=this[a0_0x5592("0xa5e")][0];!!(t>=1011&&t<=1016)?this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")]["EquMatDesDialog"],e["Dialog"],t=>{t[a0_0x5592("0x751")](oa)["setData"](this[a0_0x5592("0xa5e")])},!1,!0):this[a0_0x5592("0x7d7")]&&this["touHandle"](this[a0_0x5592("0x2fc")])}},this,null,!0),R["on"](v[a0_0x5592("0x85c")],this,(t,e,a)=>{if("EquSymDialog"==this["types"])if(this[a0_0x5592("0x95a")]=t,this[a0_0x5592("0xb03")]=e,this[a0_0x5592("0x69d")]=a,t[a0_0x5592("0x779")](this["cind"])>-1?this[a0_0x5592("0x893")][a0_0x5592("0x143")]=!0:this[a0_0x5592("0x893")]["visible"]=!1,t["length"]){if(this[a0_0x5592("0xa5e")]){this["cdata"][0]==a&&this[a0_0x5592("0xa5e")][1]==e?(this["lockNode"][a0_0x5592("0x143")]=!1,this["touched"]=!0):(this[a0_0x5592("0x548")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0xa11")]=!1)}}else this[a0_0x5592("0x548")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0xa11")]=!0})}[a0_0x5592("0xb38")](e,t,a){null!=t&&(this[a0_0x5592("0x2fc")]=t),this[a0_0x5592("0xa5e")]=e;const i=e[0],r=e[1],s=e[2],n=e[4]||1;let o=k[a0_0x5592("0x906")][i];const l=!!(i>=1011&&i<=1016);l&&(o=L[a0_0x5592("0x65a")][i]);const _=r-3,h={1:N[a0_0x5592("0x7ec")][1],2:N[a0_0x5592("0x7ec")][2],3:N[a0_0x5592("0x7ec")][3],4:N[a0_0x5592("0x7ec")][4],5:N[a0_0x5592("0x7ec")][5],6:N["EquipmentPage"][6]};if(this[a0_0x5592("0x372")][a0_0x5592("0x143")]=!l,l||(this["bg1Ima"][a0_0x5592("0x8fa")]="lobby/itembg/"+(_>0?3:r)+".png"),this[a0_0x5592("0x4dd")][a0_0x5592("0x143")]=l,this[a0_0x5592("0x162")][a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+i+a0_0x5592("0x525"),l){let t=o[a0_0x5592("0x749")];a&&(t=o[a0_0x5592("0x749")][a0_0x5592("0xa51")](a0_0x5592("0x412"),"")["replace"](a0_0x5592("0x47"),"")),this[a0_0x5592("0x7ce")][a0_0x5592("0x1e3")]=t}else this[a0_0x5592("0x7ce")][a0_0x5592("0x1e3")]=h[o[a0_0x5592("0xb2e")]];if(this["numLab"][a0_0x5592("0x143")]=!(!n||1==n),this[a0_0x5592("0x65c")]["text"]=n+"",this[a0_0x5592("0x185")]["visible"]=!l,this[a0_0x5592("0x185")][a0_0x5592("0x1e3")]=a0_0x5592("0x23b")+s,"EquSymDialog"==this[a0_0x5592("0xaa9")]){let t=!!(this[a0_0x5592("0x95a")][a0_0x5592("0x779")](this[a0_0x5592("0x2fc")])>-1);if(this[a0_0x5592("0x893")]["visible"]=t,this["sind"]["length"]){e[0]==this["sid"]&&e[1]==this[a0_0x5592("0xb03")]?(this[a0_0x5592("0x548")]["visible"]=!1,this[a0_0x5592("0xa11")]=!0):(this["lockNode"][a0_0x5592("0x143")]=!0,this[a0_0x5592("0xa11")]=!1)}else this["lockNode"]["visible"]=!1,this[a0_0x5592("0xa11")]=!0}}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}["onDestroy"](){}}class _a extends Laya[a0_0x5592("0x310")]{constructor(){super(),this[a0_0x5592("0x6b")](124,124)}[a0_0x5592("0x880")](){}[a0_0x5592("0x4fd")](){}}class ha extends Laya[a0_0x5592("0x310")]{constructor(){super(),this[a0_0x5592("0x6b")](151,74)}[a0_0x5592("0x880")](){}[a0_0x5592("0x4fd")](){}}class xa extends t{constructor(){super(),this["title1"]=null,this[a0_0x5592("0x4c3")]=null,this[a0_0x5592("0x893")]=null,this[a0_0x5592("0x1ba")]=0,this["cid"]=1}[a0_0x5592("0x880")](){this["setClick"](this["owner"],()=>{this[a0_0x5592("0x1ba")]!=this[a0_0x5592("0xa47")]&&R[a0_0x5592("0xcf")](v[a0_0x5592("0xb39")],this[a0_0x5592("0x1ba")])},this,null,!0),R["on"](v[a0_0x5592("0xb39")],this,t=>{this[a0_0x5592("0x893")]["visible"]=t==this["pid"],this[a0_0x5592("0xa47")]=t})}[a0_0x5592("0x971")](t,e,a){this[a0_0x5592("0x1ba")]=t,this[a0_0x5592("0xa47")]=e,this[a0_0x5592("0x651")]["text"]=a,this[a0_0x5592("0x4c3")][a0_0x5592("0x1e3")]=a,this[a0_0x5592("0x893")][a0_0x5592("0x143")]=t==e}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}}class ca extends t{constructor(){super(),this["closeBtn"]=null,this[a0_0x5592("0x9a6")]=null,this["nameLab"]=null,this[a0_0x5592("0x186")]=null,this[a0_0x5592("0x712")]=null,this[a0_0x5592("0x5c0")]=null,this[a0_0x5592("0x234")]=null,this[a0_0x5592("0xa5e")]=null,this[a0_0x5592("0x97a")]=null,this["parcmp"]=null}["onEnable"](){this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x9a6")],()=>{if(!this["cdata"])return;const t=this[a0_0x5592("0xa5e")][0],e=this[a0_0x5592("0xa5e")][2],a=1010+t-10*Math[a0_0x5592("0x6fc")](t/10);let i=0,r=0;for(let t=1;t<e;t++)i+=G[a0_0x5592("0x77d")](t,2),r+=G["getGold"](t,3);if(i=Math["floor"](.75*i),a0_0x5592("0x7f3")==this[a0_0x5592("0x97a")]){const s=O["findKey"](z[a0_0x5592("0x667")],this["cdata"]);z[a0_0x5592("0x667")][s][2]=1}else{const n=O[a0_0x5592("0x383")](z["hequips"],this[a0_0x5592("0xa5e")]);z[a0_0x5592("0x333")][n][2]=1}z["updateItem"]([[101,i],[a,r]]),R[a0_0x5592("0xcf")](v[a0_0x5592("0xfb")]),this[a0_0x5592("0x6a6")](this),this[a0_0x5592("0x509")]&&this[a0_0x5592("0x6a6")](this[a0_0x5592("0x509")]),ia[a0_0x5592("0xf4")]([[101,i],[a,r]])},this)}[a0_0x5592("0x971")](t){this["cdata"]=t;const e=t[0],a=t[1],i=t[2],r=k[a0_0x5592("0x906")][e];this["nameLab"]["text"]=r["name"],this["icoIma"][a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+e+".png",this[a0_0x5592("0x186")][a0_0x5592("0x1e3")]=a0_0x5592("0x70c")+i+"/"+(a0_0x5592("0x993")==typeof r["maxlv"]?r["maxlv"]:r[a0_0x5592("0x9e8")][a0_0x5592("0xae0")]("|")[a-1]);const s=this[a0_0x5592("0x5c0")]["getChildAt"](1);let n=0,o=0;for(let t=1;t<i;t++)n+=G[a0_0x5592("0x77d")](t,2),o+=G[a0_0x5592("0x77d")](t,3);n=Math["floor"](.75*n),s[a0_0x5592("0x1e3")]="x"+O[a0_0x5592("0x77")](n);const l=this["mateNode"][a0_0x5592("0x433")](2),_=this[a0_0x5592("0x234")]["getChildAt"](1),h=1010+e-10*Math[a0_0x5592("0x6fc")](e/10);_[a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+h+a0_0x5592("0x525"),l[a0_0x5592("0x1e3")]="x"+O[a0_0x5592("0x77")](o)}["onDisable"](){}}class da extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x9a6")]=null,this[a0_0x5592("0x148")]=null,this[a0_0x5592("0xc4")]=null,this[a0_0x5592("0xdd")]=null,this["itemBg"]=null,this[a0_0x5592("0xad8")]=null,this[a0_0x5592("0x895")]=null,this[a0_0x5592("0x742")]=null,this["fattsNode"]=null,this["thusNode"]=null,this[a0_0x5592("0xb06")]=null,this[a0_0x5592("0x882")]=null,this[a0_0x5592("0xbc")]=null,this[a0_0x5592("0x22a")]=null,this[a0_0x5592("0xa5e")]=null,this[a0_0x5592("0xad7")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this["closeBtn"],()=>{this["closeDialog"](this)},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x9a6")],()=>{this[a0_0x5592("0xa5e")]&&this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")][a0_0x5592("0x721")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{const e=t["getComponent"](ca);e[a0_0x5592("0x97a")]=this[a0_0x5592("0xad7")],e["parcmp"]=this,e[a0_0x5592("0x971")](this[a0_0x5592("0xa5e")])})},this),this["setClick"](this["equBtn"],()=>{if(!this["cdata"])return;const t=this["cdata"][0],e=k[a0_0x5592("0x906")][t]["type"];if(a0_0x5592("0x7f3")==this[a0_0x5592("0xad7")])z[a0_0x5592("0x667")][e]=null,z[a0_0x5592("0x333")][Date["now"]()]=this[a0_0x5592("0xa5e")],sa["Tips"](N[a0_0x5592("0x8b")][3]["replace"]("%s",k[a0_0x5592("0x906")][t]["name"]));else{const a=O[a0_0x5592("0x383")](z[a0_0x5592("0x333")],this[a0_0x5592("0xa5e")]);delete z[a0_0x5592("0x333")][a],z["equips"][e]&&(z["hequips"][Date[a0_0x5592("0x24")]()]=z["equips"][e]),z[a0_0x5592("0x667")][e]=this[a0_0x5592("0xa5e")],sa[a0_0x5592("0x8b")](N[a0_0x5592("0x8b")][4]["replace"]("%s",k["equs"][t][a0_0x5592("0x749")]))}R[a0_0x5592("0xcf")](v[a0_0x5592("0xfb")]),this["closeDialog"](this)},this),this[a0_0x5592("0x68")](this[a0_0x5592("0xc4")],()=>{if(!this[a0_0x5592("0xa5e")])return;const t=this[a0_0x5592("0xa5e")][0],e=this[a0_0x5592("0xa5e")][2],a=G[a0_0x5592("0x77d")](e,2),i=1010+t-10*Math[a0_0x5592("0x6fc")](t/10),r=G[a0_0x5592("0x77d")](e,3);if(z["coin"]>=a&&z[a0_0x5592("0x65a")][i]>=r){if(z[a0_0x5592("0xa8a")]([[101,-a],[i,-r]]),a0_0x5592("0x7f3")==this[a0_0x5592("0xad7")]){const s=O[a0_0x5592("0x383")](z["equips"],this[a0_0x5592("0xa5e")]);z[a0_0x5592("0x667")][s][2]++,this[a0_0x5592("0x971")](z[a0_0x5592("0x667")][s])}else{const n=O["findKey"](z["hequips"],this[a0_0x5592("0xa5e")]);z[a0_0x5592("0x333")][n][2]++,this[a0_0x5592("0x971")](z[a0_0x5592("0x333")][n])}R[a0_0x5592("0xcf")](v[a0_0x5592("0xfb")]),sa[a0_0x5592("0x8b")](N[a0_0x5592("0x8b")][5][a0_0x5592("0xa51")]("%s",k[a0_0x5592("0x906")][t][a0_0x5592("0x749")])),R[a0_0x5592("0xcf")](a0_0x5592("0x9e5"))}else sa[a0_0x5592("0x8b")](N["Tips"][6])},this),R["on"](v[a0_0x5592("0xfb")],this,()=>{this[a0_0x5592("0x971")](this[a0_0x5592("0xa5e")])})}[a0_0x5592("0x971")](t){this[a0_0x5592("0xa5e")]=t;const e=t[0],a=t[1],i=t[2];this[a0_0x5592("0x9a6")][a0_0x5592("0x143")]=!(i<=1);const r=k[a0_0x5592("0x906")][e];this["title"][a0_0x5592("0x1e3")]=r[a0_0x5592("0x749")],this["itemBg"][a0_0x5592("0x8fa")]=a0_0x5592("0x27b")+(a>3?3:a)+a0_0x5592("0x525"),this[a0_0x5592("0xad8")][a0_0x5592("0x8fa")]="lobby/equicon/"+e+a0_0x5592("0x525"),this[a0_0x5592("0x895")][a0_0x5592("0x1e3")]="Lv"+i+"/"+(a0_0x5592("0x993")==typeof r[a0_0x5592("0x9e8")]?r["maxlv"]:r[a0_0x5592("0x9e8")][a0_0x5592("0xae0")]("|")[a-1]);const s=N[a0_0x5592("0x619")],n=q[a0_0x5592("0x9d2")](e,a,i);for(let t=1;t<3;t++){const y=this[a0_0x5592("0x742")][a0_0x5592("0x433")](t),T=y[a0_0x5592("0x433")](0),E=n[t-1];E?(y[a0_0x5592("0x8fa")]=a0_0x5592("0x5a")+E[0]+".png",T["text"]=s[E[0]]["replace"]("&",O["formatNumber"](E[1]))):y[a0_0x5592("0x143")]=!1}const o=t[3];for(let t=1;t<5;t++){const b=this["fattsNode"][a0_0x5592("0x433")](t),S=b[a0_0x5592("0x433")](0),C=o[t-1];C?(b[a0_0x5592("0x8fa")]=a0_0x5592("0x5a")+(C[0]-1e3<7?C[0]-1e3:6)+a0_0x5592("0x525"),S[a0_0x5592("0x1e3")]=k[a0_0x5592("0xa89")][C[0]]["name"][a0_0x5592("0xa51")]("s",O[a0_0x5592("0x77")](C[1]))):b[a0_0x5592("0x143")]=!1}const l=r[a0_0x5592("0x6c0")],_=z[a0_0x5592("0x667")];for(const R in k[a0_0x5592("0x906")]){const A=k[a0_0x5592("0x906")][R];if(A[a0_0x5592("0x6c0")]==l){const L=this["thusNode"][a0_0x5592("0x433")](A[a0_0x5592("0xb2e")]);L[a0_0x5592("0x1e3")]=""+A[a0_0x5592("0x749")];const I=!!_[A[a0_0x5592("0xb2e")]]&&k["equs"][_[A[a0_0x5592("0xb2e")]][0]][a0_0x5592("0x6c0")]==l;L["color"]=I?a0_0x5592("0xa9b"):a0_0x5592("0x76f")}}let h=0;for(const M in _){const D=_[M];if(D){k[a0_0x5592("0x906")][D[0]][a0_0x5592("0x6c0")]==l&&h++}}const x=q[a0_0x5592("0x47c")][l];if(x)for(let t=0;t<3;t++){const w=this[a0_0x5592("0xb06")]["getChildAt"](t),P=x[2*(t+1)];P?(w["text"]="("+2*(t+1)+") "+N[a0_0x5592("0x9c0")][l]+"\n"+N[a0_0x5592("0x4f8")][P[0]],w[a0_0x5592("0x318")]=h>=2*(t+1)?a0_0x5592("0xa9b"):a0_0x5592("0x76f")):this[a0_0x5592("0x882")]["getChildAt"](t)[a0_0x5592("0x143")]=!1}else{this["thusAttNode"][a0_0x5592("0x433")](0)["text"]="",this[a0_0x5592("0x882")]["getChildAt"](0)[a0_0x5592("0x143")]=!1,this[a0_0x5592("0x882")]["getChildAt"](1)["visible"]=!1,this["dssNode"][a0_0x5592("0x433")](2)[a0_0x5592("0x143")]=!1}const c=this[a0_0x5592("0x148")][a0_0x5592("0x433")](0);a0_0x5592("0x7f3")==this["itype"]?c["text"]=N["EquOequDialog"][8]:c[a0_0x5592("0x1e3")]=N[a0_0x5592("0x159")][6];const d=this[a0_0x5592("0xbc")][a0_0x5592("0x433")](1),u=G[a0_0x5592("0x77d")](i,2);d["text"]=O["formatNumber"](z[a0_0x5592("0x7e0")])+"/"+O[a0_0x5592("0x77")](u),d[a0_0x5592("0x318")]=z[a0_0x5592("0x7e0")]>=u?"#48ff04":a0_0x5592("0x868");const f=1010+e-10*Math[a0_0x5592("0x6fc")](e/10),p=this["maiNode"]["getChildAt"](1),m=this["maiNode"]["getChildAt"](2);p[a0_0x5592("0x8fa")]="lobby/equicon/"+f+".png";const g=G[a0_0x5592("0x77d")](i,3),v=z[a0_0x5592("0x65a")][f]||0;m[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](v)+"/"+O["formatNumber"](g),m["color"]=v>=g?"#48ff04":"#ff0000"}["onDisable"](){R[a0_0x5592("0x5c7")](this)}}class ua extends t{constructor(){super(),this["plaIma"]=null,this[a0_0x5592("0x291")]=null,this[a0_0x5592("0x202")]=null,this[a0_0x5592("0x8dc")]=null,this[a0_0x5592("0x79e")]=null,this[a0_0x5592("0x806")]=null,this[a0_0x5592("0x1ec")]=null,this[a0_0x5592("0x4e4")]=null,this["tabIndex"]=0,this["selid"]=1,this[a0_0x5592("0x3d")]=[]}["onEnable"](){const t=g[a0_0x5592("0x173")];R["on"](v["OpenPage"],this,this["onOpen"]),this["setClick"](this[a0_0x5592("0x1ec")],()=>{this["openDialog"](w[a0_0x5592("0xb0c")][a0_0x5592("0x794")],t[a0_0x5592("0x72c")])},this),this["setClick"](this[a0_0x5592("0x4e4")],()=>{this[a0_0x5592("0x165")](w["lobby"][a0_0x5592("0x8ff")],t[a0_0x5592("0x72c")],null,!1,!0)},this);const e=z[a0_0x5592("0x333")],a=this[a0_0x5592("0x3d")],x=k[a0_0x5592("0x906")];for(const s in e){const n=e[s],o=n[0],l=x[o]["type"];a[0]||(a[0]=[]),a[1]||(a[1]=[]),a[2]||(a[2]=[]),a[3]||(a[3]=[]),a[4]||(a[4]=[]),a[5]||(a[5]=[]),a[6]||(a[6]=[]),a[0][a0_0x5592("0x626")](n),a[l][a0_0x5592("0x626")](n)}for(let t=0;t<a["length"];t++){a[t][a0_0x5592("0x26f")]((t,e)=>{let a=t[0],i=e[0],r=t[1],s=e[1],n=x[a][a0_0x5592("0xb2e")],o=x[i][a0_0x5592("0xb2e")],l=x[a][a0_0x5592("0x6c0")],_=x[i][a0_0x5592("0x6c0")],h=t[2]||1;return 1e5*s+1e4*o+1e3*_+(e[2]||1)-(1e5*r+1e4*n+1e3*l+h)})}const i=z["items"];for(const _ in i){const h=i[_],c=parseInt(_);c>=1011&&c<=1016&&(a[0]||(a[0]=[]),a[c-1010]||(a[c-1010]=[]),a[0][a0_0x5592("0x626")]([c,0,0,[],h]),a[c-1010][a0_0x5592("0x626")]([c,0,0,[],h]))}this[a0_0x5592("0x8c")]=1,this[a0_0x5592("0x5c1")](this[a0_0x5592("0x8c")]);const r=[[1,a0_0x5592("0x7c9")],[2,N[a0_0x5592("0x7ec")][1]],[3,N["EquipmentPage"][2]],[4,N["EquipmentPage"][3]],[5,N["EquipmentPage"][4]],[6,N[a0_0x5592("0x7ec")][5]],[7,N["EquipmentPage"][6]]];this[a0_0x5592("0x79e")][a0_0x5592("0x447")]=ha,this["togList"][a0_0x5592("0xa26")]="",this["togList"][a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")]["create"](this,(a,e)=>{const i=t=>{t["getComponent"](xa)[a0_0x5592("0x971")](r[e][0],this[a0_0x5592("0x8c")],r[e][1])},t=a[a0_0x5592("0x433")](0);t?i(t):this[a0_0x5592("0x7e3")](w["lobby"][a0_0x5592("0x207")])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x207")],t);a["addChild"](e),i(e)})},null,!1),this["togList"][a0_0x5592("0xa3f")]=r,R["on"](v["EquItemSel"],this,t=>{this[a0_0x5592("0x8c")]=t,this["setItemList"](t)}),this["itemList"]["itemRender"]=_a,this[a0_0x5592("0x806")]["vScrollBarSkin"]="",this[a0_0x5592("0x806")][a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(a,i)=>{const r=t=>{const e=t[a0_0x5592("0x751")](la);e[a0_0x5592("0x7d7")]=()=>{const t=g[a0_0x5592("0x173")];this["openDialog"](w[a0_0x5592("0xb0c")]["EquOequDialog"],t[a0_0x5592("0x72c")],t=>{const e=t[a0_0x5592("0x751")](da);e[a0_0x5592("0xad7")]=a0_0x5592("0x180"),e[a0_0x5592("0x971")](this["itemList"][a0_0x5592("0xa3f")][i])})},e[a0_0x5592("0xb38")](this[a0_0x5592("0x806")][a0_0x5592("0xa3f")][i],void 0,!0)},t=a[a0_0x5592("0x433")](0);t?r(t):this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")][a0_0x5592("0xa83")])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")]["EquMainItem"],t);e[a0_0x5592("0x6f7")](53,53),r(e),a[a0_0x5592("0x231")](e)})},null,!1),R["on"](v["EquSyn"],this,()=>{this[a0_0x5592("0x4d4")]()})}[a0_0x5592("0x5c1")](t){const e=this[a0_0x5592("0x3d")];this["itemList"][a0_0x5592("0xa3f")]=e[t-1]}["initList"](){let t=I[a0_0x5592("0x1fa")],e=I["hp"];I["initPlayer"](),C[a0_0x5592("0x965")][a0_0x5592("0x68d")][a0_0x5592("0x3f4")](I[a0_0x5592("0xa2e")]()),this[a0_0x5592("0x3d")]=[];const a=z[a0_0x5592("0x333")],i=this["heqArr"],x=k[a0_0x5592("0x906")];for(const s in a){const n=a[s],o=n[0],l=x[o]["type"];i[0]||(i[0]=[]),i[1]||(i[1]=[]),i[2]||(i[2]=[]),i[3]||(i[3]=[]),i[4]||(i[4]=[]),i[5]||(i[5]=[]),i[6]||(i[6]=[]),i[0][a0_0x5592("0x626")](n),i[l][a0_0x5592("0x626")](n)}for(let t=0;t<i[a0_0x5592("0xb0e")];t++){i[t][a0_0x5592("0x26f")]((t,e)=>{let a=t[0],i=e[0],r=t[1],s=e[1],n=x[a]["type"],o=x[i]["type"],l=x[a][a0_0x5592("0x6c0")],_=x[i][a0_0x5592("0x6c0")],h=t[2]||1;return 1e5*s+1e4*o+1e3*_+(e[2]||1)-(1e5*r+1e4*n+1e3*l+h)})}const r=z[a0_0x5592("0x65a")];for(const _ in r){const h=r[_],c=parseInt(_);c>=1011&&c<=1016&&(i[0]||(i[0]=[]),i[c-1010]||(i[c-1010]=[]),i[0][a0_0x5592("0x626")]([c,0,0,[],h]),i[c-1010][a0_0x5592("0x626")]([c,0,0,[],h]))}this[a0_0x5592("0x5c1")](this[a0_0x5592("0x8c")]),this["onEnActive"](t,e)}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x908")](t){const e=this[a0_0x5592("0x8a0")];if(t==this[a0_0x5592("0x6c")]){e["visible"]=!0;let t=I["id"];R[a0_0x5592("0xcf")](v[a0_0x5592("0x793")],[t,this[a0_0x5592("0x508")]]),this[a0_0x5592("0x4d4")]()}else e["visible"]=!1}[a0_0x5592("0x8d4")](t,e,a){let i=(a-e)/20,r=e;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](t),this[a0_0x5592("0xaf2")](50,()=>{r+=i,t["text"]=O[a0_0x5592("0x77")](Math[a0_0x5592("0x6fc")](r))+" "},t,20,null,!0,()=>{t[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](a)+" "})}[a0_0x5592("0x60c")](t,e){t?(this[a0_0x5592("0x8d4")](this[a0_0x5592("0x291")],t,I[a0_0x5592("0x1fa")]),this["textAnim"](this[a0_0x5592("0x202")],e,I["hp"])):(this[a0_0x5592("0x291")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](I["attack"])+" ",this[a0_0x5592("0x202")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](I["hp"])+" ");const i=z[a0_0x5592("0x667")];let a=!0;for(const r in i){const s=i[r];s&&(a=!1);const n=this[a0_0x5592("0x8dc")][a0_0x5592("0x433")](parseInt(r)-1),o=n[a0_0x5592("0x433")](1);if(n)if(s&&s[a0_0x5592("0xb0e")])if(o){o[a0_0x5592("0x751")](la)[a0_0x5592("0xb38")](s),o["visible"]=!0}else this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")]["EquMainItem"])[a0_0x5592("0x284")](t=>{const e=this["open"](w[a0_0x5592("0xb0c")][a0_0x5592("0xa83")],t),a=e["getComponent"](la);a[a0_0x5592("0x7d7")]=()=>{const t=g["instance"];this[a0_0x5592("0x165")](w["lobby"]["EquOequDialog"],t[a0_0x5592("0x72c")],t=>{const e=t[a0_0x5592("0x751")](da);e[a0_0x5592("0xad7")]="OnEqu",e["setData"](i[r])})},a[a0_0x5592("0xb38")](s),e[a0_0x5592("0x6f7")](53,53),n[a0_0x5592("0x231")](e)});else o&&(o[a0_0x5592("0x143")]=!1)}this[a0_0x5592("0x1ec")][a0_0x5592("0x143")]=!a,this[a0_0x5592("0x4e4")]["x"]=a?279:383}["onDestroy"](){}}class fa extends Laya[a0_0x5592("0x310")]{constructor(){super(),this[a0_0x5592("0x6b")](203,143)}["onEnable"](){}["onDisable"](){}}const pa=rt;class ma extends t{constructor(){super(),this[a0_0x5592("0x93")]=null,this[a0_0x5592("0x2d1")]=null,this[a0_0x5592("0x893")]=null,this["lockNode"]=null,this[a0_0x5592("0x3a2")]=null,this[a0_0x5592("0x1ba")]=0,this[a0_0x5592("0xa47")]=1}["onEnable"](){this[a0_0x5592("0x68")](this[a0_0x5592("0x8a0")],()=>{if(this["pid"]!=this[a0_0x5592("0xa47")]){R[a0_0x5592("0xcf")](v[a0_0x5592("0x290")],this[a0_0x5592("0x1ba")]);const t=H["unlockPage"][a0_0x5592("0x779")]("plane"+this["pid"]);t>-1&&H[a0_0x5592("0x34")][a0_0x5592("0x3c8")](t,1),this[a0_0x5592("0x3a2")][a0_0x5592("0x143")]=!1}},this,null,!0),R["on"](v[a0_0x5592("0x290")],this,t=>{this[a0_0x5592("0x893")][a0_0x5592("0x143")]=t==this["pid"],this["cid"]=t})}[a0_0x5592("0x971")](t,e){this[a0_0x5592("0x1ba")]=t,this[a0_0x5592("0xa47")]=e,this[a0_0x5592("0x93")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x2d1")]["skin"]=pa[t],this[a0_0x5592("0x893")][a0_0x5592("0x143")]=t==e;const a=H[a0_0x5592("0x555")][a0_0x5592("0x779")](t);this[a0_0x5592("0x548")][a0_0x5592("0x143")]=a<0,this["lockNode"][a0_0x5592("0x143")]&&(this[a0_0x5592("0x548")][a0_0x5592("0xab9")](a0_0x5592("0xdd"))[a0_0x5592("0x1e3")]=N["HangarItem"][t]||"");let i=!1;a>0&&H[a0_0x5592("0x34")][a0_0x5592("0x779")]("plane"+t)>-1&&(i=!0),this[a0_0x5592("0x3a2")][a0_0x5592("0x143")]=i}["onDisable"](){R[a0_0x5592("0x5c7")](this)}}class ga extends t{constructor(){super(),this[a0_0x5592("0x185")]=null,this[a0_0x5592("0x32c")]=null,this[a0_0x5592("0x64a")]=null,this["plaNameLab"]=null,this[a0_0x5592("0xb09")]=null,this[a0_0x5592("0x291")]=null,this[a0_0x5592("0x202")]=null,this[a0_0x5592("0xa6c")]=null,this[a0_0x5592("0x8a3")]=null,this["chooseBtn"]=null,this[a0_0x5592("0x2d1")]=null,this["planeList"]=null,this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x420")]=null,this[a0_0x5592("0x6c")]=0,this[a0_0x5592("0x8c")]=0}[a0_0x5592("0x880")](){let r=I["id"];this[a0_0x5592("0x8c")]=r,this[a0_0x5592("0x93e")](r),this[a0_0x5592("0x20")]&&this[a0_0x5592("0x68")](this["closeBtn"],()=>{R["event"]("UnlockChapterDialog.close"),this["closeDialog"](this)},this),this[a0_0x5592("0x420")]&&this[a0_0x5592("0x68")](this[a0_0x5592("0x420")],()=>{R["event"](a0_0x5592("0x65b")),R["event"](a0_0x5592("0x3b1")),this[a0_0x5592("0x6a6")](this),T(a0_0x5592("0x22d"),I[a0_0x5592("0x9d5")])},this),R["on"](v[a0_0x5592("0x88")],this,this[a0_0x5592("0x908")]);const e=[1,2,3,4,5,6],a=H[a0_0x5592("0x555")],s=[],i=[];for(let t=0;t<e["length"];t++){const l=e[t];a[a0_0x5592("0x779")](l)>-1?s[a0_0x5592("0x626")](l):i[a0_0x5592("0x626")](l)}s["push"][a0_0x5592("0x904")](s,i),this[a0_0x5592("0x62f")][a0_0x5592("0x447")]=fa,this[a0_0x5592("0x62f")]["vScrollBarSkin"]="",this[a0_0x5592("0x62f")][a0_0x5592("0x85f")]=Laya["Handler"][a0_0x5592("0x2ab")](this,(a,i)=>{const t=a[a0_0x5592("0x433")](0);if(t){t[a0_0x5592("0x751")](ma)[a0_0x5592("0x971")](s[i],r)}else this["loadPrefab"](w[a0_0x5592("0xb0c")][a0_0x5592("0x378")])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x378")],t);a[a0_0x5592("0x231")](e),e["getComponent"](ma)["setData"](s[i],r)})},null,!1),this[a0_0x5592("0x62f")][a0_0x5592("0xa3f")]=s,this[a0_0x5592("0x62f")][a0_0x5592("0xa78")](s[a0_0x5592("0x779")](r)),R["on"](v[a0_0x5592("0x290")],this,t=>{this["selid"]=t;const e=I[a0_0x5592("0x1fa")],a=I["hp"],i=I[a0_0x5592("0xa2e")]();this["setPlane"](t,e,a,i),this[a0_0x5592("0x62f")][a0_0x5592("0xa78")](s["indexOf"](t))});const n=this[a0_0x5592("0x64a")][a0_0x5592("0x433")](1),o=this[a0_0x5592("0x291")][a0_0x5592("0x433")](1);n&&(n[a0_0x5592("0x143")]=!1,n["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{n["visible"]=!1})),o&&(o[a0_0x5592("0x143")]=!1,o["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{o[a0_0x5592("0x143")]=!1})),this[a0_0x5592("0x68")](this[a0_0x5592("0xa6c")],()=>{const t=G[a0_0x5592("0x77d")](H[a0_0x5592("0x188")]);if(z[a0_0x5592("0x7e0")]>=t){H[a0_0x5592("0x188")]++,z["updateCoin"](-t);const e=I[a0_0x5592("0x1fa")],a=I["hp"],i=I[a0_0x5592("0xa2e")]();I[a0_0x5592("0x7b3")](),C[a0_0x5592("0x965")][a0_0x5592("0x68d")][a0_0x5592("0x3f4")](I[a0_0x5592("0xa2e")]()),this[a0_0x5592("0x93e")](this[a0_0x5592("0x8c")],e,a,i),R[a0_0x5592("0xcf")](a0_0x5592("0x8ab")),Laya[a0_0x5592("0x262")][a0_0x5592("0x584")](at[a0_0x5592("0x607")]),n&&n[a0_0x5592("0x27")]&&(n[a0_0x5592("0x143")]=!0,n["play"](0,!1)),o&&o[a0_0x5592("0x27")]&&(o[a0_0x5592("0x143")]=!0,o[a0_0x5592("0x590")](0,!1)),T(a0_0x5592("0x5a5"),H[a0_0x5592("0x188")])}else this["openDialog"](w[a0_0x5592("0xb0c")]["CommonRewardAdDialog"],g["instance"]["Dialog"],t=>{t["getComponent"](ra)["setData"]([[A[a0_0x5592("0x5e2")],1e4]],N[a0_0x5592("0x238")][21])})},this),this[a0_0x5592("0x68")](this["chooseBtn"],()=>{I["id"]=this[a0_0x5592("0x8c")];const t=I[a0_0x5592("0x1fa")],e=I["hp"],a=I[a0_0x5592("0xa2e")]();I[a0_0x5592("0x7b3")](),C[a0_0x5592("0x965")][a0_0x5592("0x68d")]["setScoreAsync"](I[a0_0x5592("0xa2e")]()),this[a0_0x5592("0x93e")](this[a0_0x5592("0x8c")],t,e,a),sa[a0_0x5592("0x8b")](N[a0_0x5592("0x8b")][12][a0_0x5592("0xa51")]("%s",Z[a0_0x5592("0x555")][this[a0_0x5592("0x8c")]]["name"]))},this),Ze["Register"](a0_0x5592("0x23f"),()=>{let t=!1;const e=G["getGold"](H["level"]);return z[a0_0x5592("0x7e0")]>=e&&(t=!0),t})}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this);const t=this[a0_0x5592("0x64a")][a0_0x5592("0x433")](1),e=this[a0_0x5592("0x291")][a0_0x5592("0x433")](1);t["offAllCaller"](this),t[a0_0x5592("0x27f")](),e["offAllCaller"](this),e[a0_0x5592("0x27f")]()}[a0_0x5592("0x8d4")](t,e,a){let i=(a-e)/20,r=e;Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](t),this[a0_0x5592("0xaf2")](50,()=>{r+=i,t[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](Math[a0_0x5592("0x6fc")](r))+" ",t[a0_0x5592("0x2d4")]=Math["floor"](r)},t,20,null,!0,()=>{t[a0_0x5592("0x1e3")]=O["formatNumber"](a)+" ",t[a0_0x5592("0x2d4")]=a})}[a0_0x5592("0x93e")](e,a,i,r){const s=Z[a0_0x5592("0x555")][e],n=Z[a0_0x5592("0x204")][e],t=I["id"],o=H["planes"][a0_0x5592("0x779")](e),l={2:2,3:5,4:7,6:13};if(o<0)Laya[a0_0x5592("0x6ec")]["clearAll"](this["powLab"]),Laya[a0_0x5592("0x6ec")]["clearAll"](this[a0_0x5592("0x291")]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this[a0_0x5592("0x202")]),this[a0_0x5592("0x409")][a0_0x5592("0x1e3")]=a0_0x5592("0x4ab"),this[a0_0x5592("0x64a")]["text"]=a0_0x5592("0x4ab"),this["attLab"]["text"]="??? ",this[a0_0x5592("0x202")][a0_0x5592("0x1e3")]=a0_0x5592("0x4ab"),this[a0_0x5592("0x185")][a0_0x5592("0x1e3")]="LV.??? ",this["descLab"][a0_0x5592("0x1e3")]=5==e?N["HangarPage"][10]:N[a0_0x5592("0x793")][9][a0_0x5592("0xa51")]("$",l[e]);else{this[a0_0x5592("0x409")][a0_0x5592("0x1e3")]=s[a0_0x5592("0x749")],this[a0_0x5592("0x32c")][a0_0x5592("0x1e3")]=N["HangarPage"][8];const h=I[a0_0x5592("0x7d")](e);a?this[a0_0x5592("0x8d4")](this[a0_0x5592("0x64a")],this[a0_0x5592("0x64a")][a0_0x5592("0x2d4")]||r,I[a0_0x5592("0x2f0")](h[a0_0x5592("0x1fa")],h["hp"])):this[a0_0x5592("0x64a")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](I[a0_0x5592("0x2f0")](h[a0_0x5592("0x1fa")],h["hp"]))+" ";let t=H[a0_0x5592("0x188")]||1;a?(this[a0_0x5592("0x8d4")](this[a0_0x5592("0x291")],this[a0_0x5592("0x291")][a0_0x5592("0x2d4")]||a,h[a0_0x5592("0x1fa")]),this[a0_0x5592("0x8d4")](this[a0_0x5592("0x202")],this[a0_0x5592("0x202")][a0_0x5592("0x2d4")]||i,h["hp"])):(this[a0_0x5592("0x291")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](h[a0_0x5592("0x1fa")])+" ",this["hpLab"][a0_0x5592("0x1e3")]=O["formatNumber"](h["hp"])+" "),this[a0_0x5592("0x8a3")][a0_0x5592("0x1e3")]=O["formatNumber"](G[a0_0x5592("0x77d")](t)),this[a0_0x5592("0x185")]["text"]=a0_0x5592("0xab0")+t}this[a0_0x5592("0xa6c")][a0_0x5592("0x143")]=o>-1,this[a0_0x5592("0x62c")]["visible"]=o>-1&&t!=e;let _=this[a0_0x5592("0xb09")][a0_0x5592("0xae6")];for(let a=0;a<_;a++){const x=this["propNode"][a0_0x5592("0x433")](a),c=x[a0_0x5592("0x433")](2);let t=n[a]/10,e=27+203*t;Laya[a0_0x5592("0x6eb")]["to"](x,{value:t},200),Laya[a0_0x5592("0x6eb")]["to"](c,{x:e},200)}R["event"](v["HangarPage"],[e,this[a0_0x5592("0x2d1")]])}[a0_0x5592("0x908")](t){const e=this[a0_0x5592("0x8a0")];t==this[a0_0x5592("0x6c")]?(e[a0_0x5592("0x143")]=!0,this["onEnActive"]()):e[a0_0x5592("0x143")]=!1}[a0_0x5592("0x60c")](){this[a0_0x5592("0x93e")](this[a0_0x5592("0x8c")]),this[a0_0x5592("0x3c5")]()}["topAnim"](){const t=this["levLab"][a0_0x5592("0x2ed")];t["y"]=-91.5,Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](t),Laya[a0_0x5592("0x6eb")]["to"](t,{y:-6.5},500,Laya["Ease"][a0_0x5592("0x789")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{Laya["Tween"]["to"](t,{scaleY:.7},100,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x544")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{scaleY:1},1e3,Laya["Ease"][a0_0x5592("0x595")])}))}))}[a0_0x5592("0x8ec")](){}}class va extends t{constructor(){super(),this[a0_0x5592("0x3ed")]=null,this["buyBtn"]=null,this["titLab"]=null,this["descLab"]=null,this[a0_0x5592("0x228")]=null,this[a0_0x5592("0x65c")]=null,this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0xa47")]=0}["onEnable"](){const e=L["shopitems"],s=[],n=[];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];a[a0_0x5592("0x758")]&&s["push"](a),a[a0_0x5592("0x720")]&&n[a0_0x5592("0x626")](a)}const o=()=>{const e=[],a=[];if(1==this[a0_0x5592("0xa47")]||3==this[a0_0x5592("0xa47")]){let t=1==this[a0_0x5592("0xa47")]?s:n;if(t&&t[a0_0x5592("0xb0e")]){const i=t[O[a0_0x5592("0x7de")](t["length"]-1,0)]["item"],r=L[a0_0x5592("0x65a")][i];a[a0_0x5592("0x626")]([i,1]),e[a0_0x5592("0x626")]([r[a0_0x5592("0x4b")],1,r[a0_0x5592("0x621")]])}}else e[a0_0x5592("0x626")]([A[a0_0x5592("0x591")],150]),a[a0_0x5592("0x626")]([A[a0_0x5592("0x591")],150]);z[a0_0x5592("0xa8a")](a),ia[a0_0x5592("0xf4")](e),R[a0_0x5592("0xcf")](a0_0x5592("0x49a"))};this["setClick"](this[a0_0x5592("0x3ed")],()=>{if(!this["cid"])return;const t=2==this[a0_0x5592("0xa47")]?C["DiamondVideoID"]:C[a0_0x5592("0x933")];C[a0_0x5592("0x965")][a0_0x5592("0x9c4")][a0_0x5592("0x8e3")](t,()=>{M["setShopBoxs"](this["cid"]),this["setData"](this[a0_0x5592("0xa47")]),o()})},this),this["setClick"](this[a0_0x5592("0x1a6")],()=>{if(!this[a0_0x5592("0xa47")])return;const t=N[a0_0x5592("0x824")][a0_0x5592("0x452")],e=M[a0_0x5592("0x4b3")],a=t[this[a0_0x5592("0xa47")]],i=e[this[a0_0x5592("0xa47")]];let r=0;i&&(r=i["danum"]);let s=a["price"]+50*r;z["diamond"]>=s?(M[a0_0x5592("0xad3")](this["cid"]),this["setData"](this[a0_0x5592("0xa47")]),z[a0_0x5592("0xa8a")]([[A[a0_0x5592("0x591")],-s]]),o()):sa[a0_0x5592("0x8b")](N["Tips"][13])},this)}["setData"](t){this[a0_0x5592("0xa47")]=t;const e=N[a0_0x5592("0x824")][a0_0x5592("0x452")],a=M[a0_0x5592("0x4b3")],i=e[t],r=a[t];this[a0_0x5592("0x7ce")][a0_0x5592("0x1e3")]=i[a0_0x5592("0xdd")],this["descLab"]["text"]=i["desc"];let s=i["reset"];if(r&&r[a0_0x5592("0x6f4")]){const _=Date[a0_0x5592("0x24")]();s=Math[a0_0x5592("0x6fc")](r[a0_0x5592("0x6f4")]-_)/1e3}const n=O[a0_0x5592("0x814")](s);this[a0_0x5592("0x228")][a0_0x5592("0x1e3")]=N[a0_0x5592("0x4b9")][1]+(this[a0_0x5592("0x55f")](n[0])+":"+this[a0_0x5592("0x55f")](n[1])+":"+this["autoAddZero"](n[2]));let o=i[a0_0x5592("0x910")],l=0;r&&(o=r[a0_0x5592("0x910")],l=r["danum"]),this["numLab"][a0_0x5592("0x1e3")]=N[a0_0x5592("0x4b9")][2]+o,this[a0_0x5592("0x3ed")]["visible"]=!!o,this["buyBtn"][a0_0x5592("0x143")]=!o,2==t&&(this[a0_0x5592("0x1a6")][a0_0x5592("0x143")]=!1),this[a0_0x5592("0x1a6")][a0_0x5592("0xab9")]("tit")[a0_0x5592("0x1e3")]=i[a0_0x5592("0x510")]+50*l+""}["onLongUpdate"](){if(!this[a0_0x5592("0xa47")])return;const t=this["cid"],e=M["shopBoxs"][t],a=N[a0_0x5592("0x824")]["Box"][t][a0_0x5592("0x910")];if(e&&e[a0_0x5592("0x6f4")]){const i=Date[a0_0x5592("0x24")]();if(i>=e["reset"])e["adnum"]=a,e[a0_0x5592("0x63f")]=0,e["reset"]=null,this["setData"](t);else{let t=Math[a0_0x5592("0x6fc")](e[a0_0x5592("0x6f4")]-i)/1e3;const r=O[a0_0x5592("0x814")](t);this[a0_0x5592("0x228")]["text"]=N["Shop"][1]+(this[a0_0x5592("0x55f")](r[0])+":"+this[a0_0x5592("0x55f")](r[1])+":"+this[a0_0x5592("0x55f")](r[2]))}}}[a0_0x5592("0x55f")](t){return t<10?"0"+t:t+""}[a0_0x5592("0x3de")](){this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")],this["timer"]>=1e3&&(this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0xa84")]())}[a0_0x5592("0x4fd")](){}}class ya extends t{constructor(){super(),this[a0_0x5592("0x6fb")]=null,this[a0_0x5592("0x63c")]=null,this["limRewNode"]=null,this[a0_0x5592("0x39c")]=null,this["tabIndex"]=0,this["timer"]=0,this[a0_0x5592("0x1ac")]=null,this["limRewRefTit"]=null,this[a0_0x5592("0x40b")]=null,this[a0_0x5592("0x25b")]=null,this[a0_0x5592("0x9e2")]=null,this[a0_0x5592("0x6d6")]=null,this["limSkiTimLabs"]={}}[a0_0x5592("0x880")](){R["on"](v["OpenPage"],this,this[a0_0x5592("0x908")]),this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x6fb")]["vScrollBarSkin"]=""}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x908")](t){const e=this["owner"];t==this[a0_0x5592("0x6c")]?(e["visible"]=!0,this["onEnActive"]()):e[a0_0x5592("0x143")]=!1}["onEnActive"](){this[a0_0x5592("0x24f")](),this["initLimNode"](),this["onLongUpdate"]()}[a0_0x5592("0x24f")](){const e=this[a0_0x5592("0x63c")],a=e[a0_0x5592("0xae6")],i=[1,2,3];N[a0_0x5592("0x824")][a0_0x5592("0x452")],M[a0_0x5592("0x4b3")];for(let t=0;t<a;t++){const r=i[t];e[a0_0x5592("0x433")](t)[a0_0x5592("0x751")](va)["setData"](r)}}[a0_0x5592("0x6de")](){let t=M[a0_0x5592("0x5c8")];t&&(t["reset"]||(t["reset"]=Date[a0_0x5592("0x24")]()+1e3*N["ShopData"]["Lim"][a0_0x5592("0x44f")]),t[a0_0x5592("0xa9e")]||this["resetLimSkill"](),t[a0_0x5592("0x543")]||this[a0_0x5592("0x321")](),this[a0_0x5592("0x24c")](),this[a0_0x5592("0x237")]())}[a0_0x5592("0x24c")](){let a=M[a0_0x5592("0x5c8")][a0_0x5592("0xa9e")];if(!a)return;const t=this[a0_0x5592("0x39c")],e=t[a0_0x5592("0xab9")](a0_0x5592("0x85e")),i=e[a0_0x5592("0xab9")](a0_0x5592("0xc9")),r=t[a0_0x5592("0xab9")]("num");i[a0_0x5592("0x1e3")]=a[a0_0x5592("0x910")]==N[a0_0x5592("0x824")]["Lim"][a0_0x5592("0x40c")][a0_0x5592("0x910")]?N[a0_0x5592("0x4b9")][3]:N[a0_0x5592("0x4b9")][8],r[a0_0x5592("0x1e3")]=N[a0_0x5592("0x4b9")][2]+a[a0_0x5592("0x910")],this["limSkiRefBtn"]=e,this["limSkiRefTit"]=i,this["limSkiNumTit"]=r,e["offAllCaller"](e),this[a0_0x5592("0x68")](e,()=>{if(a[a0_0x5592("0x910")]<1)return;const t=()=>{const t=()=>{a[a0_0x5592("0x910")]--,this["resetLimSkill"](),this["initSkillNode"]()};a[a0_0x5592("0x910")]!=N[a0_0x5592("0x824")][a0_0x5592("0x686")][a0_0x5592("0x40c")][a0_0x5592("0x910")]?C[a0_0x5592("0x965")]["faceBookAdvertisement"]["showRewardVideoAd"](C["rewardedVideoID"],()=>{t()}):t()};Object["keys"](a[a0_0x5592("0x951")])[a0_0x5592("0xb0e")]?dt["Tip"]({title:N[a0_0x5592("0x238")][12],desc:N["Common"][17],sure:t},g[a0_0x5592("0x173")][a0_0x5592("0x72c")]):t()},e);const s=t[a0_0x5592("0xab9")]("items"),n=a[a0_0x5592("0x53d")];this[a0_0x5592("0x9b4")]={};for(let e=0;e<n[a0_0x5592("0xb0e")];e++){const o=n[e],l=s["getChildAt"](e),_=l["getChildByName"](a0_0x5592("0xc9")),h=l["getChildByName"]("icon"),x=l[a0_0x5592("0xab9")]("timer"),c=l["getChildByName"]("freBtn"),d=l[a0_0x5592("0xab9")](a0_0x5592("0x500")),u=l[a0_0x5592("0xab9")](a0_0x5592("0x9c7")),f=D[a0_0x5592("0x53d")][o];if(_[a0_0x5592("0x1e3")]=f["name"],h[a0_0x5592("0x8fa")]=bt[f["id"]],this[a0_0x5592("0x9b4")][o]=x,a["bskills"][o])c[a0_0x5592("0x143")]=d["visible"]=!1,u["visible"]=!0;else{let t=N[a0_0x5592("0x824")][a0_0x5592("0x686")][a0_0x5592("0x40c")][a0_0x5592("0x6ec")];const p=O[a0_0x5592("0x814")](t),m=this[a0_0x5592("0x55f")](p[0])+":"+this[a0_0x5592("0x55f")](p[1])+":"+this[a0_0x5592("0x55f")](p[2]);x[a0_0x5592("0x1e3")]=m,u[a0_0x5592("0x143")]=!1,c[a0_0x5592("0x143")]=0==e,d[a0_0x5592("0x143")]=0!=e,c["offAllCaller"](c),this["setClick"](c,()=>{C[a0_0x5592("0x965")]["faceBookAdvertisement"][a0_0x5592("0x8e3")](C[a0_0x5592("0x933")],()=>{M[a0_0x5592("0xb0d")](o),this[a0_0x5592("0x24c")](),sa[a0_0x5592("0x8b")](N[a0_0x5592("0x8b")][17])})},c),d[a0_0x5592("0x5c7")](d),this[a0_0x5592("0x68")](d,()=>{let t=N[a0_0x5592("0x824")][a0_0x5592("0x686")]["Skill"][a0_0x5592("0x510")];z[a0_0x5592("0x6e3")]>=t?(z["updateItem"]([[A[a0_0x5592("0x591")],-t]]),M[a0_0x5592("0xb0d")](o),this[a0_0x5592("0x24c")](),sa["Tips"](N[a0_0x5592("0x8b")][17])):sa[a0_0x5592("0x8b")](N["Tips"][13])},d)}}}[a0_0x5592("0x237")](){let a=M[a0_0x5592("0x5c8")][a0_0x5592("0x543")];if(!a)return;const t=this[a0_0x5592("0x710")],e=t[a0_0x5592("0xab9")](a0_0x5592("0x85e")),i=e[a0_0x5592("0xab9")]("tit"),r=t["getChildByName"](a0_0x5592("0x919"));r[a0_0x5592("0x1e3")]=N["Shop"][2]+a[a0_0x5592("0x910")],i[a0_0x5592("0x1e3")]=a["adnum"]==N[a0_0x5592("0x824")][a0_0x5592("0x686")][a0_0x5592("0x96")][a0_0x5592("0x910")]?N[a0_0x5592("0x4b9")][3]:N[a0_0x5592("0x4b9")][8],this[a0_0x5592("0x1ac")]=e,this[a0_0x5592("0x3fa")]=i,this["limRewNumTit"]=r,e["offAllCaller"](e),this[a0_0x5592("0x68")](e,()=>{if(a[a0_0x5592("0x910")]<1)return;const t=()=>{a["adnum"]--,this[a0_0x5592("0x321")](),this[a0_0x5592("0x237")]()};a[a0_0x5592("0x910")]!=N["ShopData"][a0_0x5592("0x686")][a0_0x5592("0x96")][a0_0x5592("0x910")]?C[a0_0x5592("0x965")][a0_0x5592("0x9c4")][a0_0x5592("0x8e3")](C["rewardedVideoID"],()=>{t()}):t()},e);const s=t[a0_0x5592("0xab9")](a0_0x5592("0x65a")),n=a[a0_0x5592("0x6d4")];for(let e=0;e<n["length"];e++){const o=n[e][0],l=n[e][1],_=s[a0_0x5592("0x433")](e),h=_[a0_0x5592("0xab9")](a0_0x5592("0xc9")),x=_[a0_0x5592("0xab9")](a0_0x5592("0x919")),c=_[a0_0x5592("0xab9")](a0_0x5592("0x144")),d=_[a0_0x5592("0xab9")]("diaBtn"),u=_["getChildByName"](a0_0x5592("0x9c7")),f=_[a0_0x5592("0xab9")]("bg")[a0_0x5592("0xab9")](a0_0x5592("0x6ca")),p=_[a0_0x5592("0xab9")]("bg")[a0_0x5592("0xab9")](a0_0x5592("0x7c")),m=_[a0_0x5592("0xab9")]("bg")[a0_0x5592("0xab9")](a0_0x5592("0x601"));let t=L[a0_0x5592("0x65a")][o];const g=!!(o>=1011&&o<=1016);if(h[a0_0x5592("0x1e3")]=t[a0_0x5592("0xa1c")],f[a0_0x5592("0x143")]=!g,p[a0_0x5592("0x143")]=g,g||(f[a0_0x5592("0x8fa")]=a0_0x5592("0x27b")+(t[a0_0x5592("0x621")]>3?3:t[a0_0x5592("0x621")])+a0_0x5592("0x525")),m[a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+(g?o:t["equip"])+".png",x[a0_0x5592("0x1e3")]="x"+l,a[a0_0x5592("0x4b0")][o])c[a0_0x5592("0x143")]=d["visible"]=!1,u[a0_0x5592("0x143")]=!0;else{u["visible"]=!1,c["visible"]=0==e,d[a0_0x5592("0x143")]=0!=e;const v=(t,e)=>{const a=[],i=[],r=L[a0_0x5592("0x65a")][t];i[a0_0x5592("0x626")]([t,e]),g?a["push"]([t,e]):a["push"]([r[a0_0x5592("0x4b")],e,r[a0_0x5592("0x621")]]),z[a0_0x5592("0xa8a")](i),ia[a0_0x5592("0xf4")](a)};c[a0_0x5592("0x5c7")](c),this[a0_0x5592("0x68")](c,()=>{C[a0_0x5592("0x965")][a0_0x5592("0x9c4")][a0_0x5592("0x8e3")](C[a0_0x5592("0x933")],()=>{M["setShopLimsGood"](o),this[a0_0x5592("0x237")](),v(o,l)})},c),d[a0_0x5592("0x5c7")](d),this[a0_0x5592("0x68")](d,()=>{let t=N[a0_0x5592("0x824")][a0_0x5592("0x686")][a0_0x5592("0x96")]["price"];z[a0_0x5592("0x6e3")]>=t?(z[a0_0x5592("0xa8a")]([[A[a0_0x5592("0x591")],-t]]),M[a0_0x5592("0x8f0")](o),this["initGoodNode"](),v(o,l)):sa[a0_0x5592("0x8b")](N[a0_0x5592("0x8b")][13])},d)}}}[a0_0x5592("0x321")](){let t=M[a0_0x5592("0x5c8")];const e=L[a0_0x5592("0x9")],a=[];for(let t=0;t<e["length"];t++){const o=e[t];o[a0_0x5592("0x83")]&&a["push"](o)}const i=[],r=[];for(;i["length"]<4;){const l=O[a0_0x5592("0x7de")](a[a0_0x5592("0xb0e")]-1,0),_=a[l];if(i[a0_0x5592("0x779")](_[a0_0x5592("0x736")])<0){const h=O[a0_0x5592("0x7de")](a[l][a0_0x5592("0x7e6")],a[l][a0_0x5592("0x6bf")]);a[a0_0x5592("0x3c8")](l,1),i["push"](_[a0_0x5592("0x736")]),r[a0_0x5592("0x626")](h)}}const s=[];for(let t=0;t<i["length"];t++){const x=i[t];s[a0_0x5592("0x626")]([x,r[t]])}let n=N[a0_0x5592("0x824")][a0_0x5592("0x686")]["Good"][a0_0x5592("0x910")];t&&t[a0_0x5592("0x543")]&&(n=t[a0_0x5592("0x543")][a0_0x5592("0x910")]),t[a0_0x5592("0x543")]={adnum:n,goods:s,bgoods:{}}}["resetLimSkill"](){let t=M[a0_0x5592("0x5c8")];const e=I[a0_0x5592("0xa16")],a=[];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){if(1026==e[t]||1023==e[t])continue;D["skills"][e[t]]["add"]==m[a0_0x5592("0x52")]&&a["push"](e[t])}let i=N[a0_0x5592("0x824")][a0_0x5592("0x686")][a0_0x5592("0x40c")][a0_0x5592("0x910")];if(t&&t[a0_0x5592("0xa9e")]&&(i=t[a0_0x5592("0xa9e")][a0_0x5592("0x910")]),a[a0_0x5592("0xb0e")]<4)t[a0_0x5592("0xa9e")]={adnum:i,skills:[a[0],a[0],a[0],a[0]],bskills:{}};else{const r=[];for(;r[a0_0x5592("0xb0e")]<4;){const s=O["getRandom"](a[a0_0x5592("0xb0e")]-1,0),n=a[s];r["indexOf"](n)<0&&(a[a0_0x5592("0x3c8")](s,1),r[a0_0x5592("0x626")](n))}t[a0_0x5592("0xa9e")]={adnum:i,skills:r["concat"](),bskills:{}}}}[a0_0x5592("0xa84")](){let e=M[a0_0x5592("0x5c8")];if(e){if(e[a0_0x5592("0x6f4")]){const a=Date[a0_0x5592("0x24")]();if(a>=e[a0_0x5592("0x6f4")])e["skill"]&&(e[a0_0x5592("0xa9e")][a0_0x5592("0x910")]=N["ShopData"][a0_0x5592("0x686")][a0_0x5592("0x40c")][a0_0x5592("0x910")]),e[a0_0x5592("0x543")]&&(e[a0_0x5592("0x543")][a0_0x5592("0x910")]=N[a0_0x5592("0x824")]["Lim"][a0_0x5592("0x96")][a0_0x5592("0x910")]),e["reset"]=a+1e3*N["ShopData"][a0_0x5592("0x686")]["Timer"],this["limRewRefTit"]&&this[a0_0x5592("0x1ac")]&&this[a0_0x5592("0x40b")]&&(this["limRewRefTit"][a0_0x5592("0x1e3")]=N[a0_0x5592("0x4b9")][3],this[a0_0x5592("0x1ac")][a0_0x5592("0xba")]=!1,this["limRewNumTit"][a0_0x5592("0x1e3")]=N[a0_0x5592("0x4b9")][2]+e["good"]["adnum"]),this["limSkiRefTit"]&&this[a0_0x5592("0x25b")]&&this[a0_0x5592("0x6d6")]&&(this["limSkiRefTit"][a0_0x5592("0x1e3")]=N["Shop"][3],this[a0_0x5592("0x25b")][a0_0x5592("0xba")]=!1,this[a0_0x5592("0x6d6")][a0_0x5592("0x1e3")]=N["Shop"][2]+e[a0_0x5592("0xa9e")][a0_0x5592("0x910")]);else{let t=Math["floor"](e["reset"]-a)/1e3;const i=O[a0_0x5592("0x814")](t),r=this[a0_0x5592("0x55f")](i[0])+":"+this[a0_0x5592("0x55f")](i[1])+":"+this[a0_0x5592("0x55f")](i[2]);e["good"]&&e[a0_0x5592("0x543")][a0_0x5592("0x910")]<1&&this[a0_0x5592("0x3fa")]&&this[a0_0x5592("0x1ac")]&&(this[a0_0x5592("0x3fa")]["text"]=r,this["limRewRefBtn"][a0_0x5592("0xba")]=!0),e[a0_0x5592("0xa9e")]&&e[a0_0x5592("0xa9e")][a0_0x5592("0x910")]<1&&this["limSkiRefTit"]&&this[a0_0x5592("0x25b")]&&(this[a0_0x5592("0x9e2")][a0_0x5592("0x1e3")]=r,this[a0_0x5592("0x25b")][a0_0x5592("0xba")]=!0)}}if(e[a0_0x5592("0xa9e")]&&e[a0_0x5592("0xa9e")]["bskills"]){const t=e[a0_0x5592("0xa9e")][a0_0x5592("0x951")],s=Date[a0_0x5592("0x24")]();for(const n in t){const o=t[n];if(s>=o[a0_0x5592("0x6f4")])delete t[n],this[a0_0x5592("0x24c")]();else if(this[a0_0x5592("0x9b4")][o["id"]]){let t=Math[a0_0x5592("0x6fc")](o[a0_0x5592("0x6f4")]-s)/1e3;const l=O[a0_0x5592("0x814")](t),_=this[a0_0x5592("0x55f")](l[0])+":"+this[a0_0x5592("0x55f")](l[1])+":"+this[a0_0x5592("0x55f")](l[2]);this["limSkiTimLabs"][o["id"]][a0_0x5592("0x1e3")]=_}}}}}[a0_0x5592("0x55f")](t){return t<10?"0"+t:t+""}[a0_0x5592("0x3de")](){this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")],this[a0_0x5592("0x6ec")]>=1e3&&(this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0xa84")]())}[a0_0x5592("0x8ec")](){}}var v;!function(t){t[a0_0x5592("0x88")]="lobby.openpage",t[a0_0x5592("0x793")]=a0_0x5592("0x172"),t["HangarItemSel"]=a0_0x5592("0x664"),t[a0_0x5592("0xb39")]=a0_0x5592("0x1bb"),t[a0_0x5592("0x85c")]=a0_0x5592("0x10d"),t[a0_0x5592("0xfb")]=a0_0x5592("0x39a")}(v||(v={}));let Ta=1;const Ea=Laya[a0_0x5592("0x262")];class ba extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x98d")]=null,this["camera"]=null,this[a0_0x5592("0x939")]=0,this[a0_0x5592("0x3f6")]=null,this[a0_0x5592("0xf3")]=null,this[a0_0x5592("0x485")]=null,this[a0_0x5592("0x927")]=null,this["hangarPage"]=null,this[a0_0x5592("0xb34")]=null,this[a0_0x5592("0x369")]=null,this[a0_0x5592("0x37e")]=null,this[a0_0x5592("0x7bb")]=null,this[a0_0x5592("0x535")]=null,this[a0_0x5592("0x67b")]=null,this[a0_0x5592("0x87")]=null,this[a0_0x5592("0x395")]={};const t=Laya[a0_0x5592("0x43c")][a0_0x5592("0x231")](new Laya[a0_0x5592("0x569")]);t[a0_0x5592("0x645")]=-1,this["scene3D"]=t;const e=t[a0_0x5592("0x231")](new Laya[a0_0x5592("0x12e")](0,.1,1e3));e[a0_0x5592("0x48b")]["translate"](this["getVec3"](-1.8,2,2)),e[a0_0x5592("0x48b")]["rotate"](new Laya["Vector3"](-45,-45,0),!1,!1),this["camera"]=e,e[a0_0x5592("0x915")]=new Laya["RenderTexture"](720,600,Laya[a0_0x5592("0x6f3")][a0_0x5592("0x924")],Laya[a0_0x5592("0x93d")][a0_0x5592("0x2c6")]),e[a0_0x5592("0x1df")]=-1,e[a0_0x5592("0x71a")]=Laya[a0_0x5592("0x7d3")][a0_0x5592("0x661")],e[a0_0x5592("0x72e")]=this[a0_0x5592("0x436")](0,0,0,0);const a=t[a0_0x5592("0x231")](new Laya[a0_0x5592("0x493")]);a[a0_0x5592("0x318")]=new Laya[a0_0x5592("0x97c")](1,1,1),a[a0_0x5592("0x48b")][a0_0x5592("0x49c")][a0_0x5592("0x47b")](new Laya[a0_0x5592("0x97c")](1,-1,0))}[a0_0x5592("0x880")](){ba[a0_0x5592("0x4a4")]=this,C[a0_0x5592("0x965")]["startGame"](()=>{C[a0_0x5592("0x965")][a0_0x5592("0x4bf")](),C[a0_0x5592("0x965")][a0_0x5592("0xaa6")](()=>{})}),this[a0_0x5592("0x8a4")]=g["instance"];const a=this[a0_0x5592("0x8a4")];console["log"]("stage -> ",Laya[a0_0x5592("0x43c")]),this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")][a0_0x5592("0xd8")])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")]["LobbySceneBgNode"],t);a["bgNode"][a0_0x5592("0x231")](e),a[a0_0x5592("0x49")]=e[a0_0x5592("0xab9")]("norNode"),a[a0_0x5592("0xa1e")]=e[a0_0x5592("0xab9")](a0_0x5592("0xa1e")),R[a0_0x5592("0xcf")](a0_0x5592("0x6e5"))}),window[a0_0x5592("0xea")]=null,window[a0_0x5592("0x716")]=null,window[a0_0x5592("0x220")]=null,window["__endless.battle__"]=null,this[a0_0x5592("0x81e")](),I[a0_0x5592("0x7b3")](),C[a0_0x5592("0x965")][a0_0x5592("0x68d")][a0_0x5592("0x3f4")](I["getCombatValue"]()),this[a0_0x5592("0x939")]=a["bottomNode"]["y"],this[a0_0x5592("0x7e3")](w["lobby"][a0_0x5592("0x2dd")])["then"](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x2dd")],t);a[a0_0x5592("0x1cd")][a0_0x5592("0x231")](e),this[a0_0x5592("0x485")]=e[a0_0x5592("0x751")](aa),this[a0_0x5592("0x485")]["tabIndex"]=3}),this[a0_0x5592("0x927")]=a[a0_0x5592("0x927")][a0_0x5592("0x751")](wt),this[a0_0x5592("0x927")][a0_0x5592("0x38d")]=()=>{this["battlePage"]&&(R[a0_0x5592("0xcf")](v["OpenPage"],this[a0_0x5592("0x485")][a0_0x5592("0x6c")]),this[a0_0x5592("0x4fc")](3))},this[a0_0x5592("0xb34")]=a[a0_0x5592("0xb34")][a0_0x5592("0x751")](wt),this["hanTog"][a0_0x5592("0x38d")]=()=>{this[a0_0x5592("0x4ce")]?(R[a0_0x5592("0xcf")](v["OpenPage"],this[a0_0x5592("0x4ce")][a0_0x5592("0x6c")]),this[a0_0x5592("0x4fc")](2)):this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")][a0_0x5592("0x793")])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x793")],t);e[a0_0x5592("0x143")]=!1,a[a0_0x5592("0x1cd")][a0_0x5592("0x231")](e),this[a0_0x5592("0x4ce")]=e["getComponent"](ga),this[a0_0x5592("0x4ce")][a0_0x5592("0x6c")]=2,R["event"](v["OpenPage"],this["hangarPage"]["tabIndex"]),this[a0_0x5592("0x4fc")](2)});const t=H["unlockPage"][a0_0x5592("0x779")](a0_0x5592("0x793"));t>=0&&H[a0_0x5592("0x34")][a0_0x5592("0x3c8")](t,1)},this["advTog"]=a[a0_0x5592("0x535")][a0_0x5592("0x751")](wt),this[a0_0x5592("0x535")][a0_0x5592("0x38d")]=()=>{this["advPage"]?(R[a0_0x5592("0xcf")](v[a0_0x5592("0x88")],this[a0_0x5592("0x7bb")][a0_0x5592("0x6c")]),this[a0_0x5592("0x4fc")](4)):this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")][a0_0x5592("0x44c")])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x44c")],t);e[a0_0x5592("0x143")]=!1,a["content"]["addChild"](e),this["advPage"]=e[a0_0x5592("0x751")](Je),this[a0_0x5592("0x7bb")]["tabIndex"]=4,R[a0_0x5592("0xcf")](v[a0_0x5592("0x88")],this[a0_0x5592("0x7bb")]["tabIndex"]),this[a0_0x5592("0x4fc")](4)});const t=H[a0_0x5592("0x34")]["indexOf"](a0_0x5592("0x44c"));t>=0&&H["unlockPage"]["splice"](t,1)},this["advTog"]["cantHandle"]=()=>{sa["Tips"](N["Tips"][14][a0_0x5592("0xa51")]("$","6"))},this[a0_0x5592("0x37e")]=a[a0_0x5592("0x37e")][a0_0x5592("0x751")](wt),this[a0_0x5592("0x37e")][a0_0x5592("0x38d")]=()=>{this["equPage"]?(this[a0_0x5592("0x7e3")](w["lobby"][a0_0x5592("0xa83")])[a0_0x5592("0x284")](t=>{R[a0_0x5592("0xcf")](v["OpenPage"],this[a0_0x5592("0x369")][a0_0x5592("0x6c")])}),this["clickAnim"](1)):this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")]["EquipmentPage"])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x7ec")],t);e[a0_0x5592("0x143")]=!1,a["content"][a0_0x5592("0x231")](e),this[a0_0x5592("0x369")]=e[a0_0x5592("0x751")](ua),this[a0_0x5592("0x369")]["tabIndex"]=1,this[a0_0x5592("0x7e3")](w["lobby"]["EquMainItem"])[a0_0x5592("0x284")](t=>{R["event"](v[a0_0x5592("0x88")],this[a0_0x5592("0x369")]["tabIndex"])}),this[a0_0x5592("0x4fc")](1)});const t=H[a0_0x5592("0x34")][a0_0x5592("0x779")]("EquipmentPage");t>=0&&H[a0_0x5592("0x34")][a0_0x5592("0x3c8")](t,1)},this[a0_0x5592("0x37e")][a0_0x5592("0x8c5")]=()=>{sa[a0_0x5592("0x8b")](N[a0_0x5592("0x8b")][14][a0_0x5592("0xa51")]("$","3"))},this[a0_0x5592("0x87")]=a[a0_0x5592("0x87")][a0_0x5592("0x751")](wt),this["shopTog"][a0_0x5592("0x38d")]=()=>{this[a0_0x5592("0x67b")]?(R[a0_0x5592("0xcf")](v["OpenPage"],this[a0_0x5592("0x67b")][a0_0x5592("0x6c")]),this[a0_0x5592("0x4fc")](5)):this["loadPrefab"](w[a0_0x5592("0xb0c")]["ShopPage"])[a0_0x5592("0x284")](t=>{const e=this[a0_0x5592("0x4c9")](w["lobby"]["ShopPage"],t);e["visible"]=!1,a[a0_0x5592("0x1cd")][a0_0x5592("0x231")](e),this[a0_0x5592("0x67b")]=e[a0_0x5592("0x751")](ya),this[a0_0x5592("0x67b")]["tabIndex"]=5,R["event"](v[a0_0x5592("0x88")],this[a0_0x5592("0x67b")]["tabIndex"]),this[a0_0x5592("0x4fc")](5)});const t=H["unlockPage"]["indexOf"](a0_0x5592("0x7ec"));t>=0&&H[a0_0x5592("0x34")][a0_0x5592("0x3c8")](t,1)},this[a0_0x5592("0x87")][a0_0x5592("0x8c5")]=()=>{sa["Tips"](N["Tips"][14][a0_0x5592("0xa51")]("$","3"))};const t=a["equTog"][a0_0x5592("0xab9")](a0_0x5592("0x548"));z[a0_0x5592("0x558")][4]?(this["equTog"][a0_0x5592("0x233")]=!0,this["shopTog"][a0_0x5592("0x233")]=!0,t&&(t[a0_0x5592("0x143")]=!1)):(this[a0_0x5592("0x37e")][a0_0x5592("0x233")]=!1,this["shopTog"]["interactable"]=!1,t&&(t[a0_0x5592("0x143")]=!0));const e=a[a0_0x5592("0x535")]["getChildByName"](a0_0x5592("0x548"));z[a0_0x5592("0x558")][7]?(this["advTog"]["interactable"]=!0,e&&(e[a0_0x5592("0x143")]=!1)):(this[a0_0x5592("0x535")][a0_0x5592("0x233")]=!1,e&&(e["visible"]=!0));let i=Laya["LocalStorage"][a0_0x5592("0xac9")](a0_0x5592("0x244"));i||(i="1"),i=parseInt(i);const r=a[a0_0x5592("0x181")]["getComponent"](wt);r["isChecked"]=!!i,r[a0_0x5592("0x38d")]=t=>{const e=t?1:0,a=t?.5:0;Ea[a0_0x5592("0x4d8")](e),Ea[a0_0x5592("0x9d")](a);const i=t?"1":"0";Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")]("Plane.Mute",i)},r[a0_0x5592("0x38d")](!!i),this[a0_0x5592("0x68")](a["coinBtn"],()=>{this["openDialog"](w[a0_0x5592("0xb0c")][a0_0x5592("0x7f")],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t["getComponent"](ra)[a0_0x5592("0x971")]([[A[a0_0x5592("0x5e2")],1e4]],N[a0_0x5592("0x238")][21],C[a0_0x5592("0xa9f")])})},this),this[a0_0x5592("0x68")](a[a0_0x5592("0x500")],()=>{this["openDialog"](w[a0_0x5592("0xb0c")][a0_0x5592("0x7f")],g["instance"][a0_0x5592("0x72c")],t=>{t["getComponent"](ra)[a0_0x5592("0x971")]([[A[a0_0x5592("0x591")],100]],N[a0_0x5592("0x238")][20],C["DiamondVideoID"])})},this),R["on"](v["HangarPage"],this,this["onHangarPage"]),R["on"](a0_0x5592("0x5ca"),this,this[a0_0x5592("0xa04")]),R["on"](a0_0x5592("0x9a7"),this,this[a0_0x5592("0x4b5")]),this[a0_0x5592("0xa04")](),this["initDia"]();const s=window[a0_0x5592("0x950")];s&&a0_0x5592("0x212")==typeof s&&this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")]["UnlockChapterDialog"],g[a0_0x5592("0x173")]["Dialog"],t=>{t[a0_0x5592("0x751")](na)[a0_0x5592("0x971")](s,a0_0x5592("0x9d5"))}),s&&a0_0x5592("0x379")==s&&dt[a0_0x5592("0x9f9")]({title:N[a0_0x5592("0x238")][12],desc:N[a0_0x5592("0x238")][16],sure:null,only:!0},a["Dialog"]),s&&a0_0x5592("0x701")==s&&dt[a0_0x5592("0x9f9")]({title:N["Common"][12],desc:N["Common"][18],sure:null,only:!0},a[a0_0x5592("0x72c")]),Ze[a0_0x5592("0x317")]("LobbyScene.EquipmentPage",()=>{let t=!1;return H[a0_0x5592("0x34")][a0_0x5592("0x779")]("EquipmentPage")>=0&&(t=!0),t}),Ze[a0_0x5592("0x317")](a0_0x5592("0x13"),()=>{let t=!1;return H[a0_0x5592("0x34")][a0_0x5592("0x779")]("AdventurePage")>=0&&(t=!0),t}),Ze["Register"](a0_0x5592("0x8c6"),()=>{let t=!1;H[a0_0x5592("0x34")][a0_0x5592("0x779")](a0_0x5592("0x793"))>=0&&(t=!0);const e=G[a0_0x5592("0x77d")](H[a0_0x5592("0x188")]);return z["coin"]>=e&&(t=!0),t})}[a0_0x5592("0xa04")](){this[a0_0x5592("0x3f6")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](z[a0_0x5592("0x7e0")])+" "}[a0_0x5592("0x4b5")](){this[a0_0x5592("0xf3")][a0_0x5592("0x1e3")]=O["formatNumber"](z[a0_0x5592("0x6e3")])+" "}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x98d")][a0_0x5592("0x64b")](!0),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),R[a0_0x5592("0x5c7")](this)}[a0_0x5592("0x4fc")](t){const e=this[a0_0x5592("0x8a4")],a=Laya["stage"][a0_0x5592("0x1c1")]-e[a0_0x5592("0x813")][a0_0x5592("0x1c1")];e["bottomNode"]["y"]=a+e[a0_0x5592("0x813")][a0_0x5592("0x1c1")],Laya["Tween"]["to"](e[a0_0x5592("0x813")],{y:a},500,Laya[a0_0x5592("0x4ec")]["quadInOut"]),e[a0_0x5592("0x29a")]["y"]=0-e[a0_0x5592("0x29a")][a0_0x5592("0x1c1")],Laya[a0_0x5592("0x6eb")]["to"](e[a0_0x5592("0x29a")],{y:0},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x789")]),e["topTitLab"][a0_0x5592("0x1e3")]=N[a0_0x5592("0x238")][t+1],e[a0_0x5592("0x579")][a0_0x5592("0x143")]=!(3==t),e["soundTog"]["visible"]=3==t}[a0_0x5592("0x81e")](){for(let t=0;t<Et[a0_0x5592("0xb0e")];t++){const e=Et[t];Laya[a0_0x5592("0x353")][a0_0x5592("0xaa0")](e)}Et["length"]=0}[a0_0x5592("0x86c")](s,n){const o=this[a0_0x5592("0x395")],l=it;for(const t in o){o[t]["active"]=!1}const e=o[s];n[a0_0x5592("0xacb")][a0_0x5592("0x149")](),Ta=s;const _=s;if(e){0==e[a0_0x5592("0x6b7")]&&(e[a0_0x5592("0x6b7")]=!0);let t=new Laya[a0_0x5592("0x5b1")](this[a0_0x5592("0x304")][a0_0x5592("0x915")],Laya["Texture"][a0_0x5592("0x1ca")]);n[a0_0x5592("0xacb")]["drawTexture"](t)}else o[s]={},this[a0_0x5592("0xb01")](b[a0_0x5592("0x522")+s])["then"](t=>{const e=Laya[a0_0x5592("0x745")]["instantiate"](t);e[a0_0x5592("0x48b")]["localScale"]=new Laya[a0_0x5592("0x97c")](3.5,3.5,3.5);const a=new j;a[a0_0x5592("0x96d")]=1.4,a[a0_0x5592("0xaf0")]=.25;const i=e[a0_0x5592("0x433")](0),r=this[a0_0x5592("0x761")](l[s]);if(a["albedoTexture"]=r,Laya["Texture2D"][a0_0x5592("0x6e9")](a0_0x5592("0x351"),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](null,function(t){a[a0_0x5592("0x5bc")]=t,i[a0_0x5592("0x6bc")][a0_0x5592("0x88c")]=a})),this["scene3D"][a0_0x5592("0x231")](e),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x8ac")](1,this,()=>{e["transform"]["rotate"](this[a0_0x5592("0xce")](0,.005,0))}),o[s]=e,_==Ta){let t=new Laya["Texture"](this["camera"]["renderTarget"],Laya[a0_0x5592("0x5b1")][a0_0x5592("0x1ca")]);n[a0_0x5592("0xacb")][a0_0x5592("0x633")](t)}else e[a0_0x5592("0x6b7")]=!1})}[a0_0x5592("0x3de")](){this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")],this[a0_0x5592("0x6ec")]>=1e3&&(this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0xa84")]())}[a0_0x5592("0xa84")](){let t=M[a0_0x5592("0x5c8")];if(t&&t[a0_0x5592("0xa9e")]&&t["skill"][a0_0x5592("0x951")]){const e=t[a0_0x5592("0xa9e")][a0_0x5592("0x951")],a=Date["now"]();for(const i in e){a>=e[i][a0_0x5592("0x6f4")]&&delete e[i]}}}}ba[a0_0x5592("0x4a4")]=null;class Sa extends t{constructor(){super()}[a0_0x5592("0x880")](){const t=this[a0_0x5592("0x8a0")],e=t[a0_0x5592("0x433")](0),a=t[a0_0x5592("0x433")](1),i=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")]("test_rate");i&&(e[a0_0x5592("0x1e3")]=i);const r=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")](a0_0x5592("0x457"));r&&(a["text"]=r);(t=>{const e=t[a0_0x5592("0x433")](0),a=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")](a0_0x5592("0x377"));a&&(e[a0_0x5592("0x1e3")]=a)})(t[a0_0x5592("0x433")](3));(t=>{const e=t[a0_0x5592("0x433")](0),a=t[a0_0x5592("0x433")](1),i=t[a0_0x5592("0x433")](2),r=t["getChildAt"](3),s=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")]("test_eid");s&&(e[a0_0x5592("0x1e3")]=s);const n=Laya["LocalStorage"][a0_0x5592("0xac9")]("test_ehp");n&&(a[a0_0x5592("0x1e3")]=n);const o=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")](a0_0x5592("0x1f7"));o&&(i[a0_0x5592("0x1e3")]=o);const l=Laya[a0_0x5592("0x13e")][a0_0x5592("0xac9")]("test_esp");l&&(r[a0_0x5592("0x1e3")]=l)})(t[a0_0x5592("0x433")](2))}[a0_0x5592("0x4fd")](){const t=this[a0_0x5592("0x8a0")];if(!t[a0_0x5592("0x143")])return;const e=t[a0_0x5592("0x433")](0),a=t[a0_0x5592("0x433")](1),i=parseInt(e[a0_0x5592("0x1e3")]),r=parseInt(a[a0_0x5592("0x1e3")]);i&&(I[a0_0x5592("0x2d6")]=i,H[a0_0x5592("0x137")][a0_0x5592("0x3c3")]=i,Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")](a0_0x5592("0x455"),i+"")),r&&(I[a0_0x5592("0x9d5")]=r,Laya[a0_0x5592("0x13e")]["setItem"]("test_chap",r+""));(t=>{const e=t[a0_0x5592("0x433")](0),a=parseInt(e[a0_0x5592("0x1e3")]);a&&(I["hp"]=a,Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")]("test_php",a+""))})(t[a0_0x5592("0x433")](3));(t=>{const e=t["getChildAt"](0),a=t[a0_0x5592("0x433")](1),i=t[a0_0x5592("0x433")](2),r=t[a0_0x5592("0x433")](3),s=(t[a0_0x5592("0x433")](4),t[a0_0x5592("0x433")](5),t["getChildAt"](6),t[a0_0x5592("0x433")](7),t[a0_0x5592("0x433")](8),parseInt(e[a0_0x5592("0x1e3")])),n=parseInt(a[a0_0x5592("0x1e3")]),o=parseInt(i[a0_0x5592("0x1e3")]),l=parseFloat(r["text"]),_=E[a0_0x5592("0x809")],h=$["enemys"];if(s&&n&&o&&l){h[s]&&(h[s][a0_0x5592("0x58")]=l);for(const x in _){const c=_[x];for(let t=0;t<c[a0_0x5592("0xb0e")];t++){const d=c[t];d["type"]==s&&(d["hp"]=n,d["att"]=o)}}Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")](a0_0x5592("0x847"),s+""),Laya["LocalStorage"][a0_0x5592("0x425")](a0_0x5592("0x87a"),n+""),Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")](a0_0x5592("0x1f7"),o+""),Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")](a0_0x5592("0x9bd"),l+"")}})(t[a0_0x5592("0x433")](2))}}class Ca extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x26")]=null,this[a0_0x5592("0x806")]=null,this[a0_0x5592("0x77b")]=0}[a0_0x5592("0x653")](){const t=Y[a0_0x5592("0x173")];this[a0_0x5592("0x6a6")](this),t[a0_0x5592("0x547")]==P[a0_0x5592("0x953")]&&(t[a0_0x5592("0x547")]=P[a0_0x5592("0xa5")]),R[a0_0x5592("0xcf")](F["ClosePauseDialog"])}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],this[a0_0x5592("0x653")],this);let t=null;this["invBtn"][a0_0x5592("0x143")]=![];this[a0_0x5592("0x68")](this[a0_0x5592("0x26")],()=>{t&&this[a0_0x5592("0xa67")](t[O["getRandom"](t[a0_0x5592("0xb0e")]-1,0)][a0_0x5592("0x749")])},this);const h=this[a0_0x5592("0x806")];h["vScrollBarSkin"]="",h["renderHandler"]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,_)=>{(t=>{const e=t[a0_0x5592("0xab9")](a0_0x5592("0x1c8")),a=t["getChildByName"](a0_0x5592("0x145")),i=t[a0_0x5592("0xab9")](a0_0x5592("0x4cd")),r=t[a0_0x5592("0xab9")](a0_0x5592("0x64a")),s=h["array"][_],n=s[a0_0x5592("0x347")];let o=!0;if(n)if(n[a0_0x5592("0x779")](a0_0x5592("0x7a4"))>-1)o=!1,e[a0_0x5592("0x2aa")](n);else{let t=s[a0_0x5592("0x347")][a0_0x5592("0xa51")](a0_0x5592("0x870"),"");parseInt(t)<1&&(t="1"),parseInt(t)>20&&(t="20"),e[a0_0x5592("0x8fa")]=a0_0x5592("0x50c")+t+a0_0x5592("0x525")}else e[a0_0x5592("0x8fa")]=a0_0x5592("0x7b7");i[a0_0x5592("0x1e3")]=s[a0_0x5592("0x749")],r[a0_0x5592("0x1e3")]=O["formatNumber"](s[a0_0x5592("0x537")]),a[a0_0x5592("0x5c7")](a);const l=M[a0_0x5592("0x13b")][s[a0_0x5592("0x37")]];a["gray"]=!!l,this[a0_0x5592("0x68")](a,()=>{l||(o?this[a0_0x5592("0xa67")](s[a0_0x5592("0x749")]):this["inviteFriend"](s))},a)})(t)},null,!1),h[a0_0x5592("0xa3f")]=[],C[a0_0x5592("0x965")][a0_0x5592("0x68d")][a0_0x5592("0x8af")](e=>{const a=[],i=[],r=M[a0_0x5592("0x13b")];for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const s=e[t];s[a0_0x5592("0x37")]!=C[a0_0x5592("0x965")][a0_0x5592("0x15")][a0_0x5592("0x37")]&&(r[s[a0_0x5592("0x37")]]?i[a0_0x5592("0x626")](s):a["push"](s))}a[a0_0x5592("0x626")][a0_0x5592("0x904")](a,i),h[a0_0x5592("0xa3f")]=a,t=a})}[a0_0x5592("0xa67")](t){const e=()=>{M[a0_0x5592("0x773")]||(M[a0_0x5592("0x773")]++,this[a0_0x5592("0x732")](t))};C[a0_0x5592("0x965")][a0_0x5592("0x205")][a0_0x5592("0x9bc")]({width:750,height:380,pngData:[{playImage:null,url:C[a0_0x5592("0x965")][a0_0x5592("0x15")][a0_0x5592("0x347")]||"",posX:26,posY:101,imgWidth:145,imgHeight:145},{playImage:null,url:a0_0x5592("0x7b1"),posX:0,posY:0,imgWidth:750,imgHeight:380}],fontData:[{des:O[a0_0x5592("0x77")](I[a0_0x5592("0xa2e")]()),posX:259,posY:225,font:"italic bold 30px Microsoft YaHei",lineWidth:2,fillStyle:"#fef523",textAlign:a0_0x5592("0xa8f"),strokeStyle:"#000000"}]},e,null,e)}[a0_0x5592("0x540")](t){const e=()=>{this[a0_0x5592("0x732")](t[a0_0x5592("0x749")]),M[a0_0x5592("0x13b")][t[a0_0x5592("0x37")]]=1};C[a0_0x5592("0x965")][a0_0x5592("0x205")][a0_0x5592("0xace")]({width:750,height:380,playerID:t["playerID"],pngData:[{playImage:null,url:C["gameSDK"][a0_0x5592("0x15")][a0_0x5592("0x347")]||"",posX:26,posY:101,imgWidth:145,imgHeight:145},{playImage:null,url:a0_0x5592("0x7b1"),posX:0,posY:0,imgWidth:750,imgHeight:380}],fontData:[{des:O[a0_0x5592("0x77")](I["getCombatValue"]()),posX:259,posY:225,font:a0_0x5592("0x980"),lineWidth:2,fillStyle:a0_0x5592("0x7ff"),textAlign:a0_0x5592("0xa8f"),strokeStyle:a0_0x5592("0x213")}]},e,null,e)}[a0_0x5592("0x732")](t){this[a0_0x5592("0x77b")]&&(this[a0_0x5592("0x653")](),R["event"](F[a0_0x5592("0x8e2")],[t,this["planeId"]]))}[a0_0x5592("0x4fd")](){super[a0_0x5592("0x4fd")]()}[a0_0x5592("0x971")](t){this[a0_0x5592("0x77b")]=t}[a0_0x5592("0x3de")](){}}class Ra extends t{constructor(){super(),this["picon"]=null,this[a0_0x5592("0x601")]=null}[a0_0x5592("0x880")](){const t=Y[a0_0x5592("0x173")],e=Ut["insUI"],a=this["owner"];if(!t)return void a["removeSelf"]();const i=L[a0_0x5592("0xa1a")];this[a0_0x5592("0x184")]["skin"]=rt[i];const r=this[a0_0x5592("0x601")],s=()=>{Laya["Tween"]["clearAll"](r),r[a0_0x5592("0x14")]=1,Laya[a0_0x5592("0x6eb")]["to"](r,{alpha:.4},1e3,null,Laya["Handler"]["create"](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](r,{alpha:1},1e3,null)}))};s(),Laya[a0_0x5592("0x6ec")]["loop"](2500,this,s),this["setClick"](a,()=>{t[a0_0x5592("0x547")]!=P["START"]||e["isEnding"]||(t[a0_0x5592("0x547")]=P["PAUSE"],e[a0_0x5592("0x3fb")]=!0,this[a0_0x5592("0x165")](w[a0_0x5592("0x877")][a0_0x5592("0x1b7")],t[a0_0x5592("0x925")],t=>{t[a0_0x5592("0x751")](Ca)[a0_0x5592("0x971")](i)}))},this)}[a0_0x5592("0x4fd")](){super["onDisable"]()}[a0_0x5592("0x3de")](){}}class Aa extends Laya[a0_0x5592("0x54")]{constructor(){super(),this["speed"]=.1,this[a0_0x5592("0x6ca")]=null,this["bg2"]=null,this[a0_0x5592("0x1e4")]=1280}[a0_0x5592("0x880")](){const t=Laya[a0_0x5592("0x43c")][a0_0x5592("0x1c1")]>1280?Laya[a0_0x5592("0x43c")][a0_0x5592("0x1c1")]:1280;this[a0_0x5592("0x1e4")]=t;const e=t/1280;this[a0_0x5592("0x6ca")][a0_0x5592("0xa37")]=e,this[a0_0x5592("0x7c")][a0_0x5592("0xa37")]=-e,this["bg1"]["y"]=1.5*t,this[a0_0x5592("0x7c")]["y"]=.5*t;let a=1;if(I[a0_0x5592("0x9d5")]<1?a=U[a0_0x5592("0x8b2")]["map"]:(a=U[a0_0x5592("0x791")][I[a0_0x5592("0x9d5")]-1][a0_0x5592("0x37a")],2==I[a0_0x5592("0x5d4")]&&(a=U[a0_0x5592("0x52a")][I["chapter"]-1]["map"])),this["speed"]<.15){this[a0_0x5592("0x6ca")][a0_0x5592("0x8fa")]=this[a0_0x5592("0x7c")][a0_0x5592("0x8fa")]=a0_0x5592("0x567")+a+a0_0x5592("0x911");const i=this[a0_0x5592("0x6ca")][a0_0x5592("0xae6")];for(let t=0;t<i;t++){const r=this["bg1"][a0_0x5592("0x433")](0),s=this["bg2"]["getChildAt"](0);r[a0_0x5592("0x749")]==a+""?r[a0_0x5592("0x143")]=s[a0_0x5592("0x143")]=!0:r[a0_0x5592("0x143")]=s[a0_0x5592("0x143")]=!1}}this["speed"]>.15&&(this[a0_0x5592("0x6ca")]["skin"]=this["bg2"][a0_0x5592("0x8fa")]=a0_0x5592("0x567")+a+a0_0x5592("0x458"))}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x3de")](){let e=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")];const a=this[a0_0x5592("0x1e4")];if(this[a0_0x5592("0x6ca")]&&this[a0_0x5592("0x7c")]){this[a0_0x5592("0x6ca")]["y"]>=1.5*a&&(this["bg1"]["y"]=.5*-a+(this[a0_0x5592("0x6ca")]["y"]-1.5*a)),this[a0_0x5592("0x7c")]["y"]>=1.5*a&&(this[a0_0x5592("0x7c")]["y"]=.5*-a+(this[a0_0x5592("0x7c")]["y"]-1.5*a));let t=e*this[a0_0x5592("0x5b6")];this[a0_0x5592("0x6ca")]["y"]+=t,this[a0_0x5592("0x7c")]["y"]+=t}}}class La extends t{constructor(){super(),this[a0_0x5592("0xa07")]=null,this["lighter2"]=null}["onEnable"](){for(let t=1;t<3;t++){const e=this[a0_0x5592("0x6ee")+t];e&&(e[a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")])}}[a0_0x5592("0x4fd")](){}}class Ia extends Laya[a0_0x5592("0x310")]{constructor(){super(),this["size"](128,150),this[a0_0x5592("0x7e3")](w["battleUI"][a0_0x5592("0x3a3")])[a0_0x5592("0x284")](t=>{const e=Laya[a0_0x5592("0x353")]["getItemByCreateFun"](w[a0_0x5592("0x877")][a0_0x5592("0x3a3")],t["create"],t);this[a0_0x5592("0x231")](e)})}[a0_0x5592("0x880")](){}["onDisable"](){}[a0_0x5592("0x7e3")](n){return new Promise((e,t)=>{const a=Laya[a0_0x5592("0x80c")][a0_0x5592("0x761")](n);if(a)e(a);else{let t=null;if(!ht[a0_0x5592("0xaef")]&&n["indexOf"](a0_0x5592("0x44a"))>-1){const i=n[a0_0x5592("0xae0")]("/"),r=i[i[a0_0x5592("0xb0e")]-1],s=Laya[a0_0x5592("0x80c")]["getRes"]("prefab/battle/merge.json")[r];(t=new Laya[a0_0x5592("0x683")])[a0_0x5592("0x622")]=s,e(t)}else Laya[a0_0x5592("0x80c")][a0_0x5592("0x2ab")](n,Laya[a0_0x5592("0x4d5")]["create"](this,t=>{t&&e(t)}),null,Laya[a0_0x5592("0x92")][a0_0x5592("0x615")])}})}}class Ma extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["lvLab"]=null,this[a0_0x5592("0x39")]=null,this[a0_0x5592("0xa42")]=null,this[a0_0x5592("0x2b9")]=null,this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x4a0")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],this[a0_0x5592("0x470")],this);const t=this[a0_0x5592("0x8a4")]["playerData"];this[a0_0x5592("0x186")][a0_0x5592("0x1e3")]=N["EndlessDialog"][7]+t[a0_0x5592("0x2d6")];const e=this[a0_0x5592("0x4a0")];e["x"]=-720;const a=this["rewList"];a[a0_0x5592("0xa37")]=0,Laya["timer"][a0_0x5592("0x724")](200,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](e,{x:0},150,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya["Handler"]["create"](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](a,{scaleY:1},150,Laya["Ease"][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{R["event"](a0_0x5592("0x9e0"),this[a0_0x5592("0x8a0")])}))}))});const i={},o=[];let r=5*Math[a0_0x5592("0x6fc")](t["rate"]/10);o[a0_0x5592("0x626")]({data:L[a0_0x5592("0x65a")][A["Gold"]],num:O[a0_0x5592("0x77")](t["coin"]*this[a0_0x5592("0x8a4")][a0_0x5592("0xb30")])}),o[a0_0x5592("0x626")]({data:L["items"][A["Diamond"]],num:O["formatNumber"](r)}),i[A[a0_0x5592("0x5e2")]]=[A[a0_0x5592("0x5e2")],t[a0_0x5592("0x7e0")]*this[a0_0x5592("0x8a4")][a0_0x5592("0xb30")]],i[A["Diamond"]]=[A[a0_0x5592("0x591")],r],z["updateItem"](i),t[a0_0x5592("0x2d6")]>H["endlessData"]["bestLevel"]&&(H["endlessData"][a0_0x5592("0x1b8")]=t["rate"]),t[a0_0x5592("0x537")]>H["endlessData"][a0_0x5592("0x64c")]&&(H["endlessData"][a0_0x5592("0x64c")]=t[a0_0x5592("0x537")]);let s=1;50==t[a0_0x5592("0x2d6")]?s=11:t[a0_0x5592("0x2d6")]>50&&(s=11+10*Math[a0_0x5592("0x6fc")]((t[a0_0x5592("0x2d6")]-50)/20)),H[a0_0x5592("0x137")][a0_0x5592("0x3c3")]<s&&(H[a0_0x5592("0x137")][a0_0x5592("0x3c3")]=s),this[a0_0x5592("0x39")][a0_0x5592("0x1e3")]=N[a0_0x5592("0x9a1")][8]+H[a0_0x5592("0x137")][a0_0x5592("0x1b8")],C["gameSDK"]["postScoreToFB"](t[a0_0x5592("0x537")]),a[a0_0x5592("0x447")]=Ia,a[a0_0x5592("0x6be")]="",a[a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{const a=t[a0_0x5592("0x433")](0);if(!a)return;a[a0_0x5592("0x729")]=!0;const i=a["getChildByName"](a0_0x5592("0x4db")),r=a[a0_0x5592("0xab9")](a0_0x5592("0x919")),s=a[a0_0x5592("0xab9")](a0_0x5592("0x601")),n=o[e];r["visible"]=!(!n[a0_0x5592("0x919")]||1==n[a0_0x5592("0x919")]),i[a0_0x5592("0x1e3")]=n[a0_0x5592("0x523")][a0_0x5592("0x749")],r["text"]=n[a0_0x5592("0x919")]||"0",s[a0_0x5592("0xa20")](1,1),s[a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+(n[a0_0x5592("0x523")][a0_0x5592("0x4b")]&&"number"==typeof n[a0_0x5592("0x523")][a0_0x5592("0x4b")]?n[a0_0x5592("0x523")][a0_0x5592("0x4b")]:n[a0_0x5592("0x523")]["id"])+a0_0x5592("0x525")},null,!1),a["array"]=o,this[a0_0x5592("0x2b9")][a0_0x5592("0x447")]=Ia,this[a0_0x5592("0x2b9")]["vScrollBarSkin"]="",this[a0_0x5592("0x2b9")]["renderHandler"]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{const a=t["getChildAt"](0);if(!a)return;const i=a["getChildByName"]("desc"),r=a[a0_0x5592("0xab9")]("num"),s=a[a0_0x5592("0xab9")]("icon"),n=this[a0_0x5592("0x2b9")]["array"][e],o=D[a0_0x5592("0x53d")][n];s[a0_0x5592("0xa20")](.8,.8),s[a0_0x5592("0x8fa")]=bt[o["id"]],o&&(i["text"]=o["name"]),r["visible"]=!1},null,!1);const n=[];for(const h in t[a0_0x5592("0x53d")])n["push"](parseInt(h));this[a0_0x5592("0x2b9")]["array"]=n;const l={pc:I,pic:z,ppc:H,ptc:M},_={[C["fbSaveDataKey"][0]]:l};C[a0_0x5592("0x965")][a0_0x5592("0xfa")](_,()=>{}),R["event"](a0_0x5592("0x80f"))}["onCloseClick"](){this[a0_0x5592("0x6a6")](this,()=>{}),Laya[a0_0x5592("0x876")][a0_0x5592("0x4c9")](a0_0x5592("0x59b"))}["onDisable"](){}[a0_0x5592("0x3de")](){}}class Da extends t{constructor(){super(),this[a0_0x5592("0x8fa")]=null,this[a0_0x5592("0x5b6")]=5}["onEnable"](){}[a0_0x5592("0x3de")](){this[a0_0x5592("0x8fa")]&&(this[a0_0x5592("0x8fa")][a0_0x5592("0x3b0")]+=this["speed"])}}class wa extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x12f")]=null,this[a0_0x5592("0x9af")]=null,this[a0_0x5592("0x27e")]=null,this["rewList"]=null,this[a0_0x5592("0x624")]=null,this[a0_0x5592("0x2b9")]=null,this["closeBtn"]=null,this["rewBtn"]=null,this[a0_0x5592("0x4a0")]=null,this[a0_0x5592("0xd0")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const a=window["__Adventure__"];let t=null;a&&(t=Q[a0_0x5592("0x1aa")][a[0][a0_0x5592("0x314")][a0_0x5592("0xaed")]][a[0]["adv"][a0_0x5592("0xaed")]]),this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],this[a0_0x5592("0x470")],this),this[a0_0x5592("0x68")](this["rewBtn"],()=>{C[a0_0x5592("0x965")]["faceBookUpdateAsync"][a0_0x5592("0x613")]()},this);const i=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")];let e=!!(i[a0_0x5592("0x257")]>0);e=![];this["sucNode"][a0_0x5592("0x143")]=e,this[a0_0x5592("0x9af")][a0_0x5592("0x143")]=!e,this[a0_0x5592("0x4c")][a0_0x5592("0x143")]=e,e||(this[a0_0x5592("0x20")]["x"]=360);const r=this[a0_0x5592("0x624")]["getChildByName"]("title");if(r["text"]=N["Battle"][3],a)this["levelLab"][a0_0x5592("0x2ed")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x624")]["visible"]=!0,r[a0_0x5592("0x1e3")]=N[a0_0x5592("0x44c")][6],e&&H[a0_0x5592("0x56")](a[0]["adv"][a0_0x5592("0xaed")],-1);else{this[a0_0x5592("0x624")][a0_0x5592("0x143")]=e,this[a0_0x5592("0x27e")][a0_0x5592("0x1e3")]=a0_0x5592("0x8d9")+i[a0_0x5592("0x9d5")]+" ",1==I[a0_0x5592("0x5d4")]?z[a0_0x5592("0x9d5")][i["chapter"]]>1&&(this[a0_0x5592("0x624")]["visible"]=!1):z[a0_0x5592("0x3bb")][i[a0_0x5592("0x9d5")]]>1&&(this["unLockNode"][a0_0x5592("0x143")]=!1)}const s=this["animNode"];s["x"]=-720;const n=this[a0_0x5592("0xa42")];n[a0_0x5592("0xa37")]=0,Laya["timer"][a0_0x5592("0x724")](200,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](s,{x:0},150,Laya["Ease"]["circOut"],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](n,{scaleY:1},150,Laya["Ease"][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{R[a0_0x5592("0xcf")](a0_0x5592("0x9e0"),this[a0_0x5592("0x8a0")])}))}))}),a&&!e&&(i["reward"]=0);const o={},l=[];let _=0;l[a0_0x5592("0x626")]({data:L[a0_0x5592("0x65a")][A["Gold"]],num:O["formatNumber"](i[a0_0x5592("0x7e0")]*this["ins"]["coinRate"])});let h=a0_0x5592("0xa8d");if(i[a0_0x5592("0x9d5")]<1?h=U[a0_0x5592("0x8b2")]["drop"]:(h=U["comChapters"][i[a0_0x5592("0x9d5")]-1][a0_0x5592("0x65e")],2==I[a0_0x5592("0x5d4")]&&(h=U[a0_0x5592("0x52a")][i[a0_0x5592("0x9d5")]-1][a0_0x5592("0x65e")])),a&&(h=Q[a0_0x5592("0x1aa")][a[0]["adv"][a0_0x5592("0xaed")]][a[0][a0_0x5592("0x314")][a0_0x5592("0xaed")]]["drop"]),!a&&e){1==I[a0_0x5592("0x5d4")]?1==z[a0_0x5592("0x9d5")][i[a0_0x5592("0x9d5")]]&&(_=30,l[a0_0x5592("0x626")]({data:L["items"][A[a0_0x5592("0x591")]],num:O["formatNumber"](_)})):1==z[a0_0x5592("0x3bb")][i[a0_0x5592("0x9d5")]]&&(_=30,l[a0_0x5592("0x626")]({data:L["items"][A["Diamond"]],num:O["formatNumber"](_)}))}if(a&&2==a[0][a0_0x5592("0x314")][a0_0x5592("0xaed")])_=i[a0_0x5592("0xb05")]*t[a0_0x5592("0x769")],l[a0_0x5592("0x626")]({data:L["items"][A["Diamond"]],num:O[a0_0x5592("0x77")](_)});else{const d=h["split"]?h[a0_0x5592("0xae0")]("|"):[h+""];d[a0_0x5592("0x779")](a0_0x5592("0xa8d"))>-1&&d[a0_0x5592("0x3c8")](d[a0_0x5592("0x779")]("101"),1);const u=i[a0_0x5592("0xb05")],f=Math[a0_0x5592("0x6fc")](u/d[a0_0x5592("0xb0e")]),p=u%d["length"],m=t=>{let e=1;return 1011!=t&&1012!=t&&1013!=t&&1014!=t&&1015!=t&&1016!=t||(e=a?30:8),e};if(f)for(let t=0;t<d[a0_0x5592("0xb0e")];t++)o[d[t]]=[parseInt(d[t]),f*m(parseInt(d[t]))];for(let t=0;t<p;t++){const g=O["getRandom"](d["length"]-1,0);o[d[g]]?o[d[g]][1]+=m(parseInt(d[g])):o[d[g]]=[parseInt(d[g]),m(parseInt(d[g]))]}for(const v in o){const y=o[v];l[a0_0x5592("0x626")]({data:L["items"][y[0]],num:y[1]})}}if(o[A[a0_0x5592("0x5e2")]]=[A[a0_0x5592("0x5e2")],i[a0_0x5592("0x7e0")]*this[a0_0x5592("0x8a4")][a0_0x5592("0xb30")]],_&&(o[A[a0_0x5592("0x591")]]=[A[a0_0x5592("0x591")],_]),z[a0_0x5592("0xa8a")](o),n["itemRender"]=Ia,n[a0_0x5592("0x6be")]="",n[a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{const a=t[a0_0x5592("0x433")](0);if(!a)return;a["__light__"]=!0;const i=a[a0_0x5592("0xab9")](a0_0x5592("0x4db")),r=a[a0_0x5592("0xab9")](a0_0x5592("0x919")),s=a[a0_0x5592("0xab9")](a0_0x5592("0x601")),n=l[e];r[a0_0x5592("0x143")]=!(!n[a0_0x5592("0x919")]||1==n[a0_0x5592("0x919")]),i[a0_0x5592("0x1e3")]=n[a0_0x5592("0x523")][a0_0x5592("0x749")],r[a0_0x5592("0x1e3")]=n[a0_0x5592("0x919")]||"0",s[a0_0x5592("0xa20")](1,1),s[a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+(n[a0_0x5592("0x523")][a0_0x5592("0x4b")]&&a0_0x5592("0x993")==typeof n[a0_0x5592("0x523")][a0_0x5592("0x4b")]?n[a0_0x5592("0x523")][a0_0x5592("0x4b")]:n[a0_0x5592("0x523")]["id"])+".png"},null,!1),n[a0_0x5592("0xa3f")]=l,this[a0_0x5592("0x2b9")]["itemRender"]=Ia,this[a0_0x5592("0x2b9")][a0_0x5592("0xa26")]="",this[a0_0x5592("0x2b9")]["renderHandler"]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{const a=t[a0_0x5592("0x433")](0);if(!a)return;const i=a[a0_0x5592("0xab9")]("desc"),r=a[a0_0x5592("0xab9")](a0_0x5592("0x919")),s=a[a0_0x5592("0xab9")](a0_0x5592("0x601")),n=this["lockList"][a0_0x5592("0xa3f")][e],o=D[a0_0x5592("0x53d")][n];s[a0_0x5592("0xa20")](.8,.8),s[a0_0x5592("0x8fa")]=bt[o["id"]],o&&(i[a0_0x5592("0x1e3")]=o[a0_0x5592("0x749")]),r[a0_0x5592("0x143")]=!1},null,!1),a){const T=[];for(const E in i["skills"])T["push"](parseInt(E));this[a0_0x5592("0x2b9")]["array"]=T}else if(e){let e=[],a=[];i[a0_0x5592("0x9d5")]<1?e=U[a0_0x5592("0x8b2")]["unlockskill"]:(e=U[a0_0x5592("0x791")][i[a0_0x5592("0x9d5")]-1][a0_0x5592("0x80a")],2==I[a0_0x5592("0x5d4")]&&(e=U[a0_0x5592("0x52a")][i[a0_0x5592("0x9d5")]-1][a0_0x5592("0x80a")]));for(let t=0;t<e["length"];t++){const b=e[t],S=D["skills"][b];S&&S["weight"]&&a[a0_0x5592("0x626")](b)}this[a0_0x5592("0x2b9")]["array"]=a}else this["closeBtn"]["x"]=360;const x={pc:I,pic:z,ppc:H,ptc:M},c={[C[a0_0x5592("0xb2d")][0]]:x};C[a0_0x5592("0x965")][a0_0x5592("0xfa")](c,()=>{}),C[a0_0x5592("0x965")][a0_0x5592("0x3ba")](I["getCombatValue"]())}[a0_0x5592("0x470")](){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]();const t=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")];let e=!!(t[a0_0x5592("0x257")]>0);const a=window[a0_0x5592("0x950")];e&&a&&"unlock"==a[0]&&(a[0]=t[a0_0x5592("0x9d5")]+1>15?1:t[a0_0x5592("0x9d5")]+1),e||(window[a0_0x5592("0x950")]="tips"),Laya["Scene"]["open"]("LobbyScene.scene")}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0xd0")];t["parent"][a0_0x5592("0x143")]&&t[a0_0x5592("0x3b0")]++}}class Pa extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["closeBtn"]=null,this[a0_0x5592("0xb28")]=null,this[a0_0x5592("0x7f8")]=null,this[a0_0x5592("0x491")]=null,this["currHp"]=null,this[a0_0x5592("0x53d")]=null,this[a0_0x5592("0xf6")]=null,this["souCloBtn"]=null,this[a0_0x5592("0x3d2")]=null,this[a0_0x5592("0x48f")]=null,this[a0_0x5592("0x72b")]=null}["onEnable"](){this[a0_0x5592("0x8a4")]=Y["instance"],this["setClick"](this[a0_0x5592("0x20")],this[a0_0x5592("0x470")],this),this["setClick"](this[a0_0x5592("0x7f8")],this[a0_0x5592("0x470")],this),this[a0_0x5592("0x68")](this[a0_0x5592("0xb28")],this["onReturnClick"],this);const t=this[a0_0x5592("0x8a4")][a0_0x5592("0x4ca")];this[a0_0x5592("0x491")]["text"]=O[a0_0x5592("0x77")](t[a0_0x5592("0x1fa")])+" ",this[a0_0x5592("0x5bd")]["text"]=O["formatNumber"](t[a0_0x5592("0x257")])+" ";const l=[];for(const n in t["skills"])l[a0_0x5592("0x626")](parseInt(n));this[a0_0x5592("0x53d")][a0_0x5592("0x447")]=Ia,this["skills"][a0_0x5592("0x6be")]="",this[a0_0x5592("0x53d")][a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")]["create"](this,(t,e)=>{const a=t[a0_0x5592("0x433")](0);if(!a)return;const i=a[a0_0x5592("0xab9")](a0_0x5592("0x4db")),r=a["getChildByName"]("num"),s=a[a0_0x5592("0xab9")]("icon");r["visible"]=!1;const n=l[e],o=D[a0_0x5592("0x53d")][n];s[a0_0x5592("0xa20")](.8,.8),s[a0_0x5592("0x8fa")]=bt[o["id"]],o&&(i[a0_0x5592("0x1e3")]=o[a0_0x5592("0x749")])},null,!1),this["skills"][a0_0x5592("0xa3f")]=l;const e=this["skills"][a0_0x5592("0x2ed")],a=e["x"];e["x"]=-700;const i=this[a0_0x5592("0xf6")];i[a0_0x5592("0xa37")]=.7,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{Laya["Tween"]["to"](e,{x:a},300,Laya["Ease"]["circOut"]),Laya[a0_0x5592("0x6eb")]["to"](i,{scaleY:1},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x595")])});let r=Laya[a0_0x5592("0x13e")]["getItem"](a0_0x5592("0x244"));r||(r="1"),r=parseInt(r),this[a0_0x5592("0x8fb")][a0_0x5592("0x143")]=!r,this[a0_0x5592("0x3d2")]["visible"]=!!r,this[a0_0x5592("0x68")](this[a0_0x5592("0x8fb")],()=>{Laya[a0_0x5592("0x262")][a0_0x5592("0x4d8")](1),Laya[a0_0x5592("0x262")][a0_0x5592("0x9d")](.5);Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")]("Plane.Mute","1"),this["souCloBtn"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x3d2")][a0_0x5592("0x143")]=!0},this),this[a0_0x5592("0x68")](this[a0_0x5592("0x3d2")],()=>{Laya["SoundManager"]["setSoundVolume"](0),Laya["SoundManager"][a0_0x5592("0x9d")](0);Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")]("Plane.Mute","0"),this[a0_0x5592("0x8fb")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x3d2")][a0_0x5592("0x143")]=!1},this);let s=Laya[a0_0x5592("0x13e")]["getItem"](a0_0x5592("0x399"));s||(s="1"),s=parseInt(s),this[a0_0x5592("0x48f")][a0_0x5592("0x143")]=!s,this["vibOpenBtn"][a0_0x5592("0x143")]=!!s,this[a0_0x5592("0x68")](this[a0_0x5592("0x48f")],()=>{Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")]("Plane.Vibrate","1"),this[a0_0x5592("0x8a4")][a0_0x5592("0x78f")]=!0,this[a0_0x5592("0x48f")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x72b")][a0_0x5592("0x143")]=!0},this),this["setClick"](this[a0_0x5592("0x72b")],()=>{Laya[a0_0x5592("0x13e")][a0_0x5592("0x425")](a0_0x5592("0x399"),"0"),this[a0_0x5592("0x8a4")][a0_0x5592("0x78f")]=!1,this[a0_0x5592("0x48f")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x72b")]["visible"]=!1},this)}[a0_0x5592("0x470")](){Laya["Tween"]["to"](this["owner"],{scaleX:0,scaleY:0,alpha:0},100,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0x953")]&&(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]=P[a0_0x5592("0xa5")]),this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()})),R[a0_0x5592("0xcf")](F["ClosePauseDialog"])}[a0_0x5592("0x22")](){Laya["Scene"][a0_0x5592("0x4c9")](a0_0x5592("0x59b"))}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}}class Oa extends t{constructor(){super(),this["light"]=null}[a0_0x5592("0x880")](){R["on"](a0_0x5592("0x9e0"),this,t=>{if(this[a0_0x5592("0x8a0")]["__light__"]){const e=this[a0_0x5592("0x8a0")],a=e[a0_0x5592("0xab9")]("light");if(a){a["visible"]=!0;const i=e["localToGlobal"](new Laya[a0_0x5592("0x201")](a["x"],a["y"])),r=t["globalToLocal"](i);a[a0_0x5592("0x6f7")](r["x"],r["y"]),t[a0_0x5592("0x231")](a),Laya["Tween"]["to"](a,{scaleX:1,scaleY:1},150,Laya["Ease"][a0_0x5592("0x5")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](a,{alpha:0},150,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{t["addChild"](a)}))}))}}})}["onDisable"](){R["offAllCaller"](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this)}}class Na extends t{constructor(){super()}["onEnable"](){const t=this[a0_0x5592("0x8a0")]["getChildByName"]("coin");t[a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")],t["on"](Laya[a0_0x5592("0x690")]["STOPPED"],this,()=>{this["owner"]["removeSelf"]()}),t["templet"]?(t[a0_0x5592("0x7c2")](.4),t["play"](0,!1)):Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](300,this,()=>{this["owner"]["removeSelf"]()})}["onDisable"](){const t=this[a0_0x5592("0x8a0")][a0_0x5592("0xab9")](a0_0x5592("0x7e0"));t[a0_0x5592("0x5c7")](this),t[a0_0x5592("0x27f")](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}}class Ba extends t{constructor(){super()}[a0_0x5592("0x880")](){const t=this[a0_0x5592("0x8a0")];t["alpha"]=1,Laya[a0_0x5592("0x6eb")]["to"](t,{alpha:0},300,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{t[a0_0x5592("0xaa4")]()}))}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6eb")]["clearAll"](this[a0_0x5592("0x8a0")]),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}}class Fa extends t{constructor(){super()}[a0_0x5592("0x880")](){const t=this[a0_0x5592("0x8a0")];t["alpha"]=1,Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](300,this,()=>{Laya["Tween"]["to"](t,{alpha:0},100,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}))})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}}class Va extends t{constructor(){super()}[a0_0x5592("0x880")](){const t=this[a0_0x5592("0x8a0")][a0_0x5592("0xab9")](a0_0x5592("0x7e0"));t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{this["owner"]["removeSelf"]()}),t["templet"]?t[a0_0x5592("0x590")](0,!1):Laya["timer"]["once"](320,this,()=>{this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()})}[a0_0x5592("0x4fd")](){const t=this[a0_0x5592("0x8a0")]["getChildByName"]("coin");t["offAllCaller"](this),t["stop"](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}}class Ua extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x8fa")]=null,this[a0_0x5592("0x5b6")]=5}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")]}["onUpdate"](){this[a0_0x5592("0x8a4")]["gameState"]==P["START"]&&this[a0_0x5592("0x8fa")]&&(this[a0_0x5592("0x8fa")]["rotation"]+=this[a0_0x5592("0x5b6")])}}class ka extends t{constructor(){super(),this[a0_0x5592("0x1c4")]=null}["onEnable"](){const t=this[a0_0x5592("0x1c4")];if(!t)return;t[a0_0x5592("0x14")]=0;const e=()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{alpha:1},250,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya["Tween"]["to"](t,{alpha:0},250,Laya["Ease"]["circIn"])}))};e(),this[a0_0x5592("0xaf2")](500,e,this,3)}["onDisable"](){}}class Ga extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["enemyCom"]=null,this[a0_0x5592("0x38e")]=null,this["eskillCom"]=null,this["currSkill"]=null,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1,this[a0_0x5592("0x739")]=null,this[a0_0x5592("0x9cb")]=null,this[a0_0x5592("0x491")]=0,this[a0_0x5592("0x3e3")]=0,this["skill2001Pre"]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0xaa2")])}[a0_0x5592("0x880")](){if(this["ins"]=Y["instance"],this[a0_0x5592("0xa17")]=this["owner"]["getComponent"](Zt),this[a0_0x5592("0x9e3")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](jt),this[a0_0x5592("0x38e")]=this["owner"][a0_0x5592("0x751")](ae),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")])return;const i=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")];this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!0,this[a0_0x5592("0x9fc")]=!1,this["inited"]=!1,this["isend"]=!1;const r=i[a0_0x5592("0x644")][a0_0x5592("0xae0")]("|"),s=i[a0_0x5592("0x277")][a0_0x5592("0xae0")]("|");R["on"](F[a0_0x5592("0x560")],this,(t,e,a)=>{if(e==this[a0_0x5592("0xa17")][a0_0x5592("0xa02")]&&t==i[a0_0x5592("0xb2e")]){if(this[a0_0x5592("0x739")]){let t=0;1001==a&&(t=1),1002==a&&(t=0),1003==a&&(t=2),this[a0_0x5592("0x739")][a0_0x5592("0x590")](t,!1)}this[a0_0x5592("0x9fc")]=!0,this[a0_0x5592("0x750")]=a,this[a0_0x5592("0x491")]=parseFloat(r[a-1001]),this[a0_0x5592("0x3e3")]=parseFloat(s[a-1001])}}),R["on"](F[a0_0x5592("0x7fb")],this,()=>{this["isend"]=!0,this[a0_0x5592("0x739")]&&this["ske"][a0_0x5592("0x27")]&&this[a0_0x5592("0x739")]["play"](3,!1)})}[a0_0x5592("0x4fd")](){R["offAllCaller"](this),this[a0_0x5592("0x739")]&&(this["ske"]["offAllCaller"](this),this[a0_0x5592("0x739")]["stop"]())}[a0_0x5592("0x8df")](){const t=this[a0_0x5592("0x739")];t["on"](Laya["Event"][a0_0x5592("0x6e6")],this,this[a0_0x5592("0x7c8")]),t["on"](Laya["Event"][a0_0x5592("0x992")],this,this["completeHandler"]),t&&t[a0_0x5592("0x27")]&&(t["play"](3,!1),t[a0_0x5592("0x9f3")]()),t[a0_0x5592("0x4ea")]=[new Laya["ColorFilter"]],this[a0_0x5592("0xa17")][a0_0x5592("0x739")]=t,this["isend"]&&R[a0_0x5592("0xcf")](F["EnemyEnd"])}[a0_0x5592("0x73a")](){this[a0_0x5592("0x38e")]&&this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]&&(this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!1),this["eskillCom"]&&!this[a0_0x5592("0x9e3")][a0_0x5592("0x617")]&&this[a0_0x5592("0x9e3")][a0_0x5592("0x141")](),this[a0_0x5592("0x739")][a0_0x5592("0x590")](4,!0)}["onEvent"](t){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P["START"]&&this[a0_0x5592("0x9fc")]&&("b2"==t[a0_0x5592("0x6c7")]?this[a0_0x5592("0x398")]():"b1"==t[a0_0x5592("0x6c7")]?this[a0_0x5592("0x1d6")]():"b3"==t[a0_0x5592("0x6c7")]&&this[a0_0x5592("0x24b")]())}[a0_0x5592("0x398")](){const s=this[a0_0x5592("0x8a0")],n=(this["enemyCom"][a0_0x5592("0x2e2")],[-60,-40,-20,0,20,40,60]),o=p[2001]["b1"],e=a=>{for(let e=0;e<n["length"];e++){const i=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x105")],this["eskillCom"][a0_0x5592("0x3eb")]);let t=i[a0_0x5592("0x751")](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this["currAtt"],0,0,0,0);const r=i[a0_0x5592("0x751")](f);r[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,1),r[a0_0x5592("0x5b6")]=this["currBsp"],r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],i[a0_0x5592("0x6f7")](s["x"]+o[a]["x"]+n[e],s["y"]+o[a]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](i)}};for(let t=0;t<2;t++)e(t),this[a0_0x5592("0xaf2")](100,()=>{e(t)},this,3)}[a0_0x5592("0x1d6")](){const s=this[a0_0x5592("0x8a0")],n=(this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],p[2001]["b2"]),o=[this[a0_0x5592("0xce")](-.64,.77),this["getVec3"](-.34,.94),this[a0_0x5592("0xce")](0,1),this[a0_0x5592("0xce")](.34,.94),this[a0_0x5592("0xce")](.64,.77)],e=a=>{for(let t=0;t<o[a0_0x5592("0xb0e")];t++)for(let e=0;e<o[a0_0x5592("0xb0e")];e++){const i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],this[a0_0x5592("0x9cb")]);i[a0_0x5592("0xa20")](.6,.6);let t=i["getComponent"](X);t||(t=i[a0_0x5592("0x2a6")](X)),t["setData"](this["currAtt"],0,0,0,0);const r=i["getComponent"](f);r[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")],r["norV3"]=o[e][a0_0x5592("0x408")](),r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],i[a0_0x5592("0x6f7")](s["x"]+n[a]["x"],s["y"]+n[a]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](i)}};for(let t=0;t<2;t++)e(t),this["schedule"](100,()=>{e(t)},this,5)}[a0_0x5592("0x24b")](){const t=this["owner"],s=(this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")],[-60,-30,0,30,60]),n=[0,0,0,0,0],o=p[2001]["b3"],l=this[a0_0x5592("0x5a7")](t["x"],t["y"]),e=a=>{for(let e=0;e<s[a0_0x5592("0xb0e")];e++){const i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],this["skill2001Pre"]);i[a0_0x5592("0xa20")](.6,.6);let t=i[a0_0x5592("0x751")](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const r=i[a0_0x5592("0x751")](f);r[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")],r[a0_0x5592("0x918")]=this["getVec3"](0,1),r["state"]=P[a0_0x5592("0xa5")],i[a0_0x5592("0x6f7")](l["x"]+o[a]["x"]+s[e],l["y"]+o[a]["y"]+n[e]),this["ins"][a0_0x5592("0x5be")][a0_0x5592("0x231")](i)}};for(let t=0;t<2;t++)e(t),this["schedule"](100,()=>{e(t)},this,5)}[a0_0x5592("0x3de")](){const t=this["ske"];!this["inited"]&&t&&t[a0_0x5592("0x27")]&&(this[a0_0x5592("0x617")]=!0,this[a0_0x5592("0x8df")]())}}class Ha extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0xa17")]=null,this["ecolCom"]=null,this[a0_0x5592("0x9e3")]=null,this[a0_0x5592("0x750")]=null,this[a0_0x5592("0x491")]=0,this[a0_0x5592("0x3e3")]=0,this[a0_0x5592("0x17c")]=null,this["fbulPre"]=null,this[a0_0x5592("0x1e9")]=null,this["cirBulPre"]=null,this[a0_0x5592("0x739")]=null,this[a0_0x5592("0x9fc")]=!1,this["inited"]=!1,this["isend"]=!1}["onEnable"](){if(this["bulPre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]),this[a0_0x5592("0x6ea")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")]),this[a0_0x5592("0x1e9")]=this["getRes"](w["battle"]["EnemySkill11"]),this[a0_0x5592("0x9da")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0xb2")]),this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),this[a0_0x5592("0x9e3")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](jt),this[a0_0x5592("0x38e")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](ae),!this["enemyCom"]||!this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")])return;const i=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")];this["ecolCom"]["invincible"]=!0,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1;const r=i[a0_0x5592("0x644")]["split"]("|"),s=i[a0_0x5592("0x277")]["split"]("|");R["on"](F["EnemyHit"],this,(t,e,a)=>{if(e==this[a0_0x5592("0xa17")]["eid"]&&t==i[a0_0x5592("0xb2e")]){if(this[a0_0x5592("0x739")]){let t=0;1011==a&&(t=1),1012==a&&(t=0),1013==a&&(t=2),this[a0_0x5592("0x739")][a0_0x5592("0x590")](t,!1)}this[a0_0x5592("0x9fc")]=!0,this[a0_0x5592("0x750")]=a,this[a0_0x5592("0x491")]=parseFloat(r[a-1011]),this[a0_0x5592("0x3e3")]=parseFloat(s[a-1011])}}),R["on"](F[a0_0x5592("0x7fb")],this,()=>{this["isend"]=!0,this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&this[a0_0x5592("0x739")][a0_0x5592("0x590")](3,!1)})}[a0_0x5592("0x4fd")](){R["offAllCaller"](this),this["ske"]&&(this[a0_0x5592("0x739")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")]["stop"]())}[a0_0x5592("0x8df")](){const t=this[a0_0x5592("0x739")];t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x6e6")],this,this[a0_0x5592("0x7c8")]),t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,this[a0_0x5592("0x73a")]),t&&t[a0_0x5592("0x27")]&&(t[a0_0x5592("0x590")](3,!1),t["paused"]()),t[a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]],this[a0_0x5592("0xa17")][a0_0x5592("0x739")]=t,this[a0_0x5592("0x104")]&&R[a0_0x5592("0xcf")](F[a0_0x5592("0x7fb")])}[a0_0x5592("0x73a")](){this[a0_0x5592("0x38e")]&&this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]&&(this["ecolCom"]["invincible"]=!1),this[a0_0x5592("0x9e3")]&&!this[a0_0x5592("0x9e3")][a0_0x5592("0x617")]&&this["eskillCom"]["initSkill"](),this[a0_0x5592("0x739")][a0_0x5592("0x590")](4,!0)}[a0_0x5592("0x7c8")](t){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&this["hited"]&&("b2"==t[a0_0x5592("0x6c7")]?this[a0_0x5592("0x279")]():"b1"==t[a0_0x5592("0x6c7")]?this[a0_0x5592("0x55e")]():"b3"==t[a0_0x5592("0x6c7")]&&this["skill1013"]())}[a0_0x5592("0x279")](){const e=this[a0_0x5592("0x8a0")],a=p[2002]["b1"],r=[.5*Math["PI"],-30/180*Math["PI"],-150/180*Math["PI"]],s=[this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](.5,-.87),this[a0_0x5592("0xce")](-.5,-.87)];for(let t=0;t<2;t++){const o=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],this[a0_0x5592("0x1e9")]);o[a0_0x5592("0x6f7")](e["x"]+a[t]["x"],e["y"]+a[t]["y"]),this["ins"][a0_0x5592("0x5be")][a0_0x5592("0x231")](o),Laya["Tween"]["to"](o,{y:o["y"]+200},200,Laya["Ease"][a0_0x5592("0x98c")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya["timer"]["once"](450,this[a0_0x5592("0x8a4")],()=>{for(let t=0;t<r[a0_0x5592("0xb0e")];t++){const e=r[t],a=o["x"]+100*Math["cos"](e),i=o["y"]-100*Math[a0_0x5592("0x2d2")](e),n=s[t];this[a0_0x5592("0xaf2")](100,()=>{const s=this[a0_0x5592("0x4c9")](w["battle"]["EnemySkill1011"],this[a0_0x5592("0x9da")]);s[a0_0x5592("0x6f7")](o["x"],o["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](s),Laya["Tween"]["to"](s,{x:a,y:i},100,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{for(let e=0;e<2;e++){const a=e?this[a0_0x5592("0xce")](-n["x"],-n["y"]):n["clone"](),i=this[a0_0x5592("0x4c9")](w["battle"][a0_0x5592("0x105")],this[a0_0x5592("0x17c")]);let t=i[a0_0x5592("0x751")](X);t||(t=i["addComponent"](X)),t[a0_0x5592("0x971")](this["currAtt"],0,0,0,0);const r=i[a0_0x5592("0x751")](f);r[a0_0x5592("0x918")]=a,r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],r["speed"]=this[a0_0x5592("0x3e3")],i[a0_0x5592("0x6f7")](s["x"],s["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](i)}s[a0_0x5592("0xaa4")]()}))},this[a0_0x5592("0x8a4")],12,null,!0,()=>{o["removeSelf"]()})}})}))}}["skill1012"](){const e=this["owner"],a=p[2002]["b2"],o=[this[a0_0x5592("0xce")](0,1),this[a0_0x5592("0xce")](.34,.94),this["getVec3"](.64,.77),this[a0_0x5592("0xce")](.87,.5),this[a0_0x5592("0xce")](.98,.17),this[a0_0x5592("0xce")](.98,-.17),this[a0_0x5592("0xce")](.87,-.5),this[a0_0x5592("0xce")](.64,-.77),this[a0_0x5592("0xce")](.34,-.94),this[a0_0x5592("0xce")](0,-1),this[a0_0x5592("0xce")](-.34,-.94),this[a0_0x5592("0xce")](-.64,-.77)];for(let t=0;t<2;t++){const l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],this["rotBulPre"]);l[a0_0x5592("0x6f7")](e["x"]+a[t]["x"],e["y"]+a[t]["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](l),Laya[a0_0x5592("0x6eb")]["to"](l,{y:l["y"]+200},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](450,this["ins"],()=>{let n=0;this["schedule"](100,()=>{const t=o[n],e=l["x"]+150*t["x"],a=l["y"]+150*t["y"],i=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],this["bulPre"]);let r=i[a0_0x5592("0x751")](X);r||(r=i[a0_0x5592("0x2a6")](X)),r[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const s=i[a0_0x5592("0x751")](f);s[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](-t["x"],-t["y"]),s[a0_0x5592("0x35e")]=P["READY"],s["speed"]=this[a0_0x5592("0x3e3")],i[a0_0x5592("0x6f7")](l["x"],l["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](i),Laya[a0_0x5592("0x6eb")]["to"](i,{x:e,y:a},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya["timer"]["once"](1e3-80*n,this[a0_0x5592("0x8a4")],()=>{s["state"]=P[a0_0x5592("0xa5")]})})),n++},this[a0_0x5592("0x8a4")],o[a0_0x5592("0xb0e")],null,!0,()=>{l[a0_0x5592("0xaa4")]()})})}))}}[a0_0x5592("0x183")](){const n=this[a0_0x5592("0x8a0")],o=p[2002]["b3"],t=[[this[a0_0x5592("0xce")](.09,1),this[a0_0x5592("0xce")](0,1),this["getVec3"](-.09,1)],[this[a0_0x5592("0xce")](.22,.98),this[a0_0x5592("0xce")](.13,.99),this[a0_0x5592("0xce")](.04,1),this["getVec3"](-.04,1),this[a0_0x5592("0xce")](-.13,.99),this[a0_0x5592("0xce")](-.22,.98)],[this[a0_0x5592("0xce")](.34,.94),this[a0_0x5592("0xce")](.26,.97),this[a0_0x5592("0xce")](.17,.98),this[a0_0x5592("0xce")](.09,1),this[a0_0x5592("0xce")](0,1),this[a0_0x5592("0xce")](-.09,1),this[a0_0x5592("0xce")](-.17,.98),this["getVec3"](-.26,.97),this[a0_0x5592("0xce")](-.34,.94)]];let e=0;this[a0_0x5592("0xaf2")](100,()=>{const a=t[e];for(let e=0;e<a[a0_0x5592("0xb0e")];e++){const i=a[e],r=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")],this[a0_0x5592("0x6ea")]);let t=r[a0_0x5592("0x751")](X);t||(t=r[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const s=r[a0_0x5592("0x751")](f);s[a0_0x5592("0x918")]=i,s[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],s["speed"]=this[a0_0x5592("0x3e3")],r[a0_0x5592("0x6f7")](n["x"]+o[0]["x"],n["y"]+o[0]["y"]),this["ins"]["eneBulNode"][a0_0x5592("0x231")](r)}e++},this,3)}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t[a0_0x5592("0x27")]&&(this[a0_0x5592("0x617")]=!0,this[a0_0x5592("0x8df")]())}}class za extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x355")]=null,this["state"]=P["READY"],this[a0_0x5592("0x3b")]=null,this[a0_0x5592("0x94e")]=0,this["centerPos"]=null,this["radius"]=100,this["angle"]=0,this[a0_0x5592("0x5b6")]=.4,this[a0_0x5592("0x42e")]=1,this[a0_0x5592("0x627")]=null}get[a0_0x5592("0x918")](){return this[a0_0x5592("0x355")]}set[a0_0x5592("0x918")](t){this[a0_0x5592("0x355")]=t;const e=this[a0_0x5592("0x8a0")];e&&(e[a0_0x5592("0x3b0")]=-(180-Math["atan2"](t["x"],-t["y"])/Math["PI"]*180))}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this["state"]=P["START"];const t=this[a0_0x5592("0x8a4")],e=this["owner"];this["lastPos"]=this[a0_0x5592("0xce")](e["x"],e["y"]);const a=new Laya[a0_0x5592("0x745")],i=this[a0_0x5592("0x761")](b["E_DaoDan"]),r=Laya[a0_0x5592("0x745")]["instantiate"](i);a["addChild"](r),t[a0_0x5592("0xa88")][a0_0x5592("0xab9")](a0_0x5592("0xd"))[a0_0x5592("0x231")](a);let s=this[a0_0x5592("0xce")]();t[a0_0x5592("0x4bc")][a0_0x5592("0x7a8")](this[a0_0x5592("0xce")](e["x"],e["y"]),s),a[a0_0x5592("0x48b")]["position"]=s,this["s3d"]=a,this["addRadius"]=0,Laya[a0_0x5592("0x6eb")]["to"](this,{addRadius:2},3e3,Laya[a0_0x5592("0x4ec")]["quartIn"])}["onDisable"](){this["s3d"]&&Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](200,this,()=>{this["s3d"][a0_0x5592("0xaa4")](),this["recover"](this["owner"])}),R[a0_0x5592("0x5c7")](this)}["onCollisionEnter"](t,e){this["owner"][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x3de")](){if(this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;if(this[a0_0x5592("0x35e")]!=P[a0_0x5592("0xa5")])return;if(!this["centerPos"])return;this[a0_0x5592("0x8a4")];const t=this[a0_0x5592("0x8a0")];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")],this[a0_0x5592("0x5b6")];let e=this[a0_0x5592("0x8a4")][a0_0x5592("0x747")];this[a0_0x5592("0x4ad")]+=1*this["add"],this[a0_0x5592("0xa5a")]+=this[a0_0x5592("0x94e")];const a=this[a0_0x5592("0x4ad")]/180*Math["PI"];t["x"]=this[a0_0x5592("0x646")]["x"]+this[a0_0x5592("0xa5a")]*Math[a0_0x5592("0x2d9")](a)*.8,t["y"]=this[a0_0x5592("0x646")]["y"]-this[a0_0x5592("0xa5a")]*Math[a0_0x5592("0x2d2")](a);const i=this[a0_0x5592("0xce")]();Laya[a0_0x5592("0x97c")][a0_0x5592("0x634")](this["getVec3"](t["x"],t["y"]),this[a0_0x5592("0x3b")],i);const r=Math[a0_0x5592("0x23d")](i["x"],-i["y"])/Math["PI"]*180+180;t[a0_0x5592("0x3b0")]=r,this[a0_0x5592("0x3b")]=this[a0_0x5592("0xce")](t["x"],t["y"]),this[a0_0x5592("0x627")]&&this[a0_0x5592("0x627")][a0_0x5592("0x48b")]&&this[a0_0x5592("0x627")]["transform"][a0_0x5592("0x2dc")](this[a0_0x5592("0xce")](i["x"]/e,0,i["y"]/e)),(t["x"]<=-360||t["x"]>=1080||t["y"]<=-640||t["y"]>=1920)&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")](),this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")][a0_0x5592("0x532")],this[a0_0x5592("0x1b2")])}}class Wa extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0xa17")]=null,this[a0_0x5592("0x38e")]=null,this["eskillCom"]=null,this[a0_0x5592("0x750")]=null,this[a0_0x5592("0x491")]=0,this["currBsp"]=0,this[a0_0x5592("0x17c")]=null,this["mbulPre"]=null,this[a0_0x5592("0x166")]=null,this["rotBulPre"]=null,this[a0_0x5592("0x9da")]=null,this[a0_0x5592("0x739")]=null,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x17c")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")]),this["mbulPre"]=this["getRes"](w["battle"][a0_0x5592("0x7f9")]),this[a0_0x5592("0x166")]=this[a0_0x5592("0x761")](w["battle"][a0_0x5592("0xaa2")]),this[a0_0x5592("0x1e9")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")]),this["cirBulPre"]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0xb2")]),this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),this[a0_0x5592("0x38e")]=this[a0_0x5592("0x8a0")]["getComponent"](ae),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")])return;this[a0_0x5592("0x9e3")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](jt);const i=this[a0_0x5592("0xa17")]["edata"];this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!0,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1;const r=i[a0_0x5592("0x644")][a0_0x5592("0xae0")]("|"),s=i[a0_0x5592("0x277")][a0_0x5592("0xae0")]("|");R["on"](F["EnemyHit"],this,(t,e,a)=>{if(e==this[a0_0x5592("0xa17")]["eid"]&&t==i["type"]){if(this["ske"]){let t=0;1021==a&&(t=0),1022==a&&(t=1),1023==a&&(t=1),this["ske"][a0_0x5592("0x590")](t,!1)}this["hited"]=!0,this[a0_0x5592("0x750")]=a,this["currAtt"]=parseFloat(r[a-1021]),this[a0_0x5592("0x3e3")]=parseFloat(s[a-1021])}}),R["on"](F["EnemyEnd"],this,()=>{this[a0_0x5592("0x104")]=!0,this[a0_0x5592("0x739")]&&this["ske"][a0_0x5592("0x27")]&&this["ske"][a0_0x5592("0x590")](3,!1)})}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this["ske"]&&(this[a0_0x5592("0x739")]["offAllCaller"](this),this[a0_0x5592("0x739")][a0_0x5592("0x27f")]())}[a0_0x5592("0x3de")](){const t=this["ske"];!this[a0_0x5592("0x617")]&&t&&t[a0_0x5592("0x27")]&&(this[a0_0x5592("0x617")]=!0,this[a0_0x5592("0x8df")]())}["parseComplete"](){const t=this[a0_0x5592("0x739")];t["on"](Laya["Event"]["LABEL"],this,this[a0_0x5592("0x7c8")]),t["on"](Laya[a0_0x5592("0x690")]["STOPPED"],this,this[a0_0x5592("0x73a")]),t&&t[a0_0x5592("0x27")]&&(t[a0_0x5592("0x590")](3,!1),t["paused"]()),t[a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]],this[a0_0x5592("0xa17")][a0_0x5592("0x739")]=t,this[a0_0x5592("0x104")]&&R[a0_0x5592("0xcf")](F[a0_0x5592("0x7fb")])}[a0_0x5592("0x73a")](){this[a0_0x5592("0x38e")]&&this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]&&(this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!1),this["eskillCom"]&&!this[a0_0x5592("0x9e3")][a0_0x5592("0x617")]&&this[a0_0x5592("0x9e3")][a0_0x5592("0x141")](),this[a0_0x5592("0x739")][a0_0x5592("0x590")](4,!0)}[a0_0x5592("0x7c8")](t){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P["START"]&&this[a0_0x5592("0x9fc")]&&(1021==this["currSkill"]?this[a0_0x5592("0x459")]():1022==this[a0_0x5592("0x750")]?this["skill1022"]():1023==this["currSkill"]&&this[a0_0x5592("0x9cc")]())}[a0_0x5592("0x459")](){const a=this[a0_0x5592("0x8a0")],i=p[2003]["b1"],r=[this[a0_0x5592("0xce")](.71,-.71),this[a0_0x5592("0xce")](-.71,-.71),this[a0_0x5592("0xce")](-.71,-.71),this[a0_0x5592("0xce")](.71,-.71)],s=[this[a0_0x5592("0xce")](-.71,-.71),this[a0_0x5592("0xce")](.71,-.71),this[a0_0x5592("0xce")](-.71,.71),this[a0_0x5592("0xce")](.71,.71)],n=[50,200];for(let e=0;e<s[a0_0x5592("0xb0e")];e++)for(let t=0;t<n[a0_0x5592("0xb0e")];t++){const o=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0xb2")],this[a0_0x5592("0x9da")]),l=a["x"]+i[e]["x"],_=a["y"]+i[e]["y"];o[a0_0x5592("0x6f7")](l,_),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")]["addChild"](o);const h=l+n[t]*s[e]["x"],x=_+n[t]*s[e]["y"],c=r[e];Laya["Tween"]["to"](o,{x:h,y:x},200*n[t]/50,Laya["Ease"][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{this["schedule"](1e3,()=>{for(let e=0;e<2;e++){const a=e?this["getVec3"](-c["x"],-c["y"]):c[a0_0x5592("0x408")](),i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x105")],this["bulPre"]);let t=i["getComponent"](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const r=i["getComponent"](f);r["norV3"]=a,r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],r["speed"]=this["currBsp"],i[a0_0x5592("0x6f7")](o["x"],o["y"]),this[a0_0x5592("0x8a4")]["player2Node"][a0_0x5592("0x231")](i)}},this,3,null,!0,()=>{o[a0_0x5592("0xaa4")]()})})}))}}[a0_0x5592("0x581")](){const o=this[a0_0x5592("0x8a0")],l=(p[2003]["b2"],[this["getVec3"](-.71,-.71),this[a0_0x5592("0xce")](.71,-.71),this[a0_0x5592("0xce")](-.71,.71),this[a0_0x5592("0xce")](.71,.71)]),_=[45,135,-45,-135],h=[this["getVec3"](-250,-23),this["getVec3"](250,-23),this[a0_0x5592("0xce")](-250,-23),this[a0_0x5592("0xce")](250,-23)],e=t=>{if(!this[a0_0x5592("0x761")](b[a0_0x5592("0x85b")]))return void S[a0_0x5592("0x1eb")]([b["E_DaoDan"]]);a0_0x5592("0x993")!=typeof t&&(t=t[0]);const e=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x7f9")],this[a0_0x5592("0x6ef")]);let a=e[a0_0x5592("0x751")](X);a||(a=e[a0_0x5592("0x2a6")](X)),a[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const i=e[a0_0x5592("0x751")](za);i["norV3"]=l[t]["clone"](),i[a0_0x5592("0x646")]=this["getVec3"](o["x"]+h[t]["x"],o["y"]+h[t]["y"]),i[a0_0x5592("0xa5a")]=180,i["angle"]=_[t],i[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")],i[a0_0x5592("0x42e")]=0==t||3==t?1:-1;const r=i[a0_0x5592("0x4ad")]/180*Math["PI"],s=i["centerPos"]["x"]+i["radius"]*Math["cos"](r)*.8,n=i[a0_0x5592("0x646")]["y"]-i[a0_0x5592("0xa5a")]*Math["sin"](r);e[a0_0x5592("0x6f7")](s,n),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](e)};for(let t=0;t<l[a0_0x5592("0xb0e")];t++)e(t),this[a0_0x5592("0xaf2")](1e3,e,this,3,[t],!0)}["skill1023"](){const e=this[a0_0x5592("0x8a0")],a=p[2003]["b3"],i=[this[a0_0x5592("0xce")](-.71,-.71),this[a0_0x5592("0xce")](.71,-.71),this["getVec3"](-.71,.71),this[a0_0x5592("0xce")](.71,.71)],r=[this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](.87,-.5),this["getVec3"](.5,-.87),this["getVec3"](0,-1),this[a0_0x5592("0xce")](-.5,-.87),this["getVec3"](-.87,-.5),this[a0_0x5592("0xce")](-1,0),this[a0_0x5592("0xce")](-.87,.5),this[a0_0x5592("0xce")](-.5,.87),this["getVec3"](0,1),this[a0_0x5592("0xce")](.5,.87),this[a0_0x5592("0xce")](.87,.5)];for(let t=0;t<i[a0_0x5592("0xb0e")];t++){const s=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x55d")],this[a0_0x5592("0x1e9")]),n=e["x"]+a[t]["x"],o=e["y"]+a[t]["y"];s[a0_0x5592("0x6f7")](n,o),this[a0_0x5592("0x8a4")]["eneBulNode"][a0_0x5592("0x231")](s);const l=n+50*i[t]["x"],_=o+50*i[t]["y"];Laya[a0_0x5592("0x6eb")]["to"](s,{x:l,y:_},200,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x98c")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](450,this[a0_0x5592("0x8a4")],()=>{for(let a=0;a<r["length"];a++){const i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],this[a0_0x5592("0x166")]);i[a0_0x5592("0xa20")](.6,.6);let t=i["getComponent"](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);let e=i[a0_0x5592("0x751")](f);e["speed"]=this[a0_0x5592("0x3e3")],e[a0_0x5592("0x918")]=r[a][a0_0x5592("0x408")](),e[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],i[a0_0x5592("0x6f7")](s["x"],s["y"]),this[a0_0x5592("0x8a4")]["eneBulNode"]["addChild"](i)}s[a0_0x5592("0xaa4")]()})}))}}}class Xa extends t{constructor(){super(),this["ins"]=null,this["enemyCom"]=null,this[a0_0x5592("0x38e")]=null,this[a0_0x5592("0x9e3")]=null,this["currSkill"]=null,this["currAtt"]=0,this["currBsp"]=0,this[a0_0x5592("0x4e7")]=null,this["bulletPre2"]=null,this[a0_0x5592("0x89e")]=null,this[a0_0x5592("0x739")]=null,this["hited"]=!1,this["inited"]=!1,this["isend"]=!1,this[a0_0x5592("0x3e5")]=-1}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x4e7")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")]),this[a0_0x5592("0x6f0")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")]),this[a0_0x5592("0x89e")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")]),this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this["enemyCom"]=this[a0_0x5592("0x8a0")]["getComponent"](Zt),this[a0_0x5592("0x38e")]=this[a0_0x5592("0x8a0")]["getComponent"](ae),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")])return;this["eskillCom"]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](jt);const i=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")];this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!0,this[a0_0x5592("0x9fc")]=!1,this["inited"]=!1,this[a0_0x5592("0x104")]=!1,this[a0_0x5592("0x3e5")]=-1;const r=i[a0_0x5592("0x644")][a0_0x5592("0xae0")]("|"),s=i[a0_0x5592("0x277")]["split"]("|");R["on"](F[a0_0x5592("0x560")],this,(t,e,a)=>{if(e==this[a0_0x5592("0xa17")][a0_0x5592("0xa02")]&&t==i[a0_0x5592("0xb2e")]){if(this[a0_0x5592("0x739")]){let t=0;1031==a&&(t=0),1032==a&&(t=1),1033==a&&(t=2),this["currAnimIndex"]=t}this[a0_0x5592("0x9fc")]=!0,this[a0_0x5592("0x750")]=a,this["currAtt"]=parseFloat(r[a-1031]),this[a0_0x5592("0x3e3")]=parseFloat(s[a-1031])}}),R["on"](F[a0_0x5592("0x7fb")],this,()=>{this[a0_0x5592("0x104")]=!0,this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&this[a0_0x5592("0x739")]["play"](3,!1)})}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")]&&(this[a0_0x5592("0x739")]["offAllCaller"](this),this[a0_0x5592("0x739")][a0_0x5592("0x27f")]())}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t[a0_0x5592("0x27")]&&(this[a0_0x5592("0x617")]=!0,this["parseComplete"]())}[a0_0x5592("0x8df")](){const t=this[a0_0x5592("0x739")];t["on"](Laya["Event"][a0_0x5592("0x6e6")],this,this[a0_0x5592("0x7c8")]),t["on"](Laya["Event"]["STOPPED"],this,this[a0_0x5592("0x73a")]),t&&t[a0_0x5592("0x27")]&&(t[a0_0x5592("0x590")](3,!1),t[a0_0x5592("0x9f3")]()),t[a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]],this["enemyCom"][a0_0x5592("0x739")]=t,this[a0_0x5592("0x104")]&&R[a0_0x5592("0xcf")](F[a0_0x5592("0x7fb")])}[a0_0x5592("0x73a")](){this[a0_0x5592("0x38e")]&&this["ecolCom"][a0_0x5592("0x98f")]&&(this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!1),this[a0_0x5592("0x9e3")]&&!this["eskillCom"][a0_0x5592("0x617")]&&this[a0_0x5592("0x9e3")][a0_0x5592("0x141")](),this["currAnimIndex"]>-1?(this[a0_0x5592("0x739")][a0_0x5592("0x590")](this[a0_0x5592("0x3e5")],!1),this[a0_0x5592("0x3e5")]=-1):this[a0_0x5592("0x739")][a0_0x5592("0x590")](4,!1)}[a0_0x5592("0x7c8")](t){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&this[a0_0x5592("0x9fc")]&&(1031==this[a0_0x5592("0x750")]?this[a0_0x5592("0x121")]():1032==this[a0_0x5592("0x750")]?this["skill1032"]():1033==this[a0_0x5592("0x750")]&&this[a0_0x5592("0x2ae")]())}["skill1031"](){const o=this[a0_0x5592("0x8a0")],l=[300,285],_=[110,105,100,95,90,85,80,75,70];let h=0;this[a0_0x5592("0xaf2")](200,()=>{if(!(h>1)){for(let e=0;e<_["length"];e++){const a=_[e]/180*Math["PI"],i=this[a0_0x5592("0x4c9")](w["battle"]["EnemySkill2001"],this[a0_0x5592("0x4e7")]);i[a0_0x5592("0xa20")](.6,.6);let t=i[a0_0x5592("0x751")](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const r=i[a0_0x5592("0x751")](f);r[a0_0x5592("0x918")]=this["getVec3"](),r["state"]=P["READY"],r[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")];const s=o["x"],n=o["y"]+20;i["pos"](s,n),this[a0_0x5592("0x8a4")][a0_0x5592("0x1af")]["addChild"](i),Laya[a0_0x5592("0x6eb")]["to"](i,{x:s+l[h]*Math[a0_0x5592("0x2d9")](a),y:n+l[h]*Math[a0_0x5592("0x2d2")](a)},600,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5f")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{let t=400-200*h;t<0&&(t=0),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](t,this,()=>{const t=this["ins"]["playerV2"];let e=this[a0_0x5592("0xce")]();Laya["Vector3"][a0_0x5592("0x634")](this[a0_0x5592("0xce")](t["x"],t["y"]),this[a0_0x5592("0xce")](i["x"],i["y"]),e),Laya[a0_0x5592("0x97c")][a0_0x5592("0x2c0")](e,r[a0_0x5592("0x918")]),r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]})}))}h++}},this,2)}["skill1032"](){const t=this[a0_0x5592("0x8a0")],e=[this[a0_0x5592("0xce")](.866,-.5),this["getVec3"](.5,-.866),this["getVec3"](-.866,-.5),this[a0_0x5592("0xce")](-.5,-.866),this[a0_0x5592("0xce")](.866,.5),this[a0_0x5592("0xce")](.5,.866),this["getVec3"](-.866,.5),this["getVec3"](-.5,.866)],_=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")],this[a0_0x5592("0x6f0")]),a=t["x"],i=t["y"]+118;_[a0_0x5592("0x6f7")](a,i),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](_),Laya["Tween"]["to"](_,{y:i+300},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5f")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](500,this,()=>{this[a0_0x5592("0xaf2")](500,()=>{for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const a=e[t];for(let e=0;e<4;e++){const i=e%2?3:1,r=this[a0_0x5592("0xce")](-a["y"],a["x"]);e>1&&(r["x"]*=-1,r["y"]*=-1);const s=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],this[a0_0x5592("0x4e7")]);s["scale"](.6,.6);let t=s["getComponent"](X);t||(t=s["addComponent"](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const n=s[a0_0x5592("0x751")](f);n[a0_0x5592("0x918")]=a,n["state"]=P[a0_0x5592("0x61e")],n["speed"]=this["currBsp"];const o=_["x"]+20*a["x"]+8*r["x"]*i,l=_["y"]+20*a["y"]+8*r["y"]*i;s[a0_0x5592("0x6f7")](o,l),this[a0_0x5592("0x8a4")][a0_0x5592("0x1af")][a0_0x5592("0x231")](s),Laya[a0_0x5592("0x6eb")]["to"](s,{x:o+150*a["x"],y:l+150*a["y"]},500,Laya["Ease"]["expoOut"],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](50,this,()=>{n[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]})}))}}},this,6,null,!0,()=>{_[a0_0x5592("0xaa4")]()})})}))}["skill1033"](){const l=this[a0_0x5592("0x8a0")],t=p[2004]["b3"],_=[200,180],h=[this[a0_0x5592("0xce")](.1736,.985),this[a0_0x5592("0xce")](.5,.866),this["getVec3"](.766,.6428),this["getVec3"](-.1736,.985),this[a0_0x5592("0xce")](-.5,.866),this[a0_0x5592("0xce")](-.766,.6428)];for(let o=0;o<t[a0_0x5592("0xb0e")];o++){const x=t[o];this["schedule"](500,()=>{for(let e=0;e<h["length"];e++){const a=h[e],i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x4e1")],this[a0_0x5592("0x89e")]);let t=i[a0_0x5592("0x751")](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const r=i[a0_0x5592("0x751")](f);r[a0_0x5592("0x918")]=a,r[a0_0x5592("0x35e")]=P[a0_0x5592("0x61e")],r[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")];const s=l["x"]+x["x"],n=l["y"]+x["y"];i["pos"](s,n),this[a0_0x5592("0x8a4")][a0_0x5592("0x1af")][a0_0x5592("0x231")](i),Laya[a0_0x5592("0x6eb")]["to"](i,{x:s+_[o]*a["x"],y:n+_[o]*a["y"]},500,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5f")],Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](50,this,()=>{r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")]})}))}},this,2)}}}class Ya extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0xa17")]=null,this[a0_0x5592("0x38e")]=null,this["eskillCom"]=null,this[a0_0x5592("0x750")]=null,this[a0_0x5592("0x491")]=0,this[a0_0x5592("0x3e3")]=0,this[a0_0x5592("0x4e7")]=null,this["bulletPre2"]=null,this[a0_0x5592("0x89e")]=null,this[a0_0x5592("0x739")]=null,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1,this["currAnimIndex"]=-1}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x4e7")]=this["getRes"](w["battle"]["EnemySkill3"]),this["bulletPre2"]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")]),this[a0_0x5592("0x89e")]=this["getRes"](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")]),this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](Zt),this[a0_0x5592("0x38e")]=this["owner"]["getComponent"](ae),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")]["edata"])return;this[a0_0x5592("0x9e3")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](jt);const i=this["enemyCom"]["edata"];this["ecolCom"][a0_0x5592("0x98f")]=!0,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1,this[a0_0x5592("0x3e5")]=-1;const r=i[a0_0x5592("0x644")][a0_0x5592("0xae0")]("|"),s=i[a0_0x5592("0x277")][a0_0x5592("0xae0")]("|");R["on"](F["EnemyHit"],this,(t,e,a)=>{if(e==this[a0_0x5592("0xa17")][a0_0x5592("0xa02")]&&t==i[a0_0x5592("0xb2e")]){if(this[a0_0x5592("0x739")]){let t=0;1041==a&&(t=0),1042==a&&(t=1),1043==a&&(t=2),this[a0_0x5592("0x3e5")]=t}this[a0_0x5592("0x9fc")]=!0,this[a0_0x5592("0x750")]=a,this[a0_0x5592("0x491")]=parseFloat(r[a-1041]),this[a0_0x5592("0x3e3")]=parseFloat(s[a-1041])}}),R["on"](F["EnemyEnd"],this,()=>{this[a0_0x5592("0x104")]=!0,this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")]["templet"]&&this[a0_0x5592("0x739")][a0_0x5592("0x590")](3,!1)})}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this["ske"]&&(this[a0_0x5592("0x739")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")]["stop"]())}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t["templet"]&&(this[a0_0x5592("0x617")]=!0,this[a0_0x5592("0x8df")]())}[a0_0x5592("0x8df")](){const t=this[a0_0x5592("0x739")];t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x6e6")],this,this[a0_0x5592("0x7c8")]),t["on"](Laya["Event"][a0_0x5592("0x992")],this,this[a0_0x5592("0x73a")]),t&&t[a0_0x5592("0x27")]&&(t[a0_0x5592("0x590")](3,!1),t[a0_0x5592("0x9f3")]()),t[a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]],this[a0_0x5592("0xa17")][a0_0x5592("0x739")]=t,this[a0_0x5592("0x104")]&&R[a0_0x5592("0xcf")](F[a0_0x5592("0x7fb")])}[a0_0x5592("0x73a")](){this[a0_0x5592("0x38e")]&&this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]&&(this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!1),this[a0_0x5592("0x9e3")]&&!this[a0_0x5592("0x9e3")][a0_0x5592("0x617")]&&this[a0_0x5592("0x9e3")]["initSkill"](),this[a0_0x5592("0x3e5")]>-1?(this["ske"][a0_0x5592("0x590")](this["currAnimIndex"],!1),this[a0_0x5592("0x3e5")]=-1):this[a0_0x5592("0x739")][a0_0x5592("0x590")](4,!1)}["onEvent"](t){this["ins"][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&this["hited"]&&(1041==this[a0_0x5592("0x750")]?this[a0_0x5592("0x323")]():1042==this[a0_0x5592("0x750")]?this[a0_0x5592("0x564")]():1043==this[a0_0x5592("0x750")]&&this[a0_0x5592("0x6d5")]())}[a0_0x5592("0x323")](){const x=this[a0_0x5592("0x8a0")],t=p[2005]["b1"],c=[210,-30],e=[this["getVec3"](-.866,.5),this["getVec3"](.866,.5)],d=[1,3,5,1,3,5],u=[1200,1050,900];let f=0;this[a0_0x5592("0xaf2")](400,()=>{if(!(f>2)){for(let a=0;a<t[a0_0x5592("0xb0e")];a++){const i=t[a],r=e[a];for(let e=0;e<6;e++){if(!this["getRes"](b[a0_0x5592("0x85b")]))return void S["load3D"]([b[a0_0x5592("0x85b")]]);const s=d[e],n=this[a0_0x5592("0xce")](-r["y"],r["x"]);e>2&&(n["x"]*=-1,n["y"]*=-1);const o=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x232")],this[a0_0x5592("0x4e7")]);let t=o[a0_0x5592("0x751")](X);t||(t=o[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this["currAtt"],0,0,0,0);const l=o[a0_0x5592("0x751")](Xt);l[a0_0x5592("0x680")]=.5,l[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](0,-1),l[a0_0x5592("0x4ad")]=c[a],l["xv"]=c[a]>0?-1:1,l["tar"]=this[a0_0x5592("0x5a7")](360,u[f]),l[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")];const _=x["x"]+i["x"]+15*n["x"]*s,h=x["y"]+i["y"]+15*n["y"]*s;o["pos"](_,h),this[a0_0x5592("0x8a4")]["eneBulNode"]["addChild"](o)}}f++}},this,3)}["skill1042"](){const _=this[a0_0x5592("0x8a0")],e=p[2005]["b2"],h=[[this["getVec3"](0,1),this[a0_0x5592("0xce")](.1736,.9848)],[this[a0_0x5592("0xce")](.0872,.9962),this["getVec3"](.2588,.9659)],[this[a0_0x5592("0xce")](.1736,.9848),this[a0_0x5592("0xce")](.342,.9397)]];let x=0;this[a0_0x5592("0xaf2")](300,()=>{if(!(x>2)){for(let t=0;t<e[a0_0x5592("0xb0e")];t++){const a=e[t],i=t?-1:1;for(let e=0;e<2;e++){const r=h[x][e];if(!this[a0_0x5592("0x761")](b["E_DaoDan"]))return void S[a0_0x5592("0x1eb")]([b[a0_0x5592("0x85b")]]);const s=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x232")],this[a0_0x5592("0x4e7")]);let t=s[a0_0x5592("0x751")](X);t||(t=s[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const n=s[a0_0x5592("0x751")](Xt);n[a0_0x5592("0x680")]=1,n["angle"]=0,n["xv"]=1,n[a0_0x5592("0x2b1")]=null,n[a0_0x5592("0x918")]=this["getVec3"](r["x"]*i,r["y"]),n[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")];const o=_["x"]+a["x"]+15,l=_["y"]+a["y"]+15;s["pos"](o,l),this["ins"]["eneBulNode"][a0_0x5592("0x231")](s)}}x++}},this,3)}[a0_0x5592("0x6d5")](){const e=this["owner"],a=p[2005]["b3"],o=[this[a0_0x5592("0xce")](.9511,-.309),this[a0_0x5592("0xce")](.5878,.809),this[a0_0x5592("0xce")](-.5878,.809),this["getVec3"](-.9511,-.309),this[a0_0x5592("0xce")](0,-1)],i=this[a0_0x5592("0xce")](-.342,.9397);for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const r=t?-1:1,s=a[t],l=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["EnemySkill9"],this[a0_0x5592("0x6f0")]),n=e["x"]+s["x"],_=e["y"]+s["y"];l[a0_0x5592("0x6f7")](n,_),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](l),Laya[a0_0x5592("0x6eb")]["to"](l,{x:n+300*i["x"]*r,y:_+300*i["y"]},1e3,Laya["Ease"][a0_0x5592("0x5f")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya["timer"][a0_0x5592("0x724")](500,this,()=>{this[a0_0x5592("0xaf2")](100,()=>{for(let e=0;e<o["length"];e++){const a=o[e],i=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],this[a0_0x5592("0x89e")]);i[a0_0x5592("0xa20")](.6,.6);let t=i[a0_0x5592("0x751")](X);t||(t=i[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this[a0_0x5592("0x491")],0,0,0,0);const r=i["getComponent"](f);r[a0_0x5592("0x918")]=a,r[a0_0x5592("0x35e")]=P[a0_0x5592("0xa5")],r[a0_0x5592("0x5b6")]=this["currBsp"];const s=l["x"]+10*a["x"],n=l["y"]+10*a["y"];i[a0_0x5592("0x6f7")](s,n),this[a0_0x5592("0x8a4")][a0_0x5592("0x1af")][a0_0x5592("0x231")](i)}},this,20,null,!0,()=>{l[a0_0x5592("0xaa4")]()})})}))}}}class ja extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x4a0")]=null,this["target"]=null,this[a0_0x5592("0x151")]=0,this[a0_0x5592("0xa6e")]=0}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")]["getComponent"](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280}));const t=this[a0_0x5592("0x4a0")];Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](t),t&&Laya[a0_0x5592("0x6ec")]["loop"](300,this,()=>{t&&Laya[a0_0x5592("0x6eb")]["to"](t,{scaleX:1.5},150,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{t&&Laya[a0_0x5592("0x6eb")]["to"](t,{scaleX:1},150,null)}))})}[a0_0x5592("0x4fd")](){super[a0_0x5592("0x4fd")](),this[a0_0x5592("0x9ec")](),this["recover"](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x9ec")](){this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")][a0_0x5592("0xb0e")]=0,R[a0_0x5592("0xcf")](F[a0_0x5592("0xa79")],this[a0_0x5592("0x1b2")])}[a0_0x5592("0xb11")](t,e){}["onCollisionExit"](t,e){}["onLateUpdate"](){if(this["ins"][a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const t=this[a0_0x5592("0x8a0")],e=this[a0_0x5592("0x92f")];e&&e[a0_0x5592("0x2ed")]?(t["x"]=e["x"]+this["devX"],t["y"]=e["y"]+this[a0_0x5592("0xa6e")],this[a0_0x5592("0x5b3")]["check"](this[a0_0x5592("0x8a4")][a0_0x5592("0x532")],this[a0_0x5592("0x1b2")])):t[a0_0x5592("0xaa4")]()}}class qa extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0xa17")]=null,this["ecolCom"]=null,this[a0_0x5592("0x9e3")]=null,this["currSkill"]=null,this[a0_0x5592("0x491")]=0,this[a0_0x5592("0x3e3")]=0,this[a0_0x5592("0x4e7")]=null,this["bulletPre2"]=null,this[a0_0x5592("0x89e")]=null,this[a0_0x5592("0x739")]=null,this[a0_0x5592("0x5fc")]=null,this["hited"]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1,this[a0_0x5592("0x3e5")]=-1,this[a0_0x5592("0x92e")]=[]}[a0_0x5592("0x880")](){if(this[a0_0x5592("0x4e7")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")]["EnemySkill2001"]),this[a0_0x5592("0x6f0")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")]),this[a0_0x5592("0x89e")]=this[a0_0x5592("0x761")](w[a0_0x5592("0x4f3")][a0_0x5592("0x4f9")]),this[a0_0x5592("0x8a4")]=Y["instance"],this[a0_0x5592("0xa17")]=this[a0_0x5592("0x8a0")]["getComponent"](Zt),this[a0_0x5592("0x38e")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](ae),!this[a0_0x5592("0xa17")]||!this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")])return;this[a0_0x5592("0x9e3")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](jt);const i=this[a0_0x5592("0xa17")][a0_0x5592("0x2e2")];this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!0,this[a0_0x5592("0x9fc")]=!1,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x104")]=!1,this[a0_0x5592("0x3e5")]=-1;const r=i[a0_0x5592("0x644")][a0_0x5592("0xae0")]("|"),s=i["bulletsp"][a0_0x5592("0xae0")]("|");this[a0_0x5592("0x295")](),R["on"](F[a0_0x5592("0x560")],this,(t,e,a)=>{if(e==this[a0_0x5592("0xa17")][a0_0x5592("0xa02")]&&t==i[a0_0x5592("0xb2e")]){if(this[a0_0x5592("0x739")]){let t=0;1051==a&&(t=0),1052==a&&(t=1),1053==a&&(t=2),this[a0_0x5592("0x3e5")]=t}this[a0_0x5592("0x9fc")]=!0,this[a0_0x5592("0x750")]=a,this[a0_0x5592("0x491")]=parseFloat(r[a-1051]),this[a0_0x5592("0x3e3")]=parseFloat(s[a-1051])}}),R["on"](F["EnemyEnd"],this,()=>{this[a0_0x5592("0x104")]=!0,this[a0_0x5592("0x739")]&&this["ske"]["templet"]&&this[a0_0x5592("0x739")][a0_0x5592("0x590")](3,!1)})}[a0_0x5592("0x295")](){this[a0_0x5592("0x5fc")][a0_0x5592("0x143")]=!1;for(let t=0;t<this["lasers"]["length"];t++)this[a0_0x5592("0x92e")][t][a0_0x5592("0xaa4")]();this["lasers"][a0_0x5592("0xb0e")]=0}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x295")](),R[a0_0x5592("0x5c7")](this),this["ske"]&&(this[a0_0x5592("0x739")]["offAllCaller"](this),this[a0_0x5592("0x739")][a0_0x5592("0x27f")]())}[a0_0x5592("0x3de")](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t[a0_0x5592("0x27")]&&(this["inited"]=!0,this["parseComplete"]())}[a0_0x5592("0x8df")](){const t=this["ske"];t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x6e6")],this,this[a0_0x5592("0x7c8")]),t["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,this[a0_0x5592("0x73a")]),t&&t["templet"]&&(t["play"](3,!1),t["paused"]()),t[a0_0x5592("0x4ea")]=[new Laya[a0_0x5592("0x3c6")]],this[a0_0x5592("0xa17")]["ske"]=t,this[a0_0x5592("0x104")]&&R["event"](F[a0_0x5592("0x7fb")])}["completeHandler"](){this["ecolCom"]&&this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]&&(this[a0_0x5592("0x38e")][a0_0x5592("0x98f")]=!1),this[a0_0x5592("0x9e3")]&&!this[a0_0x5592("0x9e3")][a0_0x5592("0x617")]&&this[a0_0x5592("0x9e3")][a0_0x5592("0x141")](),this["currAnimIndex"]>-1?(this["ske"][a0_0x5592("0x590")](this["currAnimIndex"],!1),this[a0_0x5592("0x3e5")]=-1):this[a0_0x5592("0x739")]["play"](4,!1)}[a0_0x5592("0x7c8")](t){this[a0_0x5592("0x8a4")]["gameState"]==P[a0_0x5592("0xa5")]&&this[a0_0x5592("0x9fc")]&&(1051==this["currSkill"]?this[a0_0x5592("0x511")]():1052==this["currSkill"]?this["skill1052"]():1053==this["currSkill"]&&this[a0_0x5592("0x996")]())}[a0_0x5592("0x511")](){const l=this[a0_0x5592("0x8a0")],t=[[this[a0_0x5592("0xce")](-.866,.5),this[a0_0x5592("0xce")](-.7071,.7071),this[a0_0x5592("0xce")](-.5,.866),this["getVec3"](-.2588,.9659),this[a0_0x5592("0xce")](.866,.5),this[a0_0x5592("0xce")](.7071,.7071),this[a0_0x5592("0xce")](.5,.866),this[a0_0x5592("0xce")](.2588,.9659),this[a0_0x5592("0xce")](0,1)],[this["getVec3"](-.7071,.7071),this[a0_0x5592("0xce")](-.5,.866),this[a0_0x5592("0xce")](-.2588,.9659),this["getVec3"](.7071,.7071),this["getVec3"](.5,.866),this[a0_0x5592("0xce")](.2588,.9659),this[a0_0x5592("0xce")](0,1)],[this[a0_0x5592("0xce")](-.5,.866),this[a0_0x5592("0xce")](-.2588,.9659),this[a0_0x5592("0xce")](.5,.866),this[a0_0x5592("0xce")](.2588,.9659),this[a0_0x5592("0xce")](0,1)],[this[a0_0x5592("0xce")](-.2588,.9659),this[a0_0x5592("0xce")](.2588,.9659),this[a0_0x5592("0xce")](0,1)],[this[a0_0x5592("0xce")](0,1)]];let e=0;this[a0_0x5592("0xaf2")](100,()=>{if(e>4)return;const a=t[e];for(let e=0;e<a["length"];e++){const i=a[e],r=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")]["EnemySkill2001"],this[a0_0x5592("0x4e7")]);r[a0_0x5592("0xa20")](1,1);let t=r[a0_0x5592("0x751")](X);t||(t=r[a0_0x5592("0x2a6")](X)),t["setData"](this["currAtt"],0,0,0,0);const s=r[a0_0x5592("0x751")](f);s[a0_0x5592("0x918")]=i,s["state"]=P[a0_0x5592("0xa5")],s[a0_0x5592("0x5b6")]=this[a0_0x5592("0x3e3")];const n=l["x"],o=l["y"]+156;r["pos"](n,o),this[a0_0x5592("0x8a4")]["eneBulNode"][a0_0x5592("0x231")](r)}e++},this,5)}[a0_0x5592("0xae8")](){const t=this[a0_0x5592("0x8a0")],i=[this[a0_0x5592("0xce")](0,1),this["getVec3"](.6428,.766),this["getVec3"](.9848,.1736),this[a0_0x5592("0xce")](.866,-.5),this[a0_0x5592("0xce")](.342,-.9397),this["getVec3"](-.6428,.766),this["getVec3"](-.9848,.1736),this[a0_0x5592("0xce")](-.866,-.5),this[a0_0x5592("0xce")](-.342,-.9397)],h=[this[a0_0x5592("0xce")](1,0),this[a0_0x5592("0xce")](-1,0),this[a0_0x5592("0xce")](.5,.866),this[a0_0x5592("0xce")](-.5,.866),this[a0_0x5592("0xce")](.5,-.866),this[a0_0x5592("0xce")](-.5,-.866)],x=[0,30,60,90,120,30,60,90,120],c=[1,1,1,1,1,-1,-1,-1,-1],r=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")],this[a0_0x5592("0x6f0")]);r[a0_0x5592("0xa20")](1,1);const e=t["y"]+156;r[a0_0x5592("0x6f7")](t["x"],e),this["ins"]["eneBulNode"]["addChild"](r),Laya[a0_0x5592("0x6eb")]["to"](r,{y:e+150},1e3,Laya["Ease"]["expoOut"],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{for(let l=0;l<i[a0_0x5592("0xb0e")];l++){const t=i[l],_=this["open"](w[a0_0x5592("0x4f3")][a0_0x5592("0x42")],this[a0_0x5592("0x6f0")]),e=r["x"],a=r["y"];_[a0_0x5592("0x6f7")](e,a),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](_),Laya[a0_0x5592("0x6eb")]["to"](_,{x:e+150*t["x"],y:a+150*t["y"]},1e3,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x5f")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6ec")]["once"](500,this,()=>{for(let i=0;i<h["length"];i++){const r=h[i],s=this[a0_0x5592("0x4c9")](w[a0_0x5592("0x4f3")][a0_0x5592("0xaa2")],this[a0_0x5592("0x4e7")]);s[a0_0x5592("0xa20")](1,1);let t=s[a0_0x5592("0x751")](X);t||(t=s[a0_0x5592("0x2a6")](X)),t[a0_0x5592("0x971")](this["currAtt"],0,0,0,0);const n=s[a0_0x5592("0x751")](f),o=x[l]/180*Math["PI"];let e=r["x"]*Math[a0_0x5592("0x2d9")](o)+r["y"]*Math[a0_0x5592("0x2d2")](o),a=r["y"]*Math[a0_0x5592("0x2d9")](o)-r["x"]*Math["sin"](o);e*=c[l],n[a0_0x5592("0x918")]=this[a0_0x5592("0xce")](e,a),n["state"]=P[a0_0x5592("0xa5")],n[a0_0x5592("0x5b6")]=.5*this[a0_0x5592("0x3e3")],s[a0_0x5592("0x6f7")](_["x"],_["y"]),this[a0_0x5592("0x8a4")]["eneBulNode"]["addChild"](s)}_[a0_0x5592("0xaa4")]()})}))}r[a0_0x5592("0xaa4")]()}))}["skill1053"](){this[a0_0x5592("0x295")](),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x149")](this,this[a0_0x5592("0x295")]);const r=this[a0_0x5592("0x8a0")],s=p[2006]["b3"];this[a0_0x5592("0x5fc")][a0_0x5592("0x143")]=!0,Laya["timer"]["once"](1e3,this,()=>{this[a0_0x5592("0x5fc")][a0_0x5592("0x143")]=!1;for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const e=s[t],a=this[a0_0x5592("0x4c9")](w["battle"]["EnemyLaser"],this[a0_0x5592("0x89e")]),i=a[a0_0x5592("0x751")](ja);i[a0_0x5592("0x92f")]=this[a0_0x5592("0x8a0")],i["devX"]=e["x"],i[a0_0x5592("0xa6e")]=e["y"],a["pos"](r["x"]+e["x"],r["y"]+e["y"]),this[a0_0x5592("0x8a4")][a0_0x5592("0x5be")][a0_0x5592("0x231")](a),this["lasers"][a0_0x5592("0x626")](a)}Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](3e3,this,this[a0_0x5592("0x295")])})}}class Za extends t{constructor(){super()}[a0_0x5592("0x880")](){const t=this[a0_0x5592("0x8a0")];t[a0_0x5592("0x318")]=t["__color__"]?a0_0x5592("0x7be"):a0_0x5592("0x1de");const e=t["__color__"]?1.2:1;t[a0_0x5592("0xa20")](0,0),t["alpha"]=1;let a=Math["floor"](21*Math[a0_0x5592("0x2ee")]()+10),i=Math[a0_0x5592("0x6fc")](16*Math[a0_0x5592("0x2ee")]()+45),r=Math[a0_0x5592("0x6fc")](16*Math[a0_0x5592("0x2ee")]()+5),s=Math[a0_0x5592("0x6fc")](6*Math[a0_0x5592("0x2ee")]()+15);Laya[a0_0x5592("0x6eb")]["to"](t,{x:t["x"]+a,y:t["y"]-i,scaleX:e,scaleY:e},300,Laya[a0_0x5592("0x4ec")][a0_0x5592("0x6c9")],Laya[a0_0x5592("0x4d5")]["create"](this,()=>{Laya[a0_0x5592("0x6ec")]["once"](100,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](t,{x:t["x"]-r,y:t["y"]-s,alpha:0},100,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{t[a0_0x5592("0xaa4")]()}))})}))}["onDisable"](){Laya["timer"][a0_0x5592("0x61b")](this),Laya["Tween"][a0_0x5592("0x61b")](this),R["offAllCaller"](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x3de")](){}}class Ka extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this["timer"]=0}["onEnable"](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")],this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0x1b2")]=this["owner"][a0_0x5592("0x751")](W),this["quadTree"]||(this["quadTree"]=new _({x:0,y:0,width:720,height:1280}))}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){this[a0_0x5592("0x8a4")][a0_0x5592("0x547")]==P[a0_0x5592("0xa5")]&&(this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")]["playerCols"],this[a0_0x5592("0x1b2")]),this[a0_0x5592("0x6ec")]+=Laya["timer"][a0_0x5592("0x154")],this["timer"]>=2e3&&this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]())}}class Qa extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this[a0_0x5592("0xa8f")]=null,this["right"]=null,this[a0_0x5592("0xa08")]=0,this[a0_0x5592("0x2b1")]=null,this["im"]=null,this[a0_0x5592("0xabf")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const o=this["owner"],t=D[a0_0x5592("0x53d")][V[a0_0x5592("0x7f0")]],e=t[a0_0x5592("0x52b")]||5;t[a0_0x5592("0x214")];this[a0_0x5592("0xa8f")][a0_0x5592("0x14")]=0,this[a0_0x5592("0x974")][a0_0x5592("0x14")]=0;const l=[this[a0_0x5592("0x974")],this[a0_0x5592("0xa8f")]],a=this[a0_0x5592("0x8a4")];Laya[a0_0x5592("0x6ec")][a0_0x5592("0x861")](1e3*e,this,()=>{if(a[a0_0x5592("0x547")]!=P[a0_0x5592("0xa5")])return;const s=l[this[a0_0x5592("0xa08")]],t=s[a0_0x5592("0xab9")]("point");if(s){let a=this["ins"]["getMinEnemy"](o),i=this[a0_0x5592("0xa08")]?90:-90,r=730;if(a&&a["parent"]){let t=o["x"]+(s["x"]-25)-a["x"],e=o["y"]-a["y"];r=Math["sqrt"](t*t+e*e),i=Math[a0_0x5592("0x23d")](t,-e)/Math["PI"]*180;const n=a[a0_0x5592("0x751")](ae);n[a0_0x5592("0xb11")](this,n,!0)}s[a0_0x5592("0x1c1")]=r,s[a0_0x5592("0x3b0")]=i,t["y"]=r/730*713,Laya["Tween"]["to"](s,{alpha:1},100,null,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{if(a&&a["parent"]){const t=a[a0_0x5592("0x751")](ae);t[a0_0x5592("0xb11")](this,t,!0)}})),Laya["timer"][a0_0x5592("0x724")](200,this,()=>{Laya[a0_0x5592("0x6eb")]["to"](s,{alpha:0},100)}),this[a0_0x5592("0x2b1")]=a,this["im"]=s,this[a0_0x5592("0xabf")]=t,this["vec"]++,this[a0_0x5592("0xa08")]>=l[a0_0x5592("0xb0e")]&&(this[a0_0x5592("0xa08")]=0)}})}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),Laya[a0_0x5592("0x6eb")]["clearAll"](this),R[a0_0x5592("0x5c7")](this),this["recover"](this[a0_0x5592("0x8a0")])}[a0_0x5592("0x5b4")](){if(this[a0_0x5592("0x8a4")]["gameState"]==P[a0_0x5592("0xa5")]&&this["im"]&&this[a0_0x5592("0xabf")]){const s=this["owner"];let a=1500,i=this["vec"]?90:-90,r=this[a0_0x5592("0x2b1")];if(r&&r["parent"]){let t=s["x"]+(this["im"]["x"]-25)-r["x"],e=s["y"]-r["y"];a=Math[a0_0x5592("0x4e6")](t*t+e*e),i=Math[a0_0x5592("0x23d")](t,-e)/Math["PI"]*180}this["im"][a0_0x5592("0x1c1")]=a,this["im"]["rotation"]=i,this["point"]["y"]=a/730*713}}}class Ja extends t{constructor(){super(),this[a0_0x5592("0x8a4")]=null,this["selfCol"]=null,this["quadTree"]=null,this[a0_0x5592("0x617")]=!1,this[a0_0x5592("0x739")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a4")]=Y[a0_0x5592("0x173")];const t=this[a0_0x5592("0x8a0")];this[a0_0x5592("0x617")]=!1;this[a0_0x5592("0x8a4")];this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")][a0_0x5592("0x751")](W),this["quadTree"]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this["ske"]&&(this[a0_0x5592("0x739")]["blendMode"]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")]),this["ske"]["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0x992")],this,()=>{this[a0_0x5592("0x5b3")]["check"](this[a0_0x5592("0x8a4")][a0_0x5592("0x352")],this[a0_0x5592("0x1b2")]),t[a0_0x5592("0xaa4")]()})}[a0_0x5592("0x8df")](){this[a0_0x5592("0x739")]&&this[a0_0x5592("0x739")][a0_0x5592("0x27")]&&this[a0_0x5592("0x739")][a0_0x5592("0x590")](0,!1)}[a0_0x5592("0x4fd")](){this["selfCol"][a0_0x5592("0x5aa")]=[],R["event"](F[a0_0x5592("0x2ec")],this[a0_0x5592("0x1b2")]),R[a0_0x5592("0x5c7")](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this),this[a0_0x5592("0x739")]&&(this[a0_0x5592("0x739")][a0_0x5592("0x5c7")](this),this[a0_0x5592("0x739")][a0_0x5592("0x27f")]()),this[a0_0x5592("0x77a")](this[a0_0x5592("0x8a0")])}[a0_0x5592("0xb11")](t,e){}[a0_0x5592("0x3ec")](t,e){}["onUpdate"](){const t=this[a0_0x5592("0x739")];!this[a0_0x5592("0x617")]&&t&&t["templet"]&&(this["inited"]=!0,this["parseComplete"]())}}class $a extends t{constructor(){super(),this["ins"]=null,this[a0_0x5592("0x1b2")]=null,this[a0_0x5592("0x5b3")]=null,this[a0_0x5592("0x4f0")]=null}[a0_0x5592("0x880")](){this["ins"]=Y[a0_0x5592("0x173")];const t=this[a0_0x5592("0x8a0")];this[a0_0x5592("0x8a4")];this[a0_0x5592("0x1b2")]=this[a0_0x5592("0x8a0")]["getComponent"](W),this[a0_0x5592("0x5b3")]||(this[a0_0x5592("0x5b3")]=new _({x:0,y:0,width:720,height:1280})),this["boomSke"]&&(this[a0_0x5592("0x4f0")][a0_0x5592("0xabe")]=Laya[a0_0x5592("0x4d6")][a0_0x5592("0x47f")]),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x724")](265,this,()=>{this[a0_0x5592("0x5b3")][a0_0x5592("0x69")](this[a0_0x5592("0x8a4")]["enemyCols"],this[a0_0x5592("0x1b2")]),t[a0_0x5592("0xaa4")]()})}[a0_0x5592("0x4fd")](){this[a0_0x5592("0x1b2")][a0_0x5592("0x5aa")]=[],R[a0_0x5592("0xcf")](F[a0_0x5592("0x2ec")],this[a0_0x5592("0x1b2")]),R["offAllCaller"](this),Laya[a0_0x5592("0x6ec")][a0_0x5592("0x61b")](this)}["onCollisionEnter"](t,e){}[a0_0x5592("0x3ec")](t,e){}[a0_0x5592("0x5b4")](){}}class ti extends t{constructor(){super(),this["mainBrid"]=null,this[a0_0x5592("0xaac")]=null}[a0_0x5592("0x880")](){const t=this["mainBrid"],e=this["bulBg"];t[a0_0x5592("0x14")]=0,t[a0_0x5592("0xa20")](0,0),t[a0_0x5592("0x6f7")](192,430),e["scaleY"]=-.7,Laya[a0_0x5592("0x6eb")]["to"](e,{scaleY:-1},50,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya[a0_0x5592("0x6eb")]["to"](e,{scaleY:-1.5},400),Laya[a0_0x5592("0x6eb")]["to"](t,{scaleX:1,scaleY:1,alpha:1},100,null,Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{Laya["Tween"]["to"](t,{y:125},400,null,Laya[a0_0x5592("0x4d5")]["create"](this,()=>{Laya["Tween"]["to"](t,{alpha:0},100)}))}))}))}[a0_0x5592("0x4fd")](){Laya[a0_0x5592("0x6eb")][a0_0x5592("0x61b")](this)}}class ei extends t{constructor(){super(),this["closeBtn"]=null,this[a0_0x5592("0x13a")]=null,this[a0_0x5592("0xa9")]=null,this["achList"]=null,this[a0_0x5592("0x68f")]=null}[a0_0x5592("0x5dd")](){const t=M[a0_0x5592("0x61")],e=[],a=[];for(const i in t){const r=t[i],s=K[a0_0x5592("0x401")][i];r["num"]>=s[a0_0x5592("0x919")]?e[a0_0x5592("0x626")](parseInt(i)):a[a0_0x5592("0x626")](parseInt(i))}e[a0_0x5592("0x626")][a0_0x5592("0x904")](e,a),this[a0_0x5592("0xa9")][a0_0x5592("0xa3f")]=e}[a0_0x5592("0x880")](){this["setClick"](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this),this[a0_0x5592("0x13a")]["vScrollBarSkin"]="",this[a0_0x5592("0xa9")][a0_0x5592("0x6be")]="",this["daiList"]["renderHandler"]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{(t=>{this[a0_0x5592("0x971")](t,this["daiList"][a0_0x5592("0xa3f")][e])})(t)},null,!1);const t=this[a0_0x5592("0xa9")][a0_0x5592("0x2ed")]["parent"][a0_0x5592("0x2ed")];this[a0_0x5592("0xa9")][a0_0x5592("0x5b5")]["on"](Laya[a0_0x5592("0x690")][a0_0x5592("0xa5")],this,()=>{t&&t["vScrollBar"][a0_0x5592("0x7ed")]()}),this["initDaiList"]();const e=K[a0_0x5592("0x47a")],a={};for(const i in e){const r=e[i];a[r[a0_0x5592("0xb2e")]]||(a[r["type"]]=[]),a[r[a0_0x5592("0xb2e")]]["push"](r)}this[a0_0x5592("0x68f")]=a,this[a0_0x5592("0x1cf")][a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{(t=>{this[a0_0x5592("0xb0a")](t,this["achList"][a0_0x5592("0xa3f")][e])})(t)},null,!1),this[a0_0x5592("0xe0")]()}["initAchList"](){const e=[],a=[],i=this["achData2"];for(const r in i){const s=i[r];let t=M["getAchieve"](r);const n=s[t[a0_0x5592("0x58d")]-1]?s[t[a0_0x5592("0x58d")]-1]:s[s["length"]-1];t[a0_0x5592("0x919")]>=n[a0_0x5592("0x919")]?e["push"](n):a[a0_0x5592("0x626")](n)}e[a0_0x5592("0x626")][a0_0x5592("0x904")](e,a),this[a0_0x5592("0x1cf")][a0_0x5592("0xa3f")]=e}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x971")](t,e){const a=t[a0_0x5592("0xab9")](a0_0x5592("0x736")),i=a[a0_0x5592("0xab9")]("icon"),r=a["getChildByName"]("num"),s=t["getChildByName"](a0_0x5592("0xdd")),n=t[a0_0x5592("0xab9")](a0_0x5592("0xa4e")),o=t["getChildByName"](a0_0x5592("0xd1")),l=t["getChildByName"](a0_0x5592("0xb10")),_=t["getChildByName"](a0_0x5592("0x223")),h=K["dailyTasks"][e];let x=M[a0_0x5592("0x61")][e];i[a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+(h["rewardtype"]+"01")+a0_0x5592("0x525"),r[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](h[a0_0x5592("0xb05")]),s[a0_0x5592("0x1e3")]=h[a0_0x5592("0xa1c")],n[a0_0x5592("0x1e3")]=x[a0_0x5592("0x919")]+"/"+h[a0_0x5592("0x919")],o[a0_0x5592("0x8de")]=x[a0_0x5592("0x919")]/h[a0_0x5592("0x919")],x[a0_0x5592("0x919")]>=h[a0_0x5592("0x919")]?x[a0_0x5592("0x6a8")]?(l["visible"]=!1,_["visible"]=!0):(l[a0_0x5592("0x143")]=!0,_[a0_0x5592("0x143")]=!1):l[a0_0x5592("0x143")]=_[a0_0x5592("0x143")]=!1,l[a0_0x5592("0x5c7")](l),this[a0_0x5592("0x68")](l,()=>{M[a0_0x5592("0x61")][e][a0_0x5592("0x6a8")]=!0,M[a0_0x5592("0x61")][21][a0_0x5592("0x919")]++,z[a0_0x5592("0xa8a")]({1:[100*h[a0_0x5592("0x7e5")]+1,h[a0_0x5592("0xb05")]]}),ia[a0_0x5592("0xf4")]([[100*h["rewardtype"]+1,h[a0_0x5592("0xb05")]]]),this[a0_0x5592("0x5dd")]()},l)}["setData2"](t,e){const a=t[a0_0x5592("0xab9")](a0_0x5592("0x736")),i=a[a0_0x5592("0xab9")](a0_0x5592("0x601")),r=a[a0_0x5592("0xab9")](a0_0x5592("0x919")),s=t[a0_0x5592("0xab9")](a0_0x5592("0xdd")),n=t[a0_0x5592("0xab9")](a0_0x5592("0xa4e")),o=t[a0_0x5592("0xab9")](a0_0x5592("0xd1")),l=t["getChildByName"](a0_0x5592("0xb10")),_=t["getChildByName"](a0_0x5592("0x223")),h=M["getAchieve"](e[a0_0x5592("0xb2e")]);i[a0_0x5592("0x8fa")]="lobby/equicon/"+(e[a0_0x5592("0x7e5")]+"01")+a0_0x5592("0x525"),r[a0_0x5592("0x1e3")]=O["formatNumber"](e["reward"]),s[a0_0x5592("0x1e3")]=e[a0_0x5592("0xa1c")],n[a0_0x5592("0x1e3")]=h[a0_0x5592("0x919")]+"/"+e[a0_0x5592("0x919")],o[a0_0x5592("0x8de")]=h[a0_0x5592("0x919")]/e["num"],h["num"]>=e[a0_0x5592("0x919")]?h[a0_0x5592("0x58d")]>e[a0_0x5592("0x58d")]?(l[a0_0x5592("0x143")]=!1,_[a0_0x5592("0x143")]=!0):(l[a0_0x5592("0x143")]=!0,_["visible"]=!1):l[a0_0x5592("0x143")]=_[a0_0x5592("0x143")]=!1,l[a0_0x5592("0x5c7")](l),this["setClick"](l,()=>{M[a0_0x5592("0x306")](e[a0_0x5592("0xb2e")],1),z[a0_0x5592("0xa8a")]({1:[100*e["rewardtype"]+1,e["reward"]]}),ia[a0_0x5592("0xf4")]([[100*e["rewardtype"]+1,e["reward"]]]),this[a0_0x5592("0xe0")]()},l)}}class ai extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0xa9")]=null}[a0_0x5592("0x5dd")](){const t=M[a0_0x5592("0x61")],e=[],a=[];for(const i in t){const r=t[i],s=K["dailyTasks"][i];r[a0_0x5592("0x919")]>=s[a0_0x5592("0x919")]?e[a0_0x5592("0x626")](parseInt(i)):a[a0_0x5592("0x626")](parseInt(i))}e[a0_0x5592("0x626")]["apply"](e,a),this[a0_0x5592("0xa9")]["array"]=e}[a0_0x5592("0x880")](){this["setClick"](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this),this[a0_0x5592("0xa9")][a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,(t,e)=>{(t=>{this[a0_0x5592("0x971")](t,this[a0_0x5592("0xa9")][a0_0x5592("0xa3f")][e])})(t)},null,!1),this[a0_0x5592("0x5dd")]()}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x971")](t,e){const a=t["getChildByName"](a0_0x5592("0x736")),i=a[a0_0x5592("0xab9")](a0_0x5592("0x601")),r=a[a0_0x5592("0xab9")](a0_0x5592("0x919")),s=t["getChildByName"](a0_0x5592("0xdd")),n=t[a0_0x5592("0xab9")](a0_0x5592("0xa4e")),o=t[a0_0x5592("0xab9")](a0_0x5592("0xd1")),l=t[a0_0x5592("0xab9")](a0_0x5592("0xb10")),_=t[a0_0x5592("0xab9")](a0_0x5592("0x223")),h=K[a0_0x5592("0x401")][e];let x=M["dailys"][e];i[a0_0x5592("0x8fa")]=a0_0x5592("0x9c9")+(h["rewardtype"]+"01")+a0_0x5592("0x525"),r[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](h[a0_0x5592("0xb05")]),s[a0_0x5592("0x1e3")]=h[a0_0x5592("0xa1c")],n[a0_0x5592("0x1e3")]=x["num"]+"/"+h[a0_0x5592("0x919")],o["value"]=x["num"]/h[a0_0x5592("0x919")],x["num"]>=h["num"]?x[a0_0x5592("0x6a8")]?(l[a0_0x5592("0x143")]=!1,_["visible"]=!0):(l[a0_0x5592("0x143")]=!0,_[a0_0x5592("0x143")]=!1):l["visible"]=_[a0_0x5592("0x143")]=!1,l[a0_0x5592("0x5c7")](l),this[a0_0x5592("0x68")](l,()=>{M[a0_0x5592("0x61")][e]["recd"]=!0,M[a0_0x5592("0x61")][21][a0_0x5592("0x919")]++,z["updateItem"]({1:[100*h[a0_0x5592("0x7e5")]+1,h[a0_0x5592("0xb05")]]}),ia[a0_0x5592("0xf4")]([[100*h["rewardtype"]+1,h[a0_0x5592("0xb05")]]]),this[a0_0x5592("0x5dd")]()},l)}}class ii extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x30f")]=null,this[a0_0x5592("0x3c1")]=null,this["bsLab"]=null,this[a0_0x5592("0x99a")]=null,this["lvLab"]=null}[a0_0x5592("0x880")](){this["setClick"](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this);const i=H[a0_0x5592("0x137")];this[a0_0x5592("0x44")][a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](i[a0_0x5592("0x64c")]||0),this[a0_0x5592("0x99a")][a0_0x5592("0x1e3")]=(i[a0_0x5592("0x1b8")]||1)+"",this[a0_0x5592("0x186")][a0_0x5592("0x1e3")]=a0_0x5592("0xab0")+(i[a0_0x5592("0x3c3")]||1),this["conBtn"][a0_0x5592("0x143")]=!!i[a0_0x5592("0x94c")],i[a0_0x5592("0x94c")]&&(this[a0_0x5592("0x186")][a0_0x5592("0x1e3")]=a0_0x5592("0xab0")+(i[a0_0x5592("0x94c")][a0_0x5592("0x2d6")]||1));let r=!1;this["setClick"](this["playBtn"],()=>{if(r)return;r=!0;const t=()=>{const t=O["getRandom"](15,1),e=O[a0_0x5592("0x7de")](2,1);this[a0_0x5592("0x63a")](t,e,1)[a0_0x5592("0x284")](()=>{i["lastData"]=null,window[a0_0x5592("0x9bf")]=[t,e,1],Laya[a0_0x5592("0x876")][a0_0x5592("0x4c9")](a0_0x5592("0x9de"))})};i[a0_0x5592("0x94c")]?dt[a0_0x5592("0x9f9")]({title:N["Common"][12],desc:N[a0_0x5592("0x238")][22],sure:t,close:()=>{r=!1}},g[a0_0x5592("0x173")][a0_0x5592("0x72c")]):t()},this),this[a0_0x5592("0x68")](this["conBtn"],()=>{if(r||!i)return;r=!0;const t=i[a0_0x5592("0x3b6")][0],e=i[a0_0x5592("0x3b6")][1],a=i[a0_0x5592("0x3b6")][2];this[a0_0x5592("0x63a")](t,e,a)[a0_0x5592("0x284")](()=>{window[a0_0x5592("0x9bf")]=[t,e,a],window[a0_0x5592("0x220")]=!0,Laya[a0_0x5592("0x876")][a0_0x5592("0x4c9")](a0_0x5592("0x9de"))})},this)}[a0_0x5592("0x4fd")](){}["loadBatPre"](r,s,n){const o=[],t=w[a0_0x5592("0x4f3")];for(const e in t){const a=t[e];o[a0_0x5592("0x626")](a)}const l=[];l[a0_0x5592("0x626")](b[a0_0x5592("0x418")]),l[a0_0x5592("0x626")](b["Coin"]),l[a0_0x5592("0x626")](y[I["id"]]),3==I["id"]&&l[a0_0x5592("0x779")](b["DaoDan"])<0&&l["push"](b["DaoDan"]),4==I["id"]&&l[a0_0x5592("0x779")](b[a0_0x5592("0x5fb")])<0&&l[a0_0x5592("0x626")](b[a0_0x5592("0x5fb")]);let _=null;if(z[a0_0x5592("0x558")][3]&&I["chapter"]>0){const i=[1,2,3,4,5,6],h=I["id"];i["splice"](i[a0_0x5592("0x779")](h),1),_=i[O[a0_0x5592("0x7de")](4,0)],L[a0_0x5592("0xa1a")]=_,l["push"](y[_]),3==_&&l["indexOf"](b[a0_0x5592("0x92d")])<0&&l[a0_0x5592("0x626")](b[a0_0x5592("0x92d")]),4==_&&l[a0_0x5592("0x779")](b["Main4"])<0&&l["push"](b["Main4"])}return new Promise((e,t)=>{let a=0,i=0;l[a0_0x5592("0xb0e")]&&i++,o["length"]&&i++,S[a0_0x5592("0x1eb")](l)[a0_0x5592("0x284")](()=>{console["log"]("load model complete..."),++a==i&&e()}),Laya[a0_0x5592("0x80c")]["create"](a0_0x5592("0x1b3"),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{console[a0_0x5592("0xad6")](a0_0x5592("0x7f7")),S["loadPlayerPre"](I["id"]),_&&S["loadPlayerPre"](_);const t=E[a0_0x5592("0x546")][r+""+s];t&&S[a0_0x5592("0x50")](t[n]),++a==i&&e()}),Laya[a0_0x5592("0x4d5")]["create"](this,t=>{}))})}}class ri extends t{constructor(){super(),this["closeBtn"]=null,this["nameLab"]=null,this[a0_0x5592("0x9b5")]=null,this[a0_0x5592("0x366")]=null,this[a0_0x5592("0x7f5")]=null,this["att2Box"]=null,this[a0_0x5592("0x728")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this["closeBtn"],()=>{this[a0_0x5592("0x6a6")](this)},this)}[a0_0x5592("0x971")](t,e){const a=e[0],i=t[0],r=k[a0_0x5592("0x906")][a],s=k["equs"][i];this[a0_0x5592("0x4cd")]["text"]=r["name"],this[a0_0x5592("0x9b5")][a0_0x5592("0x751")](la)[a0_0x5592("0xb38")](e);const n=this[a0_0x5592("0x366")][a0_0x5592("0xab9")](a0_0x5592("0x80e")),o=this["lvBox"]["getChildByName"](a0_0x5592("0x1e0"));n["text"]=a0_0x5592("0x35a")==typeof s[a0_0x5592("0x9e8")]?s["maxlv"][a0_0x5592("0xae0")]("|")[t[1]-1]:s["maxlv"]+"",o[a0_0x5592("0x1e3")]=a0_0x5592("0x35a")==typeof r[a0_0x5592("0x9e8")]?r[a0_0x5592("0x9e8")]["split"]("|")[e[1]-1]:r[a0_0x5592("0x9e8")]+"";const l=q[a0_0x5592("0x9d2")](i,t[1],t[2]),_=q[a0_0x5592("0x9d2")](a,e[1],e[2]);this["att1Box"][a0_0x5592("0x433")](0)[a0_0x5592("0x1e3")]=N[a0_0x5592("0xa23")][3]+" "+N[a0_0x5592("0x794")][_[0][0]+1];const h=this[a0_0x5592("0x7f5")][a0_0x5592("0xab9")](a0_0x5592("0x80e")),x=this[a0_0x5592("0x7f5")][a0_0x5592("0xab9")]("new");h["text"]=l[0][1]+"",x[a0_0x5592("0x1e3")]=_[0][1]+"",this[a0_0x5592("0x16a")][a0_0x5592("0x433")](0)[a0_0x5592("0x1e3")]=N[a0_0x5592("0xa23")][3]+" "+N["EquSuitDialog"][_[1][0]+1];const c=this[a0_0x5592("0x16a")][a0_0x5592("0xab9")]("old"),d=this[a0_0x5592("0x16a")][a0_0x5592("0xab9")]("new");c["text"]=(l[1]?l[1][1]:0)+"",d[a0_0x5592("0x1e3")]=_[1][1]+"";const u=e[3][e[3][a0_0x5592("0xb0e")]-1],f=k[a0_0x5592("0xa89")][u[0]][a0_0x5592("0x749")][a0_0x5592("0xa51")]("s",u[1]);this["nattLab"]["text"]=N[a0_0x5592("0xa23")][5]+" "+f}[a0_0x5592("0x4fd")](){R[a0_0x5592("0x5c7")](this)}}class si extends t{constructor(){super(),this[a0_0x5592("0x84c")]=null,this[a0_0x5592("0x20")]=null,this["bgNode"]=null,this[a0_0x5592("0x3f9")]=null,this[a0_0x5592("0xa58")]=null,this[a0_0x5592("0x259")]=null}["onEnable"](){this["setClick"](this[a0_0x5592("0x20")],this["onCloseClick"],this);const t=z[a0_0x5592("0x667")],e=k[a0_0x5592("0x906")],a={},i={};for(const h in t){const x=t[h];if(x){const c=q[a0_0x5592("0x9d2")](x[0],x[1],x[2]);for(let t=0;t<c[a0_0x5592("0xb0e")];t++){const u=c[t];a[u[0]]||(a[u[0]]=[]),a[u[0]][a0_0x5592("0x626")](u)}const d=e[x[0]];i[d[a0_0x5592("0x6c0")]]?i[d["suit"]]++:i[d["suit"]]=1}}const r=this[a0_0x5592("0xa58")];for(let t=0;t<r[a0_0x5592("0xae6")];t++){r[a0_0x5592("0x433")](t)[a0_0x5592("0x143")]=!1}const s=[[53,0],[403,0],[53,100],[403,100],[53,200],[403,200]];let n=0;for(const f in a){const p=a[f],m=r[a0_0x5592("0x433")](parseInt(f)-1);m["visible"]=!0,m["pos"](s[0][0],s[0][1]),n=s[0][1],s[a0_0x5592("0x83a")]();const g=m[a0_0x5592("0xab9")]("num");let e=0;for(let t=0;t<p[a0_0x5592("0xb0e")];t++){e+=p[t][1]}g[a0_0x5592("0x1e3")]=O[a0_0x5592("0x77")](e)}this[a0_0x5592("0x259")]["y"]=n+100;const o=this[a0_0x5592("0x259")];for(let t=1;t<o[a0_0x5592("0xae6")];t++){o[a0_0x5592("0x433")](t)["visible"]=!1}let l=0;for(const v in i){let t=i[v];for(let e=0;e<Math[a0_0x5592("0x6fc")](t/2);e++){let t=2*e+2;if(q["thunders"][v]&&q[a0_0x5592("0x47c")][v][t]){l++;const y=o[a0_0x5592("0x433")](l);y[a0_0x5592("0x143")]=!0;const T=y[a0_0x5592("0x433")](0),E=q[a0_0x5592("0x47c")][v][t][0];T[a0_0x5592("0x1e3")]="("+t+") "+N[a0_0x5592("0x9c0")][v]+"\n"+N["EquThunder1"][E]}}}o[a0_0x5592("0x143")]=!!l;const _=n+100+50+62*l;this["bgNode"][a0_0x5592("0x1c1")]=_+160}["onCloseClick"](){Laya[a0_0x5592("0x6eb")]["to"](this["owner"],{scaleX:0,scaleY:0,alpha:0},100,null,Laya["Handler"]["create"](this,()=>{this[a0_0x5592("0x8a0")][a0_0x5592("0xaa4")]()}))}[a0_0x5592("0x4fd")](){}}class ni extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x4e4")]=null,this[a0_0x5592("0x51e")]=null,this[a0_0x5592("0x29a")]=null,this[a0_0x5592("0x806")]=null,this[a0_0x5592("0x14f")]=[],this[a0_0x5592("0x157")]=[]}[a0_0x5592("0xa5c")](){const t=z[a0_0x5592("0x333")],e=[];for(const a in t){const i=t[a];i[1]<7&&e["push"]([i,a])}const d=k[a0_0x5592("0x906")];e["sort"]((t,e)=>{let a=t[0],i=e[0],r=a[0],s=i[0],n=a[1],o=i[1],l=d[r][a0_0x5592("0xb2e")],_=d[s]["type"],h=d[r]["suit"],x=d[s][a0_0x5592("0x6c0")],c=a[2]||1;return 1e5*o+1e4*_+1e3*x+(i[2]||1)-(1e5*n+1e4*l+1e3*h+c)}),this[a0_0x5592("0x14f")]=[],this[a0_0x5592("0x157")]=e,this["itemList"][a0_0x5592("0xa3f")]=e,this[a0_0x5592("0x4d4")](-1,-1)}["initList"](t,e){const a=this[a0_0x5592("0x14f")],i=this[a0_0x5592("0x157")];R[a0_0x5592("0xcf")](v["EquSynItemSel"],[a,t,e]);for(let t=0;t<3;t++){const r=this[a0_0x5592("0x29a")]["getChildAt"](t)[a0_0x5592("0x433")](0);if(null!=a[t]){r[a0_0x5592("0x143")]=!0,r["getComponent"](la)["initItem"](i[a[t]][0])}else r[a0_0x5592("0x143")]=!1}}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this);const t=this[a0_0x5592("0x29a")];for(let i=0;i<3;i++){const e=t[a0_0x5592("0x433")](i)[a0_0x5592("0x433")](0);e&&(e["visible"]=!1,this[a0_0x5592("0x68")](e,()=>{const t=this["sels"][i];if(null==t)return;this[a0_0x5592("0x14f")][a0_0x5592("0x779")](t)>-1&&this[a0_0x5592("0x14f")][a0_0x5592("0x3c8")](this["sels"]["indexOf"](t),1);let e=this[a0_0x5592("0x14f")][a0_0x5592("0xb0e")]?this[a0_0x5592("0x157")][this[a0_0x5592("0x14f")][0]][0][1]:-1,a=-1;this[a0_0x5592("0x14f")][a0_0x5592("0xb0e")]&&(a=this[a0_0x5592("0x157")][this[a0_0x5592("0x14f")][0]][0][0]),this[a0_0x5592("0x4d4")](e,a)},this,null,!0))}const s=t=>{if(this[a0_0x5592("0x14f")][a0_0x5592("0x779")](t)>-1)this[a0_0x5592("0x14f")]["splice"](this[a0_0x5592("0x14f")][a0_0x5592("0x779")](t),1);else{if(this[a0_0x5592("0x14f")]["length"]>=3)return;this[a0_0x5592("0x14f")][a0_0x5592("0x626")](t)}let e=this[a0_0x5592("0x14f")][a0_0x5592("0xb0e")]?this["heqs"][this["sels"][0]][0][1]:-1,a=-1;this["sels"]["length"]&&(a=this[a0_0x5592("0x157")][this[a0_0x5592("0x14f")][0]][0][0]),this[a0_0x5592("0x4d4")](e,a)};this[a0_0x5592("0x806")][a0_0x5592("0x6be")]="",this[a0_0x5592("0x806")][a0_0x5592("0x85f")]=Laya["Handler"]["create"](this,(a,i)=>{const r=t=>{const e=t[a0_0x5592("0x751")](la);e[a0_0x5592("0x7d7")]=s,e[a0_0x5592("0xaa9")]="EquSymDialog",e["initItem"](this[a0_0x5592("0x157")][i][0],i)},t=a[a0_0x5592("0x433")](0);t?r(t):this["loadPrefab"](w[a0_0x5592("0xb0c")]["EquMainItem"])["then"](t=>{const e=this[a0_0x5592("0x4c9")](w["lobby"]["EquMainItem"],t);e[a0_0x5592("0x6f7")](53,53),r(e),a["addChild"](e)})},null,!1),this[a0_0x5592("0x68")](this[a0_0x5592("0x4e4")],()=>{const a=this[a0_0x5592("0x14f")];if(this[a0_0x5592("0x14f")]["length"]<3)return void sa["Tips"](N[a0_0x5592("0x8b")][7]);const i=this["heqs"];let e,r;for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const s=i[a[t]][0][2];(!e||e<s)&&(e=s,r=t)}for(let e=0;e<a[a0_0x5592("0xb0e")];e++){const n=i[a[e]][1];if(e!=r)delete z["hequips"][n];else{const o=i[a[e]][0][0],l=z[a0_0x5592("0x333")][n][a0_0x5592("0xac7")]();if(o>2e3)z["hequips"][n][1]++;else{const d=1e3*O["getRandom"](4,2)+o-1e3;z["hequips"][n][0]=d,z["hequips"][n][1]++}const _=z[a0_0x5592("0x333")][n],h=_[0],x=_[1],c=_[3];let t=k["equs"][h]["addnum"][a0_0x5592("0xae0")]("|")[x-1];for(let i=0;i<parseInt(t);i++){let t,e,a;if(c[i]){const u=c[i][0],f=c[i][1],p=k[a0_0x5592("0xa89")][u];t=f,e=parseFloat(p[a0_0x5592("0x46")]["split"]("|")[x]),a=u}else{a=O[a0_0x5592("0x7de")](1007,1001);const m=k["equadds"][a];e=parseFloat(m[a0_0x5592("0x46")][a0_0x5592("0xae0")]("|")[x]),t=parseFloat(m[a0_0x5592("0x984")][a0_0x5592("0xae0")]("|")[x])}c[i]=[],c[i][0]=a,c[i][1]=this["getAddV"](e,t)}this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")]["EquNewAttDialog"],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t[a0_0x5592("0x751")](ri)[a0_0x5592("0x971")](l,z[a0_0x5592("0x333")][n])},!1,!0)}}this[a0_0x5592("0xa5c")](),R["event"](v[a0_0x5592("0xfb")]),sa["Tips"](N[a0_0x5592("0x8b")][8]),R["event"](a0_0x5592("0x696"))},this),this[a0_0x5592("0x68")](this["choBtn"],()=>{const a=this[a0_0x5592("0x157")];let i=null;if(this[a0_0x5592("0x14f")]&&this["sels"]["length"]){const t=this[a0_0x5592("0x14f")][0],r=a[t][0],s=r[0],n=r[1];let e=[t];for(let t=0;t<a[a0_0x5592("0xb0e")];t++){const o=a[t][0];if(o[0]==s&&o[1]==n&&e[a0_0x5592("0x779")](t)<0&&(e[a0_0x5592("0x626")](t),e[a0_0x5592("0xb0e")]>=3)){i=e;break}}}else for(let t=0;t<a["length"];t++){const l=a[t][0],_=l[0],h=l[1];let e=[t];for(let t=0;t<a["length"];t++){const x=a[t][0];if(x[0]==_&&x[1]==h&&e[a0_0x5592("0x779")](t)<0&&(e[a0_0x5592("0x626")](t),e[a0_0x5592("0xb0e")]>=3)){i=e;break}}if(e[a0_0x5592("0xb0e")]>=3)break}if(i){this[a0_0x5592("0x14f")]=i;let t=a[i[0]][0][1],e=a[i[0]][0][0];this[a0_0x5592("0x4d4")](t,e)}else sa[a0_0x5592("0x8b")](N["Tips"][9])},this),this[a0_0x5592("0xa5c")]()}[a0_0x5592("0xa05")](t,e){const a=[];let i=e;for(;i<=t;)a["push"](i),i+=.5;return a[O[a0_0x5592("0x7de")](a[a0_0x5592("0xb0e")]-1,0)]}[a0_0x5592("0x4fd")](){}}class oi extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x26")]=null,this[a0_0x5592("0x806")]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x8a0")][a0_0x5592("0xab9")]("bg1")["size"](Laya["stage"][a0_0x5592("0x481")],Laya["stage"][a0_0x5592("0x1c1")]),this["setClick"](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this),this["invBtn"][a0_0x5592("0x143")]=![],this[a0_0x5592("0x68")](this[a0_0x5592("0x26")],()=>{C[a0_0x5592("0x965")][a0_0x5592("0x205")]["sendFaceBookFriend"]({width:750,height:380,pngData:[{playImage:null,url:C[a0_0x5592("0x965")]["sdkInfo"]["photo"]||"",posX:26,posY:101,imgWidth:145,imgHeight:145},{playImage:null,url:"res/fx.png",posX:0,posY:0,imgWidth:750,imgHeight:380}],fontData:[{des:O[a0_0x5592("0x77")](I["getCombatValue"]()),posX:259,posY:225,font:a0_0x5592("0x980"),lineWidth:2,fillStyle:a0_0x5592("0x7ff"),textAlign:a0_0x5592("0xa8f"),strokeStyle:a0_0x5592("0x213")}]},()=>{},()=>{},()=>{})},this),this[a0_0x5592("0x806")]["vScrollBarSkin"]="",this["itemList"][a0_0x5592("0x85f")]=Laya[a0_0x5592("0x4d5")]["create"](this,(t,_)=>{const e=t=>{const e=t[a0_0x5592("0xab9")](a0_0x5592("0x2b0")),a=t["getChildByName"]("headIma"),i=t[a0_0x5592("0xab9")](a0_0x5592("0x328")),r=t[a0_0x5592("0xab9")](a0_0x5592("0x4cd")),s=t[a0_0x5592("0xab9")](a0_0x5592("0x64a")),n=this["itemList"]["array"][_],o=!!(_<=2);t[a0_0x5592("0x8fa")]=n[a0_0x5592("0x37")]==C[a0_0x5592("0x965")][a0_0x5592("0x15")][a0_0x5592("0x37")]?a0_0x5592("0x7ad"):"lobby/rank/li_r.png";const l=n["photo"];if(l)if(l[a0_0x5592("0x779")](a0_0x5592("0x7a4"))>-1)a[a0_0x5592("0x2aa")](l);else{let t=n["photo"][a0_0x5592("0xa51")]("robot","");parseInt(t)<=0&&(t="1"),parseInt(t)>=21&&(t="20"),a[a0_0x5592("0x8fa")]=a0_0x5592("0x50c")+t+a0_0x5592("0x525")}else a[a0_0x5592("0x8fa")]=a0_0x5592("0x7b7");e["visible"]=o,i["visible"]=!o,o?e[a0_0x5592("0x8fa")]=a0_0x5592("0x482")+(_+1)+a0_0x5592("0x525"):i[a0_0x5592("0x1e3")]=_+1+"",r["text"]=n[a0_0x5592("0x749")],s["text"]=O[a0_0x5592("0x77")](n[a0_0x5592("0x537")])},a=t[a0_0x5592("0x433")](0);a&&e(a)},null,!1),this[a0_0x5592("0x806")][a0_0x5592("0xa3f")]=[],C[a0_0x5592("0x965")][a0_0x5592("0x68d")]["getRankData"](t=>{this[a0_0x5592("0x806")][a0_0x5592("0xa3f")]=t})}[a0_0x5592("0x4fd")](){}}const li=[[[101,1e4]],[[201,100]],[[5,1]],[[2101,1,2]],[[101,2e4]],[[201,100]],[[101,5e4],[201,200],[2203,1,3]]];class _i extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x65a")]=null,this[a0_0x5592("0x3c0")]=null,this[a0_0x5592("0x4c")]=null,this[a0_0x5592("0x14d")]=null,this[a0_0x5592("0x2f1")]=null}["onEnable"](){this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this);const t=t=>{const e=H[a0_0x5592("0x975")];if(!e||e[a0_0x5592("0x919")]>6||O[a0_0x5592("0x98b")](e["last"],Date["now"]()))return;const a=e["num"];if(2==a)H[a0_0x5592("0x555")][a0_0x5592("0x626")](5),H["unlockPage"]["indexOf"](a0_0x5592("0x793"))<0&&H[a0_0x5592("0x34")][a0_0x5592("0x626")](a0_0x5592("0x793")),H[a0_0x5592("0x34")][a0_0x5592("0x779")](a0_0x5592("0x451"))<0&&H[a0_0x5592("0x34")]["push"](a0_0x5592("0x451")),this[a0_0x5592("0x165")](w[a0_0x5592("0xb0c")]["UnlockChapterDialog"],g[a0_0x5592("0x173")][a0_0x5592("0x72c")],t=>{t[a0_0x5592("0x751")](na)[a0_0x5592("0x971")]([0,5],a0_0x5592("0x42a"))}),H[a0_0x5592("0x337")](),this[a0_0x5592("0x6a6")](this);else{const s=li[a];if(t){const n=[],o=[];for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const l=s[t],_=l[0];_<1e3?(n[a0_0x5592("0x626")]([_,2*l[1]]),o["push"]([_,2*l[1]])):(n[a0_0x5592("0x626")](l,l),o[a0_0x5592("0x626")]([L["items"][_]["equip"],l[1]],[L[a0_0x5592("0x65a")][_]["equip"],l[1]]))}C[a0_0x5592("0x965")][a0_0x5592("0x9c4")][a0_0x5592("0x8e3")](C[a0_0x5592("0xaa1")],()=>{z[a0_0x5592("0xa8a")](n),ia[a0_0x5592("0xf4")](o),H[a0_0x5592("0x337")](),this["closeDialog"](this)})}else{const h=[];for(let t=0;t<s[a0_0x5592("0xb0e")];t++){const x=s[t],c=x[0];c<1e3?h["push"](x):h[a0_0x5592("0x626")]([L[a0_0x5592("0x65a")][c][a0_0x5592("0x4b")],x[1]])}z[a0_0x5592("0xa8a")](s),ia[a0_0x5592("0xf4")](h),H[a0_0x5592("0x337")](),this["closeDialog"](this)}}let i=1;const r=z[a0_0x5592("0x558")];for(const d in r){const u=parseInt(d);u>i&&(i=u)}T(a0_0x5592("0x1d9")+H["signinData"][a0_0x5592("0x919")]+"天",a0_0x5592("0x7c4")+i+"章")};this[a0_0x5592("0x68")](this["rewBtn"],()=>{t(!1)},this),this["setClick"](this[a0_0x5592("0x14d")],()=>{t(!0)},this),this[a0_0x5592("0x6bb")]()}["initItems"](){const e=this["items"],a=e[a0_0x5592("0xae6")],i=H[a0_0x5592("0x975")];if(!i)return;this[a0_0x5592("0x2f1")]&&(this[a0_0x5592("0x2f1")][a0_0x5592("0x3b0")]=0),this[a0_0x5592("0x2f1")]=null;for(let t=0;t<a;t++){const n=e["getChildAt"](t),o=n[a0_0x5592("0xab9")]("light"),l=n["getChildByName"]("dayLab"),_=l[a0_0x5592("0xab9")]("dayLab"),h=n[a0_0x5592("0xab9")](a0_0x5592("0x65c")),x=n[a0_0x5592("0xab9")](a0_0x5592("0x893")),c=n[a0_0x5592("0xab9")]("getNode"),d=a0_0x5592("0xd7")+(t+1);l[a0_0x5592("0x1e3")]=_[a0_0x5592("0x1e3")]=d,h[a0_0x5592("0x1e3")]=2==t?Z[a0_0x5592("0x555")][5][a0_0x5592("0x749")]:"x"+O[a0_0x5592("0x77")](li[t][0][1]),t<i[a0_0x5592("0x919")]?(x[a0_0x5592("0x143")]=!1,c["visible"]=!0):t==i[a0_0x5592("0x919")]?(x[a0_0x5592("0x143")]=!0,c[a0_0x5592("0x143")]=!1,this["currLight"]=o):(x["visible"]=!1,c[a0_0x5592("0x143")]=!1)}const r=this["item7"],s=li[6];for(let t=0;t<r["numChildren"];t++){const u=r[a0_0x5592("0x433")](t),f=u[a0_0x5592("0xab9")](a0_0x5592("0x4cd")),p=u[a0_0x5592("0xab9")](a0_0x5592("0x65c"));f[a0_0x5592("0x1e3")]=L[a0_0x5592("0x65a")][s[t][0]][a0_0x5592("0x749")],p["text"]="x"+O[a0_0x5592("0x77")](s[t][1])}2==i[a0_0x5592("0x919")]&&(this[a0_0x5592("0x4c")]["x"]=360,this[a0_0x5592("0x14d")][a0_0x5592("0x143")]=!1)}[a0_0x5592("0x4fd")](){}[a0_0x5592("0x3de")](){this[a0_0x5592("0x2f1")]&&(this[a0_0x5592("0x2f1")]["rotation"]+=1)}}class hi extends t{constructor(){super(),this[a0_0x5592("0x365")]=null,this[a0_0x5592("0xb10")]=null,this["item1"]=null,this[a0_0x5592("0x223")]=null,this[a0_0x5592("0x7ce")]=null,this[a0_0x5592("0x7a3")]=null,this[a0_0x5592("0x55c")]=null,this[a0_0x5592("0x2c2")]=null,this["timerLab"]=null,this["timer"]=0,this["tdata"]=null}[a0_0x5592("0x880")](){this[a0_0x5592("0x68")](this[a0_0x5592("0x365")],()=>{if(!this["tdata"])return;const t=Date[a0_0x5592("0x24")]();M[a0_0x5592("0x38f")](this["tdata"]["id"],{id:this[a0_0x5592("0x886")]["id"],start:t,end:t+1e3*this[a0_0x5592("0x886")][a0_0x5592("0x22e")],recd:!1,num:0}),this[a0_0x5592("0x971")](this[a0_0x5592("0x886")])},this),this[a0_0x5592("0x68")](this[a0_0x5592("0xb10")],()=>{if(!this["tdata"])return;const t=this[a0_0x5592("0x886")];M["getTask"](t["id"]),this[a0_0x5592("0x971")](t);let a=null,e=t[a0_0x5592("0x65e")];if(a0_0x5592("0xa62")!=e){const n=e=e["split"]("|");if(n[a0_0x5592("0xb0e")]){if(O[a0_0x5592("0x7de")](100,1)<=15){a=n[O[a0_0x5592("0x7de")](n[a0_0x5592("0xb0e")]-1,0)]}}}const i=t["reward"],r={1:[A[a0_0x5592("0x5e2")],i]},s=[[A[a0_0x5592("0x5e2")],i]];if(a){let t=1,e=parseInt(a);const o=L["items"][a];o&&(t=o[a0_0x5592("0x621")],e=o[a0_0x5592("0x4b")]),r[2]=[parseInt(a),1],s[a0_0x5592("0x626")]([e,1,t])}z[a0_0x5592("0xa8a")](r),ia["Reward"](s)},this)}["setData"](t){this[a0_0x5592("0x886")]=t,this["titLab"][a0_0x5592("0x1e3")]=t["title"],this[a0_0x5592("0x7a3")]["text"]=t[a0_0x5592("0xa1c")],this["item1"][a0_0x5592("0x433")](1)[a0_0x5592("0x1e3")]=O["formatNumber"](t[a0_0x5592("0xb05")]);const e=O[a0_0x5592("0x814")](t[a0_0x5592("0x22e")]);this[a0_0x5592("0x228")]["text"]=e[0]+"H "+e[1]+"M "+e[2]+"S";const a=M[a0_0x5592("0x65")][t["id"]];if(a&&a[a0_0x5592("0x99e")]){this[a0_0x5592("0x365")][a0_0x5592("0x143")]=!1;const i=Date[a0_0x5592("0x24")]();if(i>=a["end"])a[a0_0x5592("0x6a8")]?(this[a0_0x5592("0xb10")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x223")][a0_0x5592("0x143")]=!0,this["timeBar"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x2c2")][a0_0x5592("0x143")]=!1):(this[a0_0x5592("0xb10")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x223")]["visible"]=!1,this[a0_0x5592("0x55c")]["visible"]=!0,this[a0_0x5592("0x2c2")]["visible"]=!0,this[a0_0x5592("0x55c")]["value"]=0,this[a0_0x5592("0x2c2")][a0_0x5592("0x1e3")]=a0_0x5592("0x71d"));else{this[a0_0x5592("0xb10")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x223")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x55c")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x2c2")]["visible"]=!0,this[a0_0x5592("0x55c")][a0_0x5592("0x8de")]=1-(i-a[a0_0x5592("0x99e")])/(a[a0_0x5592("0x6f2")]-a["start"]);const r=O[a0_0x5592("0x814")](Math[a0_0x5592("0x6fc")]((a["end"]-i)/1e3));this[a0_0x5592("0x2c2")]["text"]=this[a0_0x5592("0x55f")](r[0])+":"+this[a0_0x5592("0x55f")](r[1])+":"+this["autoAddZero"](r[2])}}else this[a0_0x5592("0x365")][a0_0x5592("0x143")]=!0,this["recBtn"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x223")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x55c")]["visible"]=!1,this[a0_0x5592("0x2c2")][a0_0x5592("0x143")]=!1;this[a0_0x5592("0xa84")]()}[a0_0x5592("0xa84")](){if(!this["tdata"])return;const t=Date[a0_0x5592("0x24")](),e=this["tdata"],a=M[a0_0x5592("0x65")][e["id"]];if(a&&a["recd"]&&a[a0_0x5592("0x6f4")]&&t>=a[a0_0x5592("0x6f4")]&&(a[a0_0x5592("0x99e")]=a["end"]=a[a0_0x5592("0x6f4")]=null,a[a0_0x5592("0x919")]=0,a[a0_0x5592("0x6a8")]=!1,this[a0_0x5592("0x971")](this[a0_0x5592("0x886")])),a&&a[a0_0x5592("0x99e")])if(t>=a[a0_0x5592("0x6f2")])if(a[a0_0x5592("0x6a8")]){this[a0_0x5592("0x223")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0xb10")][a0_0x5592("0x143")]=!1;const i=a["reset"];if(i){this[a0_0x5592("0x55c")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x2c2")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x55c")][a0_0x5592("0x8de")]=(i-t)/144e5;const r=O[a0_0x5592("0x814")](Math[a0_0x5592("0x6fc")]((i-t)/1e3));this[a0_0x5592("0x2c2")][a0_0x5592("0x1e3")]=this[a0_0x5592("0x55f")](r[0])+":"+this[a0_0x5592("0x55f")](r[1])+":"+this["autoAddZero"](r[2])}}else this[a0_0x5592("0xb10")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x223")][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x55c")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x2c2")][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x55c")][a0_0x5592("0x8de")]=0,this[a0_0x5592("0x2c2")][a0_0x5592("0x1e3")]=a0_0x5592("0x71d");else{this["recBtn"][a0_0x5592("0x143")]=!1,this[a0_0x5592("0x223")]["visible"]=!1,this[a0_0x5592("0x55c")][a0_0x5592("0x143")]=!0,this["timeLab"][a0_0x5592("0x143")]=!0,this[a0_0x5592("0x55c")]["value"]=1-(t-a[a0_0x5592("0x99e")])/(a["end"]-a[a0_0x5592("0x99e")]);const s=O["formatTimer"](Math[a0_0x5592("0x6fc")]((a[a0_0x5592("0x6f2")]-t)/1e3));this["timeLab"][a0_0x5592("0x1e3")]=this[a0_0x5592("0x55f")](s[0])+":"+this["autoAddZero"](s[1])+":"+this[a0_0x5592("0x55f")](s[2])}}[a0_0x5592("0x55f")](t){return t<10?"0"+t:t+""}[a0_0x5592("0x3de")](){this[a0_0x5592("0x6ec")]+=Laya[a0_0x5592("0x6ec")][a0_0x5592("0x154")],this[a0_0x5592("0x6ec")]>=1e3&&(this[a0_0x5592("0x6ec")]=0,this[a0_0x5592("0xa84")]())}[a0_0x5592("0x4fd")](){}}class xi extends t{constructor(){super(),this[a0_0x5592("0x20")]=null,this[a0_0x5592("0x806")]=null}["onEnable"](){this[a0_0x5592("0x68")](this[a0_0x5592("0x20")],()=>{this[a0_0x5592("0x6a6")](this)},this);const t=K[a0_0x5592("0x65")],r=[],e=[],a=Date[a0_0x5592("0x24")]();for(const i in t){const s=t[i],n=M[a0_0x5592("0x65")][s["id"]];n&&n["end"]<=a&&!n["recd"]&&n["start"]?r[a0_0x5592("0x626")](s):e[a0_0x5592("0x626")](s)}r[a0_0x5592("0x626")]["apply"](r,e),this["itemList"][a0_0x5592("0x6be")]="",this[a0_0x5592("0x806")][a0_0x5592("0x85f")]=Laya["Handler"][a0_0x5592("0x2ab")](this,(a,e)=>{const i=t=>{t["getComponent"](hi)[a0_0x5592("0x971")](r[e])},t=a[a0_0x5592("0x433")](0);t?i(t):this[a0_0x5592("0x7e3")](w[a0_0x5592("0xb0c")][a0_0x5592("0x75a")])["then"](t=>{const e=this[a0_0x5592("0x4c9")](w[a0_0x5592("0xb0c")][a0_0x5592("0x75a")],t);a["addChild"](e),i(e)})},null,!1),this["itemList"]["array"]=r}["onDisable"](){}}class i{constructor(){}static[a0_0x5592("0x75b")](){var t=Laya["ClassUtils"]["regClass"];t(a0_0x5592("0x4ac"),Pe),t(a0_0x5592("0x5f0"),ie),t("app/battle/PlayerManager.ts",Ge),t(a0_0x5592("0x119"),He),t("app/battle/BattleScene.ts",Y),t(a0_0x5592("0x17"),Ut),t(a0_0x5592("0xa33"),ze),t(a0_0x5592("0x3f5"),g),t("core/component/Toggle.ts",wt),t("core/component/ToggleContainer.ts",Dt),t(a0_0x5592("0x6ae"),qe),t(a0_0x5592("0xde"),Ke),t("core/component/GuidanceBtn.ts",Qe),t("app/lobby/LobbyScene.ts",ba),t("app/lobby/TestUI.ts",Sa),t(a0_0x5592("0x10c"),Mt),t(a0_0x5592("0x264"),Ra),t(a0_0x5592("0x72a"),At),t(a0_0x5592("0x70d"),Aa),t(a0_0x5592("0xa69"),La),t(a0_0x5592("0x84"),Pt),t(a0_0x5592("0x152"),Bt),t(a0_0x5592("0x391"),Ma),t(a0_0x5592("0x91b"),Da),t(a0_0x5592("0x178"),Ft),t("app/battle/bg/FriendDialog.ts",Ca),t(a0_0x5592("0x859"),wa),t(a0_0x5592("0x5b7"),Pa),t(a0_0x5592("0x98e"),kt),t(a0_0x5592("0x12c"),Oa),t("app/battle/bg/RebornDialog.ts",Vt),t("app/battle/bg/SupplySkillDialog.ts",Lt),t(a0_0x5592("0x53"),Kt),t("app/battle/effect/PlayerWave.ts",Na),t(a0_0x5592("0x388"),Ba),t("app/battle/effect/PlayerBlast.ts",Fa),t(a0_0x5592("0x478"),Va),t(a0_0x5592("0x16"),Jt),t(a0_0x5592("0x261"),W),t(a0_0x5592("0x57b"),Zt),t("app/battle/enemy/EnemyCollision.ts",ae),t(a0_0x5592("0x3b2"),jt),t("app/battle/enemy/Enemy1001.ts",Ua),t("app/battle/enemy/Enemy1008.ts",ee),t(a0_0x5592("0x86a"),ka),t("app/battle/enemy/Enemy2001.ts",Ga),t(a0_0x5592("0x762"),Ha),t(a0_0x5592("0x513"),Wa),t(a0_0x5592("0xa36"),Xa),t(a0_0x5592("0x3ef"),Ya),t(a0_0x5592("0x4fb"),qa),t(a0_0x5592("0x76"),It),t(a0_0x5592("0x7b8"),Za),t("app/battle/enemySkill/EnemyLaser.ts",ja),t("app/battle/enemySkill/EnemyLine.ts",Gt),t(a0_0x5592("0x8d2"),f),t(a0_0x5592("0xe1"),za),t(a0_0x5592("0xaf5"),Ka),t(a0_0x5592("0x3dc"),Xt),t("app/battle/enemySkill/EnemySkill16.ts",zt),t("app/battle/enemySkill/EnemySkill18.ts",Wt),t(a0_0x5592("0xa18"),se),t(a0_0x5592("0x6e7"),Ue),t(a0_0x5592("0x964"),Ve),t(a0_0x5592("0x3b4"),ke),t(a0_0x5592("0xa7f"),le),t(a0_0x5592("0x2af"),he),t(a0_0x5592("0x21e"),ce),t(a0_0x5592("0x9f1"),Qa),t(a0_0x5592("0x9b9"),ue),t("app/battle/skill/Player4MainBoom.ts",Ja),t(a0_0x5592("0xb36"),$a),t("app/battle/skill/PlayerSkill1.ts",$t),t(a0_0x5592("0x970"),ne),t("app/battle/player/PlayerLaserCollision.ts",oe),t(a0_0x5592("0x5e8"),de),t(a0_0x5592("0x5c9"),ge),t(a0_0x5592("0x368"),fe),t(a0_0x5592("0x66f"),pe),t(a0_0x5592("0x666"),ti),t(a0_0x5592("0xa21"),Ae),t(a0_0x5592("0xa0f"),_e),t(a0_0x5592("0x9f5"),me),t(a0_0x5592("0x6d2"),ve),t(a0_0x5592("0x7cc"),ye),t(a0_0x5592("0x20e"),Ee),t("app/battle/wing/PlayerWing.ts",be),t("app/battle/wing/PlayerWing1.ts",Ce),t("app/battle/skill/PlayerSkill11.ts",Se),t("app/battle/wing/PlayerWing2.ts",Re),t(a0_0x5592("0x597"),Ie),t(a0_0x5592("0x93f"),Le),t(a0_0x5592("0x5b8"),Me),t(a0_0x5592("0xac3"),De),t("app/battle/wing/PlayerWing6.ts",we),t(a0_0x5592("0x1ef"),xe),t(a0_0x5592("0x83b"),Ot),t(a0_0x5592("0xafd"),ei),t(a0_0x5592("0x960"),Je),t(a0_0x5592("0x46f"),$e),t("app/lobby/BattlePage.ts",aa),t("app/lobby/common/CommonDialog.ts",dt),t(a0_0x5592("0xb17"),ut),t("app/lobby/common/CommonRewardAdDialog.ts",ra),t("app/lobby/common/CommonRewardDialog.ts",ia),t(a0_0x5592("0x6df"),sa),t("app/lobby/common/UnlockChapterDialog.ts",na),t(a0_0x5592("0x1c7"),ai),t(a0_0x5592("0x83e"),ii),t(a0_0x5592("0x297"),ca),t("app/lobby/equipment/EquMainItem.ts",la),t(a0_0x5592("0x722"),xa),t(a0_0x5592("0xac1"),oa),t(a0_0x5592("0x25c"),ri),t(a0_0x5592("0x853"),da),t(a0_0x5592("0x370"),si),t(a0_0x5592("0x1e5"),ni),t(a0_0x5592("0x679"),ua),t("app/lobby/hangar/HangarPage.ts",ga),t(a0_0x5592("0x7b"),ma),t("app/lobby/RankDialog2.ts",oi),t(a0_0x5592("0x283"),va),t(a0_0x5592("0x675"),ya),t(a0_0x5592("0x570"),_i),t(a0_0x5592("0x72d"),hi),t(a0_0x5592("0x63"),xi),t(a0_0x5592("0x623"),ea)}}i[a0_0x5592("0x481")]=720,i[a0_0x5592("0x1c1")]=1280,i[a0_0x5592("0xa9a")]=a0_0x5592("0x852"),i[a0_0x5592("0x8e6")]=a0_0x5592("0x7b5"),i["alignV"]="top",i["alignH"]="center",i[a0_0x5592("0x24d")]=a0_0x5592("0x59b"),i["sceneRoot"]="",i[a0_0x5592("0x997")]=!1,i[a0_0x5592("0x7bd")]=!1,i[a0_0x5592("0x373")]=!1,i[a0_0x5592("0x64e")]=!0,i[a0_0x5592("0x75b")]();new class{constructor(){let t=!1;if(window["navigator"]&&window[a0_0x5592("0x5fe")][a0_0x5592("0x896")]){const e=window["navigator"][a0_0x5592("0x896")];t=!!e["match"](/\(i[^;]+;( U;)? CPU.+Mac OS X/),C[a0_0x5592("0x5ba")]=/macintosh|mac os x/i[a0_0x5592("0x31f")](e)}t&&(Config[a0_0x5592("0x674")]=!1),window[a0_0x5592("0x8a8")]?Laya3D[a0_0x5592("0x75b")](i[a0_0x5592("0x481")],i["height"]):Laya[a0_0x5592("0x75b")](i["width"],i["height"],Laya[a0_0x5592("0x66c")]),Laya["Physics"]&&Laya["Physics"][a0_0x5592("0x733")](),Laya[a0_0x5592("0x36e")]&&Laya[a0_0x5592("0x36e")][a0_0x5592("0x733")](),Laya[a0_0x5592("0x43c")]["scaleMode"]=i[a0_0x5592("0xa9a")],document[a0_0x5592("0x62d")][a0_0x5592("0xaab")]/document["documentElement"][a0_0x5592("0x8bb")]>i[a0_0x5592("0x481")]/i[a0_0x5592("0x1c1")]&&(Laya["stage"][a0_0x5592("0xa9a")]=a0_0x5592("0x242")),Laya[a0_0x5592("0x43c")][a0_0x5592("0x8e6")]=i[a0_0x5592("0x8e6")],Laya[a0_0x5592("0x43c")][a0_0x5592("0x385")]=i["alignV"],Laya[a0_0x5592("0x43c")][a0_0x5592("0x118")]=i[a0_0x5592("0x118")],Laya["URL"][a0_0x5592("0x64e")]=i[a0_0x5592("0x64e")],(i[a0_0x5592("0x997")]||a0_0x5592("0x61c")==Laya[a0_0x5592("0x11a")][a0_0x5592("0x3e0")]("debug"))&&Laya["enableDebugPanel"](),i[a0_0x5592("0x373")]&&Laya["PhysicsDebugDraw"]&&Laya[a0_0x5592("0x2a")]["enable"](),i["stat"]&&Laya[a0_0x5592("0x4b7")][a0_0x5592("0x65d")](),Laya[a0_0x5592("0x58f")][a0_0x5592("0x733")](a0_0x5592("0x4d3"),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,this[a0_0x5592("0x32a")]),Laya[a0_0x5592("0x58f")][a0_0x5592("0x5d8")])}[a0_0x5592("0x32a")](){Laya[a0_0x5592("0x8f8")][a0_0x5592("0x733")](a0_0x5592("0xaf"),Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,this[a0_0x5592("0x164")]))}[a0_0x5592("0x63a")](r){const s=[],t=w[a0_0x5592("0x4f3")];for(const e in t){const a=t[e];s[a0_0x5592("0x626")](a)}const n=[];return n["push"](b[a0_0x5592("0x418")]),n[a0_0x5592("0x626")](b[a0_0x5592("0x4e9")]),n[a0_0x5592("0x626")](y[r]),3==r&&n[a0_0x5592("0x626")](b["DaoDan"]),4==r&&n[a0_0x5592("0x626")](b["Main4"]),new Promise((e,t)=>{let a=0,i=0;n[a0_0x5592("0xb0e")]&&i++,s[a0_0x5592("0xb0e")]&&i++,S[a0_0x5592("0x1eb")](n)[a0_0x5592("0x284")](()=>{console["log"](a0_0x5592("0x529")),++a==i&&e()}),Laya[a0_0x5592("0x80c")][a0_0x5592("0x2ab")]("prefab/battle/merge.json",Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{console[a0_0x5592("0xad6")]("load prefab complete..."),S[a0_0x5592("0x90e")](r);const t=E["assets"][I[a0_0x5592("0x9d5")]+""+I[a0_0x5592("0x5d4")]];t&&S[a0_0x5592("0x50")](t[1]),++a==i&&e()}),Laya[a0_0x5592("0x4d5")]["create"](this,t=>{}))})}["onHideBanner"](){try{window["ggmgr"]["hb"]()}catch(t){}window[a0_0x5592("0x7dc")]=window[a0_0x5592("0x7dc")]||1;var t=this;if(window["abbdc"]<10){setTimeout(function(){window[a0_0x5592("0x7dc")]++;t[a0_0x5592("0x8e1")]()},3e3)}}["onConfigLoaded"](){Laya[a0_0x5592("0x978")]["regClass"]("laya.effect.ColorFilterSetter",Laya["ColorFilterSetter"]),Laya[a0_0x5592("0x978")][a0_0x5592("0xaec")](a0_0x5592("0x88f"),Laya[a0_0x5592("0xb6")]),Laya["ClassUtils"][a0_0x5592("0xaec")]("laya.effect.BlurFilterSetter",Laya[a0_0x5592("0x9ae")]),C[a0_0x5592("0x965")]=new Tt,Laya[a0_0x5592("0x262")]["useAudioMusic"]=!1,Laya[a0_0x5592("0x955")][a0_0x5592("0x2ca")]=!1;this[a0_0x5592("0x8e1")]();const v=()=>{S["loadGamePre"](),console["log"](a0_0x5592("0x346")),H[a0_0x5592("0xb2c")]?i[a0_0x5592("0x24d")]&&Laya[a0_0x5592("0x876")]["open"](i[a0_0x5592("0x24d")]):(H[a0_0x5592("0xb2c")]=1,I["diff"]=1,I["id"]=2,I[a0_0x5592("0x9d5")]=0,I[a0_0x5592("0x2d6")]=1,I["initPlayer"](!0),I["id"]=1,this[a0_0x5592("0x63a")](2)[a0_0x5592("0x284")](()=>{Laya[a0_0x5592("0x876")][a0_0x5592("0x4c9")]("BattleScene.scene")})),T(a0_0x5592("0x8bf"),"");window[a0_0x5592("0xaae")]["showLoad"]()};j["__initDefine__"](),j["initShader"]();const s=(t,e)=>{for(const a in t){const i=t[a];e[a]=i}};setInterval(()=>{const t={pc:I,pic:z,ppc:H,ptc:M},e={[C[a0_0x5592("0xb2d")][0]]:t};C[a0_0x5592("0x965")][a0_0x5592("0xfa")](e,()=>{})},1e4);const t=[];for(const e in tt){const a=tt[e];t[a0_0x5592("0x626")](a)}let y=0;const n={pc:I,pic:z,ppc:H,ptc:M};C[a0_0x5592("0x965")]["getUserData"](t=>{if(t){const e=t;if(e)if(Object[a0_0x5592("0x36c")](e)["length"]){const a=e;for(const i in a){const r=a[i];s(r,n[i])}R[a0_0x5592("0xcf")](a0_0x5592("0x2d7"))}else C["isNewPlayer"]=!0;else C["isNewPlayer"]=!0}else C["isNewPlayer"]=!0;3==++y&&v()}),Laya[a0_0x5592("0x80c")][a0_0x5592("0x6e9")](t,Laya["Handler"][a0_0x5592("0x2ab")](this,()=>{3==++y&&v()})),Laya[a0_0x5592("0x80c")][a0_0x5592("0x6e9")]([a0_0x5592("0x2cb")],Laya[a0_0x5592("0x4d5")][a0_0x5592("0x2ab")](this,()=>{y++;const e=Laya["loader"][a0_0x5592("0x761")]("json/merge.json"),t=e[et[a0_0x5592("0x222")]];U["setChatpers"](t);const a=e[et[a0_0x5592("0x40c")]];D["setSkills"](a);const i=e[et[a0_0x5592("0xafe")]];$[a0_0x5592("0x106")](i);for(let t=0;t<16;t++){const g=e[et[a0_0x5592("0x625")+t]];E["setEnemys1"](g,t)}const r=e[et[a0_0x5592("0x8b7")]];J["setExps"](r);const s=e[et["Upaircraft"]];G[a0_0x5592("0x3c9")](s);const n=e[et[a0_0x5592("0x426")]];G["setGolds"](n);const o=e[et[a0_0x5592("0x62a")]];Z[a0_0x5592("0x3c9")](o);const l=e[et[a0_0x5592("0xac2")]];L[a0_0x5592("0x315")](l);const _=e[et[a0_0x5592("0x4b9")]];L[a0_0x5592("0x3ad")](_);const h=e[et[a0_0x5592("0xaff")]];k["setItems"](h);const x=e[et[a0_0x5592("0x1b")]];k[a0_0x5592("0x4cc")](x);const c=e[et[a0_0x5592("0x4a2")]];q["setUpequips"](c);const d=e[et[a0_0x5592("0x174")]];K["setTasks"](d);const u=e[et[a0_0x5592("0x58e")]];K[a0_0x5592("0x54a")](u);const f=e[et[a0_0x5592("0x890")]];K["setDailyTasks"](f);const p=e[et["Adventurefight"]];Q["setData"](p);const m=e[et[a0_0x5592("0x583")]];Q["setDrop"](m),3==y&&v()}),null,Laya["Loader"][a0_0x5592("0xaf1")])}}}();