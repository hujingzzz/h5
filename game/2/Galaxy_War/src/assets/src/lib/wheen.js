class Wheen{constructor(e){if(e&&this.apply(e),this._running=!1,this._tweenChain=[],this._chainIndex=0,this._flags={},this._lastUpdateTime=0,this._completed=!1,this._integrated=!1,this._class=null,this._update=this._update.bind(this),"undefined"!=typeof window){let e=window.cc;if(void 0!==e&&e.ENGINE_VERSION){let n=this._update;if(e.Canvas.instance)try{this._class=e.Class({extends:e.Component,update:n}),e.Canvas.instance.node.addComponent(this._class),this._integrated=!0}catch(t){console.error(t)}}}}static stop(e){e.__wheens__&&e.__wheens__.forEach(e=>{e.stop()})}static pause(e){e.__wheens__&&e.__wheens__.forEach(e=>{e.pause()})}static resume(e){e.__wheens__&&e.__wheens__.forEach(e=>{e.resume()})}static start(e){e.__wheens__&&e.__wheens__.forEach(e=>{e.start()})}apply(e){return this.target=e,void 0!==e.__wheens__&&e.__wheens__||(e.__wheens__=[]),e.__wheens__.push(this),this}from(e){return this._tweenChain.push({args:e,type:"from"}),this}to(e,t,n,s){let i={args:e,time:t,easing:n,type:"to",postFunc:s};return this._tweenChain.push(i),this}wait(e){return this._tweenChain.push({time:e,type:"wait",elapsedTime:0}),this}setFlag(e){return this._flags[e]=this._tweenChain.length,this}loop(e,t){return this._tweenChain.push({count:e,flag:t,type:"loop",currentLap:0}),this}callFunc(e,t,...n){return this._tweenChain.push({func:e,self:t,args:n,type:"callFunc"}),this}invoke(e,t,...n){return this.callFunc(e,t,...n)}on(e,t,n){return this._events||(this._events={}),this._events[e]={func:t,self:n},this}start(){if(!this.target)throw new Error("You have to assign the animation to a target!");return this._chainIndex=0,this._running=!0,this._lastUpdateTime=(new Date).getTime(),this._tweenChain.forEach(e=>{"from"===e.type&&assign(this.target,e.args)}),this._integrated||window.requestAnimationFrame(()=>this._update()),this._events&&this._events.start&&(this._events.start.self?this._events.start.func.call(this._events.start.self):this._events.start.func()),this}pause(){return this._running=!1,this}resume(){return this._running=!0,this}stop(){return this._running=!1,this._completed=!0,this._remove(),this._class&&cc.Canvas.instance.node.removeComponent(this._class),this._events&&this._events.finish&&(this._events.finish.self?this._events.finish.func.call(this._events.finish.self):this._events.finish.func()),this}_remove(){if(this.target.__wheens__){let e=this.target.__wheens__.indexOf(this);e>-1&&this.target.__wheens__.splice(e,1),this.target.__wheens__.length<=0&&delete this.target.__wheens__}}_update(e){this._integrated&&e?e*=1e3:e=(new Date).getTime()-this._lastUpdateTime;let t=!1;if(this._running&&!this._completed){let n=this._tweenChain[this._chainIndex];if(!n||!this.target||this._integrated&&this.target instanceof cc.Node&&!this.target.isValid)this.stop();else switch(n.type){case"from":this._chainIndex++,t=!0;break;case"to":if(void 0===n._time)if("object"==typeof n.time){let e=0;for(let t in n.time)n.time[t]>e&&(e=n.time[t]);n._time=e}else n._time=n.time;if(n.time<=0)assign(this.target,n.args),this._chainIndex++;else{if(!n.org){n.org={};for(let e in n.args)n.org[e]=_get(this.target,e)}n.elapsedTime?n.elapsedTime+=e:n.elapsedTime=e;let t={};if(n.elapsedTime>=n._time)n.elapsedTime=n._time,assign(this.target,n.args),assign(t,n.args),this._chainIndex++;else{n.easing||(n.easing=Wheen.Easing.Linear);for(let e in n.args){let s="object"==typeof n.time?n.time[e]:n._time;if(n.elapsedTime>=s)_get(this.target,e)!==n.args[e]&&_set(this.target,e,n.args[e]);else{let t;t="object"==typeof n.easing?n.easing[e]:n.easing,_set(this.target,e,t(n.elapsedTime,n.org[e],n.args[e]-n.org[e],s))}t[e]=_get(this.target,e)}}this._events&&this._events.update&&(this._events.update.self?this._events.update.func.call(this._events.update.self,t):this._events.update.func(t))}break;case"wait":n.elapsedTime+=e,n.elapsedTime>n.time&&this._chainIndex++;break;case"loop":if(n.currentLap++,!n.count||n.count<=0||n.currentLap<n.count){let e=n.flag&&this._flags[n.flag]||0;for(let t=e;t<this._chainIndex;t++){let e=this._tweenChain[t],n=e.elapsedTime;"loop"===e.type?e.currentLap=0:"wait"===e.type?e.elapsedTime=0:"to"===e.type&&(e.elapsedTime=0,delete e.org),n&&n.toString()}this._chainIndex=e}else this._chainIndex++,t=!0;break;case"callFunc":if(n.func){n.self?n.func.call(n.self,...n.args):n.func(...n.args),this._chainIndex++;break}}}this._lastUpdateTime+=e,t?this._update():this._completed||this._integrated||window.requestAnimationFrame(()=>this._update())}}function _set(e,t,n){let s=t.split(".");if(s.length>1&&void 0!==e[s[0]]){let t=0,i=e;for(;t<s.length;)i=i[s[t]],++t==s.length-1&&(i[s[t]]=n)}else e[t]=n}function _get(e,t){let n=t.split(".");if(n.length>1){let s=0,i=e;for(;s<n.length;){if(void 0===(i=i[n[s]]))return e[t];s++}return i}return e[t]}Wheen.Easing={Linear:function(e,t,n,s){return n*e/s+t},Quad:{easeIn:function(e,t,n,s){return n*(e/=s)*e+t},easeOut:function(e,t,n,s){return-n*(e/=s)*(e-2)+t},easeInOut:function(e,t,n,s){return(e/=s/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},Cubic:{easeIn:function(e,t,n,s){return n*(e/=s)*e*e+t},easeOut:function(e,t,n,s){return n*((e=e/s-1)*e*e+1)+t},easeInOut:function(e,t,n,s){return(e/=s/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}},Quart:{easeIn:function(e,t,n,s){return n*(e/=s)*e*e*e+t},easeOut:function(e,t,n,s){return-n*((e=e/s-1)*e*e*e-1)+t},easeInOut:function(e,t,n,s){return(e/=s/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}},Quint:{easeIn:function(e,t,n,s){return n*(e/=s)*e*e*e*e+t},easeOut:function(e,t,n,s){return n*((e=e/s-1)*e*e*e*e+1)+t},easeInOut:function(e,t,n,s){return(e/=s/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}},Sine:{easeIn:function(e,t,n,s){return-n*Math.cos(e/s*(Math.PI/2))+n+t},easeOut:function(e,t,n,s){return n*Math.sin(e/s*(Math.PI/2))+t},easeInOut:function(e,t,n,s){return-n/2*(Math.cos(Math.PI*e/s)-1)+t}},Expo:{easeIn:function(e,t,n,s){return 0==e?t:n*Math.pow(2,10*(e/s-1))+t},easeOut:function(e,t,n,s){return e==s?t+n:n*(1-Math.pow(2,-10*e/s))+t},easeInOut:function(e,t,n,s){return 0==e?t:e==s?t+n:(e/=s/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(2-Math.pow(2,-10*--e))+t}},Circ:{easeIn:function(e,t,n,s){return-n*(Math.sqrt(1-(e/=s)*e)-1)+t},easeOut:function(e,t,n,s){return n*Math.sqrt(1-(e=e/s-1)*e)+t},easeInOut:function(e,t,n,s){return(e/=s/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},Elastic:{easeIn:function(e,t,n,s,i,a){if(0==e)return t;if(1==(e/=s))return t+n;if(a||(a=.3*s),!i||i<Math.abs(n)){i=n;var r=a/4}else r=a/(2*Math.PI)*Math.asin(n/i);return-i*Math.pow(2,10*(e-=1))*Math.sin(2*(e*s-r)*Math.PI/a)+t},easeOut:function(e,t,n,s,i,a){if(0==e)return t;if(1==(e/=s))return t+n;if(a||(a=.3*s),!i||i<Math.abs(n)){i=n;var r=a/4}else r=a/(2*Math.PI)*Math.asin(n/i);return i*Math.pow(2,-10*e)*Math.sin(2*(e*s-r)*Math.PI/a)+n+t},easeInOut:function(e,t,n,s,i,a){if(0==e)return t;if(2==(e/=s/2))return t+n;if(a||(a=.3*1.5*s),!i||i<Math.abs(n)){i=n;var r=a/4}else r=a/(2*Math.PI)*Math.asin(n/i);return e<1?i*Math.pow(2,10*(e-=1))*Math.sin(2*(e*s-r)*Math.PI/a)*-.5+t:i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*s-r)*Math.PI/a)*.5+n+t}},Back:{easeIn:function(e,t,n,s,i){return null==i&&(i=1.70158),n*(e/=s)*e*((i+1)*e-i)+t},easeOut:function(e,t,n,s,i){return null==i&&(i=1.70158),n*((e=e/s-1)*e*((i+1)*e+i)+1)+t},easeInOut:function(e,t,n,s,i){return null==i&&(i=1.70158),(e/=s/2)<1?n/2*e*e*((1+(i*=1.525))*e-i)+t:n/2*((e-=2)*e*((1+(i*=1.525))*e+i)+2)+t}},Bounce:{easeIn:function(e,t,n,s){return n-Easing.Bounce.easeOut(s-e,0,n,s)+t},easeOut:function(e,t,n,s){return(e/=s)<1/2.75?7.5625*n*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOut:function(e,t,n,s){return e<s/2?.5*Easing.Bounce.easeIn(2*e,0,n,s)+t:.5*Easing.Bounce.easeOut(2*e-s,0,n,s)+.5*n+t}}};var wheen=(...e)=>new Wheen(...e);function assign(e,t){for(let n in t)_set(e,n,t[n])}Wheen.get=wheen,"undefined"!=typeof module&&(module.exports=Wheen);